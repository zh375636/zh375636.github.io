<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hang&#39;s Blog">
<meta property="og:url" content="https://example.com/page/71/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/page/71/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Using-Deployment-Slots-in-Azure-App-Service-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Using-Deployment-Slots-in-Azure-App-Service-24/" class="post-title-link" itemprop="url">AZ-104-Using-Deployment-Slots-in-Azure-App-Service-24</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:17" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:17-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:43:44" itemprop="dateModified" datetime="2022-11-22T11:43:44-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Using-Deployment-Slots-in-Azure-App-Service-24/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Using-Deployment-Slots-in-Azure-App-Service-24/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Using-Deployment-Slots-in-Azure-App-Service"><a href="#Using-Deployment-Slots-in-Azure-App-Service" class="headerlink" title="Using Deployment Slots in Azure App Service"></a>Using Deployment Slots in Azure App Service</h1><p>Welcome to “Using Deployment Slots in Azure App Service”. To get the most from this course, you should already have some basic experience using App Service. If you don’t, then you can take our “Introduction to Azure App Service” course.</p>
<p>App Service makes it easy to deploy a new version of an app to production. All you have to do is run the “az webapp up” command. But you’d normally want to test a new version thoroughly before putting it into production. So you need a testing environment that’s as close as possible to your production environment.</p>
<p>App Service has a great solution. It’s called a deployment slot. By default, an app has one deployment slot called “Production”. But you can create other deployment slots, too, and give them names like “testing” and “staging”. Then when you deploy an app, you can choose which deployment slot to put it in.</p>
<p>Here’s a typical way to do it. First, you clone your production slot to a staging slot. When you do this, you can choose to clone the production slot’s configuration, including app settings, connection strings, the language framework, and many other settings. That way your staging slot’s configuration will be as close as possible to your production slot’s configuration, which will make your testing more valid.</p>
<p>Once you’ve cloned the slot to a new one, though, you can change any of those settings in the new slot if you need to. For example, you might change the version of the language framework to a newer version, such as going from Java 8 to Java 11.</p>
<p>You might expect it to clone the actual app as well, and not just the settings, but it doesn’t. That’s because it expects you to upload a new version of the app to the staging slot, so there’s no point in cloning the production app.</p>
<p>Note that if you use the command line to upload the app to the staging slot, you can’t use the “az webapp up” command. Instead, you have to use the “az webapp deployment source” command, which takes a bit more work. The most common deployment source is a git repository.</p>
<p>Once you’ve tested the new version in your staging slot, the next step is to swap the staging slot with the production slot. You start by setting the source slot and the target slot. The source slot contains the new version of the app, so it’s the staging slot. The target slot is the one that will be running the new version once the swap has been completed, so it’s the production slot.</p>
<p>When you tell it to swap the source and target slots, it swaps not only the two different versions of your app but also any settings that you changed in the staging slot, such as the language framework if you changed that.</p>
<p>However, there is an exception to this. You can create slot-specific settings. For example, it’s usually a good idea to have a separate test database so you don’t mess up the production one when you’re testing a new version of your app in the staging slot. In this case, you’d need to have a different connection string for the database in each slot, and you wouldn’t want this setting to be swapped. It would need to stay with the slot rather than the app, which is why it’s called slot-specific. So when you add or change an application setting or a connection string in a non-production slot, you have the option of making it a slot-specific setting.</p>
<p>Aside from giving you the ability to properly test a new version before putting it into production, there are a couple of other big advantages to using a swap to deploy an app. First, when you deploy a new version of an app, it will often cause a reboot of the virtual machines that are used to host the app. During the warm-up period when the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/getting-started-with-azure-virtual-machines-988/what-is-a-virtual-machine/">VM instances</a> are spinning up, the app is not available, so if you were to simply deploy the new version of the app to production, it would cause downtime. But if you deploy to a staging slot first, then the VM instances have a chance to warm up before you swap the slot with production.</p>
<p>Second, if there’s a problem after you swap the new version into production, you can easily roll back and revert to the previous version. All you have to do is swap the two slots again. If you’ve ever had to quickly roll back a new version that you’ve deployed, then I’m sure you can appreciate how helpful this feature is.</p>
<p>There’s also an option that makes the swap even safer if you have slot-specific settings. It’s called “swap with preview”. This does the swap in two phases. First, it temporarily copies the slot-specific settings from the target slot (that is, the production slot) to the source slot (that is, the staging slot). It then gives you a chance to test the new version of the app with all of the settings it will have after the swap is completed.</p>
<p>If it doesn’t work, then you can cancel the swap. If it does work, then you can tell it to complete the swap. At that point, it swaps the app and the other settings between the two slots. But it leaves the slot-specific settings with each slot. So the version of the app that was previously in production and is now in the staging slot has the connection string for the test database, for example.</p>
<p>There’s also a riskier option for doing a swap. If you enable “auto swap” on a slot, then every time you push a new version of your app to that slot, it will automatically swap it with whichever slot you specify. So, for example, if you enable “auto swap” on the staging slot, and you set the “Auto swap deployment slot” to the Production slot, then every time you upload a new version of the app to the staging slot, it will automatically be swapped into Production.</p>
<p>Why on earth would you do such a thing? Well, you might want to do this as part of an <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-a-build-strategy-for-continuous-integration-with-azure-devops/introduction/">automated DevOps process</a>. If you have a continuous integration system that automatically tests your app every time you commit new changes to the source code repository, then you might feel comfortable putting new versions into production without doing any manual testing.</p>
<p>So, if that’s the case, then why bother pushing it to the staging slot first and then auto-swapping it into production? Why not just push it straight to production? Well, as I mentioned earlier, when you push an app to the staging slot first, it has a chance to warm up before going into production.</p>
<p>In fact, it’s even possible to create a custom warm-up. If your app needs to be initialized before it can serve requests from users, then you can create a custom warm-up that makes sure the initialization is complete before it performs the swap. There are two ways to set this up. If your app is running on an IIS web server, then you can configure the applicationInitialization element in the web.config file. Alternatively, regardless of the web server you’re using, you can set WEBSITE_SWAP_WARMUP_PING_PATH and WEBSITE_SWAP_WARMUP_PING_STATUSES in the app settings in <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/getting-started-with-azure-app-service-949/introduction/">Azure App Service</a>.</p>
<p>So far, I’ve only talked about having two slots and having all of your end-user traffic go to the production slot. But you can have more complicated configurations if you want. First, you can have more than two slots. For example, you might want to have separate development, testing, staging, and production slots to handle the different stages of your software development process.</p>
<p>Second, you can make things really interesting by sending some of your end-user traffic to non-production slots. For example, suppose you want to do canary testing, which means that you want to reduce the risk involved with deploying a new version of your app by releasing the new version to only a small percentage of your users. Then if those users don’t have any problems with it, you can release it to the rest of your users.</p>
<p>App Service supports this type of testing by allowing you to set a different percentage of traffic for each slot. Normally, the production slot is set to take 100% of the traffic and all other slots are set to take 0%. But if you wanted to do a canary test, you could set the staging slot to 5% and the production slot to 95%. Then after you’ve done your testing, you could swap the two slots, which would put the staging version into production, and then set the production slot to take 100% of the traffic again.</p>
<p>I should mention that the total number of slots you can use depends on the pricing tier of the App Service Plan you’re using. Deployment slots are only supported in the Standard, Premium, and Isolated tiers. The Standard tier supports up to 5 slots, but the Premium and Isolated tiers support up to 20. So if you’re using the Standard tier, and for some reason, you need more than 5 slots, you can just scale up your service plan to the Premium tier.</p>
<p>And that’s it for deployment slots in Azure App Service. Please give this course a rating, and if you have any questions or comments, please let us know. Thanks!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Autoscaling-on-Azure-App-Service-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Autoscaling-on-Azure-App-Service-23/" class="post-title-link" itemprop="url">AZ-104-Autoscaling-on-Azure-App-Service-23</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:15" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:15-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:44:02" itemprop="dateModified" datetime="2022-11-22T11:44:02-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Autoscaling-on-Azure-App-Service-23/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Autoscaling-on-Azure-App-Service-23/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Autoscaling-on-Azure-App-Service"><a href="#Autoscaling-on-Azure-App-Service" class="headerlink" title="Autoscaling on Azure App Service"></a>Autoscaling on Azure App Service</h1><p>Welcome to “Autoscaling on Azure App Service”. To get the most from this course, you should already have some basic experience using App Service. If you don’t, then you can take our “<a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-azure-app-service-2185/introduction/">Introduction to Azure App Service</a>” course.</p>
<p>All right, let’s get started. If you need to add more resources to an app running on App Service, one way is to scale up its resources by switching its App Service Plan to a higher pricing tier. This is very easy to do, and it only takes a few seconds, but it’s not a very dynamic solution. For example, what if your app gets used a lot more on weekdays than on weekends? You wouldn’t want to scale up and scale down your app’s service plan every week.</p>
<p>A more elegant solution is to have Azure add more virtual machines when your app is busier and remove VMs when it’s less busy. This is known as scaling out and scaling in rather than scaling up and scaling down. It’s only available on Basic plans and higher. It’s not available on Free or Shared plans.</p>
<p>Keep in mind, though, that even the Basic tier probably won’t give you what you need. That’s because it only allows you to scale in and out manually. If you want Azure to scale without manual intervention, then you need autoscaling, which is only available on Standard plans and higher.</p>
<p>The service that actually handles autoscaling is Azure Monitor. So, you can get to the autoscale settings either by selecting “Scale out” from the menu in your Service Plan or by going to Azure Monitor and selecting “Autoscale” and then selecting your Service Plan.</p>
<p>The way it works is that you can create one or more scale conditions that specify exactly what will trigger Azure to add or remove virtual machines. In each scale condition, you need to add one or more rules. For example, you could say that if the average CPU percentage of the VMs in your Service Plan is over 75% for at least 10 minutes, then it should increase the number of VM instances by one.</p>
<p>There are a huge number of variations in the rules that you can create. First, there are different metrics to choose from. Aside from CPU percentage, there’s also memory percentage, data in, data out, disk queue length, and a wide variety of network metrics, such as “Socket count for inbound requests”.</p>
<p>You can also tell it to look for the minimum or maximum value of a metric rather than the average. For example, you could tell it to scale out if the CPU percentage reaches 75% at any time during a 10-minute period.</p>
<p>It doesn’t have to be a 10-minute period either. You can set it to aggregate the metric over any number of minutes you want. And, of course, it doesn’t need to be 75%. You can set that to whatever percentage you want, too.</p>
<p>Then there’s the scaling action that you want it to take. You can tell it to scale out by exactly a certain number of VM instances, such as 1 in our example, or scale out to a total number of instances, such as 3, or you can tell it to scale out by a percentage. For example, you can tell it to scale out the number of instances by 50% if the condition is met.</p>
<p>You can also set something called a “cool down” period. This is the number of minutes to wait after a scaling operation before it can scale again. By default, it’s set to 5 minutes. This gives the metrics a chance to stabilize again after the scaling operation.</p>
<p>For example, suppose you have a rule saying that if the average CPU percentage is over 70% for 5 minutes, then add an instance. Then suppose you have 2 instances, and the average CPU percentage reaches 90%, which causes it to add another instance. If you didn’t have a cool-down period, the CPU percentage might still be above 70% for a little while until the new instance has spun up and taken some load off of the other instances, which could trigger the unnecessary addition of yet another instance.</p>
<p>So far, I’ve only mentioned scaling out, but you can create rules for scaling in as well. They work the same way except that everything is reversed. For example, you could tell it to scale in by one instance if the average CPU percentage is below 25% during a 10-minute period.</p>
<p>Now, things really get interesting when you have multiple rules. For example, suppose that you have these rules:</p>
<ul>
<li>Scale out by one instance if CPU utilization is above 65 percent</li>
<li>Scale out by one instance if disk queue length reaches more than 1700</li>
<li>Scale in by one instance if CPU utilization drops below 35 percent</li>
</ul>
<p>Now suppose that your instances are at 30 percent CPU utilization, and the disk queue length is 1900 messages. Will it scale in or scale out or stay the same? The answer isn’t obvious because there are conflicting rules. The CPU utilization is below 35 percent, so maybe it will scale in by one instance. But the disk queue length is more than 1700, so maybe it will scale out by one instance. Do the two rules cancel each other out, or does one of them have priority? Well, Azure autoscaling has a very sensible policy in these situations. Scale-out rules always win over scale-in rules. That’s because if any aspect of the system needs more resources, then it should scale out. Scaling in would just make performance worse.</p>
<p>Okay, that was a lot of information, but believe it or not, there are a couple of other important autoscaling options that I haven’t mentioned yet: scaling to a specific instance count and scheduling.</p>
<p>Previously, I showed scaling based on a metric, such as CPU percentage, but it’s also possible to create a scale condition that doesn’t involve metrics. To do this, you select “Scale to a specific instance count” instead of “Scale based on a metric” when you create a scale condition. This is much simpler than the metric-based process. You just tell it the number of instances you want it to scale to.</p>
<p>Of course, this doesn’t really sound like autoscaling, does it? Without a metric, how will it know when to scale to a specific instance? That’s where scheduling comes in. You simply set a start time and an end time for when this condition should be in effect. If you want it to happen on a recurring basis, you can select “Repeat specific days” and tell it which days you want it to happen every week. For example, you could scale out to a specific instance count on weekdays.</p>
<p>It’s also possible to use a schedule for a metric-based condition. For example, you could configure it to scale based on CPU percentage only on weekends but scale out to a specific instance count during weekdays. In this example, you’d have both metric-based and specific instance-based conditions in the same Service Plan, but since you scheduled them for different days, there wouldn’t be a conflict.</p>
<p>And that’s it for autoscaling on Azure App Service. Please give this course a rating, and if you have any questions or comments, please let us know. Thanks!</p>
<h1 id="1Autoscaling-on-Azure-App-Service"><a href="#1Autoscaling-on-Azure-App-Service" class="headerlink" title="1Autoscaling on Azure App Service"></a>1<strong>Autoscaling on Azure App Service</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-azure-app-service-2185/introduction/">Course: Introduction to Azure App Service</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Introduction-to-Azure-App-Service-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Introduction-to-Azure-App-Service-22/" class="post-title-link" itemprop="url">AZ-104-Introduction-to-Azure-App-Service-22</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:14" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:14-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:42:12" itemprop="dateModified" datetime="2022-11-22T11:42:12-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Introduction-to-Azure-App-Service-22/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Introduction-to-Azure-App-Service-22/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to “Introduction to Azure App Service”. I’m Guy Hummel, and I’m a certified Azure Developer and Solutions Architect.</p>
<p>In this course, I’ll start with an overview of Azure App Service, and then I’ll show you how to create a simple app. Finally, I’ll go over App Service Plans. This course is not intended to explain every aspect of Azure App Service, which is quite a complex product. Instead, it’s intended to help you get started with hosting web apps on Azure. We cover additional aspects of App Service, such as autoscaling, deployment slots, networking, and security, in other courses.</p>
<p>To get the most from this course, you should already have some basic experience using Azure. If you don’t have any experience with Azure, then you can take our “Microsoft Azure Fundamentals” learning path.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished. Thanks!</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>When you need to host a website on Azure, there are lots of potential choices. If it’s a static website that doesn’t require any interactions with users, then you can just store your website in Azure Storage and serve it from there. If you need to host something more sophisticated, then you could deploy it on an Azure virtual machine that’s running a content management system, such as WordPress. If you’ve built a microservices-based application in Docker containers, then you could run it on Azure Kubernetes Service.</p>
<p>But the most popular way to do it is to use Azure App Service. Why? Well, because App Service tries to make deploying a web application as easy as possible while still providing lots of flexibility and features. It’s considered to be a platform-as-a-service rather than infrastructure-as-a-service because it manages the underlying infrastructure for you. This means you don’t have to worry about things like patching the operating system.</p>
<p>App Service supports a wide variety of programming languages and frameworks, including ASP.NET, ASP.NET Core, Java, Ruby, Node.js, PHP, and Python. Not only do these come preinstalled, but they’re also updated when new patches or releases are available. For most of these frameworks, you can choose whether to run it on Windows or Linux (although that’s not the case with ASP.NET Framework 4.8, which can only run on Windows).</p>
<p>Even if you want to use a different programming language, you can still use App Service if you put your application in a Docker container that has the right dependencies installed in it.</p>
<p>There are other key development and deployment features, too. First, it’s well-integrated with Visual Studio and Visual Studio Code, which are the preferred programming environments for many software developers. It’s also integrated with continuous integration &#x2F; continuous delivery tools, such as Azure DevOps, GitHub, and BitBucket. You can also use App Service to host mobile backends and application programming interfaces.</p>
<p>Aside from the ease of deployment and maintenance, one of the biggest advantages of using App Service is its enterprise-class features. First, there’s high availability. Microsoft guarantees 99.95% uptime in most cases for apps running on this service. Then there’s scalability. You can configure it to automatically add more resources to your application when demand increases.</p>
<p>Of course, security is important, too, so Microsoft provides authentication capabilities if you only want authorized users to be able to access your apps. It also lets you control which IP addresses are allowed or denied access to your site if you want.</p>
<p>There are other features as well, but this should give you a good idea of why App Service is the preferred choice for hosting web apps on Azure.</p>
<h1 id="Creating-a-Simple-App"><a href="#Creating-a-Simple-App" class="headerlink" title="Creating a Simple App"></a>Creating a Simple App</h1><p>Now I’ll show you how easy it is to deploy an application on Azure App Service. In fact, it only takes one command to do it.</p>
<p>There are a few different options for where we could deploy it from. We could use Visual Studio, Visual Studio Code, or the Azure Command-Line Interface. I’m going to use the Azure CLI because it’s possible to use it without having to install anything. Microsoft provides something called the Cloud Shell that brings up a small virtual machine that has the Azure CLI and other tools installed on it.</p>
<p>To open it, you click here in the Azure Portal. If you haven’t used it before, then it’ll ask you for permission to create a storage account that the Cloud Shell VM can use. But I’ve used it before, so it comes right up.</p>
<p>Before we can deploy an app, we need to get one from somewhere. I’m going to use a sample .NET application. To get it, you can type this command.[dotnet new webapp -n MyFirstAzureWebApp -f net6.0 &amp;&amp; cd MyFirstAzureWebApp] To save you some typing, I’ve included this command in the transcript below. This command also moves you into the MyFirstAzureWebApp folder, which is where the app was downloaded.</p>
<p>Now that we have the app, we can deploy it to App Service using this command.[az webapp up –sku F1 –name <app-name>] The “az” means it’s an Azure command. “webapp” is the command for App Service. “up” tells it to create the web app using the code in the current directory. “sku F1” means that we want to use the free tier so we won’t be charged for this service. I’ll explain more about service tiers later. Then we say “–name” and what we want to call the app. I’m calling it “ca” for Cloud Academy”, “webapp”. You’ll have to call it something else because the name has to be unique among all of the App Service names across all Azure customers.</app-name></p>
<p>There are quite a few other options we can add, but we can get away with only including these ones. Some of the other most common options are:</p>
<ul>
<li>–resource-group for the resource group that it will put your App Service instance in</li>
<li>–location to specify the Azure region where your app will be hosted</li>
<li>–plan to specify which App Service Plan to use. I’ll tell you more about this in the next lecture.</li>
<li>–os-type, which can be either Windows or Linux. If you don’t specify one, then it’ll default to “Windows”.</li>
</ul>
<p>Since we didn’t specify any of these options, it’s going to create a new resource group and a new App Service Plan using default names, it will put everything in your default location, and it will use Windows for the operating system.</p>
<p>[Hit Enter]Okay, this is going to take a while, so I’ll fast-forward.</p>
<p>All right, it’s done. You can see the choices it made for the options we left out. For example, here’s what it called the App Service Plan, and here’s what it called the resource group.</p>
<p>Now to bring up the app we just deployed, we can use this link. We can click on it, but notice that it’s going to include the quote at the end, so it’ll give us an error. That’s okay because we can just remove the extra bit at the end.</p>
<p>That’s better. This is a very simple web page because that’s all that’s in the sample app. Now, suppose we wanted to make a change to the app. Normally, you’d probably do that in either Visual Studio or Visual Studio Code, but we can actually do it from Cloud Shell, too.</p>
<p>If you click here, it’ll bring up an editor. First, we’ll go into the MyFirstAzureWebApp folder, and then go into the Pages folder, which is where we’ll find the home page for our app. It’s called Index.cshtml.</p>
<p>Right now, the main text on the home page is just “Welcome”. Let’s change it to “Welcome to Azure”. Now we’ll save it and then close the editor.</p>
<p>Okay, we’re back at the command line. If we hit the up arrow, it’ll bring back our previous command. To update our app, we’ll use the “az webapp up” command again, but this time, we don’t need to specify the sku or the name.[Erase them and hit Enter.] I’ll fast-forward again.</p>
<p>All right, it’s done. Now if we go back to the web page and hit refresh, you’ll see that the message changed to “Welcome to Azure”, so it worked.</p>
<p>And that’s it for creating and updating a simple app.</p>
<h1 id="App-Service-Plans"><a href="#App-Service-Plans" class="headerlink" title="App Service Plans"></a>App Service Plans</h1><p>Although Azure App Service takes care of managing the underlying infrastructure for you, you still need to decide what type of infrastructure it should use. To do that, you need to create an App Service Plan.</p>
<p>The three main settings you have to choose in an App Service Plan are the operating system, the region, and the pricing tier. The operating system can be either Windows or Linux. For the region, you typically choose the one that’s closest to where most of your users are located, such as East US. Bear in mind that you can’t change a service plan’s region. So if you decide to move an app to another region later, you’ll have to make a copy of it and put it in a new App Service Plan.</p>
<p>Those first two settings are usually pretty easy to choose, but the pricing tier is much more complex. This is where you decide what type of compute resources to allocate and what App Service features you want. This table shows a summary of the different tiers, although it doesn’t actually show all of the options and features in each tier. I’ll walk you through some of the highlights.</p>
<p>If you’ll be using this plan for development and testing, then you can probably get away with using a low-powered and inexpensive option. The Free tier is a good choice as long as you only need 60 CPU minutes per day. If you need more CPU time than that, then you’ll have to go with a plan that costs money.</p>
<p>The next step up is the Shared tier, which is also known as the D1 tier. It gives you up to 240 CPU minutes per day. It’s called the Shared tier because you have to share compute resources with other Azure customers. That’s the case with the Free tier as well. Both of these tiers have just one gig of RAM and one gig of storage, so you can’t do too much with them. The Shared tier also allows you to use a custom domain name for your app’s website, which isn’t something you can do with the Free tier.</p>
<p>If you need more resources, then you can go with the Basic tier, which puts your apps on dedicated virtual machines instead of shared VMs. There are several options that vary based on the number of virtual CPU cores and the amount of memory. All of the options come with 10 gig of storage.</p>
<p>The next step up is the Standard tier, but although it has 50 gig of storage instead of 10 gig, the CPU and memory options are exactly the same as the Basic tier. The big difference is that the Standard tier supports autoscaling, which means it can automatically add more virtual machines to handle increased traffic. It lets you use up to 10 VM instances. That’s significantly more than the Basic tier, which has a maximum of 3 VM instances.</p>
<p>The Premium tier has options for more CPU, memory, and storage, and it lets you use up to 30 VM instances in most Azure regions.</p>
<p>The Isolated tier gives you a private, dedicated environment that’s in its own virtual network. While the Standard and Premium tiers allow you to connect your dedicated VMs to a virtual network, the Isolated tier actually puts your VMs in a private virtual network so they’re isolated from other App Service instances. It lets you have up to 100 VM instances.</p>
<p>Regardless of which pricing tier you choose, it’s possible to put multiple apps in your service plan. But all of those apps will share the same compute resources, so if you put too many apps in the same service plan, then you’ll run into performance issues.</p>
<p>One potential way to resolve this problem would be to add more virtual machine instances up to the limit of the number of instances allowed in the pricing tier you’ve chosen. This is known as scaling out. It’s also possible to set up autoscaling, which is such a complex topic that we cover it in a separate course.</p>
<p>If scaling out doesn’t solve the problem, then you can switch your plan to a pricing tier that has more powerful instances and&#x2F;or a higher limit on the number of instances you can have. This is called scaling up, and it’s very easy to do. You can simply select the new pricing tier, and it will only take seconds to go into effect.</p>
<p>And that’s it for App Service Plans.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>All right, let’s do a quick review of what you’ve learned.</p>
<p>Azure App Service tries to make deploying a web application as easy as possible by managing the underlying infrastructure for you.</p>
<p>It supports a wide variety of programming languages and frameworks, including ASP.NET, ASP.NET Core, Java, Ruby, Node.js, PHP, and Python. For most of these frameworks, you can choose whether to run it on Windows or Linux (although that’s not the case with ASP.NET Framework 4.8, which can only run on Windows).</p>
<p>To use a different programming language, put your application in a Docker container that has the right dependencies installed in it.</p>
<p>You can deploy apps to App Service from Visual Studio, Visual Studio Code, or the Azure Command-Line Interface. To do it from the command line, use “az webapp up”.</p>
<p>The three main settings you have to choose in an App Service Plan are the operating system, the region, and the pricing tier.</p>
<p>If you choose the Free tier or the Shared tier, you have to share compute resources with other Azure customers.</p>
<p>If you choose the Basic tier or higher, your apps will be put on dedicated virtual machines instead of on shared VMs.</p>
<p>Autoscaling is supported on the Standard tier and higher.</p>
<p>The Premium tier has options for more CPU, memory, and storage.</p>
<p>The Isolated tier gives you a private, dedicated environment that’s in its own virtual network.</p>
<p>Regardless of which pricing tier you choose, you can put multiple apps in your service plan. But all of those apps will share the same compute resources.</p>
<p>You can scale up the resources in your service plan by switching to a higher pricing tier. You can scale out your service plan’s resources by adding more VMs.</p>
<p>That’s all for now. Please give this course a rating, and if you have any questions or comments, please let us know. Thanks!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Create-Containerized-Solutions-with-Azure-Kubernetes-Service-AKS-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Create-Containerized-Solutions-with-Azure-Kubernetes-Service-AKS-21/" class="post-title-link" itemprop="url">AZ-104-Create-Containerized-Solutions-with-Azure-Kubernetes-Service-AKS-21</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:12" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:12-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:45:38" itemprop="dateModified" datetime="2022-11-22T11:45:38-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Create-Containerized-Solutions-with-Azure-Kubernetes-Service-AKS-21/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Create-Containerized-Solutions-with-Azure-Kubernetes-Service-AKS-21/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Configuring-Azure-Kubernetes-Service-AKS-20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Configuring-Azure-Kubernetes-Service-AKS-20/" class="post-title-link" itemprop="url">AZ-104-Configuring-Azure-Kubernetes-Service-AKS-20</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:11" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:11-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:42:04" itemprop="dateModified" datetime="2022-11-22T11:42:04-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Configuring-Azure-Kubernetes-Service-AKS-20/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Configuring-Azure-Kubernetes-Service-AKS-20/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to “Configuring Azure Kubernetes Service”. My name’s Guy Hummel, and I’m a Microsoft Certified Azure Expert. If you have any questions, feel free to connect with me on LinkedIn and send me a message, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is focused on how to get a Kubernetes cluster up and running on Azure. It does not cover all of the details of how Kubernetes works because that’s a very big topic, and it’s not necessary to know all of those details to configure a basic Kubernetes cluster.</p>
<p>Having said that, this course does start with a brief overview of what Kubernetes does and what a Kubernetes cluster looks like. After that, I’ll give you a demo of how to create a cluster using AKS. Finally, I’ll show you how to manage a cluster using the kubectl command.</p>
<p>To get the most from this course, you should have some general IT knowledge. It would also be helpful to have some experience with Linux. If you want to do the demos yourself, as well, then you’ll need to have an Azure account. If you don’t already have one, then you can create a free trial account.</p>
<p>To save you the trouble of typing in the commands shown in this course, I’ve put them in a readme file in a GitHub <a target="_blank" rel="noopener" href="https://github.com/cloudacademy/configuring-aks">repository</a>. You can find a link to the repository at the bottom of the Overview tab below this video.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished.</p>
<p>Now, if you’re ready to learn how to create a Kubernetes cluster on Azure, then let’s get started.</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>As you probably know, containers are becoming the preferred way to build, test, and deploy applications. A container typically includes an application plus all of the third-party packages it needs. Containers are somewhat like virtual machines except they don’t include the operating system. This makes it easy to deploy them because they’re very lightweight compared to virtual machines. In fact, containers run on virtual machines.</p>
<p>If your entire application is in a single container, then it’s very easy to run it on Azure. But running a single instance of a container is usually not sufficient. Most production applications need to be both scalable and highly available, so you need to run multiple copies of your container on multiple virtual machines.</p>
<p>Furthermore, it’s becoming a common practice to break an application up into multiple microservices that run in separate containers. When you combine this with the need for high availability and scalability, the number of containers you need to manage can be overwhelming.</p>
<p>The solution is to use a container orchestrator that takes care of the underlying technical details for you. By far the most popular orchestrator is Kubernetes, which is an open-source solution.</p>
<p>Kubernetes lets you create clusters of virtual machines that run containers. Each virtual machine is called a node, and each node runs one or more pods. Each pod typically contains one container. The cluster also contains a control plane, which manages the nodes and pods.</p>
<p>This is a very basic overview. Kubernetes has all kinds of features that help with storage, networking, security, and management. Despite the fact that Kubernetes is designed to simplify container deployments, it is quite a complex system, so it can take a bit of work to get it installed and running on a new cluster.</p>
<p>Fortunately, Microsoft has made it much easier to do this by using Azure Kubernetes Service, or AKS for short. With AKS, you can create and configure a Kubernetes cluster quite easily. I’ll show you how in the next video.</p>
<h1 id="Creating-a-Cluster"><a href="#Creating-a-Cluster" class="headerlink" title="Creating a Cluster"></a>Creating a Cluster</h1><p>Now, let’s create and configure a cluster using the Azure Kubernetes Service. The easiest way to get to the AKS section of the portal is to use the search bar. If you type “aks”, it will come back with “Kubernetes service”.</p>
<p>Then click Add and select “Add Kubernetes cluster”. Let’s create a new resource group to put it in. I’ll call it “aks1”. And I’ll call the cluster “cluster1”.</p>
<p>You’ll notice that the availability zones field is greyed out. That’s because this region doesn’t support availability zones. So if we create the cluster in this region, then it won’t be a highly available cluster since the nodes will all be in the same zone. If that zone were to go down, then the whole cluster would go down. If we change it to a region that supports availability zones, such as “Central US”, then we can put a node in each zone and make it highly available. By default, it selects all three zones.</p>
<p>You can select a specific Kubernetes version if you want, but we’ll leave that with the default.</p>
<p>Now we specify what kind of nodes we want. If you’ll recall, the nodes are virtual machines, so we need to give the specifications for those VMs. The default is a good choice, but you can change it if you want. You might be tempted to choose the smallest (and cheapest) one to save money, but this one is actually too underpowered for a Kubernetes cluster, so you’ll eventually get an error if you select this one. Let’s leave it with the default.</p>
<p>Now we need to tell it how many nodes to provision. If we only needed this cluster for testing or development purposes, then we could get away with only having one node, but if we needed it for production, then we’d want to have at least three nodes. If you’re following along on your own Azure account, then you can change this to one to save money if you want.</p>
<p>All three nodes will be the same type of VM. But suppose you needed a more powerful VM for one of your applications. You wouldn’t want to use that more expensive type of VM for all of your nodes just to accommodate that one application. Instead, you could create a separate node pool with bigger nodes. We don’t need to do that for this example, so we’ll stick with one node pool.</p>
<p>Now we’ll configure authentication. First, the cluster itself needs to be able to access other Azure resources, such as disks, so it needs to have an identity that can be trusted by the other Azure resources. There are two options for doing this, a service principal or a system-assigned managed identity. The easiest option is the managed identity, which actually uses a service principal under the hood, but it takes care of all of the details of managing it for you. So we’ll use that one.</p>
<p>The other authentication and authorization that’s required is for users who need to access the cluster, such as developers and system administrators. Authentication means verifying a user’s identity. The standard way to do authentication in Azure is to use Azure Active Directory. This option lets you give administrative access to the cluster to a particular group in Azure Active Directory. That would require some extra steps, so I’m going to leave this disabled. Don’t worry, though. Even without this option enabled, it’ll still restrict who can access the cluster.</p>
<p>Authorization means giving permissions to a user to perform specific tasks. The standard way to do authorization is called role-based access control, so we should leave this option enabled.</p>
<p>The next page is for network configuration. You can leave it with the defaults unless you need something specific, such as restricting cluster management access to a particular range of IP addresses.</p>
<p>The Integrations page is where you can integrate your cluster with other services like Azure Container Registry and Azure Monitor. Azure Container Registry is a centralized place where you can keep all of your container images, so if you integrate it with your cluster, then it will be easier to deploy your containers to the cluster.</p>
<p>Azure Monitor is enabled by default because it is the standard way to monitor the health and performance of your cluster.</p>
<p>Azure Policy is a service that lets you set governance policies, such as only allowing specific container images to run on your cluster.</p>
<p>Finally, the Tags page lets you create tags to categorize your cluster. Tags are often used for billing purposes in large organizations.</p>
<p>Okay, now we can go to the “Review + create” page. It does a quick validation check to make sure our configuration will work, and then we can click the Create button.</p>
<p>In the next demo, I’ll show you what we can do with the cluster.</p>
<h1 id="Working-with-a-Cluster"><a href="#Working-with-a-Cluster" class="headerlink" title="Working with a Cluster"></a>Working with a Cluster</h1><p>Once your Kubernetes cluster is running, you can interact with it using the kubectl command. This command is preinstalled in Azure Cloud Shell, so that’s what we’re going to use.</p>
<p>Before we can use the kubectl command, we need to tell it which cluster we want to connect to and which credentials to use. We do that by using this command. We give it the name of the cluster and the resource group that it’s in. We’re asking it to send us the credentials we need to access the cluster. The only reason I’m able to get credentials using this command is because I have the right permissions in Azure role-based access control. Those permissions gave me the ability to create the cluster in the first place and to access it.</p>
<p>Okay, it downloaded the credentials to a configuration file in my home directory. Now we can run a simple command to make sure it’s working. This will give us a list of the nodes in the cluster. There are three nodes, which is what we expected. They all have a status of “Ready”, so it looks like we’re good to go.</p>
<p>Now we can run an application by deploying some containers to the cluster. Microsoft has provided a simple application called Azure Vote. It consists of two containers, one with a web-based frontend and one with a backend database. These containers are available in the Microsoft Container Registry.</p>
<p>To deploy them to our cluster, we need to create what’s called a Kubernetes manifest file. I’ve put a copy of this file in the GitHub repository. Let’s have a quick look. I won’t explain all of the details of this file, but notice that it references two containers. The one for the database backend is here, and the one for the web frontend is here.</p>
<p>To download it to Cloud Shell, run this git clone command. Okay, it’s done. It created a directory called configuring-aks, so let’s go into that directory. There’s the manifest file. Now to get Kubernetes to make our cluster match what’s in the manifest file, we use the “kubectl apply” command, and we specify the name of the manifest file.</p>
<p>All right, that seemed to work. Now to make sure, we can connect to the application. First, we need to get the IP address of where it’s running. In the manifest file, we told Kubernetes to create a service called azure-vote-front. This service makes it possible to access the application. To see the details of the service, we use the “kubectl get service” command.</p>
<p>Here’s the external IP where it’s running. If we copy that and paste it in a new browser tab, we see the application. It’s a pretty simple app, but it does work. Once we had the cluster running, it was very easy to deploy the app to it.</p>
<p>Before we go, we’d better delete this cluster so it doesn’t end up costing a lot of money. Fortunately, that’s very easy to do. Just go to “Resource groups”, then select “aks1” and click “Delete resource group”. This will delete both the resource group and the AKS cluster. You have to type “aks1” before you can click the Delete button.</p>
<p>And that’s it for this demo.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>I hope you enjoyed learning about Azure Kubernetes Service. Let’s do a quick review of what you learned.</p>
<p>Containers are somewhat like virtual machines except they don’t include the operating system. The easiest way to run an application that includes many containers is to use a container orchestrator. The most popular orchestrator is Kubernetes.</p>
<p>Kubernetes lets you create clusters of virtual machines that run containers. Each virtual machine is called a node, and each node runs one or more pods. Each pod typically contains one container. The cluster also contains a control plane, which manages the nodes and pods. Azure Kubernetes Service makes it easy to create a Kubernetes cluster on Azure.</p>
<p>If you only need a cluster for testing or development purposes, then one node is usually sufficient, but if you’re going to run it in production, then you should have at least three nodes.</p>
<p>All three nodes will be the same type of VM. If you need something different for one of your applications, then you can create a separate node pool with different nodes.</p>
<p>To allow a cluster to access other Azure resources, you need to assign an identity to it. The best way to do this is to use a managed identity rather than a service principal.</p>
<p>To authorize users to perform specific tasks on the cluster, you should enable role-based access control.</p>
<p>It can be useful to integrate an AKS cluster with Azure Container Registry, Azure Monitor, and Azure Policy. At the very least, you should enable integration with Azure Monitor.</p>
<p>Once a cluster is running, you can manage it with the kubectl command. Before you can use the kubectl command, you need to get credentials for it using the “az aks get-credentials” command.</p>
<p>To see the nodes that are running in your cluster, use the “kubectl get nodes” command. To deploy an application to a cluster, first, you need to create a Kubernetes manifest file. This file includes details of the containers to use as well as the Kubernetes services to create to give access to the apps running in the containers. Then you can deploy the application using the “kubectl apply” command.</p>
<p>To learn more about Kubernetes and AKS, you can take another one of our courses or labs, or you can read Microsoft’s documentation at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/aks">URL</a>.</p>
<p>Please give this course a rating, and if you have any questions or comments, please let us know. Thanks!</p>
<h1 id="5Summary"><a href="#5Summary" class="headerlink" title="5Summary"></a>5<strong>Summary</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/aks/">Azure Kubernetes Service (AKS) documentation</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Getting-Started-with-Azure-Container-Instances-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Getting-Started-with-Azure-Container-Instances-19/" class="post-title-link" itemprop="url">AZ-104-Getting-Started-with-Azure-Container-Instances-19</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:09" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:09-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:46:36" itemprop="dateModified" datetime="2022-11-22T11:46:36-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Getting-Started-with-Azure-Container-Instances-19/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Getting-Started-with-Azure-Container-Instances-19/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Knowledge-Check-Introduction-to-Azure-Resource-Manager-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Knowledge-Check-Introduction-to-Azure-Resource-Manager-18/" class="post-title-link" itemprop="url">AZ-104-Knowledge-Check-Introduction-to-Azure-Resource-Manager-18</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:08" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:08-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:44:48" itemprop="dateModified" datetime="2022-11-22T11:44:48-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Knowledge-Check-Introduction-to-Azure-Resource-Manager-18/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Knowledge-Check-Introduction-to-Azure-Resource-Manager-18/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><object data="Knowledge-Check-Introduction-to-Azure-Resource-Manager.pdf" type="application/pdf" width="100%" height="600"></object></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Azure-Resource-Manager-Templates-In-Depth-17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Azure-Resource-Manager-Templates-In-Depth-17/" class="post-title-link" itemprop="url">AZ-104-Azure-Resource-Manager-Templates-In-Depth-17</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:06" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:06-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:47:06" itemprop="dateModified" datetime="2022-11-22T11:47:06-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Azure-Resource-Manager-Templates-In-Depth-17/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Azure-Resource-Manager-Templates-In-Depth-17/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Introduction-to-Azure-Resource-Manager-16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Introduction-to-Azure-Resource-Manager-16/" class="post-title-link" itemprop="url">AZ-104-Introduction-to-Azure-Resource-Manager-16</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:05" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:05-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:41:14" itemprop="dateModified" datetime="2022-11-22T11:41:14-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Introduction-to-Azure-Resource-Manager-16/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Introduction-to-Azure-Resource-Manager-16/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><p>Hi, and welcome to this introduction to this Azure Resource Manager course. My name is Hallam Webber and I will be your instructor for this course. This is a beginner’s course that’s aimed at those who want to know more about managing and configuring their Azure environment. So whether you’re in DevOps, IT support, or a developer that wants to get a better understanding of fast-tracking deployments, there is something in this course for you.</p>
<p>In this course, we will start with an overview of what Azure Resource Manager is and where it fits into the overall Azure picture. Then, we’ll get an understanding of why it’s important. and then, we will delve into some hands-on demonstrations of how you can use it to simplify what would otherwise be quite labor-intensive tasks. </p>
<p>As an introductory course, we will be learning by doing, to give you a basic “how-to” foundation in ARM templates. When we’re not in the Azure portal I’ll be using Visual Code with the ARM template extension which provides IntelliSense for Azure Resource Manager syntax. This is a very helpful tool if you’re not familiar with ARM instructions.</p>
<p>We welcome all comments and feedback, so please feel free to reach out to us at <a href="mailto:&#115;&#x75;&#112;&#x70;&#x6f;&#x72;&#116;&#64;&#x63;&#108;&#111;&#117;&#x64;&#x61;&#x63;&#97;&#100;&#101;&#109;&#121;&#46;&#99;&#111;&#109;">&#115;&#x75;&#112;&#x70;&#x6f;&#x72;&#116;&#64;&#x63;&#108;&#111;&#117;&#x64;&#x61;&#x63;&#97;&#100;&#101;&#109;&#121;&#46;&#99;&#111;&#109;</a> with any questions or comments. Let’s get started.</p>
<h1 id="Azure-ARM-Intro-Overview"><a href="#Azure-ARM-Intro-Overview" class="headerlink" title="Azure ARM Intro Overview"></a>Azure ARM Intro Overview</h1><p>So, what is Azure resource manager? Well, it is what it says it is. For a lot of people when they think of Azure they think of the complete Microsoft cloud product and all that it entails. But in reality, Azure is a collection of services or resources. When you sign up to Azure for the very first time as an organization with a new subscription and you log in to the portal there is nothing there. As you require services whether that’s a virtual machine, a web app, or database server you create instances of those resources. Azure resource manager is the glue behind-the-scenes that makes it substantially easier for you to deploy and manage all those different resources. </p>
<p>ARM in Context</p>
<p>You might think that the portal is Azure, but the portal is one of several interfaces to Azure resource manager. The portal is merely a graphical interface over the resource manager, which in itself is an interface to the various resources, especially in terms of deployment, and managing the order and dependencies involved in deploying various resources. Apart from the portal, there is also an API interface to Azure resource manager and more importantly for us, an SDK interface.</p>
<p>Command Line Interface</p>
<p>PowerShell for Windows and the Azure command-line interface are the preferred methods for interacting with Azure resource manager when it comes to large, complex, and repeated deployments. One thing I want you to take notice of on the slide is where authentication fits into the scheme. Because there are multiple ways to interact with resource manager authentication is handled directly by it. This is demonstrated by the fact that when you log into Azure through PowerShell or the Azure CLI a browser window will pop up and you can authenticate through that when using two-step authentication or a Microsoft account.</p>
<h2 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h2><p>As we can see here Azure resource manager is mostly used when managing resources within a resource group. All resources are created within a group even if they are spread over multiple geographical regions. By grouping resources, you can perform actions on all the resources in that group at one time. A simple example would be creating a database server with databases and a web app service for some testing and then deleting all of them at one time by deleting the resource group that contains them. Having said that depending on the type of billing account you have with Microsoft you can also create subscriptions and management groups through resource manager.</p>
<p>Why You Need to Know ARM</p>
<p>But why do you need to know about Azure resource manager? After all, the portal works just fine and is easy enough to use. Infrastructure as code is the reason. In the cloud, hardware does not exist; everything is virtual and can be defined by code. It’s fine for you to deploy a simple resource or even a couple of simple resources using the portal in a one-off situation. But having to set up by hand multiple and complex resources, perhaps several times for different environments, like development test and production, would not only be tedious and time-consuming but also prone to error. You can create resource deployments with scripts and run them through the Azure CLI or PowerShell. As resource creation and deployment are so important Azure has developed templates for defining your resources.</p>
<p>A template is a JSON formatted text specification of a resource. The JSON template file contains all the information about a resource necessary for Azure to create it. It contains vital information like the type of resource, for example, virtual machine, database or storage, and the resource’s name. What resource group, and where the resource should be deployed, as in the geographic region are other configurable attributes in the JSON definition. The template specifies the size of the resource, whether that is disk space for a database or compute power for a virtual machine. As I said, every detail about the resource you want to create, including other resources that the target resource will depend on. A template won’t be that useful if it just specifies exactly the same resource. What I mean by that, is you can’t have resources with identical names. The template architecture allows you to use input parameters to reuse a template to deploy the same type of resource, with a different name and attributes. We will see that all the attributes we choose from drop-down lists, radio buttons, and checkboxes as well as text we enter during the resource creation process in the portal become template parameters.</p>
<p>I’m going to introduce you to templates by creating a virtual machine resource in the portal and then saving the template. We will look at the elements of the template like how a resource is defined and how parameters are used to modify a resource deployment. Creating a VM will also demonstrate how one resource is dependent on other resources. A virtual machine doesn’t exist in isolation, it requires a network and storage in the form of a disk. Don’t worry if you don’t get resource templates after the first demonstration. I will examine the different elements of a template in more detail later. The first demo is to show you the relationship between a resource created in the portal and the corresponding template that gets produced.</p>
<h1 id="DEMO-Modifying-Existing-Templates"><a href="#DEMO-Modifying-Existing-Templates" class="headerlink" title="DEMO: Modifying Existing Templates"></a>DEMO: Modifying Existing Templates</h1><p>Without a doubt, the easiest way to get started with templates is to go to a current resource and download the deployment as an ARM template. This process can be likened to recording an Excel macro and then inspecting the code to see how it works. </p>
<p>I’ll start by creating a virtual machine resource. Let’s just fast forward through the portal process by going with most of the defaults. It’s not important what we choose here as template creation will work for any resource. I’ll go with premium SSD and the standard networking setup. I will turn on OS guest diagnostics, take the advanced defaults, and not bother with tags. We can see before we hit the create button, we have the opportunity to download the template before getting the portal to deploy the VM. I’m going to download the template now for use later on.</p>
<p>Having a look at the template we can see it is made up of 22 input parameters that can be changed or substituted to alter how the resources are created. The parameters have a name and a data type. There are 3 variables that are used within the template, and of course, there are the 6 resources being created in the deployment. The parameters file contains the values that are currently used for the resource deployments. These are default values, or values manually entered in the portal when creating the VM resource, like location, machine name, and resource group. Scripts just links you to Azure documentation. The same information is accessible while the deployment is happening. For an existing resource, you can download the template or deploy from the Export Template page. Some of you might be thinking, “hang on, now there are only 3 parameters and 1 resource”. That’s because this template is just the virtual machine component and doesn’t include the supporting network infrastructure resources. If you need to get the templates for all resources in a deployment after the fact, you can go to the resource group and select the resources and click export template.</p>
<p>Back at our VM resource, Azure lets you save templates to an online library, which is what I’ll do now by giving the template a name and simple description. You can view templates saved to the library through More Services, then All Services, and then select Templates. With a template, you can redeploy the resource or make a similar resource with different attributes by changing some of the input parameters.</p>
<p>We’ve got the template what now? The usual method for deploying resources using templates is to use a command-line interface, either PowerShell or Azure CLI. We will look at both of these later, but initially let’s create the VM resource through the portal using the downloaded template.</p>
<p>Search for deploy on the home page of the portal and select Deploy a custom template. Under common templates, there are templates for creating common resources that you can adapt and modify. We want to build our own template in the editor. Here we have a blank boilerplate template, which I’m going to replace with the template I previously downloaded. I’ll upload the file and save it. Once that’s been loaded, we can see that there are 6 resources in our template – correct. Now we have an interface for entering the parameters for the resource creation. Typing in all those values does seem a bit painful, but if I click edit parameters, I can upload the associated parameters.json file with all the values in it and click save. Boom, and there we go, the values that are entered as part of the resource creation wizard are filled in as parameters. We can do a side by side comparison of the parameters as they relate to the manual portal process Resource Group, virtual machine name, region, VM size, user name, disk type, and networking. I’ll fill in the password and agree to the terms and conditions. The purchase button is a bit misleading, and I assume I won’t be charged for my own template. Anyway, the template validates correctly as I would expect, and the deployment successfully completes.</p>
<p>As with most things Azure, there is a marketplace for templates where you can browse or search for a template that meets, or closely meets your requirements at Azure quick-start templates. I’ll search for something a little bit interesting involving Cosmos, like Create an Azure Cosmos account for MongoDB API autoscale. Clicking on the link takes us to a description of the template and its parameters, along with instructions on how to deploy the template using either PowerShell or Azure command-line interface. Browse on GitHub will take you to the template’s repo where you can download the template JSON files.</p>
<p>Clicking Deploy to Azure takes back to the same Deploy Custom Template page where you can enter the missing parameters using the GUI interface.</p>
<h1 id="ARM-Templates"><a href="#ARM-Templates" class="headerlink" title="ARM Templates"></a>ARM Templates</h1><p>An ARM template is a JSON file describing the resources or services that you want to deploy and it has many advantages. Templates are idempotent. This means changes are applied only once, which is exactly what we want. Associated with this is repeatability, and that each time we apply the template we get the same result. Unlike a procedural script where the order of commands is crucial, the template is submitted as one object and Azure Resource Manager works out the order that resources should be created in. So dependency management and orchestration of deployment operations are carried out correctly. That JSON format also allows for nested and hierarchical resources and you can divide up a deployment into multiple linked files to make complex deployments modular and easier to manage. Azure Resource Manager includes commands for testing templates, and Azure DevOps has a task for including ARM templates in pipelines.</p>
<p>A template file is made up of five sections. There are parameters that can be passed into the template. A parameter has a name and a type, for example, string or int for integer, so like programming data types. There is a functions section, this is where you define your own functions. This is in addition to the ARM template built-in functions. Any values you want to use within the template are defined in the variables section. So not variables in the traditional programming sense, but more like constants. Of course, we have a resources section which is obviously the most important part of the template as this is where we define the resources or services we want to deploy. Finally, we have an outputs section that could be used for displaying information or daisy-chaining templates. Also at the root of the template, we have the JSON schema, which we shall see is very important when building a template and also the content version.</p>
<p>Parameters allow you to pass variables into the template to make its functionality more dynamic. Each parameter object starts with its name. A parameter has a type that can be an int, bool, array, object, string, secure object, or secure string. You can also define a default value, allowed values and minimum and maximum lengths or values. Within the metadata section, you can give your parameter a description.</p>
<p>Before I move on to the function section, I just briefly want to touch on the built-in functions that are available within ARM templates. As you can see from this table, there are quite an extensive array of built-in functions, ranging from array functions through to string, although not all of the string functions have been listed here. Many of the functions are what you would expect to find in most programming languages and definitely in the .NET environment. Resource functions are there to provide access to your Azure resources and account settings, while the deployment value functions allow you to access different sections of the template.</p>
<p>User-defined functions are more like formulas or expressions rather than functions that you might find in a procedural programming language. They do take parameters that are defined with a name and a data type and the return type called output also has a defined data type. Template variables and parameters are global and can be used within user-defined functions. While you can use built-in logical functions within your user-defined function, there is no facility for iterations or for-loops. Essentially user-defined functions are a way of separating out complex or compound functionality that you want to use more than once into a separate piece of template code.</p>
<p>Variables are key-value pairs that are defined once and can be used throughout the template. As I said earlier, they are more like constant values as they can’t be assigned to once defined. Variables don’t have to be simple data types, they can be nested and complex JSON objects. The resource section is the main event, if you will. This is where we define the resources or services that we want to deploy. For obvious reasons, different resources will have different properties but there are some properties that all resources must contain. Every resource needs a name and every resource is of a type and is located somewhere. The resource shown here is an app service and depends on another resource of the type app service plan.</p>
<p>Output values are essentially the inverse of parameters. They enable you to output values from your template for either informational purposes or as inputs to linked templates, that we shall look at later, or to be used in scripts that executing the template.</p>
<h1 id="DEMO-Virtual-Machine-Template"><a href="#DEMO-Virtual-Machine-Template" class="headerlink" title="DEMO: Virtual Machine Template"></a>DEMO: Virtual Machine Template</h1><p>Let’s look at how the template structure relates to the virtual machine template we previously downloaded. I’m using Visual Studio Code to view the JSON files. Here we have those 22 parameters, followed by the three variables, and then the 6 resources. A virtual machine deployment involves more than just the machine. There is all the supporting network and security infrastructure that allows you to safely connect to and use the VM. Here we have a resource name which is one of the parameters that we input to this template. That’s the parameter definition specifying its data type. If I go over to parameters.json I can see the value that is being inserted for network interface name. Going back to template.json we can see each resource has a type, that is what resource is created. This is a network interface which is defined in the region specified by the location parameter. We have a security group name, virtual network resource, a public IP address resource, the actual virtual machine itself with the various nested properties that define that machine like its size, which is also retrieved from the machine size parameter. Here we have the virtual machine’s dependsOn section specifying that the VM requires the network interface and storage resources.</p>
<h1 id="DEMO-Simple-Template"><a href="#DEMO-Simple-Template" class="headerlink" title="DEMO: Simple Template"></a>DEMO: Simple Template</h1><p>I know what you’re thinking, this is very complex, and where do I start? Well, as luck would have it, Visual Studio has some fantastic features for creating and editing ARM templates. To access the ARM template intellisense, you need to have the Azure Resource Manager Tools extension installed in VS Code.</p>
<p>First thing I’m going to do is create a new file, and save it with the JSON extension. Straightaway, we can see that VS Code recognizes this as a JSON file. This is where the magic starts, or more correctly intellisense, when I type ARM for Azure Resource Management. We can see I have code auto-complete here with some prompts. I’m just going to select the top one, which is a resource group template and there we have all the sections that we have talked about earlier. So if I want to create a simple web app deployment, all I have to do is go into resources and once again type ARM, and we can see here we have a lot of resources to choose from.</p>
<p>Now this is all context-based, and I’m going to select web app, and there we have all the properties that we need to create a web app deployment. Obviously, I don’t want my app to be called webApp1. So I’m going to create a parameter of type string, called appname. We can see here with the yellow squiggly line that part of the template functionality is that it recognizes that I haven’t used that parameter yet. So, I’ll go down here and type open square bracket P and you see the auto-complete prompts with parameters. I’ll pick parameters and type open bracket and I’m prompted with the parameter appname. I can then go and I can just replace all the instances of webApp1 with my appname parameter. Every resource has a type and in this case it’s a web site and it’s already put in the ARM tags and properties for us.</p>
<p>In the dependsOn section, we can see a service plan. But before I define that I’m going to show you how we can test our template before deploying it. If I go to my PowerShell window, which I’ve already logged into Azure and enter Test AzResourceGroupDeployment, I’m prompted for the parameter appname, which I’ll supply, called howdeploywebapp. It’s returned with an invalid template error. It’s complaining that it doesn’t have an appServicePlan1.</p>
<p>Okay, so I need to back in the resources section and I will add a service plan and I will also add another parameter called planname. I can use that parameter everywhere I’ve got appServicePlan1, and that is even within the app service itself, like in this concat function. As you can see, functions, parameters and variables are used within square brackets. The error in the concat function indicates a missing comma. Right, so I’ll save that. Just notice here that the location is picked up from the resource group.</p>
<p>So when we are testing, we are testing it with AzResourceGroupDeployment, and that relies on the fact that it belongs to an existing resource group as opposed to using the Test-AzDeployment command. I’ll go back here and re-run this, howdeploywebbapp and the plan name is howdeployplan and we can see that has been successful. So let’s go ahead and deploy that. I’ll just go back here and change my test to new. Now we can go over to the portal and see what’s happening. If I refresh deployments, we can see we’ve got a deployment happening. Let’s click on that and go into it, and it’s complete. I’ll navigate back to the resource group home page so we can see the newly created resources.</p>
<p>Right, so here we have the plan and the app, and as you would expect. Clicking on the app service resource takes us to the app service, where we can click on the app service URL to see it deployed.</p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;$schema&quot;: &quot;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&quot;,</span><br><span class="line">  &quot;contentVersion&quot;: &quot;1.0.0.0&quot;,</span><br><span class="line">  &quot;parameters&quot;: &#123;</span><br><span class="line">    &quot;appname&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">      &quot;metadata&quot;: &#123;</span><br><span class="line">        &quot;description&quot;: &quot;description&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;planname&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;string&quot;,</span><br><span class="line">      &quot;metadata&quot;: &#123;</span><br><span class="line">        &quot;description&quot;: &quot;description&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;functions&quot;: [],</span><br><span class="line">  &quot;variables&quot;: &#123;&#125;,</span><br><span class="line">  &quot;resources&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;[parameters(&#x27;planname&#x27;)]&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;Microsoft.Web/serverfarms&quot;,</span><br><span class="line">      &quot;apiVersion&quot;: &quot;2018-02-01&quot;,</span><br><span class="line">      &quot;location&quot;: &quot;[resourceGroup().location]&quot;,</span><br><span class="line">      &quot;sku&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;F1&quot;,</span><br><span class="line">        &quot;capacity&quot;: 1</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;tags&quot;: &#123;</span><br><span class="line">        &quot;displayName&quot;: &quot;[parameters(&#x27;planname&#x27;)]&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;[parameters(&#x27;planname&#x27;)]&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;[parameters(&#x27;appname&#x27;)]&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;Microsoft.Web/sites&quot;,</span><br><span class="line">      &quot;apiVersion&quot;: &quot;2018-11-01&quot;,</span><br><span class="line">      &quot;location&quot;: &quot;[resourceGroup().location]&quot;,</span><br><span class="line">      &quot;tags&quot;: &#123;</span><br><span class="line">        &quot;[concat(&#x27;hidden-related:&#x27;, resourceGroup().id, &#x27;/providers/Microsoft.Web/serverfarms/&#x27;, parameters(&#x27;planname&#x27;))]&quot;: &quot;Resource&quot;,</span><br><span class="line">        &quot;displayName&quot;: &quot;[parameters(&#x27;appname&#x27;)]&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;dependsOn&quot;: [</span><br><span class="line">        &quot;[resourceId(&#x27;Microsoft.Web/serverfarms&#x27;, parameters(&#x27;planname&#x27;))]&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;[parameters(&#x27;appname&#x27;)]&quot;,</span><br><span class="line">        &quot;serverFarmId&quot;: &quot;[resourceId(&#x27;Microsoft.Web/serverfarms&#x27;, parameters(&#x27;planname&#x27;))]&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;outputs&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="DEMO-Linked-Template"><a href="#DEMO-Linked-Template" class="headerlink" title="DEMO: Linked Template"></a>DEMO: Linked Template</h1><p>In this demonstration, I want to show you how to use linked templates. That’s how you can separate resources into separate template files to make management easier and to reuse resources and deployments. This is a little bit of a contrived example but what I’m going to do is separate out the app plan resource from the app service deployment. </p>
<p>First of all, create a new file that I will save as appsplandeploy.json and start with the ARM template boilerplate structure. Then move the plan name parameter along with the plan resource from the existing template file to the new one. </p>
<p>In the appsplandeploy template, I will need to define an output parameter that will pass the planname to the parent or calling template. That output parameter will be the plan name and will be of type String and the value is simply going to be the parameter planname that is being passed in. </p>
<p>I’m going to create a new file for my web app deployment called websitedeploy. This will be the parent or master template. It will just be the content from the original template, so yes I could have just renamed the file.</p>
<p>We can see here that we already have some issues with our missing parameter and service plan, so I will need to add a link to the appsplandeploy template, and I will do that by creating a nested resource. </p>
<p>While link and nested might not be intuitive, I guess that is exactly what we are doing; we are nesting this linked resource within our main resource template. One thing to be aware of is that the template file cannot be accessed locally, you must have that file accessible by HTTP, which means storing it somewhere on the Internet, and in my case, I’ve created container storage where I will upload that template file to. I’ll just upload that file to my storage container templates inside the howarmtemplate storage account. I’ll grab the link to the file and I will paste it into the URI property of the template link section. Obviously the other issue we need to address is the now redundant planname parameter and we do that by using a reference function to reference the output value from our linked template. So the reference name is the name of my linked template resource. I’ll just change the name of that resource from nested deployment to linkedTemplate. </p>
<p>We reference our outputs with the word outputs, then it picks up the name of the output, which is planname, and then we want to use the keyword value to get its value.</p>
<p>We no longer need the dependsOn section, so I will get rid of that. Another thing you need to be aware of is that the reference function does not work as a parameter within another function, that is, you cannot nest it with another function. Replacing the planname parameters within the linked template reference inside the concat function will throw a template error.</p>
<p>One thing I forgot to mention was that in the app service plan template as it is being linked from our website deploy template we will not be prompted for our plan name parameter. Just for the purposes of demonstration, and it is definitely not best practice, I will use the default parameter to specify a plan name. Later on we will look at a much better option. I’ll just save appsplandeploy and refresh it to my blob storage. Before we continue I’ll demonstrate how that reference function within the concat function will give an invalid template error by running a Test-Az- ResourceGroupDeployment. Here we have the invalid template error’s telling us there is a problem at line 30 column 9 and the function reference is not expected at this location. Line 30 column 9 isn’t really accurate but the closest reference we have to that is within the tags property, but I know this to be the case and I will change it and we will retest. Having changed that tag property it passes the test deployment so I can now deploy for real using the new-azresourcegroupdeployment command. Going back to the portal and into deployments of the resource group, we can see the link template and the website deploy are both in action. If we go and have a look at the link template deployment and in outputs we can see the plan name output value and obviously that is also the input for the website deploy deployment.</p>
<p>Let’s recap what’s gone on here. We started with a resource template that had an app service plan and a website. Then we took the app service plan and we put it in another template file; this is called a linked or nested template. The app service plan template file is linked to the master template using a deployments resource. Values are passed from the master into the linked template with parameters, and values generated in the linked template can be passed back to the master with outputs. Input parameters take the same format as we’ve already seen, while outputs are analogous to return values of a programming function. Linked or nested templates must be stored on-line and referenced with a URL. Template deployments can be tested with the Azure CLI test-azresourcegroupdeployment command, taking the resource group and template file as parameters. Once successfully tested a template can be deployed to Azure with the new-azresourcegroupdeployment command.</p>
<h1 id="DEMO-Parameter-Template"><a href="#DEMO-Parameter-Template" class="headerlink" title="DEMO: Parameter Template"></a>DEMO: Parameter Template</h1><p>Obviously, using a default parameter in our linked template, which is essentially the same as hard coding, the value is completely unacceptable and almost pointless. Before I show you how to use a parameter file to dynamically change parameters, I’ll just delete the web app and plan. Let’s go back to visual studio code and create a new JSON file called deploy parameters, and from the autocomplete, I will choose the parameter template. We just need the app name and plan name parameters with values inside the parameter template and add the plan name parameter to the website deploy template. </p>
<p>With the parameters set up I’ll save and close the the template file, and go back to appsplandeploy.json and add the plan name parameter to the website deploy template. The plan name parameter in this template, website deploy is where the plan name comes in from externally. Then we will pass it to the linked or nested template via a parameter within the linked template resource below.</p>
<p>Now in the parameters section of the linked template resource I will just add the plan name parameter and pass it the parameters planname value. This is a completely ridiculous and circular scenario in reality as the plan name parameter is being passed to the link template and then subsequently retrieved through the outputs value. But this is just to give you an idea of how to use parameters in linked templates using the previous example. Now, to deploy the resources, we’ve got the parameters in a file. That file will be passed as a parameter to the new-azresourcegroupdeployment command. The parameter values get pulled out of the JSON file and matched by name to the parameters defined in the ARM template file. Those parameters, can in turn be passed to linked or nested templates, by matching on name.</p>
<p>Let’s switch over to the PowerShell command prompt. First I’ll test the deployment, specifying the resource group name, the ARM template file, and the parameters file. Okay having successfully tested that I will now redeploy by executing the new resource group deployment command with the template parameter. We can see in the PowerShell CLI and the portal that it has successfully executed.</p>
<h1 id="DEMO-Database-Deployment"><a href="#DEMO-Database-Deployment" class="headerlink" title="DEMO: Database Deployment"></a>DEMO: Database Deployment</h1><p>As I’ve said the demos so far have been a little contrived. Now I want to show you a few of the more advanced features of ARM templates like the use of user-defined functions and how to create multiple instances of a resource type using something that could be called a looping mechanism. We will then deploy that template via a PowerShell script which will involve creating a new resource group and then submitting the template parameters using a template object. Let’s begin by creating a new template. I’m going to call it arm deploy and once again that will be a resource group template. In terms of resources, we are going to need a database server and then obviously some databases to run on that server. From the ARM template autocomplete I’ll select arm-sql-server and then arm-sql-db for my resources.</p>
<p>For parameters, I will need a server name and because I am creating more than one database I’m going to need a parameter that lets me tell the template how I databases I want. I will call that dbcount. Because we are accessing Azure SQL I will also need to provide an IP address for the database firewall. That will be startip and endip to define the IP address range. In terms of naming the databases, I’m going to call them test_db and that name will have a number appended to it, and also define an admin name and password. I’m defining these as variables to demonstrate the variable use, but you could just as well pass them in as parameters. I’ll replace SqlServer1 with the servername parameter, which will have to be changed in several places. I’ll also replace the administrator login and password with my variables. Next, I’ll replace the firewall start IP and end IP addresses with the corresponding parameters.</p>
<p>When it comes to the database name this is where it all gets a little bit interesting. So the database name is made up of the server name&#x2F;followed by the database name so the first thing I’m going to have to do is concatenate my server name parameter with the database name. But of course, the database name is a compound of the DB prefix variable plus the database number. To make up this compound name I’m going to define a function that will return the name. Let’s go into the functions section and we’ll look for arm-user, which is for user-defined function. I’ll give my function a name of databasename, and like all functions it takes parameters. This is where the auto complete doesn’t fully meet expectations. The function section has to have a namespace property and all functions have to be defined within a members section of the functions section. I’ll need a parameter for my database name prefix and I will need an integer parameter for the number that will be appended to the name. The return value or output is a string and it is a concatenation of name prefix and index, which I’ll join together with the built-in conact function. Going back to the database name I will use the databasename function firstly by starting with the namespace and the function name. Then I will use the DB prefix variable as my first parameter and then a built-in function called copy index. I guess you could say copyindex is a little bit like the index of a for loop, although we have yet to tell the database template to make copies. I’ll just replace the SqlServer1 text with the server name parameter in the depends on section for my database, as obviously, a database does depend on a database server. Now I’ll add the copy section. So it has a name and it has a count and that count is the number of copies to make and I will get that from my dbcount parameter. I’ll just replace the display name and tags with my compound database name.</p>
<p>Now that we are done with the template let’s move on to the PowerShell script. So this is going to be called dbarmdeploy.ps1 and Visual Studio Code recognizes the file extension and that I’m working with a PowerShell script and it is doing a nice job of syntax highlighting for me. So I’ll start by declaring a resource group variable and I will give it a name and a location. The location is the Azure abbreviation for the West US region. Next, I want to issue the command to create a new resource group. So that’s New-AzResourceGroup with a name and the location, which is the location element of the resource group variable. Next, I’m going to create a compound template variable which will have the name of my template as file name and nested within it the parameters that I want to submit. So that will be server name dbcount, startip and endip. I’ll create a new deployment with New-AzResourceGroupDeployment and use the resource group variable to get the ResourceGroupName parameter. Then the template variable to get the file name for -TemplateFile and then the template parameters object will be for the -TemplateParameterObject parameter, my word that’s a mouthful of parameters. Just in case that wasn’t clear, the TemplateParameterObject is a compound parameter, whereas the other parameters are strings. Right, let’s save that and go to the PowerShell command prompt, and run the script. Straightaway we can see the resource group has been created so that’s a good start, and if we pop over to the portal we can see that the deployment is running. If I open up an Azure SDK command prompt I can issue a deployment group list command to see which deployments are running for my resource group. At the top, I can see the name of the deployment is armdeploy so using that I can issue and az deployment group show command with my resource group and then the name of the deployment. This will also return all the details of the deployment plus the provisioning state at the bottom which is currently showing it as running.</p>
<p>Okay, the server has been deployed and Azure resource manager has accepted the database deployments. Going back to the PowerShell window we can see that the whole deployment has finished successfully and it returns our input parameters. I’ll just open up SQL Server management and log into the database server and check out my to test databases. Finally, I will remove the resource group with the force parameter so I’m not prompted.</p>
<h1 id="Deploying-with-a-Script"><a href="#Deploying-with-a-Script" class="headerlink" title="Deploying with a Script"></a>Deploying with a Script</h1><p>As I said at the beginning of this course in the architecture section, Azure Resource Manager accepts commands from PowerShell and the Azure CLI. In a way, templates are a little bit like the portal in terms of providing an alternative interface. Everything that you can do with a template you can do with a script. Here is an example of what a script might look like for creating a resource group in an Azure SQL server with firewall rules and a database. In some ways, this does seem more concise and easy to understand what exactly is going on here, but in one crucial respect, templates have an advantage over scripts when it comes to deployment mode.</p>
<p>Azure Resource Manager has two deployment modes; the default, which is incremental, means that whatever is in your deployment is added to your resource group, whereas complete says the resource group will become whatever is in your deployment. This essentially means that the resource group is cleaned out before the deployment is applied or all resources that are not in your deployment are removed from the resource group.</p>
<h1 id="Course-Summary"><a href="#Course-Summary" class="headerlink" title="Course Summary"></a>Course Summary</h1><p>Let’s recap what we have learned about Azure Resource Manager. It’s not the Azure portal. It’s the behind-the-scenes process that’s mostly involved with managing the deployment of resources in the Azure cloud. There are multiple interfaces for interacting with Azure Resource Manager apart from the graphical interface of the portal.</p>
<p>You can issue commands through PowerShell and the Azure CLI, but the preferred method is to use ARM templates. Azure Resource Manager templates are JSON files with sections that allow you to specify parameters, variables, functions, and resources. There is also an outputs section so you can pass values from one template to another.</p>
<p>A template can specify multiple resources, and multiple resources can be specified in multiple template files that are linked to a master template deployment file. Visual Studio Code has an IntelliSense extension for creating ARM templates. This extension has auto-complete and syntax checking and greatly simplifies the creation of templates.</p>
<p>As well as defining your own functions, there are many built-in functions to work with strings, arrays, logical comparisons, and Azure resources. Once a template has been defined, it can be tested with the Test-AzResourceGroupDeployment command. The template can then be deployed to Azure using the New-AzResourceGroupDeployment command. Both of these commands can be actioned either through PowerShell or the Azure CLI.</p>
<p>When a deployment is in progress you can monitor it through the portal or by using the Az group deployment list and show commands. You don’t have to create your template from scratch. You can download deployments as templates that you have created previously through the portal. This reaffirms the architecture of the portal as an interface to the Azure Resource Manager.</p>
<p>There is also a marketplace of Quickstart templates that you can use as-is, or download and modify. ARM templates simplify deployment by taking care of dependency management and orchestration. Unlike deploying resources with a script, you don’t have to worry about the order you define your resources in. Testing a deployment will let you know if dependencies are missing, and if you deploy without testing either the whole template is successful or none of it succeeds. You won’t end up in a situation with half of your resources deployed due to missing dependencies.</p>
<p>When a new resource or service becomes available on Azure often deploying an instance is only available using ARM templates and commands. Quite often a resource is released and there may be some time before the portal is updated to support it. But the main reason to become familiar and experienced with Azure Resource Manager is that it is by far the easiest method to ensure that your deployments are consistent and repeatable. This is of particular importance when deploying infrastructure as code through a DevOps pipeline.</p>
<h1 id="1Course-Introduction"><a href="#1Course-Introduction" class="headerlink" title="1Course Introduction"></a>1<strong>Course Introduction</strong></h1><p><a target="_blank" rel="noopener" href="https://github.com/cloudacademy/intro-to-arm">Github Repo</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Azure-Virtual-Machine-Basic-Challenge-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-104-Azure-Virtual-Machine-Basic-Challenge-15/" class="post-title-link" itemprop="url">AZ-104-Azure-Virtual-Machine-Basic-Challenge-15</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:03" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:03-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:47:38" itemprop="dateModified" datetime="2022-11-22T11:47:38-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Azure-Virtual-Machine-Basic-Challenge-15/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Azure-Virtual-Machine-Basic-Challenge-15/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/70/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/70/">70</a><span class="page-number current">71</span><a class="page-number" href="/page/72/">72</a><span class="space">&hellip;</span><a class="page-number" href="/page/274/">274</a><a class="extend next" rel="next" href="/page/72/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
