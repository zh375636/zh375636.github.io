<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hang&#39;s Blog">
<meta property="og:url" content="https://example.com/page/90/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/page/90/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">zutuanxue-部署高可用集群</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:54" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:54-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:59:12" itemprop="dateModified" datetime="2022-11-28T09:59:12-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Web%E5%A4%A7%E5%B9%B6%E5%8F%91%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Web%E5%A4%A7%E5%B9%B6%E5%8F%91%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">zutuanxue-Web大并发集群部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:52" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:52-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:59:22" itemprop="dateModified" datetime="2022-11-28T09:59:22-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Web%E5%A4%A7%E5%B9%B6%E5%8F%91%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Web%E5%A4%A7%E5%B9%B6%E5%8F%91%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7-Prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7-Prometheus/" class="post-title-link" itemprop="url">zutuanxue-容器监控-Prometheus</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:51" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:51-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:59:32" itemprop="dateModified" datetime="2022-11-28T09:59:32-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7-Prometheus/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7-Prometheus/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-Zabbix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-Zabbix/" class="post-title-link" itemprop="url">zutuanxue-企业级监控系统-Zabbix</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:48" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:48-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:59:44" itemprop="dateModified" datetime="2022-11-28T09:59:44-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-Zabbix/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F-Zabbix/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Shell%E8%84%9A%E6%9C%AC%E9%AB%98%E6%89%8B%E9%80%9F%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Shell%E8%84%9A%E6%9C%AC%E9%AB%98%E6%89%8B%E9%80%9F%E6%88%90/" class="post-title-link" itemprop="url">zutuanxue-Shell脚本高手速成</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:46" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:46-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:59:54" itemprop="dateModified" datetime="2022-11-28T09:59:54-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Shell%E8%84%9A%E6%9C%AC%E9%AB%98%E6%89%8B%E9%80%9F%E6%88%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Shell%E8%84%9A%E6%9C%AC%E9%AB%98%E6%89%8B%E9%80%9F%E6%88%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Tomcat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Tomcat/" class="post-title-link" itemprop="url">zutuanxue-Web服务器-Tomcat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:45" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:45-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 10:00:04" itemprop="dateModified" datetime="2022-11-28T10:00:04-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Tomcat/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Tomcat/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Nginx/" class="post-title-link" itemprop="url">zutuanxue-Web服务器-Nginx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:43" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:43-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 10:00:16" itemprop="dateModified" datetime="2022-11-28T10:00:16-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Nginx/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Nginx/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Apache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Apache/" class="post-title-link" itemprop="url">zutuanxue-Web服务器-Apache</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:41" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:41-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 10:00:26" itemprop="dateModified" datetime="2022-11-28T10:00:26-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Apache/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Apache/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">zutuanxue-Linux常用服务部署实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:39" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:39-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:57:18" itemprop="dateModified" datetime="2022-11-28T09:57:18-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DHCP服务"><a href="#DHCP服务" class="headerlink" title="DHCP服务"></a>DHCP服务</h1><p> 阅读 (225935) </p>
<p> 分享</p>
<h2 id="一、DHCP介绍"><a href="#一、DHCP介绍" class="headerlink" title="一、DHCP介绍"></a>一、DHCP介绍</h2><p>在LAN(局域网)中我们常会遇到以下的情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）不知道如何配置IP地址及相关信息的员工，无法上网；</span><br><span class="line"></span><br><span class="line">2）IP地址配置冲突，无法上网；</span><br><span class="line"></span><br><span class="line">3）来访用户因不熟悉公司网络情况无法上网；</span><br></pre></td></tr></table></figure>

<p>以上这些情况都是日常最常见也是最无脑的工作，公司网络管理员需要不停的去帮忙去解决这些问题，以此来保障公司网络的正常使用及员工的正常用网需求。而这些工作对于网络管理员来说实在是太低级、太无脑、太繁琐了，会消耗网络管理员的大量工作时间，也会影响公司员工的工作效能。那么如何通过其他的方法让计算机就能直接解决了上述问题，从而解放网络管理员呢？DHCP就是一个不二的选择。</p>
<p>DHCP(Dynamic Host Configuration Protocol，动态主机配置协议),通常被应用在局域网络环境中，主要作用是集中的管理、分配IP地址，使网络环境中的主机动态的获得IP地址、Gateway地址、DNS服务器地址等信息，并能够提升地址的使用率。由于DHCP是一个UDP协议，所以运行起来更加高效。</p>
<p>DHCP协议采用客户端&#x2F;服务器模型(C&#x2F;S模型)，服务端可以为客户端提供IP、掩码、网关、主机名、DNS等信息。客户端只需将IP获得方式设置为自动获取即可。</p>
<p>目前可以提供DHCP服务的设备有很多，比如:</p>
<ul>
<li>DHCP服务器(windows server、linux)</li>
<li>硬件路由器</li>
<li>家用宽带路由</li>
</ul>
<h2 id="二、DHCP应用场景"><a href="#二、DHCP应用场景" class="headerlink" title="二、DHCP应用场景"></a>二、DHCP应用场景</h2><p>1）公司局域网环境</p>
<p>2）家庭局域网环境</p>
<p>3）公共场合的wifi环境</p>
<p>4）宽带环境网络</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用DHCP的优点：</span><br><span class="line"></span><br><span class="line">1）傻瓜式接入：用户只需懂得插网线到电脑，或者输入WiFi密码接入网络即可实现联网</span><br><span class="line"></span><br><span class="line">2）IP高效利用：及时回收IP机制，保证IP的高利用性，特别是对IP不足的网络</span><br><span class="line"></span><br><span class="line">3）避免IP冲突：避免IP冲突，保证网络的高效利用，保证公司员工及临时人员高效工作</span><br><span class="line"></span><br><span class="line">4）降低了公司网络管理员的工作量，提升了工作效率</span><br></pre></td></tr></table></figure>

<h2 id="三、DHCP工作原理"><a href="#三、DHCP工作原理" class="headerlink" title="三、DHCP工作原理"></a>三、DHCP工作原理</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602997688363.png" alt="image20200113193556339.png"></p>
<h3 id="3-1）工作方式"><a href="#3-1）工作方式" class="headerlink" title="3.1）工作方式"></a>3.1）工作方式</h3><p>IP获得需要通过发广播来实现客户端和服务器的通信，所以DHCP只能工作在局域网。</p>
<h3 id="3-2）工作原理解析"><a href="#3-2）工作原理解析" class="headerlink" title="3.2）工作原理解析"></a>3.2）工作原理解析</h3><p>1、Client：向网络中发送广播，通过自己的UDP协议的68号端口向网络中发送DHCP Discover包，用来寻找网络中的DHCP Server.类似于你在你的公司大喊一声:”谁是公司老板”一样的道理。</p>
<p>2、Server：局域网中的所有DHCP服务器都能收到该Client发送的广播包，然后DHCP Server会检查自己的IP池中(也叫做作用域)是否还有可用IP可以分发。如果有的话，会直接将这个IP地址从池中拿出来，避免在发给别的客户端，并且通过自己的UDP协议的67号端口给Client发一个响应包DHCP Offer,同样通信是采用广播的方式，明确告诉其可以提供哪个IP给Client使用。类似于公司的几个老板都在公司喊了一声：“我是X老板，我有时间在哪个办公室接待你”。</p>
<p>3、Client：Client会收到局域网中的所有DHCP服务器发给自己的DHCP Offer包，默认选一个最优的DHCP Server进行IP获取（在这里就是第一个发送给他DHCP Offer的服务器算作最优）。然后继续向网络中通过UDP的68号端口发广播DHCP Resquest，明确指定DHCP Server IP地址和需要租用的IP地址,告诉它要从他这里获得IP信息。自然其他DHCP Server也能收到广播，确认不从自己这里拿IP信息后，会将上步从IP池中拿出来的IP在释放到池中，以便别人使用。类似于你在公司大喊一声：“李老板，我找你接待”，那么其他老板刚才计划接待你的时间就会被释放出来，用于接待别的客户。</p>
<p>4、Server：被确认的DHCP Server就会通过其UDP协议的67号端口发送DHCP ACK确认包，采用广播将IP、掩码、网关、DNS等信息还有IP租约一起发送给DHCP Client，Client确认IP可用后，根据IP租约开始计算使用时间。类似于李老板把你请进他的办公室，开始和你聊天，并计算聊天时间为30分钟，开始倒计时。</p>
<h3 id="3-3-计算机获得IP的时间点"><a href="#3-3-计算机获得IP的时间点" class="headerlink" title="3.3)计算机获得IP的时间点"></a>3.3)计算机获得IP的时间点</h3><p>a、计算机开机</p>
<p>b、网卡接通网络</p>
<p>c、重启网卡服务</p>
<h3 id="3-4）租约更新阶段"><a href="#3-4）租约更新阶段" class="headerlink" title="3.4）租约更新阶段"></a>3.4）租约更新阶段</h3><p>a、租约完成1&#x2F;2</p>
<p>b、租约完成7&#x2F;8</p>
<p>c、租约到期</p>
<h2 id="四、DHCP服务器部署"><a href="#四、DHCP服务器部署" class="headerlink" title="四、DHCP服务器部署"></a>四、DHCP服务器部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，计算机名称:localhost.localdomain,IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<h3 id="4-1）DHCP安装"><a href="#4-1）DHCP安装" class="headerlink" title="4.1）DHCP安装"></a>4.1）DHCP安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf -y install dhcp-server</span><br></pre></td></tr></table></figure>

<h3 id="4-2）DHCP配置文件详解"><a href="#4-2）DHCP配置文件详解" class="headerlink" title="4.2）DHCP配置文件详解"></a>4.2）DHCP配置文件详解</h3><p>默认情况下，dhcp服务并没有提供配置文件，只是给提供了一个demo,存放在&#x2F;usr&#x2F;share&#x2F;doc&#x2F;dhcp-server&#x2F;目录下.我们将demo文件拷贝到&#x2F;etc&#x2F;dhcp目录下，并且命名为dhcpd.conf。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cp /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf </span><br><span class="line">cp：是否覆盖&quot;/etc/dhcp/dhcpd.conf&quot; y</span><br></pre></td></tr></table></figure>

<p>配置文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line"># #号代表注释</span><br><span class="line"># DHCP服务配置文件分为全局配置和作用域配置，很好区分：subnet的就是作用域 不在subnet里面的就是全局设置。</span><br><span class="line"># dhcpd.conf</span><br><span class="line">#</span><br><span class="line"># Sample configuration file for ISC dhcpd</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#DNS全局选项，指定DNS服务器的地址，可以是IP，也可以是域名。</span><br><span class="line"># option definitions common to all supported networks...</span><br><span class="line"># DNS的域名</span><br><span class="line">option domain-name &quot;example.org&quot;;</span><br><span class="line"></span><br><span class="line">#具体的DNS服务器</span><br><span class="line">option domain-name-servers ns1.example.org, ns2.example.org;</span><br><span class="line"></span><br><span class="line">#默认租约为600s</span><br><span class="line">default-lease-time 600;</span><br><span class="line">#最大租约为7200s，客户机会在default-lease-time快到期时向服务器续租，如果此时客户机死机/重启，而默认租约时间到期了，服务器并不会立即回收IP地址，而是等到最大租约时间到期，客户机还没有过来续约，才会回收IP地址。</span><br><span class="line">max-lease-time 7200;</span><br><span class="line"></span><br><span class="line">#动态DNS更新方式(none:不支持；interim:互动更新模式；ad-hoc:特殊更新模式)</span><br><span class="line"># Use this to enble / disable dynamic dns updates globally.</span><br><span class="line">#ddns-update-style none;</span><br><span class="line"></span><br><span class="line">#如果该DHCP服务器是本地官方DHCP就将此选项打开，避免其他DHCP服务器的干扰。</span><br><span class="line">#当一个客户端试图获得一个不是该DHCP服务器分配的IP信息，DHCP将发送一个拒绝消息，而不会等待请求超时。当请求被拒绝，客户端会重新向当前DHCP发送IP请求获得新地址。保证IP是自己发出去的</span><br><span class="line">#</span><br><span class="line"># If this DHCP server is the official DHCP server for the local</span><br><span class="line"># network, the authoritative directive should be uncommented.</span><br><span class="line">#authoritative;</span><br><span class="line"></span><br><span class="line"># Use this to send dhcp log messages to a different log file (you also</span><br><span class="line"># have to hack syslog.conf to complete the redirection).</span><br><span class="line"># 日志级别</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line"># No service will be given on this subnet, but declaring it helps the </span><br><span class="line"># DHCP server to understand the network topology.</span><br><span class="line"></span><br><span class="line">#作用域相关设置指令</span><br><span class="line">#subnet 定义一个作用域</span><br><span class="line">#netmask 定义作用域的掩码</span><br><span class="line">#range 允许发放的IP范围</span><br><span class="line">#option routers 指定网关地址</span><br><span class="line">#option domain-name-servers 指定DNS服务器地址</span><br><span class="line">#option broadcast-address 广播地址</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#案例:定义一个作用域 网段为10.152.187.0 掩码为255.255.255.0</span><br><span class="line">#此作用域不提供任何服务</span><br><span class="line">subnet 10.152.187.0 netmask 255.255.255.0 &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># This is a very basic subnet declaration.</span><br><span class="line"></span><br><span class="line">#案例:定义一个基本的作用域</span><br><span class="line">#网段10.254.239.0 掩码255.255.255.224</span><br><span class="line">#分发范围10.254.239.10-20</span><br><span class="line">#网关为rtr-239-0-1.example.org, rtr-239-0-2.example.org</span><br><span class="line">subnet 10.254.239.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.254.239.10 10.254.239.20;</span><br><span class="line">  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># This declaration allows BOOTP clients to get dynamic addresses,</span><br><span class="line"># which we don&#x27;t really recommend.</span><br><span class="line">#案例:允许采用bootp协议的客户端动态获得地址</span><br><span class="line">#bootp DHCP的前身</span><br><span class="line">#BOOTP用于无盘工作站的局域网中，可以让无盘工作站从一个中心服务器上获得IP地址。通过BOOTP协议可以为局域网中的无盘工作站分配动态IP地址，</span><br><span class="line">#这样就不需要管理员去为每个用户去设置静态IP地址。</span><br><span class="line">subnet 10.254.239.32 netmask 255.255.255.224 &#123;</span><br><span class="line">  range dynamic-bootp 10.254.239.40 10.254.239.60;</span><br><span class="line">  option broadcast-address 10.254.239.31;</span><br><span class="line">  option routers rtr-239-32-1.example.org;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例:一个简单的作用域案例</span><br><span class="line"># A slightly different configuration for an internal subnet.</span><br><span class="line">subnet 10.5.5.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.5.5.26 10.5.5.30;</span><br><span class="line">  option domain-name-servers ns1.internal.example.org;</span><br><span class="line">  option domain-name &quot;internal.example.org&quot;;</span><br><span class="line">  option routers 10.5.5.1;</span><br><span class="line">  option broadcast-address 10.5.5.31;</span><br><span class="line">  default-lease-time 600;</span><br><span class="line">  max-lease-time 7200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Hosts which require special configuration options can be listed in</span><br><span class="line"># host statements.   If no address is specified, the address will be</span><br><span class="line"># allocated dynamically (if possible), but the host-specific information</span><br><span class="line"># will still come from the host declaration.</span><br><span class="line">#</span><br><span class="line">#保留地址:可以将指定的IP分发给指定的机器，根据网卡的MAC地址来做触发</span><br><span class="line">#host: 启用保留。</span><br><span class="line">#hardware:指定客户端的mac地址</span><br><span class="line">#filename:指定文件名</span><br><span class="line">#server-name:指定下一跳服务器地址</span><br><span class="line">#fixed-address: 指定保留IP地址</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#案例:这个案例中分发给客户端的不是IP地址信息，而是告诉客户端去找toccata.fugue.com服务器，并且下载vmunix.passacaglia文件</span><br><span class="line">host passacaglia &#123;</span><br><span class="line">  hardware ethernet 0:0:c0:5d:bd:95;</span><br><span class="line">  filename &quot;vmunix.passacaglia&quot;;</span><br><span class="line">  server-name &quot;toccata.fugue.com&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Fixed IP addresses can also be specified for hosts.   These addresses</span><br><span class="line"># should not also be listed as being available for dynamic assignment.</span><br><span class="line"># Hosts for which fixed IP addresses have been specified can boot using</span><br><span class="line"># BOOTP or DHCP.   Hosts for which no fixed address is specified can only</span><br><span class="line"># be booted with DHCP, unless there is an address range on the subnet</span><br><span class="line"># to which a BOOTP client is connected which has the dynamic-bootp flag</span><br><span class="line"># set.</span><br><span class="line"># 案例:保留地址，将指定IP(fantasia.fugue.com对应的IP)分给指定客户端网卡(MAC:08:00:07:26:c0:a5)</span><br><span class="line">host fantasia &#123;</span><br><span class="line">  hardware ethernet 08:00:07:26:c0:a5;</span><br><span class="line">  fixed-address fantasia.fugue.com;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#超级作用域</span><br><span class="line">#超级作用域是DHCP服务中的一种管理功能，使用超级作用域，可以将多个作用域组合为单个管理实体。</span><br><span class="line"># You can declare a class of clients and then do address allocation</span><br><span class="line"># based on that.   The example below shows a case where all clients</span><br><span class="line"># in a certain class get addresses on the 10.17.224/24 subnet, and all</span><br><span class="line"># other clients get addresses on the 10.0.29/24 subnet.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#在局域网中，可以配置策略根据各个机器的具体信息分配IP地址和其他的网络参数，客户机的具体信息：客户机能够给dhcp服务提供的信息由有两个，</span><br><span class="line">#第一个就是网卡的dhcp-client-identifier（mac地址），</span><br><span class="line">#第二个就是设备的vendor-class-identifier。</span><br><span class="line">#管理员可以根据这两个信息给不同的机器分组。</span><br><span class="line"></span><br><span class="line">#案例:</span><br><span class="line">#按client某种类型分组DHCP,而不是按物理接口网段</span><br><span class="line">#例子: SUNW 分配地址段10.17.224.0/24</span><br><span class="line"># 非SUNW的主机,分配地址段10.0.29.0/24</span><br><span class="line">#定义一个dhcp类:foo</span><br><span class="line">#request广播中vendor-class-identifier字段对应的值前四个字节如果是&quot;SUNW&quot;,则视合法客户端.</span><br><span class="line">class &quot;foo&quot; &#123;</span><br><span class="line">  match if substring (option vendor-class-identifier, 0, 4) = &quot;SUNW&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#定义一个超级作用域: 224-29</span><br><span class="line">shared-network 224-29 &#123;</span><br><span class="line">#定义第一个作用域</span><br><span class="line">  subnet 10.17.224.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-224.example.org;</span><br><span class="line">  &#125;</span><br><span class="line">#定义第二个作用域</span><br><span class="line">  subnet 10.0.29.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-29.example.org;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">#关连池,如果客户端匹配foo类，将获得该池地址</span><br><span class="line">  pool &#123;</span><br><span class="line">    allow members of &quot;foo&quot;;</span><br><span class="line">    range 10.17.224.10 10.17.224.250;</span><br><span class="line">  &#125;</span><br><span class="line">#关连池,如果客户端配置foo类，则拒绝获得该段地址</span><br><span class="line">  pool &#123;</span><br><span class="line">    deny members of &quot;foo&quot;;</span><br><span class="line">    range 10.0.29.10 10.0.29.230;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3）DHCP启动"><a href="#4-3）DHCP启动" class="headerlink" title="4.3）DHCP启动"></a>4.3）DHCP启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl enable dhcpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/dhcpd.service to /usr/lib/systemd/system/dhcpd.service.</span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line"></span><br><span class="line">注意：可能发现无法启动DHCP服务，原因是DHCP在启动的时候检查配置文件，发现并没有有效作用域（和服务器同网段的作用域）。</span><br></pre></td></tr></table></figure>

<h2 id="五、DHCP作用域"><a href="#五、DHCP作用域" class="headerlink" title="五、DHCP作用域"></a>五、DHCP作用域</h2><p><strong>教学案例一、配置一个作用域，用于为本地局域网中的计算机发放IP信息。要求：</strong></p>
<p>本地网段:192.168.11.0&#x2F;24</p>
<p>发放IP地址：192.168.11.153–252</p>
<p>网关：192.168.11.254</p>
<p>DNS1：202.106.0.20</p>
<p>DNS2：114.114.114.114</p>
<p>默认租约为两个小时</p>
<p>最大租约为3个小时</p>
<p><strong>本DHCP服务器为本地权威DHCP，要求可以本地所有计算机获得IP都是由本DHCP发放</strong></p>
<h3 id="5-1-DHCP服务配置"><a href="#5-1-DHCP服务配置" class="headerlink" title="5.1)DHCP服务配置"></a>5.1)DHCP服务配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue dhcp]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">#声明DNS服务器</span><br><span class="line">default-lease-time 7200;  #定义默认租约时间</span><br><span class="line">max-lease-time 10800;		#定义最大租约时间</span><br><span class="line">authoritative;	#拒绝不正确的IP地址的要求</span><br><span class="line">log-facility local7;	#定义日志</span><br><span class="line"></span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 192.168.11.153 192.168.11.252;</span><br><span class="line">  option routers 192.168.11.254;</span><br><span class="line">  option broadcast-address 192.168.11.255;</span><br><span class="line">  default-lease-time 7200;</span><br><span class="line">  max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">请根据4.2中的讲解理解配置文件内容。</span><br></pre></td></tr></table></figure>

<h3 id="5-2）重启DHCP服务，生效配置"><a href="#5-2）重启DHCP服务，生效配置" class="headerlink" title="5.2）重启DHCP服务，生效配置"></a>5.2）重启DHCP服务，生效配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#重启dhcpd服务</span><br><span class="line">[root@zutuanxue dhcp]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">#查看启动情况，同时也验证了客户端使用的是68端口，服务端使用的是67端口</span><br><span class="line">[root@zutuanxue dhcp]# lsof -i :68</span><br><span class="line">COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dhclient 55234 root    6u  IPv4 110700      0t0  UDP *:bootpc </span><br><span class="line">[root@zutuanxue dhcp]# lsof -i :67</span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq  1507 nobody    3u  IPv4  27149      0t0  UDP *:bootps </span><br><span class="line">dhcpd   56570  dhcpd    7u  IPv4 129157      0t0  UDP *:bootps</span><br></pre></td></tr></table></figure>

<h3 id="5-3）测试IP分发"><a href="#5-3）测试IP分发" class="headerlink" title="5.3）测试IP分发"></a>5.3）测试IP分发</h3><p>打开一个客户端机器，IP获得方式为自动获取，测试是否获得到了自己这个DHCP服务器发放的IP地址。本例子中测试机使用了centos 8系统。来看下测试结果吧！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">1) 查看一下当前eth0的IP地址、MAC地址，并保证其IP获得方式为:DHCP</span><br><span class="line">[root@test 桌面]# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:172.16.44.132  Bcast:172.16.44.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:86 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:63 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:15294 (14.9 KiB)  TX bytes:6769 (6.6 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）使用dhclient命令来获得IP，看一下重要输出</span><br><span class="line">[root@test 桌面]# dhclient -d eth0</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 6 (xid=0x316768c3)      发广播寻找DHCP服务器</span><br><span class="line">DHCPOFFER from 192.168.11.16                                                     192.168.11.16DHCP服务器应答</span><br><span class="line">DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x316768c3)                  client向服务器请求IP地址</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x316768c3)                                      确认租赁关系</span><br><span class="line">bound to 192.168.11.156 -- renewal in 2983 seconds.                              client分得IP:192.168.11.156</span><br><span class="line"></span><br><span class="line">注意：看到这些信息后，按CTRL+C退出。</span><br><span class="line">dhclient是一个DHCP协议客户端，它使用DHCP协议或者BOOTP协议或在这两个协议都不可用时使用静态地址来配置一个或多个网络接口</span><br><span class="line">dhclient -r 释放IP地址</span><br><span class="line">dhclient -d 强制dhclient作为前台进程运行。 通常情况下，DHCP客户端将在前台运行,直到配置了一个接口,此时它将恢复为在后</span><br><span class="line">            台运行。               </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3) 服务器日志查看验证获取信息</span><br><span class="line">[root@zutuanxue ~]# tailf /var/log/messages</span><br><span class="line">Feb 21 13:40:44 baism dhcpd: DHCPDISCOVER from 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPOFFER on 192.168.11.156 to 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPREQUEST for 192.168.11.156 (192.168.11.16) from 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPACK on 192.168.11.156 to 00:0c:29:1a:f8:bd via ens33</span><br><span class="line"></span><br><span class="line">4) 在client上通过ifconfig命令再次查看eth0 IP地址，验证是否为192.168.11.156</span><br><span class="line">[root@test 桌面]# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:192.168.11.156  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:97 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:67 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:17364 (16.9 KiB)  TX bytes:7537 (7.3 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5）查看网关，确定网关为192.168.11.254</span><br><span class="line">[root@test 桌面]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.11.0    0.0.0.0         255.255.255.0   U     0      0        0 eth1</span><br><span class="line">192.168.11.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1</span><br><span class="line">0.0.0.0         192.168.11.254  0.0.0.0         UG    0      0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6）查看DNS配置文件，看DNS是否为DHCP服务器发放的DNS服务器IP</span><br><span class="line">[root@test 桌面]# cat /etc/resolv.conf </span><br><span class="line">; generated by /sbin/dhclient-script</span><br><span class="line">nameserver 202.106.0.20</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>

<h3 id="5-4）通过DHCP服务器租约文件查看具体租约"><a href="#5-4）通过DHCP服务器租约文件查看具体租约" class="headerlink" title="5.4）通过DHCP服务器租约文件查看具体租约"></a>5.4）通过DHCP服务器租约文件查看具体租约</h3><p>租约文件的路径: &#x2F;var&#x2F;lib&#x2F;dhcpd&#x2F;dhcpd.leases</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /var/lib/dhcpd/dhcpd.leases</span><br><span class="line"># The format of this file is documented in the dhcpd.leases(5) manual page.</span><br><span class="line"># This lease file was written by isc-dhcp-4.3.6</span><br><span class="line"></span><br><span class="line"># authoring-byte-order entry is generated, DO NOT DELETE</span><br><span class="line">authoring-byte-order little-endian;</span><br><span class="line"></span><br><span class="line">server-duid &quot;\000\001\000\001%\257\376\022\000\014)c.\345&quot;;</span><br><span class="line"></span><br><span class="line">lease 192.168.11.153 &#123;</span><br><span class="line">  starts 2 2020/01/14 04:21:04;	#开始时间</span><br><span class="line">  ends 2 2020/01/14 06:21:04;		#结束时间</span><br><span class="line">  cltt 2 2020/01/14 04:21:04;</span><br><span class="line">  binding state active;</span><br><span class="line">  next binding state free;</span><br><span class="line">  rewind binding state free;</span><br><span class="line">  hardware ethernet 00:0c:29:6d:1c:b3;</span><br><span class="line">  uid &quot;\001\000\014)m\034\263&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：当你发现这里的时间和你的服务器时间不一致的时候，建议你修改时区解决问题，一般是差8个小时，大家明白就好。</span><br></pre></td></tr></table></figure>

<h3 id="5-5）保留IP"><a href="#5-5）保留IP" class="headerlink" title="5.5）保留IP"></a>5.5）保留IP</h3><p>在IP租约到期后，如果无法续订租约，client只能乖乖交出IP地址，重新获得一个其他IP使用。但是在公司有些服务器的IP地址是不能变化的，因为变了用户就无法连接到服务器了，比如公司文件服务器、打印服务器等等。那么在这种环境中我们既想使用DHCP管理公司IP，又想实现部分机器的IP永久不变，那么怎么实现呢。</p>
<p>DHCP的作者在写DHCP的时候也想到了这个问题，提出了保留IP的概念，就是将某些IP保留，然后服务器来获得IP的时候，根据其MAC地址做匹配，将对应的IP分给它即可。</p>
<p><strong>教学案例:希望这个MAC地址为00:0C:29:1A:F8:C7的网卡能永久获得IP 192.168.11.252，实现方式如下:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"> a、在配置文件/etc/dhcp/dhcpd.conf末尾添加以下内容</span><br><span class="line"> host print &#123;         </span><br><span class="line">  hardware ethernet 00:0C:29:1A:F8:C7;</span><br><span class="line">  fixed-address 192.168.11.252;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host print    host为指令，print是个名字，随便起，但是最好有意义，要不过一段你也记不住了。</span><br><span class="line">hardware ethernet 指定以太网网卡MAC地址</span><br><span class="line">fixed-address 指定要绑定的IP</span><br><span class="line"></span><br><span class="line">b、重启DHCP服务</span><br><span class="line">[root@zutuanxue ~]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">c、测试，登陆测试机，释放挡墙IP，重新获得新的IP，查看IP地址是否正确分发</span><br><span class="line">[root@test 桌面]# ifconfig eth1</span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.11.155  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4071 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:187 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:433880 (423.7 KiB)  TX bytes:16888 (16.4 KiB)</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# dhclient -r eth1</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# dhclient -d eth1</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth1 to 255.255.255.255 port 67 interval 4 (xid=0x45c162c2)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth1 to 255.255.255.255 port 67 (xid=0x45c162c2)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x45c162c2)</span><br><span class="line">bound to 192.168.11.252 -- renewal in 2881 seconds.</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# ifconfig eth1</span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.11.252  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4081 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:191 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:436337 (426.1 KiB)  TX bytes:17656 (17.2 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">完美！</span><br></pre></td></tr></table></figure>

<h2 id="六、DHCP超级作用域"><a href="#六、DHCP超级作用域" class="headerlink" title="六、DHCP超级作用域"></a>六、DHCP超级作用域</h2><p>体验了DHCP服务器给大家带来的方便后，我们工作轻松了很多，但是随着时间的推移，突然有这么一个问题急需你解决，由于公司的发展壮大，公司人员数量越来越多，公司一个网段的IP无法满足日常使用，所以又加了一个网段。但是默认情况下，DHCP服务器只能发放和自己网卡在同一网段的IP地址，目前我们DHCP的网卡IP地址为192.168.11.0段，我们新加的网段为192.168.12.0，那么怎么能让DHCP服务器既能发11网段，又能发放12网段呢？学会超级作用域就可以解决这个问题。</p>
<p>超级作用域：将两个或以上的不同网段的作用域合成一个作用域既是超级作用域。</p>
<p><strong>案例:部署一个超级作用域，作用域是192.168.11.0&#x2F;24网段，192.168.12.0&#x2F;24网段。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">a、编辑配置文件</span><br><span class="line">[root@zutuanxue ~]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line">option domain-name-servers 4.2.2.2, 4.2.2.1;</span><br><span class="line"></span><br><span class="line">default-lease-time 28800;</span><br><span class="line">max-lease-time 43200;</span><br><span class="line">#authoritative;</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line">#share-network 部署一个超级作用域</span><br><span class="line">#supper 超级作用域名称，随便起，但是建议有意义。</span><br><span class="line">shared-network supper &#123;</span><br><span class="line">#192.168.11.0作用域</span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">range 192.168.11.150 192.168.11.150;</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">option routers 192.168.11.254;</span><br><span class="line">default-lease-time 7200;</span><br><span class="line">max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#192.168.12.0作用域</span><br><span class="line">subnet 192.168.12.0 netmask 255.255.255.0 &#123;</span><br><span class="line">range 192.168.12.150 192.168.12.150;</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">option routers 192.168.12.254;</span><br><span class="line">default-lease-time 7200;</span><br><span class="line">max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：案例中为了方便验证，我每个作用域只发布一个IP，否者测试无法保证能100%分到两个网段。</span><br><span class="line"></span><br><span class="line">b、重启DHCP服务，生效配置文件</span><br><span class="line">[root@zutuanxue dhcp]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">c、验证</span><br><span class="line">#释放两网卡IP</span><br><span class="line">[root@test 桌面]# dhclient -r eth0</span><br><span class="line">[root@test 桌面]# dhclient -r eth1</span><br><span class="line"></span><br><span class="line">#释放成功</span><br><span class="line">[root@test 桌面]# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:1591 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:162 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:282324 (275.7 KiB)  TX bytes:30619 (29.9 KiB)</span><br><span class="line"></span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4719 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:216 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:559954 (546.8 KiB)  TX bytes:19582 (19.1 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span class="line">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:720 (720.0 b)  TX bytes:720 (720.0 b)</span><br><span class="line"></span><br><span class="line">#分别获取IP地址 </span><br><span class="line">[root@test 桌面]# dhclient -d eth0</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 6 (xid=0x2574199a)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x2574199a)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x2574199a)</span><br><span class="line">bound to 192.168.11.150 -- renewal in 3026 seconds.</span><br><span class="line">^C</span><br><span class="line">#确保都是来自我们实验中的DHCP服务器</span><br><span class="line">[root@test 桌面]# dhclient -d eth1</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth1 to 255.255.255.255 port 67 interval 7 (xid=0x2cebde11)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth1 to 255.255.255.255 port 67 (xid=0x2cebde11)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x2cebde11)</span><br><span class="line">bound to 192.168.12.150 -- renewal in 3102 seconds.</span><br><span class="line"></span><br><span class="line">#确保都是来自我们实验中的DHCP服务器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看IP情况，发现实验成功了，分别获得到了不同网段IP</span><br><span class="line">[root@test 桌面]# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:192.168.11.150  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:1613 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:166 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:287076 (280.3 KiB)  TX bytes:31387 (30.6 KiB)</span><br><span class="line"></span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.12.150  Bcast:192.168.12.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4741 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:220 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:564706 (551.4 KiB)  TX bytes:20350 (19.8 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span class="line">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:720 (720.0 b)  TX bytes:720 (720.0 b)</span><br></pre></td></tr></table></figure>

<h2 id="七、补充"><a href="#七、补充" class="headerlink" title="七、补充"></a>七、补充</h2><h3 id="7-1-如果客户端获得不到-IP会怎么办"><a href="#7-1-如果客户端获得不到-IP会怎么办" class="headerlink" title="7.1) 如果客户端获得不到 IP会怎么办"></a>7.1) 如果客户端获得不到 IP会怎么办</h3><p>当客户端获得不到IP地址，会得到一个169.254开头的临时IP，此IP不能和其他网段通信，但是Client会继续向网络中发DHCP广播，继续坚持不懈申请IP。</p>
<h3 id="7-2）DHCP会面临单机故障，如何解决"><a href="#7-2）DHCP会面临单机故障，如何解决" class="headerlink" title="7.2）DHCP会面临单机故障，如何解决"></a>7.2）DHCP会面临单机故障，如何解决</h3><p>两台设备互相分发对方网段一段IP，将作用域采用8&#x2F;2原则，彼此互相冗余，当一台服务器出现问题，不至于整个网段故障。</p>
<h3 id="7-3）抓包验证方法"><a href="#7-3）抓包验证方法" class="headerlink" title="7.3）抓包验证方法"></a>7.3）抓包验证方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue dhcp]# tcpdump -nn -vvv -s 1500 -i ens33 host 192.168.11.16 and udp port 67 or udp port 68</span><br></pre></td></tr></table></figure>

<h3 id="7-4）如何发放计算机名称"><a href="#7-4）如何发放计算机名称" class="headerlink" title="7.4）如何发放计算机名称"></a>7.4）如何发放计算机名称</h3><p>发放计算机名称只能在保留中完成，要求Client的计算机名配置文件中将对应字段删除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">option domain-name-servers 4.2.2.2, 4.2.2.1;</span><br><span class="line"></span><br><span class="line">default-lease-time 28800;</span><br><span class="line">max-lease-time 43200;</span><br><span class="line">authoritative;</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 192.168.11.153 192.168.11.252;</span><br><span class="line">  option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">  option routers 192.168.11.254;</span><br><span class="line">  option broadcast-address 192.168.11.255;</span><br><span class="line">  default-lease-time 7200;</span><br><span class="line">  max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host print &#123;</span><br><span class="line">  #指定计算机名称</span><br><span class="line">  option host-name &quot;test.hello.com&quot;;</span><br><span class="line">  hardware ethernet 00:0c:29:af:f1:84;</span><br><span class="line">  fixed-address 192.168.11.252;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：请把/etc/hostname 中的计算机名称清除</span><br><span class="line">      /etc/sysconfig/network中的hostname字段清除</span><br></pre></td></tr></table></figure>

<h1 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h1><p> 阅读 (274324) </p>
<p> 分享</p>
<p>DNS：域名系统（英文：Domain Name System)是一个域名系统，是万维网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。类似于生活中的114服务，可以通过人名找到电话号码，也可以通过电话号码找到人名(生活中没有那么准确的原因是人名有重名，而域名是全世界唯一的)。</p>
<p>DNS协议运行在UDP协议之上，使用端口号53</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">域名:</span><br><span class="line">域名是一个网站的逻辑地址，比如www.zutuanxue.com，相比IP地址更加方便人类记忆，所以被广泛使用。</span><br></pre></td></tr></table></figure>

<h2 id="一、DNS介绍"><a href="#一、DNS介绍" class="headerlink" title="一、DNS介绍"></a>一、DNS介绍</h2><p>计算机的发展起源于上世纪60年代，最初只有美国的几所高校在使用，计算机之间通信需要知道对方的地址(IP地址)，但是人们对IP地址的记忆又是不敏感的(就像生活中你能记住多少个好友的手机号码一样)。为了方便人类记忆，大学的科学家们把计算机的名字和对应的IP地址写入到计算机中的hosts文件，以此文件来做解析。</p>
<p>但是随着计算机和网络的发展出现了局域网，计算机的数量随之增加；后来为了解决方便通信问题，我们使用了wins服务器来进行计算机名和IP的注册服务，通过一个名称服务器来自动管理局域网中的计算机，并提供解析服务。人们在局域网中通过计算机名就能连接到了对应的计算机。该技术中要求计算机名称必须唯一，正是由于这个原因使得局域网中的计算机又不能太多。</p>
<p>微型计算机的出现和局域网的发展推动了广域网的发展，hosts文件只能针对极少的计算机网络，wins可以管理局域网的解析。到了广域网，人们就迫切需要一个新的服务做解析服务器，使解析方便、快速、高效的应对广域网环境。为了解决广域网解析问题，美国人研发出了DNS服务，以及成立了管理DNS相关的机构，并提出了域名命名规则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">域名管理机构</span><br><span class="line">Internet 域名与地址管理机构（ICANN）是为承担域名系统管理，IP地址分配，协议参数配置，以及主服务器系统管理等职能而设立的非盈利机构.</span><br><span class="line">现由IANA和其他实体与美国政府约定进行管理。</span><br><span class="line"></span><br><span class="line">域名分国际域名和国内域名两种，对于国际域名而言，其命名规则是：</span><br><span class="line">域名可以由（a-z、A-Z大小写等价）26个英文字母、数字（0-9）以及连接符“-”组成，但是域名的首位必须是字母或数字。对于域名的长度也有一定</span><br><span class="line">的限制：国际通用顶级域名长度不得超过26个字符，中国国家顶级域名长度不得超过20个字符</span><br></pre></td></tr></table></figure>

<h2 id="二、DNS的解析原理"><a href="#二、DNS的解析原理" class="headerlink" title="二、DNS的解析原理"></a>二、DNS的解析原理</h2><p>目前，因特网的命名方法是层次树状结构的方法。采用这种命名方法，任何一个连接在因特网上的主机或设备，都有一个某一的层次结构的名字，即域名(domain name)。域是名字空间中一个可被管理的划分。域可以继续按层次划分为子域，如二级域、三级域等等。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998062358.png" alt="image20200114172132398.png"></p>
<h2 id="三、DNS查询"><a href="#三、DNS查询" class="headerlink" title="三、DNS查询"></a>三、DNS查询</h2><p>递归查询:一般客户机和服务器之间属递归查询，即当客户机向DNS服务器发出请求后,若DNS服务器本身不能解析,则会向另外的DNS服务器发出查询请求，得到结果后转交给客户机；如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那本地 DNS就会扮演DNS客户的角色，去代理原客户去帮忙找根域名服务器发出请求，递归即递给服务器，所有操作都有服务器来完成。</p>
<p>迭代查询:一般DNS服务器之间属迭代查询，如：DNS1问DNS2,DNS2不知道会告诉DNS1一个DNS3的IP地址，让DNS1去问问DNS3知不知道，以此类推，就是迭代查询。</p>
<p>关于递归和迭代举个生活例子帮助大家理解：比如你问张老师一个问题，张老师告诉他答案这之间的叫递归查询。这期间也许张老师也不会，这时张老师问李老师，张老师去问崔老师，这之间的查询叫迭代查询！</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998078641.png" alt="image20200114180942259.png"></p>
<p>正向查找：将域名解析为IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.zutuanxue.com  ---&gt; 118.190.209.153</span><br></pre></td></tr></table></figure>

<p>反向查找：将IP解析为域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">118.290.209.153  ---&gt; www.zutuanxue.com</span><br></pre></td></tr></table></figure>

<h2 id="四、DNS服务器部署"><a href="#四、DNS服务器部署" class="headerlink" title="四、DNS服务器部署"></a>四、DNS服务器部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<h3 id="4-1）DNS安装"><a href="#4-1）DNS安装" class="headerlink" title="4.1）DNS安装"></a>4.1）DNS安装</h3><p>DNS服务是由bind程序提供的，所以要实现DNS服务就需要安装bind程序包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf -y install bind bind-chroot</span><br><span class="line">bind  DNS主程序包</span><br><span class="line">bind-chroot DNS安全包，改变默认DNS根目录，将DNS运行在监牢模式</span><br><span class="line"></span><br><span class="line">说明:chroot监牢模式</span><br><span class="line">监牢是一个软件机制，其功能是使得某个程序无法访问规定区域之外的资源，同样也为了增强安全性（LCTT 译注：chroot “监牢”，所谓“监牢”就是指通过chroot机制来更改某个进程所能看到的根目录，即将某进程限制在指定目录中，保证该进程只能对该目录及其子目录的文件进行操作，从而保证整个服务器的安全）。Bind Chroot DNS 服务器的默认“监牢”为 /var/named/chroot。</span><br></pre></td></tr></table></figure>

<h3 id="4-2）DNS启动"><a href="#4-2）DNS启动" class="headerlink" title="4.2）DNS启动"></a>4.2）DNS启动</h3><p>DNS的守护进程叫做named,DNS是以named用户身份来运行，named用户在安装包的时候会在系统中自动创建。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">CentOS8下安装了bind-chroot之后，若要使用named-chroot.service，则需要关闭named.service。两者只能运行一个</span><br><span class="line"></span><br><span class="line">方法一: 不使用chroot模式启动DNS</span><br><span class="line">开启开机启动</span><br><span class="line">[root@zutuanxue ~]# systemctl enable named</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named.service to /usr/lib/systemd/system/named.service.</span><br><span class="line"></span><br><span class="line">启动DNS服务</span><br><span class="line">[root@zutuanxue ~]# systemctl start named</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@zutuanxue ~]# lsof -i :53</span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq 1520 nobody    5u  IPv4  27001      0t0  UDP bogon:domain </span><br><span class="line">dnsmasq 1520 nobody    6u  IPv4  27002      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2553  named   21u  IPv4  38662      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2553  named   22u  IPv6  38664      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2553  named  512u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  513u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  514u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  515u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  516u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  517u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  518u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  519u  IPv6  38663      0t0  UDP localhost:domain</span><br><span class="line"></span><br><span class="line">方法二: 使用chroot模式DNS</span><br><span class="line">将对应的文件移动到chroot根目录</span><br><span class="line">主配文件</span><br><span class="line">[root@zutuanxue ~]# cp /etc/named.conf /var/named/chroot/etc/</span><br><span class="line">[root@zutuanxue ~]# chgrp named /var/named/chroot/etc/named.conf</span><br><span class="line">[root@zutuanxue ~]# named-checkconf /var/named/chroot/etc/named.conf</span><br><span class="line"></span><br><span class="line">区域数据库文件</span><br><span class="line">[root@zutuanxue named]# cd /var/named/</span><br><span class="line">[root@zutuanxue named]# cp -r data /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cp -r dynamic /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cp named.* /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cd /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# chown -R named.named *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动DNS服务</span><br><span class="line">开机启动</span><br><span class="line">[root@zutuanxue ~]# systemctl enable named-chroot.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to /usr/lib/systemd/system/named-chroot.service.</span><br><span class="line">启动服务</span><br><span class="line">[root@zutuanxue ~]# mv /etc/named.conf /root/</span><br><span class="line">[root@zutuanxue ~]# systemctl start named-chroot</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@zutuanxue ~]# lsof -i :53</span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq 1525 nobody    5u  IPv4  27359      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named   21u  IPv4  44717      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2877  named   22u  IPv4  44719      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2877  named   23u  IPv4  44721      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2877  named  512u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  513u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  514u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  515u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  516u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  517u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  518u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  519u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  520u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  521u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  522u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  523u  IPv4  44720      0t0  UDP bogon:domain</span><br></pre></td></tr></table></figure>

<h3 id="4-3）DNS配置文件"><a href="#4-3）DNS配置文件" class="headerlink" title="4.3）DNS配置文件"></a>4.3）DNS配置文件</h3><p>默认情况下，如果不安装bind-chroot这个包，配置文件的路径如下：</p>
<p>配置文件:&#x2F;etc&#x2F;named.conf</p>
<p>区域数据库文件:&#x2F;var&#x2F;named&#x2F;</p>
<p>由于我们安装了bind-chroot这个用于改变默认DNS配置文件的路径的包，所以相对应的配置文件的路径也发生了变化。</p>
<p>变化如下：</p>
<p>配置文件:&#x2F;var&#x2F;named&#x2F;chroot&#x2F;etc&#x2F;named.conf</p>
<p>区域数据库文件:&#x2F;var&#x2F;named&#x2F;chroot&#x2F;var&#x2F;named&#x2F;</p>
<p>a、主配文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// named.conf</span><br><span class="line">//</span><br><span class="line">// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS</span><br><span class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</span><br><span class="line">//</span><br><span class="line">// See /usr/share/doc/bind*/sample/ for example named configuration files.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">options</span><br><span class="line">&#123;</span><br><span class="line">		</span><br><span class="line">    #IPv4监听端口为53，只允许本机连接</span><br><span class="line">    listen-on port 53    &#123; 127.0.0.1; &#125;;</span><br><span class="line">    #IPv6监听端口为53，只允许本机连接</span><br><span class="line">    listen-on-v6 port 53    &#123; ::1; &#125;;</span><br><span class="line">		#定义工作目录</span><br><span class="line">    directory         &quot;/var/named&quot;; </span><br><span class="line">    #CACHE文件路径,指定服务器在收到rndc dump命令时，转储数据到文件的路径。默认cache_dump.db</span><br><span class="line">    dump-file         &quot;data/cache_dump.db&quot;;</span><br><span class="line">    #静态文件路径,指定服务器在收到rndc stats命令时，追加统计数据的文件路径。默认named.stats</span><br><span class="line">    statistics-file     &quot;data/named_stats.txt&quot;;</span><br><span class="line">    #内存静态文件路径,服务器在退出时，将内存统计写到文件的路径。默认named.mem_stats</span><br><span class="line">    memstatistics-file     &quot;data/named_mem_stats.txt&quot;;</span><br><span class="line">        #在收到rndc secroots指令后，服务器转储安全根的目的文件的路径名。默认named.secroots</span><br><span class="line">    secroots-file        &quot;data/named.secroots&quot;;</span><br><span class="line">    # 指定服务器在通过rndc recursing命令指定转储当前递归请求到的文件路径。默认named.recursing</span><br><span class="line">    recursing-file        &quot;data/named.recursing&quot;;</span><br><span class="line">    </span><br><span class="line">    #指定允许哪些主机可以进行普通的DNS查询,可以是关键字:any/localhost/none,也可以是IPV4,IPV6地址</span><br><span class="line">    allow-query        &#123; localhost; &#125;;</span><br><span class="line">    #指定允许哪些主机可以对缓存的访问</span><br><span class="line">    allow-query-cache    &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</span><br><span class="line">    假如你建立的是一个权威DNS你不需要开启递归</span><br><span class="line">     - If you are building a RECURSIVE (caching) DNS server, you need to enable recursion. </span><br><span class="line">    假如你建立的是一个递归DNS,你需要开启递归服务</span><br><span class="line">     - If your recursive DNS server has a public IP address, you MUST enable access control to limit queries to your legitimate users. Failing to do so will</span><br><span class="line">     如果你的递归DNS是具有公网IP，你必须要设置访问控制来限制对合法用户的查询.</span><br><span class="line">       cause your server to become part of large scale DNS amplification </span><br><span class="line">    否则你的DNS会被大规模的攻击</span><br><span class="line">       attacks. Implementing BCP38 within your network would greatly</span><br><span class="line">    在您的网络中实现BCP38将非常重要减少此类攻击面</span><br><span class="line">       reduce such attack surface </span><br><span class="line">     */</span><br><span class="line">    #开启递归</span><br><span class="line">    recursion yes;</span><br><span class="line"></span><br><span class="line">    #开启DNSSEC在权威或者递归服务器之间信任服务</span><br><span class="line">    dnssec-enable yes;</span><br><span class="line"></span><br><span class="line">    #开启DNSSEC验证在递归服务器</span><br><span class="line">    dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">    #指定目录，其中保存着跟踪被管理DNSSEC密钥文件。默认为工作目录。</span><br><span class="line">    managed-keys-directory &quot;/var/named/dynamic&quot;;</span><br><span class="line">    </span><br><span class="line">    #PID文件路径</span><br><span class="line">    pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">    #session-keyfile文件路径</span><br><span class="line">    session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging </span><br><span class="line">&#123;</span><br><span class="line">#开启DNS日志记录</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file &quot;data/named.run&quot;;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    #定义一个根域</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">        #域类型为hint,还有master slave forward等类型</span><br><span class="line">            type hint;</span><br><span class="line">        #区域数据库文件路径</span><br><span class="line">            file &quot;/var/named/named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">    #包含两个子配置文件</span><br><span class="line">    include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">    include &quot;/etc/named.root.key&quot;;</span><br></pre></td></tr></table></figure>

<p>b、区域数据库文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">正向解析</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/named.localhost </span><br><span class="line">;缓存时间</span><br><span class="line">$TTL 1D</span><br><span class="line">;@表示相应的域名</span><br><span class="line">	@    				IN 	SOA        @ 					rname.invalid. (</span><br><span class="line">;解析的域名   类型 授权域    授权域名服务器   管理员邮箱</span><br><span class="line">                    0    ; serial  </span><br><span class="line">         序列号,每次更新该文件系列号都应该变大</span><br><span class="line">                    1D    ; refresh </span><br><span class="line">刷新时间,即规定从域名服务器多长时间查询一个主服务器，以保证从服务器的数据是最新的</span><br><span class="line">                    1H    ; retry   </span><br><span class="line">重试时间,即当从服务试图在主服务器上查询更时，而连接失败了，则这个值规定了从服务多长时间后再试 </span><br><span class="line">                    1W    ; expire  </span><br><span class="line">   过期时间,从服务器在向主服务更新失败后多长时间后清除对应的记录</span><br><span class="line">                    3H )    ; minimum </span><br><span class="line">   这个数据用来规定缓存服务器不能与主服务联系上后多长时间清除相应的记录</span><br><span class="line">    NS   				@</span><br><span class="line">    ;NS 名称服务器，表示这个主机为域名服务器</span><br><span class="line">    			A    		127.0.0.1</span><br><span class="line">;主机头  	A记录   	IP</span><br><span class="line">    AAAA    		::1</span><br><span class="line">;   AAAA 				解析为IPV6地址</span><br><span class="line"></span><br><span class="line">#反向解析</span><br><span class="line">[root@zutuanxue ~]# cat named.loopback </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    @ rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    		@</span><br><span class="line">    PTR    		localhost</span><br><span class="line">;IP 反向指针     主机名</span><br><span class="line">;PTR 反向指针 反解</span><br></pre></td></tr></table></figure>

<h2 id="五、部署一个正向解析"><a href="#五、部署一个正向解析" class="headerlink" title="五、部署一个正向解析"></a>五、部署一个正向解析</h2><h3 id="5-1）教学案例"><a href="#5-1）教学案例" class="headerlink" title="5.1）教学案例"></a>5.1）教学案例</h3><p><strong>对zutuanxue.com域名做解析，解析要求如下：</strong></p>
<p><strong>www 解析为A记录 IP地址为 192.168.11.88</strong></p>
<p><strong>news 做别名解析CNAME 解析为 www</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1）主配置文件</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/chroot/etc/named.conf </span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为master</span><br><span class="line">    type master;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）区域数据库文件</span><br><span class="line">[root@zutuanxue named]# cat zutuanxue.com.zone </span><br><span class="line">$TTL 1D</span><br><span class="line">zutuanxue.com.    IN SOA    ns1.zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">;zutuanxue.com.  需要做解析的域名</span><br><span class="line">;ns1.zutuanxue.com.  为zutuanxue.com.做解析的DNS    这里我们既是DNS也同时为自己域名做了解析</span><br><span class="line"></span><br><span class="line">    NS    ns1.zutuanxue.com.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;A         域名机械为IP</span><br><span class="line">;PTR        IP解析为域名</span><br><span class="line">;MX        邮件标记</span><br><span class="line">;CNAME        别名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ns1    A    192.168.11.16</span><br><span class="line">www    A    192.168.11.88</span><br><span class="line">news  CNAME    www</span><br></pre></td></tr></table></figure>

<h3 id="5-2）测试方法"><a href="#5-2）测试方法" class="headerlink" title="5.2）测试方法"></a>5.2）测试方法</h3><p>域名解析linux系统为大家提供了三个命令，看大家喜欢用哪个都可以。</p>
<p>a、host采用非交互式解析，</p>
<p>b、nslookup可以采用交互或非交互式解析</p>
<p>c、dig显示详细的解析流程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">测试注意：请将你的测试客户端机器的DNS指向你自己的DNS服务器的IP地址。本例中我使用DNS服务器给自己当测试端，我修改了自己的DNS服务器地址</span><br><span class="line">[root@zutuanxue ~]# cat /etc/resolv.conf </span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver 192.168.11.16</span><br><span class="line"></span><br><span class="line">#host命令</span><br><span class="line">[root@zutuanxue ~]# host news.zutuanxue.com</span><br><span class="line">news.zutuanxue.com is an alias for www.zutuanxue.com.</span><br><span class="line">www.zutuanxue.com has address 192.168.11.88</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#nslookup 命令---交互式解析</span><br><span class="line">[root@zutuanxue ~]# nslookup</span><br><span class="line">&gt; news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line">&gt; exit</span><br><span class="line"></span><br><span class="line">#nslookup 命令---非交互式解析</span><br><span class="line">[root@zutuanxue ~]# nslookup news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#dig命令</span><br><span class="line">[root@zutuanxue ~]# dig news.zutuanxue.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-73.el7_6 &lt;&lt;&gt;&gt; news.zutuanxue.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28487</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;news.zutuanxue.com.        IN    A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">news.zutuanxue.com.    86400    IN    CNAME    www.zutuanxue.com.</span><br><span class="line">www.zutuanxue.com.    86400    IN    A    192.168.11.88</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">zutuanxue.com.        86400    IN    NS    www.zutuanxue.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 192.168.11.16#53(192.168.11.16)</span><br><span class="line">;; WHEN: 一 2月 25 10:52:19 CST 2019</span><br><span class="line">;; MSG SIZE  rcvd: 93</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">技巧：</span><br><span class="line">在dig解析中，后面跟上+trace来显示详细解析流程</span><br><span class="line">[root@zutuanxue ~]# dig www.zutuanxue.com +trace</span><br></pre></td></tr></table></figure>

<h2 id="六、部署一个反向解析"><a href="#六、部署一个反向解析" class="headerlink" title="六、部署一个反向解析"></a>六、部署一个反向解析</h2><p><strong>案例:对<a href="http://www.zutuanxue.com做反向解析，其对应的IP地址为192.168.11.88">www.zutuanxue.com做反向解析，其对应的IP地址为192.168.11.88</a></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1）主配置文件添加反向解析zone</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/chroot/etc/named.conf </span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为master</span><br><span class="line">    type master;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个反向解析</span><br><span class="line">//此处需要倒写网段</span><br><span class="line">zone &quot;11.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;192.168.11.arpa&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）区域数据库文件设置</span><br><span class="line">[root@zutuanxue named]# cat 192.168.11.arpa </span><br><span class="line">$TTL 1D</span><br><span class="line">11.168.192.in-addr.arpa.    IN SOA    ns1.zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    ns1.zutuanxue.com.</span><br><span class="line">88    PTR    www.zutuanxue.com.</span><br><span class="line"></span><br><span class="line">注意：文件的所有者和所有者组都是named</span><br><span class="line">3）使用nslookup测试</span><br><span class="line">[root@zutuanxue ~]# nslookup 192.168.11.88</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">88.11.168.192.in-addr.arpa    name = www.zutuanxue.com.</span><br></pre></td></tr></table></figure>

<h2 id="七、DNS服务器冗余"><a href="#七、DNS服务器冗余" class="headerlink" title="七、DNS服务器冗余"></a>七、DNS服务器冗余</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998138816.png" alt="image20200114172337009.png"></p>
<p>DNS服务器在网络中为全世界的服务器提供了域名解析服务，扮演着至关重要的角色。网络中的某台DNS一旦宕机，就会造成部分域名无法解析，用户无法顺利访问到对应的服务器。但是我们学习的过程中也发现了，我们的DNS部署在单台服务器上，如果出现单点故障，我们应该如何应对呢？我们可以通过部署多台相同解析的DNS来解决单点故障，就算一台DNS服务器出现问题，也不会影响解析服务。怎么部署呢？如何保障多台之间的解析一致？这就是我们要讨论的问题了。我们来学习辅助DNS吧！</p>
<p>辅助DNS是从主DNS拉取区域数据库文件的的，当主DNS解析的域名对应的区域数据库文件发生变化，辅助就会去找主DNS拉取新的区域数据库文件，保证和主的解析一致，而且是自动的不需要人为干预的，确保了主从DNS的区域数据库文件的一致性。</p>
<p><strong>教学案例:按照图例,为主DNS(192.168.11.16）部署一台辅助DNS(192.168.11.116)，实现数据同步。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">辅助DNS设置</span><br><span class="line">a、软件包安装</span><br><span class="line">[root@slave ~]# dnf -y install bind bind-chroot</span><br><span class="line"></span><br><span class="line">b、设置主配文件</span><br><span class="line">[root@slave etc]# cat /var/named/chroot/etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为slave  代表辅助</span><br><span class="line">    type slave;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">//设置主DNS IP,向该IP去同步数据</span><br><span class="line">    masters &#123; 192.168.11.16; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个反向解析</span><br><span class="line">//此处需要倒写网段</span><br><span class="line">zone &quot;11.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">//类型写slave  代表辅助</span><br><span class="line">    type slave;</span><br><span class="line">    file &quot;192.168.11.arpa&quot;;</span><br><span class="line">//设置主DNS IP,向该IP去同步数据</span><br><span class="line">    masters &#123; 192.168.11.16; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改权限</span><br><span class="line">[root@slave etc]# chgrp named named.conf </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c、启动服务</span><br><span class="line">[root@slave chroot]# systemctl enable named-chroot.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to</span><br><span class="line"> /usr/lib/systemd/system/named-chroot.service.</span><br><span class="line">[root@slave chroot]# systemctl start named-chroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d、验证</span><br><span class="line">[root@slave ~]# ls /var/named/chroot/var/named/</span><br><span class="line">192.168.11.arpa  zutuanxue.com.zone  chroot  data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">发现192.168.11.arpa  zutuanxue.com.zone 这两个数据库文件已经同步过来了，解析一下看看吧！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置客户端的DNS IP为192.168.11.116，我的测试机就是这台slave机器，所以设置为192.168.11.116即可</span><br><span class="line">[root@slave ~]# cat /etc/resolv.conf </span><br><span class="line">nameserver 192.168.11.116</span><br><span class="line"></span><br><span class="line">使用nslookup验证一下</span><br><span class="line">[root@slave ~]# nslookup news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.116</span><br><span class="line">Address:    192.168.11.116#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line"></span><br><span class="line">[root@slave ~]# nslookup 192.168.11.88</span><br><span class="line">Server:        192.168.11.116</span><br><span class="line">Address:    192.168.11.116#53</span><br><span class="line"></span><br><span class="line">88.11.168.192.in-addr.arpa    name = www.11.168.192.in-addr.arpa.</span><br><span class="line"></span><br><span class="line">看到结果了，完美！！</span><br></pre></td></tr></table></figure>

<h2 id="八、智能DNS"><a href="#八、智能DNS" class="headerlink" title="八、智能DNS"></a>八、智能DNS</h2><p>在我们访问WEB的时候，发现有的网站打开的速度非常快，有的网站打开的非常慢，这是为什么呢？原因就是很多公司为了提升用户的体验，自己的网站使用了CDN内容加速服务，让你直接在你本地城市的服务器上拿数据并展示给你看。什么是CDN我们暂且理解为本地缓存服务器就好，那么你是怎么准确知道你本地的缓存服务器的呢！因为很多CDN公司的DNS使用了智能解析服务，根据你的源IP判断你属于哪个城市，让后再把本地的缓存服务器解析给你，你就会直接去找该服务器拿数据了。</p>
<p>智能解析原理</p>
<p>在DNS中植入全世界的IP库以及IP对应的地域，当用户来请求解析时，DNS会根据其源IP来定位他属于哪个区域，然后去找这个区域的view视图查询对应的域名的区域数据库文件做解析。从而使得不同地域的用户解析不同。</p>
<p><strong>教学案例:部署一台DNS智能解析服务器，对zutuanxue.com域名做智能解析：</strong></p>
<p><strong>上海的用户解析IP为 1.1.1.1</strong></p>
<p><strong>北京的用户解析IP为 2.2.2.2</strong></p>
<p><strong>其他用户解析为 3.3.3.3</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">智能解析</span><br><span class="line">a、设置主配文件</span><br><span class="line">定义IP库，DNS根据IP库判断源IP属于哪个区域</span><br><span class="line">根据地域定义视图，将该区域的客户端的解析请求都由该视图中的zone来解析</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义IP库</span><br><span class="line"></span><br><span class="line">acl shanghai &#123; 192.168.11.50; &#125;;</span><br><span class="line">acl beijing &#123; 192.168.11.100; &#125;;</span><br><span class="line"></span><br><span class="line">//定义视图，通过IP匹配后，通过不同的区域数据库文件进行解析</span><br><span class="line">view sh &#123;</span><br><span class="line">	match-clients &#123; shanghai; &#125;;</span><br><span class="line">	zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;zutuanxue.com.zone.sh&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view bj &#123;</span><br><span class="line">	match-clients &#123; beijing; &#125;;</span><br><span class="line">	zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;zutuanxue.com.zone.bj&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">view other &#123;</span><br><span class="line">	match-clients &#123; any; &#125;;</span><br><span class="line">  zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;zutuanxue.com.zone.any&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b、根据主配文件设置不同的区域数据库文件</span><br><span class="line">[root@master named]# cd /var/named/chroot/var/named</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.bj</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.sh</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.any</span><br><span class="line">[root@master named]# chgrp named  zutuanxue.com.zone.*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.sh </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    1.1.1.1</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.bj</span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    2.2.2.2</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.any </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    3.3.3.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c、测试</span><br><span class="line">依次修改主配的IP库中的IP为本机，观看解析情况</span><br><span class="line"></span><br><span class="line">[root@master named]# nslookup www.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 1.1.1.1</span><br></pre></td></tr></table></figure>

<h1 id="FTP文件服务器"><a href="#FTP文件服务器" class="headerlink" title="FTP文件服务器"></a>FTP文件服务器</h1><p> 阅读 (293262) </p>
<p> 分享</p>
<h2 id="一、FTP介绍"><a href="#一、FTP介绍" class="headerlink" title="一、FTP介绍"></a>一、FTP介绍</h2><p>FTP (File transfer protocol) 是TCP&#x2F;IP 协议组中的协议之一。他最主要的功能是在服务器与客户端之间进行文件的传输。FTP就是实现两台计算机之间的拷贝，从远程计算机拷贝文件至自己的计算机上，称之为“下载 （download）”文件。将文件从自己计算机中拷贝至远程计算机上，则称之为“上传（upload）”文件。这个古老的协议使用的是明码传输方式，且过去有相当多的安全危机历史。为了更安全的使用 FTP 协议，我们主要介绍较为安全但功能较少的 vsftpd(very secure File transfer protocol ) 这个软件。FTP是一个C&#x2F;S类型的软件，FTP监听TCP端口号为21，数据端口为20。</p>
<h2 id="二、应用场景"><a href="#二、应用场景" class="headerlink" title="二、应用场景"></a>二、应用场景</h2><p>下载服务器：提供对外的下载服务</p>
<p>文件服务器：提供上传和下载服务</p>
<h2 id="三、FTP的权限"><a href="#三、FTP的权限" class="headerlink" title="三、FTP的权限"></a>三、FTP的权限</h2><p>FTP 服务器的功能除了单纯的进行文件的传输与管理之外，依据服务器软件的设定架构，它还可以提供几个主要的功能。：<br>不同等级的用户身份：user, guest, anonymous<br>FTP 服务器在默认的情况下，依据使用者登录的情况而分为三种不同的身份，分别是：</p>
<p>(1)本地用户：系统中真实存在的用户</p>
<p>(2)来宾, guest；</p>
<p>(3)匿名登录者, anonymous</p>
<p>这三种身份的用户在系统上面的权限差异很大！例如实体用户取得系统的权限比较完整， 所以可以进行比较多的动作；至于匿名登录者，大概我们就仅提供他下载资源的能力而已，并不许匿名者使用太多主机的资源！ 当然，这三种人物因为权限的不同能够使用的【在线命令】自然也就不相同！</p>
<h2 id="四、FTP的工作模式"><a href="#四、FTP的工作模式" class="headerlink" title="四、FTP的工作模式"></a>四、FTP的工作模式</h2><p>FTP支持两种模式，一种方式叫做Standard (也就是 PORT方式，主动方式)，一种是 Passive (也就是PASV，被动方式)。 Standard模式 FTP的客户端发送 PORT 命令到FTP服务器。Passive模式FTP的客户端发送 PASV命令到 FTP Server。</p>
<p>下面介绍一个这两种方式的工作原理：</p>
<p>Port模式FTP 客户端首先和FTP服务器的TCP 21端口建立连接，通过这个通道发送命令，客户端需要接收数据的时候在这个通道上发送PORT命令。 PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP 20端口连接至客户端的指定端口发送数据。 FTP server必须和客户端建立一个新的连接用来传送数据。</p>
<p>Passive模式在建立控制通道的时候和Standard模式类似，但建立连接后发送的不是Port命令，而是Pasv命令。FTP服务器收到Pasv命令后，随机打开一个高端端口（端口号大于1024）并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，然后FTP服务器将通过这个端口进行数据的传送，这个时候FTP server不再需要建立一个新的和客户端之间的连接。</p>
<p>很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP 20无法和内部网络的客户端建立一个新的连接，造成无法工作。</p>
<h2 id="五、FTP安装部署"><a href="#五、FTP安装部署" class="headerlink" title="五、FTP安装部署"></a>五、FTP安装部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vsftp安装</span><br><span class="line">[root@localhost ~]# dnf -y install vsftpd ftp</span><br><span class="line"></span><br><span class="line">vsftp开机启动</span><br><span class="line">[root@localhost ~]# systemctl enable vsftpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to </span><br><span class="line">/usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br><span class="line">启动vsftp服务</span><br><span class="line">[root@localhost ~]# systemctl start vsftpd</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@localhost ~]# lsof -i :21</span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">vsftpd  1951 root    4u  IPv6  32837      0t0  TCP *:ftp (LISTEN)</span><br></pre></td></tr></table></figure>

<h2 id="六、FTP配置文件"><a href="#六、FTP配置文件" class="headerlink" title="六、FTP配置文件"></a>六、FTP配置文件</h2><h3 id="6-1）相关文件"><a href="#6-1）相关文件" class="headerlink" title="6.1）相关文件"></a>6.1）相关文件</h3><p>主配文件:&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf</p>
<p>下载目录:&#x2F;var&#x2F;ftp&#x2F;</p>
<p>FTP日志:&#x2F;var&#x2F;log&#x2F;xferlog</p>
<h3 id="6-2）主配文件详解"><a href="#6-2）主配文件详解" class="headerlink" title="6.2）主配文件详解"></a>6.2）主配文件详解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"># Example config file /etc/vsftpd/vsftpd.conf</span><br><span class="line">#</span><br><span class="line"># The default compiled in settings are fairly paranoid. This sample file</span><br><span class="line"># loosens things up a bit, to make the ftp daemon more usable.</span><br><span class="line"># Please see vsftpd.conf.5 for all compiled in defaults.</span><br><span class="line">#</span><br><span class="line"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span><br><span class="line"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&#x27;s</span><br><span class="line"># capabilities.</span><br><span class="line">#</span><br><span class="line">#匿名用户访问,YES是允许，NO是拒绝</span><br><span class="line"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow local users to log in.</span><br><span class="line"># 本地用户登录,YES是允许，NO是拒绝.默认访问的是本地用户家目录，如果你开启了selinux</span><br><span class="line"># 请设置开启布尔值ftp_home_dir为ON</span><br><span class="line"># When SELinux is enforcing check for SE bool ftp_home_dir</span><br><span class="line">local_enable=YES</span><br><span class="line">#</span><br><span class="line">#允许本地用户上传</span><br><span class="line"># Uncomment this to enable any form of FTP write command.</span><br><span class="line">write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Default umask for local users is 077. You may wish to change this to 022,</span><br><span class="line"># 上传的权限是022，使用的是umask权限。对应的目录是755，文件是644</span><br><span class="line"># if your users expect that (022 is used by most other ftpd&#x27;s)</span><br><span class="line">local_umask=022</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow the anonymous FTP user to upload files. This only</span><br><span class="line"># has an effect if the above global write enable is activated. Also, you will</span><br><span class="line"># obviously need to create a directory writable by the FTP user.</span><br><span class="line"># When SELinux is enforcing check for SE bool allow_ftpd_anon_write, allow_ftpd_full_access</span><br><span class="line"># 开启匿名用户上传功能，默认是拒绝的</span><br><span class="line">#anon_upload_enable=YES</span><br><span class="line">#</span><br><span class="line"># Uncomment this if you want the anonymous FTP user to be able to create</span><br><span class="line"># new directories.</span><br><span class="line"># 开启匿名用户创建文件或文件夹权限</span><br><span class="line">#anon_mkdir_write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Activate directory messages - messages given to remote users when they</span><br><span class="line"># go into a certain directory.</span><br><span class="line"># 开启目录欢迎消息，一般对命令行登陆有效</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">#</span><br><span class="line"># Activate logging of uploads/downloads.</span><br><span class="line"># 开启上传和下载日志记录功能</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">#</span><br><span class="line">#使用标准模式</span><br><span class="line"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">#</span><br><span class="line"># If you want, you can arrange for uploaded anonymous files to be owned by</span><br><span class="line"># a different user. Note! Using &quot;root&quot; for uploaded files is not</span><br><span class="line"># recommended!</span><br><span class="line"># 声明匿名用户上传文件的所有者</span><br><span class="line"># 允许更改匿名用户上传文件的所有者</span><br><span class="line">#chown_uploads=YES</span><br><span class="line">#所有者为whoever</span><br><span class="line">#chown_username=whoever</span><br><span class="line">#</span><br><span class="line"># You may override where the log file goes if you like. The default is shown</span><br><span class="line"># below.</span><br><span class="line"># 日志文件路径</span><br><span class="line">#xferlog_file=/var/log/xferlog</span><br><span class="line">#</span><br><span class="line"># If you want, you can have your log file in standard ftpd xferlog format.</span><br><span class="line"># Note that the default log file location is /var/log/xferlog in this case.</span><br><span class="line"># 日志文件采用标准格斯</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out an idle session.</span><br><span class="line"># 会话超时时间</span><br><span class="line">#idle_session_timeout=600</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out a data connection.</span><br><span class="line"># 数据传输超时时间</span><br><span class="line">#data_connection_timeout=120</span><br><span class="line">#</span><br><span class="line"># It is recommended that you define on your system a unique user which the</span><br><span class="line"># ftp server can use as a totally isolated and unprivileged user.</span><br><span class="line"># FTP子进程管理用户</span><br><span class="line">#nopriv_user=ftpsecure</span><br><span class="line">#</span><br><span class="line"># Enable this and the server will recognise asynchronous ABOR requests. Not</span><br><span class="line"># recommended for security (the code is non-trivial). Not enabling it,</span><br><span class="line"># however, may confuse older FTP clients.</span><br><span class="line"># 是否允许客户端发起“async ABOR”请求，该操作是不安全的默认禁止。</span><br><span class="line">#async_abor_enable=YES</span><br><span class="line">#</span><br><span class="line"># By default the server will pretend to allow ASCII mode but in fact ignore</span><br><span class="line"># the request. Turn on the below options to have the server actually do ASCII</span><br><span class="line"># mangling on files when in ASCII mode. The vsftpd.conf(5) man page explains</span><br><span class="line"># the behaviour when these options are disabled.</span><br><span class="line"># Beware that on some FTP servers, ASCII support allows a denial of service</span><br><span class="line"># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</span><br><span class="line"># predicted this attack and has always been safe, reporting the size of the</span><br><span class="line"># raw file.</span><br><span class="line"># ASCII mangling is a horrible feature of the protocol.</span><br><span class="line"># 该选项用于指定是否允许上传时以ASCII模式传输数据</span><br><span class="line">#ascii_upload_enable=YES</span><br><span class="line">#该选项用于指定是否允许下载时以ASCII模式传输数据</span><br><span class="line">#ascii_download_enable=YES</span><br><span class="line">#</span><br><span class="line"># You may fully customise the login banner string:</span><br><span class="line"># FTP文本界面登陆欢迎词</span><br><span class="line">#ftpd_banner=Welcome to blah FTP service.</span><br><span class="line">#</span><br><span class="line"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span><br><span class="line"># useful for combatting certain DoS attacks.</span><br><span class="line"># 是否开启拒绝的Email功能</span><br><span class="line">#deny_email_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line"># 指定保存被拒接的Email地址的文件</span><br><span class="line">#banned_email_file=/etc/vsftpd/banned_emails</span><br><span class="line">#</span><br><span class="line"># You may specify an explicit list of local users to chroot() to their home</span><br><span class="line"># directory. If chroot_local_user is YES, then this list becomes a list of</span><br><span class="line"># users to NOT chroot().</span><br><span class="line"># (Warning! chroot&#x27;ing can be very dangerous. If using chroot, make sure that</span><br><span class="line"># the user does not have write access to the top level directory within the</span><br><span class="line"># chroot)</span><br><span class="line"># 是否开启对本地用户chroot的限制，YES为默认所有用户都不能切出家目录，NO代表默认用户都可以切出家目录</span><br><span class="line"># 设置方法类似于：YES拒绝所有，允许个别    NO  允许所有拒绝个别</span><br><span class="line">#chroot_local_user=YES</span><br><span class="line">#开启特例列表</span><br><span class="line">#chroot_list_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line"># 如果chroot_local_user的值是YES则该文件中的用户是可以切出家目录，如果是NO，该文件中的用户则不能切出家目录</span><br><span class="line"># 一行一个用户。</span><br><span class="line">#chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line">#</span><br><span class="line"># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</span><br><span class="line"># default to avoid remote users being able to cause excessive I/O on large</span><br><span class="line"># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</span><br><span class="line"># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</span><br><span class="line"># 是否开启ls 递归查询功能 ls -R</span><br><span class="line">#ls_recurse_enable=YES</span><br><span class="line">#</span><br><span class="line"># When &quot;listen&quot; directive is enabled, vsftpd runs in standalone mode and</span><br><span class="line"># listens on IPv4 sockets. This directive cannot be used in conjunction</span><br><span class="line"># with the listen_ipv6 directive.</span><br><span class="line"># 是否开启ftp独立模式在IPV4</span><br><span class="line">listen=NO</span><br><span class="line">#</span><br><span class="line"># This directive enables listening on IPv6 sockets. By default, listening</span><br><span class="line"># on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</span><br><span class="line"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span><br><span class="line"># sockets. If you want that (perhaps because you want to listen on specific</span><br><span class="line"># addresses) then you must run two copies of vsftpd with two configuration</span><br><span class="line"># files.</span><br><span class="line"># Make sure, that one of the listen options is commented !!</span><br><span class="line"># 是否开启ftp独立模式在ipv6</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#启用pam模块验证</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">#是否开启userlist功能.</span><br><span class="line"></span><br><span class="line">#是否启用用户列表功能</span><br><span class="line">userlist_enable=YES</span><br></pre></td></tr></table></figure>

<p>通过配置文件的分析，VSFTP不允许匿名访问，本地用户可以下载和上传。如果允许匿名用户登录的话需要将anonymous_enable&#x3D;YES，然后重新启动服务</p>
<p>我们可以通过修改配置文件的内容即可配置FTP的相关登陆情况。</p>
<h2 id="七、FTP客户端访问"><a href="#七、FTP客户端访问" class="headerlink" title="七、FTP客户端访问"></a>七、FTP客户端访问</h2><p>FTP是一个C&#x2F;S类型的软件,连接服务端需要FTP客户端才能完成，常见的FTP客户端有以下几种:</p>
<p>浏览器：可以通过浏览器中输入 <a href="ftp://ip或者ftp//%E5%9F%9F%E5%90%8D%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E8%AE%BF%E9%97%AEFTP">ftp://ip或者ftp://域名的方式来访问FTP</a></p>
<p>自带客户端:命令行下可以使用ftp命令去连接</p>
<p>三方客户端：FileZilla 8uftp 图形软件或者文本界面的lftp等</p>
<p>三种方式中，文本界面是比较麻烦的，无法鼠标流。所以我重点给大家讲解一下</p>
<h3 id="7-1）文本界面登陆"><a href="#7-1）文本界面登陆" class="headerlink" title="7.1）文本界面登陆"></a>7.1）文本界面登陆</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">文本界面匿名登陆</span><br><span class="line">[root@localhost ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.11.16:root): ftp	#用户名可以是ftp也可以是anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:							#密码为空</span><br><span class="line">230 Login successful. #显示登陆成功</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,90,35).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 0        0               6 May 14  2019 pub</span><br><span class="line">226 Directory send OK.</span><br><span class="line">通过ls可以列出当前目录下有哪些内容 看到有一个目录叫pub</span><br><span class="line">ftp&gt; pwd</span><br><span class="line">257 &quot;/&quot;   </span><br><span class="line">通过pwd命令查看当前路径  注意这里显示的是FTP的根目录</span><br><span class="line"></span><br><span class="line">ftp&gt; bye</span><br><span class="line">221 Goodbye.</span><br><span class="line">退出使用bye命令</span><br><span class="line"></span><br><span class="line">文本界面本地用户登录</span><br><span class="line">[root@localhost ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.11.16:root): hello</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,130,240).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 下载</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 公共</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 图片</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 文档</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 桌面</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 模板</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 视频</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; pwd</span><br><span class="line">257 &quot;/home/hello&quot; is the current directory</span><br></pre></td></tr></table></figure>

<h3 id="7-2）FTP客户端常用命令"><a href="#7-2）FTP客户端常用命令" class="headerlink" title="7.2）FTP客户端常用命令"></a>7.2）FTP客户端常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">键入help命令可以查看所有可使用的命令</span><br><span class="line">ftp&gt; help</span><br><span class="line">Commands may be abbreviated.  Commands are:</span><br><span class="line"></span><br><span class="line">!                debug         mdir           sendport     site</span><br><span class="line">$                dir           mget           put          size</span><br><span class="line">account          disconnect    mkdir          pwd          status</span><br><span class="line">append           exit          mls            quit         struct</span><br><span class="line">ascii            form          mode           quote        system</span><br><span class="line">bell             get           modtime        recv         sunique</span><br><span class="line">binary           glob          mput           reget        tenex</span><br><span class="line">bye              hash          newer          rstatus      tick</span><br><span class="line">case             help          nmap           rhelp        trace</span><br><span class="line">cd               idle          nlist          rename       type</span><br><span class="line">cdup             image         ntrans         reset        user</span><br><span class="line">chmod            lcd           open           restart      umask</span><br><span class="line">close            ls            prompt         rmdir        verbose</span><br><span class="line">cr               macdef        passive        runique        ?</span><br><span class="line">delete           mdelete       proxy          send</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">!+linux命令   执行系统命令</span><br><span class="line">!ls /opt  显示linux系统中/opt目录下的内容</span><br><span class="line">ftp&gt; !ls /opt</span><br><span class="line">dhcp  dns  rh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lcd linux系统中的当前目录</span><br><span class="line">lcd /root  将linux系统中的当前目录切换到/root下</span><br><span class="line">ftp&gt; lcd /root</span><br><span class="line">Local directory now /root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put 上传命令，mput批量上传命令</span><br><span class="line">上传initial-setup-ks.cfg文件到hello家目录下</span><br><span class="line">ftp&gt; put initial-setup-ks.cfg </span><br><span class="line">local: initial-setup-ks.cfg remote: initial-setup-ks.cfg</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,96,132).</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">1803 bytes sent in 0.00135 secs (1333.58 Kbytes/sec)</span><br><span class="line">可以看到上传成功了</span><br><span class="line"></span><br><span class="line">验证一下上传结果</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,173,142).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000         1803 Feb 26 07:01 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line">看见了吧</span><br><span class="line"></span><br><span class="line">切换linux当前目录到/tmp</span><br><span class="line">ftp&gt; lcd /tmp</span><br><span class="line">Local directory now /tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get下载命令，mget批量下载</span><br><span class="line">下载initial-setup-ks.cfg到linux系统当前目录/tmp</span><br><span class="line">ftp&gt; get initial-setup-ks.cfg</span><br><span class="line">local: initial-setup-ks.cfg remote: initial-setup-ks.cfg</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,229,134).</span><br><span class="line">150 Opening BINARY mode data connection for initial-setup-ks.cfg (1803 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">1803 bytes received in 2.9e-05 secs (62172.41 Kbytes/sec)</span><br><span class="line"></span><br><span class="line">列出linux目录/tmp的内容，看到了下载的文件initial-setup-ks.cfg</span><br><span class="line">ftp&gt; !ls /tmp/</span><br><span class="line">dhcp                                          tracker-extract-files.0</span><br><span class="line">initial-setup-ks.cfg                                  VMwareDnD</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-chronyd.service-sghHHs       vmware-root</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-colord.service-wK7h08      yum_save_tx.2019-02-20.16-10.Z6uXqR.yumtx</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-cups.service-cokBro          yum_save_tx.2019-02-21.09-03.08zIbU.yumtx</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-rtkit-daemon.service-6wt1S0  yum_save_tx.2019-02-22.11-10.prawAT.yumtx</span><br><span class="line"></span><br><span class="line">ftp&gt; close</span><br><span class="line">221 Goodbye.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">Not connected.</span><br><span class="line">可以使用close断开连接，当连接断开希望再次连接直接使用open命令即可</span><br><span class="line">ftp&gt; open 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.11.16:root): hello</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,192,88).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000         1803 Feb 26 07:01 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete命令可以删除属于自己的文件</span><br><span class="line">删除initial-setup-ks.cfg文件</span><br><span class="line">ftp&gt; delete initial-setup-ks.cfg</span><br><span class="line">250 Delete operation successful.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,168,142).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br></pre></td></tr></table></figure>

<h2 id="八、基于虚拟用户配置安全的ftp"><a href="#八、基于虚拟用户配置安全的ftp" class="headerlink" title="八、基于虚拟用户配置安全的ftp"></a>八、基于虚拟用户配置安全的ftp</h2><p>在ftp中不论是匿名用户还是实名用户都是系统中真实存在的用户，或多或少都会有一些安全方面的风险，为了避免这个风险，开发者在ftp中加入了一个虚拟用户的概念，所有虚拟用户都会被统一映射为一个系统账号，免去了管理过多账户的麻烦，那么这个虚拟用户如何实现呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">a、修改配置文件 </span><br><span class="line">[root@zutuanxue pam.d]# egrep -v &quot;^#&quot; /etc/vsftpd/vsftpd.conf </span><br><span class="line">anonymous_enable=YES</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">listen=NO</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#虚拟用户配置选项</span><br><span class="line">#pam登陆验证</span><br><span class="line">pam_service_name=vftp</span><br><span class="line">#允许虚拟用户功能</span><br><span class="line">guest_enable=YES</span><br><span class="line">#虚拟用户映射到本地用户hello</span><br><span class="line">guest_username=hello</span><br><span class="line">#这里我通过指令改变了默认设置，允许虚拟用户写</span><br><span class="line">allow_writeable_chroot=YES </span><br><span class="line"></span><br><span class="line">#本地用户的根目录</span><br><span class="line">#这里是定义虚拟用户主目录，用户和组必须指定为宿主用户hello</span><br><span class="line">local_root=/home/hello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#允许虚拟用户和本地用户权限一致</span><br><span class="line">virtual_use_local_privs=YES</span><br><span class="line"></span><br><span class="line">#如果虚拟用户和本地用户权限不同，可以通过以下的指令来设置指令，配置文件和登陆名同步即可。</span><br><span class="line">#user_config_dir=/etc/vsftpd/vconf.d/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b、生成虚拟用户账号密码文件</span><br><span class="line">奇数行数账户，偶数行是密码</span><br><span class="line">[root@zutuanxue ~]# cat /etc/vsftpd/vuser</span><br><span class="line">vuser01</span><br><span class="line">123456</span><br><span class="line">vuser02</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">使用db_load转成db格式</span><br><span class="line">[root@zutuanxue ~]# db_load -T -t hash -f /etc/vsftpd/vuser /etc/vsftpd/vuser.db</span><br><span class="line">要求权限是600</span><br><span class="line">[root@zutuanxue ~]# chmod 600 /etc/vsftpd/vuser.db</span><br><span class="line"></span><br><span class="line">c、配置pam认证，注意先后顺序</span><br><span class="line">[root@zutuanxue ~]# cat /etc/pam.d/vftp </span><br><span class="line">#虚拟用户登录</span><br><span class="line">auth       sufficient     /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">account    sufficient     /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">#本地登陆</span><br><span class="line">session    optional     pam_keyinit.so    force revoke</span><br><span class="line">auth       required    pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span><br><span class="line">auth       required    pam_shells.so</span><br><span class="line">auth       include    password-auth</span><br><span class="line">account    include    password-auth</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    include    password-auth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d、重启服务生效</span><br><span class="line">[root@zutuanxue ~]# systemctl restart vsftpd</span><br><span class="line">[root@zutuanxue ~]# cat /etc/vsftpd/chroot_list </span><br><span class="line">vuser01</span><br><span class="line">vuser02</span><br><span class="line"></span><br><span class="line">e、验证登陆</span><br><span class="line">[root@zutuanxue ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 Welcome to ayitula FTP service.</span><br><span class="line">Name (192.168.11.16:root): vuser01</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,82,91).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">226 Transfer done (but failed to open directory).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">登陆成功了.</span><br></pre></td></tr></table></figure>

<h1 id="Linux-时间服务器"><a href="#Linux-时间服务器" class="headerlink" title="Linux 时间服务器"></a>Linux 时间服务器</h1><p> 阅读 (192071) </p>
<p> 分享</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>什么是时间服务器</strong></p>
<p>NTP：Network Time Protocol 网络时间协议，用来同步网络中各主机的时间，在linux系统中早期使用ntp来实现，后来使用chrony来实现，Chrony 应用本身已经有几年了，其是是网络时间协议的 (NTP) 的另一种实现。</p>
<p><strong>Chrony可以同时做为ntp服务的客户端和服务端</strong></p>
<p>一直以来众多发行版里标配的都是ntpd对时服务，自rhel7&#x2F;centos7 起，Chrony做为了发行版里的标配服务，不过老的ntpd服务依旧在rhel7&#x2F;centos7里可以找到 。</p>
<p><strong>核心组件：</strong></p>
<p>chronyd：是守护进程，主要用于调整内核中运行的系统时间和时间服务器同步。它确定计算机增减时间的比率，并对此进行调整补偿。</p>
<p>chronyc：提供一个用户界面，用于监控性能并进行多样化的配置。它可以在chronyd实例控制的计算机上工作，也可以在一台不同的远程计算机上工作。</p>
<p><strong>优势</strong></p>
<p>chrony用来同步时间，来代替ntp服务，优点是很精巧的时间同步工具，更快响应时钟变化，在应对延时提供更好的稳定性能，不会出现时间空白，跨越互联网同步时间只需要几毫秒。</p>
<p>它的优势主要包括</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#更快的同步：能在最大程度的减少时间和频率误差，这对于非全天运行的台式计算机或系统而言非常有用</span><br><span class="line"></span><br><span class="line">#更快的响应速度：能够更好的响应时间频率的快速变化，这对于具备不稳定时钟的虚拟机或导致时钟频率发生变化的节能技术而言更有帮助</span><br><span class="line"></span><br><span class="line">#稳定：在初始同步后，它并不会停止时钟，以防对需要系统时间的程序造成影响，以及可以更好的应对延迟</span><br></pre></td></tr></table></figure>

<p><strong>相关文件说明</strong></p>
<p>&#x2F;etc&#x2F;chrony.conf 主配置文件</p>
<p>&#x2F;usr&#x2F;bin&#x2F;chronyc 客户端程序工具</p>
<p>&#x2F;usr&#x2F;sbin&#x2F;chronyd 服务端程序</p>
<p><strong>配置文件说明</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">pool 2.centos.pool.ntp.org iburst</span><br><span class="line">###指定时间服务器的地址，可以使用pool开始也可以使用server开始，iburst可以加速初始同步，perfer表示优先</span><br><span class="line"># Record the rate at which the system clock gains/losses time.</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">#用来记录时间差异，由于chrony是通过BIOS判断时间的，他会用这个时间与上层时间服务器进行对比，将差异记录下来</span><br><span class="line"># Allow the system clock to be stepped in the first three updates</span><br><span class="line"># if its offset is larger than 1 second.</span><br><span class="line">makestep 1.0 3</span><br><span class="line">#让chrony可以根据需求逐步进行时间的调整，避免在某些情况下时间差异较大，导致调整时间耗时过长，以上的设置表示在误差时间大于1.0秒的话，前三次使用update更新时间是使用step（分阶段）而不是slew(微调),如果最后一个值是负数的话，如-1则表示随时步进</span><br><span class="line"># Enable kernel synchronization of the real-time clock (RTC).</span><br><span class="line">rtcsync</span><br><span class="line">#启用内核模式，在内核模式中，系统时间每11分钟会同步到实时时钟（RTC）</span><br><span class="line"># Enable hardware timestamping on all interfaces that support it.</span><br><span class="line">#hwtimestamp *</span><br><span class="line"># 通过使用hwtimestamp指令启用硬件时间戳</span><br><span class="line"># Increase the minimum number of selectable sources required to adjust</span><br><span class="line"># the system clock.</span><br><span class="line">#minsources 2</span><br><span class="line"></span><br><span class="line"># Allow NTP client access from local network.</span><br><span class="line">#allow 192.168.0.0/16</span><br><span class="line">#允许同步的网段</span><br><span class="line"># Serve time even if not synchronized to a time source.</span><br><span class="line">#local stratum 10</span><br><span class="line">#即时自己未能通过网络时间服务器同步时间，也允许将本地时间作为标准时间同步给其他客户端</span><br><span class="line"># Specify file containing keys for NTP authentication.</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">#验证的秘钥文件</span><br><span class="line"># Get TAI-UTC offset and leap seconds from the system tz database.</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">#从system tz数据库中获取TAI(国际原子时)和UTC（协调世界时）之间的时间偏移及闰秒</span><br><span class="line"># Specify directory for log files.</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">#日志文件的位置</span><br><span class="line"># Select which information is logged.</span><br><span class="line">#log measurements statistics tracking</span><br></pre></td></tr></table></figure>

<h2 id="时间服务器实战"><a href="#时间服务器实战" class="headerlink" title="时间服务器实战"></a>时间服务器实战</h2><p>环境：两台主机，系统为CentOS8，IP地址为192.168.2.100,192.168.2.200,selinux和防火墙关闭</p>
<p>要求: 192.168.2.100为内网时间服务器，192.168.2.200为客户端，200的客户端的时间要与100的时间同步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">在192.168.2.100主机上</span><br><span class="line">step1	检查时间服务器上是否有相关软件包</span><br><span class="line">[root@zutuanxue ~]# rpm -qa | grep chrony</span><br><span class="line">chrony-3.3-3.el8.x86_64</span><br><span class="line"></span><br><span class="line">step2	检查本机的时区</span><br><span class="line">[root@zutuanxue ~]# timedatectl </span><br><span class="line">               Local time: 五 2020-01-17 17:36:14 CST</span><br><span class="line">           Universal time: 五 2020-01-17 09:36:14 UTC</span><br><span class="line">                 RTC time: 五 2020-01-17 09:36:56</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br><span class="line">注：如果不是本地时区请设置时区</span><br><span class="line">[root@zutuanxue ~]# timedatectl list-timezones | grep Shanghai</span><br><span class="line">Asia/Shanghai</span><br><span class="line">[root@zutuanxue ~]# timedatectl set-timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line">step3	修改配置文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line">server 192.168.2.100 iburst		#定义时间服务器的地址</span><br><span class="line">driftfile /var/lib/chrony/drift	</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 192.168.2.0/24	#定义允许谁来同步</span><br><span class="line">local stratum 10	#允许将本地时间作为标准</span><br><span class="line">leapsectz right/UTC	</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">bindaddress 192.168.2.100	#监听的网络接口</span><br><span class="line"></span><br><span class="line">step4	启动服务&amp;查看端口</span><br><span class="line">[root@zutuanxue ~]# systemctl start chronyd</span><br><span class="line">[root@zutuanxue ~]# lsof -i :123</span><br><span class="line"></span><br><span class="line">在192.168.2.200主机上</span><br><span class="line">step5	检查软件包</span><br><span class="line">[root@slave ~]# rpm -qa | grep chrony</span><br><span class="line">chrony-3.3-3.el8.x86_64</span><br><span class="line"></span><br><span class="line">step6	检查并设置本机时区</span><br><span class="line">[root@slave ~]# timedatectl </span><br><span class="line">               Local time: 五 2020-01-17 04:19:38 EST</span><br><span class="line">           Universal time: 五 2020-01-17 09:19:38 UTC</span><br><span class="line">                 RTC time: 五 2020-01-17 16:04:57</span><br><span class="line">                Time zone: America/New_York (EST, -0500)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br><span class="line">[root@slave ~]# timedatectl list-timezones |grep Shanghai</span><br><span class="line">Asia/Shanghai</span><br><span class="line">[root@slave ~]# timedatectl set-time Asia/Shanghai</span><br><span class="line"></span><br><span class="line">step7	修改配置文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line">server 192.168.2.100 iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line">step8 启动服务&amp;检查能否连接时间服务器</span><br><span class="line">[root@slave ~]# systemctl start chronyd</span><br><span class="line">[root@slave ~]# chronyc sources -v</span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  &#x27;^&#x27; = server, &#x27;=&#x27; = peer, &#x27;#&#x27; = local clock.</span><br><span class="line"> / .- Source state &#x27;*&#x27; = current synced, &#x27;+&#x27; = combined , &#x27;-&#x27; = not combined,</span><br><span class="line">| /   &#x27;?&#x27; = unreachable, &#x27;x&#x27; = time may be in error, &#x27;~&#x27; = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 192.168.2.100                11   6   377    57    +13ms[ +278us] +/- 3718us</span><br><span class="line"></span><br><span class="line">#可以在2.100上使用date -s命令修改时间，在2.200上重启服务，看到时间同步</span><br><span class="line">chronyc命令</span><br><span class="line"></span><br><span class="line">chronyc sources -v		查看时间同步源</span><br><span class="line">chronyc sourcestats -v	查看时间同步源状态</span><br><span class="line">timedatectl set-local-rtc 1	设置硬件时间硬件时间默认为UTC</span><br><span class="line">timedatectl set-ntp yes	启用NTP时间同步：</span><br><span class="line">chronyc tracking	校准时间服务器：</span><br></pre></td></tr></table></figure>

<h1 id="Linux-双机热备"><a href="#Linux-双机热备" class="headerlink" title="Linux 双机热备"></a>Linux 双机热备</h1><p> 阅读 (255970) </p>
<p> 分享</p>
<h2 id="一-Rsync概述"><a href="#一-Rsync概述" class="headerlink" title="一 Rsync概述"></a>一 Rsync概述</h2><h3 id="1-1、什么是Rsync"><a href="#1-1、什么是Rsync" class="headerlink" title="1.1、什么是Rsync"></a>1.1、什么是Rsync</h3><p>rsync是一款开源，快速，多功能的可实现增量的本地或远程的数据镜像同步备份的优秀工具。适用于多个平台。从软件名称可以看出来是远程同步的意思（remote sync）可实现全量备份与增量备份，因此非常适合用于架构集中式备份或异地备份等应用。</p>
<p><strong>官网：</strong> <a target="_blank" rel="noopener" href="http://rsync.samba.org/">http://rsync.samba.org/</a></p>
<p><strong>端口：</strong> 873</p>
<p><strong>运行模式：</strong> C&#x2F;S B&#x2F;S</p>
<h3 id="1-2、rsync特性"><a href="#1-2、rsync特性" class="headerlink" title="1.2、rsync特性"></a>1.2、rsync特性</h3><p>1、支持拷贝特殊文件如链接文件、设备等</p>
<p>2、可以有排除指定文件或目录同步的功能，相当于tar的排除功能</p>
<p>3、可以做到保持原文件或目录的权限、时间、软硬链接、属主、组等所有属性均不改变</p>
<p>4、可以实现增量同步，即只同步发生变化的数据，因此数据传输效率很高</p>
<p>5、可以使用rcp，rsh，ssh等方式来配合传输文件（rsync本身不对数据加密）</p>
<p>6、可以通过socket（进程方式）传输文件和数据（服务端和客户端）。</p>
<p>7、支持匿名的或认证（无须系统用户）的进程模式传输，可实现方便安全的进行数据备份及镜像</p>
<h3 id="1-3、传输方式"><a href="#1-3、传输方式" class="headerlink" title="1.3、传输方式"></a>1.3、传输方式</h3><p><strong>拉复制(下载)：</strong> rsync备份服务器定期去所有主机上拉取数据</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603525992068.png" alt="image20200116202338681.png"></p>
<p><strong>推复制（上传）：</strong> 所有主服务器将本地数据推送至从服务器</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526014361.png" alt="image20200116202157436.png"></p>
<p>在日常使用中，这两种形式都是混合使用的如：</p>
<p><strong>大量数据备份</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526031950.png" alt="image20200116202528449.png"></p>
<p><strong>异地备份</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526050140.png" alt="image20200116202556118.png"></p>
<h2 id="二-rsync拉复制实战"><a href="#二-rsync拉复制实战" class="headerlink" title="二 rsync拉复制实战"></a>二 rsync拉复制实战</h2><p><strong>环境：</strong></p>
<ul>
<li>两台主机，IP地址为192.168.11.16，192.168.11.100</li>
<li>操作系统为CentOS8</li>
<li>关闭selinux和防火墙</li>
</ul>
<p><strong>需求：</strong> 希望192.168.11.100这台主机&#x2F;cache目录的数据与192.168.11.16这台主机&#x2F;cache目录中的数据保持一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">step1	在192.168.11.16这台主机上制作rsync服务</span><br><span class="line">[root@zutuanxue ~]# rpm -qa | grep rsync</span><br><span class="line">rsync-3.1.3-4.el8.x86_64</span><br><span class="line">#检查是或否安装的相关软件包</span><br><span class="line">[root@zutuanxue ~]# mkdir /etc/rsyncd</span><br><span class="line">[root@zutuanxue ~]# vim rsyncd.conf</span><br><span class="line">uid=root			#定义以哪个用户的身份启动进程	</span><br><span class="line">gid=root			#定义以哪个组的身份启动进程</span><br><span class="line">port=873			#此服务默认端口873</span><br><span class="line">max connections=0		#最大连接数（正整数），0代表不限制。</span><br><span class="line">log file=/var/log/rsyncd.log	#定义日志文件位置</span><br><span class="line">pid file=/var/run/rsyncd.pid	#定义pid文件位置</span><br><span class="line">lock file=/var/run/rsyncd.lock	#定义锁定文件位置，避免多开</span><br><span class="line">motd file=/etc/rsyncd/rsyncd.motd	#定义欢迎信息</span><br><span class="line">read only=yes		#权限为只读</span><br><span class="line">hosts allow=192.168.11.0/24		#允许的网段</span><br><span class="line">hosts deny=*						#拒绝所有，允许个别</span><br><span class="line">[www]	#定义共享名称为www</span><br><span class="line">path=/cache				#路径</span><br><span class="line">list=yes					#允许别人看到</span><br><span class="line">ignore errors			#忽略错误</span><br><span class="line">auth users=hello		#授权的账号</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.secrets	#密码文件</span><br><span class="line"></span><br><span class="line">setp2	建立欢迎信息文件，内容随意</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3	建立密码文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyncd/rsyncd.secrets</span><br><span class="line">hello：123456</span><br><span class="line">[root@zutuanxue ~]# chmod 600 rsyncd.secrets</span><br><span class="line"></span><br><span class="line">step4	建立cache目录和文件</span><br><span class="line">[root@zutuanxue ~]# mkdir /cache</span><br><span class="line">[root@zutuanxue ~]# touch /cache/file&#123;1..10&#125;</span><br><span class="line"></span><br><span class="line">step5启动服务</span><br><span class="line">[root@zutuanxue ~]# rsync	--daemon		--config=/etc/rsyncd/rsyncd.conf</span><br><span class="line">[root@zutuanxue ~]# lsof	-i	:873</span><br><span class="line"></span><br><span class="line">step6	在192.168.11.100上建立密码文件并修改权限</span><br><span class="line">[root@slave ~]# vim /etc/rsync.pw</span><br><span class="line">123456</span><br><span class="line">[root@slave ~]# chmod 600 /etc/rsync.pw</span><br><span class="line">[root@slave ~]#	mkdir /cache</span><br><span class="line">step7	同步测试</span><br><span class="line">[root@slave ~]#	rsync -avzP	--delete --password-file=/etc/rsync.pw hello@192.168.11.16::www /cache </span><br><span class="line"></span><br><span class="line">rsync参数</span><br><span class="line">-a	归档模式传输，相当于-rlptgoD一起使用</span><br><span class="line">-v	详细模式输出</span><br><span class="line">-z	传输时进行压缩以提高效率</span><br><span class="line">-r	递归传输目录及子目录，即目录下得所有目录都同样传输</span><br><span class="line">-t	保持文件时间信息</span><br><span class="line">-o	保持文件属主信息</span><br><span class="line">-p	保持文件权限</span><br><span class="line">-g	保持文件属组信息</span><br><span class="line">-l 	保留软连接</span><br><span class="line">-P	显示同步的过程及传输时的进度等信息</span><br><span class="line">-D	保持设备文件信息</span><br><span class="line">-L	保留软连接指向的目标文件</span><br><span class="line">--exclude=PATTERN	指定排除不需要传输的文件模式</span><br><span class="line">--bwlimit=1m	限速传输</span><br><span class="line">--delete	让目标目录和源目录数据保持一致</span><br><span class="line">--password-file	指定密码文件位置</span><br><span class="line"></span><br><span class="line">step8	定义计划任务</span><br><span class="line">[root@slave ~]#	crontab -e</span><br><span class="line">* * * * * rsync -avzP	--delete --password-file=/etc/rsync.pw hello@192.168.11.16::www /cache</span><br><span class="line"></span><br><span class="line">step9	将11.16主机上文件进行调整，观察是否改变</span><br></pre></td></tr></table></figure>

<h2 id="三-Rsync推复制"><a href="#三-Rsync推复制" class="headerlink" title="三 Rsync推复制"></a>三 Rsync推复制</h2><p><strong>环境：</strong></p>
<ul>
<li>两台主机，IP地址为192.168.11.16，192.168.11.100</li>
<li>操作系统为CentOS8</li>
<li>关闭selinux和防火墙</li>
</ul>
<p><strong>需求：</strong> 希望192.168.11.100这台主机&#x2F;cache目录的数据与192.168.11.16这台主机&#x2F;cache目录中的数据保持一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">注：停止192.168.11.16主机上的rsync服务</span><br><span class="line">step1	在192.168.11.100这台主机上制作rsync服务</span><br><span class="line">[root@slave ~]# rpm -qa | grep rsync</span><br><span class="line">rsync-3.1.3-4.el8.x86_64</span><br><span class="line">#检查是或否安装的相关软件包</span><br><span class="line">[root@slave ~]# mkdir /etc/rsyncd</span><br><span class="line">[root@slave ~]# vim rsyncd.conf</span><br><span class="line">uid=root			#定义以哪个用户的身份启动进程	</span><br><span class="line">gid=root			#定义以哪个组的身份启动进程</span><br><span class="line">port=873			#此服务默认端口873</span><br><span class="line">max connections=0		#最大连接数（正整数），0代表不限制。</span><br><span class="line">log file=/var/log/rsyncd.log	#定义日志文件位置</span><br><span class="line">pid file=/var/run/rsyncd.pid	#定义pid文件位置</span><br><span class="line">lock file=/var/run/rsyncd.lock	#定义锁定文件位置，避免多开</span><br><span class="line">motd file=/etc/rsyncd/rsyncd.motd	#定义欢迎信息</span><br><span class="line">read only=no		#权限为不只读（可写）</span><br><span class="line">hosts allow=192.168.11.0/24		#允许的网段</span><br><span class="line">hosts deny=*						#拒绝所有，允许个别</span><br><span class="line">[www]	#定义共享名称为www</span><br><span class="line">path=/cache				#路径</span><br><span class="line">list=yes					#允许别人看到</span><br><span class="line">ignore errors			#忽略错误</span><br><span class="line">auth users=hello		#授权的账号</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.secrets	#密码文件</span><br><span class="line"></span><br><span class="line">setp2	建立欢迎信息文件，内容随意</span><br><span class="line">[root@slave ~]# vim /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3	建立密码文件</span><br><span class="line">[root@slave ~]# vim /etc/rsyncd/rsyncd.secrets</span><br><span class="line">hello：123456</span><br><span class="line">[root@slave ~]# chmod 600 rsyncd.secrets</span><br><span class="line"></span><br><span class="line">step4	建立cache目录</span><br><span class="line">[root@slave ~]# mkdir /cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step5启动服务</span><br><span class="line">[root@slave ~]# rsync	--daemon		--config=/etc/rsyncd/rsyncd.conf</span><br><span class="line">[root@slave ~]# lsof	-i	:873</span><br><span class="line"></span><br><span class="line">step6	在192.168.11.16上安装监控软件</span><br><span class="line">[root@zutuanxue ~]# tar fx sersync2.5_32bit_binary_stable_final.tar.gz -C /usr/src/</span><br><span class="line">[root@zutuanxue ~]# cd /usr/src/GNU-Linux-x86/</span><br><span class="line"></span><br><span class="line">step7	配置监控软件</span><br><span class="line">[root@zutuanxue ~]# vim confxml.xml </span><br><span class="line">&lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=&quot;/cache&quot;&gt;</span><br><span class="line">            &lt;remote ip=&quot;192.168.11.100&quot; name=&quot;www&quot;/&gt;</span><br><span class="line">						.</span><br><span class="line">						.</span><br><span class="line">						.</span><br><span class="line">					&lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=&quot;-artuz&quot;/&gt;</span><br><span class="line">            &lt;auth start=&quot;true&quot; users=&quot;hello&quot; passwordfile=&quot;/etc/rsync.pw&quot;/&gt;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsync.pw</span><br><span class="line">123456</span><br><span class="line">[root@zutuanxue ~]# chmod 600 rsync.pw </span><br><span class="line"></span><br><span class="line">step8	启动监控软件</span><br><span class="line">[root@zutuanxue ~]# ./sersync2	-r	#第一次启动加-r 可以查看到工作流程</span><br><span class="line"></span><br><span class="line">step9	重新打开一个终端，在192.168.11.16上建立、删除文件，去192.168.11.100上查看是否同步成功</span><br></pre></td></tr></table></figure>

<h1 id="部署linux网络安装服务器"><a href="#部署linux网络安装服务器" class="headerlink" title="部署linux网络安装服务器"></a>部署linux网络安装服务器</h1><p> 阅读 (3171521) </p>
<p> 分享</p>
<h2 id="一、批量部署概述"><a href="#一、批量部署概述" class="headerlink" title="一、批量部署概述"></a>一、批量部署概述</h2><p><strong>什么是PXE</strong><br>预启动执行环境（PXE）是由Intel公司开发的最新技术，工作于Client&#x2F;Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如：Windows95&#x2F;98&#x2F;2000&#x2F;windows2003&#x2F;windows2008&#x2F;winXP&#x2F;win7&#x2F;win8,linux系列系统等。</p>
<p><strong>PXE原理</strong><br>PXE是在没有软驱、硬盘、CD-ROM的情况下引导计算机的一种方式，也就是BIOS将使用PXE协议从网络引导。整个安装的过程是这样的：</p>
<p>PXE网卡启动 &#x3D;&gt; DHCP获得IP地址 &#x3D;&gt; 从TFTP上下载 pxelinux.0、vmlinuz、initr.img 等 &#x3D;&gt; 引导系统进入安装步骤 &#x3D;&gt; 通过PEX linux 下载ks.cfg文件并跟据ks.cfg自动化安装系统 &#x3D;&gt; 完成。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526488594.png" alt="image20200403143123698.png"></p>
<p><strong>TFTP服务</strong><br>TFTP是用来下载远程文件的最简单网络协议，它其于UDP协议而实现。</p>
<p><strong>什么是kickstart</strong><br>KickStart是一种无人职守安装方式。KickStart的工作原理是通过记录典型的安装过程中所需人工干预填写的各种参数，并生成一个名为ks.cfg的文件；在其后的安装过程中（不只局限于生成KickStart安装文件的机器）当出现要求填写参数的情况时，安装程序会首先去查找KickStart生成的文件，当找到合适的参数时，就采用找到的参数，当没有找到合适的参数时，才需要安装者手工干预。这样，如果KickStart文件涵盖了安装过程中出现的所有需要填写的参数时，安装者完全可以只告诉安装程序从何处取ks.cfg文件，然后去忙自己的事情。等安装完毕，安装程序会根据ks.cfg中设置的重启选项来重启系统，并结束安装。</p>
<h2 id="二、批量部署原理"><a href="#二、批量部署原理" class="headerlink" title="二、批量部署原理"></a>二、批量部署原理</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526515184.png" alt="image20200403144115628.png"></p>
<p><strong>1、PXE Client向DHCP发送请求：</strong><br>　　PXE Client从自己的PXE网卡启动，通过PXE BootROM(自启动芯片)会以UDP(简单用户数据报协议)发送一个广播请求，向本网络中的DHCP服务器索取IP。</p>
<p><strong>2、DHCP服务器提供信息：</strong><br>　　DHCP服务器收到客户端的请求，验证是否来至合法的PXE Client的请求，验证通过它将给客户端一个“提供”响应，这个“提供”响应中包含了为客户端分配的IP地址、pxelinux启动程序(TFTP)位置，以及配置文件所在位置。</p>
<p><strong>3、PXE客户端请求下载启动文件：</strong><br>　　客户端收到服务器的“回应”后，会回应一个帧，以请求传送启动所需文件。这些启动文件包括：pxelinux.0、pxelinux.cfg&#x2F;default、vmlinuz、initrd.img等文件。</p>
<p><strong>4、Boot Server响应客户端请求并传送文件：</strong><br>　　当服务器收到客户端的请求后，他们之间之后将有更多的信息在客户端与服务器之间作应答, 用以决定启动参数。BootROM由TFTP通讯协议从Boot Server下载启动安装程序所必须的文件(pxelinux.0、pxelinux.cfg&#x2F;default)。default文件下载完成后，会根据该文件中定义的引导顺序，启动Linux安装程序的引导内核。</p>
<p><strong>5、请求下载自动应答文件：</strong><br>　　客户端通过pxelinux.cfg&#x2F;default文件成功的引导Linux安装内核后，安装程序首先必须确定你通过什么安装介质来安装linux，如果是通过网络安装(NFS, FTP, HTTP)，则会在这个时候初始化网络，并定位安装源位置。接着会读取default文件中指定的自动应答文件ks.cfg所在位置，根据该位置请求下载该文件。<br>　　这里有个问题，在第2步和第5步初始化2次网络了，这是由于PXE获取的是安装用的内核以及安装程序等，而安装程序要获取的是安装系统所需的二进制包以及配置文件。因此PXE模块和安装程序是相对独立的，PXE的网络配置并不能传递给安装程序，从而进行两次获取IP地址过程，但IP地址在DHCP的租期内是一样的。</p>
<p><strong>6、客户端安装操作系统：</strong><br>　　将ks.cfg文件下载回来后，通过该文件找到OS Server，并按照该文件的配置请求下载安装过程需要的软件包。<br>　　OS Server和客户端建立连接后，将开始传输软件包，客户端将开始安装操作系统。安装完成后，将提示重新引导计算机。</p>
<h2 id="三、kickstart批量部署实战"><a href="#三、kickstart批量部署实战" class="headerlink" title="三、kickstart批量部署实战"></a>三、kickstart批量部署实战</h2><p>环境：</p>
<ul>
<li>selinux关闭，防火墙关闭</li>
<li>Server：192.168.2.100</li>
</ul>
<p><strong>Step 1 配置dnf源</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat server.repo </span><br><span class="line">[serverApp]</span><br><span class="line">name=app</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/AppStream</span><br><span class="line">[serverOS]</span><br><span class="line">name=os</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/BaseOS</span><br></pre></td></tr></table></figure>

<p><strong>Step 2 安装软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install dhcp-server tftp-server httpd syslinux -y</span><br></pre></td></tr></table></figure>

<p><strong>Step 3 搭建并启动DHCP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/dhcp/dhcpd.conf </span><br><span class="line">subnet 192.168.2.0 netmask 255.255.255.0 &#123;</span><br><span class="line">        option routers          192.168.2.100;</span><br><span class="line">        range                   192.168.2.10    192.168.2.20;</span><br><span class="line">        next-server             192.168.2.100;</span><br><span class="line">        filename                &quot;pxelinux.0&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status dhcpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlup | grep :67</span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           31465/dhcpd         </span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1345/dnsmasq        </span><br></pre></td></tr></table></figure>

<p><strong>Step 4 生成需要的文件并启动tftp服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cp /usr/share/syslinux/pxelinux.0		/var/lib/tftpboot/</span><br><span class="line">[root@zutuanxue ~]# cp /mnt/isolinux/&#123;vmlinuz,ldlinux.c32,initrd.img&#125; 		/var/lib/tftpboot/</span><br><span class="line">[root@zutuanxue ~]# mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line">[root@zutuanxue ~]# vim /var/lib/tftpboot/pxelinux.cfg/default			#生成default文件</span><br><span class="line">default linux</span><br><span class="line">timeout 3</span><br><span class="line">label linux</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img ip=dhcp method=http://192.168.2.100/RHEL ks=http://192.168.2.100/ks.cfg</span><br><span class="line">[root@zutuanxue mnt]# systemctl start tftp			#启动tftp服务</span><br><span class="line">[root@zutuanxue mnt]# systemctl status tftp</span><br><span class="line">[root@zutuanxue mnt]# netstat -antulp | grep :69</span><br><span class="line">udp6       0      0 :::69                   :::*                                1/systemd           </span><br></pre></td></tr></table></figure>

<p><strong>Step 5 搭建并启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# mkdir /var/www/html/RHEL		#建立软件包存放目录</span><br><span class="line">[root@zutuanxue ~]# mount /dev/cdrom /var/www/html/RHEL		#将光盘挂载到对应目录中</span><br></pre></td></tr></table></figure>

<p><strong>Step 6 生成ks.cfg文件</strong></p>
<p>由于CentOS8.0中没有system-config-kickstart包，所以无法通过工具生成ks文件，需要手动生成，例子中root用户和新建的hello用户的密码都为‘&#96;123qwe’</p>
<p>如果需要自己额外指定密码，请使用其它工具进行转换，例如doveadm命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">cp /root/anaconda-ks.cfg /var/www/html/ks.cfg	#生成ks.cfg文件</span><br><span class="line">[root@zutuanxue ~]# vim /var/www/html/ks.cfg</span><br><span class="line">#version=RHEL8</span><br><span class="line">ignoredisk --only-use=sda</span><br><span class="line">autopart --type=lvm</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all			#删除所有分区</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">url  --url=&quot;http://192.168.2.100/RHEL/&quot;			#指定安装URL</span><br><span class="line"># Keyboard layouts</span><br><span class="line">keyboard --vckeymap=cn --xlayouts=&#x27;cn&#x27;</span><br><span class="line"># System language</span><br><span class="line">lang zh_CN.UTF-8</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate</span><br><span class="line">network  --hostname=localhost.localdomain</span><br><span class="line">##root用户的密码&quot;111111&quot;</span><br><span class="line">rootpw --iscrypted $6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1</span><br><span class="line"># X Window System configuration information</span><br><span class="line">xconfig  --startxonboot</span><br><span class="line"># Run the Setup Agent on first boot</span><br><span class="line">#firstboot disable		#初次启动设置</span><br><span class="line">firstboot --disable</span><br><span class="line"># System services</span><br><span class="line">services --enabled=&quot;chronyd&quot;</span><br><span class="line"># System timezone</span><br><span class="line">timezone America/New_York --isUtc</span><br><span class="line">#Reboot after installation	#安装完成后自动重启</span><br><span class="line">reboot</span><br><span class="line"># License agreement		#同意授权协议</span><br><span class="line">eula --agreed</span><br><span class="line">#添加一个普通用户名字为zutuanxue密码&quot;111111&quot; 属组为 whell</span><br><span class="line">user --groups=wheel --name=zutuanxue --password=$6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1 --iscrypted --gecos=&quot;zutuanxue&quot;</span><br><span class="line">%packages</span><br><span class="line">@^graphical-server-environment</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%addon com_redhat_kdump --disable --reserve-mb=&#x27;auto&#x27;</span><br><span class="line"></span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%anaconda</span><br><span class="line">pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok</span><br><span class="line">pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<p><strong>Step 7 修改文件权限，启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chmod a+r /var/www/html/ks.cfg</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status httpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlp | grep :80</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      33976/httpd         </span><br></pre></td></tr></table></figure>

<p><strong>Step 8 测试</strong></p>
<p>选择网络启动</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526811897.png" alt="image20191202110450898.png"></p>
<p>获取IP和相关文件</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526828444.png" alt="image20191202110525859.png"></p>
<p>开启安装进程</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526884300.png" alt="install6.png"></p>
<p>安装完成后自动重启</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526915193.png" alt="install7.png"></p>
<h2 id="四、kickstart-uefi批量部署"><a href="#四、kickstart-uefi批量部署" class="headerlink" title="四、kickstart+uefi批量部署"></a>四、kickstart+uefi批量部署</h2><p><strong>环境：</strong></p>
<ul>
<li>selinux关闭，防火墙关闭</li>
<li>Server：192.168.2.100</li>
</ul>
<p><strong>Step 1 配置dnf源</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat server.repo </span><br><span class="line">[serverApp]</span><br><span class="line">name=app</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/AppStream</span><br><span class="line">[serverOS]</span><br><span class="line">name=os</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/BaseOS</span><br></pre></td></tr></table></figure>

<p><strong>Step 2 安装软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install dhcp-server tftp-server httpd -y</span><br></pre></td></tr></table></figure>

<p><strong>Step 3 搭建并启动DHCP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/dhcp/dhcpd.conf </span><br><span class="line">subnet 192.168.2.0 netmask 255.255.255.0 &#123;</span><br><span class="line">        option routers          192.168.2.100;</span><br><span class="line">        range                   192.168.2.10    192.168.2.20;</span><br><span class="line">        next-server             192.168.2.100;</span><br><span class="line">        filename                &quot;BOOTX64.EFI&quot;;#注意差异，使用的不是pxelinux.0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status dhcpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlup | grep :67</span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           31465/dhcpd         </span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1345/dnsmasq        </span><br></pre></td></tr></table></figure>

<p><strong>Step 4 生成需要的文件并启动tftp服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cd /mnt/EFI/BOOT/</span><br><span class="line">[root@zutuanxue BOOT]# cp BOOTX64.EFI grub.cfg grubx64.efi /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cp /mnt/isolinux/&#123;vmlinuz,initrd.img&#125; 		/var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /var/lib/tftpboot/grub.cfg</span><br><span class="line">set default=&quot;0&quot;</span><br><span class="line">set timeout=3</span><br><span class="line">menuentry &#x27;Install CentOS Linux 8.0.1905&#x27;  &#123;</span><br><span class="line">        linuxefi /vmlinuz ip=dhcp ks=http://192.168.2.100/ks.cfg</span><br><span class="line">        initrdefi /initrd.img</span><br><span class="line">&#125;</span><br><span class="line">[root@zutuanxue mnt]# systemctl start tftp			#启动tftp服务</span><br><span class="line">[root@zutuanxue mnt]# systemctl status tftp</span><br><span class="line">[root@zutuanxue mnt]# netstat -antulp | grep :69</span><br><span class="line">udp6       0      0 :::69                   :::*                                1/systemd           </span><br></pre></td></tr></table></figure>

<p><strong>Step 5 搭建并启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# mkdir /var/www/html/RHEL		#建立软件包存放目录</span><br><span class="line">[root@zutuanxue ~]# mount /dev/cdrom /var/www/html/RHEL		#将光盘挂载到对应目录中</span><br></pre></td></tr></table></figure>

<p><strong>Step 6 生成ks.cfg文件</strong></p>
<p>由于CentOS8.0中没有system-config-kickstart包，所以无法通过工具生成ks文件，需要手动生成，例子中root用户和新建的hello用户的密码都为‘&#96;123qwe’</p>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/labs/kickstartconfig/">https://access.redhat.com/labs/kickstartconfig/</a></p>
<p>如果需要自己额外指定密码，请使用其它工具进行转换，例如doveadm命令，但是系统没有这个工具，所以推荐使用python来实现</p>
<p>注意：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# python3 -c &#x27;import crypt,getpass;pw=&quot;zutuanxue&quot;;print(crypt.crypt(pw))&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>生成ks.cfg文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">cp /root/anaconda-ks.cfg /var/www/html/ks.cfg	#生成ks.cfg文件</span><br><span class="line">[root@zutuanxue ~]# vim /var/www/html/ks.cfg</span><br><span class="line">#version=RHEL8</span><br><span class="line">ignoredisk --only-use=nvme0n1    ###注意这是与BIOS方式差异的位置，注意设备类型，可在BIOS中查看到</span><br><span class="line">autopart --type=lvm</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all			#删除所有分区</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">url     --url=&quot;http://192.168.2.100/RHEL/&quot;			#指定安装URL</span><br><span class="line"># Keyboard layouts</span><br><span class="line">keyboard --vckeymap=cn --xlayouts=&#x27;cn&#x27;</span><br><span class="line"># System language</span><br><span class="line">lang zh_CN.UTF-8</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate</span><br><span class="line">network  --hostname=localhost.localdomain</span><br><span class="line"># Root password	“`123qwe”			##root用户的密码&quot;111111&quot;</span><br><span class="line">rootpw --iscrypted $6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1</span><br><span class="line"># X Window System configuration information</span><br><span class="line">xconfig  --startxonboot</span><br><span class="line"># Run the Setup Agent on first boot</span><br><span class="line">#firstboot disable		#初次启动设置</span><br><span class="line">firstboot --disable</span><br><span class="line"># System services</span><br><span class="line">services --enabled=&quot;chronyd&quot;</span><br><span class="line"># System timezone</span><br><span class="line">timezone America/New_York --isUtc</span><br><span class="line">#Reboot after installation	#安装完成后自动重启</span><br><span class="line">reboot</span><br><span class="line"># License agreement		#同意授权协议</span><br><span class="line">eula --agreed</span><br><span class="line">#添加一个普通用户名字为zutuanxue密码&quot;111111&quot; 属组为 whell</span><br><span class="line">user --groups=wheel --name=zutuanxue --password=$6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1 --iscrypted --gecos=&quot;zutuanxue&quot;</span><br><span class="line">%packages</span><br><span class="line">@^graphical-server-environment</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%addon com_redhat_kdump --disable --reserve-mb=&#x27;auto&#x27;</span><br><span class="line"></span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%anaconda</span><br><span class="line">pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok</span><br><span class="line">pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<p><strong>Step 7 修改文件权限，启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chmod a+r /var/www/html/ks.cfg</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status httpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlp | grep :80</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      33976/httpd         </span><br></pre></td></tr></table></figure>

<p><strong>Step 8 测试</strong></p>
<p>新建虚拟机的是要选择自定义使用UEFI</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/zutuanxue-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8/" class="post-title-link" itemprop="url">zutuanxue-Linux系统管理宝典</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 12:19:37" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:37-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 09:57:26" itemprop="dateModified" datetime="2022-11-28T09:57:26-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/zutuanxue/" itemprop="url" rel="index"><span itemprop="name">zutuanxue</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="操作系统介绍"><a href="#操作系统介绍" class="headerlink" title="操作系统介绍"></a>操作系统介绍</h1><p> 阅读 (100095) </p>
<p> 分享</p>
<h2 id="一、操作系统的介绍"><a href="#一、操作系统的介绍" class="headerlink" title="一、操作系统的介绍"></a>一、操作系统的介绍</h2><p>操作系统是<strong>管理计算机硬件与软件资源</strong>的计算机程序，会对计算机管理硬件、驱动硬件；管理软件；资源分配与回收，操作系统也提供一个让用户与系统交互的操作界面。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/11/15/1605446237843.png" alt="计算机构成.png"></p>
<p>在计算机中，操作系统是其最基本也是最为重要的基础性系统软件。</p>
<ul>
<li>从计算机用户的角度来说：计算机操作系统体现在其提供的各项服务；</li>
<li>从程序员的角度来说：其主要是指用户登录的界面或者接口；</li>
<li>从设计人员的角度来说：就是指各式各样模块和单元之间的联系。</li>
</ul>
<p>经过几十年以来的发展，计算机操作系统已经由一开始的简单控制循环体发展成为较为复杂的分布式操作系统，再加上计算机用户需求的愈发多样化，计算机操作系统已经成为既复杂而又庞大的计算机软件系统之一。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602246931350.png" alt="image20200316191847256.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602246940516.png" alt="image20200316192238908.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602247166613.jpg" alt="16022471411.jpg"></p>
<h2 id="二、操作系统的功能"><a href="#二、操作系统的功能" class="headerlink" title="二、操作系统的功能"></a>二、操作系统的功能</h2><p>操作系统主要包括以下几个方面的功能 ：</p>
<p>①进程管理：其工作主要是进程调度，解决处理器的调度、 分配和回收等问题 。如：根据进程的优先级不同，来决定优先处理哪个进程的数据</p>
<p>②存储管理分为几种功能：<br>– 存储分配，如：内存资源的分配；<br>– 存储共享，如：不同进程可以共享内存中的数据等；<br>– 存储保护，如：保证内存中的程序只能在指定的存储区域内活动，互不干扰 ；<br>– 存储扩张，如：利用虚拟内存技术或者自动覆盖技术，从逻辑上扩充内存。</p>
<p>③设备管理分有以下功能：<br>– 设备分配，也就是为对应的进程分配合适的设备及相关硬件；<br>– 设备传输控制，主要是控制各种I&#x2F;O设备和内存或CPU之间的数据传送 ；<br>– 设备独立性，又称设备无关性，是指应用程序独立于具体使用的物理设备。</p>
<p>④文件管理：<br>– 文件存储空间的管理，可以简单理解为，硬盘上哪些地方空着我可以写入数据，哪些地方的数据删除了，我可以将空间回收，以便有新的数据写入时使用，只不过这个是针对于块的操作；<br>– 目录管理 ，让我们可以按照名字进行存取，提高查询的速度等；<br>– 文件操作管理，如：文件的创建，删除，读，写等；<br>– 文件保护，如：为了防止文件被破坏或修改，针对不同的用户设置不同的权限。</p>
<p>⑤作业管理是负责处理用户提交的任何要求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">操作系统是一个计算机程序，是人类和计算机硬件沟通的一个桥梁，它解决了人不懂二进制的问题，同时也解决了硬件听不懂人下发指令语言。</span><br><span class="line"></span><br><span class="line">相对于人来说他是人的大管家，负责管理硬件、支配硬件干活、把硬件工作的结果反馈给人。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这就是操作系统的作用，人类的帮手。</span><br></pre></td></tr></table></figure>

<h2 id="三、操作系统的分类"><a href="#三、操作系统的分类" class="headerlink" title="三、操作系统的分类"></a>三、操作系统的分类</h2><p>计算机的操作系统根据不同的用途分为不同的种类</p>
<ul>
<li><p><strong>从功能角度分类</strong>: 实时系统、批处理系统、分时系统、网络操作系统等。</p>
<p><strong>实时系统</strong>主要是指当外界事件或数据产生时，能够接受并以足够快的速度予以处理，其处理的结果又能在规定的时间之内来控制生产过程或对处理系统做出快速响应，调度一切可利用的资源完成实时任务，并控制所有实时任务协调一致运行的操作系统。提供及时响应和高可靠性是其主要特点。常用于工业控制，航空，航天等领域，目前主流的实时操作系统有uc&#x2F;OS、FreeRTOS、TI DSP&#x2F;BIOS、RT-Thread</p>
<p><strong>批处理系统</strong>在1960年左右出现，是指用户将一批作业提交给操作系统后就不再干预，由操作系统控制它们自动运行，批处理操作系统不具有交互性，它是为了提高CPU的利用率而提出的一种操作系统。</p>
<p><strong>分时系统</strong>可以实现用户的人机交互需要，多个用户共同使用一个主机，很大程度上节约了资源成本，如linux</p>
<p><strong>网络操作系统</strong>是向网络计算机提供服务的特殊的操作系统。借由网络达到互相传递数据与各种消息，分为服务器及客户端，我们日常接触的windows、linux等也都属于网络操作系统范畴</p>
<p><strong>分布式操作系统</strong> 简单来说就是有一堆计算机，各自物理硬件上是独立的，通过网络相连，互相通信，通过统一的“中间件”进行协调，共享资源，协同分工完成一件任务的计算机集群</p>
</li>
<li><p><strong>从使用角度分类:</strong><br><strong>个人版系统:</strong> xp win7 win10 fedora<br><strong>网络版系统:</strong> win2008 win2012 RHEL CentOS</p>
</li>
</ul>
<h1 id="Linux起源和发展"><a href="#Linux起源和发展" class="headerlink" title="Linux起源和发展"></a>Linux起源和发展</h1><p> 阅读 (92870) </p>
<p> 分享</p>
<h2 id="一、什么是linux？"><a href="#一、什么是linux？" class="headerlink" title="一、什么是linux？"></a>一、什么是linux？</h2><p><strong>Linux是一套免费使用和自由传播的类Unix操作系统</strong>，是一个基于POSIX和Unix的多用户、多任务、支持多线程和多CPU的操作系统。伴随着互联网的发展，Linux得到了来自全世界软件爱好者、组织、公司的支持。它除了在服务器操作系统方面保持着强劲的发展势头以外，在个人电脑、嵌入式系统上都有着长足的进步。使用者不仅可以直观地获取该操作系统的实现机制，而且可以根据自身的需要来修改完善这个操作系统，使其最大化地适应用户的需要。</p>
<p><strong>Linux系统应用</strong><br>Linux不仅系统性能稳定，而且是开源软件。其核心防火墙组件性能高效、配置简单，保证了系统的安全。在很多企业网络中，为了追求速度和安全，Linux操作系统不仅仅是被网络运维人员当作服务器使用，Linux既可以当作服务器，又可以当作网络防火墙是Linux的 一大亮点。</p>
<p><strong>linux优点</strong><br>Linux与其他操作系统相比 ，具有开放源码、没有版权、技术社区用户多等特点 ，开放源码使得用户可以自由裁剪，灵活性高，功能强大，成本低。尤其系统中内嵌网络协议栈 ，经过适当的配置就可实现路由器的功能。这些特点使得Linux成为开发路由交换设备的理想开发平台。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602247349375.png" alt="clip_image001.png"></p>
<h2 id="二、Linux的起源"><a href="#二、Linux的起源" class="headerlink" title="二、Linux的起源"></a>二、Linux的起源</h2><p>Linux操作系统的诞生、发展和成长过程始终依赖着五个重要支柱：</p>
<ul>
<li>Unix操作系统</li>
<li>MINIX操作系统</li>
<li>GNU计划</li>
<li>POSIX标准</li>
<li>Internet网络。</li>
</ul>
<p>20世纪80年代，计算机硬件的性能不断提高，PC的市场不断扩大，当时可供计算机选用的操作系统主要有Unix、DOS和MacOS这几种。Unix价格昂贵，不能运行于PC；DOS显得简陋，且源代码被软件厂商严格保密；<br>MacOS是一种专门用于苹果计算机的操作系统。此时，计算机科学领域迫切需要一个更加完善、强大、廉价和完全开放的操作系统。由于供教学使用的典型操作系统很少，因此当时在荷兰当教授的美国人AndrewS.Tanenbaum编写了一个操作系统，名为MINIX，为了向学生讲述操作系统内部工作原理。MINIX虽然很好，但只是一个用于教学目的的简单操作系统，而不是一个强有力的实用操作系统，然而最大的好处就是公开源代码。全世界学计算机的学生都通过钻研MINIX源代码来了解电脑里运行的MINIX操作系统，芬兰赫尔辛基大学大学二年级的学生Linus Torvalds就是其中一个，在吸收了MINIX精华的基础上，Linus于1991年写出了属于自己的Linux操作系统，版本为Linux0.01，是Linux时代开始的标志。他利用Unix的核心，去除繁杂的核心程序，改写成适用于一般计算机的x86系统，并放在网络上供大家下载，1994年推出完整的核心Version1.0，至此，Linux逐渐成为功能完善、稳定的操作系统，并被广泛使用。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602247363082.png" alt="clip_image002.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/9/1602247367625.png" alt="clip_image003.png"></p>
<h2 id="三、Linux的发展史"><a href="#三、Linux的发展史" class="headerlink" title="三、Linux的发展史"></a>三、Linux的发展史</h2><p>1984年，Andrew S.Tanenbaum开发了用于教学的UNIX系统，命名为Mininx。</p>
<p>1989年，Andrew S.Tanenbaum将Minix系统运行于x86的PC平台。</p>
<p>1990年，芬兰赫尔辛基大学学生Linux Torvalds首次接触Minix系统。</p>
<p>1991年，Linux Torvalds开始在Minix上编写各种驱动程序等操作系统内核组件。</p>
<p>1991年年底，Linux Torvalds公开了Linux内核源码0.02版</p>
<p>1994年，Linux 1.0版本发布</p>
<p>1996年，Linux 2.0版本发布</p>
<p>2011年，Linux3.0版本发布</p>
<p>这里面我们所介绍的发布时间，指的都是内核大版本的发布时间，次要版本号更新时间请参看FAQ，其中偶数版的内核为稳定版，奇数版的内核为开发版或测试版</p>
<h2 id="四、Linux和Unix的对比"><a href="#四、Linux和Unix的对比" class="headerlink" title="四、Linux和Unix的对比"></a>四、Linux和Unix的对比</h2><p>我们所讨论的差异只从硬件支持，版权和价格这些来讨论他们之间的区别，UNIX是一个功能强大、性能全面的多用户、多任务操作系统，可以应用从巨型计算机到普通PC机等多种不同的平台上，是应用面最广、影响力最大的操作系统。</p>
<ul>
<li>Linux是一种外观和性能与UNIX相同或更好的操作系统，但Linux不源于任何版本的UNIX的源代码，并不是UNIX，而是一个类似于UNIX的产品。</li>
<li>Linux是开发源代码的自由软件,UNIX是对源代码实行知识产权保护的传统商业软件.</li>
<li>UNIX系统大多是与硬件配套的,而Linux则可运行在多种硬件平台上.</li>
<li>UNIX是商业软件，需要收费,而Linux是自由软件,免费、公开源代码的</li>
<li>在对硬件的要求上,linux比unix要低,没有unix那么苛刻.在安装上linux比unix容易掌握.</li>
</ul>
<h2 id="五、类Unix操作系统介绍"><a href="#五、类Unix操作系统介绍" class="headerlink" title="五、类Unix操作系统介绍"></a>五、类Unix操作系统介绍</h2><ul>
<li>什么是类Unix操作系统？</li>
</ul>
<p>类Unix系统（英文：Unix-like）是指继承UNIX的设计风格演变出来的系统，这些操作系统虽然有的是自由软件，有的是商业软件，但都相当程度地继承了原始UNIX的特性，有许多相似处，并且都在一定程度上遵守POSIX规范，但是它们却并不含有UNIX的源代码。由于UNIX标准认定价格昂贵，所以目前唯一获得UNIX标准认定的为苹果的MACOS系统。</p>
<ul>
<li>类Unix操作系统有哪些？</li>
</ul>
<p>FreeBSD及其衍生产品、OpenBSD及其衍生产品、GNU&#x2F;Linux、GNU&#x2F;OpenSolaris等等，这里面我们所介绍的几种主流的类Unix操作系统，他们大多都属于开源产品，在互联网上是可以获取到的，有兴趣的同学可以自行搜索并下载安装</p>
<p>并且接触到了一个概念叫做“类Unix操作系统”，也知道了这个类Unix操作系统的家族非常庞大。</p>
<h2 id="六、linux厂商"><a href="#六、linux厂商" class="headerlink" title="六、linux厂商"></a>六、linux厂商</h2><p>真实因为GPL,很多公司基于linux的源码进行修改、优化后推出了自己的产品，其中最著名的就是redhat，其实每个国家都有自己的linux系统，比如中国最早的红旗linux，现在的中科麒麟、深度，都是linux系统.企业通过收取技术服务费来进行盈利。</p>
<h2 id="七、linux的应用"><a href="#七、linux的应用" class="headerlink" title="七、linux的应用"></a>七、linux的应用</h2><p>100% 的世界超级计算机跑在 Linux 上。包括 NASA 的集群。</p>
<p>SpaceX 在其灰背隼火箭引擎上使用具有特殊容错设计的 Linux。借此，Linux 帮助完成了 32 次航天任务。 埃隆·马斯克 特斯拉</p>
<p>电影泰坦尼克是首个基于 Linux 服务器拍摄的电影。</p>
<p>即使 Linux 的最大的竞争操作系统微软 Windows 也拥抱 Linux。Windows 最近集成了 Ubuntu Bash 到 Windows 10 里了。</p>
<h2 id="八、视频学习"><a href="#八、视频学习" class="headerlink" title="八、视频学习"></a>八、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906825528561369608?is_new_connect=0&is_new_user=0">视频：linux介绍</a><br><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6906825493740257804&logTag=40b7533f87d8f1a8cc8d">视频：linux起源</a></p>
<h1 id="GNU和GPL"><a href="#GNU和GPL" class="headerlink" title="GNU和GPL"></a>GNU和GPL</h1><p> 阅读 (17677) </p>
<p> 分享</p>
<h2 id="一、GNU介绍"><a href="#一、GNU介绍" class="headerlink" title="一、GNU介绍"></a>一、GNU介绍</h2><p><strong>GNU</strong>是一个自由的操作系统，其内容软件完全以GPL方式发布。这个操作系统是GNU计划的主要目标，名称来自GNU’s Not Unix!的缩写，因为GNU的设计类似Unix，但它不包含具著作权的Unix代码。GNU的创始人，理查德·马修·斯托曼。</p>
<p>作为操作系统，GNU的发展仍未完成，其中最大的问题是具有完备功能的内核尚未被开发成功。GNU的内核是自由软件基金会发展的重点，但是其发展尚未成熟。在实际使用上，多半使用Linux内核、FreeBSD等替代方案，作为系统核心，其中主要的操作系统是Linux的发行版。Linux操作系统包涵了Linux内核与其他自由软件项目中的GNU组件和软件，可以被称为GNU&#x2F;Linux。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602323583201.png" alt="clip_image001.png"></p>
<p>1985年Richard Stallman又创立了自由软件基金会来为GNU计划提供技术、法律以及财政支持。尽管GNU计划大部分时候是由个人自愿无偿贡献，但FSF有时还是会聘请程序员帮助编写。当GNU计划开始逐渐获得成功时，一些商业公司开始介入开发和技术支持。</p>
<p>到了1990年，GNU计划已经开发出的软件包括了一个功能强大的文字编辑器Emacs。GCC（GNU Compiler Collection，GNU编译器集合），是一套由 GNU 开发的编程语言编译器。以及大部分UNIX系统的程序库和工具。唯一依然没有完成的重要组件就是操作系统的内核。</p>
<p>1991年Linus Torvalds编写出了与UNIX兼容的Linux操作系统内核并在GPL条款下发布。Linux之后在网上广泛流传，许多程序员参与了开发与修改。1992年Linux与其他GNU软件结合，完全自由的操作系统正式诞生。该操作系统往往被称为“GNU&#x2F;Linux”或简称Linux。许多UNIX系统上也安装了GNU软件，因为GNU软件的质量比之前UNIX的软件还要好。GNU工具还被广泛地移植到Windows和Mac OS上。</p>
<h2 id="理查德·马修·斯托曼"><a href="#理查德·马修·斯托曼" class="headerlink" title="理查德·马修·斯托曼"></a>理查德·马修·斯托曼</h2><p>理查德·马修·斯托曼（英语：Richard Matthew Stallman，简称rms，有时也用大写的RMS，1953年3月16日－），美国程序员，自由软件活动家。他发起自由软件运动，倡导软件用户能够对软件自由进行使用、学习、共享和修改，确保了这些软件被称作自由软件。斯托曼发起了GNU项目，并成立了自由软件基金会。他开发了GCC、GDB、GNU Emacs，同时编写了GNU通用公共许可协议。</p>
<p>为了创建一个完全由免费软件组成的类Unix计算机操作系统，斯托曼在1983年9月推出了GNU项目。借此又发起了自由软件运动。他迄今为止一直是GNU项目的组织者，作为主要开发者的他开发了一些被广泛使用的GNU软件。在1985年10月他创立了自由软件基金会。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602323603539.png" alt="clip_image002.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602323625454.png" alt="clip_image003.png"></p>
<h2 id="二、自由软件基金会介绍"><a href="#二、自由软件基金会介绍" class="headerlink" title="二、自由软件基金会介绍"></a>二、自由软件基金会介绍</h2><p><strong>自由软件基金会</strong>（英语：<strong>Free Software Foundation</strong>，<strong>FSF</strong>）是一个致力于推广自由软件的美国民间非营利性组织。它于1985年10月由理查德·斯托曼创建。其主要工作是运行GNU计划，开发更多的自由软件。</p>
<p>从其创建到1990年代中自由软件基金会的基金主要被用来雇佣编程师来发展自由软件。从1990年代中开始写自由软件的公司和个人繁多，因此自由软件基金会的雇员和志愿者主要在自由软件运动的法律和结构问题上工作。</p>
<p><strong>主要工作</strong>：</p>
<ul>
<li>GNU</li>
</ul>
<p>自由软件基金会最早的目的在于促进自由软件的开发，但自由软件基金会也有自己的GUN项目</p>
<ul>
<li>发布并管理许可证</li>
</ul>
<p>自由软件基金会具有发布GNU通用公共许可证和其它GNU许可证的能力和资源，但自由软件基金会只对它拥有版权的软件负责。其它软件必须由它们自己的拥有人来负责</p>
<ul>
<li>GNU许可证</li>
</ul>
<p>GNU通用公共许可证是自由软件工程中最普及的许可证。目前的版本是2007年发表的。自由软件基金会还发布了GNU宽通用公共许可证和GNU自由文档许可证</p>
<ul>
<li>监督版权</li>
</ul>
<p>自由软件基金会拥有大多数GNU软件和一些非GNU自由软件的版权。每个GNU软件包的贡献者必须签署版权文件，这样自由软件基金会可以在诉讼案中在法庭上维护这些软件。此外这样假如许可证有所变化的话不必征求软件所有的贡献者的同意。</p>
<ul>
<li>自由软件目录</li>
</ul>
<p>自由软件目录是所有自由软件包的一个列表。其中列出的每个软件包含47条信息，比如工程的主页、程序师、编程语言等。目的是提供一个自由软件的搜索引擎和为用户提供一个检查一个软件包是否自由的工具。自由软件基金会为此从联合国教科文组织获得少数基金。计划是将来这个目录可以翻译成不同的语言。</p>
<ul>
<li>颁发奖励</li>
</ul>
<p>自由软件基金会每年颁发两部奖励：自由软件进步大奖和社会福利自由软件奖励。</p>
<h2 id="三、GPL介绍"><a href="#三、GPL介绍" class="headerlink" title="三、GPL介绍"></a>三、GPL介绍</h2><p><strong>GNU</strong>通用公共许可协议（英语：GNU General Public License，缩写GNU GPL 或 GPL），是被广泛使用的自由软件许可证，给予了终端用户运行、学习、共享和修改软件的自由。许可证最初由自由软件基金会的理查德·斯托曼为GNU项目所撰写，并授予计算机程序的用户自由软件定义的权利。GPL是一个Copyleft许可证，这意味着派生作品只能以相同的许可条款分发。 GPL是第一个普遍使用的Copyleft许可证。历史上，GPL许可证系列一直是自由和开源软件领域最受欢迎的软件许可之一。</p>
<h2 id="GPL历史"><a href="#GPL历史" class="headerlink" title="GPL历史"></a>GPL历史</h2><p>GPLv1：GPL版本1，即最初的版本，发布于1989年一月</p>
<p>GPLv2：发布于1991年6月，这个版本一直延续到1999年，并分支出一个派生的LGPL版本号为2.1，并将其重命名为轻量级通用公共许可证（又称宽通用公共许可证）</p>
<p>GPLv3：2007年6月29日正式发布</p>
<h1 id="各发行版Linux介绍"><a href="#各发行版Linux介绍" class="headerlink" title="各发行版Linux介绍"></a>各发行版Linux介绍</h1><p> 阅读 (28990) </p>
<p> 分享</p>
<h2 id="一、RedHat-Enterprise-Linux介绍"><a href="#一、RedHat-Enterprise-Linux介绍" class="headerlink" title="一、RedHat Enterprise Linux介绍"></a>一、RedHat Enterprise Linux介绍</h2><p>可能这是最著名的Linux版本了，Red Hat Linux已经创造了自己的品牌，越来越多的人听说过它。Red Hat在1994年创业，当时聘用了全世界500多名员工，他们都致力于开放的源代码体系。</p>
<p>Red Hat Linux是公共环境中表现上佳的服务器。它拥有自己的公司，能向用户提供一套完整的服务，这使得它特别适合在公共网络中使用。这个版本的Linux也使用最新的内核，还拥有大多数人都需要使用的主体软件包。</p>
<p>Red Hat Linux的安装过程也十分简单明了。它的图形安装过程提供简易设置服务器的全部信息。磁盘分区过程可以自动完成，还可以选择GUI工具完成，即使对于 Linux新手来说这些都非常简单。选择软件包的过程也与其他版本类似；用户可以选择软件包种类或特殊的软件包。系统运行起来后，用户可以从Web站点和 Red Hat那里得到充分的技术支持。是一个符合大众需求的最优版本。在服务器和桌面系统中它都工作得很好。Red Hat通过论坛和邮件列表提供广泛的技术支持，它还有自己公司的电话技术支持，后者对要求更高技术支持水平的集团客户更有吸引力。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324034512.png" alt="clip_image001.png"></p>
<h2 id="二、Ubuntu介绍"><a href="#二、Ubuntu介绍" class="headerlink" title="二、Ubuntu介绍"></a>二、Ubuntu介绍</h2><p>Ubuntu是一个以桌面应用为主的Linux操作系统，基于Debian，与Debian的不同在于它每6个月会发布一个新版本。Ubuntu的目标在于为一般用户提供一个最新的、同时又相当稳定的主要由自由软件构建而成的操作系统。Ubuntu具有庞大的社区力量，用户可以方便地从社区获得帮助。随着云计算的流行，ubuntu推出了一个云计算环境搭建的解决方案，可以在其官方网站找到相关信息。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324049012.png" alt="clip_image002.png"></p>
<h2 id="三、Debian介绍"><a href="#三、Debian介绍" class="headerlink" title="三、Debian介绍"></a>三、Debian介绍</h2><p>广义的Debian是指一个致力于创建自由操作系统的合作组织及其作品，由于Debian项目众多内核分支中以Linux内核为主，而且 Debian开发者所创建的操作系统中绝大部分基础工具来自于GNU工程 ，因此 “Debian” 常指Debian GNU&#x2F;Linux。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324062244.png" alt="clip_image003.png"></p>
<h2 id="四、open-SUSE介绍"><a href="#四、open-SUSE介绍" class="headerlink" title="四、open SUSE介绍"></a>四、open SUSE介绍</h2><p>openSUSE 项目是由 Novell 发起的开源社区计划。 旨在推进 Linux 的广泛使用，提供了自由简单的方法来获得世界上最好用的 Linux 发行版之一。openSUSE 项目为 Linux开发者和爱好者提供了开始使用 Linux 所需要的一切。该项目由SUSE等公司赞助，2011年Attachmate集团收购了Novell，并把Novell和SUSE做为两个独立的子公司运营。openSUSE 操作系统和相关的开源程序会被SUSE Linux Enterprise使用。openSUSE对个人来说是完全免费的，包括使用和在线更新。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324078900.png" alt="clip_image004.png"></p>
<h2 id="五、CentOS介绍"><a href="#五、CentOS介绍" class="headerlink" title="五、CentOS介绍"></a>五、CentOS介绍</h2><p>CentOS（Community Enterprise Operating System，中文意思是社区企业操作系统）是Linux发行版之一，它是来自于Red Hat Enterprise Linux依照开放源代码规定释出的源代码所编译而成。由于出自同样的源代码，因此有些要求高度稳定性的服务器以CentOS替代商业版的Red Hat Enterprise Linux使用。两者的不同在于CentOS完全开源。</p>
<p>CentOS 每个版本的 CentOS都会获得十年的支持（通过安全更新方式）。新版本的 CentOS 大约每两年发行一次，而每个版本的 CentOS 会定期（大概每六个月）更新一次，以便支持新的硬件。这样，建立一个安全、低维护、稳定、高预测性、高重复性的 Linux 环境。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324094615.png" alt="clip_image005.png"></p>
<h2 id="六、Linux-Mint介绍"><a href="#六、Linux-Mint介绍" class="headerlink" title="六、Linux Mint介绍"></a>六、Linux Mint介绍</h2><p>Linux Mint 由Linux Mint Team团队于2006年开始发行，是一份基于Debian和Ubuntu的Linux发行版。其目标是提供一种更完整的即刻可用体验，这包括提供浏览器插件、多媒体编解码器、对DVD播放的支持、Java和其他组件，它也增加了一套定制桌面及各种菜单，一些独特的配置工具，以及一份基于web的软件包安装界面。Linux Mint是对用户友好而功能强大的操作系统。它诞生的目的是为家庭用户和企业提供一个免费的，易用的，舒适而优雅的桌面操作系统。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324108691.png" alt="clip_image006.png"></p>
<h2 id="七、Mageia介绍"><a href="#七、Mageia介绍" class="headerlink" title="七、Mageia介绍"></a>七、Mageia介绍</h2><p>2010年9月，为 Mandriva 发行版工作的多数雇员在 Mandriva 子公司 Edge-IT 实施清算时遭到解聘，他们随即与社群支持者于2010年9月18日在法国巴黎创建 Mandriva Linux 的分支项目—— Mageia。这是一个完全由社群运作的 Linux 发行版，将继续发挥 Mandriva Linux 对用户友好的优秀品质，而避免 Mandriva 公司缺乏竞争力的运作模式。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324124217.png" alt="clip_image007.png"></p>
<h2 id="八、Fedora介绍"><a href="#八、Fedora介绍" class="headerlink" title="八、Fedora介绍"></a>八、Fedora介绍</h2><p>Fedora 是一个 Linux发行版，是一款由全球社区爱好者构建的面向日常应用的快速、稳定、强大的操作系统。 它允许任何人自由地使用、修改和重发布，无论现在还是将来。它由一个强大的社群开发，这个社群的成员以自己的不懈努力，提供并维护自由、开放源码的软件和开放的标准。Fedora 项目由 Fedora 基金会管理和控制，得到了 Red Hat 的支持。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324141298.png" alt="clip_image008.png"></p>
<h2 id="九、Arch-Linux介绍"><a href="#九、Arch-Linux介绍" class="headerlink" title="九、Arch Linux介绍"></a>九、Arch Linux介绍</h2><p><strong>Arch Linux</strong>是一款基于 x86-64 架构的 Linux 发行版。系统主要由自由]和开源软件组成，支持社区参与。系统设计以KISS原则（保持简单和愚蠢）为总体指导原则，注重代码正确、优雅和极简主义，期待用户能够愿意去理解系统的操作。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324154687.png" alt="clip_image009.png"></p>
<h2 id="十、Slackware介绍"><a href="#十、Slackware介绍" class="headerlink" title="十、Slackware介绍"></a>十、Slackware介绍</h2><p><em>Slackware</em> 作为较古老的Linux发行版之一相比其他的主流发行版更希望成为具有 “UNIX风格” 的那一个，一直以来以简洁、安全和稳定所著称。其以灵活性和稳定性作为主要目标，但是缺少其他linux发行版本中那些为发行版定制的配置工具。在当今其他发行版都在使用 Systemd作为启动管理器时，<em>Slackware</em> 依旧使用 BSD 启动风格，各有优劣不做评价。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602324173330.png" alt="clip_image010.png"></p>
<h2 id="十一、视频学习"><a href="#十一、视频学习" class="headerlink" title="十一、视频学习"></a>十一、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6906825443148726798&logTag=b3d55d329e2bd1703150">视频：linux版本级应用</a></p>
<h1 id="VMware和VMwarePlayer的使用"><a href="#VMware和VMwarePlayer的使用" class="headerlink" title="VMware和VMwarePlayer的使用"></a>VMware和VMwarePlayer的使用</h1><p> 阅读 (75078) </p>
<p> 分享</p>
<h2 id="一、VMware的优势"><a href="#一、VMware的优势" class="headerlink" title="一、VMware的优势"></a>一、VMware的优势</h2><p>VMware Workstation（中文名“威睿工作站”）是一款功能强大的桌面虚拟计算机软件，提供用户可在单一的桌面上同时运行不同的操作系统，和进行开发、测试 、部署新的应用程序的最佳解决方案。VMware Workstation可在一部实体机器上模拟完整的网络环境，以及可便于携带的虚拟机，其更好的灵活性与先进的技术胜过了市面上其他的虚拟计算机软件。对于企业的 IT开发人员和系统管理员而言， VMware在虚拟网路，实时快照，拖曳共享文件夹，支持 PXE 等方面的特点使它成为必不可少的工具。</p>
<h2 id="二、VMware的安装和部署"><a href="#二、VMware的安装和部署" class="headerlink" title="二、VMware的安装和部署"></a>二、VMware的安装和部署</h2><h3 id="安装前的准备"><a href="#安装前的准备" class="headerlink" title="安装前的准备"></a>安装前的准备</h3><p>下载软件</p>
<p>windows版下载地址：<a target="_blank" rel="noopener" href="https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.0-14665864.exe">https://download3.vmware.com/software/wkst/file/VMware-workstation-full-15.5.0-14665864.exe</a></p>
<p>MacOS版下载地址：<a target="_blank" rel="noopener" href="https://download3.vmware.com/software/fusion/file/VMware-Fusion-11.5.0-14634996.dmg">https://download3.vmware.com/software/fusion/file/VMware-Fusion-11.5.0-14634996.dmg</a></p>
<p>我们选择现在试用版的就可以，有条件的建议购买正版</p>
<h3 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h3><p><strong>step1</strong> 双击下载好的安装程序后，稍微等一下你会看到安装界面打开</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602325980943.png" alt="clip_image001.png"></p>
<p><strong>step2</strong> 点击下一步后会看到一个许可协议的页面，选择接受后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602325996588.png" alt="clip_image002.png"></p>
<p><strong>step3</strong> 直接点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326009554.png" alt="clip_image003.png"></p>
<p><strong>step4</strong> 是否接受自动更新和是否加入客户体验计划根据自己的需求决定，然后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326025482.png" alt="clip_image004.png"></p>
<p><strong>step5</strong> 是否在桌面和开始菜单创建快捷方式自己决定，然后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326038902.png" alt="clip_image005.png"></p>
<p><strong>step6</strong> 点击安装</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326058155.png" alt="clip_image006.png"></p>
<p><strong>step7</strong> 完成安装</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326081800.png" alt="clip_image007.png"></p>
<p>如果你跟我设置的是一样的，你就会在桌面看到一个图标，双击就会打开vmware workstation，如果你看到这个界面，安装部署就完成了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326113993.png" alt="clip_image008.png"></p>
<h2 id="三、vmware的介绍和使用"><a href="#三、vmware的介绍和使用" class="headerlink" title="三、vmware的介绍和使用"></a>三、vmware的介绍和使用</h2><p>在打开的界面中我们可以大致分为三个部分：</p>
<ul>
<li>1、文字按钮；</li>
<li>2、图标按钮；</li>
<li>3、主页大按钮；<br>下面我们来介绍一下这三部分按钮的常用功能</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326130147.png" alt="clip_image009.png"></p>
<h3 id="1、文字按钮"><a href="#1、文字按钮" class="headerlink" title="1、文字按钮"></a>1、文字按钮</h3><p>1.1 文字按钮的第一部分是“文件”，<br>标记数字1的部分点击之后会引导你创建一个新的虚拟机；<br>标记数字2的部分点击之后会引导我们打开一个之前已经安装好的虚拟机；<br>标记数字3的部分可以帮助我们扫描电脑硬盘中都有哪些已经安装好的虚拟机可供直接使用；<br>标记数字4的就是退出vmware workstation这个程序。<br>其余没有提到的按钮，我们会在用到的时候进行讲解。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326145637.png" alt="clip_image010.png"></p>
<p>1.2 文字按钮的第二部分是“编辑” ，<br>标记数字1的部分点击之后会打开一个可以帮助我们编辑和创建虚拟网络的窗口，在这个窗口里面我们可以对虚拟网络进行调整；<br>标记数字2的部分点击之后可以让我们调整虚拟机对计算机硬件的使用，包括功能设置，快捷键设置，资源限制等</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326180506.png" alt="clip_image011.png"></p>
<p>1.3 文字按钮的第三部分是“查看”，在这里面我们可以对窗口大小以及布局进行调整，但是由于我们刚刚完成这个软件的安装，还没有安装新的虚拟机，所以这里面的大部分选项是不可用的，这些不可用的我们会在后续的课程中说明</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326192060.png" alt="clip_image012.png"></p>
<p>1.4 文字按钮的第四部分是“虚拟机”，这里面主要是针对已经安装的虚拟机进行的操作，同样由于我们还没有虚拟机，所以这些按钮都是不可用的，我们也会在安装了虚拟机之后对这个部分的按钮进行说明</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326203702.png" alt="clip_image013.png"></p>
<p>1.5 文字按钮的第五部分是“选项卡”，这个按钮里面可以帮助我们在多个虚拟机之间切换，如果我们安装了多个虚拟机，下面标记的部分就不会只有一个“主页”标签了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326249611.png" alt="clip_image014.png"></p>
<p>1.6 文字按钮的最后一部分是“帮助”，这个按钮我们可以获取使用帮助，软件更新，以及如果购买了正版，厂商给我们的序列号也是在这里输入的</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326263489.png" alt="clip_image015.png"></p>
<p>文字按钮部分的常用功能我们就说到这里，现在我们看第二部分和第三部分</p>
<h3 id="2-图标按钮和主页大按钮"><a href="#2-图标按钮和主页大按钮" class="headerlink" title="2 图标按钮和主页大按钮"></a>2 图标按钮和主页大按钮</h3><p>图标按钮和主页大按钮这里面我们就不挨个进行讲解了，他们所提供的功能在文字按钮里面都有提供，只是为了方便用户使用，有的按钮做成了图标按钮，有些则直接放在了主页。其中图标按钮的快照相关功能是我们以后会经常用到的功能，这个功能我们会在安装完虚拟操作系统之后进行讲解</p>
<h2 id="四、vmware-player的介绍和使用"><a href="#四、vmware-player的介绍和使用" class="headerlink" title="四、vmware player的介绍和使用"></a>四、vmware player的介绍和使用</h2><p>由于vmware workstation安装程序体积大并且是收费的，而有很多人又想在不删除电脑现有系统的前提下来体验其它操作系统，所以vmware公司提供了一个体积小巧且免费的工具，这个工具就是vmware player，不过这个软件现在叫vmware workstation player，顾名思义，这个软件在诞生之初只是一个体积小巧的虚拟机播放器，并不具备创建和制作虚拟机的功能，且精简了很多功能，而vmware官方提供了大量的虚拟机文件，以及各种虚拟机环境，用户只要下载相应的虚拟机文件和vmware player就可以体验，后期经过发展也具备了创建虚拟机的功能，随着我们之前安装vmware workstation这个软件已经安装在我们的计算机当中</p>
<p>在下面的图片中我们可以看到player所包含的按钮少很多，而且软件的界面要简介很多，由于player所包含的功能我们在前面都介绍过，所以这里就不重复介绍了，有兴趣的可以自己感受一下这个虚拟机播放器</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326290975.png" alt="clip_image016.png"></p>
<p>常用的功能我们就介绍到这里，下面我们来看下下一部分</p>
<h2 id="五、新建虚拟机和相关设置"><a href="#五、新建虚拟机和相关设置" class="headerlink" title="五、新建虚拟机和相关设置"></a>五、新建虚拟机和相关设置</h2><p>这部分内容我们看下如何新建一个虚拟机</p>
<p><strong>step1</strong> 点击vmware workstation主页的“创建新的虚拟机”按钮</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326311797.png" alt="clip_image017.png"></p>
<p><strong>step2</strong> 在弹出的新窗口中有两个选项一个是“典型”另一个是“自定义”，在这两个按钮下面都有详细的文字介绍，这里面我们选择“典型”然后选择下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326324645.png" alt="clip_image018.png"></p>
<p><strong>step3</strong> 在这个窗口中标记为1的部分是从光盘安装，标记为2的部分是选择一个已经下载好的光盘镜像，标记为3的创建完成后不会立即安装虚拟机，我们选择一个已经下载好的光盘镜像之后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326336091.png" alt="clip_image019.png"></p>
<p><strong>step4</strong> 接下来的窗口我们需要设置好相关名称和密码，主要是为了自动安装做准备，设置好内容之后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326349390.png" alt="clip_image020.png"></p>
<p><strong>step5</strong> 第五步需要我们给出在标签栏显示的虚拟机的名称以及安装在电脑硬盘的什么位置，设置好后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326365247.png" alt="clip_image021.png"></p>
<p><strong>step6</strong> 第六步是设置即将安装的虚拟机最大允许使用的硬盘空间，这里建议我们的是20G，所以各位在选择存放位置的时候一定要保证有20G以上的可用空间，避免后期更换位置的麻烦，至于虚拟机磁盘的存储方式，我们默认就可以，设置好之后点击下一步</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326378155.png" alt="clip_image022.png"></p>
<p><strong>step7</strong> 来到最后一步，这里面你可以自定义硬件来给虚拟机分配更多资源，而这个“创建后开启此虚拟机”一定不要点选，否则点击“完成”按钮后很可能会开启自动安装，你就无法熟悉操作系统的安装流程了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326389368.png" alt="clip_image023.png"></p>
<p><strong>step8</strong> 点击完成之后会来到我们所创建的这个虚拟机的界面，点击“编辑虚拟机设置”进行一些调整</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326402799.png" alt="clip_image024.png"></p>
<p><strong>step9</strong> 在这个界面我们可以对虚拟机的硬件进行一些设置，但是要注意一定要把包含有“autoinst”字样的光驱和软驱删除，它会帮助我们自动完成虚拟机的安装，而我们不需要这个功能。在图片里面我们只看到一个包含有这个字样的，各位在安装的时候可能会看到两个包含有这个字样的设备，一个是光驱，一个是软驱，选中之后点击下方的“移除”按钮，然后点击确定</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326415434.png" alt="clip_image025.png"></p>
<p>点击确定按钮之后你会回到之前的界面，我们可以看到对虚拟机作出了哪些调整，如果没有额外需要调整的地方就可以点击“开启此虚拟机”按钮。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/10/1602326425805.png" alt="clip_image026.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">视频分享：1小时搞定VMware workstation15 </span><br><span class="line">https://study.163.com/course/courseMain.htm?courseId=1006481025&amp;share=2&amp;shareId=400000000626057</span><br></pre></td></tr></table></figure>

<h2 id="六、视频学习"><a href="#六、视频学习" class="headerlink" title="六、视频学习"></a>六、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6907237296529998347&logTag=dbdbcdb86a5173f6da31">视频：创建虚拟机</a><br><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6907237341111255566&logTag=7d4e73647a8ddc71bf13">视频：虚拟机设置</a></p>
<h1 id="安装CentOS-8-linux-系统"><a href="#安装CentOS-8-linux-系统" class="headerlink" title="安装CentOS 8 linux 系统"></a>安装CentOS 8 linux 系统</h1><p> 阅读 (342568) </p>
<p> 分享</p>
<h2 id="一、Linux系统的选择"><a href="#一、Linux系统的选择" class="headerlink" title="一、Linux系统的选择"></a><strong>一、Linux系统的选择</strong></h2><p>在linux的众多发行版当中，大多数都是面向普通用户的，面向企业的屈指可数，我们通过之前的课程了解到CentOS和Red Hat Enterprise Linux出自同样的源代码，所以从可靠性，硬件兼容性，以及生命周期上来讲无疑是最好的选择，而且CentOS还是一个免费的软件，接下来我们看一下CentOS如何安装</p>
<h2 id="二、CentOS的安装流程"><a href="#二、CentOS的安装流程" class="headerlink" title="二、CentOS的安装流程"></a><strong>二、CentOS的安装流程</strong></h2><p>安装前的准备：CentOS8光盘镜像</p>
<ul>
<li><strong>下载地址</strong><br><a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/centos/8.5.2111/isos/x86_64/CentOS-8.5.2111-x86_64-dvd1.iso">https://mirrors.aliyun.com/centos/8.5.2111/isos/x86_64/CentOS-8.5.2111-x86_64-dvd1.iso</a></li>
<li><strong>开始安装</strong><br><strong>step 1:</strong> 使用vmware新建一个虚拟机，选择下载好的镜像，然后点击开启虚拟机</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379168724.png" alt="1570758965669.png"></p>
<p><strong>step 2:</strong> 选择第一个选项，安装CentOS，然后等待开启图形安装界面</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602382054024.png" alt="install0.png"></p>
<p><strong>step 3:</strong> 选择简体中文后继续</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602382086790.png" alt="install1.png"></p>
<p><strong>step 4:</strong> 设置安装信息摘要</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602384761095.png" alt="安装信息摘要0.png"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、键盘设置：如果键盘不是特殊键盘，比如科学运算类的，那就选默认。</span><br><span class="line"><span class="number">2</span>、安装源：系统安装方式，有网络、光盘等，这里本地介质代表光盘安装。</span><br><span class="line"><span class="number">3</span>、系统安装目的地：系统安装在哪块硬盘</span><br><span class="line"><span class="number">4</span>、语言支持：系统语言，这里默认中文，如果喜欢英文或者其他，这里可以设置。</span><br><span class="line"><span class="number">5</span>、软件安装：这里可以选择系统安装哪些软件，比如是否需要安装图形界面，后面具体说。</span><br><span class="line"><span class="number">6</span>、KDUMP：系统崩溃日志存储空间设置，为了解决系统奔溃bug使用。</span><br><span class="line"><span class="number">7</span>、时间和日期：设置时区、日期、时间的地方</span><br><span class="line"><span class="number">8</span>、网络和主机名：设置网卡信息和计算机名称的地方</span><br><span class="line"><span class="number">9</span>、安全策略：安全访问策略</span><br></pre></td></tr></table></figure>

<p><strong>step 5：</strong> 安装信息设置</p>
<ul>
<li>键盘：默认即可</li>
<li>软件：安装源设置，默认即可，本地介质代表本地光盘安装</li>
<li>安装源设置，这里面我可以选择自动分区，点击完成</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379332054.png" alt="1570759242400.png"></p>
<p>这里是系统会自动将你的安装磁盘分区，具体分了哪些区呢？可以看通过下图步骤查看或者更改：</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602385290065.gif" alt="手动分区.gif"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">默认分区介绍</span><br><span class="line">/boot：boot分区是用来存储linux启动程序的，<span class="number">100</span>M就够了，系统推荐了<span class="number">1024</span>M</span><br><span class="line">/：存放系统数据的，除了启动程序其他程序默认都存这个分区上，系统默认将剩余分区都给它。</span><br><span class="line">/swap：linux的交互分区，类似于windowns的虚拟内存，解决的是物理内存不够用的问题，</span><br><span class="line">官方以前推荐该分区大小为内存的<span class="number">1</span><span class="literal">-2</span>倍，但是这个也是有使用窍门的，不一定按着他的来。</span><br><span class="line">比如大文件服务器我就不分这个区，意义不大，小文件服务器我就肯定分这个区。</span><br></pre></td></tr></table></figure>

<ul>
<li>语言支持：你希望系统是什么语言就点击这里选择即可，我选的的是默认简体中文</li>
<li>软件选择：这里决定了你系统安装什么样的软件包，也就是说系统安装后是什么样的，很重要！<br>生产环境下一般系统会使用以下两种安装方式：<br>a、带图形界面的linux系统<br>b、最小化安装<br>通过这里我们就可以选择，上张图我们看看</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602385871788.png" alt="软件选择.png"></p>
<p>喜欢安装那种自己看着选吧，一般我工作中用到的就是红框画出的两种，根据自己的需求自己选择吧。</p>
<ul>
<li>KDUMP：内核奔溃日志转储，当系统奔溃了，如果你想查日志，就可以找这个日志去看看，可以帮助你尽快定位问题，解决bug。<br>因为是初学，大家点进去直接关掉就行了，以后等涉及到内核编译等工作再去研究吧。</li>
<li>时间和日期：设置系统的时区、日期、时间<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386186394.png" alt="时区设置2.png"><br>这里建议大家设置一下，否者你的系统默认采用的是美洲&#x2F;纽约时区，和中国的时间不一样，很难受的。</li>
<li>网络和主机名：设置网卡联网信息和计算机名字<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386332917.png" alt="网络与主机名设置1.png"></li>
</ul>
<p>网卡：默认网卡是关闭的，这里强烈建议你打开，否者你按上系统上不了网，对于小白来说太痛苦了。</p>
<p>主机名：设置好主机名后点击应用按钮生效。</p>
<ul>
<li>安全策略：系统访问策略，后续说到安全在给大家说，现在说小白理解太难了，毕竟我们现在只是想安装个linux系统。</li>
</ul>
<p>安装信息设置完成如下图，点击开始安装，继续吧</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386549911.png" alt="安装信息摘要1.png"></p>
<p><strong>step 6:</strong> 点击根密码选项来设置密码，如果有需求的可以通过创建用户选项来建立一个新用户</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386652175.png" alt="install4.png"></p>
<p><strong>step 7:</strong> 设置root密码，两遍输入要一致，如果是弱密码需要点击两次完成，也可以设置大小写字母+数字+特殊符号的这种强密码</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386717538.png" alt="install5.png"></p>
<p><strong>step 8:</strong> 设置完成密码后，回到之前的页面</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386744736.png" alt="install6.png"></p>
<p><strong>step 9:</strong> 完成安装之后我们来重启</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386769626.png" alt="install7.png"></p>
<p><strong>step 10:</strong> 重启完成之后我们可以看到有一个初始设置，在这里面我们能看到有一个授权</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379605562.png" alt="1570760127370.png"></p>
<p><strong>step 11:</strong> 接受许可协议，点击完成</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379642728.png" alt="1570760218023.png"></p>
<p><strong>step 12:</strong> 结束配置</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379674970.png" alt="1570760272700.png"></p>
<p>以上就是CentOS8的安装流程，接下来我们看一下安装完成之后的一些相关设置</p>
<h2 id="三、安装后的相关设置"><a href="#三、安装后的相关设置" class="headerlink" title="三、安装后的相关设置"></a>三、安装后的相关设置</h2><p>安装完成之后，在进入系统之前我们可以看到一个欢迎页面，我们来看下这个页面有哪些设置</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379724719.png" alt="1570760388433.png"></p>
<p>在欢迎页面点击前进之后可以来到隐私设置，在这个位置可以选择是否打开位置服务</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379753410.png" alt="1570760489852.png"></p>
<p>接下来可以选择一个在线账号，如果都没有的话可以选择跳过</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379779408.png" alt="1570760531295.png"></p>
<p>跳过之后我们可以看到一个个人信息设置的页面</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602386921351.png" alt="install8.png"></p>
<p>紧接着需要我们设置一个密码</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379852413.png" alt="1570760635589.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379885287.png" alt="1570760658382.png"></p>
<p>输入密码登录</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387040814.png" alt="install10.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387053600.png" alt="install11.png"></p>
<p>登录之后你会看到一个使用手册的页面，有兴趣的可以看下，这里面我们直接关掉这个页面。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387120468.png" alt="install12.png"></p>
<p>接下来我们以root用户的身份来进行登录，首先点击屏幕右上角的按钮选择注销用户</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387314174.png" alt="install13.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387328035.png" alt="install14.png"></p>
<p>注销之后来到登录界面，选择“未列出？”</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387406514.png" alt="install15.png"></p>
<p>点击之后会看到一个让我们输入用户名的窗口，在这个窗口里面输入root<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602380081706.png" alt="1570761324446.png"></p>
<p>然后输入密码，这个密码就是我们在安装系统的时候设置的密码，然后就可以以root用户的身份登录，登录之后也会看到一个欢迎页面，如果不想设置可以选择退出</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602380038786.png" alt="1570761440353.png"></p>
<p>这些都设置完成之后建议各位为新安装的虚拟机做一个快照，这个时候就可以用到我们之前提到的几个快捷按钮了，标记为数字1的是创建一个快照；标记为数字2的是恢复虚拟机到之前的快照，前提是你之前创建过快照；标记为数字3的是管理虚拟机的快照，在这里面你可以对已经创建的快照进行不安利，比如说删除，由于我们是新安装的虚拟机，所以这里面我们选择1，创建快照</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379986046.png" alt="1570763495661.png"></p>
<p>创建快照</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379956652.png" alt="1570763675787.png"></p>
<p>创建完成之后，如果以后有什么误操作导致此虚拟机严重故障，无法使用，就可以选择恢复快照</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602379937301.png" alt="1570763764638.png"></p>
<p>至此安装后的设置流程就结束了，nice</p>
<h2 id="四、视频学习"><a href="#四、视频学习" class="headerlink" title="四、视频学习"></a>四、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6907237227810685451&logTag=f679e4d7b6f5f2ba85a7">视频：系统安装介绍</a><br><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6907236975086928392&logTag=c1c5f52bb43e1d4ac81e">视频：系统安装步骤</a><br><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6907237048814404107&logTag=542c039b2e5ee7fd37bd">视频：vmtools介绍</a></p>
<h1 id="Linux终端的使用"><a href="#Linux终端的使用" class="headerlink" title="Linux终端的使用"></a>Linux终端的使用</h1><p> 阅读 (195329) </p>
<p> 分享</p>
<h2 id="一、终端的作用"><a href="#一、终端的作用" class="headerlink" title="一、终端的作用"></a>一、终端的作用</h2><p>要了解终端，就要了解一下计算机方面的历史，早期的计算机都属于大中型计算机，是个庞然大物，占用很大的空间，属于公用产品。不像现在的电脑，可以人手一部，直接操作。那如何对这些计算机进行控制与操作呢。那就搞个终端设备来操作。因此一台计算机上有很多种不同的终端设备也和正常。也就是说终端就是为主机提供了人机接口，每个人都通过终端使用主机的资源。</p>
<p>终端有字符终端和图形终端两种模式。在linux的图形环境下，我们可以通过鼠标点击来完成所有的管理任务，这是图形界面终端，另外一种就是文本界面的终端，在这个界面的终端下我们可以使用linux命令来控制系统完成响应的工作，而这个文本终端也是服务器常用的模式。</p>
<p>用一句话来说终端就是存在于用户和计算机之间沟通的桥梁，通过终端，用户可以控制计算机完成响应的工作，也可以获得到计算机的反馈</p>
<h2 id="二、打开终端的几种方法"><a href="#二、打开终端的几种方法" class="headerlink" title="二、打开终端的几种方法"></a>二、打开终端的几种方法</h2><p>第一种，我们登录系统之后就已经打开了图形终端，在图形终端中也给我们提供了一个可以用linux命令控制系统的工具，我们点击屏幕左上角的“活动”就可以找到这个它</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387773855.png" alt="1570773103451.png"></p>
<p>打开之后我们会看到linux的命令行，在这里面我们可以输入linux命令来进行操作</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387794098.png" alt="1570773158443.png"></p>
<p>第二种 打开文本终端，这个需要键盘上的组合键[Ctrl] + [Alt] + [F1] - [F6] ，其中F1和F2是两个可供登录的图形终端，F3-F6为文本终端，现在我们使用[Ctrl] + [Alt] + [F3]打开文本终端，然后使用root用户登录</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387807896.png" alt="1570773655859.png"></p>
<p>这就是在linux中终端的打开方式，那我们接下来看一下有哪些快捷键</p>
<h2 id="三、常用快捷键"><a href="#三、常用快捷键" class="headerlink" title="三、常用快捷键"></a>三、常用快捷键</h2><p>1、图形界面下通过点击屏幕右上角的“活动”按钮打开的终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Shift]+[Ctrl]+t	以标签的形式打开一个新的终端</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+n	以窗口的形式打开一个新的终端</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+w	关闭标签页</span><br><span class="line"></span><br><span class="line">[Shift]+[Ctrl]+q	关闭窗口</span><br></pre></td></tr></table></figure>

<p>如果你想知道额外的快捷键，点击终端上方的文字按钮，会有对应快捷键的提示</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602387826764.png" alt="1570774251987.png"></p>
<p>2、通用快捷键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+r:		实现快速检索使用过的历史命令.</span><br><span class="line">Ctrl+a:		光标回到命令行首。 </span><br><span class="line">Ctrl+e:		光标回到命令行尾。 </span><br><span class="line">ctrl+w:		移除光标前的一个单词</span><br><span class="line">Ctrl+k:		删除光标处到行尾的字符。</span><br><span class="line">Ctrl+u:		删除整个命令行文本字符。</span><br><span class="line">Ctrl+y:		粘贴Ctrl+u，Ctrl+k，Ctrl+w删除的文本。</span><br><span class="line">Ctrl+d:		删除提示符所在出的一个字符，在空命令行的情况下可以退出终端。</span><br><span class="line">esc+. :		上一个命令的后面的参数</span><br><span class="line">Ctrl+b:		光标向行首移动一个字符。</span><br><span class="line">Ctrl+f:		光标向行尾移动一个字符。</span><br><span class="line">Ctrl+h:		向行首删除一个字符。</span><br><span class="line">Ctrl+i:		相当于Tab键。</span><br><span class="line">Ctrl+L:		清屏</span><br><span class="line">Ctrl+s:		使终端发呆，静止，可以使快速输出的终端屏幕停下来。</span><br><span class="line">Ctrl+q:		退出Ctrl+s引起的发呆。</span><br><span class="line">Ctrl+z:		使正在运行在终端的任务，运行于后台。 （可用fg恢复）</span><br><span class="line">Ctrl+c:		中断终端中正在执行的任务。</span><br><span class="line">Tab键:		命令、文件名等自动补全功能。</span><br></pre></td></tr></table></figure>

<p>以上的快捷键都是在工作中可能会经常用到的，不论是在图形界面打开的终端还是字符界面的终端都可以使用，在这里面就不挨个演示了，各位可以在终端中使用任意字幕和空格模拟命令输入然后多多熟悉，尽快掌握。</p>
<h2 id="四、视频学习-1"><a href="#四、视频学习-1" class="headerlink" title="四、视频学习"></a>四、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6908561960934048260&logTag=67cab8fc6d33ad53a1fd">视频：图形界面与终端介绍</a></p>
<h1 id="Linux命令行介绍"><a href="#Linux命令行介绍" class="headerlink" title="Linux命令行介绍"></a>Linux命令行介绍</h1><p> 阅读 (248543) </p>
<p> 分享</p>
<h2 id="一、命令行的介绍"><a href="#一、命令行的介绍" class="headerlink" title="一、命令行的介绍"></a>一、命令行的介绍</h2><p>命令行界面（英语：command-line interface，缩写：CLI）是在图形用户界面得到普及之前使用最为广泛的用户界面，它通常不支持鼠标，用户通过键盘输入指令，计算机接收到指令后，予以执行。也有人称之为字符用户界面CUI。通常认为，命令行界面（CLI）没有图形用户界面GUI那么方便用户操作。因为，命令行界面的软件通常需要用户记忆操作的命令，但是，由于其本身的特点，命令行界面要较图形用户界面节约计算机系统的资源。在熟记命令的前提下，使用命令行界面往往要较使用图形用户界面的操作速度要快。所以，图形用户界面的操作系统中，都保留着可选的命令行界面。另外Linux 系统的优势基因还是快速、批量、自动化、智能化管理系统及处理业务。和Windows系统使用鼠标点击的可视化管理大不相同 ，Linux通过键盘输入指令就可以完成管理系统的相关操作。说完命令行，我们来看下命令提示符</p>
<h2 id="二、命令提示符的介绍"><a href="#二、命令提示符的介绍" class="headerlink" title="二、命令提示符的介绍"></a>二、命令提示符的介绍</h2><p>当我们打开终端时，不论是在图形界面还是在字符界面，我们看到的格式都是类似于[root@localhost ~]#这种格式的一串字符，这串字符就是命令提示符</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388003591.png" alt="1570783019496.png"></p>
<p>提示符组成详解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root：当前用户的名称</span><br><span class="line"></span><br><span class="line">@：分隔符</span><br><span class="line"></span><br><span class="line">localhost：当前主机的主机名</span><br><span class="line"></span><br><span class="line">~：用户当前所在的目录名称 “~”表示为用户家目录（发音tilde[ˈtɪldə]）</span><br><span class="line"></span><br><span class="line">#： 用户身份提示符，#表示超级用户，也就是管理员；$表示普通用户 (发音pound[paʊnd])	</span><br></pre></td></tr></table></figure>

<h2 id="三、命令的语法格式"><a href="#三、命令的语法格式" class="headerlink" title="三、命令的语法格式"></a>三、命令的语法格式</h2><p>命令+选项+操作对象这三部分是组成了一个标准的linux命令，其中命令部分需要输入命令的名称；选项部分定义命令的执行特性，可以有长短两种选项，长选项用“ –” （发音dash[dæʃ]）引导，后面跟完整的单词，如 –help；短选项用 ‘- ’引导，后面跟单个的字符， 如 -a 。多个短选项可以组合使用，例如：-h -l -a &#x3D;&#x3D; -hla，但是长选项不能组合使用，如 –help后面就不能再跟另外一个单词了。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388105934.png" alt="1570784712025.png"></p>
<p>但是大家需要注意，命令与选项，选项与选项，选项与操作对象，操作对象与操作对象他们之间是必须用空格分隔！至于操作对象就是图片中的&#x2F;boot，操作对象是可以有多个的</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388129124.png" alt="1570784853770.png"></p>
<p>语法格式我们就介绍完了，咱们接着往下看</p>
<h2 id="四、如何高效的输入命令"><a href="#四、如何高效的输入命令" class="headerlink" title="四、如何高效的输入命令"></a>四、如何高效的输入命令</h2><p>想提高命令的输入效率除了要提升命令的熟练度之外，还要掌握我们上节课所学的快捷键，这样能让你在输入命令是更得心应手。<br>那如何提升命令熟练度呢？</p>
<ul>
<li>就要会查看命令的说明，只有看懂了才能记住，记住了才能熟练</li>
<li>使用tab键查询或补全</li>
</ul>
<h3 id="4-1、如何快速获取命令的帮助说明"><a href="#4-1、如何快速获取命令的帮助说明" class="headerlink" title="4.1、如何快速获取命令的帮助说明"></a>4.1、如何快速获取命令的帮助说明</h3><p>在linux中获取命令的帮助说明的途径很多，这里面给大家简单介绍几个</p>
<p>a、help命令可以帮助我们获取到内建命令的使用帮助</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388151270.png" alt="1570785422297.png"></p>
<p>b、–help参数</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388165544.png" alt="1570785480088.png"></p>
<p>c、man手册</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388192478.png" alt="1570785620561.png"></p>
<p>以上这是三种获取帮助的方式，另外还有info、whatis等也可以获取帮助，各位还可以通过一些在线查询工具获取到相关命令的帮助！</p>
<h3 id="4-2、Tab键模糊查询命令"><a href="#4-2、Tab键模糊查询命令" class="headerlink" title="4.2、Tab键模糊查询命令"></a>4.2、Tab键模糊查询命令</h3><p>a、命令模糊查找：如果你命令记不住了，大概能记得个开头，你可以使用： 命令开头字符+两次tab键找到所有以该命令开头字符的命令，然后就能找到了！</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/11/25/1606275307362.gif" alt="命令模糊查找.gif"></p>
<p>b、命令补全： 当你打命令的时候，一般情况下你打出命令的前3-5个字符按一下tab就可以完成命令补全，补全的前提是你打的这些字符可以直接匹配到这个命令。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/11/25/1606275407293.gif" alt="命令补全.gif"></p>
<h2 id="五、视频学习"><a href="#五、视频学习" class="headerlink" title="五、视频学习"></a>五、视频学习</h2><p><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6908562178287239691&logTag=002d7e81ad7e2db98422">视频：linux命令介绍</a><br><a target="_blank" rel="noopener" href="https://www.ixigua.com/6906835360559727111?id=6908562316124488204&logTag=f017ae33a7a204a53a92">视频：linux常用命令</a></p>
<h1 id="Linux远程连接工具"><a href="#Linux远程连接工具" class="headerlink" title="Linux远程连接工具"></a>Linux远程连接工具</h1><p> 阅读 (190549) </p>
<p> 分享</p>
<h2 id="一、远程连接工具介绍"><a href="#一、远程连接工具介绍" class="headerlink" title="一、远程连接工具介绍"></a>一、远程连接工具介绍</h2><p>关于远程连接的用户分类时这样的，通常需要进行远程连接的人有两类，一类是系统管理员，另一类是普通的用户。系统管理员通常需要远程连接企业内网的网络设备或服务器，进行远程配置管理操作。以目前的产品发展来看，大部分企业级的网络设备或服务器，通常都提供远程配置管理的接口或功能，管理员可以通过telnet、SSH、web GUI乃至远程管理软件终端等方式，进入内网进行管理维护。普通用户的远程连接需求，通常是远程办公人员、外出人员，尤其是企业高管等需要经常出差又经常需要操作ERP、CRM、HR等信息化系统，进行查看、审批、提单等操作。</p>
<p>我们这里面所提到的远程连接工具一般指的是针对系统管理类人员使用的，而系统管理类人员常用的远程连接工具主要有Putty、XShell、SecureCRT、SSH Secure、Shell Slient等等。</p>
<ul>
<li>putty： Putty非常小巧易用，不支持tab，多窗口切换效率太低，易用性不好。</li>
</ul>
<p>相关链接： <a target="_blank" rel="noopener" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">https://www.chiark.greenend.org.uk/~sgtatham/putty/</a></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388336916.png" alt="1570876394781.png"></p>
<ul>
<li>SecureCRT： 界面强大，功能全面，原始环境为英文，收费</li>
</ul>
<p>相关链接： <a target="_blank" rel="noopener" href="https://www.vandyke.com/cgi-bin/releases.php?product=securecrt">https://www.vandyke.com/cgi-bin/releases.php?product=securecrt</a></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388360071.png" alt="1570876465832.png"></p>
<ul>
<li>Xshell： XShell绝对首选，免费版也没什么限制，随便改字体，随便改颜色，随便改大小，随便改字符集，多窗口，也比较小巧。</li>
</ul>
<p>相关链接： <a target="_blank" rel="noopener" href="https://www.netsarang.com/zh/xshell/">https://www.netsarang.com/zh/xshell/</a></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388396036.png" alt="1570876662599.png"></p>
<h2 id="二、远程连接工具的选择"><a href="#二、远程连接工具的选择" class="headerlink" title="二、远程连接工具的选择"></a>二、远程连接工具的选择</h2><p>Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2, 以及Microsoft Windows 平台的TELNET 协议。Xshell 通过互联网到远程主机的安全连接以及它创新性的设计和特色帮助用户在复杂的网络环境中享受他们的工作。Xshell可以在Windows界面下用来访问远端不同系统下的服务器，从而比较好的达到远程控制终端的目的。除此之外，相对比SecureCRT的原始英文环境还收费，putty的功能单一，其中文环境、丰富的外观配色方案、样式、功能，还免费等优势，使得xshell成为多数人的首选，本节课我们就以xshell为例来看下远程连接工具的相关设置</p>
<h2 id="三、远程连接工具的相关设置和使用"><a href="#三、远程连接工具的相关设置和使用" class="headerlink" title="三、远程连接工具的相关设置和使用"></a>三、远程连接工具的相关设置和使用</h2><p>1、新建会话</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388433957.png" alt="1571022422199.png"></p>
<p>2、设置会话相关信息，标记为数字1的设置连接的名称，标记为数字2的设置远程主机的IP地址，我们还可以在左侧的选项中进行一些自定义设置，包括安全性设置，终端设置，外观这些，如果只是基本使用的话我们先添这两项就可以，填完之后点击确定，你会看到一个关于秘钥的提示，在这个提示中你可以选择一次性接受还是保存，这个根据自己需求就可以，如果选择一次性的话我们下次连接还需要我们确认这个秘钥，如果是保存下来的话，下次会直接连接，可以根据自己的需求决定,紧接着会提示输入用户名和密码，都输入正确的话我们就可以连接上远程的主机了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388468298.png" alt="1571031465825.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388513025.png" alt="1571031724630.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388523571.png" alt="1571031917329.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388533619.png" alt="1571031936838.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602388542771.png" alt="1571032314267.png"></p>
<p>如果能看到我们在之前的课程中提到的linux命令提示符就证明连接成功了，好了，本节课的内容就到这里，我们现在回顾一下</p>
<h1 id="Linux基本命令与常用符号"><a href="#Linux基本命令与常用符号" class="headerlink" title="Linux基本命令与常用符号"></a>Linux基本命令与常用符号</h1><p> 阅读 (357912) </p>
<p> 分享</p>
<h2 id="一、常用命令介绍"><a href="#一、常用命令介绍" class="headerlink" title="一、常用命令介绍"></a>一、常用命令介绍</h2><p>在linux系统中存在很多命令，这些命令可以帮助我们完成不同的工作，在这里面我们先介绍一些常用的基础命令，这些命令可以帮助我们完成对应的基本操作，随着以后的学习，我们还会接触到更多可以帮助我们完成不同工作的linux命令，我们来一起看一下这些基础命令都有哪些</p>
<p><strong>1、关机、重启命令</strong></p>
<p><strong>关机命令</strong></p>
<ul>
<li>init 0 #管理员可以使用</li>
<li>halt</li>
<li>shutdown -h</li>
<li>poweroff</li>
</ul>
<p><strong>重启命令</strong></p>
<ul>
<li>shutdown -r</li>
<li>reboot</li>
<li>shutdown -r</li>
</ul>
<p>强烈推荐：关机或重启命令及步骤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1） sync：将缓冲区的数据同步到磁盘中(关机，重启前都需要执行，避免数据丢失)，在Linux系统中，当数据需要存入磁盘时，通常会先放到缓冲区内，等到适当的时刻再写入磁盘，如此可提高系统的执行效率</span><br><span class="line"></span><br><span class="line">2） shutdown： 以一种安全的方式关闭或重启系统。所有登陆用户都可以看到关机信息提示，并且禁止登陆</span><br><span class="line"></span><br><span class="line">	-k	并非真正关机，只向所有人显示警告信息。</span><br><span class="line">		如：shutdown -k +5</span><br><span class="line">	-r	重启。默认延迟一分钟</span><br><span class="line">		如：shutdown -r +3 &quot;shutdown in 3 minutes&quot;</span><br><span class="line">	-h	关机。默认延迟一分钟</span><br><span class="line">		如：shutdown -h 12：00/shutdown -h now</span><br><span class="line">	-f	重启时跳过磁盘检测。</span><br><span class="line">	-F	重启时强制磁盘检测。</span><br><span class="line">	-c	取消shutdown</span><br><span class="line"></span><br><span class="line">推荐理由：</span><br><span class="line">1、将内存中的数据刷入硬盘，避免因为重启或关机数据没有及时保存而丢失</span><br><span class="line">2、避免多用户使用突然某个用户强行关机，影响其他用户，使用shutdown关机和重启可以通知其他用户，给予缓冲时间</span><br></pre></td></tr></table></figure>

<p><strong>2、系统信息</strong></p>
<ul>
<li>uname</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-s  输出内核名称</span><br><span class="line">-n  输出网络节点上的主机名</span><br><span class="line">-r  输出内核发行号</span><br><span class="line">-v  输出内核版本</span><br><span class="line">-m  输出主机的硬件架构名称</span><br><span class="line">-p  输出处理器类型或&quot;unknown&quot;</span><br><span class="line">-i	输出硬件平台或&quot;unknown&quot;</span><br><span class="line">-o	输出操作系统名称</span><br><span class="line">-a  以如下次序输出所有信息。其中若-p和-i的结果不可知则省略</span><br></pre></td></tr></table></figure>

<ul>
<li>hostname 查看主机名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># hostnamectl set-hostname hello</span><br></pre></td></tr></table></figure>

<ul>
<li>date 查看和设置时间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">时间方面：</span><br><span class="line">%n : 下一行</span><br><span class="line">%t : 跳格 tab</span><br><span class="line">%H : 小时(00..23)</span><br><span class="line">%I : 小时(01..12)</span><br><span class="line">%k : 小时(0..23)</span><br><span class="line">%l : 小时(1..12)</span><br><span class="line">%M : 分钟(00..59)</span><br><span class="line">%p : 显示本地 AM 或 PM</span><br><span class="line">%r : 直接显示时间 (12 小时制，格式为 hh:mm:ss [AP]M)</span><br><span class="line">%s : 从 1970 年 1 月 1 日 00:00:00 UTC 到目前为止的秒数</span><br><span class="line">%S : 秒(00..60)</span><br><span class="line">%T : 直接显示时间 (24 小时制)</span><br><span class="line">%X : 相当于 %H:%M:%S</span><br><span class="line">%Z : 显示时区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">日期方面：</span><br><span class="line">%a : 星期几 (Sun..Sat)</span><br><span class="line">%A : 星期几 (Sunday..Saturday)</span><br><span class="line">%b : 月份 (Jan..Dec)</span><br><span class="line">%B : 月份 (January..December)</span><br><span class="line">%c : 直接显示日期与时间</span><br><span class="line">%d : 日 (01..31)</span><br><span class="line">%D : 直接显示日期 (mm/dd/yy)</span><br><span class="line">%h : 同 %b</span><br><span class="line">%j : 一年中的第几天 (001..366)</span><br><span class="line">%m : 月份 (01..12)</span><br><span class="line">%U : 一年中的第几周 (00..53) (以 Sunday 为一周的第一天的情形)</span><br><span class="line">%w : 一周中的第几天 (0..6)</span><br><span class="line">%W : 一年中的第几周 (00..53) (以 Monday 为一周的第一天的情形)</span><br><span class="line">%x : 直接显示日期 (yyyy-mm-dd)</span><br><span class="line">%y : 年份的最后两位数字 (00.99)</span><br><span class="line">%Y : 完整年份 (0000..9999)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%I%M%S&#x27;</span><br><span class="line">025929</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%r&#x27;</span><br><span class="line">上午 02时59分49秒</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%s&#x27;</span><br><span class="line">1584428402</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%Z&#x27;</span><br><span class="line">EDT</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%a&#x27;</span><br><span class="line">二</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%A&#x27;</span><br><span class="line">星期二</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%b&#x27;</span><br><span class="line">3月</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%B&#x27;</span><br><span class="line">三月</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%c&#x27;</span><br><span class="line">2020年03月17日 星期二 03时01分36秒</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%T%n%D&#x27;</span><br><span class="line">03:03:35</span><br><span class="line">03/17/20</span><br><span class="line">[root@zutuanxue ~]# date &#x27;+%T%t%D&#x27;</span><br><span class="line">03:03:58	03/17/20</span><br><span class="line">[root@zutuanxue ~]# date -s 2021-10-25</span><br><span class="line">2021年 10月 25日 星期一 00:00:00 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s 18:00</span><br><span class="line">2021年 10月 25日 星期一 18:00:00 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s 18:30:21</span><br><span class="line">2021年 10月 25日 星期一 18:30:21 EDT</span><br><span class="line">[root@zutuanxue ~]# date -s &quot;2021-04-28 15:30:20&quot;</span><br><span class="line">2021年 04月 28日 星期三 15:30:20 EDT</span><br></pre></td></tr></table></figure>

<p><strong>3、文件和目录</strong></p>
<ul>
<li>cd 目录 进入目录</li>
<li>pwd： 查看当前的工作路径</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-P		显示实际位置</span><br><span class="line">-L		显示所在位置</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cd /etc     #进入到/etc这个目录</span><br><span class="line">[root@zutuanxue ~]# cd /</span><br><span class="line">[root@zutuanxue /]# ls</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@zutuanxue /]# cd bin/</span><br><span class="line">[root@zutuanxue bin]# pwd</span><br><span class="line">/bin</span><br><span class="line">[root@zutuanxue bin]# pwd -P</span><br><span class="line">/usr/bin</span><br><span class="line">[root@zutuanxue bin]# pwd -L</span><br><span class="line">/bin</span><br></pre></td></tr></table></figure>

<ul>
<li>ls： 查看当前目录下有哪些文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-a 列出目录下的所有文件，包括以 . 开头的隐含文件。</span><br><span class="line">-A 显示除 “.”和“..”外的所有文件。</span><br><span class="line">-B 不输出以 “~”结尾的备份文件。</span><br><span class="line">-c 与lt一起使用，显示并按照修改时间（ctime）排序，与l一起使用，显示修改时间，按名称排序。</span><br><span class="line">-d 将目录象文件一样显示，而不是显示其下的文件。</span><br><span class="line">-f 对输出的文件不排序，使用此选项后aU选项生效，lst选项失效</span><br><span class="line">-F 在每个文件名后附上一个字符以说明该文件的类型，“*”表示可执行的普通文件；“/”表示目录；“@”表示符号链接；“|”表示FIFOs；“=”表示套接字(sockets)。</span><br><span class="line">-g 类似l但是不显示所有者</span><br><span class="line">-h 与l一起，以易于阅读的格式输出文件大小(例如 1K 234M 2G)</span><br><span class="line">-i 输出文件的i节点的索引信息。</span><br><span class="line">-k 以k字节的形式表示文件的大小。--si类似k但是以1000为进制而非1024</span><br><span class="line">-l 列出文件的详细信息。</span><br><span class="line">-L 遇到链接文件是，显示原文件的信息，而非链接信息</span><br><span class="line">-m 横向输出文件名，并以“，”作分格符。</span><br><span class="line">-n 类似l,但是用数字的 UID,GID 代替名称。</span><br><span class="line">-o 显示文件的除组信息外的详细信息。</span><br><span class="line">-p 目录后面加上/标识</span><br><span class="line">-q 用?代替不可输出的字符。</span><br><span class="line">-r 对目录反向排序。</span><br><span class="line">-s 在每个文件名后输出该文件的大小。</span><br><span class="line">-t 以修改时间排序。</span><br><span class="line">-u 与lt一起使用，以访问时间(atime)排序；与l一起使用显示访问时间，按照名称排序</span><br><span class="line">-x 按列输出，横向排序。</span><br><span class="line">-Q 把输出的文件名用双引号括起来。</span><br><span class="line">-R 列出所有子目录下的文件。</span><br><span class="line">-S 以文件大小排序。</span><br><span class="line">-X 以文件的扩展名(最后一个 . 后的字符)排序。</span><br><span class="line">-1 一行只输出一个文件。</span><br><span class="line">--color=no 不显示彩色文件名</span><br><span class="line">--help 在标准输出上显示帮助信息。</span><br><span class="line">--version 在标准输出上输出版本信息并退出。</span><br></pre></td></tr></table></figure>

<ul>
<li>mkdir 建立目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-m	设置权限模式(类似chmod)</span><br><span class="line">-p	需要时创建目标目录的上层目录，但即使这些目录已存在也不当作错误处理</span><br><span class="line">-v	每次创建新目录都显示信息</span><br><span class="line">-Z	将每个创建的目录的SELinux 安全环境设置为CTX</span><br></pre></td></tr></table></figure>

<ul>
<li>rmdir 删除空文件夹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p  递归删除空目录，从最后一个目录倒删</span><br></pre></td></tr></table></figure>

<ul>
<li>touch 建立文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">-a	只更改访问时间</span><br><span class="line">-c	不创建任何文件</span><br><span class="line">-m	只更改修改时间</span><br><span class="line">-r	使用指定文件的时间属性替代当前时间</span><br><span class="line">-t	使用[[CC]YY]MMDDhhmm[.ss] 格式的时间替代当前时间</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         	块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768d	Inode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近更改：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近改动：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -a -t 202002010101.30 hello</span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         	块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768d	Inode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-02-01 01:01:30.000000000 -0500</span><br><span class="line">最近更改：2020-03-17 16:51:35.502961371 -0400</span><br><span class="line">最近改动：2020-03-17 16:51:53.143475189 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -m -t 202002050101.30 hello</span><br><span class="line">[root@zutuanxue ~]# stat hello</span><br><span class="line">  文件：hello</span><br><span class="line">  大小：0         	块：0          IO 块：4096   普通空文件</span><br><span class="line">设备：fd00h/64768d	Inode：34502264    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-02-01 01:01:30.000000000 -0500</span><br><span class="line">最近更改：2020-02-05 01:01:30.000000000 -0500</span><br><span class="line">最近改动：2020-03-17 16:52:07.837453512 -0400</span><br><span class="line">创建时间：-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将hello-linux.txt的属性改成与anaconda-ks.cfg一样</span><br><span class="line">[root@zutuanxue ~]# stat hello-linux.txt </span><br><span class="line">  文件：hello-linux.txt</span><br><span class="line">  大小：12        	块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768d	Inode：34513350    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-17 22:50:51.319377144 -0400</span><br><span class="line">最近更改：2020-03-17 22:50:45.909483733 -0400</span><br><span class="line">最近改动：2020-03-17 22:50:45.912483674 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# stat anaconda-ks.cfg </span><br><span class="line">  文件：anaconda-ks.cfg</span><br><span class="line">  大小：1378      	块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768d	Inode：34973658    硬链接：1</span><br><span class="line">权限：(0600/-rw-------)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-16 23:08:34.121427663 -0400</span><br><span class="line">最近更改：2020-02-04 15:01:33.273959663 -0500</span><br><span class="line">最近改动：2020-03-18 16:33:48.873881970 -0400</span><br><span class="line">创建时间：-</span><br><span class="line">[root@zutuanxue ~]# touch -r anaconda-ks.cfg hello-linux.txt </span><br><span class="line">[root@zutuanxue ~]# stat hello-linux.txt </span><br><span class="line">  文件：hello-linux.txt</span><br><span class="line">  大小：12        	块：8          IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768d	Inode：34513350    硬链接：1</span><br><span class="line">权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">最近访问：2020-03-16 23:08:34.121427663 -0400</span><br><span class="line">最近更改：2020-02-04 15:01:33.273959663 -0500</span><br><span class="line">最近改动：2020-03-18 18:22:48.694597233 -0400</span><br><span class="line">创建时间：-</span><br></pre></td></tr></table></figure>

<ul>
<li>cat 查看文件内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-A	等价于-vET</span><br><span class="line">-b	对非空输出行编号</span><br><span class="line">-e      等价于-vE</span><br><span class="line">-E	在每行结束处显示$</span><br><span class="line">-n	对输出的所有行编号</span><br><span class="line">-s	不输出多行空行</span><br><span class="line">-t	与-vT等价</span><br><span class="line">-T	将跳格字符（tab）显示为 ^I</span><br><span class="line">-v	使用^和M</span><br></pre></td></tr></table></figure>

<ul>
<li>rm 删除文件或目录</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-f	强制删除。忽略不存在的文件，不提示确认</span><br><span class="line">-i	在删除前需要确认</span><br><span class="line">-I	超过三个文件或者递归删除前要求确认。比-i提示内容更少</span><br><span class="line">-d	删除空目录</span><br><span class="line">-r	递归删除目录及其内容</span><br></pre></td></tr></table></figure>

<p>这些命令都是初学者可能会经常用到的，大家可以在自己的虚拟机上练习一下</p>
<ul>
<li>cp 拷贝</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-i	覆盖前询问(使前面的 -n 选项失效)</span><br><span class="line">-n	不要覆盖已存在的文件(使前面的 -i 选项失效)</span><br><span class="line">-R, -r, --recursive		递归复制目录及其子目录内的所有内容</span><br><span class="line">-s	只创建符号链接而不复制文件</span><br><span class="line">-f	强制，将目标文件无法打开则将其移除并重试</span><br></pre></td></tr></table></figure>

<ul>
<li>mv 移动&#x2F;改名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-f	覆盖前不询问</span><br><span class="line">-i	覆盖前询问</span><br><span class="line">-n	不覆盖已存在文件</span><br><span class="line">#如果您指定了-i、-f、-n 中的多个，仅最后一个生效。</span><br></pre></td></tr></table></figure>

<h2 id="二、常用符号"><a href="#二、常用符号" class="headerlink" title="二、常用符号"></a>二、常用符号</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*	任意字符串</span><br><span class="line"></span><br><span class="line">?	任意字符</span><br><span class="line"></span><br><span class="line">/	路径间隔符</span><br><span class="line"></span><br><span class="line">~	当前用户的家目录	管理员家目录为/root，其它用户的家目录在/home/用户名	</span><br></pre></td></tr></table></figure>

<h1 id="Linux的基本优化"><a href="#Linux的基本优化" class="headerlink" title="Linux的基本优化"></a>Linux的基本优化</h1><p> 阅读 (295010) </p>
<p> 分享</p>
<h2 id="一、selinux和防火墙优化"><a href="#一、selinux和防火墙优化" class="headerlink" title="一、selinux和防火墙优化"></a>一、selinux和防火墙优化</h2><h3 id="1、SElinux"><a href="#1、SElinux" class="headerlink" title="1、SElinux"></a>1、SElinux</h3><p>selinux 安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。SELinux 主要由美国国家安全局开发。它的主要 作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。也由于它的这个原则，导致我们很多操作无法正确的执行，所以对于初学者而言在会用selinux之前我们要把这个子系统关闭</p>
<p><strong>SELinux 的工作模式</strong></p>
<p>SELinux 有三种工作模式，分别是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- enforcing：强制模式。违反 SELinux 规则的行为将被阻止并记录到日志中。</span><br><span class="line"></span><br><span class="line">- permissive：宽容模式。违反 SELinux 规则的行为只会记录到日志中。一般为调试用。</span><br><span class="line"></span><br><span class="line">- disabled：关闭 SELinux。</span><br></pre></td></tr></table></figure>

<p><strong>SElinux工作模式设置方法</strong></p>
<ul>
<li>临时设置<br>enforcing 和 permissive 模式可以通过 setenforce 1|0 命令快速切换,重启系统后失效。</li>
<li>永久生效<br>SELinux 工作模式可以在 &#x2F;etc&#x2F;selinux&#x2F;config 中设定。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果想从 disabled 切换到 enforcing 或者 permissive 的话，需要重启系统。反过来也一样。</span><br></pre></td></tr></table></figure>

<p>需要注意的是，如果系统已经在关闭 SELinux 的状态下运行了一段时间，在打开 SELinux 之后的第一次重启速度可能会比较慢。因为系统必须为磁盘中的文件创建安全上下文，我们现在来看一下如何关闭selinux，首先用root的身份登录系统，打开一个终端输入gedit &#x2F;etc&#x2F;selinux&#x2F;config命令，回车之后会打开一个文件，将所标记出来部分的enforcing改为disabled，保存之后重启linux系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# gedit /etc/selinux/config</span><br><span class="line"></span><br><span class="line">##/etc/selinux/config  内容</span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=enforcing     #这里定义selinux是否为开启状态</span><br><span class="line"></span><br><span class="line"># SELINUXTYPE= can take one of these three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected. </span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted   #这里定义的是selinux保护级别</span><br></pre></td></tr></table></figure>

<p>重启登录之后可以使用sestatus -v命令去查看是否成功，如果看到的状态不是disabled则需要重新操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# sestatus -v</span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></table></figure>

<h3 id="2、防火墙"><a href="#2、防火墙" class="headerlink" title="2、防火墙"></a>2、防火墙</h3><p>防火墙技术是通过有机结合各类用于安全管理与筛选的软件和硬件设备，帮助计算机网络于其内、外网之间构建一道相对隔绝的保护屏障，以保护用户资料与信息安全性的一种技术。 在CentOS8中使用firewalld作为防火墙，基于iptables的防火墙被默认不启动，但仍然可以继续使用。CentOS8中有几种防火墙共存：firewalld、iptables、ebtables等，默认使用firewalld作为防火墙，通过firewall-cmd工具来管理netfilter,不过底层调用的命令仍然是iptables，虽然防火墙是安全软件，但是它的一些默认设置会对初学者造成困扰，所以我们要先关闭firewalld。通过systemctl stop firewalld.service停止防火墙，systemctl disable firewalld.service禁止防火墙服务开机启动，接下来我们看一下如何设置中文</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389727708.png" alt="1571044294838.png"></p>
<h2 id="二、中文设置优化"><a href="#二、中文设置优化" class="headerlink" title="二、中文设置优化"></a>二、中文设置优化</h2><p>我们在安装系统选择的是中文，但是我们系统当中并没有中文输入法，所以如果要想输入中文的话需要添加中文输入法，以root用户身份登录系统之后我们使用gedit &#x2F;etc&#x2F;yum.repos.d&#x2F;server.repo,输入如下内容保存退出，确保虚拟机的光驱中加载的是CentOS8的光盘镜像，并且已连接<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389773586.png" alt="1571048414719.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389785159.png" alt="1571047694890.png"></p>
<p>设置完成之后执行mkdir命令建立目录，然后挂载光盘</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389813049.png" alt="1571047821170.png"></p>
<p>光盘挂载完成之后执行输入法安装命令，如果只要拼音则安装的是： ibus-libpinyin.x86_64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 安装所有支持的输入法</span><br><span class="line">[root@zutuanxue ~]# dnf install ibus* -y</span><br><span class="line"></span><br><span class="line"># 或者 精准安装拼音输入法</span><br><span class="line">[root@zutuanxue ~]#  dnf install ibus-libpinyin.x86_64 -y</span><br></pre></td></tr></table></figure>

<p>等待软件包安装完成之后重启系统然后重新登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">如果不想重启系统可以使用</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ibus restart </span><br><span class="line"></span><br><span class="line">命令重启ibus-daemon进程来实现</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389829983.png" alt="1571048752409.png"></p>
<p>安装完成之后点击右上角的按钮然后点击设置</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389850869.png" alt="1571048826875.png"></p>
<p>在新打开的窗口中找到语言，选择添加，选择汉语，然后选择一个适合自己的中文输入法点击添加之后就可以使用中文输入法了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389866470.png" alt="1571048904227.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389893147.png" alt="1571049215146.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389909572.png" alt="1571049244944.png"></p>
<p>输入法设置完成之后，我们来看下时间相关的设置</p>
<h2 id="三、网络时间服务器优化"><a href="#三、网络时间服务器优化" class="headerlink" title="三、网络时间服务器优化"></a>三、网络时间服务器优化</h2><p>如果系统的时间不准，自己手动设置起来比较麻烦，我们可以看下怎么来优化一下</p>
<p>同样还是找到设置，在里面找到详细信息，展开之后可以看到日期和时间的设置，两个自动设置的选项打开，如果你的虚拟机可以联网的话，过一会就会看到时间正常了</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389925235.png" alt="1571049564017.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389936841.png" alt="1571049605979.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389949009.png" alt="1571049727212.png"></p>
<h2 id="四、自启动服务优化"><a href="#四、自启动服务优化" class="headerlink" title="四、自启动服务优化"></a>四、自启动服务优化</h2><p>自启动服务优化的方式类似我们之前提到的停止firewalld，但是首先我们要确认一下有哪些服务是开机启动的，然后利用之前用过的systemctl stop servername和systemctl disabled servername这两条命令停止相应的服务，比如说蓝牙服务和防火墙服务，但是各位需要注意的是，这里面所涉及的服务在你不了解的前提下不要乱停止，否则可能会导致系统功能失灵，甚至是崩溃<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389969693.png" alt="1571050099841.png"></p>
<h1 id="Linux目录结构和文件属性管理"><a href="#Linux目录结构和文件属性管理" class="headerlink" title="Linux目录结构和文件属性管理"></a>Linux目录结构和文件属性管理</h1><p> 阅读 (221935) </p>
<p> 分享</p>
<h2 id="一、FHS介绍"><a href="#一、FHS介绍" class="headerlink" title="一、FHS介绍"></a>一、FHS介绍</h2><p>Filesystem Hierarchy Standard（文件系统层次化标准）的缩写，多数Linux版本采用这种文件组织形式，类似于Windows操作系统中c盘的文件目录，FHS采用树形结构组织文件。FHS定义了系统中每个区域的用途、所需要的最小构成的文件和目录，同时还给出了例外处理与矛盾处理。</p>
<p>FHS定义了两层规范，第一层是， &#x2F; 下面的各个目录应该要放什么文件数据，例如&#x2F;etc应该要放置设置文件，&#x2F;bin与&#x2F;sbin则应该要放置可执行文件等等。第二层则是针对&#x2F;usr及&#x2F;var这两个目录的子目录来定义。例如&#x2F;var&#x2F;log放置系统登录文件、&#x2F;usr&#x2F;share放置共享数据等等。</p>
<h2 id="二、linux目录结构介绍"><a href="#二、linux目录结构介绍" class="headerlink" title="二、linux目录结构介绍"></a>二、linux目录结构介绍</h2><p>整个Linux系统最重要的地方就是在于目录树架构，所谓的目录树架构就是以根目录为主， 然后向下呈现分支状的目录结构的一种档案架构。下图给出了linux的目录结构，那这些目录都有什么作用呢？</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602390979455.png" alt="1571118994639.png"></p>
<h2 id="三、linux目录的作用"><a href="#三、linux目录的作用" class="headerlink" title="三、linux目录的作用"></a>三、linux目录的作用</h2><ul>
<li><strong>根目录（&#x2F;）</strong></li>
</ul>
<p>最高一级目录，所有目录都是根目录衍生出来，只有root用户具有写权限，一般根目录下只存放目录，不要存放件</p>
<ul>
<li><strong>&#x2F;bin目录 – 用户二进制文件</strong></li>
</ul>
<p>包含二进制的可执行文件，你需要的常见的Linux命令都位于此目录下。</p>
<ul>
<li><strong>&#x2F;sbin目录 – 系统二进制文件</strong></li>
</ul>
<p>这个目录下的命令通常由系统管理员使用， 对系统进行维护。</p>
<ul>
<li><strong>&#x2F;etc– 配置文件</strong></li>
</ul>
<p>包含所有程序所需要的配置文件，也包含用于启动&#x2F;停止单个程序的起动和关闭shell脚本。</p>
<ul>
<li><strong>&#x2F;dev-设备文件</strong></li>
</ul>
<p>包含设备文件，包括终端设备、USB或连接到系统的任何设备，如网卡等。</p>
<ul>
<li><strong>&#x2F;proc-进程信息文件</strong></li>
</ul>
<p>这是一个虚拟的文件系统，包含有关正在运行的进程信息。</p>
<ul>
<li><strong>&#x2F;usr-用户程序</strong></li>
</ul>
<p>包含二进制文件、库文件、文档和二级程序的源代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin中包含用户程序的二进制文件。如果你在/bin中找不到用户二进制文件，到/usr/bin目录看看。</span><br><span class="line">/usr/sbin中包含系统管理员的二进制文件。如果你在/sbin中找不到系统二进制文件，到/usr/sbin目录看看。</span><br><span class="line">/usr/lib中包含了/usr/bin和/usr/sbin用到的库。</span><br><span class="line">/usr/local中包含了从源安装的用户程序。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&#x2F;home -HOME目录</strong></li>
</ul>
<p>包含所有用户的个人档案，Linux是多用户的系统，所以用该目录保存各用户的信息。</p>
<ul>
<li><strong>&#x2F;boot -引导加载程序</strong></li>
</ul>
<p>包含引导加载程序相关的文件。</p>
<ul>
<li><strong>&#x2F;lib -系统库</strong></li>
</ul>
<p>包含支持位于&#x2F;lib和&#x2F;sbin下的二进制文件的库文件。</p>
<ul>
<li><strong>&#x2F;opt -可选的附加应用程序</strong></li>
</ul>
<p>给主机额外安装软件所摆放的目录，以前的 Linux 系统中，习惯放置在 &#x2F;usr&#x2F;local 目录下</p>
<ul>
<li><strong>&#x2F;mnt &#x2F;media -挂载目录</strong></li>
</ul>
<p>光盘默认挂载点，通常光盘挂载于 &#x2F;mnt&#x2F;cdrom 下，也不一定，可以选择任意位置进行挂载。</p>
<ul>
<li><strong>&#x2F;root</strong> 管理员家目录</li>
</ul>
<p>在这里我们所介绍的目录是在linux系统中常见的目录，不同厂商的linux有所差异，有的版本中会出现有额外作用的目录，这个就需要具体问题具体对待了。</p>
<h2 id="四、目录和设备节点"><a href="#四、目录和设备节点" class="headerlink" title="四、目录和设备节点"></a>四、目录和设备节点</h2><p>我们已经知道目录是用来存放文件的，不同的目录存放的文件作用不同，那么我们来看下设备节点是什么？ 一个设备节点其实就是一个文件，Linux中称为设备文件。有一点必要说明的是，在Linux中，<strong>所有的设备访问都是通过文件的方式，一般的数据文件程序普通文件，设备节点称为设备文件</strong>，而这些设备节点，或者说是设备文件都统一存放在&#x2F;dev目录下，简单来说，设备节点是一种特殊的文件，只不过这个文件存放的不是一般的数据，而是和你计算机中的设备相关联的。</p>
<h2 id="五、-和…"><a href="#五、-和…" class="headerlink" title="五、.和…"></a>五、.和…</h2><p>在linux系统中，使用ls -a命令时，你会发现每一个目录下都包含两个目录，这两个目录就是.和…，其中”.“表示是的是当前目录，也就是你使用pwd所查看到的路径，而”…”表示的上一级目录，也就是父目录。</p>
<h2 id="六、绝对路径和相对路径"><a href="#六、绝对路径和相对路径" class="headerlink" title="六、绝对路径和相对路径"></a>六、绝对路径和相对路径</h2><p>linux的路径书写方式有两种：</p>
<ul>
<li>绝对路径：路径的写法一定是由根目录 &#x2F; 写起的，以根目录为起点；</li>
<li>相对路径：路径的写法不是由根目录 &#x2F; 写起的，不以根目录为起点。</li>
</ul>
<p>例如，你知道你的朋友在四楼，而你在五楼，如果你的朋友询问你的位置，你就有两种回答方式：</p>
<ul>
<li>绝对路径的方式就是你告诉对方你在XX小区的xx号楼的五楼，</li>
<li>相对路径的方式就是你告诉对方你在对方五楼。</li>
</ul>
<p>至于优缺点方面没有绝对的答案，不同情况使用不同的路径罢了，两种路径的出现只是因为参照物不同而已。</p>
<h1 id="深入理解linux文件"><a href="#深入理解linux文件" class="headerlink" title="深入理解linux文件"></a>深入理解linux文件</h1><p> 阅读 (212199) </p>
<p> 分享</p>
<h2 id="一、linux的文件存储"><a href="#一、linux的文件存储" class="headerlink" title="一、linux的文件存储"></a>一、linux的文件存储</h2><p>假如有一个用户在linux系统中编辑了一个文件，编辑完内容后，关闭编辑器时会问用户改如何命名这个文件，设置完名称之后会选择一个目录将该文件保存到指定目录下，在这个例子中包含了linux系统中与文件相关的三个组成部分</p>
<ul>
<li>数据：就是文件的内容，保存在一个叫data（数据块）的结构中</li>
<li>元数据：保存一个文件的特征的系统数据，用来保存除了文件内容和文件名以外的与文件相关的信息， 诸如文件的创建者，日期，大小等等，保存在一个叫inode（i节点）的结构中。</li>
<li>文件名：用来保存文件名称，文件名保存在一个叫dentry（目录项）的结构中。</li>
</ul>
<h2 id="二、i节点介绍"><a href="#二、i节点介绍" class="headerlink" title="二、i节点介绍"></a>二、i节点介绍</h2><p>通过前面的课程我们知道，inode是用来保存文件的元数据的，除此之外还保存文件相关属性信息，如链接数等。我们通过类似stat hello.txt这条命令查看指定文件的inode信息。</p>
<h2 id="三、链接文件介绍"><a href="#三、链接文件介绍" class="headerlink" title="三、链接文件介绍"></a>三、链接文件介绍</h2><p> Linux中如果用户想把同一个文件保存在两个地方，或用两个不同的文件名保存，除了复制之外还有另外一种选择，就是链接，在linux系统中链接分为硬链接，软链接，空链接，递归链接等</p>
<p><strong>链接命令: ln</strong></p>
<p>语法：<br>ln 源文件路径 链接位置路径</p>
<p>常用命令选项:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-s 创建软连接</span><br><span class="line"></span><br><span class="line">-f 强制执行</span><br><span class="line"></span><br><span class="line">-i 交互模式，文件存在则提示用户是否覆盖</span><br><span class="line"></span><br><span class="line">-n 把符号链接视为一般目录,显示为一般文件</span><br><span class="line"></span><br><span class="line">-v 显示详细的处理过程</span><br></pre></td></tr></table></figure>

<ul>
<li>硬链接：允许一个文件拥有多个有效路径名，这样用户就可以建立硬链接到重要的文件，以防止“误删”源数据，不过硬链接只能在同一文件系统中的文件之间进行连接</li>
<li>软链接 ： 也叫符号链接，类似于windows系统中的快捷方式，与硬链接不同，软链接就是一个普通文件，软链接可对文件或目录创建。</li>
</ul>
<p>这是概念上的描述，我们用一句话来将这两种链接进行总结：</p>
<p>a、硬链接不能链目录，不能跨文件系统，软链接可以；</p>
<p>b、源文件删除后软链接失效，硬链接依然可用；</p>
<p>我们通过下面的例子可以看到硬链接和软链接的创建方式以及基本对比</p>
<p><strong>软连接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 在root家目录下创建一个文件ztx</span><br><span class="line">[root@zutuanxue ~]# touch ztx</span><br><span class="line"></span><br><span class="line"># 为/root/ztx文件创建一个软连接文件在/tmp目录下</span><br><span class="line">[root@zutuanxue ~]# ln -s /root/ztx /tmp/</span><br><span class="line"></span><br><span class="line"># 验证快捷方式是否创建成功</span><br><span class="line">[root@zutuanxue ~]# ls -l /tmp/ztx </span><br><span class="line">lrwxrwxrwx 1 root root 9 11月 26 15:06 /tmp/ztx -&gt; /root/ztx</span><br><span class="line"></span><br><span class="line"># 查看源文件和链接文件的i节点信息</span><br><span class="line">[root@zutuanxue ~]# ls -i /root/ztx /tmp/ztx </span><br><span class="line">674632 /root/ztx  929916 /tmp/ztx    # 发现软连接的文件i节点不同</span><br><span class="line"></span><br><span class="line"># 删除源文件</span><br><span class="line">[root@zutuanxue ~]# rm -f /root/ztx</span><br><span class="line"> </span><br><span class="line"># 验证链接文件是否可用</span><br><span class="line">[root@zutuanxue ~]# cat /tmp/ztx </span><br><span class="line">cat: /tmp/ztx: 没有那个文件或目录    #删除源文件发现链接文件失效</span><br></pre></td></tr></table></figure>

<p><strong>硬链接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个源文件  名字为组团学</span><br><span class="line">[root@zutuanxue ~]# touch zutuanxue   </span><br><span class="line"></span><br><span class="line"># 为/root/zutuanxue文件创建一个硬链接文件 到/tmp/zutuanxue</span><br><span class="line">[root@zutuanxue ~]# ln /root/zutuanxue /tmp/zutuanxue   </span><br><span class="line"></span><br><span class="line"># 查看源文件和链接文件的i节点</span><br><span class="line">[root@zutuanxue ~]# ls -i /root/zutuanxue /tmp/zutuanxue </span><br><span class="line">674632 /root/zutuanxue  674632 /tmp/zutuanxue  # 硬链接的i节点和源文件的i节点一致</span><br><span class="line"></span><br><span class="line"># 删除源文件，看看硬链接文件是否可用</span><br><span class="line">[root@zutuanxue ~]# echo test &gt; /root/zutuanxue </span><br><span class="line">[root@zutuanxue ~]# rm /root/zutuanxue </span><br><span class="line">rm：是否删除普通文件 &quot;/root/zutuanxue&quot;？y</span><br><span class="line">[root@zutuanxue ~]# cat /tmp/zutuanxue </span><br><span class="line">test			#删除硬链接源文件后，发现链接文件依然可以使用</span><br></pre></td></tr></table></figure>

<p>除了上面我们说到的硬链接和软链接之外还有</p>
<ul>
<li>空链接，所谓的空链接就是软链接指向的源文件不存在了，包括源文件被删除，改名。</li>
<li>递归链接：递归链接不如空链接常见，如果想看的话几乎需要专门寻找，如果用户创建两个软链接，linka与linkb关联，而linkb又与linka关联，这时候就会出现递归链接，比如</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602391513564.png" alt="1571130770456.png"></p>
<ul>
<li>绝对软链接和相对软链接：主要指的是用户在创建软链接的时候使用的是绝对路径还是相对路径来指定链接目标，如果链接创建完成之后不会移动，那么这两种方法可以随意使用，但是如果链接文件需要被移动，那么建议还是使用绝对路径，比如</li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602391531255.png" alt="1571132049532.png"></p>
<p>好了链接我们就说到这里，下面我们看一下时间戳</p>
<h2 id="四、时间戳"><a href="#四、时间戳" class="headerlink" title="四、时间戳"></a>四、时间戳</h2><p>时间戳是指格林威治时间1970年01月01日00时00分00秒(北京时间1970年01月01日08时00分00秒)起至现在的总毫秒数。通俗的讲， 时间戳是一份能够表示一份数据在一个特定时间点已经存在的完整的可验证的数据。 它的提出主要是为用户提供一份电子证据， 以证明用户的某些数据的产生时间。 当我们使用stat命令查看文件的时候除了创建时间你会发现有三个跟时间戳相关的信息</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602391546471.png" alt="1571133239914.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602391560592.png" alt="1571133272500.png"></p>
<table>
<thead>
<tr>
<th>缩写</th>
<th>命令</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td>Atime</td>
<td>访问时间</td>
<td>文件数据每次被阅读后的更新</td>
</tr>
<tr>
<td>Ctime</td>
<td>改变时间</td>
<td>文件的i-节点信息每次被改变后都更新</td>
</tr>
<tr>
<td>Mtime</td>
<td>修改时间</td>
<td>文件数据每次被改变后的更新</td>
</tr>
</tbody></table>
<h2 id="五、常用目录管理命令总结"><a href="#五、常用目录管理命令总结" class="headerlink" title="五、常用目录管理命令总结"></a>五、常用目录管理命令总结</h2><ul>
<li><strong>目录：</strong></li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>用法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>mkdir</td>
<td>mkdir 目录名称</td>
<td>创建一个目录</td>
</tr>
<tr>
<td>rmdir</td>
<td>rmdir 目录名称</td>
<td>删除一个空目录</td>
</tr>
<tr>
<td>cd</td>
<td>cd 目录名称</td>
<td>进入一个目录</td>
</tr>
<tr>
<td>ls</td>
<td>ls 目录名称</td>
<td>列出一个目录内容</td>
</tr>
</tbody></table>
<ul>
<li><strong>文件：</strong></li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>用法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>touch</td>
<td>touch 文件名</td>
<td>新建一个文件</td>
</tr>
<tr>
<td>rm</td>
<td>rm 文件名</td>
<td>删除一个文件</td>
</tr>
<tr>
<td>cat</td>
<td>cat 文件名</td>
<td>打印一个文件内容</td>
</tr>
</tbody></table>
<ul>
<li><strong>其他：</strong></li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>用法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>cp</td>
<td>mkdir file folder</td>
<td>将文件file拷贝到目录folder</td>
</tr>
<tr>
<td>mv</td>
<td>mv A B</td>
<td>移动A到B目录或者从命名 A为B</td>
</tr>
<tr>
<td>ln</td>
<td>ln -s A B</td>
<td>给A做一个快捷方式,放到B位置</td>
</tr>
</tbody></table>
<h1 id="VIM文本编辑器"><a href="#VIM文本编辑器" class="headerlink" title="VIM文本编辑器"></a>VIM文本编辑器</h1><p> 阅读 (420113) </p>
<p> 分享</p>
<h2 id="一、vim使用介绍"><a href="#一、vim使用介绍" class="headerlink" title="一、vim使用介绍"></a>一、vim使用介绍</h2><p><strong>vim介绍</strong></p>
<p>在linux系统中，大部分配置文件都是ASCII的纯文本形式存放的，所以我们在修改系统设置的时候使用简单的文本编辑软件就可以实现了，如果你使用过windows当中的word的话，那么你可能会感觉linux字符界面的文本编辑工具并不是太好用，毕竟没有图形窗口，看着不会太舒服。但是既然要学习linux，掌握并熟练使用文本编辑工具是必不可少的技能，在linux当中的文本编辑工具有很多，如emacs pico nano joe vi&#x2F;vim 等等</p>
<p>既然有这么多文本编辑工具，为什么要学习vi&#x2F;vim呢？</p>
<p><strong>为什么要使用vim？</strong></p>
<p>虽然在linux下的文本编辑器众多，这些工具都有各自的优点，但是有几点是其它编辑工具所不能比拟的</p>
<ul>
<li>所有的类Unix系统都内建vi，其它的编辑工具则不一定，而vim相当于是vi的升级版</li>
<li>很多软件的编辑界面都会调用vi，如后面提到的crontab、edquota等</li>
<li>vim具有程序编辑能力，可以主动以字体颜色标识语法的正确性，方便代码编写</li>
<li>程序简单，编辑速度非常快</li>
</ul>
<p>综上所述这是一个老式的文字处理工具，但是功能很齐全，不仅是文本处理工具，还是一个程序编辑工具，就连官方网站也说vim是一个程序开发工具而不是文字处理软件，因为它包含了很多额外的功能，如：多文件编辑，区块复制等，这些功能让我们在进行配置文件修改的时候会更方便。</p>
<p>介绍就到这里，我们来看一下基本使用</p>
<h2 id="二、基本使用"><a href="#二、基本使用" class="headerlink" title="二、基本使用"></a>二、基本使用</h2><p>由于vi&#x2F;vim是一个全屏幕的文本编辑器，它工作在三种模式下：分别是命令模式、输入模式和末行模式。可以分别从命令模式切换到输入模式和末行模式，也可以从末行模式或输入模式切换到命令模式，但是输入模式与末行模式之间不能互相切换。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602392063340.png" alt="1571203454643.png"></p>
<p>第一种：命令模式，当我使用“vim myfile”命令打开myfile这个文件时就处于命令模式,屏幕左下角为文件名（myfile），1L 表示本文件有1 行，26C 表示此文件有26 个字符。1,25表示光标当前位置，在此模式下用户可以输入命令来进行文件存盘、移动光标、删除字符、撤消命令和重复命令等操作，还可以设置编辑环境。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~   表示没有内容                                                                                          </span><br><span class="line">&quot;myfile&quot; 1L, 26C                                         1,25         全部</span><br></pre></td></tr></table></figure>

<p>第二种：编辑模式，又叫输入模式。在输入模式下，屏幕的左下方会出现INSERT (插入)字样。在输入状态下，用户可以输入文本的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">-- 插入 --                                                       1,25         全部</span><br></pre></td></tr></table></figure>

<p>第三种：末行模式。只要在命令模式下输入命令“：”即可进入末行模式。在末行模式下，可以进行保存文件、退出vi、进行查找和替换等操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this is the command mode.</span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">~                                                                                  </span><br><span class="line">:q!                                                    </span><br></pre></td></tr></table></figure>

<p>三种模式介绍完了，我们看下vim的使用，这里面我们还是按照三种模式来对vim的使用进行说明</p>
<p><strong>命令模式可以使用的按键说明</strong></p>
<p> <strong>光标控制按键</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>h 或 向左箭头键(←)</td>
<td>光标向左移动一个字符</td>
</tr>
<tr>
<td>j 或 向下箭头键(↓)</td>
<td>光标向下移动一个字符</td>
</tr>
<tr>
<td>k 或 向上箭头键(↑)</td>
<td>光标向上移动一个字符</td>
</tr>
<tr>
<td>l 或 向右箭头键(→)</td>
<td>光标向右移动一个字符</td>
</tr>
<tr>
<td>15j&#x2F;15↓</td>
<td>向下移动15行</td>
</tr>
<tr>
<td>[Ctrl] + [f]</td>
<td>屏幕『向下』移动一页，相当于 [Page Down]按键 (常用)</td>
</tr>
<tr>
<td>[Ctrl] + [b]</td>
<td>屏幕『向上』移动一页，相当于 [Page Up] 按键 (常用)</td>
</tr>
<tr>
<td>[Ctrl] + [d]</td>
<td>屏幕『向下』移动半页</td>
</tr>
<tr>
<td>[Ctrl] + [u]</td>
<td>屏幕『向上』移动半页</td>
</tr>
<tr>
<td>n</td>
<td>那个 n 表示『数字』，例如 3 。按下数字后再按空格键，光标会向右移动3 个字符。</td>
</tr>
<tr>
<td>0 或功能键[Home]</td>
<td>这是数字『 0 』：移动到这一行的最前面字符处 (常用)</td>
</tr>
<tr>
<td>$ 或功能键[End]</td>
<td>移动到这一行的最后面字符处(常用)</td>
</tr>
<tr>
<td>H</td>
<td>光标移动到这个屏幕的最上方那一行的第一个字符</td>
</tr>
<tr>
<td>M</td>
<td>光标移动到这个屏幕的中央那一行的第一个字符</td>
</tr>
<tr>
<td>L</td>
<td>光标移动到这个屏幕的最下方那一行的第一个字符</td>
</tr>
<tr>
<td>G</td>
<td>移动到这个文件的最后一行(常用)</td>
</tr>
<tr>
<td>nG</td>
<td>n 为数字。移动到这个文件的第 n 行。可配合 :set nu</td>
</tr>
<tr>
<td>gg</td>
<td>移动到这个档案的第一行，相当于 1G (常用)</td>
</tr>
<tr>
<td>n</td>
<td>n 为数字。光标向下移动 n 行(常用)</td>
</tr>
</tbody></table>
<p> <strong>搜索与替换</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;abc</td>
<td>向光标之下查找一个名称为 abc 的字符串。 (常用)</td>
</tr>
<tr>
<td>?abc</td>
<td>向光标之上查找一个字符串名称为 abc 的字符串。</td>
</tr>
<tr>
<td>n</td>
<td>这个 n 是英文按键。代表『重复前一个查找的动作』。</td>
</tr>
<tr>
<td>N</td>
<td>这个 N 是英文按键。与 n 刚好相反</td>
</tr>
<tr>
<td>:n1,n2s&#x2F;abc1&#x2F;abc2&#x2F;g</td>
<td>n1 与 n2 为数字。在第 n1 与 n2 行之间查找 abc1 替换为 abc2</td>
</tr>
<tr>
<td>:1,$s&#x2F;abc1&#x2F;abc2&#x2F;g</td>
<td>从第一行到最后一行查找 abc1 字符串，并将该字符串替换为 abc2 (常用)</td>
</tr>
<tr>
<td>:1,$s&#x2F;abc1&#x2F;abc2&#x2F;gc</td>
<td>从第一行到最后一行查找 abc1 字符串，并将该字符串替换为 abc2 ,且在替换前显示提示字符给用户确认</td>
</tr>
</tbody></table>
<p> <strong>删除与复制粘贴</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>x, X</td>
<td>x 相当于 [del] ， X 相当于 [backspace] (常用)</td>
</tr>
<tr>
<td>nx</td>
<td>n 为数字，连续向后删除 n 个字符。</td>
</tr>
<tr>
<td>dd</td>
<td>删除光标所在的那一整行(常用)</td>
</tr>
<tr>
<td>ndd</td>
<td>n 为数字。删除光标所在的向下 n 行(常用)</td>
</tr>
<tr>
<td>d1G</td>
<td>删除光标所在行到第一行的所有数据</td>
</tr>
<tr>
<td>dG</td>
<td>删除光标所在行到最后一行的所有数据</td>
</tr>
<tr>
<td>d$</td>
<td>删除光标所在处，到该行的最后一个字符</td>
</tr>
<tr>
<td>d0</td>
<td>那个是数字的 0 ，删除光标所在处，到该行的最前面一个字符</td>
</tr>
<tr>
<td>yy</td>
<td>复制光标所在的那一行(常用)</td>
</tr>
<tr>
<td>nyy</td>
<td>n 为数字。(常用)</td>
</tr>
<tr>
<td>y1G</td>
<td>复制光标所在行到第一行的所有数据</td>
</tr>
<tr>
<td>yG</td>
<td>复制光标所在行到最后一行的所有数据</td>
</tr>
<tr>
<td>y0</td>
<td>复制光标所在的那个字符到该行行首的所有数据</td>
</tr>
<tr>
<td>y$</td>
<td>复制光标所在的那个字符到该行行尾的所有数据</td>
</tr>
<tr>
<td>p, P</td>
<td>p 为将已复制的数据在光标下一行贴上，P 则为贴在光标上一行 (常用)</td>
</tr>
<tr>
<td>J</td>
<td>将光标所在行与下一行的数据结合成同一行</td>
</tr>
<tr>
<td>c</td>
<td>重复删除多个数据，例如向下删除 4 行，[ 4cj ]，配合上下左右的按键使用</td>
</tr>
<tr>
<td>u</td>
<td>撤销操作。(常用)</td>
</tr>
<tr>
<td>[Ctrl]+r</td>
<td>重做上一个动作。(常用)</td>
</tr>
</tbody></table>
<p><strong>从命令模式进入输入模式</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>i, I</td>
<td>i&#x3D;从当前光标所在处插入， I &#x3D;在当前所在行的第一个非空处开始插入。 (常用)</td>
</tr>
<tr>
<td>a, A</td>
<td>a &#x3D;从当前光标所在的下一个字符处开始插入， A &#x3D;从光标所在行的最后一个字符处开始插入。(常用)</td>
</tr>
<tr>
<td>o, O</td>
<td>o &#x3D;在当前光标所在的下一行处插入新的一行； O &#x3D;在当前光标所在处的上一行插入新的一行。(常用)</td>
</tr>
<tr>
<td>r, R</td>
<td>r 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 ESC 为止；(常用)</td>
</tr>
<tr>
<td>[Esc]</td>
<td>退出输入模式，回到命令模式中(常用)</td>
</tr>
</tbody></table>
<p><strong>从命令模式进入到末行模式</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>:w</td>
<td>保存(常用)</td>
</tr>
<tr>
<td>:w!</td>
<td>若文件属性为『只读』时，强制保存，是否能保存与权限有关</td>
</tr>
<tr>
<td>:q</td>
<td>不保存退出(常用)</td>
</tr>
<tr>
<td>:q!</td>
<td>强制退出不保存。</td>
</tr>
<tr>
<td>:wq</td>
<td>保存退出， :wq! 则为强制保存退出 (常用)</td>
</tr>
<tr>
<td>ZZ</td>
<td>这是大写的 Z ！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开！</td>
</tr>
<tr>
<td>:w [filename]</td>
<td>将编辑的数据储存成另一个档案（类似另存新档）</td>
</tr>
<tr>
<td>:r [filename]</td>
<td>在编辑的数据中，从指定的文件读取数据并加到光标所在行后面</td>
</tr>
<tr>
<td>:n1,n2 w [filename]</td>
<td>将 n1 到 n2 的内容保存为 filename 这个档案。</td>
</tr>
<tr>
<td>:! command</td>
<td>在系统中执行指定的命令 如 :! ls &#x2F;home</td>
</tr>
<tr>
<td>vim 环境的变更</td>
<td></td>
</tr>
<tr>
<td>:set nu</td>
<td>显示行号</td>
</tr>
<tr>
<td>:set nonu</td>
<td>取消行号</td>
</tr>
</tbody></table>
<h2 id="三、额外功能"><a href="#三、额外功能" class="headerlink" title="三、额外功能"></a>三、额外功能</h2><p><strong>区块选择</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>v</td>
<td>字符选择，选中光标经过的地方</td>
</tr>
<tr>
<td>V</td>
<td>选中光标经过的行</td>
</tr>
<tr>
<td>[Ctrl]+v</td>
<td>区块选择</td>
</tr>
<tr>
<td>y</td>
<td>复制选中的部分</td>
</tr>
<tr>
<td>d</td>
<td>删除选中的部分</td>
</tr>
</tbody></table>
<p><strong>多文件编辑</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>:n</td>
<td>编辑下一个文件</td>
</tr>
<tr>
<td>:N</td>
<td>编辑上一个文件</td>
</tr>
<tr>
<td>:files</td>
<td>列出目前这个 vim 的开启的所有文件</td>
</tr>
</tbody></table>
<p><strong>多窗口编辑</strong></p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>:sp&#x2F;:vsp [filename]</td>
<td>开启一个新窗口，如果加 filename， 表示在新窗口编辑指定的文件，否则表示两个窗口为同一个文件(同步显示)。</td>
</tr>
<tr>
<td>[ctrl]+w+ j [ctrl]+w+↓</td>
<td>按键的按法是：先按下 [ctrl] 不放， 再按下 w 后放开所有的按键，然后再按下 j (或向下箭头键)，则光标可移动到下方的窗口。</td>
</tr>
<tr>
<td>[ctrl]+w+ k [ctrl]+w+↑</td>
<td>同上，不过光标移动到上面的窗口。</td>
</tr>
<tr>
<td>[ctrl]+w+ q</td>
<td>退出光标所在窗口，也可以 [ctrl]+w+j&#x2F;k 切换窗口后，按下 :q 即可离开， 也可以按下 [ctrl]+w+q 。</td>
</tr>
</tbody></table>
<p><strong>环境变量与记录</strong></p>
<p>.viminfo:记录用户的行为，之前编辑过的文件光标在什么位置，在这个文件中进行过什么操作等，自动建立</p>
<p>.vimrc：定义vim的默认设置，如是否显示行号等，需要手动生成</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>:set nu &#x2F;:set nonu</td>
<td>就是设定与取消行号！</td>
</tr>
<tr>
<td>:set hlsearch &#x2F;:set nohlsearch</td>
<td>搜索时是否高亮显示。默认值是 hlsearch</td>
</tr>
<tr>
<td>:set autoindent :set noautoindent</td>
<td>是否自动缩排？autoindent 就是自动缩排。</td>
</tr>
<tr>
<td>:set backup&#x2F;:set nobackup</td>
<td>是否自动备份，一般是 nobackup 的， 如果设定 backup 的话，那么当你更动任何一个档案时，则源文件会被另存成一个档名为 filename~ 的档案。</td>
</tr>
<tr>
<td>:set ruler&#x2F;:set noruler</td>
<td>是否显示右下角的一些状态栏说明</td>
</tr>
<tr>
<td>:set showmode&#x2F;:set noshowmode</td>
<td>是否显示左下角的状态栏。</td>
</tr>
<tr>
<td>:set backspace&#x3D;(012)</td>
<td>一般来说， 如果我们按下 i 进入编辑模式后，可以利用backspace来删除任意字符的。 但是，某些版本则不许如此。这时就可以使用这个设置2 可以删除任意；0 或 1 仅可删除刚刚输入内容</td>
</tr>
<tr>
<td>:set all</td>
<td>显示目前所有的环境变量设定值。</td>
</tr>
<tr>
<td>:set</td>
<td>显示与系统默认值不同的设置， 用户修改过的</td>
</tr>
<tr>
<td>:syntax on :syntax off</td>
<td>是否显示颜色</td>
</tr>
<tr>
<td>:set bg&#x3D;dark :set bg&#x3D;light</td>
<td>可用以显示不同的颜色色调，预设是『 light 』。如果你常常发现批注的字体深蓝色实在很不容易看， 那么这里可以设定为 dark 喔！试看看，会有不同的样式呢！</td>
</tr>
</tbody></table>
<p><strong>密码设置与取消</strong></p>
<p>加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim filename---&gt;:X---&gt;输入密码---&gt;保存（否则不加密）</span><br></pre></td></tr></table></figure>

<p>取消密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim filename---&gt;输入正确密码---&gt;:X---&gt;空密码---&gt;保存</span><br><span class="line">vim filename---&gt;:set key= ---&gt;保存</span><br><span class="line"></span><br><span class="line">注意：不要对系统文件进行加密的操作</span><br></pre></td></tr></table></figure>

<p><strong>vim插件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、虚拟机网卡设置为NAT</span><br><span class="line">2、释放IP并重新获取IP</span><br><span class="line">dhclient -r ensxx</span><br><span class="line">dhclient ensxx</span><br><span class="line">3、安装EPELyum源</span><br><span class="line">dnf install epel-release -y</span><br><span class="line">4、安装vim插件</span><br><span class="line">dnf install vim-airline -y</span><br></pre></td></tr></table></figure>

<p><strong>vimdiff&amp;vimtutor</strong></p>
<p>vimdiff：编辑两个或者更多个文件并显示不同</p>
<p>vimtutor:一条神奇的命令</p>
<h2 id="四、使用中的注意事项"><a href="#四、使用中的注意事项" class="headerlink" title="四、使用中的注意事项"></a>四、使用中的注意事项</h2><p>由于个别版本的linux默认只安装vi，所以你需要额外安装vim的软件包，如何安装软件包我们会在后续的课程中讲解，另外vim在字符界面下不能输入中文，而在图形界面下能否输入中文则取决于系统中是否安装了中文输入法</p>
<p>字符差异</p>
<p>由于linux和windows的系统差异，它们针对于文件的中的一些特殊符号表示方式也是不同的，比如说用来表示换行的符号等，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat -A hello-linux.txt </span><br><span class="line">hello$</span><br><span class="line">$</span><br><span class="line">[root@zutuanxue ~]# cat -A hello-windows.txt </span><br><span class="line">hello^M$</span><br><span class="line">^M$</span><br></pre></td></tr></table></figure>

<p>如果这种文件是从windows拷贝到linux的一本小说的话，基本没什么问题，但是如果是一个我们需要执行指定工作的shell脚本就会出现问题，因为linux不认识这种符号的含义，就会导致shell脚本无法执行。所以此时我们就要对这种文件进行处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# unix2dos [-kn] file [newfile]</span><br><span class="line">选项与参数：</span><br><span class="line">-k  ：保留文件原本的 mtime 时间格式</span><br><span class="line">-n  ：保留旧文件，将转换后的内容输出到新文件，如： dos2unix -n old new</span><br></pre></td></tr></table></figure>

<h1 id="linux用户管理"><a href="#linux用户管理" class="headerlink" title="linux用户管理"></a>linux用户管理</h1><p> 阅读 (371198) </p>
<p> 分享</p>
<h2 id="一、用户和组的相关概念"><a href="#一、用户和组的相关概念" class="headerlink" title="一、用户和组的相关概念"></a>一、用户和组的相关概念</h2><h3 id="账号的概念和分类"><a href="#账号的概念和分类" class="headerlink" title="账号的概念和分类"></a>账号的概念和分类</h3><ul>
<li><strong>账号</strong>：是一种用来记录单个用户或是多个用户的数据。Linux中每一个合法的用户都必须要拥有账号，才能使用 。它不仅可以用来验证用户身份，还决定了一个用户在系统中可以从事什么工作</li>
</ul>
<p>在Linux 上的账号可以分成两类：</p>
<ul>
<li><strong>用户账号</strong> 用来储存单一用户的数据，你可以使用一个用户账号，来储存某一个用户的数据。</li>
<li><strong>群组账号</strong> 用来储存多个用户的信息，每一个群组账号可以用来记录一组用户的数据。</li>
</ul>
<p>我们可以把 Linux 的所有账号依照下面两种方法进行分类：</p>
<ul>
<li>依照账号的位置。</li>
<li>依照账号的功能。</li>
</ul>
<p><strong>依照账号存储的位置</strong></p>
<p>账号数据存放在不同的地方，其可使用的范围就会不太一样，账号的使用范围我们称为视野。依照账号储存的位置与视野不同，我们可以区分本机账号与网域账号两种：</p>
<p><strong>本机账号:</strong> 账号密码储存于本机硬盘中，我们称为本机账号。<br>本机账号使用范围只能在账号建立的 Linux 系统上，如果超出范围时，本机账号将无法使用。比如：你在自己电脑上登录用的账号和密码，正常是无法在其它的电脑上使用的。</p>
<ul>
<li>本机账号的优点：是简单易用，你无须作额外的设置，就可以直接建立本机账号；</li>
<li>本机账号的缺点：则是无法具备延展性（<em>Scalability</em>）。比如：你在一个拥有很多主机的环境中，想拥有一个在每台主机都可以登录的账号时，你就需要在所有的主机上都建立相关的用户</li>
</ul>
<p><strong>网域账号：</strong> 你也可以把大量的计算机组织成为一个网域，然后在网域中的某一台 Linux 上建立账号数据，并且通过某些通信协议，将账号数据分享出来。当其他计算机需要取得账号数据时，再通过网络调用这些分享的账号即可。这种账号我们称为网域账号 （<em>Domain Account</em>）。</p>
<ul>
<li>网域账号的优点：在于具备延展性。在大规模的环境中，使用网域账号往往能节省管理账号的时间；</li>
<li>但网域账号也有缺点，其最大的缺点就是要配置网域账号前，你必须先建立“域”的环境才行。</li>
</ul>
<p><strong>依照账号的功能</strong></p>
<p>不管是本机账号或是网域账号，我们还可以把所有账号依照功能分成下面几类</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602392635606.png" alt="1571285802298.png"></p>
<p><strong>用户账号部分：</strong> 包含了超级用户、普通用户；而普通用户中还可细分为系统用户、真实用户两种。</p>
<ul>
<li><p>超级用户：在Linux 系统上拥有完整的控制能力，常被称为系统管理员，在 系统上拥有完整的控制能力，你可以利用超级用户读取或写入 上任何文件、安装或删除软硬件、启动或停止服务，甚至关机与停止系统的执行。 通常只有在管理系统时才会使用超级用户账号登录，所以超级用户常被称为系统管理员 （<em>System Administrator</em>）。由于超级用户的权限不受任何限制，你可以使用该账号来管理 系统；但是，也可能因为操作错误，或者打错命令而造成无法挽救的伤害。<br>在此，强烈建议你“除非有必要，否则请不要轻易以超级用户身份使用 Linux”！</p>
<p><strong>在 Linux 系统中，默认超级用户的用户为 root，其 UID（用户ID号）一定为 0。</strong></p>
</li>
<li><p>普通用户账号：行为能力会受到限制，只能调用具备权限的文件，如果没有足够的权限，普通用户是完全无法调用的；所以，普通用户账号不太容易危害 Linux 系统。普通用户账号中，我们又可分为两大类：</p>
</li>
<li><p>系统账号<br>这种类型的账号仅提供给Linux 系统本身使用。在某些软件执行的时候，需要你提供一个普通用户类型的账号。为了满足这些软件而建立的账号，我们称为系统账号 （<em>System Account</em>）。</p>
</li>
<li><p>真实用户<br>系统用户账号是给软件或程序使用的，那么，什么账号是让我们登录Linux 时使用的呢？答案就是真实用户（<em>Real User</em>）。真实用户账号是为了让其他人登录系统使用的</p>
</li>
</ul>
<p><strong>群组账号部分：</strong> 包含了超级用户群组、系统群组以及用户自定义组三大类。</p>
<ul>
<li>超级用户群组：Linux 有一个叫做 root 的群组，因为这个群组的名称与 root 这个超级用户的名称相同，所以，我们习惯把 root 群组叫做超级用户群组。超级用户群组的 GID 为 0。</li>
<li>系统群组： 与系统账号一样，系统群组是给 Linux 系统本身，或是某个软件所使用</li>
<li>用户自定义组：除了上述的群组外其余的所有群组，皆是由管理者自行定义，因此我们把这些群组称之为用户自定义组</li>
</ul>
<p>另外，Linux 系统的“用户自定义组“类型中，还有一种名为<strong>用户私有群组</strong> （<em>UPG, User Private Group</em>）的群组。什么是 <strong>用户私有群组</strong>呢？用户私有群组（<em>UPG, User Private Group</em>）是指 “与用户账号名称相同，且为用户的主要群组”的群组。当你建立新的用户账号时，Linux 会自动建立该用户的私有群组。如，当你建立 test 这个用户账号时，Linux 会自动建立了一个名为 test 的群组，并且让 test群组成为 test 用户账号的主要群组，test 群组即是 test 的私有群组。</p>
<p>了解完账号的基本概念后，我们一起来看下账号到底记录了哪些信息</p>
<h2 id="二、用户账号管理"><a href="#二、用户账号管理" class="headerlink" title="二、用户账号管理"></a>二、用户账号管理</h2><ul>
<li><strong>useradd命令</strong><br>用户创建命令，创建一个linux用户。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       useradd - 创建一个新用户或更新默认新用户信息</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       useradd [选项] 登录</span><br><span class="line"></span><br><span class="line">       useradd -D</span><br><span class="line"></span><br><span class="line">       useradd -D [选项]</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">  -D        默认</span><br><span class="line">  ­</span><br><span class="line">  -u UID    用来指定账号的 UID，如果省略这个参数，useradd会自动以最后一个可用的 UID 作为新账号的 UID。</span><br><span class="line"></span><br><span class="line">  -o        告诉 useradd 允许重复的 UID。  </span><br><span class="line"></span><br><span class="line">  -g gid    定义用户的主要群组。使用 -g 参数前，GROUP 必须已经存在。 </span><br><span class="line">     </span><br><span class="line">  -d HOME   指定用户的主目录。默认的主目录是建立在  /home/ 目录下，而且目录名称与用户名称相同。</span><br><span class="line">  </span><br><span class="line">  -s SHELL  指定用户登录执行的程序。</span><br><span class="line">                                      </span><br><span class="line">  -c COMMENT   指定用户的批注说明。如果批注文字包含空白，请记得使用双引号 （&quot;） 包起来。 </span><br><span class="line"> </span><br><span class="line">  -r           这个参数用来指出建立一个系统用户的账号。    </span><br><span class="line">  </span><br><span class="line">  -M           不创建家目录</span><br><span class="line"></span><br><span class="line">  -N           不创建同名组                   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#相关文件</span><br><span class="line">	/etc/passwd</span><br><span class="line">           用户账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/shadow</span><br><span class="line">           安全用户账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/group</span><br><span class="line">           组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/gshadow</span><br><span class="line">           安全组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/default/useradd</span><br><span class="line">           账户创建的默认值。</span><br><span class="line"></span><br><span class="line">       /etc/skel/</span><br><span class="line">           包含默认文件的目录。</span><br><span class="line"></span><br><span class="line">       /etc/subgid</span><br><span class="line">           Per user subordinate group IDs.</span><br><span class="line"></span><br><span class="line">       /etc/subuid</span><br><span class="line">           Per user subordinate user IDs.</span><br><span class="line"></span><br><span class="line">       /etc/login.defs</span><br><span class="line">           Shadow 密码套件配置。</span><br></pre></td></tr></table></figure>

<p>这些参数大多数可以同时使用，可以根据自己的需求指定，例如<br><strong>创建一个linux用户hello</strong><br>– uid为 1500<br>– 附加组为 hello<br>– 家目录为 &#x2F;home&#x2F;hello<br>– 登陆shell为 &#x2F;bin&#x2F;bash<br>– 描述为 “this is a test user”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -u 1500 -G hello -d /home/hello -s /bin/bash -c &quot;this is a test user&quot; hello</span><br></pre></td></tr></table></figure>

<p><strong>关于linux本机用户</strong><br>本机的用户账号数据储存于&#x2F;etc&#x2F;passwd文件中。与其他的配置文件一样，passwd 也是一个文本文件，因此，你可以直接使用文字处理程序，例如 cat 或 less 浏览其中的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;passwd 权限必须是0644，每一行代表一个用户的账号数据，每一行又使用冒号（:）分隔为几个部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USERNAME:PASSWORD:UID:GID:COMMENT:HOMEDIR:SHELL  </span><br><span class="line"></span><br><span class="line">- USERNAME:用户识别名称，也是登录的名称</span><br><span class="line">- PASSWORD：密码位，用于存储用户的密码，为了安全起见，密码放在另一个文件中，这里统一用x</span><br><span class="line">- UID：用户识别号，0表示为管理员，非0为普通用户</span><br><span class="line">- GID：组识别号，用来识别用户组的身份，同样0为管理员组，非0为系统群组或者自定义组</span><br><span class="line">- COMMENT：描述信息</span><br><span class="line">- HOMEDIR：家目录位置</span><br><span class="line">- SHELL：shell类型</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>usermod命令</strong><br>是用来修改用户相关信息的，和useradd使用的参数很多是相同的，用法也是一样的，除此之外usermod命令还有一些额外的参数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       usermod - 修改一个用户账户</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       usermod [选项] 登录</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-l NEWNAME   修改账号的用户名称，NEWNAME 即是新的账号名称。</span><br><span class="line"></span><br><span class="line">-L           锁定账号，一经锁定的账号将无法用来登录系统。</span><br><span class="line"></span><br><span class="line">-U           解除锁定。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>userdel命令</strong><br>删除linux用户</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       userdel - 删除用户账户和相关文件</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       userdel [选项] 登录</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-r          用户主目录中的文件将随用户主目录和用户邮箱一起删除。在其它文件系统中的文件必须手动搜索并删除。</span><br><span class="line"></span><br><span class="line">-f          强制</span><br></pre></td></tr></table></figure>

<p><strong>删除tom用户以及其家目录文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# userdel -r tom</span><br></pre></td></tr></table></figure>

<h2 id="三、用户查询命令"><a href="#三、用户查询命令" class="headerlink" title="三、用户查询命令"></a>三、用户查询命令</h2><ul>
<li><strong>id命令：查询用户uid、gid信息</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# id hello</span><br><span class="line">uid=1500(hello) gid=1500(hello) 组=1500(hello)</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# id -u hello</span><br><span class="line">1500</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>whoami命令：查询当前登录用户</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>w命令:查询linux系统中登陆的所有用户</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# w</span><br><span class="line"> 18:21:43 up  2:01,  1 user,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     pts/0    192.168.1.17    16:16    3.00s  0.08s  0.00s w</span><br></pre></td></tr></table></figure>

<h1 id="linux-组管理"><a href="#linux-组管理" class="headerlink" title="linux 组管理"></a>linux 组管理</h1><p> 阅读 (314733) </p>
<p> 分享</p>
<h2 id="组账号管理"><a href="#组账号管理" class="headerlink" title="组账号管理"></a>组账号管理</h2><p>本机的群组账号数据被储存在 &#x2F;etc&#x2F;group 文件中，权限也必须为0644，与 &#x2F;etc&#x2F;passwd 一样，这也是一个文本文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:</span><br><span class="line">bin:x:1:</span><br><span class="line">daemon:x:2:</span><br></pre></td></tr></table></figure>

<p>这与&#x2F;etc&#x2F;passwd文件的格式类似</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GROUPNAME:PASSWORD:GID:MEMBERS </span><br><span class="line"></span><br><span class="line">- GROUPNAME:组名</span><br><span class="line"></span><br><span class="line">- PASSWORD:组密码，这里也和passwd文件一样是个x</span><br><span class="line"></span><br><span class="line">- GID：群组识别号</span><br><span class="line"></span><br><span class="line">- MEMBERS：组成员</span><br></pre></td></tr></table></figure>

<p>一起来看下组管理的相关命令</p>
<ul>
<li><strong>groupadd</strong> 建立组</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       groupadd - 创建一个新组</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       groupadd [选项] group</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-g GID     指定群组账号的标识符 </span><br><span class="line"></span><br><span class="line">-r         指定添加的群组成为系统群组</span><br><span class="line"></span><br><span class="line">-f         强制执行。  在一般的情况下，groupadd 不允许建立一个与使用过的 GID 相同的群组账号，而使用这个参数时，groupadd 将会建立相同 GID 的 群组账号。</span><br><span class="line"></span><br><span class="line">-o         此选项允许添加一个使用非唯一 GID 的组。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#组相关文件</span><br><span class="line">       /etc/group</span><br><span class="line">           组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/gshadow</span><br><span class="line">           安全组账户信息。</span><br><span class="line"></span><br><span class="line">       /etc/login.defs</span><br><span class="line">           Shadow 密码套件配置。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>groupmod</strong> 修改群组信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">       groupmod - 修改组信息</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">       groupmod [选项] GROUP</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-g GID       修改群组账号的标识符。GID 就是新的标识符。</span><br><span class="line">-n NEWNAME   用来修改群组的名称。NEWNAME 就是新的组名。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>groupdel</strong> 删除群组账号</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">	groupdel - 删除一个组</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">	groupdel [选项] GROUP</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-f   强制</span><br></pre></td></tr></table></figure>

<p><strong>您不能移除现有用户的主组。在移除此组之前，必须先移除此用户。</strong></p>
<p>用户和组的相关命令我们介绍完了，现在来看下密码管理</p>
<h1 id="linux-密码管理"><a href="#linux-密码管理" class="headerlink" title="linux 密码管理"></a>linux 密码管理</h1><p> 阅读 (240105) </p>
<p> 分享</p>
<p>账号犹如一张通行证，有了账号你才能顺利的使用Linux。不过 Linux 怎么确认使用某账号的人，是这个账号的真正拥有者呢？此时Linux 会根据用户的密码，来确认用户的身份。Linux 的用户账号与群组账号都可设置密码。用户账号的密码用来验证用户的身份；而群组账号的密码则是用来确认用户是否为该群组的成员，以及确认是否为该群组的管理者。</p>
<p>在 Linux 中，使用 useradd 新建一个用户账号时，useradd 会锁定用户的密码，如此一来，用户暂时不能使用 。你必须要修改其密码后，新建的用户才能用他的账号登录。要修改用户账号的密码需要使用passwd命令</p>
<ul>
<li>passwd命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">	修改用户密码</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">	passwd [选项] 用户</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-d     删除用户密码，亦即把文件中的密码字段清空。</span><br><span class="line"></span><br><span class="line">-l     这个参数用来锁定账号，账号一经锁定，用户再怎样输入密码，都会被判断为错误。这个参数只能由 root 使用，普通用户无法用来锁定自己的账号。</span><br><span class="line"></span><br><span class="line">-u     解锁用户</span><br></pre></td></tr></table></figure>

<p>除了可以修改用户账号的密码外，你也可以为每一个群组设置一个密码，这个密码称为群组密码（Group Password）。Linux 的用户，可以通过 newgrp 暂时修改其主要群组的身份。执行 newgrp 时，会以指定的群组身份，开启一个登录 Shell，这样就可以获得暂时修改主要群组之功效。此时，如果该群组没有指定密码，那么 Linux 只允许群组的成员可以使用 newgrp修改主要群组的身份；如果群组设置了密码，群组成员仍可以不用密码就可切换主要群组身份，但非群组的成员，则必须要提供正确的密码才行。</p>
<ul>
<li>gpasswd命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">命令介绍</span><br><span class="line">	修改组密码,对群组管理</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-r     用来删除群组的密码。</span><br><span class="line"></span><br><span class="line">-R     锁定 GROUP 的群组密码。</span><br><span class="line"></span><br><span class="line">-A     设置组管理员</span><br><span class="line"></span><br><span class="line">-a     添加组成员到组</span><br><span class="line"></span><br><span class="line">-d     从组中 删除组成员</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令用法</span><br><span class="line">指派群组管理员，如果有多个管理员用“，”分隔，如果想删除群组管理员，保持位置为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">组管理员用法案例</span><br><span class="line">创建组admin</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# groupadd admin</span><br><span class="line"></span><br><span class="line">创建用户 ztxa ztxb ztxc</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# useradd ztxa</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# useradd ztxb</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# useradd ztxc</span><br><span class="line"></span><br><span class="line">设置ztxa为admin组的组管理员</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# gpasswd -A ztxa admin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">切换到ztxa   将ztxb ztxc加入 admin组</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# su - ztxa -c &quot;gpasswd -a ztxb admin&quot;</span><br><span class="line"></span><br><span class="line">正在将用户“ztxb”加入到“admin”组中</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# su - ztxa -c &quot;gpasswd -a ztxc admin&quot;</span><br><span class="line"></span><br><span class="line">正在将用户“ztxc”加入到“admin”组中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">切换到ztxa  从admin组中删除ztxc</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# su - ztxa -c &quot;gpasswd -d ztxc admin&quot;</span><br><span class="line"></span><br><span class="line">正在将用户“ztxc”从“admin”组中删除</span><br></pre></td></tr></table></figure>

<h1 id="linux-shadow文件"><a href="#linux-shadow文件" class="headerlink" title="linux shadow文件"></a>linux shadow文件</h1><p> 阅读 (391132) </p>
<p> 分享</p>
<p>说到用户管理，就不得不提到shadow这个文件，shadow有三个功能：</p>
<ul>
<li>隐藏密码</li>
<li>扩充密码的功能</li>
<li>提供账号管理工具</li>
</ul>
<p><strong>隐藏密码：</strong> 因为&#x2F;etc&#x2F;passwd和&#x2F;etc&#x2F;group文件的权限必须是0644，这意味着所有的用户都能读取到内容，所以为了安全起见，我们通过shaodw把用户和组的密码分别隐藏在&#x2F;etc&#x2F;shadow,&#x2F;etc&#x2F;gshadow文件中，且这两个文件只有管理员，也就是root能调用</p>
<p><strong>提供账号管理工具</strong> ：我们之前所介绍的用户和组管理的相关命令，都是shadow所提供的工具</p>
<p><strong>扩充密码功能</strong>： 这个扩充密码功能就是除了密码之外的额外功能，如，密码的有效期限，设置群组管理员（组长）等，这些都是记录在&#x2F;etc&#x2F;shadow,&#x2F;etc&#x2F;gshadow文件中</p>
<p><strong>&#x2F;etc&#x2F;shadow:</strong> 存储用户密码及密码额外功能的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件内容：</span><br><span class="line">root:$6$T52Xvk7zu84.tDXp$nfXcm6LTfUx.ZviEo7Eq1bPjDO...::0:99999:7:::</span><br><span class="line">bin:*:18027:0:99999:7:::</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;shadow文件的格式与&#x2F;etc&#x2F;passwd类似，也是每一行代表一个账号的数据，使用：进行分隔.</p>
<p><strong>内容详解</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">USERNAME:PASSWORD:LAST_CHANGED:MIN_DAYS:MAX_DAYS:WARNNING:EXPIRES:INVALID:RESERVED</span><br><span class="line"></span><br><span class="line">1、USERNAME：用户账号名称。</span><br><span class="line"></span><br><span class="line">2、PASSWORD：加密后的密码。</span><br><span class="line"></span><br><span class="line">3、LAST_CHANGED：密码最后一次修改的日期。</span><br><span class="line"></span><br><span class="line">4、MIN_DAYS：密码修改的最小间隔天数。</span><br><span class="line"></span><br><span class="line">5、MAX_DAYS：密码修改的最大天数。</span><br><span class="line"></span><br><span class="line">6、WARNNING：密码过期前警告的天数。</span><br><span class="line"></span><br><span class="line">7、EXPIRES：密码过期的日期</span><br><span class="line"></span><br><span class="line">8、INVALID:	账号失效日期</span><br><span class="line"></span><br><span class="line">9、RESERVED：保留位，未定义功能</span><br></pre></td></tr></table></figure>

<p>这里面我们所提到的日期都是从1970年1月1日起经过的天数，所以我们看到的不是日期的格式，而是一组数字，我们接下来看下另一个文件</p>
<p><strong>&#x2F;etc&#x2F;gshadow:</strong> 存储组密码及密码额外功能的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件内容：</span><br><span class="line">root:::</span><br><span class="line">bin:::</span><br><span class="line">daemon:::</span><br></pre></td></tr></table></figure>

<p><strong>内容详解</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GROUPNAME:PASSWORD:ADMINISTRATORS:MEMBERS   </span><br><span class="line"></span><br><span class="line">GROUPNAME:	组名</span><br><span class="line"></span><br><span class="line">PASSWORD：	组密码</span><br><span class="line"></span><br><span class="line">ADMINISTRATORS： 组长</span><br><span class="line"></span><br><span class="line">MEMBERS：	组成员</span><br></pre></td></tr></table></figure>

<p>除此之外用户管理还有一个简单的方法，那就是以root用户身份登录图形界面</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399129291.png" alt="1571302990425.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399151313.png" alt="1571303014802.png"></p>
<p><strong>cockpit</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start cockpit</span><br><span class="line">http://localhost:9090</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399169696.png" alt="image20200331143440902.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399191502.png" alt="image20200331143459395.png"></p>
<p><strong>管理密码的有效期限</strong></p>
<p>Shadow除了会把密码数据隐藏到其他文件、提供许多账号管理工具外，还允许你为账号或密码设置有效期限，以提高Linux 的安全性。目前的 Shadow 可以设置下列两种期限：</p>
<p>密码过期</p>
<p>一旦超过密码过期日期，用户成功的登录Linux 时，会强迫用户设置一个新的密码。设置完毕后，才会开启用户的 Shell 程序。设置密码过期的目的，在于提高 Linux 的安全性。</p>
<p>账号过期</p>
<p>若超过账号过期日期，Linux 会禁止用户登录系统，即使输入正确的密码，也无法登录。当账号过期时，Linux 会提示用户联系管理员修改账号过期日期。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Your account has expired; please contact your system administrator 	</span><br></pre></td></tr></table></figure>

<p>我们可以使用chage命令来查看或调整这些相关的期限</p>
<ul>
<li>chage命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chage -l hello</span><br><span class="line">最近一次密码修改时间					：从不</span><br><span class="line">密码过期时间					：从不</span><br><span class="line">密码失效时间					：从不</span><br><span class="line">帐户过期时间						：从不</span><br><span class="line">两次改变密码之间相距的最小天数		：0</span><br><span class="line">两次改变密码之间相距的最大天数		：99999</span><br><span class="line">在密码过期之前警告的天数	：7</span><br><span class="line"></span><br><span class="line">chage</span><br><span class="line">  -m	设置密码修改的最小天数</span><br><span class="line">  -M	设置密码修改的最大天数</span><br><span class="line">  -d	设置密码最后修改日期</span><br><span class="line">  -I	设置密码过期后，锁定账号的天数</span><br><span class="line">  -E	设置账号过期日期，0=立即过期，-1=永不过期</span><br><span class="line">  -W	设置密码过期前的警告天数</span><br><span class="line">  -l	查看指定用户的相关信息</span><br><span class="line">  -h	帮助</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399247448.png" alt="image20200331164400723.png"></p>
<h1 id="linux基本权限"><a href="#linux基本权限" class="headerlink" title="linux基本权限"></a>linux基本权限</h1><p> 阅读 (241192) </p>
<p> 分享</p>
<p>Linux系统是一个典型的多用户操作系统，不同的用户处于不同的地位，为了保护系统的安全性，linux系统对于不同用户访问同一个文件或目录做了不同的访问控制。而这种控制就是通过权限实现的，本节课我们介绍linux权限的使用</p>
<h2 id="一、基本权限的介绍"><a href="#一、基本权限的介绍" class="headerlink" title="一、基本权限的介绍"></a>一、基本权限的介绍</h2><p>Linux中每个文件或目录都有3个基本权限位，控制三种访问级别用户的读、写、执行，所以linux的基本权限位一共有9个。基本权限位和另外3个可以影响可执行程序运行的3个特殊权限位一起构成了文件访问模式。三个属性规定了对应三种级别的用户能够如何使用这个文件，这三个基本权限位对于文件和目录的含义有所差别的，我们一起来看一下</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>权限</th>
<th>对文件的含义</th>
<th>对目录的含义</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>读</td>
<td>意味着我们可以查看阅读</td>
<td>可以列出目录中的文件列表</td>
</tr>
<tr>
<td>w</td>
<td>写</td>
<td>意味着，对文件可以修改或删除</td>
<td>可以在该目录中创建、删除文件</td>
</tr>
<tr>
<td>x</td>
<td>执行</td>
<td>如果是文件就可以运行，比如二进制文件或脚本。</td>
<td>可以使用cd命令进入该目录</td>
</tr>
</tbody></table>
<p>那三种访问级别都有哪些呢？每个文件都有三组不同的读、写和执行权限，分别适用于三种访问级别，其中每组中的三个栏位分别使用读取权限（r）、写入权限（w）、执行权限（x）或没有相应的权限（-）来表示，共9位来表示。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399589987.png" alt="1571370358704.png"></p>
<ul>
<li>第一组：适用于文件的属主，图中属主的权限是rwx。</li>
<li>第二组：适用于文件的属组，图中属组的权限是r-x。</li>
<li>第三组：使用于其它用户权限位，图中其它用户权限位是r-x。</li>
</ul>
<p>当有人试图访问一个文件的时候，linux系统会按顺序执行如下步骤：</p>
<p>（1）使用者拥有这个文件吗？如果是，启用用户权限。</p>
<p>（2）用户是组所有者成员吗？如果是，启用组权限</p>
<p>（3）如果以上两个都不是，启用其它人权限</p>
<p>上面我们提到的是第一种表示方法，在linux中还有另外一种表示方法，八进制表示法，我们来看下字母和八进制表示方法的对应关系</p>
<table>
<thead>
<tr>
<th>字符表示法</th>
<th>八进制表示法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>4</td>
<td>读</td>
</tr>
<tr>
<td>w</td>
<td>2</td>
<td>写</td>
</tr>
<tr>
<td>x</td>
<td>1</td>
<td>执行</td>
</tr>
</tbody></table>
<p>所以上面给出的权限rwxr-xr-x换成数字的表示方式就是755，那权限如何设置呢？</p>
<h2 id="二、基本权限的设置和查看"><a href="#二、基本权限的设置和查看" class="headerlink" title="二、基本权限的设置和查看"></a>二、基本权限的设置和查看</h2><p>通过前面的学习我们知道，用户分为所有者，所有者组，其他人这三类，而每一类有包含三种基本权限，他们的对应关系是</p>
<table>
<thead>
<tr>
<th>权限位</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>属主权限位</td>
<td>用于限制文件或目录的创建者</td>
</tr>
<tr>
<td>属组权限位</td>
<td>用于限制文件或目录所属组的成员</td>
</tr>
<tr>
<td>其它用户的权限</td>
<td>用于限制既不是属主又不是所属组的能访问该文件或目录的其他人员</td>
</tr>
</tbody></table>
<p>当我们使用命令来查看文件或目录时，会看如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ls -l</span><br><span class="line">总用量 13804</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 公共</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 模板</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 视频</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 图片</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 文档</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 下载</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 音乐</span><br><span class="line">drwxr-xr-x.  2 root root        6 10月 11 06:36 桌面</span><br><span class="line">-rw-------.  1 root root     1214 10月 11 06:12 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--.  1 root root     1369 10月 11 06:17 initial-setup-ks.cfg</span><br></pre></td></tr></table></figure>

<p>每一行显示一个文件或目录的信息，这些信息包括文件的类型（1位）、文件的权限(9位)、文件的连接数、文件的属主（第3列）、文件的所属组（第4列），大小以及相关时间和文件名。其中Linux 文件的权限标志位九个，分为3 组，分别代表文件拥有者的权限，文件所属用户组的权限和其它用户的权限，现在我们知道文件有三种权限（（r）读取、（w）写入和（x）执行）和三种访问级别（（u）用户、（g）主要组和（o）其它人）决定文件可以被如何使用。那如何修改？</p>
<ul>
<li><strong>chmod命令:修改文件权限</strong></li>
</ul>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602399812604.png" alt="1571375694210.png"></p>
<table>
<thead>
<tr>
<th>缩写</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>u</td>
<td>User(用户)</td>
</tr>
<tr>
<td>g</td>
<td>Group (组)</td>
</tr>
<tr>
<td>o</td>
<td>Other(其它)</td>
</tr>
<tr>
<td>a</td>
<td>All(所有)</td>
</tr>
<tr>
<td>+</td>
<td>Add(加)</td>
</tr>
<tr>
<td>-</td>
<td>Remove(减去)</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>Set (设置)</td>
</tr>
<tr>
<td>r</td>
<td>Read (可读)</td>
</tr>
<tr>
<td>w</td>
<td>Write (可写)</td>
</tr>
<tr>
<td>x</td>
<td>Execute (执行)</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th>结果权限</th>
</tr>
</thead>
<tbody><tr>
<td>chmod o-r a.file</td>
<td>取消其他人的可读权限</td>
<td>rw-rw—</td>
</tr>
<tr>
<td>chmod g-w a.file</td>
<td>取消组的写入权限</td>
<td>rw-r–r–</td>
</tr>
<tr>
<td>chmod ug+w a.file</td>
<td>赋予用户和组写入权限</td>
<td>rwxrwxr–</td>
</tr>
<tr>
<td>chmod o+w a.file</td>
<td>赋予其他人写入权限</td>
<td>rw-rw-rw-</td>
</tr>
<tr>
<td>chmod go-rwx a.file</td>
<td>取消组和其他人的阅读、写入和执行权限</td>
<td>rw——-</td>
</tr>
<tr>
<td>chmod a-w a.file</td>
<td>取消所有人的写入权限</td>
<td>r– r– r–</td>
</tr>
<tr>
<td>chmod uo-r a.file</td>
<td>取消用户和其它人的阅读权限</td>
<td>-w-rw–w-</td>
</tr>
<tr>
<td>chmod go&#x3D;rw a.file</td>
<td>将组和其他人的权限设置为阅读和写入</td>
<td>rw-rw-rw-</td>
</tr>
</tbody></table>
<p>使用数字的表示方式类似chmod 755 a,执行完成后a这个文件的权限对应就是 -rwxr-xr-x,这是文件权限的两种修改方式，如果你想修改文件的所有者和所有者组需要使用的命令就是chown,chgrp</p>
<ul>
<li><strong>chown命令:改变文件或文件夹的所有者</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r-- 1 root root 0 10月 18 01:26 file1</span><br><span class="line">[root@zutuanxue test]# chown oracle file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r-- 1 oracle root 0 10月 18 01:26 file1</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>chgrp命令: 改变文件或文件夹属组</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# chgrp oracle file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r-- 1 oracle oracle 0 10月 18 01:26 file1</span><br></pre></td></tr></table></figure>

<p>这里，我们涉及到了三条与权限修改相关的命令</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>可以执行的用户</th>
</tr>
</thead>
<tbody><tr>
<td>chmod</td>
<td>Root用户和文件的所有者</td>
</tr>
<tr>
<td>chgrp</td>
<td>Root用户和文件的所有者（必须是组成员）</td>
</tr>
<tr>
<td>chown</td>
<td>只有root用户</td>
</tr>
</tbody></table>
<p>以上是三种基本权限 -R</p>
<h2 id="三、文件或目录的默认权限"><a href="#三、文件或目录的默认权限" class="headerlink" title="三、文件或目录的默认权限"></a>三、文件或目录的默认权限</h2><p>每一个新产生的文件都会有一个默认的权限，这个权限是通过系统中的umask来控制的</p>
<p>文件的最大权限是666</p>
<p>目录的权限是777</p>
<p>使用umask查看</p>
<h1 id="linux-特殊权限"><a href="#linux-特殊权限" class="headerlink" title="linux 特殊权限"></a>linux 特殊权限</h1><p> 阅读 (290829) </p>
<p> 分享</p>
<p>linux基本权限只是规定了所有者、属组、其他人三种用户的权限，如果希望对文件或文件夹做一些特殊的权限设置呢？<br>比如：</p>
<ul>
<li>设置属组继承权限</li>
<li>为执行文件设置临时超管执行权限</li>
<li>公共文件夹中的文件谁建立谁删除<br>这些任务基本权限就解决不聊了，需要解决这个问题得靠特殊权限。</li>
</ul>
<h2 id="一、特殊权限的介绍"><a href="#一、特殊权限的介绍" class="headerlink" title="一、特殊权限的介绍"></a>一、特殊权限的介绍</h2><p>之前我们提到了特殊权限有三个，这三个特殊权限是在可执行程序运行时影响操作权限的，它们分别是SUID,SGID,sticky-bit位</p>
<table>
<thead>
<tr>
<th>特殊权限</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>SUID</td>
<td>当一个设置了SUID 位的可执行文件被执行时，该文件将以所有者的身份运行，也就是说无论谁来执行这个文件，他都有文件所有者的特权。任意存取该文件拥有者能使用的全部系统资源。如果所有者是 root 的话，那么执行人就有超级用户的特权了。</td>
</tr>
<tr>
<td>SGID</td>
<td>当一个设置了SGID 位的可执行文件运行时，该文件将具有所属组的特权，任意存取整个组所能使用的系统资源；若一个目录设置了SGID，则所有被复制到这个目录下的文件，其所属的组都会被重设为和这个目录一样，除非在复制文件时保留文件属性，才能保留原来所属的群组设置。</td>
</tr>
<tr>
<td>stickybit</td>
<td>对一个文件设置了sticky-bit之后，尽管其他用户有写权限，也必须由属主执行删除、移动等操作；对一个目录设置了sticky-bit之后，存放在该目录的文件仅准许其属主执行删除、移动等操作。</td>
</tr>
</tbody></table>
<p>一个典型的例子就是passwd命令，这个命令允许用户修改自己的密码。我们可以看到本来是rwx的权限表示形式变成了rws，同样如果&#x2F;usr&#x2F;bin&#x2F;passwd这个文件同时被设置了三个特殊权限，那么权限的格式就会变成rwsrwsrwt,需要注意的是特殊权限设置的前置要求是可执行，也就是如果没有x权限位，是不要设置的，即便你使用root用户设置上了特殊权限，也不会生效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# ll /usr/bin/passwd </span><br><span class="line">-rwsr-xr-x. 1 root root 34928 5月  11 11:14 /usr/bin/passwd</span><br></pre></td></tr></table></figure>

<h2 id="二、特殊权限的设置和查看"><a href="#二、特殊权限的设置和查看" class="headerlink" title="二、特殊权限的设置和查看"></a>二、特殊权限的设置和查看</h2><p><strong>特殊权限的设置也是使用chmod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwxr-xr-x 1 oracle oracle 0 10月 18 01:26 file1</span><br><span class="line">[root@zutuanxue test]# chmod u+s file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwsr-xr-x 1 oracle oracle 0 10月 18 01:26 file1</span><br><span class="line">[root@zutuanxue test]# chmod g+s file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwsr-sr-x 1 oracle oracle 0 10月 18 01:26 file1</span><br><span class="line">[root@zutuanxue test]# chmod o+t file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwsr-sr-t 1 oracle oracle 0 10月 18 01:26 file1</span><br></pre></td></tr></table></figure>

<p>或者使用数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# chmod u-s,g-s,o-t file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwxr-xr-x 1 oracle oracle 0 10月 18 01:26 file1</span><br><span class="line">[root@zutuanxue test]# chmod 7755 file1</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwsr-sr-t 1 oracle oracle 0 10月 18 01:26 file1</span><br></pre></td></tr></table></figure>

<h1 id="linux-隐藏权限"><a href="#linux-隐藏权限" class="headerlink" title="linux 隐藏权限"></a>linux 隐藏权限</h1><p> 阅读 (200381) </p>
<p> 分享</p>
<h2 id="隐藏权限的介绍"><a href="#隐藏权限的介绍" class="headerlink" title="隐藏权限的介绍"></a>隐藏权限的介绍</h2><p>有时候你发现即时使用的是root用户也不能修改某个文件，大部分原因是因为使用过chattr命令锁定了该文件，这个命令的作用很大，通过chattr可以提高系统的安全性，但是这个命令并不适合所有的目录，如&#x2F;dev,&#x2F;tmp,&#x2F;var。与我们前面看到的chmod这些命令修改权限不同的是chattr修改的是更底层的属性，这里面我们所提到的隐藏权限指的就是使用chattr来设置属性</p>
<h2 id="隐藏权限的设置和查看"><a href="#隐藏权限的设置和查看" class="headerlink" title="隐藏权限的设置和查看"></a>隐藏权限的设置和查看</h2><p>chattr的用户与我们之前讲的chmod，chow这些命令相似，都是直接对需要修改的文件进行操作就可以了</p>
<ul>
<li><strong>chattr命令：为文件设置隐藏权限</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">命令选项</span><br><span class="line">+ 增加权限</span><br><span class="line">- 删除权限</span><br><span class="line">= 赋予什么权限，文件最终权限</span><br><span class="line">A 文件或目录的atime不可被修改</span><br><span class="line">S 硬盘I/O同步选项，功能类似sync。</span><br><span class="line">a 只能向文件中添加数据，而不能删除，多用于服务器日志文件安全，只有root才能设定这个属性。</span><br><span class="line">d 文件不能成为dump程序的备份目标。</span><br><span class="line">i 设定文件不能被删除、改名、设定链接关系，同时不能写入或新增内容。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>lsattr命令: 查看文件隐藏权限</strong></li>
</ul>
<p>通过案例学习命令用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">给file1文件添加AaiSd权限</span><br><span class="line">[root@zutuanxue test]# chattr +AaiSd file1</span><br><span class="line"></span><br><span class="line">查看文件file1隐藏权限</span><br><span class="line">[root@zutuanxue test]# lsattr file1 </span><br><span class="line">--S-iadA---------- file1</span><br><span class="line"></span><br><span class="line">设置删除file1文件隐藏权限</span><br><span class="line">- 可以使用-号  </span><br><span class="line">- 可以使用=为空设置</span><br><span class="line">[root@zutuanxue test]# chattr = file1</span><br><span class="line">[root@zutuanxue test]# lsattr file1 </span><br><span class="line">------------------ file1</span><br></pre></td></tr></table></figure>

<p>通过上面的例子可以看到查看的时候使用的是lsattr，chattr还有很多参数，各位可以在man手册中获取到帮助，另外有些参数的使用是有局限性的。</p>
<h1 id="linux-acl权限"><a href="#linux-acl权限" class="headerlink" title="linux acl权限"></a>linux acl权限</h1><p> 阅读 (341916) </p>
<p> 分享</p>
<p>linux的权限非常重要，我们之前所说的几种权限中，但是并不能只针对一个用户或者一个组进行单独设置，而ACL权限可以帮助我们实现这个功能，比如说有一个文件的所有者和所有者组都是a，这个文件的权限是660，我可以让b这个用户可以对文件进行读写的操作，而b这个用户并不属于a组的成员。那我们来看下如何使用</p>
<h2 id="ACL权限的设置和查看"><a href="#ACL权限的设置和查看" class="headerlink" title="ACL权限的设置和查看"></a>ACL权限的设置和查看</h2><p>如果要使用acl权限，首先要确定你的文件系统支持acl权限,如果再Default mount options字段出现acl字样就意味着你的文件系统支持acl，不过在CentOS8中默认是都支持的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# tune2fs -l /dev/sda1</span><br><span class="line">tune2fs 1.44.3 (10-July-2018)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          /boot</span><br><span class="line">Filesystem UUID:          be03eaec-6474-42ea-8f79-06e7198f5155</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision #:    1 (dynamic)</span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></table></figure>

<p>配置acl权限我们需要使用两个命令一个是setfacl用来设置acl权限，另一个是getfacl用来查看acl权限</p>
<ul>
<li><strong>setfacl命令：设置文件或文件夹的ACL权限</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令选项：</span><br><span class="line">-m ：设置acl</span><br><span class="line">-x ：删除指定的acl</span><br><span class="line">-b ：删除所有的acl</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>getfacl命令：用来查看文件的acl权限</strong><br>现在我们来看下如何设置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">file  file1</span><br><span class="line">[root@zutuanxue test]# ll file1</span><br><span class="line">-rw-r--r-- 1 root root 0 10月 18 02:48 file1</span><br><span class="line">[root@zutuanxue test]# setfacl -m u:oracle:rw file1	为指定的用户配置一个rw的权限</span><br><span class="line">[root@zutuanxue test]# setfacl -m u::rwx file1		如果没有指定用户则默认是为该文件的所有者设置</span><br><span class="line">[root@zutuanxue test]# ll file1</span><br><span class="line">-rwxrw-r--+ 1 root root 0 10月 18 02:48 file1	所有者权限变成的rwx而且后面多了一个+号</span><br></pre></td></tr></table></figure>

<p>你会发现使用ll（等同于ls -l）命令查看时会发现多了一个+号，这只是提醒我们此文件被设置了acl权限，但是具体是什么样的，我们还需要使用getfacl来查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1			文件名</span><br><span class="line"># owner: root			所有者</span><br><span class="line"># group: root			所有者组</span><br><span class="line">user::rwx				user：后面是空的，代表的是所有者的权限</span><br><span class="line">user:oracle:rw-			我们之前给额外用户设置的权限</span><br><span class="line">group::r--				所有者组的权限</span><br><span class="line">mask::rw-				默认的有效权限</span><br><span class="line">other::r--				其他人的权限</span><br></pre></td></tr></table></figure>

<p>以上是我们针对一个额外的用户设置的权限，同理可以设置针对组和其他人的acl权限</p>
<p><strong>为不同用户或组设置不同权限</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# setfacl -m g:oracle:rw file1</span><br><span class="line">[root@zutuanxue test]# setfacl -m o:rw file1</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rwx</span><br><span class="line">user:oracle:rw-</span><br><span class="line">group::r--</span><br><span class="line">group:oracle:rw-</span><br><span class="line">mask::rw-</span><br><span class="line">other::rw-</span><br></pre></td></tr></table></figure>

<p><strong>删除指定的acl</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# setfacl -x u:oracle file1		删除用户acl</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rwx</span><br><span class="line">group::r--</span><br><span class="line">group:oracle:rw-</span><br><span class="line">mask::rw-</span><br><span class="line">other::rw-</span><br><span class="line">[root@zutuanxue test]# setfacl -x g:oracle file1		删除组acl</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rwx</span><br><span class="line">group::r--</span><br><span class="line">mask::r--</span><br><span class="line">other::rw-</span><br><span class="line">[root@zutuanxue test]# chmod o=r file1				删除其他人直接使用chmod就可以</span><br><span class="line">[root@zutuanxue test]# ll file1</span><br><span class="line">-rw-r--r-- 1 root root 0 10月 18 04:21 file1</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">group::r--</span><br><span class="line">other::r--</span><br></pre></td></tr></table></figure>

<p><strong>删除所有acl</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# setfacl -m u:oracle:rw,g:oracle:rw,o:rwx file1</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">user:oracle:rw-</span><br><span class="line">group::r--</span><br><span class="line">group:oracle:rw-</span><br><span class="line">mask::rw-</span><br><span class="line">other::rwx</span><br><span class="line"></span><br><span class="line">[root@zutuanxue test]# setfacl -b file1</span><br><span class="line">[root@zutuanxue test]# getfacl file1</span><br><span class="line"># file: file1</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">group::r--</span><br><span class="line">other::rwx</span><br></pre></td></tr></table></figure>

<p>你没看错，权限在指定的时候是可以指定多个的，我们之前提到的chmod也可以这样使用，好了权限管理我们就说这么多</p>
<h1 id="linux文件压缩与解压"><a href="#linux文件压缩与解压" class="headerlink" title="linux文件压缩与解压"></a>linux文件压缩与解压</h1><p> 阅读 (452217) </p>
<p> 分享</p>
<h2 id="压缩工具的介绍"><a href="#压缩工具的介绍" class="headerlink" title="压缩工具的介绍"></a>压缩工具的介绍</h2><p>说到文件管理，就不得不说到tar，因为tar可以压缩和解压缩linux文件，所以要先了解一下压缩和解压缩。</p>
<p>由于以前的计算机磁盘容量比较小，业内人士绞尽脑汁，终于开发出了一个能帮助用户节省磁盘的工具，就是压缩工具，我们知道计算机在存储数据的时候都是使用bytes来计算的，但是实际上1byte&#x3D;8bits，在日常使用中并不是所有的数据都能把这个1byte用完，有的可能用了三个bits，有的可能用了四个bits，而他们的实际占用空间是2bytes&#x3D;16bits，剩余的空间就浪费了，压缩工具就是通过算法，将占用三个bits的数据和占用四个bits的数据放在一个byte里，这样我们就能节省出来1byte，这种空间的节省，当你在压缩一个包含了很多文本文件的目录时是非常明显的。其实就像没有人知道早高峰的公交车里有多少人一样，一个人理论上占用的公交车内的空间，跟实际占用的空间，往往有很大差别，因为挤挤总能上去的。</p>
<p>压缩工具诞生的初衷和原理我们说完了，那现在它就没用了么？依然有用，只不过现在我们使用压缩工具的目的，更多的是便于存储和传输，在linux系统中压缩工具有很多，不同的工具压缩后的后缀名和大小都有差异，从远古时代说起，linux都出现了以下这些格式的压缩文件</p>
<p>*.Z 使用compress压缩的文件</p>
<p>*.zip 使用zip压缩的文件</p>
<p>*.gz 使用gzip压缩</p>
<p>*.bz2 使用bzip2压缩</p>
<p>*.xz 使用xz压缩</p>
<p>*.tar 使用tar工具打包，没有压缩</p>
<p>*.tar.gz 使用tar工具打包，经过gzip压缩</p>
<p>*.tar.bz2 使用tar工具打包，经过bzip2压缩</p>
<p>*.tar.xz 使用tar工具打包，经过xz压缩</p>
<p>其中，compress已经过时了，因为太老，个别版本的linux已经不支持了，linux下的压缩工具还是以gzip和bzip2以及后加入的xz作为主力，但是由于这些工具，最早不能压缩目录，只能针对单一文件进行压缩，所以在日常使用中，他们都是配合着tar这个打包工具，由tar把目录中的很多文件打包成一个文件，再经由对应的工具进行压缩，所以我们会看上面的那些tar.*的压缩包。好了我们先来学习下这些压缩工具如何使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">压缩文件的好处有如下几点：</span><br><span class="line"></span><br><span class="line">- 文件更小，便于网络传输，效率高；</span><br><span class="line">- 避免杂乱，可以减少文件个数，多个文件一起压缩；</span><br><span class="line">- 有些文件不能直接传输，比如安装程序，压缩后就可以传输了</span><br></pre></td></tr></table></figure>

<h3 id="压缩工具的使用"><a href="#压缩工具的使用" class="headerlink" title="压缩工具的使用"></a>压缩工具的使用</h3><ul>
<li>gzip</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# gzip -h</span><br><span class="line">Usage: gzip [OPTION]... [FILE]...</span><br><span class="line">  -c	保留源文件	</span><br><span class="line">  -d	解压缩</span><br><span class="line">  -h	显示帮助</span><br><span class="line">  -t	检查压缩文件的数据一致性，用来确定压缩文件是否有错误</span><br><span class="line">  -v	显示压缩包的相关信息，包括压缩比等</span><br><span class="line">  -V	显示版本号</span><br><span class="line">  -1	压缩最快，压缩比低</span><br><span class="line">  -9	压缩最慢，压缩比高</span><br><span class="line">例子：</span><br><span class="line">[root@zutuanxue test]# pwd</span><br><span class="line">/root/test</span><br><span class="line">[root@zutuanxue test]# cp /etc/services ./</span><br><span class="line">[root@zutuanxue test]# gzip -v services </span><br><span class="line">services:	 79.4% -- replaced with services.gz</span><br><span class="line">[root@zutuanxue test]# ll /etc/services services.gz </span><br><span class="line">-rw-r--r--. 1 root root 692241 Sep 10  2018 /etc/services</span><br><span class="line">-rw-r--r--  1 root root 142549 Oct 20 23:32 services.gz</span><br><span class="line">[root@zutuanxue test]# zcat services.gz </span><br><span class="line">由于service文件本来就是一个文本文档，所以还可以使用zmore，zless去查看内容</span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">services.gz</span><br><span class="line">[root@zutuanxue test]# gzip -d services.gz </span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">services</span><br><span class="line">我们可以看到，gzip这个工具压缩文件和源文件默认只保留一个，所以还可以</span><br><span class="line">[root@zutuanxue test]# gzip -1 -c services &gt; test.gz</span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">services  test.gz</span><br><span class="line">[root@zutuanxue test]# zgrep -n ssh test.gz </span><br><span class="line">44:ssh             22/tcp                          # The Secure Shell (SSH) Protocol</span><br><span class="line">45:ssh             22/udp                          # The Secure Shell (SSH) Protocol</span><br><span class="line">你也可以使用zgrep找出指定的关键字在压缩文件的那几行</span><br></pre></td></tr></table></figure>

<ul>
<li>bzip2</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# bzip2 -h</span><br><span class="line">   -h		帮助</span><br><span class="line">   -d		解压</span><br><span class="line">   -z 		压缩 默认值</span><br><span class="line">   -k		保留源文件</span><br><span class="line">   -v		查看版本信息</span><br><span class="line">   -1 ..-9   同gzip相同</span><br><span class="line">   bzip2的使用与gzip相同，两种工具的区别就是压缩算法不同，bzip2的压缩比更好一些，bzip的包查看的时候使用的是bzcat,bzmore,bzless,bzgrep同gzip用法相同</span><br><span class="line">[root@zutuanxue test]# gzip -c services &gt; services.gz</span><br><span class="line">[root@zutuanxue test]# bzip2 -k services</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 948</span><br><span class="line">-rw-r--r-- 1 root root 692241 10月 21 01:31 services</span><br><span class="line">-rw-r--r-- 1 root root 129788 10月 21 01:31 services.bz2</span><br><span class="line">-rw-r--r-- 1 root root 142549 10月 21 01:32 services.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>xz<br>虽然bzip2的压缩效果相对比gzip已经提升很多，但是技术是永无止境的，于是出现了xz，它的用法跟gzip和bzip2一样</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# xz -h</span><br><span class="line">  -d				解压缩</span><br><span class="line">  -t				检查压缩文件的完整性</span><br><span class="line">  -l				查看压缩文件的相关信息</span><br><span class="line">  -k				保留源文件</span><br><span class="line">  -c				将信息输出到显示器上</span><br><span class="line">  -0 ... -9			指定压缩级别</span><br><span class="line">  -h				显示帮助</span><br><span class="line">[root@zutuanxue test]# xz -k services</span><br><span class="line">[root@zutuanxue test]# ll</span><br><span class="line">总用量 1052</span><br><span class="line">-rw-r--r-- 1 root root 692241 10月 21 01:31 services</span><br><span class="line">-rw-r--r-- 1 root root 129788 10月 21 01:31 services.bz2</span><br><span class="line">-rw-r--r-- 1 root root 142549 10月 21 01:32 services.gz</span><br><span class="line">-rw-r--r-- 1 root root 105872 10月 21 01:31 services.xz</span><br><span class="line">可以看到，在使用默认压缩比压缩的情况下，xz压缩完的文件体积更小</span><br><span class="line">[root@zutuanxue test]# xz -l services.xz		查看相关信息</span><br><span class="line">Strms  Blocks   Compressed Uncompressed  Ratio  Check   Filename</span><br><span class="line">    1       1    103.4 KiB    676.0 KiB  0.153  CRC64   services.xz</span><br><span class="line">[root@zutuanxue test]# xzcat services.xz		查看文件内容</span><br><span class="line">[root@zutuanxue test]# xz -d services.xz		解压缩</span><br><span class="line"></span><br><span class="line">虽然xz的压缩算法更好，但是相对来说时间也比较长</span><br><span class="line">[root@zutuanxue test]# time gzip -c services &gt; services.gz</span><br><span class="line">real	0m0.023s</span><br><span class="line">user	0m0.020s</span><br><span class="line">sys	0m0.003s</span><br><span class="line">[root@zutuanxue test]# time bzip2 -k services</span><br><span class="line">real	0m0.047s</span><br><span class="line">user	0m0.043s</span><br><span class="line">sys	0m0.003s</span><br><span class="line">[root@zutuanxue test]# time xz -k services</span><br><span class="line">real	0m0.264s</span><br><span class="line">user	0m0.258s</span><br><span class="line">sys	0m0.003s</span><br><span class="line">我们可以使用time这个命令去对比一下时间gzip，bzip2，xz的时间分别是0.023,0.047,0.264，可以看到xz所使用的时间是比较长的，而这个时间会跟文件体积成正比，所以这三种压缩方式大家在使用的时候也要把时间成本考虑在内，除非你很富有。</span><br></pre></td></tr></table></figure>

<ul>
<li>tar<br>前面我们提到了，大多数压缩工具只能针对单一文件进行操作，如果你要压缩目录的话就会很麻烦，这时候我们可以使用tar这个打包工具，将目录内的多个文件打包成一个文件，再进行压缩。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue test]# tar --help</span><br><span class="line">用法: tar [选项...] [FILE]...</span><br><span class="line">  -C		解压到指定目录</span><br><span class="line">  -c		建立tar包</span><br><span class="line">  -t		查看tar包内的文件</span><br><span class="line">  -x		解压tar包</span><br><span class="line">  -p		不修改文件属性</span><br><span class="line">  -f		指定文件名称</span><br><span class="line">  -j		使用bzip2算法</span><br><span class="line">  -J		使用xz算法</span><br><span class="line">  -z		使用gzip算法</span><br><span class="line">  -P		允许压缩路径中包含有&quot;/&quot;</span><br><span class="line">  -v		显示详细信息</span><br><span class="line">  -?, --help 查看帮助</span><br><span class="line">  --exclude	压缩过程中排除指定的文件</span><br><span class="line">例：</span><br><span class="line">压缩</span><br><span class="line">[root@zutuanxue test]# tar -czf etc.tar.gz etc</span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">etc  etc.tar.gz</span><br><span class="line">解压缩</span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">etc.tar.gz</span><br><span class="line">[root@zutuanxue test]# tar -xf etc.tar.gz </span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">etc  etc.tar.gz</span><br><span class="line">查看压缩包内容</span><br><span class="line">[root@zutuanxue test]# tar -tf etc.tar.gz</span><br><span class="line">etc/</span><br><span class="line">etc/libreport/</span><br><span class="line">etc/libreport/workflows.d/</span><br><span class="line">etc/libreport/workflows.d/report_uploader.conf</span><br><span class="line">etc/libreport/workflows.d/anaconda_event.conf</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">查询压缩包里面的文件信息</span><br><span class="line">[root@zutuanxue test]# tar -tvf etc.tar.gz |more</span><br><span class="line">drwxr-xr-x root/root         0 2019-10-21 04:35 etc/</span><br><span class="line">drwxr-xr-x root/root         0 2019-10-21 04:35 etc/libreport/</span><br><span class="line">drwxr-xr-x root/root         0 2019-10-21 04:35 etc/libreport/workflows.d/</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">解压压缩包指定的文件</span><br><span class="line">[root@zutuanxue test]# tar -tvf etc.tar.gz | grep shadow</span><br><span class="line">---------- root/root       792 2019-10-21 04:35 etc/gshadow</span><br><span class="line">---------- root/root      1506 2019-10-21 04:35 etc/shadow</span><br><span class="line">---------- root/root       781 2019-10-21 04:35 etc/gshadow-</span><br><span class="line">---------- root/root      1374 2019-10-21 04:35 etc/shadow-</span><br><span class="line">-rw-r--r-- root/root       214 2019-10-21 04:35 etc/pam.d/sssd-shadowutils</span><br><span class="line">[root@zutuanxue test]# tar -xf etc.tar.gz etc/shadow</span><br><span class="line">[root@zutuanxue test]# ls</span><br><span class="line">etc  etc.tar.gz</span><br><span class="line">[root@zutuanxue test]# ls etc</span><br><span class="line">shadow</span><br></pre></td></tr></table></figure>

<p>linux下文件与文件夹的压缩与解压的基本使用我们就介绍到这里，那么你学会linux下对文件或文件夹压缩和解压缩了吗！</p>
<h1 id="linux软件包管理"><a href="#linux软件包管理" class="headerlink" title="linux软件包管理"></a>linux软件包管理</h1><p> 阅读 (461969) </p>
<p> 分享</p>
<p>在linux系统中我们经常涉及到软件包的删除和添加，那一起来看下在linux系统中软件包的管理方式都有哪些</p>
<ul>
<li>rpm软件</li>
<li>yum软件仓库</li>
<li>源码软件</li>
</ul>
<h2 id="一、rpm软件包"><a href="#一、rpm软件包" class="headerlink" title="一、rpm软件包"></a>一、rpm软件包</h2><h3 id="rpm的介绍"><a href="#rpm的介绍" class="headerlink" title="rpm的介绍"></a>rpm的介绍</h3><p>前面的课程我们提到过源码包安装需要解决系统环境、权限等等，这些对于初学者而言都是噩梦一般的存在，所以linux厂商推出了一种类似windows系统中的安装方式，有开发者直接在已知的系统中编译好，使用者可以直接下载并进行安装，升级，卸载等操作。在linux中能够提供这些功能的软件有两种，rpm和dpkg，而在CentOS中使用的是RPM</p>
<p>rpm最早是由redhat开发出来，由于很好用，所以很多发行版也利用rpm来进行软件包的管理。RPM全名RedHat Package Manager，最大的特点就是把需要安装的软件提前编译，打包，然后在rpm包里面存放了用以记录软件依赖关系的相关数据，当用户安装时，优先查看这些数据，如果系统满足数据要求就安装软件包，否则不能安装，安装完成后，将软件包相关信息记录到rpm自己的数据库中，便于查询和卸载等。所以说rpm的优点是方便安装，卸载，查询，缺点就是只能在指定的操作系统上使用，所以不同厂商的rpm包，甚至同一厂商不同版本操作系统的rpm包都不通用。</p>
<p><strong>rpm包的命名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dhcp-server-	4.3.6		-30			.el8		.x86_64		.rpm</span><br><span class="line">软件名称		版本		编译次数	         适用的系统	     适用的平台	   后缀名</span><br><span class="line"></span><br><span class="line">软件名	 就是软件包的名称</span><br><span class="line">版本	 每次更新版本号都会改变，用来帮助用户判断软件包新旧的</span><br><span class="line">编译次数	 也是帮助用户判断软件包新旧的</span><br><span class="line">适用的系统 在哪个系统上可以安装，CentOS和rhel的多数软件包都是通用的</span><br><span class="line">适用的平台 指的是硬件平台，比如如果你是32位的CPU就无法安装这个软件包</span><br></pre></td></tr></table></figure>

<h3 id="rpm的使用"><a href="#rpm的使用" class="headerlink" title="rpm的使用"></a>rpm的使用</h3><p>rpm包的相关文件一般都会放在对应的目录中，比如rpm包安装后，配置文件会放在&#x2F;etc下，执行文件会放在&#x2F;usr&#x2F;bin下，链接库文件会放在&#x2F;usr&#x2F;lib下，帮助与说明文档会放在&#x2F;usr&#x2F;share&#x2F;man和&#x2F;usr&#x2F;share&#x2F;doc目录下</p>
<p><strong>安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue Packages]# rpm -ivh dhcp-server-4.3.6-30.el8.x86_64.rpm </span><br><span class="line">-i					安装</span><br><span class="line">-v					显示详细信息</span><br><span class="line">-h					显示安装进度</span><br><span class="line">-e					卸载</span><br><span class="line">-U					升级，如果系统中有低版本的就会升级，如果系统没有安装相应的包，则安装</span><br><span class="line">-F					有条件的升级，会检测用户指定的软件包是否已安装到linux中</span><br><span class="line">--nodeps			忽略软件包之间的依赖关系</span><br><span class="line">--replacefiles		覆盖文件</span><br><span class="line">--replacepkgs		修复</span><br><span class="line">--force				强制</span><br><span class="line">--test				测试</span><br><span class="line">-q					查询指定的软件包是否安装</span><br><span class="line">-qi					查看指定的软件包的信息，包括开发商，版本，说明</span><br><span class="line">-ql					查看指定软件包中所包含的文件列表</span><br><span class="line">-qc					查看指定软件包的配置文件</span><br><span class="line">-qa					查看本机安装的所有包</span><br><span class="line">-qf					查看一个文件归属于哪个已安装的软件包</span><br></pre></td></tr></table></figure>

<p>rpm的内容我们就介绍到这里，接下来我们看下一个yum</p>
<h2 id="二、yum软件仓库"><a href="#二、yum软件仓库" class="headerlink" title="二、yum软件仓库"></a>二、yum软件仓库</h2><h3 id="yum的介绍"><a href="#yum的介绍" class="headerlink" title="yum的介绍"></a>yum的介绍</h3><p>YUM（<em>Yellow dog Updater, Modified</em>）是一个基于rpm却更胜于rpm的管理工具，让你可以更轻松的管理Red Hat Enterprise Linux系统中的软件。你可以使用YUM来安装或卸载软件、也可以利用YUM来更新你的系统，更可以利用YUM来搜索一个尚未安装的软件。不管是安装、更新或者删除，YUM都会自动的帮你解决软件间的依赖性问题。通过YUM会比单纯使用rpm来得更加方便。</p>
<p>YUM包含下列几项组件：</p>
<ul>
<li>YUM下载源：如果把所有RPM文件放在某一个目录中，这个目录就可称为“YUM下载源（<em>YUM Repository</em>）”。你也可以把YUM下载源，通过HTTP、FTP等方式分享给其他计算机使用；当然，你也可以直接使用别人建好的YUM下载源来取得需安装的软件。</li>
<li>YUM工具：YUM提供了一个名为yum的命令，你可以使用yum来使用YUM提供的众多功能。</li>
<li>YUM插件：YUM还允许第三方厂商（<em>3rd Party</em>）开发YUM的插件（<em>Plug-in</em>），让用户可以任意的扩充YUM的功能，比如说有的插件可以帮助选择最快的yum源</li>
<li>YUM缓存：YUM运行时，会从YUM下载源获得软件信息与文件，并且暂存于本机的硬盘上。这个暂存的目录，称为“YUM缓存（<em>YUM cache</em>）”。缓存目录为&#x2F;var&#x2F;cache&#x2F;yum</li>
</ul>
<h3 id="yum的使用"><a href="#yum的使用" class="headerlink" title="yum的使用"></a>yum的使用</h3><p>yum源的配置</p>
<p> 由于yum有下载源这个东西，所以我们在使用yum之前需要告诉它去什么地方获取这些软件包，也就是说需要先配置一个yum源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@zutuanxue yum.repos.d]# ls</span><br><span class="line">CentOS-AppStream.repo   CentOS-CR.repo    CentOS-fasttrack.repo   CentOS-Sources.repo</span><br><span class="line">CentOS-Base.repo    CentOS-Debuginfo.repo  CentOS-Media.repo       CentOS-Vault.repo</span><br><span class="line">CentOS-centosplus.repo  CentOS-Extras.repo     CentOS-PowerTools.repo</span><br><span class="line">在CentOS8中yum的下载源配置文件统一都放到/etc/yum.repos.d/目录下，在这个目录中有些默认的下载源</span><br><span class="line">我不使用这些自带的下载源，我想配置一个自己的下载源，让yum使用光盘镜像里的软件包,为了避免干扰，我们把这些自带的下载源都放到一个目录里</span><br><span class="line">[root@zutuanxue yum.repos.d]# mkdir repos</span><br><span class="line">[root@zutuanxue yum.repos.d]# ls</span><br><span class="line">CentOS-AppStream.repo   CentOS-CR.repo         CentOS-fasttrack.repo   CentOS-Sources.repo</span><br><span class="line">CentOS-Base.repo        CentOS-Debuginfo.repo  CentOS-Media.repo       CentOS-Vault.repo</span><br><span class="line">CentOS-centosplus.repo  CentOS-Extras.repo     CentOS-PowerTools.repo  repos</span><br><span class="line">[root@zutuanxue yum.repos.d]# mv *.repo repos</span><br><span class="line">[root@zutuanxue yum.repos.d]# clear</span><br><span class="line">[root@zutuanxue yum.repos.d]# ls</span><br><span class="line">repos</span><br><span class="line">然后使用vim命令建立自己的下载源配置文件</span><br><span class="line">[root@zutuanxue repos]# vim server.repo</span><br><span class="line">[server-BaseOS]			yum源的名称</span><br><span class="line">name=server-BaseOS		完整名称</span><br><span class="line">enabled=1				是否启用</span><br><span class="line">gpgcheck=0				是否检查rpm包的数字签名</span><br><span class="line">baseurl=file:///mnt/BaseOS	下载源地址</span><br><span class="line">[server-AppStream]</span><br><span class="line">name=server-AppStream</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/AppStream</span><br><span class="line">[root@zutuanxue ~]# mount /dev/cdrom  /mnt/		将光盘挂载到指定位置</span><br><span class="line">由于CentOS8的软件包存放在光盘根目录的BaseOS和AppStream目录中，所以这里面为了保证需要的软件包能正确安装我们配置了两个yum源，这两部分内容你可以放到一个文件里，也可以分别放在两个文件中</span><br></pre></td></tr></table></figure>

<p>以上就是yum源配置文件，我们接下来看下如何建立下载源目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">将下载好的rpm软件包存放到一个指定的目录中</span><br><span class="line">[root@zutuanxue ~]# cp /mnt/AppStream/Packages/* myrepo/</span><br><span class="line"></span><br><span class="line">从光盘镜像中安装createrepo工具</span><br><span class="line">[root@zutuanxue ~]# yum install createrepo</span><br><span class="line"></span><br><span class="line">利用createrepo工具生成软件包之间的依赖关系数据文件</span><br><span class="line">[root@zutuanxue ~]# createrepo myself/</span><br><span class="line"></span><br><span class="line">建立针对此目录的下载源配置文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/yum.repos.d/myrepo.repo</span><br><span class="line">[myself]</span><br><span class="line">name=packages</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///root/myself</span><br><span class="line"></span><br><span class="line">从新的下载源安装软件包</span><br><span class="line">[root@zutuanxue ~]# yum install httpd</span><br></pre></td></tr></table></figure>

<p>yum插件安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# yum install 插件名称</span><br><span class="line">插件配置文件存放位置/etc/yum/pluginconf.d/xxx.conf</span><br><span class="line"></span><br><span class="line">插件的启用和停用</span><br><span class="line">修改/etc/yum/pluginconf.d/xxx.conf文件中的enabled字段 1=启用 0=停用</span><br><span class="line">[root@zutuanxue ~]# yum [OPTIONS...] COMMAND [ARGVS...]</span><br><span class="line">-y							如果遇到问题，代替回答yes</span><br><span class="line">--installroot=/path			指定软件包安装的根目录</span><br></pre></td></tr></table></figure>

<p>清除yum缓存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# yum clean all</span><br><span class="line">如果有些时候你发现yum运行不太正常，这可能是yum缓存数据错误导致的，所以你需要将yum的缓存清除</span><br><span class="line">查看软件包</span><br><span class="line">[root@zutuanxue ~]# yum list</span><br><span class="line"></span><br><span class="line">查看有哪些可用组</span><br><span class="line">[root@zutuanxue ~]# yum grouplist</span><br><span class="line">     </span><br><span class="line">查看dhcp-server这个包的信息   </span><br><span class="line">[root@zutuanxue ~]# yum info dhcp-server			</span><br><span class="line"></span><br><span class="line">搜索dhcp-server这个软件包</span><br><span class="line">[root@zutuanxue ~]# yum search dhcp-server		</span><br></pre></td></tr></table></figure>

<p>yum安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">安装dhcp-server软件包</span><br><span class="line">[root@zutuanxue ~]# yum install dhcp-server -y		</span><br><span class="line"></span><br><span class="line">安装一组软件包</span><br><span class="line">[root@zutuanxue ~]# yum groupinstall &#x27;系统工具&#x27; -y	              </span><br></pre></td></tr></table></figure>

<p>卸载软件包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">删除一个软件包</span><br><span class="line">[root@zutuanxue ~]# yum remove dhcp-server -y			</span><br><span class="line"></span><br><span class="line">删除一组软件包</span><br><span class="line">[root@zutuanxue ~]# yum groupremove &#x27;系统工具&#x27; -y		</span><br></pre></td></tr></table></figure>

<p>使用epel源</p>
<p>EPEL是一个自由开源的附加软件包仓库，可用于 CentOS 和 RHEL 服务器。顾名思义，EPEL 仓库提供了额外的软件包，这些软件在 CentOS 8 和 RHEL 8 的默认软件包仓库中不可用。</p>
<p>安装epel源</p>
<p>epel地址：<a target="_blank" rel="noopener" href="https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm">https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<h2 id="三、源码包的安装"><a href="#三、源码包的安装" class="headerlink" title="三、源码包的安装"></a>三、源码包的安装</h2><p>在linux系统中，很多新版本的软件包的更新都会优先提供tar包版本的，然后各linux厂商拿到这个tar包之后再给自己的操作系统提供官方的rpm或者dpkg类型的软件包，而这种tar工具打包的软件包我们一般称之为源码包，在这些源码包中一般包含有，程序源代码文件，配置文件（configure），安装使用说明（INSTALL,HOWTO,README）</p>
<p>那这种tar包源码包如何安装呢？简单的流程就是</p>
<ul>
<li>获取软件包</li>
<li>解压文件</li>
<li>检查当前系统是否满足软件包安装需求</li>
<li>使用gcc进行编译，生成主要的二进制文件</li>
<li>将二进制文件安装到主机</li>
</ul>
<p>这些步骤看起来很简单，但是在使用过程中有很多问题需要解决，比如说需要解决系统环境，权限问题等等，不同类型的软件在安装方法上会有差异，但是整体步骤就是我们上面所提到的。接下来我们通过一个案例来学习源码安装软件。</p>
<p><strong>案例：源码安装一个nginx软件</strong></p>
<h3 id="获取软件包"><a href="#获取软件包" class="headerlink" title="获取软件包"></a>获取软件包</h3><p>软件包获取的方式有很多，最常见的就是拷贝或者下载这两种方式，拷贝咱们就不说了，因为用的太多了；接下来我给大家说一下如何从网络下载软件包。</p>
<ul>
<li>wget命令：文本界面的下载命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# wget http://nginx.org/download/nginx-1.19.3.tar.gz</span><br><span class="line">--2020-10-11 15:59:45--  http://nginx.org/download/nginx-1.19.3.tar.gz</span><br><span class="line">正在解析主机 nginx.org (nginx.org)... 3.125.197.172, 52.58.199.22, 2a05:d014:edb:5704::6, ...</span><br><span class="line">正在连接 nginx.org (nginx.org)|3.125.197.172|:80... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... 200 OK</span><br><span class="line">长度：1052581 (1.0M) [application/octet-stream]</span><br><span class="line">正在保存至: “nginx-1.19.3.tar.gz”</span><br><span class="line"></span><br><span class="line">nginx-1.19.3.tar.gz 100%[===================&gt;]   1.00M  21.4KB/s  用时 43s     </span><br><span class="line"></span><br><span class="line">2020-10-11 16:00:28 (24.1 KB/s) - 已保存 “nginx-1.19.3.tar.gz” [1052581/1052581])</span><br></pre></td></tr></table></figure>

<ul>
<li>解压软件包</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# tar xf nginx-1.19.3.tar.gz</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ls</span><br><span class="line">公共  视频  文档  音乐  anaconda-ks.cfg       nginx-1.19.3</span><br><span class="line">模板  图片  下载  桌面  initial-setup-ks.cfg  nginx-1.19.3.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>configure命令：检查当前系统是否满足软件包安装需求,这步的主要目的：<br>– 检查环境 是否 满足安装条件 依赖解决<br>– 指定安装方式 配置文件 命令文件 各种文件放哪里 开启模块功能【内置模块 三方模块】<br>– 指定软件安装在那里</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">- 安装GCC编译软件 以及nginx依赖，有人问我为啥要安装pcre-devel zlib-devel这两个包，因为你不了解，如果你自己安装过一次就知道在检查当前系统的时候会报错，说没有这两个软件，这里我就直接装上了。大家学习的时候可以试试，是不是我说的这样。</span><br><span class="line">[root@zutuanxue ~]# yum -y install gcc pcre-devel zlib-devel</span><br><span class="line"></span><br><span class="line">- 检查系统是否满足安装需求</span><br><span class="line">[root@zutuanxue ~]# cd nginx-1.19.3/</span><br><span class="line">[root@zutuanxue nginx-1.19.3]# ./configure --prefix=/usr/local/nginx</span><br><span class="line">checking for OS</span><br><span class="line"> + Linux 4.18.0-193.el8.x86_64 x86_64</span><br><span class="line">checking for C compiler ... found</span><br><span class="line"> + using GNU C compiler</span><br><span class="line"> + gcc version: 8.3.1 20191121 (Red Hat 8.3.1-5) (GCC) </span><br><span class="line">checking for gcc -pipe switch ... found</span><br><span class="line">checking for -Wl,-E switch ... found</span><br><span class="line">checking for gcc builtin atomic operations ... found</span><br><span class="line">checking for C99 variadic macros ... found</span><br><span class="line">checking for gcc variadic macros ... found</span><br><span class="line"></span><br><span class="line">.........此处省略10000个字</span><br><span class="line"></span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: &quot;/usr/local/nginx&quot;</span><br><span class="line">  nginx binary file: &quot;/usr/local/nginx/sbin/nginx&quot;</span><br><span class="line">  nginx modules path: &quot;/usr/local/nginx/modules&quot;</span><br><span class="line">  nginx configuration prefix: &quot;/usr/local/nginx/conf&quot;</span><br><span class="line">  nginx configuration file: &quot;/usr/local/nginx/conf/nginx.conf&quot;</span><br><span class="line">  nginx pid file: &quot;/usr/local/nginx/logs/nginx.pid&quot;</span><br><span class="line">  nginx error log file: &quot;/usr/local/nginx/logs/error.log&quot;</span><br><span class="line">  nginx http access log file: &quot;/usr/local/nginx/logs/access.log&quot;</span><br><span class="line">  nginx http client request body temporary files: &quot;client_body_temp&quot;</span><br><span class="line">  nginx http proxy temporary files: &quot;proxy_temp&quot;</span><br><span class="line">  nginx http fastcgi temporary files: &quot;fastcgi_temp&quot;</span><br><span class="line">  nginx http uwsgi temporary files: &quot;uwsgi_temp&quot;</span><br><span class="line">  nginx http scgi temporary files: &quot;scgi_temp&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">备注：</span><br><span class="line">/configure --prefix=/usr/local/nginx</span><br><span class="line">--prefix=   指定软件安装到哪个目录</span><br></pre></td></tr></table></figure>

<ul>
<li>make命令：使用gcc进行编译，生成主要的二进制文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue nginx-1.19.3]# make -j4</span><br><span class="line">make -f objs/Makefile</span><br><span class="line">make[1]: 进入目录“/root/nginx-1.19.3”</span><br><span class="line">cc -c -pipe  -O -W -Wall -Wpointer-arith -Wno-unused-parameter -Werror -g  -I src/core -I src/event -I src/event/modules -I src/os/unix -I objs \</span><br><span class="line">	-o objs/src/core/ngx_inet.o \</span><br><span class="line">	src/core/ngx_inet.c</span><br><span class="line">           ...........省略过程</span><br><span class="line"></span><br><span class="line">-ldl -lpthread -lcrypt -lpcre -lz \</span><br><span class="line">-Wl,-E</span><br><span class="line">make[1]: 离开目录“/root/nginx-1.19.3”</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">备注： make -j4</span><br><span class="line">-j 指定几个cpu一起编译    -j4  那就是4个一起干活，默认一个干活，这样速度更快</span><br></pre></td></tr></table></figure>

<ul>
<li>make install 命令将二进制文件安装到主机</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue nginx-1.19.3]# make install</span><br><span class="line">make -f objs/Makefile install</span><br><span class="line">make[1]: 进入目录“/root/nginx-1.19.3”</span><br><span class="line">test -d &#x27;/usr/local/nginx&#x27; || mkdir -p &#x27;/usr/local/nginx&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/sbin&#x27; \</span><br><span class="line">	|| mkdir -p &#x27;/usr/local/nginx/sbin&#x27;</span><br><span class="line">test ! -f &#x27;/usr/local/nginx/sbin/nginx&#x27; \</span><br><span class="line">	|| mv &#x27;/usr/local/nginx/sbin/nginx&#x27; \</span><br><span class="line">		&#x27;/usr/local/nginx/sbin/nginx.old&#x27;</span><br><span class="line">cp objs/nginx &#x27;/usr/local/nginx/sbin/nginx&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/conf&#x27; \</span><br><span class="line">	|| mkdir -p &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/koi-win &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/koi-utf &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/win-utf &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/mime.types&#x27; \</span><br><span class="line">	|| cp conf/mime.types &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/mime.types &#x27;/usr/local/nginx/conf/mime.types.default&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/fastcgi_params&#x27; \</span><br><span class="line">	|| cp conf/fastcgi_params &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/fastcgi_params \</span><br><span class="line">	&#x27;/usr/local/nginx/conf/fastcgi_params.default&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/fastcgi.conf&#x27; \</span><br><span class="line">	|| cp conf/fastcgi.conf &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/fastcgi.conf &#x27;/usr/local/nginx/conf/fastcgi.conf.default&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/uwsgi_params&#x27; \</span><br><span class="line">	|| cp conf/uwsgi_params &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/uwsgi_params \</span><br><span class="line">	&#x27;/usr/local/nginx/conf/uwsgi_params.default&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/scgi_params&#x27; \</span><br><span class="line">	|| cp conf/scgi_params &#x27;/usr/local/nginx/conf&#x27;</span><br><span class="line">cp conf/scgi_params \</span><br><span class="line">	&#x27;/usr/local/nginx/conf/scgi_params.default&#x27;</span><br><span class="line">test -f &#x27;/usr/local/nginx/conf/nginx.conf&#x27; \</span><br><span class="line">	|| cp conf/nginx.conf &#x27;/usr/local/nginx/conf/nginx.conf&#x27;</span><br><span class="line">cp conf/nginx.conf &#x27;/usr/local/nginx/conf/nginx.conf.default&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/logs&#x27; \</span><br><span class="line">	|| mkdir -p &#x27;/usr/local/nginx/logs&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/logs&#x27; \</span><br><span class="line">	|| mkdir -p &#x27;/usr/local/nginx/logs&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/html&#x27; \</span><br><span class="line">	|| cp -R html &#x27;/usr/local/nginx&#x27;</span><br><span class="line">test -d &#x27;/usr/local/nginx/logs&#x27; \</span><br><span class="line">	|| mkdir -p &#x27;/usr/local/nginx/logs&#x27;</span><br><span class="line">make[1]: 离开目录“/root/nginx-1.19.3”</span><br></pre></td></tr></table></figure>

<p>到此我们就把nginx安装到&#x2F;usr&#x2F;local目录下了,可以使用ls命令看看有没有东西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue nginx-1.19.3]# ls /usr/local/nginx/</span><br><span class="line">conf  html  logs  sbin</span><br></pre></td></tr></table></figure>

<ul>
<li>验证安装<br>软件已经安装了，我们看看结果吧！</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动软件</span><br><span class="line">[root@zutuanxue nginx-1.19.3]# /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>

<p>打开虚拟机浏览器输入:<a target="_blank" rel="noopener" href="http://localhost回车/">http://localhost回车</a></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602404129693.png" alt="nginx访问.png"></p>
<h2 id="四、CentOS-8-dnf命令"><a href="#四、CentOS-8-dnf命令" class="headerlink" title="四、CentOS 8 dnf命令"></a>四、CentOS 8 dnf命令</h2><h3 id="dnf介绍"><a href="#dnf介绍" class="headerlink" title="dnf介绍"></a>dnf介绍</h3><p>DNF是新一代的rpm软件包管理器。最早出现在 Fedora 18 这个发行版中，在Fedora 22中正式取代了yum</p>
<p>DNF器克服了YUM的一些瓶颈，提升了包括用户体验，内存占用，依赖分析，运行速度等多方面的内容。</p>
<h3 id="dnf安装"><a href="#dnf安装" class="headerlink" title="dnf安装"></a>dnf安装</h3><p>在CentOS7中需要单独安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release -y</span><br><span class="line">yum install dnf</span><br></pre></td></tr></table></figure>

<p>在CentOS8中系统默认使用的是DNF，我们所看到的yum只是dnf的一个软连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# which yum</span><br><span class="line">/usr/bin/yum</span><br><span class="line">[root@zutuanxue ~]# ll /usr/bin/yum </span><br><span class="line">lrwxrwxrwx. 1 root root 5 5月  14 2019 /usr/bin/yum -&gt; dnf-3</span><br></pre></td></tr></table></figure>

<h4 id="相关目录和使用"><a href="#相关目录和使用" class="headerlink" title="相关目录和使用"></a><strong>相关目录和使用</strong></h4><ul>
<li><strong>目录</strong></li>
</ul>
<p>&#x2F;etc&#x2F;dnf&#x2F;dnf.conf 配置文件</p>
<p>&#x2F;etc&#x2F;dnf&#x2F;aliases.d&#x2F; 为相关命令定义别名的如dnf alias add rm&#x3D;remove</p>
<p>&#x2F;etc&#x2F;dnf&#x2F;modules.d&amp;&#x2F;etc&#x2F;dnf&#x2F;modules.defaults.d 模块的设置</p>
<p>&#x2F;etc&#x2F;dnf&#x2F;plugins&#x2F; 插件的设置</p>
<p>&#x2F;etc&#x2F;dnf&#x2F;protected.d&#x2F; 受保护的软件包的设置</p>
<p>&#x2F;etc&#x2F;dnf&#x2F;vars&#x2F; 变量设置</p>
<ul>
<li><strong>dnf用法展示</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">查看DNF的版本</span><br><span class="line">[root@zutuanxue ~]# dnf --version			</span><br><span class="line"></span><br><span class="line">查看dnf的可用软件仓库</span><br><span class="line">[root@zutuanxue ~]# dnf repolist		</span><br><span class="line"></span><br><span class="line">查看所有软件仓库</span><br><span class="line">[root@zutuanxue ~]# dnf repolist all	</span><br><span class="line"></span><br><span class="line">查看已安装的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf list installed	  </span><br><span class="line"></span><br><span class="line">查看可安装的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf list available 	</span><br><span class="line"></span><br><span class="line">搜索dhcp-server</span><br><span class="line">[root@zutuanxue ~]# dnf search dhcp-server		</span><br><span class="line"></span><br><span class="line">查询一个文件是由哪个软件包提供的</span><br><span class="line">[root@zutuanxue ~]# dnf provides /usr/sbin/dhclient</span><br><span class="line"></span><br><span class="line">查询软件包详细信息</span><br><span class="line">[root@zutuanxue ~]# dnf info dhcp-server	</span><br><span class="line"></span><br><span class="line">安装软件包</span><br><span class="line">[root@zutuanxue ~]# dnf install dhcp-server			</span><br><span class="line"></span><br><span class="line">升级软件包</span><br><span class="line">[root@zutuanxue ~]# dnf update systemd	</span><br><span class="line"></span><br><span class="line">检查软件包的更新</span><br><span class="line">[root@zutuanxue ~]# dnf check-update	</span><br><span class="line"></span><br><span class="line">升级所有可升级的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf update		</span><br><span class="line"></span><br><span class="line">升级所有可升级的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf upgrade		</span><br><span class="line"></span><br><span class="line">卸载软件包</span><br><span class="line">[root@zutuanxue ~]# dnf remove dhcp-server	</span><br><span class="line">[root@zutuanxue ~]# dnf erase dhcp-server		</span><br><span class="line"></span><br><span class="line">删除无用孤立的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf autoremove	</span><br><span class="line"></span><br><span class="line">清除缓存中的无用数据</span><br><span class="line">[root@zutuanxue ~]# dnf clean all	</span><br><span class="line"></span><br><span class="line">获取某一个命令的帮助</span><br><span class="line">[root@zutuanxue ~]# dnf help clean	</span><br><span class="line"></span><br><span class="line">获取dnf命令的帮助</span><br><span class="line">[root@zutuanxue ~]# dnf help			</span><br><span class="line"></span><br><span class="line">查看历史命令</span><br><span class="line">[root@zutuanxue ~]# dnf history		</span><br><span class="line"></span><br><span class="line">重新执行历史命令中的第19条</span><br><span class="line">[root@zutuanxue ~]# dnf history redo 19	</span><br><span class="line"></span><br><span class="line">查看软件包组</span><br><span class="line">[root@zutuanxue ~]# dnf grouplist		</span><br><span class="line"></span><br><span class="line">安装一组软件包</span><br><span class="line">[root@zutuanxue ~]# dnf groupinstall &#x27;系统工具&#x27; </span><br><span class="line"></span><br><span class="line">升级一组软件包</span><br><span class="line">[root@zutuanxue ~]# dnf groupupdate &#x27;系统工具&#x27;	</span><br><span class="line"></span><br><span class="line">删除一组软件包</span><br><span class="line">[root@zutuanxue ~]# dnf groupremove &#x27;系统工具&#x27;	</span><br><span class="line"></span><br><span class="line">从特定的软件仓库安装软件包</span><br><span class="line">[root@zutuanxue ~]# dnf --enablerepo=epel install zabbix</span><br><span class="line"></span><br><span class="line">将软件包更新到最新的稳定版</span><br><span class="line">[root@zutuanxue ~]# dnf distro-sync</span><br><span class="line"></span><br><span class="line">重新安装指定的软件包</span><br><span class="line">[root@zutuanxue ~]# dnf reinstall dhcp-server</span><br><span class="line"></span><br><span class="line">降级软件包</span><br><span class="line">[root@zutuanxue ~]# dnf downgrade dhcp-server</span><br></pre></td></tr></table></figure>

<h1 id="linux服务介绍"><a href="#linux服务介绍" class="headerlink" title="linux服务介绍"></a>linux服务介绍</h1><p> 阅读 (202078) </p>
<p> 分享</p>
<p>什么是服务？在linux系统中，有一些特殊程序，启动后就会持续在后台执行，等待用户或者其他软件调用使用，这种程序我们称为服务。</p>
<p>linux系统中服务的管理工具</p>
<ul>
<li>systemV</li>
<li>systemd</li>
</ul>
<h2 id="一、systemV与init"><a href="#一、systemV与init" class="headerlink" title="一、systemV与init"></a>一、systemV与init</h2><p>systemV，systemV当中有一个叫init的程序，这个程序可以让系统中的service命令去调用&#x2F;etc&#x2F;init.d&#x2F;目录下的服务脚本，我们可以通过service命令去控制服务的启动与关闭,或者找到服务相应的执行文件，然后执行，比如&#x2F;usr&#x2F;sbin&#x2F;httpd,这样才能启动一个服务，如果想要停止一个服务则需要使用kill命令去停止<br>该服务管理方式从RHEL7之前的系统中默认</p>
<h3 id="init的特点"><a href="#init的特点" class="headerlink" title="init的特点"></a>init的特点</h3><ul>
<li>启动&#x2F;停止&#x2F;查看<br>&#x2F;etc&#x2F;init.d&#x2F;servername start&#x2F;stop&#x2F;restart&#x2F;status<br>​ 或<br>​service servername start&#x2F;stop&#x2F;restart&#x2F;status</li>
<li>开机启动管理与查看<br>chkconfig –level 0-6 servername on&#x2F;off 指定一个服务在哪个运行级别启动<br>chkconfig –list servername 查看一个服务在哪些运行级别启动</li>
</ul>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>按照功能分类</p>
<ul>
<li>系统服务：这些服务的服务对象是linux系统本身，或者linux系统的用户</li>
<li>网络服务：网络服务的服务对象是网络中的其他客户端</li>
</ul>
<p>按照启动方法分类</p>
<ul>
<li>独立系统服务：这类服务一经启动，除非系统关闭或者管理者手动结束，否则会一直在后台执行，不管是否用到。由于这类服务一直在后台执行，所以响应速度快，同时也会占用系统资源</li>
<li>临时服务：跟独立的服务不同，临时服务是用到的时候启动，使用完毕后服务会停止，所以临时服务响应速度慢，但是节省系统资源</li>
</ul>
<h5 id="手动解决服务的依赖关系"><a href="#手动解决服务的依赖关系" class="headerlink" title="手动解决服务的依赖关系"></a>手动解决服务的依赖关系</h5><p> 服务之间是有依赖关系的，比如说，联网的服务如果想正常运行的话，就必须启动网络服务。而这些服务就需要用户手动去处理</p>
<h4 id="运行级别分类"><a href="#运行级别分类" class="headerlink" title="运行级别分类"></a>运行级别分类</h4><p> init会根据用户指定的运行级别，来启动不同的服务，在linux系统中包含了0-6，一共7个运行级别</p>
<p>0 关机</p>
<p>1 单用户</p>
<p>2 无网络的多用户</p>
<p>3 字符模式</p>
<p>4 保留</p>
<p>5 图形模式</p>
<p>6 重启</p>
<h2 id="二、systemd与unit"><a href="#二、systemd与unit" class="headerlink" title="二、systemd与unit"></a>二、systemd与unit</h2><p>从CentOS7开始SystemV，也就是init服务，被效率更高的systemd所替代，而这个systemd对应的管理命令就是systemctl，并且systemctl命令也兼容了service（service命令做为systemd的入口，是systemctl命令的封装）。</p>
<h4 id="systemd的优势"><a href="#systemd的优势" class="headerlink" title="systemd的优势"></a>systemd的优势</h4><ul>
<li>并行处理所有服务，缩短开机时间</li>
<li>响应速度快，通过systemctl命令就可以完成所有操作</li>
<li>自动解决服务的依赖关系，类似yum</li>
<li>方便记忆，按照类型对服务进行分类</li>
<li>兼容init</li>
</ul>
<h4 id="相关文件"><a href="#相关文件" class="headerlink" title="相关文件"></a>相关文件</h4><p>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F; 服务的启动脚本，包含所有安装完成的服务设置文件</p>
<p>&#x2F;run&#x2F;systemd&#x2F;system&#x2F; 系统运行过程中的服务脚本优先级高于上一个文件</p>
<p>&#x2F;etc&#x2F;systemd&#x2F;system&#x2F; 管理员手动建立的服务启动脚本，优先级最高</p>
<p>&#x2F;etc&#x2F;sysconfig&#x2F;* 系统功能的默认设置</p>
<h4 id="服务分类"><a href="#服务分类" class="headerlink" title="服务分类"></a>服务分类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl -t  help</span><br><span class="line">service				服务单元，用于控制服务</span><br><span class="line">socket				套接字单元，用于进程间通信</span><br><span class="line">target				目标单元，用于控制一组其它单元</span><br><span class="line">device				设备单元，用于控制动态的设备</span><br><span class="line">mount				挂载单元，用于管理文件系统挂载点</span><br><span class="line">automount			自动挂载单元，用于管理文件系统自动挂载点</span><br><span class="line">swap				交换分区单元，用于管理swap设备或swap文件</span><br><span class="line">timer				定时器单元，用于管理基于时间触发的动作</span><br><span class="line">path				路径单元，用于监视文件系统路径，以用于基于路径的启动</span><br><span class="line">slice				范围单元，用于管理与控制一组特定进程的资源占用</span><br><span class="line">scope				范围单元，与service类似，系统自动创建</span><br></pre></td></tr></table></figure>

<h1 id="linux服务管理"><a href="#linux服务管理" class="headerlink" title="linux服务管理"></a>linux服务管理</h1><p> 阅读 (242415) </p>
<p> 分享</p>
<h2 id="systemctl命令"><a href="#systemctl命令" class="headerlink" title="systemctl命令"></a>systemctl命令</h2><h3 id="管理服务"><a href="#管理服务" class="headerlink" title="管理服务"></a>管理服务</h3><p>我们一起来看一下在服务管理方面systemctl这个工具如何使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl start servername</span><br><span class="line">start            	启动服务</span><br><span class="line">stop             	停止服务</span><br><span class="line">restart          	重启服务(没启动的服务会启动)</span><br><span class="line">try-restart		只重启正在运行的服务(没有运行则不启动)</span><br><span class="line">reload          	重载配置文件(修改完服务的配置文件后使用)</span><br><span class="line">status         	 	检查服务状态</span><br><span class="line">is-active        	检查服务是否已经启动</span><br><span class="line">enable          	设置服务开机时启动</span><br><span class="line">disable          	设置服务开机时不启动</span><br><span class="line">is-enabled       	查看服务是否开机自动启动</span><br><span class="line">mask		        屏蔽一个服务</span><br><span class="line">unmask		        取消屏蔽</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl status httpd</span><br><span class="line">● httpd.service - The Apache HTTP Server		服务名称</span><br><span class="line">   Loaded: loaded	加载到内存中；error加载失败；bad-setting无法理解单元配置文件中的设置；masked被屏蔽	 	(/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled) 服务开机时是否启动 enabled为启动；disabled为不启动</span><br><span class="line">   Active: active (running) since Mon 2019-11-18 15:56:46 CST; 1h 11min ago		服务当前的状态，active(running)为运行；active(exited)运行一次就退出了；active(waiting)运行中，但是再等待其它程序结束才能继续；inactive(dead)为没有运行；activating为启动中，deactivating停止中；failed启动失败</span><br><span class="line">     Docs: man:httpd.service(8)	服务的帮助文档	</span><br><span class="line"> Main PID: 57779 (httpd)	服务的主进程号</span><br><span class="line">   Status: &quot;Running, listening on: port 80&quot; 额外的状态信息</span><br><span class="line">    Tasks: 213 (limit: 24882) 任务数量，含进程+线程</span><br><span class="line">   Memory: 22.4M		当前占用的内存</span><br><span class="line">   CGroup: /system.slice/httpd.service</span><br><span class="line">           ├─57779 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─57780 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─57781 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           ├─57782 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">           └─57783 /usr/sbin/httpd -DFOREGROUND</span><br><span class="line">		Control Groups额外信息</span><br><span class="line">11月 18 15:56:46 localhost.localdomain systemd[1]: Starting The Apache HTTP Server...</span><br><span class="line">11月 18 15:56:46 localhost.localdomain httpd[57779]: AH00558: httpd: Could not reliably determ&gt;</span><br><span class="line">11月 18 15:56:46 localhost.localdomain httpd[57779]: Server configured, listening on: port 80</span><br><span class="line">11月 18 15:56:46 localhost.localdomain systemd[1]: Started The Apache HTTP Server.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">[root@zutuanxue ~]# systemctl is-active atd	</span><br><span class="line">inactive</span><br><span class="line">[root@zutuanxue ~]# systemctl start atd</span><br><span class="line">[root@zutuanxue ~]# systemctl status atd</span><br><span class="line">● atd.service - Job spooling tools</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2019-11-18 18:36:26 CST; 7s ago</span><br><span class="line"> Main PID: 60620 (atd)</span><br><span class="line">    Tasks: 1 (limit: 24882)</span><br><span class="line">   Memory: 504.0K</span><br><span class="line">   CGroup: /system.slice/atd.service</span><br><span class="line">           └─60620 /usr/sbin/atd -f</span><br><span class="line"></span><br><span class="line">11月 18 18:36:26 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">[root@zutuanxue ~]# systemctl stop atd</span><br><span class="line">[root@zutuanxue ~]# systemctl status atd</span><br><span class="line">● atd.service - Job spooling tools</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead) since Mon 2019-11-18 18:36:43 CST; 6s ago</span><br><span class="line">  Process: 60620 ExecStart=/usr/sbin/atd -f $OPTS (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 60620 (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">11月 18 18:36:26 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopping Job spooling tools...</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopped Job spooling tools.</span><br><span class="line">[root@zutuanxue ~]# systemctl is-enabled atd</span><br><span class="line">enabled</span><br><span class="line">[root@zutuanxue ~]# systemctl disable atd</span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/atd.service.</span><br><span class="line">[root@zutuanxue ~]# systemctl is-enabled atd</span><br><span class="line">disabled</span><br><span class="line">[root@zutuanxue ~]# systemctl enable atd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/atd.service → /usr/lib/systemd/system/atd.service.</span><br><span class="line">[root@zutuanxue ~]# systemctl is-enabled atd</span><br><span class="line">enabled</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl stop atd</span><br><span class="line">[root@zutuanxue ~]# systemctl mask atd</span><br><span class="line">Created symlink /etc/systemd/system/atd.service → /dev/null.</span><br><span class="line">[root@zutuanxue ~]# systemctl status atd</span><br><span class="line">● atd.service</span><br><span class="line">   Loaded: masked (Reason: Unit atd.service is masked.)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line"></span><br><span class="line">11月 05 18:12:41 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">11月 18 18:34:15 localhost.localdomain systemd[1]: Stopping Job spooling tools...</span><br><span class="line">11月 18 18:34:15 localhost.localdomain systemd[1]: Stopped Job spooling tools.</span><br><span class="line">11月 18 18:36:26 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopping Job spooling tools...</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopped Job spooling tools.</span><br><span class="line">[root@zutuanxue ~]# systemctl unmask atd</span><br><span class="line">Removed /etc/systemd/system/atd.service.</span><br><span class="line">[root@zutuanxue ~]# systemctl status atd</span><br><span class="line">● atd.service - Job spooling tools</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line"></span><br><span class="line">11月 05 18:12:41 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">11月 18 18:34:15 localhost.localdomain systemd[1]: Stopping Job spooling tools...</span><br><span class="line">11月 18 18:34:15 localhost.localdomain systemd[1]: Stopped Job spooling tools.</span><br><span class="line">11月 18 18:36:26 localhost.localdomain systemd[1]: Started Job spooling tools.</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopping Job spooling tools...</span><br><span class="line">11月 18 18:36:43 localhost.localdomain systemd[1]: Stopped Job spooling tools</span><br></pre></td></tr></table></figure>

<h3 id="查看服务"><a href="#查看服务" class="headerlink" title="查看服务"></a>查看服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]#systemctl command --type=xxx --all</span><br><span class="line">list-units				查看所有加载到内存中的单元				</span><br><span class="line">list-unit-files	查看系统中所有安装的单元文件（存放在/usr/lib/systemd/system）的启用状态</span><br><span class="line">--type=xxx			单元类型</span><br><span class="line">--all						列出系统中所有加载的，不管状态为何</span><br><span class="line">[root@zutuanxue ~]# systemctl </span><br><span class="line">UNIT	LOAD   ACTIVE SUB       DESCRIPTION                                                      </span><br><span class="line">sys.. loaded active plugged 	/sys.....</span><br><span class="line">sys.. loaded active plugged   /sys.....</span><br><span class="line">sys.. loaded active plugged   /sys.....</span><br><span class="line">sys.. loaded active plugged   /sys.....</span><br><span class="line">sys.. loaded active plugged   /sys.....</span><br><span class="line">sys.. loaded active plugged   /sys.....</span><br><span class="line"></span><br><span class="line">UNIT：	单元名称</span><br><span class="line">LOAD：	是否被加载</span><br><span class="line">ACTIVE：	高优先级单元状态，与SUB结合就是使用status查看的状态</span><br><span class="line">SUB：	低优先级单元状态		</span><br><span class="line">DESCRIPTION：简介</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl list-unit-files </span><br><span class="line">UNIT	FILE					STATE    </span><br><span class="line">proc...     				static </span><br><span class="line">-.mount							generated</span><br><span class="line">boot.mount					generated</span><br><span class="line">dev-hugepages.mount	static   </span><br><span class="line">dev-mqueue.mount	  static   </span><br><span class="line">proc-fs-nfsd.mount	static   </span><br><span class="line">proc-...            static   </span><br><span class="line">sys-f...            static   </span><br><span class="line">sys-...						  static   </span><br><span class="line">sys-ke..            static   </span><br><span class="line">tmp.mount						static   </span><br><span class="line">var-lib..						static   </span><br><span class="line">var-lib..						static   </span><br><span class="line">cups.path..					enabled  </span><br><span class="line">systemd..						static</span><br><span class="line"></span><br><span class="line">查看指定类型的服务</span><br><span class="line">[root@zutuanxue ~]# systemctl --type target --all</span><br><span class="line">  UNIT                      LOAD      ACTIVE   SUB    DESCRIPTION                  </span><br><span class="line">  basic.target              loaded    active   active Basic System                 </span><br><span class="line">  bluetooth.target          loaded    active   active Bluetooth                    </span><br><span class="line">  cryptsetup.target         loaded    active   active Local...      </span><br><span class="line">● dbus.target               not-found inactive dead   dbus.target                  </span><br><span class="line">[root@zutuanxue ~]# systemctl --type=target --all</span><br><span class="line">  UNIT                      LOAD      ACTIVE   SUB    DESCRIPTION                  </span><br><span class="line">  basic.target              loaded    active   active Basic System                 </span><br><span class="line">  bluetooth.target          loaded    active   active Bluetooth                    </span><br><span class="line">  cryptsetup.target         loaded    active   active Local...</span><br><span class="line">● dbus.target               not-found inactive dead   dbus.target</span><br><span class="line">[root@zutuanxue ~]# systemctl list-units --type=target --all</span><br><span class="line">  UNIT                      LOAD      ACTIVE   SUB    DESCRIPTION                  </span><br><span class="line">  basic.target              loaded    active   active Basic System                 </span><br><span class="line">  bluetooth.target          loaded    active   active Bluetooth                    </span><br><span class="line">  cryptsetup.target         loaded    active   active Local...</span><br><span class="line">● dbus.target               not-found inactive dead   dbus.target                  </span><br><span class="line"></span><br><span class="line">使用systemctl切换运行级别</span><br><span class="line">[root@zutuanxue ~]# systemctl list-units --type target --all</span><br><span class="line">  UNIT                   LOAD      ACTIVE   SUB    DESCRIPTION                  </span><br><span class="line">  basic.target           loaded    active   active Basic System                 </span><br><span class="line">  bluetooth.target       loaded    inactive dead   Bluetooth                    </span><br><span class="line">  cryptsetup.target      loaded    active   active Local ..</span><br><span class="line">● dbus.target            not-found inactive dead   dbus.target                  </span><br><span class="line">  emergency.target       loaded    inactive dead   Emergency Mode               </span><br><span class="line">  getty-pre.target       loaded    inactive dead   Login..</span><br><span class="line">  getty.target           loaded    active   active Login Prompts                </span><br><span class="line">  graphical.target       loaded    inactive dead   Graphica..Interface          </span><br><span class="line">常用的target</span><br><span class="line">graphical.target：图形模式</span><br><span class="line">multi-user.target：字符模式</span><br><span class="line">rescue.target：救援模式</span><br><span class="line">emergency.target：紧急模式，无法进入到救援模式时使用</span><br><span class="line">shutdown.target：关机</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl get-default	查看默认运行级别</span><br><span class="line">graphical.target     </span><br><span class="line">[root@zutuanxue ~]# systemctl set-default multi-user.target	设置 </span><br><span class="line">Removed /etc/systemd/system/default.target.</span><br><span class="line">Created symlink /etc/systemd/system/default.target → /usr/lib/systemd/system/multi-user.target.</span><br><span class="line">[root@zutuanxue ~]# systemctl isolate multi-user.target 切换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">除了可以使用上述方法设置和查看之外 系统还给我们提供了几个简单的命令，方便操作</span><br><span class="line">[root@zutuanxue ~]# systemctl poweroff		关机</span><br><span class="line">[root@zutuanxue ~]# systemctl reboot			重启</span><br><span class="line">[root@zutuanxue ~]# systemctl suspend			挂起</span><br><span class="line">[root@zutuanxue ~]# systemctl hibernate		休眠</span><br><span class="line">[root@zutuanxue ~]# systemctl rescue			进入到救援模式</span><br><span class="line">[root@zutuanxue ~]# systemctl emergency		进入到紧急模式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看服务之间的依赖关系</span><br><span class="line">[root@zutuanxue ~]# systemctl list-dependencies multi-user.target</span><br><span class="line">查看multi-user.target依赖谁</span><br><span class="line">multi-user.target</span><br><span class="line">● ├─atd.service</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">● ├─basic.target</span><br><span class="line">● │ ├─-.mount</span><br><span class="line">● │ ├─microcode.service</span><br><span class="line">● │ ├─paths.target</span><br><span class="line">● │ ├─slices.target</span><br><span class="line">● │ │ ├─-.slice</span><br><span class="line">● │ │ └─system.slice</span><br><span class="line">● │ ├─sockets.target</span><br><span class="line">● │ │ ├─avahi-daemon.socket</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">[root@zutuanxue ~]# systemctl list-dependencies multi-user.target --reverse 	查看谁依赖multi-user.target</span><br><span class="line">multi-user.target</span><br><span class="line">● └─graphical.target</span><br></pre></td></tr></table></figure>

<h3 id="服务与端口"><a href="#服务与端口" class="headerlink" title="服务与端口"></a>服务与端口</h3><p> 我们知道在服务中分为系统服务和网络服务，系统服务是本机使用的，网络服务是给网络中的其它客户端使用的，那其它客户端是如何连接上的网络服务的呢？端口和协议，协议在我们之前的课程中了解过，那端口是什么呢？</p>
<p>端口：设备与外界通讯的出口，分为虚拟端口和物理端口，物理端口又叫接口，比如电脑中可以插网线的RJ45接口等,而虚拟端口指的就是网络服务使用的通讯接口，是不可见的，这些每个虚拟端口都有一个编号，我们称之为端口号，系统当中有一个文件记录的服务和端口号以及协议的对应关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/services  | more</span><br><span class="line">服务名称				端口号/协议				描述			</span><br><span class="line">ftp-data        20/tcp</span><br><span class="line">ftp-data        20/udp</span><br><span class="line"># 21 is registered to ftp, but also used by fsp</span><br><span class="line">ftp             21/tcp</span><br><span class="line">ftp             21/udp          fsp fspd</span><br><span class="line">ssh             22/tcp                          </span><br><span class="line">ssh             22/udp                         </span><br><span class="line">telnet          23/tcp</span><br><span class="line">telnet          23/udp</span><br><span class="line"></span><br><span class="line">我们还可以使用netstat工具去查看自己的系统打开了哪些端口</span><br><span class="line">[root@zutuanxue ~]# netstat -antulp</span><br><span class="line">a			查看所有服务以及对应的端口号</span><br><span class="line">n			将输出结果以数字的形式表示，而不是主机名，服务名等</span><br><span class="line">t			使用tcp协议</span><br><span class="line">u			使用udp协议</span><br><span class="line">l			只显示处于监听状态的</span><br><span class="line">p			显示程序的名称与进程号</span><br><span class="line">c			指定自动更新的间隔时间  秒</span><br><span class="line">r			查看路由表信息</span><br><span class="line">[root@zutuanxue ~]# netstat -antlup </span><br><span class="line">Proto：协议</span><br><span class="line">Recv-Q：接收队列，如果接收队列阻塞，可能是受到拒绝服务攻击								</span><br><span class="line">Send-Q：发送队列，如果发送队列不能很快清零，可能是有应用向外发送数据包过快，或者对方接收数据包不够快</span><br><span class="line">Recv-Q和Send-Q通常应该为0，如果不为0可能意味着有问题，数据包有堆积状态，可以接受短暂的非0状态</span><br><span class="line">Local Address：本地的地址和端口号</span><br><span class="line">Foreign Address：	外部地址和状态</span><br><span class="line">State：						端口状态</span><br><span class="line">			 CLOSED 			端口未被使用中。</span><br><span class="line">			 LISTEN 			监听中，可以连接</span><br><span class="line">			 SYN_SEND   	处在TCP三次握手期间，已经发送SYN包后，等待对方的ACK包。</span><br><span class="line">       SYN_RECV   	处在TCP三次握手期间，已经收到SYN包后，进入SYN_RECV状态。</span><br><span class="line">       ESTABLISHED	完成TCP三次握手，进入ESTABLISHED状态。可以进行通信。</span><br><span class="line">       FIN_WAIT_1   在TCP四次挥手时，主动关闭端发送FIN包后，进入此状态。</span><br><span class="line">       FIN_WAIT_2   在TCP四次挥手时，主动关闭端收到ACK包后，进入此状态。</span><br><span class="line">       TIME_WAIT    在TCP四次挥手时，主动关闭端发送了ACK包之后，进入此状态，</span><br><span class="line">       							等待一段时间，让被动关闭端收到ACK包。</span><br><span class="line">       CLOSING      在TCP四次挥手时，主动关闭端发送了FIN包后，没有收到对应的ACK										包，却收到对方的FIN包，此时，进入CLOSING状态。</span><br><span class="line">       CLOSE_WAIT   在TCP四次挥手期间，被动关闭端收到FIN包后，进入此状态。</span><br><span class="line">       LAST_ACK     在TCP四次挥手时，被动关闭端发送FIN包后，等待对方的ACK包。</span><br><span class="line">       UNKNOWN			未知状态</span><br><span class="line">PID/Program name： 进程号/程序名称</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过netstat命令可以看到自己的linux系统打开了哪些服务及端口号，如果有些端口不想被占用可以关闭相应的网络服务</span><br><span class="line">[root@zutuanxue ~]# systemctl list-units --all | grep avahi</span><br><span class="line">avahi-daemon.service loaded active running Avahi mDNS/DNS-SD Stack                                                                                          </span><br><span class="line">avahi-daemon.socket loaded active running Avahi mDNS/DNS-SD Stack Activation Socket                                                                        </span><br><span class="line">可以看到这个服务的作用是为内网提供域名解析的</span><br><span class="line">[root@zutuanxue ~]# systemctl stop avahi-daemon.service </span><br><span class="line">Warning: Stopping avahi-daemon.service, but it can still be activated by:</span><br><span class="line">  avahi-daemon.socket</span><br><span class="line">[root@zutuanxue ~]# systemctl stop avahi-daemon.socket                   </span><br><span class="line">[root@zutuanxue ~]# systemctl disable avahi-daemon.service avahi-daemon.socket </span><br><span class="line">Removed /etc/systemd/system/multi-user.target.wants/avahi-daemon.service.</span><br><span class="line">Removed /etc/systemd/system/sockets.target.wants/avahi-daemon.socket.</span><br><span class="line">Removed /etc/systemd/system/dbus-org.freedesktop.Avahi.service.</span><br></pre></td></tr></table></figure>

<h3 id="服务设置相关文件"><a href="#服务设置相关文件" class="headerlink" title="服务设置相关文件"></a>服务设置相关文件</h3><p>我们现在知道了服务的管理是通过systemctl，而它的设置文件存放在&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;目录下，但是官方不建议我们修改这个目录下的文件，如果需要修改的话，建议我们修改&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;目录内的相关文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# yum install dhcp-server</span><br><span class="line">[root@zutuanxue ~]# systemctl enable dhcpd</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/dhcpd.service → /usr/lib/systemd/system/dhcpd.service.</span><br><span class="line">[root@zutuanxue ~]# cd /etc/systemd/system/</span><br><span class="line">[root@zutuanxue system]# ls</span><br><span class="line">在此目录中包含的文件有三种功能</span><br><span class="line">*.service  服务的设置文件</span><br><span class="line">*.wants	  此单元可选的依赖，启动指定单元后，建议启动此目录内的单元</span><br><span class="line">*.requires			此单元必要的依赖，启动指定单元前，需要启动此目录内的单元</span><br><span class="line"></span><br><span class="line">服务的设置文件</span><br><span class="line">[root@zutuanxue system]# vim /etc/systemd/system/multi-user.target.wants/dhcpd.service </span><br><span class="line"></span><br><span class="line">[Unit]		对于此单元的简介</span><br><span class="line">Description=DHCPv4 Server Daemon</span><br><span class="line">Documentation=man:dhcpd(8) man:dhcpd.conf(5)</span><br><span class="line">Wants=network-online.target	</span><br><span class="line">After=network-online.target</span><br><span class="line">After=time-sync.target</span><br><span class="line"></span><br><span class="line">Unit部分会出现的常见内容</span><br><span class="line">	Description			简介</span><br><span class="line">	Documentation		如何进一步查询相关信息</span><br><span class="line">	Wants						与当前单元配合的单元，如果这些单元没有运行，此单元不会启动失败</span><br><span class="line">	After						在哪些单元之后启动此单元</span><br><span class="line">	Befor						在哪些单元之前启动此单元</span><br><span class="line">	Requires				当前单元依赖的单元，如果这些单元没有运行，此单元启动失败</span><br><span class="line">	Conflicts				哪些单元与此单元冲突</span><br><span class="line">[Service]	这是一个服务还可能是Socket、Timer、Mount等</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/dhcpd</span><br><span class="line">ExecStart=/usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid $DHCPDARGS</span><br><span class="line">StandardError=null</span><br><span class="line"></span><br><span class="line">Service部分会出现的内容</span><br><span class="line">	Type			启动时，相关进程的行为</span><br><span class="line">			simple		默认值</span><br><span class="line">			oneshot		一次性进程，systemd会等待当前服务结束，再继续执行</span><br><span class="line">			notify		启动完毕后通知systemd</span><br><span class="line">			idle		所有其它任务执行完毕后，此服务才会运行</span><br><span class="line">	EnviromentFile	指定环境变量配置文件</span><br><span class="line">	Enviroment	指定环境变量</span><br><span class="line">	ExecStart	执行什么命令启动当前服务</span><br><span class="line">	ExecStartPre	启动当前服务之前执行什么命令</span><br><span class="line">	ExecStartPost	启动当前服务之后执行什么命令</span><br><span class="line">	ExecStop	执行什么命令停止当前服务</span><br><span class="line">	ExecStopPost	停止当前服务后执行什么命令</span><br><span class="line">	ExecReload	执行什么命令重新加载服务的配置文件</span><br><span class="line">	Restart		服务正常退出、异常退出、被杀死、超时的时候是否重启。常用值</span><br><span class="line">			no				不重启</span><br><span class="line">			always		无条件重启</span><br><span class="line">			on-failure	异常退出时重启</span><br><span class="line">	RestartSec	自动重启服务的间隔时间</span><br><span class="line">	RemainAfterExit	此服务的进程全部退出之后，是否依然将服务的状态视为active状态</span><br><span class="line">	TimeoutSec	定义服务启动或停止的超时时间</span><br><span class="line">	KillMode	服务停止时，杀死进程的方法</span><br><span class="line">	</span><br><span class="line">[Install]	将此单元放到哪一个目标（target）当中</span><br><span class="line">WantedBy=multi-user.target	此服务所在的target，当执行systemctl enabled dhcpd时，dhcpd.service的链接会放在/etc/systemd/system/multi-user.target.wants/中</span><br><span class="line"></span><br><span class="line">Install字段出现的内容</span><br><span class="line">WantedBy=multi-user.target	此服务所在的target，当执行systemctl 																			enabled dhcpd时，dhcpd.service的链接会放																	在/etc/systemd/system/multi-user.target.wants/中Also附加单元，当用户使用systemctl enable/disabled时，也自动启用或者停用附加单元</span><br><span class="line">Alias		定义别名</span><br></pre></td></tr></table></figure>

<h3 id="服务多实例"><a href="#服务多实例" class="headerlink" title="服务多实例"></a>服务多实例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue yum.repos.d]# dnf install vsftpd -y		安装一个服务</span><br><span class="line">[root@zutuanxue yum.repos.d]# systemctl start vsftpd</span><br><span class="line">[root@zutuanxue yum.repos.d]# netstat -antulp | grep vsftpd</span><br><span class="line">tcp6       0      0 :::21      :::*     LISTEN      6331/vsftpd         </span><br><span class="line">[root@zutuanxue yum.repos.d]# cd /etc/systemd/system/</span><br><span class="line">[root@zutuanxue system]# cp /usr/lib/systemd/system/vsftpd.service ./vsftpd2.service</span><br><span class="line">[root@zutuanxue system]# cd /etc/vsftpd/</span><br><span class="line">[root@zutuanxue vsftpd]# cp vsftpd.conf vsftpd2.conf</span><br><span class="line">[root@zutuanxue vsftpd]# vim vsftpd2.conf </span><br><span class="line">listen_port=2100</span><br><span class="line"></span><br><span class="line">[root@zutuanxuet vsftpd]# vim /etc/systemd/system/vsftpd2.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=the second Vsftpd ftp daemon			修改简介</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/sbin/vsftpd /etc/vsftpd/vsftpd2.conf		修改配置文件</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">[root@zutuanxue system]# systemctl list-unit-files  | grep vsftpd</span><br><span class="line">vsftpd.service                              disabled </span><br><span class="line">vsftpd2.service                             disabled </span><br><span class="line">vsftpd@zutuanxue.service                    indirect </span><br><span class="line">vsftpd.target                               disabled </span><br><span class="line">[root@zutuanxue system]# systemctl start vsftpd</span><br><span class="line">[root@zutuanxue system]# systemctl start vsftpd2</span><br><span class="line">[root@zutuanxue system]# netstat -antulp | grep vsftpd</span><br><span class="line">tcp6       0      0 :::21          :::*        LISTEN      7388/vsftpd         </span><br><span class="line">tcp6       0      0 :::2100        :::*        LISTEN      7392/vsftpd         </span><br></pre></td></tr></table></figure>

<h1 id="linux-进程管理"><a href="#linux-进程管理" class="headerlink" title="linux 进程管理"></a>linux 进程管理</h1><p> 阅读 (202762) </p>
<p> 分享</p>
<h2 id="一、进程介绍"><a href="#一、进程介绍" class="headerlink" title="一、进程介绍"></a>一、进程介绍</h2><p>在说进程如何管理之前我们要涉及到进程的一些相关概念</p>
<p><strong>什么是进程</strong>？进程（Process）是一个程序在其自身的虚拟地址空间中的一次执行活动。之所以要创建进程，就是为了使多个程序可以并发的执行，从而提高系统的资源利用率和吞吐量。简单来说进程就是一个程序的执行活动。</p>
<p><strong>进程和程序有什么不同？</strong></p>
<p>程序：只是一个静态的指令集合；而进程是一个程序的动态执行过程，它具有生命期，是动态的产生和消亡的。</p>
<p>进程：是资源申请、调度和独立运行的单位，因此，它使用系统中的运行资源；而程序不能申请系统资源、不能被系统调度、也不能作为独立运行的单位，因此，它不占用系统的运行资源。</p>
<p>程序和进程无一一对应的关系。一方面一个程序可以由多个进程所共用，即一个程序在运行过程中可以产生多个进程；另一方面，一个进程在生命期内可以顺序的执行若干个程序。</p>
<p><strong>进程的属性</strong></p>
<p> 在Linux系统中总是有很多进程同时在运行，每一个进程都有一个识别号，叫做PID（Process ID），用以区分不同的进程。</p>
<p>除了进程识别号外，每个进程还有另外四个识别号。它们是实际用户识别号（real user ID）、实际组识别号以及有效用户识别号（effect user ID），和有效组识别号（effect group ID）。实际用户识别号和实际组识别号的作用是识别正在运行此进程的用户和组。一个进程的实际用户识别号和实际组识别号就是运行此进程的用户的识别号（UID）和组的识别号（GID）。有效用户识别号和有效组识别号的作用是确定一个进程对其访问的文件的权限和优先权。一般有效用户识别号和有效组识别号和实际用户识别号及实际组识别号相同。除非程序被设置了SUID位或SGID位。</p>
<p><strong>进程间的父子关系</strong></p>
<p>进程之间是有关联性的，有的进程会衍生出额外的进程，这时，这组进程之间就存在了父子关系，衍生出来的进程叫子进程，而原本的进程叫做父进程。</p>
<h2 id="二、linux的工作调度"><a href="#二、linux的工作调度" class="headerlink" title="二、linux的工作调度"></a>二、linux的工作调度</h2><p>由于linux是一个多人多任务的操作系统，所以用户在使用linux的时候就会出现有些工作我们需要盯着完成的进度，而有些工作我们直接放在后台执行就可以了，这里面我们就涉及到任务的前后台执行的问题，那么，如何将一个任务放到后台去执行呢？</p>
<h4 id="开启一个在后台执行的工作"><a href="#开启一个在后台执行的工作" class="headerlink" title="开启一个在后台执行的工作"></a>开启一个在后台执行的工作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cd /</span><br><span class="line">[root@zutuanxue /]# tar -czf /tmp/test.tar.gz etc &amp;	（&amp;表示后台执行）</span><br><span class="line">[1] 13568				[1]工作序号；13568进程号（PID）</span><br><span class="line">[root@zutuanxue /]# ls tmp/ | grep test</span><br><span class="line">test.tar.gz</span><br><span class="line"></span><br><span class="line">执行完成后，会在下次敲回车的时候给用户一个反馈</span><br><span class="line">[1]+  已完成               tar -czpf /tmp/test.tar.gz etc</span><br></pre></td></tr></table></figure>

<h4 id="将当前的工作调到后台"><a href="#将当前的工作调到后台" class="headerlink" title="将当前的工作调到后台"></a>将当前的工作调到后台</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue /]# cd</span><br><span class="line">[root@zutuanxue ~]# ls</span><br><span class="line">公共  视频  文档  音乐  anaconda-ks.cfg</span><br><span class="line">模板  图片  下载  桌面  initial-setup-ks.cfg</span><br><span class="line">[root@zutuanxue ~]# vim anaconda-ks.cfg 		按键盘上的ctrl+z是调到后台</span><br><span class="line"></span><br><span class="line">[1]+  已停止               vim anaconda-ks.cfg		</span><br><span class="line">注意由ctrl+z调到后台的工作状态为暂停</span><br></pre></td></tr></table></figure>

<p>那么如何将后台工作的状态更改为运行？如何查看后台有哪些工作呢？</p>
<h4 id="后台工作的查看及状态的更改"><a href="#后台工作的查看及状态的更改" class="headerlink" title="后台工作的查看及状态的更改"></a>后台工作的查看及状态的更改</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# jobs					查看后台工作</span><br><span class="line">[1]-  已停止               vim anaconda-ks.cfg</span><br><span class="line">[2]+  已停止               find / -print</span><br><span class="line">[root@zutuanxue ~]# jobs -l				查看后台工作，并显示进程号</span><br><span class="line">[1]- 13663 停止                  vim anaconda-ks.cfg</span><br><span class="line">[2]+ 13732 停止                  find / -print</span><br><span class="line">[root@zutuanxue ~]# jobs -s				仅查看状态为停止的后台工作</span><br><span class="line">[1]-  已停止               vim anaconda-ks.cfg</span><br><span class="line">[2]+  已停止               find / -print</span><br><span class="line">[root@zutuanxue ~]# jobs -r				仅查看状态为运行的后台工作</span><br><span class="line"></span><br><span class="line">+：	当使用命令将后台任务调到前台时，默认调用有此标记的任务，也就是最近被调到后台的</span><br><span class="line">-：	倒数第二个被调到后台的任务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# fg %工作序号(%可省略)	将后台指定的工作调到前台</span><br><span class="line">[root@zutuanxue ~]# find / -name \*a\* &gt; /tmp/test.txt</span><br><span class="line">^Z		执行一个命令，迅速使用ctrl+z将任务调到后台</span><br><span class="line">[2]+  已停止               find / -name \*a\* &gt; /tmp/test.txt</span><br><span class="line">[root@zutuanxue ~]# bg %2;jobs 连续执行两条命令，1.使用bg命令将之前的工作状态更改为运行；2.立即使用jobs命令查看状态</span><br><span class="line">[2]+ find / -name \*a\* &gt; /tmp/test.txt &amp;</span><br><span class="line">[1]+  已停止               vim anaconda-ks.cfg</span><br><span class="line">[2]-  运行中               find / -name \*a\* &gt; /tmp/test.txt &amp;</span><br><span class="line"></span><br><span class="line">注意：更改后台工作状态和查看后台工作状态的命令也可以在终端分别输入，但是如果命令执行的较快的话可能会出现下面的这种情况，也就是状态显示为已完成</span><br><span class="line">[root@zutuanxue ~]# find / -name \*a\* &gt; /tmp/test.txt</span><br><span class="line">^Z</span><br><span class="line">[2]+  已停止               find / -name \*a\* &gt; /tmp/test.txt</span><br><span class="line">[root@zutuanxue ~]# jobs</span><br><span class="line">[1]-  已停止               vim anaconda-ks.cfg</span><br><span class="line">[2]+  已停止               find / -name \*a\* &gt; /tmp/test.txt</span><br><span class="line">[root@zutuanxue ~]# bg %2</span><br><span class="line">[2]+ find / -name \*a\* &gt; /tmp/test.txt &amp;</span><br><span class="line">[root@zutuanxue ~]# jobs</span><br><span class="line">[1]+  已停止               vim anaconda-ks.cfg</span><br><span class="line">[2]-  已完成               find / -name \*a\* &gt; /tmp/test.txt</span><br></pre></td></tr></table></figure>

<h4 id="管理后台工作"><a href="#管理后台工作" class="headerlink" title="管理后台工作"></a>管理后台工作</h4><p>我们可以通过kill命令配合适当的信号来管理后台的工作，信号是进程间通信的最原始机制，不同的信号，有不同的作用，比如说，一个进程接收到了一个让它打开指定文件的信号，那这个进程就去打开这个文件，而不会去考虑原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# kill %工作序号</span><br><span class="line">		-l				查看</span><br><span class="line">		-1				重新加载，systemctl reload servername</span><br><span class="line">		-2				保存数据并结束	ctrl+c			</span><br><span class="line">		-9				强制结束不管其状态		常用在无法正常终止的程序上</span><br><span class="line">		-15				正常结束(默认值)		systemctl stop servername</span><br><span class="line">[root@zutuanxue ~]# jobs</span><br><span class="line">[1]+  已停止               vim anaconda-ks.cfg</span><br><span class="line">[root@zutuanxue ~]# kill -9 %1</span><br><span class="line">[1]+  已停止               vim anaconda-ks.cfg</span><br><span class="line">[root@zutuanxue ~]# jobs</span><br><span class="line">[1]+  已杀死               vim anaconda-ks.cfg</span><br><span class="line">[root@zutuanxue ~]# jobs</span><br></pre></td></tr></table></figure>

<h2 id="三、进程的查看与管理"><a href="#三、进程的查看与管理" class="headerlink" title="三、进程的查看与管理"></a>三、进程的查看与管理</h2><p>在linux中，我们可以通过fg、bg、jobs、kill等来对工作进行管理和调度，这些工作都是我们手动执行的，而那些由系统开启的工作该如何管理呢？管理这些后台工作我们可以使用两种命令ps和top</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ps	  #静态进程管理命令,可以帮助我们查看到ps命令在执行那一刻后台进程的状态</span><br><span class="line">-A			所有进程，等同于-ax</span><br><span class="line">-a			显示所有进程（与终端有关的除外）</span><br><span class="line">-x			与参数a一起使用等同于-A</span><br><span class="line">-u			显示指定用户的进程</span><br><span class="line">-l			长格式</span><br><span class="line">-f			完整输出</span><br><span class="line">-t			从指定终端启动的进程</span><br><span class="line">-C			执行指定命令的进程</span><br><span class="line">[root@zutuanxue ~]# ps aux		#查看系统后台的所有进程</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.1 252828 11580 ?        Ss   10月23   0:04 /us...</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    10月23   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        I&lt;   10月23   0:00 [rcu_gp]</span><br><span class="line">root          4  0.0  0.0      0     0 ?        I&lt;   10月23   0:00 [rcu_par_gp]</span><br><span class="line">root          6  0.0  0.0      0     0 ?        I&lt;   10月23   0:00 [kworker/0:0H-kblockd]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        I&lt;   10月23   0:00 [mm_percpu_wq]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        S    10月23   0:00 [ksoftirqd/0]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">USER			开启进程的用户</span><br><span class="line">PID				进程的识别号</span><br><span class="line">%CPU			进程的cpu占用率</span><br><span class="line">%MEM			进程的物理内存占用率</span><br><span class="line">VSZ				虚拟内存用量，单位Kbytes</span><br><span class="line">RSS				物理内存占用量	Kbytes</span><br><span class="line">TTY				那个终端开启的</span><br><span class="line">STAT			进程的状态</span><br><span class="line">START			开启时间</span><br><span class="line">TIME			CPU占用时间</span><br><span class="line">COMMAND			执行具体内容</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ps -l		查看当前用户开启的进程</span><br><span class="line">F S  UID    PID  PPID  C PRI  NI ADDR SZ WCHAN  	TTY    TIME 	CMD</span><br><span class="line">0 S   0   5191   5189  0  80   0 	-  6994 -      pts/1 00:00:02 bash</span><br><span class="line">0 R   0  14972   5191  0  80   0 	- 11240 -      pts/1 00:00:00 ps</span><br><span class="line"></span><br><span class="line">F	进程标识	4=权限为root		1=从父进程派生出来但是没有执行	5=1+4		0=没有被设置</span><br><span class="line">S	进程状态	R=运行	S=睡眠，可被唤醒	D=睡眠，不可被唤醒（资源不足引起）T=停止</span><br><span class="line">				 	 Z=僵尸进程</span><br><span class="line">UID	用户识别号</span><br><span class="line">PID	进程识别号</span><br><span class="line">PPID	父进程号</span><br><span class="line">C			cpu使用率 %</span><br><span class="line">PRI		内核调度优先级</span><br><span class="line">NI		用户设置优先级</span><br><span class="line">ADDR	加载到内存的位置，如果是运行的会用-表示</span><br><span class="line">SZ		用掉的内存页的大小，1个内存页=4096Bytes 也就是6994x4=27976K内存</span><br><span class="line">WCHAN	当前进程在哪个内核函数上睡眠，-表示正在运行，没有睡眠</span><br><span class="line">TTY		由哪个终端开启的	pts/n=图形界面或远程		ttyn=字符界面		?=系统进程</span><br><span class="line">TIME	用掉的CPU时间</span><br><span class="line">CMD		执行的命令</span><br></pre></td></tr></table></figure>

<p>ps只能显示它运行的那一刻的进程的统计信息，如果你想动态的查看就需要使用top</p>
<p>top动态查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# top</span><br><span class="line">-d			指定两次刷新的时间间隔,默认是3秒</span><br><span class="line">-p			后面跟进程号，查看指定进程的状态,最多20个PID</span><br><span class="line">-n			刷新指定次数后退出</span><br><span class="line">-b			批量模式，可以让top将内容输出到指定的位置</span><br><span class="line">top的按键</span><br><span class="line">?				显示帮助</span><br><span class="line">空格&amp;enter			   刷新</span><br><span class="line">E				切换统计信息部分，内存显示的单位</span><br><span class="line">e				切换任务列表的内存显示的单位</span><br><span class="line">l				显示或隐藏摘要信息中的负载统计(第一行内容)</span><br><span class="line">t				切换显示或隐藏摘要信息中任务和CPU统计信息(第2，3行内容)</span><br><span class="line">m				切换显示或隐藏摘要信息中内存统计(第4，5行内容)</span><br><span class="line">u				查看指定用户的进程</span><br><span class="line">M				根据内存排序</span><br><span class="line">P				根据cpu排序</span><br><span class="line">N				根据PID排序</span><br><span class="line">R				反向排序</span><br><span class="line">F/f			调整任务列表显示的内容，默认只有PID，USER，PR，NI....COMMAND等这些，可				以自定义还需要显示哪些内容，如果显示的列比较多可以使用&lt;/&gt;进行左右移动</span><br><span class="line">shift+&lt;/&gt;按照下一列的内容排序，比如说当前按照PID排序如果按下shift+&gt;，则按照用户名					排序，再次按下就会按照PR排序，一次类推 </span><br><span class="line">T				根据cpu使用时间排序</span><br><span class="line">k				杀死进程</span><br><span class="line">r				修改进程的nice值（优先级）</span><br><span class="line">z				将不同的位置标记颜色</span><br><span class="line">x				高亮显示排序字段</span><br><span class="line">y				高亮显示正在运行的任务</span><br><span class="line">b				将高亮显示部分加上背景色</span><br><span class="line">Z				自定义颜色</span><br><span class="line">L				搜索指定字段，&amp;下一个</span><br><span class="line">H				在进程和线程间切换显示和统计方式，默认为进程</span><br><span class="line">V				树形显示统计信息</span><br><span class="line">J				显示内容左对齐或右对齐</span><br><span class="line">c				切换COMMAND列的显示形式，程序名/命令格式</span><br><span class="line">i				显示或隐藏空闲进程</span><br><span class="line">u/U			查看指定用户的进程</span><br><span class="line">d				设置刷新间隔,默认3秒刷新一次</span><br><span class="line">W				将当前的设置写入到~/.config/procps/toprc中</span><br><span class="line">q				退出top</span><br><span class="line">[root@zutuanxue ~]# top -d 1</span><br><span class="line">1 top - 18:57:05 up 12:56,  3 users,  load average: 0.00, 0.00, 0.00</span><br><span class="line">2 Tasks: 280 total,   1 running, 279 sleeping,   0 stopped,   0 zombie</span><br><span class="line">3 %Cpu(s): 1.5 us,1.5 sy,0.0 ni,97.0 id,0.0 wa,0.0 hi,0.0 si,0.0 st</span><br><span class="line">4 MiB Mem : 3918.6 total, 160.1 free, 1264.5 used, 2494.0 buff/cache</span><br><span class="line">5 MiB Swap: 2048.0 total, 2048.0 free, 0.0 used. 2356.6 avail Mem </span><br><span class="line">6</span><br><span class="line">7PID USER  PR  NI VIRT    RES    SHR  S  %CPU  %MEM   TIME+  COMMAND  </span><br><span class="line"> 1   root  20  0  244408  13740  9100 S  0.0   0.3   0:08.77 systemd</span><br><span class="line"> 2   root  20  0  0       0      0    S  0.0   0.0   0:00.04 kthreadd  3   root  0  -20 0       0      0    I  0.0   0.0   0:00.00 rcu_gp    4   root  0  -20 0       0      0    I  0.0   0.0   0:00.00 cu_par_gp </span><br><span class="line"></span><br><span class="line">1-6行显示的内容为</span><br><span class="line">1	当前时间为18：57：05；系统一共开机12小时56分；当前有3个用户登录；系统在1，5，15分钟的平均负载，越小表示系统越空闲</span><br><span class="line"></span><br><span class="line">2	系统中进程的统计信息 总计280个，1个运行，279睡眠，0个停止，0个僵尸</span><br><span class="line"></span><br><span class="line">3	cpu的负载	按键盘上的“1”可以按照CPU核心数显示</span><br><span class="line">			us: 用户空间进程占用CPU时间百分比</span><br><span class="line">			sy:	内核进程占用CPU时间百分比</span><br><span class="line">			ni:	用户空间内改变过优先级的进程占用CPU时间百分比</span><br><span class="line">			id:	空闲CPU时间百分比(100%表示系统完全空闲)</span><br><span class="line">			wa: I/O等待占用的CPU时间百分比</span><br><span class="line">			hi: 硬件中断占用CPU时间百分比</span><br><span class="line">			si:	软件中断占用CPU时间百分比</span><br><span class="line">			st:	虚拟化hypervisor从当前虚拟机偷走的时间（如果这个值很高的话,说明你的提					供商的CPU资源有限,而你没能抢过别人,很有可能就是VPS提供商超售了.）</span><br><span class="line">4&amp;5	物理内存和虚拟内存相关的统计信息，尤其要注意swap，如果被大量占用，说明你物理内			存不足了</span><br><span class="line">6	在top中输入命令时，会显示在这里</span><br><span class="line">7	系统进程的信息</span><br><span class="line">	PID:	进程ID </span><br><span class="line">	USER  	进程所有者</span><br><span class="line">	PR  	进程优先级</span><br><span class="line">	NI 	nice值，负数表示高优先级，正数表示低优先级</span><br><span class="line">	VIRT    虚拟内存使用量，单位为KB。</span><br><span class="line">	RES    进程使用的、未被换出的物理内存大小，单位为KB。</span><br><span class="line">	SHR  	进程使用共享内存大小，单位为KB。</span><br><span class="line">	S  	进程状态</span><br><span class="line">	%CPU  	进程对CPU的使用率。</span><br><span class="line">	%MEM   进程对内存的使用率</span><br><span class="line">	TIME+  进程使用CPU时间总结，单位秒。</span><br><span class="line">	COMMAND	命令</span><br><span class="line">		</span><br><span class="line">top显示的内容有些看不到怎么办？</span><br><span class="line">[root@zutuanxue ~]# top -b -n1 &gt; /tmp/top.txt</span><br><span class="line">有些时候想查看的进程资源占用很低，在top中显示的比较靠后，怎么办？</span><br><span class="line">[root@zutuanxue ~]# top -d 2 -p 3562</span><br><span class="line">Tasks:   1 total,   0 running,   1 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  2.2 us,  3.9 sy,  0.0 ni, 93.3 id,  0.0 wa,  0.5 hi,  0.1 si,  0.0 st</span><br><span class="line">MiB Mem : 3918.6 total, 1495.1 free, 1407.0 used, 1016.5 buff/cache</span><br><span class="line">MiB Swap: 2048.0 total, 2048.0 free, 0.0 used.   2258.4 avail Mem </span><br><span class="line"></span><br><span class="line">PID USER   PR  NI   VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND  </span><br><span class="line">3562 root  20   0   49296   6380   4448 S   0.0   0.2   0:00.08 bash</span><br></pre></td></tr></table></figure>

<p>上面所提到的两个查看系统进程的命令，静态的ps和动态的top，他们所显示的内容比较多，有的时候我只想查看一下进程之间的关系，这个时候我可以使用另外的一条命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# pstree</span><br><span class="line">	A				进程之间使用ASCII字符连接</span><br><span class="line">	U				进程之间使用UTF-8编码连接</span><br><span class="line">	p				显示进程号</span><br><span class="line">	u				显示用户</span><br><span class="line">[root@zutuanxue ~]# pstree -A | more</span><br><span class="line">systemd-+-ModemManager---2*[&#123;ModemManager&#125;]</span><br><span class="line">        |-NetworkManager---2*[&#123;NetworkManager&#125;]</span><br><span class="line">        |-VGAuthService</span><br><span class="line">        |-accounts-daemon---2*[&#123;accounts-daemon&#125;]</span><br><span class="line">        |-alsactl</span><br><span class="line">        |-atd</span><br><span class="line">        |-auditd-+-sedispatch</span><br><span class="line">        |        `-2*[&#123;auditd&#125;]</span><br><span class="line">[root@zutuanxue ~]# pstree -U | more</span><br><span class="line">systemd─┬─ModemManager───2*[&#123;ModemManager&#125;]</span><br><span class="line">        ├─NetworkManager───2*[&#123;NetworkManager&#125;]</span><br><span class="line">        ├─VGAuthService</span><br><span class="line">        ├─accounts-daemon───2*[&#123;accounts-daemon&#125;]</span><br><span class="line">        ├─alsactl</span><br><span class="line">        ├─atd</span><br><span class="line">        ├─auditd─┬─sedispatch</span><br><span class="line">        │        └─2*[&#123;auditd&#125;]</span><br><span class="line">[root@zutuanxue ~]# pstree -pu | more</span><br><span class="line">systemd(1)-+-ModemManager(916)-+-&#123;ModemManager&#125;(943)</span><br><span class="line">           |                   `-&#123;ModemManager&#125;(949)</span><br><span class="line">           |-NetworkManager(1040)-+-&#123;NetworkManager&#125;(1050)</span><br><span class="line">           |                      `-&#123;NetworkManager&#125;(1053)</span><br><span class="line">           |-VGAuthService(902)</span><br><span class="line">           |-accounts-daemon(1010)-+-&#123;accounts-daemon&#125;(1013)</span><br><span class="line">           |                       `-&#123;accounts-daemon&#125;(1015)</span><br><span class="line">           |-alsactl(909)</span><br><span class="line">           |-atd(1076)</span><br><span class="line">           |-auditd(862)-+-sedispatch(864)</span><br><span class="line">           |             |-&#123;auditd&#125;(863)</span><br><span class="line">           |             `-&#123;auditd&#125;(865)</span><br><span class="line">           |-avahi-daemon(910,avahi)---avahi-daemon(953)</span><br></pre></td></tr></table></figure>

<p>我们现在可以通过三种方法来查看后台的进程，那么后台的进程该如何管理呢？管理后台的进程，除了我们前面提到的kill命令之外还可以使用killall</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# kill PID</span><br><span class="line">需要注意的是，kill后面如果加的是%num代表杀死后台指定序号的工作，如果不加%代表的是杀死指定进程号的进程，这两个是有区别的</span><br><span class="line">[root@zutuanxue ~]# killall</span><br><span class="line">	e		精确匹配，最多不能超过15个字符</span><br><span class="line">	i		询问用户是否杀死指定名称的进程</span><br><span class="line">	I		进程的名称忽略大小写</span><br><span class="line">[root@zutuanxue ~]# cat /dev/zero &gt; /dev/null &amp;</span><br><span class="line">[1] 102245</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12324 -      pts/1    00:00:00 bash</span><br><span class="line">0 R     0 102245   3562 97  80   0 -  1908 -      pts/1    00:00:01 cat</span><br><span class="line">0 R     0 102246   3562  0  80   0 - 11240 -      pts/1    00:00:00 ps</span><br><span class="line">[root@zutuanxue ~]# killall -ei cat</span><br><span class="line">杀死 cat(102870) ? (y/N) y</span><br><span class="line">[1]+  已终止               cat /dev/zero &gt; /dev/null</span><br></pre></td></tr></table></figure>

<h2 id="四、进程的优先级"><a href="#四、进程的优先级" class="headerlink" title="四、进程的优先级"></a>四、进程的优先级</h2><p>之前我们在查看进程的时候看到两个东西，一个是PRI一个是NI，这两个东西是用来控制进程的优先级，而优先级又决定了CPU先处理谁的数据，后处理谁的数据。一起来看下如何调整进程的优先级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY     TIME 		CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1  00:00:00 bash</span><br><span class="line">0 R     0  85520   3562  0  80   0 - 11240 -      pts/1  00:00:00 ps</span><br></pre></td></tr></table></figure>

<p>linux当中的每一个程序都有一个优先级，也就是PRI，这个数值越小则代表优先级越高，而PRI这个值是由内核控制的，用户无法更改，用户如果想调整程序的优先级就只能调整NI的值，所以linux中优先级的算法就是 新的优先级&#x3D;旧的优先级+NI的值，比如说我bash那个进程，PRI是80，并且假定内核不会动态调整这个值，如果我将NI值更改为-10的话，那么新的PRI的值就是70，数值变小，意味着这个进程的优先级提高了。但是如果内核在这个过程中动态调整了，最终的值就不确定了。</p>
<p>这个NI的值都可以设置成多少呢？</p>
<p>root用户：-20~19</p>
<p>普通用户：0~19</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nice 	指定新执行的进程的优先级</span><br><span class="line">	-n 	指定优先级</span><br><span class="line">[root@zutuanxue ~]# vim 1&amp;</span><br><span class="line">[1] 108831</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY    TIME 		CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1  00:00:00 bash</span><br><span class="line">0 T     0 108831   3562  0  80   0 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 R     0 108832   3562  0  80   0 - 11240 -      pts/1  00:00:00 ps</span><br><span class="line"></span><br><span class="line">[1]+  已停止               vim 1</span><br><span class="line">[root@zutuanxue ~]# nice -n 10 vim 2&amp;</span><br><span class="line">[2] 109328</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY    TIME 		CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1  00:00:00 bash</span><br><span class="line">0 T     0 108831   3562  0  80   0 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 T     0 109328   3562  0  90  10 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 R     0 109396   3562  0  80   0 - 11240 -      pts/1  00:00:00 ps</span><br><span class="line"></span><br><span class="line">[2]+  已停止               nice -n 10 vim 2</span><br><span class="line">[root@zutuanxue ~]# nice -n -20 vim 3 &amp;</span><br><span class="line">[3] 109470</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY    TIME 		CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1  00:00:00 bash</span><br><span class="line">0 T     0 108831   3562  0  80   0 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 T     0 109328   3562  0  90  10 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">4 T     0 109470   3562  0  60 -20 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 R     0 109471   3562  0  80   0 - 11240 -      pts/1  00:00:00 ps</span><br><span class="line"></span><br><span class="line">[3]+  已停止               nice -n -20 vim 3</span><br><span class="line"></span><br><span class="line">那如何调整一个已经启动的进程的优先级呢？</span><br><span class="line">[root@zutuanxue ~]# vim 1 &amp;</span><br><span class="line">[1] 115098</span><br><span class="line">[root@zutuanxue ~]# vim 2 &amp;</span><br><span class="line">[2] 115099</span><br><span class="line"></span><br><span class="line">[1]+  已停止               vim 1</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1    00:00:00 bash</span><br><span class="line">0 T     0 115098   3562  0  80   0 -  9058 -      pts/1    00:00:00 vim</span><br><span class="line">0 T     0 115099   3562  0  80   0 -  9058 -      pts/1    00:00:00 vim</span><br><span class="line">0 R     0 115100   3562  0  80   0 - 11240 -      pts/1    00:00:00 ps</span><br><span class="line"></span><br><span class="line">[2]+  已停止               vim 2</span><br><span class="line">[root@zutuanxue ~]# renice 10 115098</span><br><span class="line">115098 (process ID) 旧优先级为 0，新优先级为 10</span><br><span class="line">[root@zutuanxue ~]# renice -10 115099</span><br><span class="line">115099 (process ID) 旧优先级为 0，新优先级为 -10</span><br><span class="line">[root@zutuanxue ~]# ps -l</span><br><span class="line">F S   UID    PID   PPID  C PRI  NI ADDR SZ WCHAN  TTY    TIME 		CMD</span><br><span class="line">0 S     0   3562   3559  0  80   0 - 12522 -      pts/1  00:00:00 bash</span><br><span class="line">0 T     0 115098   3562  0  90  10 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 T     0 115099   3562  0  70 -10 -  9058 -      pts/1  00:00:00 vim</span><br><span class="line">0 R     0 115736   3562  0  80   0 - 11240 -      pts/1  00:00:00 ps </span><br></pre></td></tr></table></figure>

<h1 id="linux-网络管理"><a href="#linux-网络管理" class="headerlink" title="linux 网络管理"></a>linux 网络管理</h1><p> 阅读 (203386) </p>
<p> 分享</p>
<p>现代人的生活越来越依赖网络，对于一个操作系统来讲，网络功能的支持和管理就更为重要了，本节课我们一起来看一下在CentOS8中如何对网络进行管理</p>
<h2 id="NetworkManager和常用工具和基本用法"><a href="#NetworkManager和常用工具和基本用法" class="headerlink" title="NetworkManager和常用工具和基本用法"></a>NetworkManager和常用工具和基本用法</h2><h3 id="NetworkManager介绍"><a href="#NetworkManager介绍" class="headerlink" title="NetworkManager介绍"></a>NetworkManager介绍</h3><p>在linux系统中传统的网络管理方法是用过一个叫network的服务来实现，在CentOS7中依然有这个服务的身影，但是到了CentOS8中已经不使用network这个服务了，而是使用了一个叫NetworkManager的服务，这个服务可以简化我们管理有线和无线连接的工作，除此之外它还能管理不同类型的网络，包括物理网卡，虚拟网卡，以太网，非以太网等</p>
<h4 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h4><ul>
<li>nmcli：命令行工具</li>
<li>nmtui：文本图形界面工具</li>
<li>cockpit：基于web的管理工具</li>
</ul>
<h4 id="nmcli基本用法"><a href="#nmcli基本用法" class="headerlink" title="nmcli基本用法"></a>nmcli基本用法</h4><p>nmcli命令的用法类似linux中以前的ip命令，而且支持tab补全，另外也可以使用-h或者–help获取帮助</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli -h</span><br><span class="line">[root@zutuanxue ~]# nmcli connection -h</span><br><span class="line">可以看到，在不同的阶段获取到的帮助内容是不一样的，具体的用法我们后面会看到</span><br><span class="line"></span><br><span class="line">nmcli这个工具有两个常用的命令</span><br><span class="line">nmcli connection（nmcli c）	与连接相关的操作</span><br><span class="line">[root@zutuanxue network-scripts]# nmcli connection </span><br><span class="line">NAME   UUID                                  TYPE      DEVICE</span><br><span class="line">连接名	 设备的UUID（通用唯一识别码）							设备类型		设备名称</span><br><span class="line">ens33  b5ecf570-543c-4da7-b082-bdc073b56acb  ethernet  ens33  </span><br><span class="line">ens37  077945cb-1d12-4c06-bba3-562426336b67  ethernet  -- </span><br><span class="line">在查看时，有颜色的字体标注的是处于活跃状态的网卡，也就是连接的，正常颜色字体标记的是非活跃状态的网卡，也就是未连接的，未连接的不生效</span><br><span class="line">nmcli device	（nmcli d）		与设备相关的操作</span><br><span class="line">[root@zutuanxue network-scripts]# nmcli device </span><br><span class="line">DEVICE  TYPE      STATE   CONNECTION </span><br><span class="line">设备名		设备类型	 设备状态	 连接名称</span><br><span class="line">ens33   ethernet  已连接  ens33      </span><br><span class="line">ens37   ethernet  已断开  --         </span><br><span class="line">lo      loopback  未托管  -- </span><br><span class="line"></span><br><span class="line">在日常使用中这两个命令相互配合，通过nmcli device可以查看到有哪些网络设备是被NetworkManager托管，通过nmcli connection控制网络设备的连接状态</span><br></pre></td></tr></table></figure>

<h3 id="使用nmcli命令设置网卡信息"><a href="#使用nmcli命令设置网卡信息" class="headerlink" title="使用nmcli命令设置网卡信息"></a>使用nmcli命令设置网卡信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">查看网卡信息</span><br><span class="line">[root@zutuanxue ~]# nmcli </span><br><span class="line">ens33: 已连接 to ens33	#设备状态和名称</span><br><span class="line">  &quot;Intel 82545EM&quot;	#设备型号</span><br><span class="line">  ethernet (e1000), 00:0C:29:11:47:97, 硬件, mtu 1500</span><br><span class="line">  ip4 默认</span><br><span class="line">  inet4 192.168.1.55/24</span><br><span class="line">  route4 0.0.0.0/0</span><br><span class="line">  route4 192.168.1.0/24</span><br><span class="line">  inet6 fe80::ea62:91c6:114:18bb/64</span><br><span class="line">  route6 fe80::/64</span><br><span class="line">  route6 ff00::/8</span><br><span class="line"></span><br><span class="line">为网卡设置静态IP</span><br><span class="line">[root@zutuanxue ~]# nmcli connection add type ethernet con-name ens-test1 ifname ens37 ipv4.addresses 192.168.18.100/24 ipv4.gateway 192.168.18.1 ipv4.method manual </span><br><span class="line">连接 &quot;ens-test1&quot; (da7fdc9a-e7cc-4a1c-8b2c-7751ed2fc4d2) 已成功添加。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启用新添加的连接</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens-test1 </span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/16） </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看连接状态</span><br><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME       UUID            TYPE      DEVICE </span><br><span class="line">ens33      b5ecf5...		  ethernet  ens33  </span><br><span class="line">ens-test1  da7fdc...		  ethernet  ens37  </span><br><span class="line">ens37      077945...		  ethernet  --     </span><br><span class="line"></span><br><span class="line">为网卡设置动态IP</span><br><span class="line">[root@zutuanxue ~]# nmcli connection add type ethernet con-name ens-test2 ifname ens37 ipv4.method auto</span><br><span class="line">连接 &quot;ens-test2&quot; (25b9dd2f-a4c0-452d-bd22-992cf12b55b2) 已成功添加。</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens-test2 </span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/17）</span><br><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME       UUID              TYPE      DEVICE </span><br><span class="line">ens33      b5ec...					 ethernet  ens33  </span><br><span class="line">ens-test2  25b9...					 ethernet  ens37  </span><br><span class="line">ens37      0779...					 ethernet  --     </span><br><span class="line">ens-test1  da7f...					 ethernet  --     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">交互式设置IP地址</span><br><span class="line">[root@zutuanxue ~]# nmcli connection edit ens-test1 </span><br><span class="line">nmcli&gt; goto ipv4.addresses </span><br><span class="line">nmcli ipv4.addresses&gt; change</span><br><span class="line">编辑 &quot;addresses&quot; 值：192.168.20.100/24</span><br><span class="line">您是否也要将 &quot;ipv4.method&quot; 设为 &quot;manual&quot;？[yes]：yes</span><br><span class="line">nmcli ipv4.addresses&gt; back</span><br><span class="line">nmcli ipv4&gt; save</span><br><span class="line">成功地更新了连接 &quot;ens-test1&quot; (da7fdc9a-e7cc-4a1c-8b2c-7751ed2fc4d2)。</span><br><span class="line">nmcli ipv4&gt; activate </span><br><span class="line">正在监视连接激活（按任意键继续）</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/18）</span><br><span class="line"></span><br><span class="line">nmcli ipv4&gt; quit</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli </span><br><span class="line">ens37: 已连接 to ens-test1</span><br><span class="line">  &quot;Intel 82545EM&quot;</span><br><span class="line">  ethernet (e1000), 00:0C:29:11:47:A1, 硬件, mtu 1500</span><br><span class="line">  ip4 默认</span><br><span class="line">  inet4 192.168.20.100/24</span><br><span class="line">  route4 192.168.20.0/24</span><br><span class="line">  route4 192.168.18.1/32</span><br><span class="line">  route4 0.0.0.0/0</span><br><span class="line">  inet6 fe80::11c3:e0a4:f62e:9f31/64</span><br><span class="line">  route6 fe80::/64</span><br><span class="line">  route6 ff00::/8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启用和停用</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens-test1 </span><br><span class="line">连接已成功激活（D-Bus 活动路径：...</span><br><span class="line">[root@zutuanxue ~]# nmcli connection down ens-test1 </span><br><span class="line">成功停用连接 &quot;ens-test1&quot;（D-Bus 活动路...</span><br><span class="line"></span><br><span class="line">删除连接</span><br><span class="line">[root@zutuanxue ~]# nmcli connection delete ens-test1 </span><br><span class="line">成功删除连接 &quot;ens-test1&quot; (4fc43f65-ea53-43a1-85d4-692e425fcd7d)。</span><br><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME   UUID     TYPE      DEVICE </span><br><span class="line">ens33  b5ec...	ethernet  ens33  </span><br><span class="line">ens37  0779...	ethernet  ens37  </span><br><span class="line">[root@zutuanxue ~]# nmcli connection show</span><br><span class="line">NAME   UUID     TYPE      DEVICE </span><br><span class="line">ens33  b5ec...  ethernet  ens33  </span><br><span class="line">ens37  0779...  ethernet  ens37  </span><br><span class="line"></span><br><span class="line">重新加载设置(不会立即生效)</span><br><span class="line">[root@zutuanxue ~]# nmcli connection reload</span><br><span class="line"></span><br><span class="line">重新加载指定的设置(不会立即生效)</span><br><span class="line">[root@zutuanxue ~]# nmcli connection load /etc/sysconfig/network-scripts/ifcfg-ens37</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">生效方法</span><br><span class="line">			</span><br><span class="line">启用设备</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up  ens37</span><br><span class="line">连接已成功激活（D-Bus 活动路径...</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">连接设备并更新设备</span><br><span class="line">[root@zutuanxue ~]# nmcli device connect ens37			</span><br><span class="line">[root@zutuanxue ~]# nmcli device reapply ens37</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看设备&amp;查看设备的详细信息</span><br><span class="line">[root@zutuanxue ~]# nmcli device </span><br><span class="line">DEVICE  TYPE      STATE   CONNECTION </span><br><span class="line">ens37   ethernet  已连接  ens37      </span><br><span class="line">ens33   ethernet  已连接  ens33      </span><br><span class="line">lo      loopback  未托管  --         </span><br><span class="line">[root@zutuanxue ~]# nmcli device show ens33</span><br><span class="line">GENERAL.DEVICE:                         ens33</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         00:0C:29:11:47:97</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.STATE:                          100（已连接）</span><br><span class="line">GENERAL.CONNECTION:                     ens33</span><br><span class="line">GENERAL.CON-PATH:         /org/freedesktop/NetworkMana...</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               开</span><br><span class="line">IP4.ADDRESS[1]:                         192.168.1.55/24</span><br><span class="line">IP4.GATEWAY:                            --</span><br><span class="line">IP4.ROUTE[1]:           dst = 192.168.1.0/24, nh = 0.0.0.0, mt = 102</span><br><span class="line">IP4.DNS[1]:             202.106.0.20</span><br><span class="line">IP4.DNS[2]:             114.114.114.114</span><br><span class="line">IP6.ADDRESS[1]:         fe80::ea62:91c6:114:18bb/64</span><br><span class="line">IP6.GATEWAY:            --</span><br><span class="line">IP6.ROUTE[1]:           dst = fe80::/64, nh = ::, mt = 102</span><br><span class="line">IP6.ROUTE[2]:           dst = ff00::/8, nh = ::, mt = 256, table=255</span><br><span class="line"></span><br><span class="line">连接/断开网卡</span><br><span class="line">[root@zutuanxue ~]# nmcli device connect/disconnect ens37</span><br><span class="line"></span><br><span class="line">开启/关闭无线网络</span><br><span class="line">[root@zutuanxue ~]# nmcli radio all on/off</span><br><span class="line"></span><br><span class="line">开启/关闭NetworkManager的网络管理功能</span><br><span class="line">[root@zutuanxue ~]# nmcli networking on/off</span><br><span class="line"></span><br><span class="line">监控网络状态</span><br><span class="line">[root@zutuanxue ~]# nmcli monitor (ctrl+c结束)</span><br><span class="line">ens37: 停用中</span><br><span class="line">网络管理器现在处于 &quot;已连接（仅本地）&quot; 状态</span><br><span class="line">连接性现在是 &quot;受限&quot;</span><br><span class="line">ens37: 已断开</span><br><span class="line"></span><br><span class="line">询问NetworkManager网络连接状态(默认等待30秒)</span><br><span class="line">[root@zutuanxue ~]# nm-online </span><br><span class="line">正在连接...............   30s [online]</span><br></pre></td></tr></table></figure>

<h3 id="使用其他网络管理方式配置网络"><a href="#使用其他网络管理方式配置网络" class="headerlink" title="使用其他网络管理方式配置网络"></a>使用其他网络管理方式配置网络</h3><ul>
<li>nmtui</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmtui</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602407640250.png" alt="image20191128171950048.png"></p>
<ul>
<li>cockpit</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# rpm -qa | grep cockpit</span><br><span class="line">cockpit-packagekit-184.1-1.el8.noarch</span><br><span class="line">cockpit-system-185-2.el8.noarch</span><br><span class="line">cockpit-185-2.el8.x86_64</span><br><span class="line">cockpit-bridge-185-2.el8.x86_64</span><br><span class="line">cockpit-ws-185-2.el8.x86_64</span><br><span class="line">cockpit-storaged-184.1-1.el8.noarch</span><br><span class="line">[root@zutuanxue ~]# systemctl start cockpit</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602407654490.png" alt="image20191128172456779.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602407665857.png" alt="image20191128172540728.png"></p>
<h1 id="linux-nmcli命令详解"><a href="#linux-nmcli命令详解" class="headerlink" title="linux nmcli命令详解"></a>linux nmcli命令详解</h1><p> 阅读 (280220) </p>
<p> 分享</p>
<h2 id="nmcli-connection及常用选项"><a href="#nmcli-connection及常用选项" class="headerlink" title="nmcli connection及常用选项"></a>nmcli connection及常用选项</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">add		添加</span><br><span class="line">delete 		删除</span><br><span class="line">edit   		编辑</span><br><span class="line">help   		帮助</span><br><span class="line">load   		加载</span><br><span class="line">monitor  	监控</span><br><span class="line">show     	查看</span><br><span class="line">clone  		克隆</span><br><span class="line">down		停用</span><br><span class="line">modify 		修改</span><br><span class="line">reload		重载</span><br><span class="line">up    		启用</span><br><span class="line">		</span><br><span class="line">[root@zutuanxue ~]# nmcli connection modify ens37 ipv4.addresses 192.168.18.100/24 ipv4.gateway 192.168.18.1 ipv4.method manual autoconnect yes</span><br><span class="line">[root@zutuanxue ~]# nmcli connection down ens37</span><br><span class="line">成功停用连接 &quot;ens37&quot;（D-Bus 活动路径：...</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens37</span><br><span class="line">连接已成功激活（D-Bus 活动路径：...</span><br><span class="line">[root@zutuanxue ~]# nmcli </span><br><span class="line">ens37: 已连接 to ens37</span><br><span class="line">        &quot;Intel 82545EM&quot;</span><br><span class="line">        ethernet (e1000), 00:0C:29:11:47:A1, 硬件, mtu 1500</span><br><span class="line">        ip4 默认</span><br><span class="line">        inet4 192.168.18.100/24</span><br><span class="line">        route4 192.168.18.0/24</span><br><span class="line">        route4 0.0.0.0/0</span><br><span class="line">        inet6 fe80::4283:ec57:8781:deff/64</span><br><span class="line">        route6 fe80::/64</span><br><span class="line">        route6 ff00::/8</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli connection clone ens37 ens-test1</span><br><span class="line">ens37 (077945cb-1d12-4c06-bba3-562426336b67) 已克隆为 ens-test1 (ab1cc22a-21b5-4059-9b3e-b9d14b1084fe)。</span><br><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME       UUID 				TYPE      DEVICE </span><br><span class="line">ens33      b5ecf...			ethernet  ens33  </span><br><span class="line">ens37      07794...			ethernet  ens37  </span><br><span class="line">ens-test1  ab1cc...			ethernet  --  </span><br><span class="line"></span><br><span class="line">！！！！		此命令在使用时，可以加设备名称，UUID，配置文件</span><br><span class="line">如</span><br><span class="line">[root@zutuanxue ~]# nmcli connection down ens37</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens37</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli connection down 077945cb-1d12-4c06-bba3-562426336b67 </span><br><span class="line">[root@zutuanxue ~]# nmcli connection up 077945cb-1d12-4c06-bba3-562426336b67 </span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli connection down /etc/sysconfig/network-scripts/ifcfg-ens37 </span><br><span class="line">[root@zutuanxue ~]# nmcli connection up /etc/sysconfig/network-scripts/ifcfg-ens37 </span><br><span class="line"></span><br><span class="line">这三种方式都可以，其中最后一种是网卡配置文件存放的位置，都会以ifcfg-开头，后面加上设备名</span><br></pre></td></tr></table></figure>

<h2 id="nmcli-device及常用选项"><a href="#nmcli-device及常用选项" class="headerlink" title="nmcli device及常用选项"></a>nmcli device及常用选项</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli device </span><br><span class="line">connect     		连接</span><br><span class="line">disconnect  		断开</span><br><span class="line">lldp        		显示通过lldp协议学习到的相邻设备信息</span><br><span class="line">monitor     		监控设备</span><br><span class="line">set         		设置设备</span><br><span class="line">status      		显示设备状态</span><br><span class="line">delete      		删除设备 只能删除软件设备</span><br><span class="line">help        		帮助</span><br><span class="line">modify      		修改</span><br><span class="line">reapply     		更新</span><br><span class="line">show        		查看详细信息</span><br><span class="line">wifi        		无线网络管理</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">[root@zutuanxue ~]# nmcli device modify ens37 +ipv4.addresses 192.168.20.100/24</span><br><span class="line">成功重新应用连接到设备 &quot;ens37&quot;。</span><br><span class="line">[root@zutuanxue ~]# nmcli </span><br><span class="line">ens37: 已连接 to ens37</span><br><span class="line">  &quot;Intel 82545EM&quot;</span><br><span class="line">  ethernet (e1000), 00:0C:29:11:47:A1, 硬件, mtu 1500</span><br><span class="line">  ip4 默认</span><br><span class="line">  inet4 192.168.20.100/24</span><br><span class="line">  inet4 192.168.17.131/24</span><br><span class="line">  route4 0.0.0.0/0</span><br><span class="line">  route4 192.168.17.0/24</span><br><span class="line">  route4 192.168.20.0/24</span><br><span class="line">  inet6 fe80::f91c:608a:8381:2cb4/64</span><br><span class="line">  route6 fe80::/64</span><br></pre></td></tr></table></figure>

<h2 id="nmcli的其他常用设置"><a href="#nmcli的其他常用设置" class="headerlink" title="nmcli的其他常用设置"></a>nmcli的其他常用设置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli </span><br><span class="line">-t		简洁输出	与-p冲突</span><br><span class="line">-p		人性化输出 与-t冲突</span><br><span class="line">-c		颜色开关 auto/on/off</span><br><span class="line">-f		过滤字段	all查看所有字段       </span><br><span class="line">connection 	连接 </span><br><span class="line">device      	设备</span><br><span class="line">general     	全局</span><br><span class="line">monitor     	监控</span><br><span class="line">networking  	网络</span><br><span class="line">radio       	无线广播</span><br><span class="line">			</span><br><span class="line">例：</span><br><span class="line">[root@zutuanxue ~]# nmcli  -t connection </span><br><span class="line">ens33:b5ecf570-543c-4da7-b082-bdc073b56acb:802-3-ethernet:ens33</span><br><span class="line">ens37:5b91e453-1130-48ce-a2a1-f6f728e072ed:802-3-ethernet:ens37</span><br><span class="line">ens37:077945cb-1d12-4c06-bba3-562426336b67:802-3-ethernet:</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli -p connection </span><br><span class="line">========================</span><br><span class="line">  网络管理器连接配置集</span><br><span class="line">========================</span><br><span class="line">NAME   UUID          TYPE      DEVICE </span><br><span class="line">----------------------------------------------------</span><br><span class="line">ens33  b5ec...			 ethernet  ens33  </span><br><span class="line">ens37  5b91...			 ethernet  ens37  </span><br><span class="line">ens37  0779...			 ethernet  --     </span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli -f STATE connection </span><br><span class="line">STATE  </span><br><span class="line">已激活 </span><br><span class="line">已激活 </span><br><span class="line">--     </span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli general hostname </span><br><span class="line">localhost.localdomain</span><br><span class="line">[root@zutuanxue ~]# nmcli general hostname hello</span><br><span class="line">[root@zutuanxue ~]# nmcli general hostname </span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h3 id="nmcli的返回值"><a href="#nmcli的返回值" class="headerlink" title="nmcli的返回值"></a>nmcli的返回值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: 成功-指示操作已成功</span><br><span class="line">1: 位置或指定的错误</span><br><span class="line">2: 无效的用户输入，错误的nmcli调用</span><br><span class="line">3: 超时了（请参阅 --wait 选项）</span><br><span class="line">4: 连接激活失败</span><br><span class="line">5: 连接停用失败</span><br><span class="line">6: 断开设备失败</span><br><span class="line">7: 连接删除失败</span><br><span class="line">8: 网络管理器没有运行</span><br><span class="line">10: 连接、设备或接入点不存在</span><br></pre></td></tr></table></figure>

<h1 id="linux网络相关设置"><a href="#linux网络相关设置" class="headerlink" title="linux网络相关设置"></a>linux网络相关设置</h1><p> 阅读 (130892) </p>
<p> 分享</p>
<h2 id="网络配置文件"><a href="#网络配置文件" class="headerlink" title="网络配置文件"></a>网络配置文件</h2><p>&#x2F;etc&#x2F;NetworkManager&#x2F;NetworkManager.conf</p>
<p>NetworkManager服务配置文件，如果没有特殊需求不建议调整，如果需要调整的话，调整之前备份，调整完成重新启动服务</p>
<p>&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-xx网卡配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">网卡配置文件中的关键参数</span><br><span class="line">[root@zutuanxue ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line">TYPE=&quot;Ethernet&quot;	网卡类型</span><br><span class="line">BOOTPROTO=&quot;dhcp&quot;	IP获取方式，dhcp/static（none）</span><br><span class="line">DEFROUTE=&quot;yes&quot;		是否设置为IPV4默认路由</span><br><span class="line">NAME=&quot;ens33&quot;	连接名称</span><br><span class="line">UUID=&quot;b5ecf570-543c-4da7-b082-bdc073b56acb&quot; 网卡识别号</span><br><span class="line">DEVICE=&quot;ens33&quot;	设备名称</span><br><span class="line">ONBOOT=&quot;yes&quot;		是否开机自动启动此网络连接</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">额外设置参数</span><br><span class="line">NM_CONTROLLED=yes	是否被NetworkManager服务管理，默认yes</span><br><span class="line">IPADDR			ip地址</span><br><span class="line">NETMASK			子网掩码</span><br><span class="line">GATEWAY			定义网关</span><br><span class="line">DNS1			dns地址	优先级高于/etc/resolv.conf</span><br><span class="line">DNS2			dns地址</span><br><span class="line">USERCTL			是否允许普通用户控制此设备</span><br><span class="line">PEERDNS			是否允许自动修改dns配置文件/etc/resolv.conf</span><br><span class="line">PREFIX			掩码长度</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;hostname 主机名配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/hostname </span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;resolv.conf DNS配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/resolv.conf </span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.17.2</span><br><span class="line">nameserver 202.106.0.20</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>

<h2 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h2><ul>
<li>ifconfig命令:查看网卡信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500		连接信息</span><br><span class="line">        inet 192.168.1.55  netmask 255.255.255.0  broadcast 192.168.1.255	IPV4地址信息</span><br><span class="line">        inet6 fe80::ea62:91c6:114:18bb  prefixlen 64  scopeid 0x20&lt;link&gt;	IPV6地址信息</span><br><span class="line">        ether 00:0c:29:11:47:97  txqueuelen 1000  (Ethernet)	mac地址</span><br><span class="line">        RX packets 174914  bytes 51397660 (49.0 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0   接收到的数据包统计</span><br><span class="line">        TX packets 24446  bytes 3114546 (2.9 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0	发送的数据包统计</span><br><span class="line">停用网卡</span><br><span class="line">[root@zutuanxue ~]# ifconfig ens37 down</span><br><span class="line">启用网卡</span><br><span class="line">[root@zutuanxue ~]# ifconfig ens37 up</span><br><span class="line">设置一个临时IP</span><br><span class="line">[root@zutuanxue ~]# ifconfig ens37 192.168.18.100</span><br></pre></td></tr></table></figure>

<ul>
<li>route命令：设置路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# route</span><br><span class="line">	-n	 以数字的形式显示路由信息</span><br><span class="line">	add/del	 添加/删除路由信息，需要配合下面参数使用</span><br><span class="line">	-net	 指定为一个网络</span><br><span class="line">	-host	 指定为一台主机</span><br><span class="line">	netmask	 指定掩码</span><br><span class="line">	gw	 指定网关</span><br><span class="line">	dev	 指定设备</span><br><span class="line">	</span><br><span class="line">Destination    Gateway   	Genmask  			Flags  	Metric Ref  Use  Iface</span><br><span class="line">0.0.0.0    		192.168.1.1 0.0.0.0   		UG    	102    0    0 	 ens33</span><br><span class="line">192.168.1.0 	0.0.0.0    	255.255.255.0 U     	102    0    0 	 ens33</span><br><span class="line">192.168.20.0  0.0.0.0     255.255.255.0 U     	100    0    0 	 ens37</span><br><span class="line"></span><br><span class="line">主要信息</span><br><span class="line">Destination		目的地址    </span><br><span class="line">Gateway   		网关</span><br><span class="line">Genmask  			掩码</span><br><span class="line">Flags  				标识	U=启用，H=主机，G=网关	</span><br><span class="line">Iface					接口</span><br><span class="line">添加路由信息</span><br><span class="line">[root@zutuanxue ~]#route add -net 192.168.20.0/24 dev ens37</span><br><span class="line">删除路由信息</span><br><span class="line">[root@zutuanxue ~]#route del -net 192.168.20.0/24	dev ens37</span><br><span class="line"></span><br><span class="line">dhclient获取与释放IP地址</span><br><span class="line">[root@zutuanxue ~]# dhclient -r ens37</span><br><span class="line">[root@zutuanxue ~]# dhclient ens37</span><br><span class="line"></span><br><span class="line">ping连通性测试工具</span><br><span class="line">[root@zutuanxue ~]# ping</span><br><span class="line">	c			指定次数</span><br><span class="line">	n			以数字的形式显示结果</span><br><span class="line">	f			洪水ping，以最快的速度收发数据包，慎用</span><br><span class="line">	</span><br><span class="line">[root@zutuanxue ~]# ping -c 5 -n www.163.com</span><br><span class="line">PING z163ipv6.v.bsgslb.cn (111.202.34.27) 56(84) bytes of data.</span><br><span class="line">64 bytes from 111.202.34.27: icmp_seq=1 ttl=128 time=5.25 ms</span><br><span class="line">64 bytes from 111.202.34.27: icmp_seq=2 ttl=128 time=8.54 ms</span><br><span class="line">64 bytes from 111.202.34.27: icmp_seq=3 ttl=128 time=6.22 ms</span><br><span class="line">64 bytes from 111.202.34.27: icmp_seq=4 ttl=128 time=5.78 ms</span><br><span class="line">64 bytes from 111.202.34.27: icmp_seq=5 ttl=128 time=5.60 ms</span><br><span class="line"></span><br><span class="line">--- z163ipv6.v.bsgslb.cn ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 13ms</span><br><span class="line">rtt min/avg/max/mdev = 5.253/6.278/8.536/1.173 ms</span><br></pre></td></tr></table></figure>

<h1 id="linux-路由管理"><a href="#linux-路由管理" class="headerlink" title="linux 路由管理"></a>linux 路由管理</h1><p> 阅读 (126403) </p>
<p> 分享</p>
<p>在前面的课程中我们知道使用route命令可以添加主机的路由信息，但是一旦系统重启相关的设置信息就会丢失,那么如何设置一个重启也不会丢失的路由信息呢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ifconfig</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.98.200  netmask 255.255.255.0  broadcast 192.168.98.255</span><br><span class="line">        inet6 fe80::2386:3dbd:531c:7bc1  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:a6:ad:95  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 37  bytes 4386 (4.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens37: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.123.123  netmask 255.255.255.0  broadcast 192.168.123.255</span><br><span class="line">        inet6 fe80::a848:f674:db3b:a83e  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:a6:ad:9f  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 5  bytes 1758 (1.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 38  bytes 4390 (4.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">#我现在有两块网卡,这两块网卡的ip地址分别是192.168.98.200和192.168.123.123,假如发送到192.168.1.0/24这个网段的数据包需要通过200这块网卡发送出去,而发送到192.168.100.0/24这个网段的数据包需要通过123这块网卡发送出去,我该如何设置呢?使用命令的话我们可以</span><br><span class="line">[root@zutuanxue ~]# route add -net 192.168.1.0/24 gateway 192.168.98.1 dev ens33</span><br><span class="line">[root@zutuanxue ~]# route add -net 192.168.100.0/24 gateway 192.168.123.1 dev ens37</span><br><span class="line">[root@zutuanxue ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.1.0     192.168.98.1    255.255.255.0   UG    0      0        0 ens33</span><br><span class="line">192.168.98.0    0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br><span class="line">192.168.100.0   192.168.123.1   255.255.255.0   UG    0      0        0 ens37</span><br><span class="line">192.168.123.0   0.0.0.0         255.255.255.0   U     101    0        0 ens37</span><br><span class="line">#这种方式只是临时的,我们来看一下该如何永久添加</span><br><span class="line">[root@zutuanxue ~]# route del -net 192.168.100.0/24 gateway 192.168.123.1 dev ens37</span><br><span class="line">[root@zutuanxue ~]# route del -net 192.168.1.0/24 gateway 192.168.98.1 dev ens33</span><br><span class="line">[root@zutuanxue ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.98.0    0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br><span class="line">192.168.123.0   0.0.0.0         255.255.255.0   U     101    0        0 ens37</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /etc/sysconfig/network-scripts/route-ens33</span><br><span class="line">192.168.1.0/24 via 192.168.98.1 dev ens33</span><br><span class="line">[root@zutuanxue ~]# vim /etc/sysconfig/network-scripts/route-ens37</span><br><span class="line">192.168.100.0/24 via 192.168.123.1 dev ens37</span><br><span class="line">[root@zutuanxue ~]# systemctl restart NetworkManager</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli connection down ens33 ens37 </span><br><span class="line">成功停用连接 &quot;ens33&quot;（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/1）</span><br><span class="line"></span><br><span class="line">成功停用连接 &quot;ens37&quot;（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/2）</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens33 </span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/3）</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up ens37</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/4）</span><br><span class="line">[root@zutuanxue network-scripts]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.1.0     192.168.98.1    255.255.255.0   UG    100    0        0 ens33</span><br><span class="line">192.168.98.0    0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br><span class="line">192.168.100.0   192.168.123.1   255.255.255.0   UG    101    0        0 ens37</span><br><span class="line">192.168.123.0   0.0.0.0         255.255.255.0   U     101    0        0 ens37</span><br></pre></td></tr></table></figure>

<h1 id="linux-聚合链路"><a href="#linux-聚合链路" class="headerlink" title="linux 聚合链路"></a>linux 聚合链路</h1><p> 阅读 (219800) </p>
<p> 分享</p>
<h2 id="聚合链路"><a href="#聚合链路" class="headerlink" title="聚合链路"></a>聚合链路</h2><p>聚合链路是将多块网卡逻辑地连接到一起从而允许故障转移或者提高吞吐率的方法。提高服务器网络可用性。</p>
<p><strong>bond</strong>是将多块网卡虚拟成为一块网卡的技术，通过bond技术让多块网卡看起来是一个单独的以太网接口设备并具有相同的ip地址。在linux下配置bond，通过网卡绑定技术既能增加服务器的可靠性，又增加了可用网络宽带，为用户提供不间断的网络服务。<br><strong>team</strong>是另一种用来实现连路聚合和方法，类似于bond，team和bond的区别在于，支持hash加密，支持负载均衡，支持8块网卡，更好地支持IPV6</p>
<p><strong>实现方式</strong></p>
<ul>
<li>bond</li>
<li>team</li>
</ul>
<h2 id="bond聚合链路"><a href="#bond聚合链路" class="headerlink" title="bond聚合链路"></a>bond聚合链路</h2><h3 id="bond聚合链路模式"><a href="#bond聚合链路模式" class="headerlink" title="bond聚合链路模式"></a>bond聚合链路模式</h3><ul>
<li>mod&#x3D;0 ，即：(balance-rr) Round-robin policy（轮询）<br>聚合口数据报文按包轮询从物理接口转发。<br>– 负载均衡—所有链路处于负载均衡状态，轮询方式往每条链路发送报文这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。<br>– 性能问题—一个连接或者会话的数据包如果从不同的接口发出的话，中途再经过不同的链路，在客户端很有可能会出现数据包无序到达的问题，而无序到达的数据包需要重新要求被发送，这样网络的吞吐量就会下降。Bond0在大压力的网络传输下，性能增长的并不是很理想。<br>– 需要交换机进行端口绑定</li>
<li>mod&#x3D;1，即： (active-backup) Active-backup policy（主-备份策略）只有Active状态的物理接口才转发数据报文。<br>– 容错能力—只有一个slave是激活的(active)。也就是说同一时刻只有一个网卡处于工作状态，其他的slave都处于备份状态，只有在当前激活的slave故障后才有可能会变为激活的(active)。<br>– 无负载均衡—此算法的优点是可以提供高网络连接的可用性，但是它的资源利用率较低，只有一个接口处于工作状态，在有 N 个网络接口的情况下，资源利用率为1&#x2F;N。</li>
<li>mod&#x3D;2，即：(balance-xor) XOR policy（平衡策略）<br>聚合口数据报文按源目MAC、源目IP、源目端口进行异或HASH运算得到一个值，根据该值查找接口转发数据报文<br>– 负载均衡—基于指定的传输HASH策略传输数据包。<br>容错能力—这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。<br>– 性能问题—该模式将限定流量，以保证到达特定对端的流量总是从同一个接口上发出。既然目的地是通过MAC地址来决定的，因此该模式在“本地”网络配置下可以工作得很好。如果所有流量是通过单个路由器，由于只有一个网关，源和目标mac都固定了，那么这个算法算出的线路就一直是同一条，那么这种模式就没有多少意义了。<br>– 需要交换机配置为port channel</li>
<li>mod&#x3D;3，即：broadcast（广播策略）<br>这种模式的特点是一个报文会复制两份往bond下的两个接口分别发送出去，当有对端交换机失效，我们感觉不到任何downtime，但此法过于浪费资源；不过这种模式有很好的容错机制。此模式适用于金融行业，因为他们需要高可靠性的网络，不允许出现任何问题。</li>
<li>mod&#x3D;4，即：(802.3ad) IEEE 802.3ad Dynamic link aggregation（IEEE 802.3ad 动态链接聚合）<br>在动态聚合模式下，聚合组内的成员端口上均启用LACP（链路汇聚控制协议）协议，其端口状态通过该协议自动进行维护。<br>– 负载均衡—基于指定的传输HASH策略传输数据包。默认算法与blance-xor一样。<br>– 容错能力—这模式的特点增加了带宽，同时支持容错能力，当有链路出问题，会把流量切换到正常的链路上。对比blance-xor，这种模式定期发送LACPDU报文维护链路聚合状态，保证链路质量。<br>– 需要交换机支持LACP协议</li>
<li>mod&#x3D;5，即：(balance-tlb) Adaptive transmit load balancing（适配器传输负载均衡）<br>在每个物理接口上根据当前的负载（根据速度计算）分配外出流量。如果正在接收数据的物理接口口出故障了，另一个物理接口接管该故障物理口的MAC地址。<br>需要ethtool支持获取每个slave的速率</li>
<li>mod&#x3D;6，即：(balance-alb) Adaptive load balancing（适配器适应性负载均衡）<br>该模式包含了balance-tlb模式，同时加上针对IPV4流量的接收负载均衡，而且不需要任何switch(交换机)的支持。接收负载均衡是通过ARP协商实现的。bonding驱动截获本机发送的ARP应答，并把源硬件地址改写为bond中某个物理接口的唯一硬件地址，从而使得不同的对端使用不同的硬件地址进行通信。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">其实mod=6与mod=0的区别：mod=6，先把eth0流量占满，再占eth1，….ethX；而mod=0的话，会发现2个口的流量都很稳定，基本一</span><br><span class="line">样的带宽。而mod=6，会发现第一个口流量很高，第2个口只占了小部分流量</span><br><span class="line"></span><br><span class="line">常用的模式为 0136</span><br><span class="line">mode 1、5、6不需要交换机设置</span><br><span class="line">mode 0、2、3、4需要交换机设置</span><br></pre></td></tr></table></figure>

<p><strong>案例:使用Bond方式设置聚合链路</strong></p>
<p><strong>环境</strong><br>系统：CentOS8<br>网卡名称： ens33（vmnet4） ens37（vmnet4）</p>
<p><strong>step 1：</strong> 查看环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME   UUID                                  TYPE      DEVICE </span><br><span class="line">ens33  f035d150-9e89-4ee9-a657-03598d4b0940  ethernet  ens33  </span><br><span class="line">ens37  7726249d-8281-45e8-a8e3-a6a023c64c66  ethernet  ens37</span><br></pre></td></tr></table></figure>

<p><strong>step 2：</strong> 创建bond虚拟网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection add type bond con-name bond0 ifname bond0 mode 1 ipv4.addresses 192.168.98.200/24 ipv4.method manual autoconnect yes</span><br><span class="line"></span><br><span class="line">#type：创建的类型，这里选择bond类型</span><br><span class="line">#con-name:这里写链接名，就是show中第一列，这里写什么生成的文件就是什么名字</span><br><span class="line">#ifname:网卡名，这里bond0是虚拟出来的</span><br><span class="line">#mode:选择bond模式，常用的有主备，轮询，广播，还有其他模式，用tab补全可以看到所有，也可以使用数字0-6表示</span><br><span class="line">#ipv4.mehod:表示自动还是手动，就是使用dhcp还是自己配置地址，关联配置文件中的BOOTPROTO段</span><br><span class="line">#ipv4.address：设置ip地址，注意记得加上掩码</span><br><span class="line">#autoconnect 自动连接</span><br></pre></td></tr></table></figure>

<p><strong>step 3：</strong> 为bond网卡添加成员（真实网卡）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection add type bond-slave ifname ens33 master bond0</span><br><span class="line">连接 &quot;bond-slave-ens33&quot; (9fb9b3fa-a477-4a6f-a3c1-79cbfe351c7d) 已成功添加。</span><br><span class="line">[root@zutuanxue ~]# nmcli connection add type bond-slave ifname ens37 master bond0</span><br><span class="line">连接 &quot;bond-slave-ens37&quot; (2b047e49-b606-4b67-9e5c-f721f1e2ff7a) 已成功添加。</span><br><span class="line">#类型为bond-slave,表示这块真实网卡属于一块附属的网卡，原有配置的属性都不能使用了，master表示这块从属网卡属于bond0这个组</span><br><span class="line">注意：如果你的网卡没有启用的话需要启用</span><br><span class="line">[root@zutuanxue ~]# nmcli connection </span><br><span class="line">NAME              UUID                                  TYPE      DEVICE </span><br><span class="line">bond0             55e0afdc-d2a6-4c93-b346-0ce207947b81  bond      bond0  </span><br><span class="line">bond-slave-ens33  9fb9b3fa-a477-4a6f-a3c1-79cbfe351c7d  ethernet  ens33  </span><br><span class="line">bond-slave-ens37  2b047e49-b606-4b67-9e5c-f721f1e2ff7a  ethernet  ens37  </span><br><span class="line">ens33             f035d150-9e89-4ee9-a657-03598d4b0940  ethernet  --     </span><br><span class="line">ens37             7726249d-8281-45e8-a8e3-a6a023c64c66  ethernet  --     </span><br><span class="line">[root@zutuanxue ~]# ifconfig</span><br><span class="line">bond0: ether 00:0c:29:a6:ad:95  txqueuelen 1000  (Ethernet)</span><br><span class="line">       </span><br><span class="line">ens33: ether 00:0c:29:a6:ad:95  txqueuelen 1000  (Ethernet)</span><br><span class="line">       </span><br><span class="line">ens37: ether 00:0c:29:a6:ad:95  txqueuelen 1000  (Ethernet)</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up bond-slave-ens33</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/81）</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up bond-slave-ens37</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/82）</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up bond0</span><br><span class="line">连接已成功激活（master waiting for slaves）（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/83）</span><br></pre></td></tr></table></figure>

<p><strong>step 4：</strong> 查看链接信息并测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#查看信息</span><br><span class="line">[root@zutuanxue ~]# cat /proc/net/bonding/bond0 </span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: fault-tolerance (active-backup)#模式</span><br><span class="line">Primary Slave: None</span><br><span class="line">Currently Active Slave: ens33	#当前设备</span><br><span class="line">MII Status: up	#启用状态</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens33	#从接口信息</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:a6:ad:95</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: ens37	#另外一个从接口信息</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:a6:ad:9f</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ip add</span><br><span class="line"></span><br><span class="line">ens33: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000</span><br><span class="line">		link/ether 00:0c:29:a6:ad:95 brd ff:ff:ff:ff:ff:ff</span><br><span class="line"></span><br><span class="line">ens37: &lt;BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:a6:ad:95 brd ff:ff:ff:ff:ff:ff</span><br><span class="line"></span><br><span class="line">bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:a6:ad:95 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.98.200/24 brd 192.168.98.255 scope global noprefixroute bond0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">#找到另外一台主机使用ping进行测试</span><br><span class="line">[root@zutuanxue ~]# nmcli connection down bond-slave-xxx</span><br><span class="line">或者直接断开虚拟的网络连接测试还能否ping通</span><br></pre></td></tr></table></figure>

<p><strong>删除</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection delete bond0 bond-slave-ens33 bond-slave-ens37</span><br><span class="line">注意：在配置聚合链路的时候如果使用虚拟机可能会弹出与mac地址相关的信息提示，可以暂时不用去管，如果测试的时候发现断网卡之后无法ping通，则需要在相关网卡配置文件中添加参数，如：</span><br><span class="line">[root@zutuanxue ~]# vim /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">#添加一行内容</span><br><span class="line">BONDING_OPTS=&quot;miimon=100 mode=1 fail_over_mac=1&quot;</span><br><span class="line">#miimon：链路检查时间为100ms</span><br><span class="line">#mode：模式为1，要与bond的模式相同</span><br><span class="line">#fail_over_mac=1 mac地址跟随正常工作的网卡，当第一块网卡挂掉之后，自动将mac地址调整为第二块网卡的mac</span><br><span class="line"></span><br><span class="line">以上操作只有在虚拟机的环境中使用，生产环境一般不需要</span><br></pre></td></tr></table></figure>

<h2 id="team聚合链路"><a href="#team聚合链路" class="headerlink" title="team聚合链路"></a>team聚合链路</h2><p>案例:使用team方式设置聚合链路</p>
<p>环境<br>系统：CentOS8<br>网卡名称： ens33（vmnet4） ens37（vmnet4）</p>
<p><strong>step 1：</strong> 建立</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection add type team con-name team0 ifname team0 config &#x27;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;,&quot;hwaddr_policy&quot;:&quot;by_active&quot;&#125;&#125;&#x27; ipv4.addresses 192.168.98.200/24 ipv4.method manual autoconnect yes</span><br><span class="line"></span><br><span class="line">#JSON语法格式如下：’&#123;“runner”:&#123;“name”:“METHOD”&#125;&#125;’其中METHOD 是以下的其中一个</span><br><span class="line">broadcast=mode3</span><br><span class="line">roundrobin=mode0</span><br><span class="line">activebackup=mode1</span><br><span class="line">loadbalance=mode256</span><br><span class="line">lacp=mode4</span><br><span class="line">#&quot;hwaddr_policy&quot;:&quot;by_active&quot;：硬件地址跟随活跃的网卡，也就是未故障的网卡</span><br><span class="line">#聚合链路获取mac的地址有两种方式,一种是从第一个活跃网卡中获取mac地址，然后其余的SLAVE网卡的mac地址都使用该mac地址;另一种是使用hwaddr_policy参数，team使用当前活跃网卡的mac地址，mac地址随活跃网卡的转换而变，虚机不支持第一种获取MAC地址的方式。</span><br></pre></td></tr></table></figure>

<p><strong>step 2：</strong> 添加网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection add type team-slave ifname ens33 master team0</span><br><span class="line">[root@zutuanxue ~]# nmcli connection add type team-slave ifname ens37 master team0</span><br></pre></td></tr></table></figure>

<p><strong>step 3：</strong> 启用连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# nmcli connection up team-slave-ens33</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up team-slave-ens37</span><br><span class="line">[root@zutuanxue ~]# nmcli connection up team0</span><br></pre></td></tr></table></figure>

<p><strong>step 4：</strong> 查看状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# teamdctl team0 stat</span><br><span class="line">setup:</span><br><span class="line">  runner: activebackup</span><br><span class="line">ports:</span><br><span class="line">  ens33</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">  ens37</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">runner:</span><br><span class="line">  active port: ens37</span><br></pre></td></tr></table></figure>

<h1 id="linux网络故障排查"><a href="#linux网络故障排查" class="headerlink" title="linux网络故障排查"></a>linux网络故障排查</h1><p> 阅读 (243211) </p>
<p> 分享</p>
<p>在日常使用中，经常会出现无法连通的情况，这个时候我们就需要找到问题出在哪里，这里面给各位提供一个生产环境排查网络故障的大体思路，一般情况下如果遇到网络故障，都是通过筛选的方式一点一点的确定问题所在，首先判断是本机的问题还是网络上其它设备的问题，如果同一网络环境中的其它主机正常的，要去其它网络设备（路由器）上查看一下是否对网络有问题的主机设置了限制，如果没有的话，问题出在本机，这里面我们主要看下下本机容易出现哪些问题导致页面无法访问</p>
<h2 id="一、网线和网卡设置"><a href="#一、网线和网卡设置" class="headerlink" title="一、网线和网卡设置"></a>一、网线和网卡设置</h2><p>检查网卡的灯是否亮起，普通服务器的话应该是绿灯常亮为正常，交换机绿灯闪烁表示正在传输数据。也可以通过命令ethtool ethX来查看某一网卡的链路是否物理连通。</p>
<p>命令介绍</p>
<p>ethtool</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ethtool ens33</span><br><span class="line">Settings for ens33:</span><br><span class="line">	Supported ports: [ TP ]</span><br><span class="line">	#接口类型</span><br><span class="line">	#TP 	RJ45接口双绞线</span><br><span class="line">	#AUI 	“D”型15针接口</span><br><span class="line">	#BNC 	细同轴电缆接口，类似于以前的有线电视	</span><br><span class="line">	#MII 	媒体独立接口，一种以太网行业标准</span><br><span class="line">	#FIBRE	光纤</span><br><span class="line">	Supported link modes:   10baseT/Half 10baseT/Full </span><br><span class="line">	                        100baseT/Half 				    																						100baseT/Full </span><br><span class="line">	                        1000baseT/Full </span><br><span class="line">	#支持的链接模式</span><br><span class="line">	Supported pause frame use: No</span><br><span class="line">	#是否支持暂停帧--一种网卡流量控制技术</span><br><span class="line">	Supports auto-negotiation: Yes</span><br><span class="line">	#是否支持自动协商，网络设备相互告知对方自己的工作方式，包括传输速度，双工状态等，然后选择一个最佳的</span><br><span class="line">	Supported FEC modes: Not reported</span><br><span class="line">	#编码纠错模式，支持编码纠错可提高数据通讯可信度</span><br><span class="line">	Advertised link modes:  10baseT/Half 10baseT/Full </span><br><span class="line">	                        100baseT/Half</span><br><span class="line">                          100baseT/Full </span><br><span class="line">	                        1000baseT/Full</span><br><span class="line">  #宣告的链接模式</span><br><span class="line">	Advertised pause frame use: No</span><br><span class="line">	#宣告的是否支持帧暂停</span><br><span class="line">	Advertised auto-negotiation: Yes</span><br><span class="line">	#宣告的是否支持自动协商</span><br><span class="line">	Advertised FEC modes: Not reported</span><br><span class="line">	#宣告的是否FEC</span><br><span class="line">	Speed: 1000Mb/s</span><br><span class="line">	#当前速度</span><br><span class="line">	Duplex: Full</span><br><span class="line">	#全双工还是半双工</span><br><span class="line">	Port: Twisted Pair</span><br><span class="line">	#线缆类型为双绞线</span><br><span class="line">	PHYAD: 0</span><br><span class="line">	#PHY地址，主要指PHY芯片，用来发送和接收数据帧</span><br><span class="line">	Transceiver: internal</span><br><span class="line">	#收发器类型 internal/external（内部外部）是否是板载的</span><br><span class="line">	Auto-negotiation: on</span><br><span class="line">	#自动协商功能开启</span><br><span class="line">	MDI-X: off (auto)</span><br><span class="line">	#自适应功能</span><br><span class="line">	Supports Wake-on: d</span><br><span class="line">	#是否支持远程唤醒 d=禁用，p\u\m\b\a\g=不同唤醒方式</span><br><span class="line">	Wake-on: d</span><br><span class="line">	Current message level: 0x00000007 (7)	drv probe link</span><br><span class="line">	Link detected: yes</span><br><span class="line">	#网卡已连接</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	##############常用参数</span><br><span class="line">#-a 查看网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。主要指接收暂停，发送暂停和自动协商暂停功能，也就是暂停帧，主要用于控制数据路停止发送，可以防止瞬间压力过大导致缓冲区溢出而引发的帧丢失（丢包）</span><br><span class="line">#[root@zutuanxue ~]# ethtool -a ens33</span><br><span class="line">Pause parameters for ens33:</span><br><span class="line">Autonegotiate:	on</span><br><span class="line">RX:		off</span><br><span class="line">TX:		off</span><br><span class="line"></span><br><span class="line">#-A 修改网卡中 接收模块RX、发送模块TX和Autonegotiate模块的状态：启动on 或 停用off。</span><br><span class="line">[root@zutuanxue ~]# ethtool -A ens33 rx/tx/autoneg on</span><br><span class="line"></span><br><span class="line">#-i 显示网卡驱动的信息，如驱动的名称、版本等。</span><br><span class="line">[root@zutuanxue ~]# ethtool -i ens33</span><br><span class="line">driver: e1000</span><br><span class="line">version: 7.3.21-k8-NAPI</span><br><span class="line">firmware-version: </span><br><span class="line">expansion-rom-version: </span><br><span class="line">bus-info: 0000:02:01.0</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: yes</span><br><span class="line">supports-eeprom-access: yes</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: no</span><br><span class="line"></span><br><span class="line">#-k 显示网卡各项功能的支持和协议状态，如支持某个协议的功能是否开启等</span><br><span class="line">#-p 用于区别不同ethX对应网卡的物理位置，常用的方法是使网卡port上的led不断的闪；N为网卡闪的持续时间，以秒为单位。</span><br><span class="line">[root@zutuanxue ~]# ethtool -p ens33 10</span><br><span class="line"></span><br><span class="line">#-r 如果自动协商状态为on，则重启自动协商功能。</span><br><span class="line">[root@zutuanxue ~]# ethtool -r ens33</span><br><span class="line"></span><br><span class="line">#-S 显示统计参数，如网卡接收/发送的字节数、接收/发送的广播包个数等。</span><br><span class="line">[root@zutuanxue ~]# ethtool -S ens33</span><br><span class="line">NIC statistics:</span><br><span class="line">     rx_packets: 609</span><br><span class="line">     tx_packets: 130</span><br><span class="line">     rx_bytes: 121330</span><br><span class="line">     tx_bytes: 16066</span><br><span class="line">     rx_broadcast: 0</span><br><span class="line"></span><br><span class="line">#-s 修改网卡的部分配置，包括网卡速度、单工/全双工模式、mac地址等。</span><br><span class="line">	ethtool –s ethX [speed 10|100|1000]</span><br><span class="line">									#设置网口速率10/100/1000M</span><br><span class="line">									[duplex half|full]</span><br><span class="line">									#设置网口半/全双工</span><br><span class="line">									[autoneg on|off]</span><br><span class="line">									#设置网口是否自协商</span><br><span class="line">									[port tp|aui|bnc|mii]</span><br><span class="line">									#设置网口类型</span><br><span class="line">[root@zutuanxue ~]# ethtool -s ens33 speed 1000 duplex full autoneg on port tp</span><br></pre></td></tr></table></figure>

<h2 id="二、selinux-amp-防火墙"><a href="#二、selinux-amp-防火墙" class="headerlink" title="二、selinux&amp;防火墙"></a>二、selinux&amp;防火墙</h2><p>这两个是最容易产生干扰的项目，selinux和防火墙如何关闭，我们在前面的课程中有涉及，这里就不重复了</p>
<h2 id="三、查看网卡ip地址，网关设置"><a href="#三、查看网卡ip地址，网关设置" class="headerlink" title="三、查看网卡ip地址，网关设置"></a>三、查看网卡ip地址，网关设置</h2><p>使用ifconfig或者nmcli命令查看&#x2F;设置ip地址和网关</p>
<h2 id="四、使用ping命令测试连通性"><a href="#四、使用ping命令测试连通性" class="headerlink" title="四、使用ping命令测试连通性"></a>四、使用ping命令测试连通性</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-c&lt;完成次数&gt;：设置完成要求回应的次数；</span><br><span class="line">-f：洪水ping只有root可以使用</span><br><span class="line">-i&lt;间隔秒数&gt;：指定收发信息的间隔时间；</span><br><span class="line">-n：只输出数值,不尝试去查找主机名</span><br><span class="line">-s&lt;数据包大小&gt;：设置数据包的大小；</span><br><span class="line">-I 指定源地址（源地址必须是本地网卡上存在的配置）</span><br><span class="line">[root@zutuanxuers1 ~]# ping -c 3 -i 0.5 -n  -s 1024 -I 192.168.2.220 192.168.2.220</span><br><span class="line">PING 192.168.2.220 (192.168.2.220) from 192.168.2.220 : 1024(1052) bytes of data.</span><br><span class="line">1032 bytes from 192.168.2.220: icmp_seq=1 ttl=64 time=0.047 ms</span><br><span class="line">1032 bytes from 192.168.2.220: icmp_seq=2 ttl=64 time=0.060 ms</span><br><span class="line">1032 bytes from 192.168.2.220: icmp_seq=3 ttl=64 time=0.053 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.2.220 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 13ms</span><br><span class="line">rtt min/avg/max/mdev = 0.047/0.053/0.060/0.008 ms</span><br></pre></td></tr></table></figure>

<h2 id="五、路由"><a href="#五、路由" class="headerlink" title="五、路由"></a>五、路由</h2><p>使用route命令查看或设置路由及网关，也可以通过修改静态路由配置文件实现</p>
<h2 id="六、DNS"><a href="#六、DNS" class="headerlink" title="六、DNS"></a>六、DNS</h2><ul>
<li>&#x2F;etc&#x2F;hosts&amp;&#x2F;etc&#x2F;resolv.conf</li>
<li>nslookup</li>
<li>dig</li>
<li>host</li>
</ul>
<h2 id="七、追踪数据包"><a href="#七、追踪数据包" class="headerlink" title="七、追踪数据包"></a>七、追踪数据包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tracepath  [参数选项]  hostname，域名或 IP地址</span><br><span class="line">#替代了以前的traceroute</span><br><span class="line">参数选项：</span><br><span class="line">-4	使用IPV4</span><br><span class="line">-6	使用IPV6=tracepath6</span><br><span class="line">-l	设置初始包的大小 默认IPV4 65535，ipv6 128000</span><br><span class="line">-m 	设置检测数据包的TTL，默认值为30次；</span><br><span class="line">-n 	显示IP地址，不查主机名。当DNS不起作用时常用到这个参数；</span><br><span class="line">-b	显示主机名和IP地址</span><br><span class="line">-p 	port 探测包使用的基本UDP端口设置为port ，默认值是33434</span><br><span class="line">[root@zutuanxuers1 ~]# tracepath -b www.baidu.com -l 1000 -m 5</span><br><span class="line"> 1:  localhost (192.168.0.1)                              18.324ms </span><br><span class="line"> 2:  localhost (192.168.1.1)                              15.622ms </span><br><span class="line"> 3:  localhost (10.70.0.1)                                18.640ms </span><br><span class="line"> 4:  114.244.94.25 (114.244.94.25)                         7.213ms </span><br><span class="line"> 5:  124.65.56.141 (124.65.56.141)                        16.020ms </span><br><span class="line">     Too many hops: pmtu 1000</span><br><span class="line">     Resume: pmtu 1000 </span><br></pre></td></tr></table></figure>

<h2 id="八、硬件故障"><a href="#八、硬件故障" class="headerlink" title="八、硬件故障"></a>八、硬件故障</h2><p>更换硬件</p>
<h1 id="linux日志管理"><a href="#linux日志管理" class="headerlink" title="linux日志管理"></a>linux日志管理</h1><p> 阅读 (140878) </p>
<p> 分享</p>
<h2 id="一、日志服务的介绍"><a href="#一、日志服务的介绍" class="headerlink" title="一、日志服务的介绍"></a>一、日志服务的介绍</h2><h3 id="日志介绍"><a href="#日志介绍" class="headerlink" title="日志介绍"></a>日志介绍</h3><p>程序执行的时候，可以通过标准输出（stdout, Standard Output）与标准错误输出 （stderr, Standard Error Output）来输送信息，用户就可以了解该程序执行时发生了什么状况；可是对于在后台执行的服务器程序，或者Linux 内核本身来说，就没有办法这样做了。服务与内核启动后，会切断与终端机（Terminal） 或控制台（Console）的联机，如此一来，即使有信息通过标准输出、标准错误输出传送出去，用户也未必能从屏幕上看到信息。</p>
<p>更何况，用户根本不可能全天候在计算机前面，盯着屏幕上显示的信息啊！为了让 管理者可以随时监控服务所产生的信息，Linux 提供了一个日志服务，该服务可以收集（Collect）任何服务传递过来的信息，储存成为记录文件（Log File） 、或直接传送给某些用户，甚至也可以传送到其他计算机的系统日志服务。</p>
<h3 id="日志的作用"><a href="#日志的作用" class="headerlink" title="日志的作用"></a>日志的作用</h3><p><strong>系统方面的问题</strong></p>
<p>linux系统长时间运行，可能会出现一些软件，硬件方面的问题，这些问题都会记录到日志文件中，我们可以通过查看相应的日志文件，找出问题所在</p>
<p><strong>网络服务的问题</strong></p>
<p>网络服务在运行过程中产生的信息都会记录到日志文件中，一旦服务出现问题，无法正常运行，我们可以通过查看相应的日志文件就知道服务出现了什么问题</p>
<p><strong>历史事件查询</strong></p>
<p>由于日志服务每天都会将系统运行的信息保存到日志文件当中，所以我们也可以通过日志信息去追溯之前的系统运行状况</p>
<h2 id="二、相关软件包和文件"><a href="#二、相关软件包和文件" class="headerlink" title="二、相关软件包和文件"></a>二、相关软件包和文件</h2><h3 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# rpm -qa | grep rsyslog</span><br><span class="line">rsyslog-gssapi-8.37.0-9.el8.x86_64</span><br><span class="line">rsyslog-relp-8.37.0-9.el8.x86_64</span><br><span class="line">rsyslog-8.37.0-9.el8.x86_64</span><br><span class="line">rsyslog-gnutls-8.37.0-9.el8.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="相关文件-1"><a href="#相关文件-1" class="headerlink" title="相关文件"></a>相关文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置文件：/etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line">辅助配置文件：/etc/rsyslog.d/*.conf</span><br><span class="line"></span><br><span class="line">日志文件存放位置：	/var/log/</span><br><span class="line"></span><br><span class="line">执行文件：/usr/sbin/rsyslogd</span><br><span class="line"></span><br><span class="line">模块路径：/usr/lib64/rsyslog/</span><br><span class="line"></span><br><span class="line">服务单元：/usr/lib/systemd/system/rsyslog.service</span><br></pre></td></tr></table></figure>

<h2 id="三、配置文件说明"><a href="#三、配置文件说明" class="headerlink" title="三、配置文件说明"></a>三、配置文件说明</h2><h3 id="x2F-etc-x2F-rsyslog-conf"><a href="#x2F-etc-x2F-rsyslog-conf" class="headerlink" title="&#x2F;etc&#x2F;rsyslog.conf"></a>&#x2F;etc&#x2F;rsyslog.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue yum.repos.d]# grep &#x27;####&#x27; /etc/rsyslog.conf </span><br><span class="line">#### MODULES ####定义模块</span><br><span class="line">#### GLOBAL DIRECTIVES ####定义全局环境</span><br><span class="line">#### RULES ####	定义规则</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">模块定义</span><br><span class="line">module(load=&quot;imuxsock&quot;    # 提供对本地系统日志的支持</span><br><span class="line">       SysSock.Use=&quot;off&quot;) # 关闭通过本地日志接口的信息接收功能，日志信息接收通过下面的imjournal模块</span><br><span class="line">module(load=&quot;imjournal&quot;             # 提供对systemd日志的访问</span><br><span class="line">       StateFile=&quot;imjournal.state&quot;) # 定义状态文件，rsyslog用于记录文件上传进度，避免日志内容混乱</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">全局环境设置</span><br><span class="line"># 定义工作目录</span><br><span class="line">global(workDirectory=&quot;/var/lib/rsyslog&quot;)</span><br><span class="line"></span><br><span class="line"># 使用默认的时间戳格式</span><br><span class="line">module(load=&quot;builtin:omfile&quot; Template=&quot;RSYSLOG_TraditionalFileFormat&quot;)</span><br><span class="line"></span><br><span class="line"># 定义辅助配置文件位置</span><br><span class="line">include(file=&quot;/etc/rsyslog.d/*.conf&quot; mode=&quot;optional&quot;)</span><br><span class="line"></span><br><span class="line">规则设置</span><br><span class="line">信息来源.安全级别	 处理方式</span><br><span class="line"></span><br><span class="line">信息来源</span><br><span class="line"> 	 kern：内核相关的日志</span><br><span class="line"> 	 user：用户相关的日志</span><br><span class="line">        mail：邮件相关的日志</span><br><span class="line">        daemon：系统服务相关的日志</span><br><span class="line">        lpr： 打印相关的日志</span><br><span class="line">        cron：计划任务相关的日志</span><br><span class="line">        authpriv:认证相关的日志</span><br><span class="line">        news：新闻相关的日志</span><br><span class="line">        uucp：文件copy相关的日志</span><br><span class="line">        local0-local7：自定义相关的日志信息</span><br><span class="line">	*：		所有</span><br><span class="line">安全级别</span><br><span class="line">       debug:  调试</span><br><span class="line">	info:   消息</span><br><span class="line">	notice: 注意</span><br><span class="line">    	warn,warning: 警告</span><br><span class="line">	err,error: 错误</span><br><span class="line">	crit: 严重级别</span><br><span class="line">	alert: 需要立即修改该的信息</span><br><span class="line">	emerg,panic: 内核崩溃，系统接近崩溃</span><br><span class="line">	*：所有日志级别</span><br><span class="line">       	none:没有任何级别，也就是不记录日志信息</span><br><span class="line"></span><br><span class="line">表达形式</span><br><span class="line">mail.err		err+crit+alert+emerg</span><br><span class="line">mail.=err		err</span><br><span class="line">mail.!err		除了err</span><br><span class="line"></span><br><span class="line">处理方式</span><br><span class="line">/PATH/FILENAME：将信息储存至 /PATH/FILENAME文件中。注意，如果要系统日志服务把信息储存到文件，该文件必须以</span><br><span class="line">斜线（/） 开头的绝对路径命名之。</span><br><span class="line">USERNAME：将信息送给已登录的用户。</span><br><span class="line">@HOSTNAME：代表使用udp协议将信息转送到远端的日志服务器。</span><br><span class="line">@@hostname：代表使用tcp协议将信息传送到远端的日志服务器</span><br><span class="line">*：将信息传送给所有已登录的用户。</span><br></pre></td></tr></table></figure>

<h3 id="常见的日志文件及作用"><a href="#常见的日志文件及作用" class="headerlink" title="常见的日志文件及作用"></a>常见的日志文件及作用</h3><p>&#x2F;var&#x2F;log&#x2F;boot.log 系统启动时的日志。</p>
<p>&#x2F;var&#x2F;log&#x2F;dnf.* dnf软件包管理器相关日志</p>
<p>&#x2F;var&#x2F;log&#x2F;firewalld 防火墙日志</p>
<p>&#x2F;var&#x2F;log&#x2F;lastlog 所有用户最后一次登录信息,需要使用lastlog命令查看</p>
<p>&#x2F;var&#x2F;log&#x2F;maillog 电子邮件系统相关日志</p>
<p>&#x2F;var&#x2F;log&#x2F;messages 整体的系统日志，具体记录范围取决于服务的配置文件</p>
<p>&#x2F;var&#x2F;log&#x2F;wtmp 记录当前登录和过去登录的用户信息，使用last命令查看</p>
<h3 id="日志文件的安全设置"><a href="#日志文件的安全设置" class="headerlink" title="日志文件的安全设置"></a>日志文件的安全设置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chattr +a /var/log/messages </span><br><span class="line">[root@zutuanxue ~]# lsattr /var/log/messages </span><br><span class="line">-----a------------ /var/log/messages</span><br></pre></td></tr></table></figure>

<h3 id="日志的格式"><a href="#日志的格式" class="headerlink" title="日志的格式"></a>日志的格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# tail /var/log/messages </span><br><span class="line">Dec  6 03:29:09 localhost systemd[1]: Started PackageKit Daemon.</span><br><span class="line">Dec  6 03:43:44 localhost systemd[1]: Starting dnf makecache...</span><br><span class="line">Dec  6 03:43:44 localhost dnf[7594]: 元数据缓存近期已刷新。</span><br><span class="line">Dec  6 03:43:44 localhost systemd[1]: Started dnf makecache.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATE  TIME  HOSTNAME  APP（NAME）[PID]: MESSAGES</span><br><span class="line"></span><br><span class="line">每一个字段的意义如下说明：</span><br><span class="line">DATE：信息发生的日期。</span><br><span class="line">TIME：信息发生的时间。</span><br><span class="line">HOSTNAME：信息发生的主机。</span><br><span class="line">APP：产生信息的软件。</span><br><span class="line">NAME：软件的名称，或是软件组件（Component）的名称。可以省略。</span><br><span class="line">PID：进程标识符 （Process ID）。可以省略。</span><br><span class="line">MESSAGES：信息的内容。 </span><br></pre></td></tr></table></figure>

<h2 id="四、日志切割"><a href="#四、日志切割" class="headerlink" title="四、日志切割"></a>四、日志切割</h2><p><strong>日志切割介绍</strong></p>
<p>随着系统时间使用的增长，日志文件的体积会越来越大，过大的日志文件对于查看或者备份来讲都是极为不便的。所以linux系统提供了一个日志切割工具，这个工具就是logrotate，用户可以用过这个工具对日志文件进行切割，系统也利用这个工具配合计划任务服务，定期的对系统日志进行切割。</p>
<p><strong>相关文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/logrotate.conf	主配置文件，定义日志切割规则</span><br><span class="line">/etc/logrotate.d/	辅助配置文件，可以让用户针对不类型的信息，定义不同的切割规则</span><br></pre></td></tr></table></figure>

<p><strong>主配置文件说明</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/logrotate.conf </span><br><span class="line">weekly	#定义切割周期为每周一次</span><br><span class="line">rotate 4 #默认保留四个文件</span><br><span class="line">create	 #切割完成后，建立一个新的文件继续存储日志信息</span><br><span class="line">dateext	#定义切割后的文件名中要包含日期信息</span><br><span class="line">include /etc/logrotate.d #辅助配置文件的存放位置</span><br></pre></td></tr></table></figure>

<p><strong>辅助配置文件说明</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">格式</span><br><span class="line">日志文件的名称(绝对路径)	&#123;</span><br><span class="line">	额外的设置</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /etc/logrotate.d/syslog </span><br><span class="line">/var/log/cron</span><br><span class="line">/var/log/maillog</span><br><span class="line">/var/log/messages</span><br><span class="line">/var/log/secure</span><br><span class="line">/var/log/spooler</span><br><span class="line">&#123;</span><br><span class="line">    missingok	 #如果文件丢失，转到下一个文件，不报告错误信息</span><br><span class="line">    sharedscripts #定义执行的脚本，需要与endscript结合使用</span><br><span class="line">    postrotate	#定义执行完logrotate操作之后，执行的操作</span><br><span class="line">		/usr/bin/systemctl kill -s HUP rsyslog.service &gt;/dev/null 2&gt;&amp;1 || true #重启日志服务</span><br><span class="line">    endscript	#定义执行的脚本，需要sharedscripts结合使用。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>logrotate</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# logrotate -vf /etc/logrotate.conf </span><br><span class="line">#参数说明 </span><br><span class="line">v	 显示详细信息</span><br><span class="line">f	 强制切割</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# logrotate -vf /etc/logrotate.conf</span><br><span class="line">[root@zutuanxue log]# cd /var/log/</span><br><span class="line">[root@zutuanxue log]# ls</span><br><span class="line">secure-20191206		boot.log-20191206		maillog-20191206</span><br><span class="line">btmp-20191206			messages-20191206		spooler-20191206</span><br><span class="line">wtmp-20191206			cron-20191206</span><br></pre></td></tr></table></figure>

<p><strong>系统如何使用logrotate</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">linux系统通过计划任务去定期的执行切割动作</span><br><span class="line">[root@zutuanxue ~]# cat /etc/cron.daily/logrotate</span><br><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">/usr/sbin/logrotate /etc/logrotate.conf</span><br><span class="line">EXITVALUE=$?</span><br><span class="line">if [ $EXITVALUE != 0 ]; then</span><br><span class="line">    /usr/bin/logger -t logrotate &quot;ALERT exited abnormally with [$EXITVALUE]&quot;</span><br><span class="line">fi</span><br><span class="line">exit $EXITVALUE</span><br><span class="line">此文件定义了如果切割的操作执行成功的话，会调用logger命令记录一条标签为logrotate的日志信息到日志文件里</span><br></pre></td></tr></table></figure>

<h2 id="五、systemd-journald-service"><a href="#五、systemd-journald-service" class="headerlink" title="五、systemd-journald.service"></a>五、systemd-journald.service</h2><p>很早之前，日志信息是需要等到开机完成并启动日志服务之后才会开始记录的，这种方式会导致开机过程中的信息无法记录，为了避免这种情况，内核用一个叫klogd的服务来记录开机过程中产生的日志信息，然后等到日志服务启动完再将这些信息交给日志服务。</p>
<p> 现在linux系统采用systemd来管理系统服务，而systemd又是第一个启动的服务，所以现在我们通过一个systemd自带的，名字叫systemd-journald的服务来协助记录日志信息。那是不是就意味着我们可以不使用rsyslog这个服务了呢？不能，因为systemd-journald服务使用内存来记录相关日志信息，断电之后内容消失，所以我们不能停止rsyslog服务，而且rsyslog服务有一个很重要的功能，可以对日志内容进行分类。</p>
<p> <strong>journalctl命令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">systemd-journald提供了一个叫journalctl的工具用来查询它所记录的信息</span><br><span class="line">[root@zutuanxue ~]# journalctl </span><br><span class="line"> -n		显示最后的几行内容，默认为10行</span><br><span class="line"> -r		倒序输出，最新的日志先输出</span><br><span class="line"> -S/--since	开始的时间</span><br><span class="line"> -U/--until	结束的时间</span><br><span class="line"> -p		指定日志等级0-7，（0=emerg，1=alert，2=crit，3=err，4=warninig，5=notice，6=info，7=debug）如：4代表的就是0-4</span><br><span class="line">-f		持续输出，类似于tail的-f	使用ctrl+c结束</span><br><span class="line">--disk-usage	磁盘空间占用</span><br><span class="line">-u		指定单元，如 -u crond.service</span><br><span class="line">--vacuum-size	释放日志文件占用的空间，如	--vacuum-size 1G</span><br><span class="line">_PID=0		查看指定PID的信息</span><br><span class="line">_UID=0		查看指定UID的信息</span><br><span class="line">		</span><br><span class="line">[root@zutuanxue ~]# journalctl --since &quot;YYYY-MM-DD 00:00:00&quot; --until &quot;YYYY-MM-DD 00:00:00&quot;</span><br><span class="line">[root@zutuanxue ~]# journalctl --since today</span><br><span class="line">[root@zutuanxue ~]# journalctl --since yesterday --until today</span><br><span class="line">[root@zutuanxue ~]# journalctl -u crond.service</span><br><span class="line">[root@zutuanxue ~]# journalctl _SYSTEM_UNIT=crond.service</span><br></pre></td></tr></table></figure>

<h2 id="六、日志分析工具"><a href="#六、日志分析工具" class="headerlink" title="六、日志分析工具"></a>六、日志分析工具</h2><p>虽然我们有相关的工具来查看日志信息，但是如果信息量过大的话查看起来也是比较费时的，所以linux系统给我们提供了一个日志分析工具，这个工具叫logwatch，它会每天分析日志信息，并将信息通过邮件的形式发送给root用户</p>
<p><strong>安装logwatch及相关软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install logwatch -y</span><br><span class="line">[root@zutuanxue ~]# dnf install sendmail -y</span><br><span class="line">[root@zutuanxue ~]# systemctl start sendmail</span><br><span class="line">[root@zutuanxue ~]# ll /etc/cron.daily/0logwatch </span><br><span class="line">-rwxr-xr-x 1 root root 434 5月  11 2019 /etc/cron.daily/0logwatch</span><br><span class="line">[root@zutuanxue ~]# /etc/cron.daily/0logwatch </span><br><span class="line">[root@zutuanxue ~]# mail</span><br><span class="line">Heirloom Mail version 12.5 7/5/10.  Type ? for help.</span><br><span class="line">&quot;/var/spool/mail/root&quot;: 2 messages 1 new</span><br><span class="line">1 logwatch@zutuanxue.l Sat Dec 7 01:50 57/2011 &quot;Logwatch for localhos&quot;</span><br><span class="line">&gt;N 2 logwatch@zutuanxue.l Sat Dec 7 01:52 56/2000 &quot;Logwatch for localhos&quot;</span><br><span class="line">输入数字查看对应的邮件，输入q退出</span><br></pre></td></tr></table></figure>

<h1 id="linux日志服务器部署"><a href="#linux日志服务器部署" class="headerlink" title="linux日志服务器部署"></a>linux日志服务器部署</h1><p> 阅读 (162126) </p>
<p> 分享</p>
<h2 id="集中式日志服务器介绍"><a href="#集中式日志服务器介绍" class="headerlink" title="集中式日志服务器介绍"></a>集中式日志服务器介绍</h2><p>如果你负责管理数台的 Linux，你得登录每一台Linux 后，才能阅读其中的信息！ 这样是不是很麻烦？？ 那有没有什么更好的方案呢？</p>
<p>Linux 的系统日志服务，允许你把信息传递到某一台 Linux 的系统日志服务中；那你就可以把一台 Linux 作为日志服务器 （<em>Log Server</em>），而其他的 Linux 则当作日志客户端。此时，在作为日志服务器中就可以保存所有日志客户端产生的信息，因此，你就可以在日志服务器中阅读信息，而不用登录到其他的主机了。</p>
<h3 id="搭建流程"><a href="#搭建流程" class="headerlink" title="搭建流程"></a><strong>搭建流程</strong></h3><h4 id="环境准备："><a href="#环境准备：" class="headerlink" title="环境准备："></a>环境准备：</h4><p>server：192.168.1.55</p>
<p>client：192.168.1.18</p>
<h4 id="关闭SELinux和防火墙"><a href="#关闭SELinux和防火墙" class="headerlink" title="关闭SELinux和防火墙"></a>关闭SELinux和防火墙</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">关闭SELinux</span><br><span class="line">[root@zutuanxue ~]# vim /etc/sysconfig/selinux</span><br><span class="line">SELINUX=disabled</span><br><span class="line">[root@zutuanxue ~]# reboot</span><br><span class="line"></span><br><span class="line">关闭防火墙</span><br><span class="line">[root@zutuanxue ~]# systemctl stop firewalld</span><br><span class="line">[root@zutuanxue ~]# systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p><strong>setp 1 修改server端rsyslog服务配置文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyslog.conf</span><br><span class="line">开放通过UDP协议514端口接收日志信息功能</span><br><span class="line"> 19 module(load=&quot;imudp&quot;) </span><br><span class="line"> 20 input(type=&quot;imudp&quot; port=&quot;514&quot;)</span><br><span class="line">开放通过TCP协议514端口接收日志信息功能</span><br><span class="line"> 24 module(load=&quot;imtcp&quot;)</span><br><span class="line"> 25 input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span><br></pre></td></tr></table></figure>


<p><strong>step 2 重启server端rsyslog服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl restart rsyslog		#重启日志服务</span><br><span class="line">[root@zutuanxue ~]# systemctl status rsyslog		#确认服务启动状态</span><br></pre></td></tr></table></figure>

<p><strong>step 3 修改client端rsyslog服务配置文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyslog.conf </span><br><span class="line"> 67 *.*   			@192.168.1.55			</span><br><span class="line"> #告知客户端将所有日志信息使用UDP协议传送到日志服务器，日志服务器的ip地址为192.168.1.55</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> 68 #*.*              @@192.168.1.55</span><br><span class="line"> #也可以使用@@告诉客户端将所有日志信息使用TCP协议传送到日志服务器</span><br></pre></td></tr></table></figure>

<p><strong>step 4 重启client端rsyslog服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl restart rsyslog		#重启日志服务</span><br><span class="line">[root@zutuanxue ~]# systemctl status rsyslog		#查看服务状态</span><br></pre></td></tr></table></figure>

<p> <strong>step 5 测试</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server端使用tail命令查看日志信息</span><br><span class="line">[root@zutuanxue ~]# tail -f /var/log/messages </span><br><span class="line"></span><br><span class="line">client使用logger工具产生测试日志</span><br><span class="line">[root@zutuanxue ~]# logger &quot;this is a test from 192.168.1.18&quot;</span><br><span class="line"></span><br><span class="line">如果在server端能查看到logger工具产生的内容就证明集中式日志服务器搭建成功</span><br><span class="line">Dec  6 21:18:21 localhost root[2519]: this is a test from 192.168.1.18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注：其它的client端的设置都是相同的，这样我们就可以将很多台linux主机的日志信息都收集到一台主机上，方便查阅和后期的日志备份</span><br><span class="line">工作。</span><br></pre></td></tr></table></figure>

<h1 id="构建可视化日志管理服务器"><a href="#构建可视化日志管理服务器" class="headerlink" title="构建可视化日志管理服务器"></a>构建可视化日志管理服务器</h1><p> 阅读 (190511) </p>
<p> 分享</p>
<p>我们可以通过集中式日志服务器将多台机器的日志收集在一个日志服务器，然后通过脚本或者其他方式去分析，但是真正做过运维的小伙伴明白，日子收集在硬盘上，硬盘的空间有限且大文件分析起来IO压力超级大，分析日志需要高超的技术，一般运维人员分析起来会很困难，更无法实时的去查看某个机器的日志。这样的话我们的日志收集就变成了真正意义上的收集了，收集起来如何利用就变成了一个难题，总结一下主要的问题就是以下几点：</p>
<ul>
<li>日志文件巨大，硬盘IO压力大</li>
<li>无法实时分析</li>
<li>分析需要消耗很多计算机资源且困难</li>
</ul>
<p>如何解决这个问题呢？</p>
<ul>
<li>IO压力:我们可以将日志收集在数据库中，海量的日志通过分布式存储的底层支撑加上数据库对数据的高效管理，使得数据读写变得轻松，避免了原理日志服务器的IO压力。</li>
<li>无法实时分析：可以部署一个日志分析系统来辅助分析，苦难的分析工作瞬间变得简单。</li>
<li>分析需要消耗很多计算机资源：分布式处理分担处理压力</li>
</ul>
<p>接下来我就给大家介绍一款高性能的日志收集、存储、分析架构，<br>同时也是一个可以使用web页面查看日志的可视化架构：</p>
<h3 id="rsyslog-mariadb-loganalyzer"><a href="#rsyslog-mariadb-loganalyzer" class="headerlink" title="rsyslog+mariadb+loganalyzer"></a>rsyslog+mariadb+loganalyzer</h3><p>环境准备：与前面课程提到的集中式日志服务器的架构一样，只是这个架构是在server上搭建的，也就是IP地址为192.168.1.55的这台主机上</p>
<h3 id="server端的环境准备和设置"><a href="#server端的环境准备和设置" class="headerlink" title="server端的环境准备和设置"></a>server端的环境准备和设置</h3><p><strong>setp 1 安装所需要的软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install mariadb mariadb-server rsyslog-mysql -y</span><br></pre></td></tr></table></figure>

<p><strong>step 2 启动mariadb服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl restart mariadb</span><br><span class="line">[root@zutuanxue ~]# systemctl status mariadb</span><br></pre></td></tr></table></figure>

<p>**step 3 设置mariadb **</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">##将mariadb的管理员密码设置为‘123456’</span><br><span class="line">[root@zutuanxue ~]# mysqladmin -u root password 123456</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##建立日志服务需要用到的数据库</span><br><span class="line">[root@zutuanxue ~]# cd /usr/share/doc/rsyslog/</span><br><span class="line">[root@zutuanxue rsyslog]# mysql -u root -p &lt; mysql-createDB.sql </span><br><span class="line">Enter password: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##进入到mariadb中验证一下是否有一个叫Syslog的数据库，如果有就代表前面的操作成功</span><br><span class="line">[root@zutuanxue rsyslog]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| Syslog             |</span><br></pre></td></tr></table></figure>

<p><strong>step 4 为后面将要用到的用户进行授权，允许用户访问mairadb中的Syslog库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#允许一个叫syslogroot的用户从127.0.0.1、192.168.1.55、192.168.1.18这三个ip地址访问我的数据库，密码为syslogpass，设置完成之后刷新一下并退出（如果你的架构中还有其它的主机，只要修改数据库语句中的IP地址即可）</span><br><span class="line">MariaDB [(none)]&gt; grant all on Syslog.* to &#x27;syslogroot&#x27;@&#x27;127.0.0.1&#x27;identified by &#x27;syslogpass&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on Syslog.* to &#x27;syslogroot&#x27;@&#x27;192.168.1.55&#x27;identified by &#x27;syslogpass&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on Syslog.* to &#x27;syslogroot&#x27;@&#x27;192.168.1.18&#x27;identified by &#x27;syslogpass&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<p><strong>setp 5 修改rsyslog服务的配置文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/rsyslog.conf </span><br><span class="line">7 #### MODULES ####</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"> 24 module(load=&quot;imtcp&quot;) # needs to be done just once</span><br><span class="line"> 25 input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span><br><span class="line"> 26 module(load=&quot;ommysql&quot;)#加载一个叫ommysql的模块是日志服务可以连接mariadb</span><br><span class="line"> .</span><br><span class="line"> .</span><br><span class="line"> 65 local7.*                 /var/log    /boot.log</span><br><span class="line"> 66 </span><br><span class="line"> #告诉日志服务通过ommysql模块，将日志信息发送到192.168.1.55的Syslog库中，使用的用户名和密码就是我们在前一步设置的syslogroot,syslogpass</span><br><span class="line"> 67 *.*     :ommysql:192.168.1.55,Syslog,syslogroot,syslogpass</span><br><span class="line"> </span><br><span class="line"> ##重启日志服务</span><br><span class="line"> [root@zutuanxue ~]# systemctl restart rsyslog</span><br></pre></td></tr></table></figure>

<p><strong>step 6 测试一下日志信息能否记录到数据库中</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# logger &quot;hello test test test&quot;</span><br><span class="line">[root@zutuanxue ~]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">MariaDB [(none)]&gt; use Syslog;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [Syslog]&gt; select * from SystemEvents\G</span><br><span class="line">*************************** 8. row ***************************</span><br><span class="line">                ID: 8</span><br><span class="line">        CustomerID: NULL</span><br><span class="line">        ReceivedAt: 2019-12-07 03:22:31</span><br><span class="line">DeviceReportedTime: 2019-12-07 03:22:31</span><br><span class="line">          Facility: 1</span><br><span class="line">          Priority: 5</span><br><span class="line">          FromHost: localhost</span><br><span class="line">           Message: hello test test test</span><br><span class="line">###如果可以看到我们之前使用logger产生的日志信息及代表rsyslog可以将日志信息存入数据库中</span><br></pre></td></tr></table></figure>

<p><strong>step 7 设置client(192.168.1.18),此步骤是唯一一步需要对client的做出的设置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">##安装软件包</span><br><span class="line">[root@zutuanxue ~]# dnf install rsyslog-mysql -y</span><br><span class="line"></span><br><span class="line">##修改服务的配置文件添加相应内容(与server端添加的内容一致)</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyslog.conf</span><br><span class="line">module(load=&quot;ommysql&quot;)</span><br><span class="line">*.*     :ommysql:192.168.1.55,Syslog,syslogroot,syslogpass</span><br><span class="line">[root@zutuanxue ~]# systemctl restart rsyslog</span><br><span class="line"></span><br><span class="line">###测试一下client的日志信息能否在server端的数据库中查看</span><br><span class="line">###client</span><br><span class="line">[root@zutuanxue ~]# logger &quot;hello this is a test from client 18&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####server端使用与刚才相同的方法去查看内容</span><br><span class="line">MariaDB [Syslog]&gt; select * from SystemEvents\G</span><br><span class="line">*************************** 28. row ***************************</span><br><span class="line">                ID: 28</span><br><span class="line">        CustomerID: NULL</span><br><span class="line">        ReceivedAt: 2019-12-07 03:30:28</span><br><span class="line">DeviceReportedTime: 2019-12-07 03:30:28</span><br><span class="line">          Facility: 1</span><br><span class="line">          Priority: 5</span><br><span class="line">          FromHost: localhost</span><br><span class="line">           Message: hello this is a test from client 18</span><br></pre></td></tr></table></figure>

<p><strong>step 8 server端安装支持web页面查看日志的工具loganalyzer</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install httpd php php-mysqlnd php-gd -y</span><br><span class="line">[root@zutuanxue ~]# tar fx loganalyzer-4.1.8.tar.gz </span><br><span class="line">[root@zutuanxue ~]# cp -r loganalyzer-4.1.8/src/* /var/www/html/</span><br><span class="line">[root@zutuanxue ~]# cp loganalyzer-4.1.8/contrib/* /var/www/html/</span><br><span class="line">[root@zutuanxue ~]# cd /var/www/html/</span><br><span class="line">[root@zutuanxue html]# sh configure.sh </span><br><span class="line">[root@zutuanxue html]# systemctl restart httpd</span><br></pre></td></tr></table></figure>

<p><strong>step 9 在mariadb中创建lyzeruser工具需要用到的库、用户并授权</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue html]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">MariaDB [(none)]&gt; create database loganalyzer;</span><br><span class="line">Query OK, 1 row affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all on loganalyzer.* to lyzeruser@&#x27;192.168.1.55&#x27; identified by &#x27;lyzeruser&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<p><strong>step 10 打开浏览器，部署loganalyzer</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984849790.png" alt="image20191207164609190.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984863824.png" alt="image20191207164635046.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984880250.png" alt="image20191207164704698.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984908167.png" alt="image20191207164929730.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984925448.png" alt="image20191207164950624.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984941240.png" alt="image20191207165010297.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984960364.png" alt="image20191207165056960.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602984992390.png" alt="image20191207165711728.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602985008601.png" alt="image20191207165220988.png"></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602985020468.png" alt="image20191207165748067.png"></p>
<h1 id="linux磁盘基本管理"><a href="#linux磁盘基本管理" class="headerlink" title="linux磁盘基本管理"></a>linux磁盘基本管理</h1><p> 阅读 (201146) </p>
<p> 分享</p>
<h2 id="一、磁盘介绍"><a href="#一、磁盘介绍" class="headerlink" title="一、磁盘介绍"></a>一、磁盘介绍</h2><p>磁盘：计算机中的外部存储设备，负责存储计算机数据，并且断电后也能保持数据不丢失。</p>
<p><strong>磁盘分类：</strong></p>
<p>按照物理结构：</p>
<ul>
<li>机械磁盘</li>
<li>固态磁盘</li>
</ul>
<p>按照接口:</p>
<ul>
<li>IDE</li>
<li>SCSI</li>
<li>SATA</li>
<li>SAS</li>
<li>mSATA</li>
<li>M.2</li>
<li>NVME</li>
<li>PCIe</li>
</ul>
<p>按照尺寸：</p>
<ul>
<li>机械硬盘：1.8寸 2.5寸 3.5寸</li>
<li>固态硬盘：SATA: 2.5寸</li>
<li>M.2： 2242、2260、2280</li>
</ul>
<h2 id="二、熟悉磁盘的工作原理"><a href="#二、熟悉磁盘的工作原理" class="headerlink" title="二、熟悉磁盘的工作原理"></a>二、熟悉磁盘的工作原理</h2><p><strong>机械磁盘的读写数据依靠电机带动盘片转动来完成数据读写的。</strong></p>
<h4 id="机械磁盘剖析图"><a href="#机械磁盘剖析图" class="headerlink" title="机械磁盘剖析图"></a>机械磁盘剖析图</h4><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602986110096.jpeg" alt="机械硬盘结构.jpeg"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了使磁盘内部清洁，磁盘是在真空特殊环境中制作的，不能随意拆卸，拆开后基本报废了</span><br></pre></td></tr></table></figure>

<p>机械磁盘工作是依靠马达带动盘片转动，通过磁头来读取磁盘上的数据。</p>
<h3 id="磁盘术语"><a href="#磁盘术语" class="headerlink" title="磁盘术语"></a>磁盘术语</h3><h5 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h5><p>硬盘中一般会有多个盘片组成，每个盘片包含两个面，每个盘面都对应地有一个读&#x2F;写磁头。受到硬盘整体体积和生产成本的限制，盘片数量都受到限制，一般都在5片以内。盘片的编号自下向上从0开始，如最下边的盘片有0面和1面，再上一个盘片就编号为2面和3面。</p>
<h5 id="磁头"><a href="#磁头" class="headerlink" title="磁头"></a>磁头</h5><p>负责读取盘面数据的设备</p>
<h5 id="磁道"><a href="#磁道" class="headerlink" title="磁道"></a>磁道</h5><p>从盘片的最内侧向外有很多同心圆圈，我们称为磁道</p>
<h5 id="扇区"><a href="#扇区" class="headerlink" title="扇区"></a>扇区</h5><p>从圆心向外画直线，可以将磁道划分为若干个弧段，称之为扇区，一个扇区通常为<strong>512B</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602986039811.png" alt="disk2.png"></p>
<h5 id="磁柱"><a href="#磁柱" class="headerlink" title="磁柱"></a>磁柱</h5><p>硬盘通常由重叠的一组盘片构成，每个盘面都被划分为数目相等的磁道，并从外缘的“0”开始编号，具有相同编号的磁道形成一个圆柱，称之为磁盘的柱面。磁盘的柱面数与一个盘面上的磁道数是相等的。由于每个盘面都有自己的磁头，因此，盘面数等于总的磁头数。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602986025858.png" alt="disk3.png"></p>
<h2 id="三、磁盘的性能指标"><a href="#三、磁盘的性能指标" class="headerlink" title="三、磁盘的性能指标"></a>三、磁盘的性能指标</h2><h4 id="影响磁盘性能的指标"><a href="#影响磁盘性能的指标" class="headerlink" title="影响磁盘性能的指标"></a>影响磁盘性能的指标</h4><p><strong>寻道时间（seek time）</strong>【和 转速 相关】：Tseek，是指将读写磁头移动至正确的磁道上所需要的时间。寻道时间越短，I&#x2F;O操作越快，目前磁盘的平均寻道时间一般在3-15ms</p>
<p><strong>旋转延迟</strong>：Trotation，是指盘片旋转将请求数据所在的扇区移动到读写磁头下方所需要的时间。旋转延迟取决于磁盘转速，通常用磁盘旋转一周所需时间的1&#x2F;2表示。比如：7200rpm的磁盘平均旋转延迟大约为60*1000&#x2F;7200&#x2F;2 &#x3D; 4.17ms，而转速为15000rpm的磁盘其平均旋转延迟为2ms。</p>
<p><strong>数据传输时间</strong>：Ttransfer，是指完成传输所请求的数据所需要的时间</p>
<h4 id="衡量磁盘性能的指标"><a href="#衡量磁盘性能的指标" class="headerlink" title="衡量磁盘性能的指标"></a>衡量磁盘性能的指标</h4><p><strong>IOPS</strong>：IOPS（Input&#x2F;Output Per Second）即每秒的输入输出量（或读写次数），即指每秒内系统能处理的I&#x2F;O请求数量。随机读写频繁的应用，如小文件存储等，关注随机读写性能，IOPS是关键衡量指标。可以推算出磁盘的IOPS &#x3D; 1000ms &#x2F; (Tseek + Trotation + Transfer)，如果忽略数据传输时间，理论上可以计算出随机读写最大的IOPS。常见磁盘的随机读写最大IOPS为：</p>
<ul>
<li>7200rpm的磁盘 IOPS &#x3D; 76 IOPS</li>
<li>10000rpm的磁盘IOPS &#x3D; 111 IOPS</li>
<li>15000rpm的磁盘IOPS &#x3D; 166 IOPS</li>
</ul>
<p><strong>throughput ：</strong> 吞吐量指单位时间内可以成功传输的数据数量。 单位为（m&#x2F;s G&#x2F;s）</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602986155314.png" alt="3.png"></p>
<p><strong>文件系统：</strong>是告知操作系统使用何种方法和数据结构在存储设备或分区上读写数据的；是分区数据管家，负责如何将数据写入磁盘或者从磁盘读出</p>
<p>NTFS EXT3 EXT4 XFS ISO9660</p>
<p>具体有多少 man mount -t</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adfs,  affs,  autofs,  cifs,  coda,  coherent, cramfs,debugfs, devpts, efs, ext, ext2, ext3, ext4, hfs, hfsplus, hpfs,iso9660,  jfs, minix, msdos, ncpfs, nfs, nfs4, ntfs, proc, qnx4,ramfs, reiserfs, romfs, squashfs,  smbfs,  sysv,  tmpfs,  ubifs,udf,  ufs,  umsdos,  usbfs,  vfat, xenix, xfs, xiafs.</span><br></pre></td></tr></table></figure>

<p><strong>文件系统可以根据应用场景去选择使用哪一款，如果不会选择，推荐ext4或者XFS</strong></p>
<p><strong>page cache</strong></p>
<p>其实就是内存上空闲的部分 用来缓存数据，比如buffer cache</p>
<p>作用：对IO读写做优化</p>
<p>测试缓存对读写的影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">写</span><br><span class="line">[root@zutuanxue ~]# echo 3 &gt; /proc/sys/vm/drop_caches</span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1980          95        1807           9          77        1754</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/tmp/big bs=1M count=1000</span><br><span class="line">记录了1000+0 的读入</span><br><span class="line">记录了1000+0 的写出</span><br><span class="line">1048576000字节(1.0 GB)已复制，10.2412 秒，102 MB/秒</span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1980          95         779           9        1105        1698</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/tmp/big1 bs=1M count=1000</span><br><span class="line">记录了1000+0 的读入</span><br><span class="line">记录了1000+0 的写出</span><br><span class="line">1048576000字节(1.0 GB)已复制，7.89978 秒，133 MB/秒</span><br><span class="line"></span><br><span class="line">读</span><br><span class="line">[root@zutuanxue ~]# echo 3 &gt; /proc/sys/vm/drop_caches </span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1980          95        1805           9          79        1753</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@zutuanxue ~]# dd if=/tmp/big of=/dev/null </span><br><span class="line">记录了2048000+0 的读入</span><br><span class="line">记录了2048000+0 的写出</span><br><span class="line">1048576000字节(1.0 GB)已复制，2.23965 秒，468 MB/秒</span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1980          95         800           9        1084        1710</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line">[root@zutuanxue ~]# dd if=/tmp/big of=/dev/null </span><br><span class="line">记录了2048000+0 的读入</span><br><span class="line">记录了2048000+0 的写出</span><br><span class="line">1048576000字节(1.0 GB)已复制，1.92811 秒，544 MB/秒</span><br></pre></td></tr></table></figure>

<h2 id="四、linux磁盘的使用方法"><a href="#四、linux磁盘的使用方法" class="headerlink" title="四、linux磁盘的使用方法"></a>四、linux磁盘的使用方法</h2><h3 id="4-1、磁盘初始化"><a href="#4-1、磁盘初始化" class="headerlink" title="4.1、磁盘初始化"></a><strong>4.1、磁盘初始化</strong></h3><p> <strong>一块新的磁盘使用必须初始化为MBR或者GPT分区。</strong></p>
<ul>
<li><strong>MBR &lt;2TB fdisk</strong> <strong>4个主分区或者3个主分区+1个扩展分区（N个逻辑分区）</strong></li>
</ul>
<p>MBR(Master Boot Record)的缩写，由三部分组成，即：</p>
<ol>
<li><p>Bootloader（主引导程序）&#x3D;</p>
<p>446字节</p>
<ul>
<li>引导操作系统的主程序</li>
</ul>
</li>
<li><p>DPT分区表（Disk Partition Table）&#x3D;</p>
<p>64字节</p>
<ul>
<li>分区表保存了硬盘的分区信息，操作系统通过读取分区表内的信息，就能够获得该硬盘的分区信息</li>
<li>每个分区需要占用16个字节大小，保存有文件系统标识、起止柱面号、磁头号、扇区号、起始扇区位置（4个字节）、分区总扇区数目（4个字节）等内容</li>
<li>分区表中保存的分区信息都是主分区与扩展分区的分区信息，扩展分区不能直接使用，需要在扩展分区内划分一个或多个逻辑分区后才能使用</li>
<li>逻辑分区的分区信息保存在扩展分区内而不是保存在MBR分区表内，这样，就可以突破MBR分区表只能保存4个分区的限制</li>
</ul>
</li>
<li><p>硬盘有效标志（校验位）&#x3D;2个字节</p>
</li>
</ol>
<ul>
<li><strong>GPT &gt;2TB gdisk(parted) 128个主分区</strong></li>
</ul>
<p>注意：从MBR转到GPT，或从GPT转换到MBR会导致<strong>数据全部丢失</strong>！</p>
<h3 id="4-2、分区"><a href="#4-2、分区" class="headerlink" title="4.2、分区"></a><strong>4.2、分区</strong></h3><p> <strong>将磁盘合理分区，能使计算机或者使用者更快的存取数据</strong></p>
<p> MBR 主分区+扩展分区&lt;&#x3D;4</p>
<p> GPT 主分区&lt;&#x3D;128</p>
<h3 id="4-3、格式化"><a href="#4-3、格式化" class="headerlink" title="4.3、格式化"></a><strong>4.3、格式化</strong></h3><p> <strong>装载文件系统(相当于库管，负责数据的写入和读出)。</strong></p>
<p> 常见的文件系统:NTFS EXT EXT2 EXT3 EXT4 XFS vfat</p>
<h3 id="4-4、挂载"><a href="#4-4、挂载" class="headerlink" title="4.4、挂载"></a><strong>4.4、挂载</strong></h3><p> <strong>linux中设备不能直接使用，需要挂载到文件夹才可以。</strong></p>
<p>挂载方式：</p>
<ol>
<li>手动挂载</li>
<li>开机挂载</li>
<li>自动挂载</li>
</ol>
<h1 id="linux-磁盘分区与格式化"><a href="#linux-磁盘分区与格式化" class="headerlink" title="linux 磁盘分区与格式化"></a>linux 磁盘分区与格式化</h1><p> 阅读 (202241) </p>
<p> 分享</p>
<h2 id="一、基本分区管理"><a href="#一、基本分区管理" class="headerlink" title="一、基本分区管理"></a>一、基本分区管理</h2><h3 id="1-1、linux磁盘表示方法介绍"><a href="#1-1、linux磁盘表示方法介绍" class="headerlink" title="1.1、linux磁盘表示方法介绍"></a>1.1、linux磁盘表示方法介绍</h3><h5 id="硬盘命名方式"><a href="#硬盘命名方式" class="headerlink" title="硬盘命名方式"></a>硬盘命名方式</h5><table>
<thead>
<tr>
<th>OS</th>
<th>IDE(并口)</th>
<th>SATA(串口)</th>
<th>SCSI</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS6</td>
<td>&#x2F;dev&#x2F;hda</td>
<td>&#x2F;dev&#x2F;sda</td>
<td>&#x2F;dev&#x2F;sda</td>
</tr>
<tr>
<td>CentOS7</td>
<td>&#x2F;dev&#x2F;sda</td>
<td>&#x2F;dev&#x2F;sda</td>
<td>&#x2F;dev&#x2F;sda</td>
</tr>
<tr>
<td>CentOS8</td>
<td>&#x2F;dev&#x2F;sda</td>
<td>&#x2F;dev&#x2F;sda</td>
<td>&#x2F;dev&#x2F;sda</td>
</tr>
</tbody></table>
<h5 id="磁盘设备的命名"><a href="#磁盘设备的命名" class="headerlink" title="磁盘设备的命名"></a>磁盘设备的命名</h5><p>&#x2F;dev&#x2F;sda2</p>
<p>s&#x3D;硬件接口类型（sata&#x2F;scsi）,d&#x3D;disk（硬盘）,a&#x3D;第1块硬盘（b，第二块），2&#x3D;第几个分区<br>&#x2F;dev&#x2F;hd h&#x3D;IDE硬盘 &#x2F;dev&#x2F;hdd3<br>&#x2F;dev&#x2F;vd v&#x3D;虚拟硬盘 &#x2F;dev&#x2F;vdf7</p>
<h5 id="HP服务器硬盘"><a href="#HP服务器硬盘" class="headerlink" title="HP服务器硬盘"></a>HP服务器硬盘</h5><p>&#x2F;dev&#x2F;cciss&#x2F;c0d0<br>&#x2F;dev&#x2F;cciss&#x2F;c0d0p1 c0第一个控制器, d0第一块磁盘, p1分区1<br>&#x2F;dev&#x2F;cciss&#x2F;c0d0p2 c0第一个控制器, d0第一块磁盘, p2分区2</p>
<h3 id="1-2、磁盘分区"><a href="#1-2、磁盘分区" class="headerlink" title="1.2、磁盘分区"></a>1.2、磁盘分区</h3><h4 id="1）、磁盘划分思路"><a href="#1）、磁盘划分思路" class="headerlink" title="1）、磁盘划分思路"></a>1）、磁盘划分思路</h4><ul>
<li>进入分区表 新建分区</li>
<li>更新分区表&lt;刷新分区表&gt;</li>
<li>格式化分区——&gt;文件系统</li>
</ul>
<h4 id="2）、磁盘分区"><a href="#2）、磁盘分区" class="headerlink" title="2）、磁盘分区"></a>2）、磁盘分区</h4><p>fdisk命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fdisk磁盘分区命令</span><br><span class="line">fidsk  [命令选项] [参数]</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-l   list 列出磁盘分区</span><br><span class="line">-u   与-l一起使用，显示分区的相关信息</span><br><span class="line"></span><br><span class="line">fdisk /dev/sda    为/dev/sda分区</span><br><span class="line">m ：显示菜单和帮助信息</span><br><span class="line">a ：活动分区标记/引导分区</span><br><span class="line">d ：删除分区</span><br><span class="line">l ：显示分区类型</span><br><span class="line">n ：新建分区</span><br><span class="line">p ：显示分区信息</span><br><span class="line">q ：退出不保存</span><br><span class="line">t ：设置分区号</span><br><span class="line">v ：进行分区检查</span><br><span class="line">w ：保存修改</span><br><span class="line">x ：扩展应用，高级功能</span><br></pre></td></tr></table></figure>

<p>分区前了解设备信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># lsblk		查看块设备</span><br><span class="line"># df -h  查看正在挂载的设备情况</span><br><span class="line"># blkid  打印某个已经格式化分区的UUID</span><br><span class="line"># fdisk -l		查看当前系统的所有设备分区情况</span><br><span class="line"># fdisk  /dev/sdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# fdisk  -l /dev/sdb</span><br><span class="line">硬盘容量　＝　柱面数　×　盘面数（磁头数）　×　扇区数　×　扇区大小（一般为512字节）</span><br><span class="line">Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors	磁盘空间统计，大小和扇区数量</span><br><span class="line">几何属性：255 个磁头, 63 个扇区/磁道, 2610 个柱面</span><br><span class="line"> ###此行内容只有在使用fdisk分区时，使用c命令加上与dos兼容的标记时才会出现，这里面所提到的磁头等数量与磁盘中的物理寻址和逻辑块寻址相关，而且它们都是逻辑地址，产生访问时，磁盘控制器会把这些确定的逻辑地址转换为实际的物理地址；对于我们来讲这几个数值可以帮助我们计算磁盘空间的大小以及一个磁柱的大小，比如说</span><br><span class="line"> ##一个磁柱的容量=255x63x512=8225280（约8M空间）</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x178c5f83</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 设备       启动    起点     末尾     扇区 		大小 Id 类型</span><br><span class="line">/dev/sda1  *       2048  2099199  2097152   1G 83 Linux</span><br><span class="line">/dev/sda2       2099200 41943039 39843840  19G 8e Linux LVM</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：</span><br></pre></td></tr></table></figure>

<p><strong>fdisk分区总结</strong><br>命令缺点：单个分区不能超过2T 超过的话需要用parted命令<br>在linux 下大磁盘的分区不能再采用fdisk了，MBR分区表只支持2T磁盘，所以大于2T的磁盘必须使用GPT分区表。</p>
<h5 id="3）、磁盘格式化"><a href="#3）、磁盘格式化" class="headerlink" title="3）、磁盘格式化"></a>3）、磁盘格式化</h5><p>格式化(format)是指对磁盘或磁盘中的分区（partition）进行初始化的一种操作，这种操作通常会导致现有的磁盘或分区中所有的文件被清除。格式化通常分为低级格式化和高级格式化。如果没有特别指明，对硬盘的格式化通常是指高级格式化，而对软盘的格式化则通常同时包括这两者。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-L 标签名</span><br><span class="line">-V : 详细显示模式</span><br><span class="line">-t : 给定档案系统的型式，Linux 的预设值为 ext2</span><br><span class="line">-c : 在制做档案系统前，检查该partition 是否有坏轨</span><br><span class="line">-l bad_blocks_file : 将有坏轨的block资料加到 bad_blocks_file 里面</span><br><span class="line">-b : 给定 block 的大小</span><br><span class="line"></span><br><span class="line">关于block and inode  dentry</span><br><span class="line">实验发现这句话不对</span><br><span class="line">block越大，inode越少，适合存储大文件的文件系统；block越小，inode越多，适合存储文件多而小的文件系统。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">磁盘分区格式化</span><br><span class="line">mkfs.ext4 /dev/sda3</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<p>MBR分区表最多允许4个主分区，或者3个主分区+1个扩展分区</p>
<p>扩展分区不能直接存储数据</p>
<p>扩展分区的大小决定了所有逻辑分区的大小，逻辑分区的编号从5开始</p>
<p>删除扩展分区后下面的逻辑分区都被删除</p>
<p>分完区后需要手动刷新分区表，如果刷新不成功需要重启操作系统</p>
<p>创建分区的时候尽可能注意分区序号的连续性</p>
<h1 id="GPT磁盘管理"><a href="#GPT磁盘管理" class="headerlink" title="GPT磁盘管理"></a>GPT磁盘管理</h1><p> 阅读 (118522) </p>
<p> 分享</p>
<p>GPT分区工具：gdisk gdisk</p>
<p><strong>gdisk分区</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">GPT  128个主分区</span><br><span class="line">[root@zutuanxue ~]# gdisk -l /dev/sdc</span><br><span class="line">[root@zutuanxue ~]# gdisk -l /dev/sdc   查看sdc信息</span><br><span class="line">GPT fdisk (gdisk) version 1.0.3</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: MBR only</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: not present			###GPT分区无法使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************************************</span><br><span class="line">Found invalid GPT and valid MBR; converting MBR to GPT format</span><br><span class="line">in memory. </span><br><span class="line">***************************************************************</span><br><span class="line"></span><br><span class="line">Disk /dev/sdc: 41943040 sectors, 20.0 GiB</span><br><span class="line">Model: VMware Virtual S</span><br><span class="line">Sector size (logical/physical): 512/512 bytes</span><br><span class="line">Disk identifier (GUID): B228357D-34EC-4E47-BB81-A7312F3BCF8D</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33</span><br><span class="line">First usable sector is 34, last usable sector is 41943006</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 37748669 sectors (18.0 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048         2099199   1024.0 MiB  8300  Linux filesystem</span><br><span class="line">   2         2099200         4196351   1024.0 MiB  8300  Linux filesystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">将MBR转换成GPT分区</span><br><span class="line">[root@zutuanxue ~]# gdisk /dev/sdc</span><br><span class="line">GPT fdisk (gdisk) version 1.0.3</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: MBR only</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: not present</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***************************************************************</span><br><span class="line">Found invalid GPT and valid MBR; converting MBR to GPT format</span><br><span class="line">in memory. THIS OPERATION IS POTENTIALLY DESTRUCTIVE! Exit by</span><br><span class="line">typing &#x27;q&#x27; if you don&#x27;t want to convert your MBR partitions</span><br><span class="line">to GPT format!</span><br><span class="line">***************************************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (? for help): o</span><br><span class="line">This option deletes all partitions and creates a new protective MBR.</span><br><span class="line">Proceed? (Y/N): y</span><br><span class="line"></span><br><span class="line">Command (? for help): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sdc.</span><br><span class="line">The operation has completed successfully.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# gdisk -l /dev/sdc</span><br><span class="line">GPT fdisk (gdisk) version 1.0.3</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present			###GPT可用了</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.</span><br><span class="line">Disk /dev/sdc: 41943040 sectors, 20.0 GiB</span><br><span class="line">Model: VMware Virtual S</span><br><span class="line">Sector size (logical/physical): 512/512 bytes</span><br><span class="line">Disk identifier (GUID): 7CA4232A-4A9E-467D-AADD-BB84DB2126E3</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33</span><br><span class="line">First usable sector is 34, last usable sector is 41943006</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 41942973 sectors (20.0 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#再次分区</span><br><span class="line">[root@zutuanxue ~]# gdisk /dev/sdc</span><br><span class="line">GPT fdisk (gdisk) version 1.0.3</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.</span><br><span class="line"></span><br><span class="line">Command (? for help): n</span><br><span class="line">Partition number (1-128, default 1): 1</span><br><span class="line">First sector (34-41943006, default = 2048) or &#123;+-&#125;size&#123;KMGTP&#125;: </span><br><span class="line">Last sector (2048-41943006, default = 41943006) or &#123;+-&#125;size&#123;KMGTP&#125;: +2G</span><br><span class="line">Current type is &#x27;Linux filesystem&#x27;</span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): </span><br><span class="line">Changed type of partition to &#x27;Linux filesystem&#x27;</span><br><span class="line"></span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk /dev/sdc: 41943040 sectors, 20.0 GiB</span><br><span class="line">Model: VMware Virtual S</span><br><span class="line">Sector size (logical/physical): 512/512 bytes</span><br><span class="line">Disk identifier (GUID): 7CA4232A-4A9E-467D-AADD-BB84DB2126E3</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33</span><br><span class="line">First usable sector is 34, last usable sector is 41943006</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 37748669 sectors (18.0 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048         4196351   2.0 GiB     8300  Linux filesystem</span><br><span class="line">Command (? for help): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sdc.</span><br><span class="line">The operation has completed successfully.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# partprobe /dev/sdc</span><br><span class="line"></span><br><span class="line">2.创建文件系统（格式化）CentOS8默认使用xfs</span><br><span class="line">[root@zutuanxue ~]# mkfs.xfs -f /dev/sdc1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.挂载</span><br><span class="line">[root@zutuanxue ~]# mkdir /disk1</span><br><span class="line">[root@zutuanxue ~]# mount -t xfs -o ro /dev/sdc1 /disk1		//手动挂载</span><br><span class="line">[root@zutuanxue ~]# umount /disk1		##卸载</span><br></pre></td></tr></table></figure>

<h1 id="linux分区挂载"><a href="#linux分区挂载" class="headerlink" title="linux分区挂载"></a>linux分区挂载</h1><p> 阅读 (191808) </p>
<p> 分享</p>
<p>磁盘在linux中经过分区、格式化后是无法直接使用的，因为该分区在系统中是以一个设备文件的形式存在的。我们如果希望使用这个磁盘分区还得经过最后一步，就是将这个分区设备挂载到系统中的某个文件夹下。这样你往这个挂载文件夹里存东西其实即使往分区里存东西了。<br>接下来我们来看看linux下挂载磁盘分区的方式</p>
<ul>
<li>手动挂载</li>
<li>开机自动挂载</li>
<li>触发挂载</li>
</ul>
<h2 id="一、手动挂载"><a href="#一、手动挂载" class="headerlink" title="一、手动挂载"></a>一、手动挂载</h2><p>mount挂载命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mount - mount a filesystem</span><br><span class="line"></span><br><span class="line">命令语法</span><br><span class="line">mount device dir</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-a   挂载所有文件系统，参考文件 /etc/fstab</span><br><span class="line">-l   显示当前挂载</span><br><span class="line">-t   文件系统类型</span><br><span class="line">-o   指定挂载权限</span><br><span class="line"></span><br><span class="line">##用法说明</span><br><span class="line">mount   [options]     需要挂载的设备     挂载点</span><br><span class="line">特点：系统重启后需要重新挂载；手动卸载后需要手动挂载</span><br><span class="line"></span><br><span class="line">-o:挂载选项	ro,sync,rw,remount</span><br><span class="line">-t:文件系统类型</span><br><span class="line">mount -t nfs=mount.nfs</span><br><span class="line">mount -t cifs=mount.cifs</span><br></pre></td></tr></table></figure>

<p>挂载分区演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#案列1：以只读的方式重新挂载/u02分区</span><br><span class="line">[root@zutuanxue ~]# mount -o remount,ro /u02		//可以是挂载点也可以是设备</span><br><span class="line">remount:重新挂载一个正在挂载的设备</span><br><span class="line"></span><br><span class="line"># mount -o remount,ro /dev/sdb1		</span><br><span class="line"># mount -o remount,ro /u01</span><br><span class="line">注意：后面可以根挂载点也可以跟设备本身</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例2: 如果希望将本机的某个文件夹挂到另一个文件夹</span><br><span class="line">mount -o bind /etc /opt/data3</span><br></pre></td></tr></table></figure>

<p>设备表示方法：</p>
<ul>
<li>设备文件</li>
<li>设备UUID</li>
<li>设备的卷标</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#设备文件：</span><br><span class="line">/dev/sdb</span><br><span class="line">/dev/sdb1</span><br><span class="line"></span><br><span class="line">#通过UUID表示设备</span><br><span class="line">[root@zutuanxue ~]# blkid /dev/sdb1				//查看设备的UUID和文件系统类型</span><br><span class="line">/dev/sdb1: UUID=&quot;96b67b7b...&quot; TYPE=&quot;xfs&quot; PARTUUID=&quot;80e196f2-01&quot;</span><br><span class="line">[root@zutuanxue ~]# blkid /dev/sdb2</span><br><span class="line">/dev/sdb2: UUID=&quot;6821-049E&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;80e196f2-02&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#通过卷标表示设备</span><br><span class="line">#不同类型分区卷标管理与查看</span><br><span class="line">ext*设置&amp;查看卷标</span><br><span class="line">[root@zutuanxue ~]# e2label /dev/sdb1 DISK1			ext*设置卷标</span><br><span class="line">[root@zutuanxue ~]# e2label /dev/sdb1						ext*查看卷标</span><br><span class="line"></span><br><span class="line">xfs设置&amp;查看卷标</span><br><span class="line">[root@zutuanxue ~]# xfs_admin -L DISK1 /dev/sdb1	xfs设置卷标</span><br><span class="line">[root@zutuanxue ~]# xfs_admin -l /dev/sdb1				xfs查看卷标</span><br><span class="line">label = &quot;DISK1&quot;</span><br><span class="line"></span><br><span class="line">vfat设置&amp;查看卷标</span><br><span class="line">[root@zutuanxue ~]# dosfslabel /dev/sdb2 hello</span><br><span class="line">[root@zutuanxue ~]# dosfslabel /dev/sdb2</span><br><span class="line"></span><br><span class="line">也可以使用blkid查看卷标</span><br><span class="line">[root@zutuanxue ~]# blkid /dev/sdb1</span><br><span class="line">/dev/sdb1: LABEL=&quot;DISK1&quot; UUID=&quot;96..&quot; TYPE=&quot;xfs&quot; PARTUUID=&quot;80..-01&quot;</span><br><span class="line">[root@zutuanxue ~]# blkid /dev/sdb2</span><br><span class="line">/dev/sdb2: LABEL=&quot;disk2&quot; UUID=&quot;6...&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;8e.2-02&quot;</span><br></pre></td></tr></table></figure>

<p>umount设备卸载命令<br>命令详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">umount - 卸载文件系统</span><br><span class="line"></span><br><span class="line">umount 设备挂载点|设备源</span><br><span class="line"></span><br><span class="line">-l  懒惰卸载</span><br></pre></td></tr></table></figure>

<p>命令用法演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">卸载设备：umount</span><br><span class="line">[root@zutuanxue ~]# umount /u01</span><br><span class="line">[root@zutuanxue ~]# umount /dev/sdb2</span><br></pre></td></tr></table></figure>

<h2 id="二、开机自动挂载："><a href="#二、开机自动挂载：" class="headerlink" title="二、开机自动挂载："></a>二、开机自动挂载：</h2><p>自动挂载 &#x2F;etc&#x2F;fstab文件<br>特点：系统开机或重启会自动挂载；手动卸载后，使用mount -a自动挂载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">文件内容格式：</span><br><span class="line">要挂载的资源路径	挂载点	文件系统类型	挂载选项	dump备份支持  文件系统检测</span><br><span class="line">UUID=289370eb-9459-42a8-8cee-7006507f1477   /      ext4    defaults        1 1</span><br><span class="line"></span><br><span class="line">#字段说明</span><br><span class="line">1段：挂载的设备（磁盘设备的文件名或设备的卷标或者是设备的UUID）</span><br><span class="line">2段：挂载点（建议用一个空目录），建议不要将多个设备挂载到同一个挂载点上</span><br><span class="line">3段：文件系统类型（ext3、ext4、vfat、ntfs（安装软件包）、swap等等）</span><br><span class="line">4段：挂载选项</span><br><span class="line">dev/nodev		被挂载的设备上的设备文件，是否被识别为设备文件</span><br><span class="line">async/sync  异步/同步 同步利于数据保存 异步利于提高性能</span><br><span class="line">auto/noauto     自动/非自动：</span><br><span class="line">rw/ro   读写/只读：</span><br><span class="line">exec/noexec     被挂载设备中的可执行文件是否可执行</span><br><span class="line">remount     重新挂在一个已经挂载的文件系统，常用于修改挂载参数</span><br><span class="line">user/nouser     允许/不允许其他普通用户挂载：</span><br><span class="line">suid/nosuid     具有/不具有suid权限：该文件系统是否允许SUID的存在。</span><br><span class="line">usrquota    这个是在启动文件系统的时候，让其支持磁盘配额，这个是针对用户的。</span><br><span class="line">grpquota    支持用户组的磁盘配额。</span><br><span class="line">....</span><br><span class="line">defaults 同时具有rw, dev, exec,  async,nouser等参数。</span><br><span class="line">更多挂载选项可以通过 man mount  -o 命令选项可以找到详细信息</span><br><span class="line"></span><br><span class="line">5段：是否支持dump备份。//dump是一个用来备份的命令，0代表不要做dump备份，1代表要每天进行dump的动作，2也代表其他不定日期的dump备份。通常这个数值不是0就是1。数字越小优先级越高。</span><br><span class="line"></span><br><span class="line">6段：是否用 fsck 检验扇区。//开机的过程中，系统默认会用fsck检验文件系统是否完整。0是不要检验，1表示最先检验(一般只有根目录会设定为1)，2也是要检验，只是1是最先，2是其次才进行检验。</span><br><span class="line"></span><br><span class="line"># fsck -f /dev/sdb2		强制检验/dev/sdb2上文件系统</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">要挂载的资源路径可以是文件系统的UUID，设备路径，文件系统的标签 ，光盘镜像文件（iso），亦或是来自网络的共享资源等</span><br></pre></td></tr></table></figure>

<h2 id="三、自动挂载-Automount："><a href="#三、自动挂载-Automount：" class="headerlink" title="三、自动挂载 Automount："></a>三、自动挂载 Automount：</h2><p>特点：挂载是由访问产生；卸载是由超时产生；依赖于后台的autofs服务</p>
<p>思路：</p>
<ol>
<li>所有的监控都是由一个程序完成 autofs</li>
<li>服务启动后才会监控挂载的设备</li>
<li>修改配置文件来指定需要监控的设备</li>
</ol>
<p>案例演示<br>需求：让系统自动挂载&#x2F;dev&#x2F;sdb2设备，如果2分钟没有被用自动卸载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1）安装autofs软件</span><br><span class="line">[root@zutuanxue ~]# rpm -q autofs</span><br><span class="line">package autofs is not installed</span><br><span class="line">[root@zutuanxue ~]# dnf install autofs</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# rpm -q autofs</span><br><span class="line">autofs-5.1.4-29.el8.x86_64</span><br><span class="line">2）修改配置文件（指定需要监控的设备和挂载的目录）</span><br><span class="line">vim /etc/auto.master		//定义一级挂载点/u01和子配置文件</span><br><span class="line">/u01    /etc/auto.test	-t 120 或者 --timeout 120  单位秒   （设置超时时间去卸载）</span><br><span class="line"></span><br><span class="line">vim /etc/auto.test			//子配置文件自己创建，定义二级挂载点和需要挂载的设备</span><br><span class="line">test  -fstype=ext4,ro   :/dev/sdb2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3）重启服务</span><br><span class="line">[root@zutuanxue ~]# systemctl restart autofs</span><br><span class="line"></span><br><span class="line">4）测试验证</span><br><span class="line">[root@zutuanxue ~]# ls /u01/test</span><br><span class="line">[root@zutuanxue ~]# df -h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">后续补充：</span><br><span class="line">如果想要将/dev/sdb2挂载到/u01下，怎么做？</span><br><span class="line">vim /etc/auto.master</span><br><span class="line">/-		/etc/auto.test</span><br><span class="line"></span><br><span class="line">vim /etc/auto.test</span><br><span class="line">/u01	-fstype=ext4 :/dev/sdb2</span><br></pre></td></tr></table></figure>

<h1 id="linux磁盘使用实战案例"><a href="#linux磁盘使用实战案例" class="headerlink" title="linux磁盘使用实战案例"></a>linux磁盘使用实战案例</h1><p> 阅读 (215659) </p>
<p> 分享</p>
<p><strong>案例需求：</strong></p>
<p>添加一块硬盘，需要将其分区，最终需要使用2G空间。</p>
<p><strong>案例思路</strong></p>
<ol>
<li>增加一块硬盘</li>
<li>使用fdisk命令进行分区</li>
<li>格式化指定分区</li>
<li>创建一个空的目录作为挂载点</li>
<li>挂载使用</li>
<li>创建新的挂载点</li>
<li>挂载使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1. 增加硬盘</span><br><span class="line">增加完硬盘记得重启系统</span><br><span class="line"># lsblk	查看硬盘是否添加成功</span><br><span class="line">...</span><br><span class="line">sdb           8:16   0   20G  0 disk </span><br><span class="line">[root@zutuanxue ~]# fdisk -l /dev/sdb</span><br><span class="line">Disk /dev/sdb：20 GiB，21474836480 字节，41943040 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">2. 使用fdisk命令分区</span><br><span class="line">[root@zutuanxue ~]# fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">欢迎使用 fdisk (util-linux 2.32.1)。</span><br><span class="line">更改将停留在内存中，直到您决定将更改写入磁盘。</span><br><span class="line">使用写入命令前请三思。</span><br><span class="line"></span><br><span class="line">设备不包含可识别的分区表。</span><br><span class="line">创建了一个磁盘标识符为 0x0c7799c3 的新 DOS 磁盘标签。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line">Disk /dev/sdb：20 GiB，21474836480 字节，41943040 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x0c7799c3</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">分区类型</span><br><span class="line">   p   主分区 (0个主分区，0个扩展分区，4空闲)</span><br><span class="line">   e   扩展分区 (逻辑分区容器)</span><br><span class="line">选择 (默认 p)：p</span><br><span class="line">分区号 (1-4, 默认  1): </span><br><span class="line">第一个扇区 (2048-41943039, 默认 2048): </span><br><span class="line">上个扇区，+sectors 或 +size&#123;K,M,G,T,P&#125; (2048-41943039, 默认 41943039): +1G</span><br><span class="line"></span><br><span class="line">创建了一个新分区 1，类型为“Linux”，大小为 1 GiB。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line">Disk /dev/sdb：20 GiB，21474836480 字节，41943040 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x80e196f2</span><br><span class="line"></span><br><span class="line">设备       启动  起点    末尾    扇区 大小 Id 类型</span><br><span class="line">/dev/sdb1        2048 2099199 2097152   1G 83 Linux</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">分区类型</span><br><span class="line">   p   主分区 (1个主分区，0个扩展分区，3空闲)</span><br><span class="line">   e   扩展分区 (逻辑分区容器)</span><br><span class="line">选择 (默认 p)：p</span><br><span class="line">分区号 (2-4, 默认  2): 2</span><br><span class="line">第一个扇区 (2099200-41943039, 默认 2099200): </span><br><span class="line">上个扇区，+sectors 或 +size&#123;K,M,G,T,P&#125; (2099200-41943039, 默认 41943039): +1G</span><br><span class="line"></span><br><span class="line">创建了一个新分区 2，类型为“Linux”，大小为 1 GiB。</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line">Disk /dev/sdb：20 GiB，21474836480 字节，41943040 个扇区</span><br><span class="line">单元：扇区 / 1 * 512 = 512 字节</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x80e196f2</span><br><span class="line"></span><br><span class="line">设备       启动    起点    末尾    扇区 大小 Id 类型</span><br><span class="line">/dev/sdb1          2048 2099199 2097152   1G 83 Linux</span><br><span class="line">/dev/sdb2       2099200 4196351 2097152   1G 83 Linux</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line">分区表已调整。</span><br><span class="line">将调用 ioctl() 来重新读分区表。</span><br><span class="line">正在同步磁盘。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 再次查看分区情况</span><br><span class="line"># lsblk</span><br><span class="line">sdb                       8:16   0   20G  0 disk </span><br><span class="line">├─sdb1                    8:17   0    1G  0 part </span><br><span class="line">└─sdb2                    8:18   0    1G  0 part </span><br><span class="line"></span><br><span class="line">4. 刷新分区表信息</span><br><span class="line">[root@zutuanxue ~]# partprobe /dev/sdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5. 格式化分区</span><br><span class="line">[root@zutuanxue ~]# mkfs.xfs /dev/sdb1</span><br><span class="line">[root@zutuanxue ~]# mkfs.vfat /dev/sdb2</span><br><span class="line"></span><br><span class="line">6. 创建新的挂载点</span><br><span class="line">[root@zutuanxue ~]# mkdir /u01</span><br><span class="line">[root@zutuanxue ~]# mkdir /u02</span><br><span class="line"></span><br><span class="line">7. 挂载使用</span><br><span class="line">[root@zutuanxue ~]# mount /dev/sdb1 /u01</span><br><span class="line">[root@zutuanxue ~]# mount /dev/sdb2 /u02</span><br></pre></td></tr></table></figure>

<h1 id="LVM逻辑卷介绍"><a href="#LVM逻辑卷介绍" class="headerlink" title="LVM逻辑卷介绍"></a>LVM逻辑卷介绍</h1><p> 阅读 (170396) </p>
<p> 分享</p>
<p>在分区的时候，每个分区应该分多大是令人头疼的，而且随着长时间的运行，分区不管你分多大，都会被数据给占满。当遇到某个分区不够用时管理员可能甚至要备份整个系统、清除硬盘、重新对硬盘分区，然后恢复数据到新分区。</p>
<p>虽然现在有很多动态调整磁盘的工具可以使用，但是它并不能完全解决问题，因为某个分区可能会再次被耗尽；另外一个方面这需要重新引导系统才能实现，对于很多关键的服务器，停机是不可接受的，而且对于添加新硬盘，希望一个能跨越多个硬盘驱动器的文件系统时，分区调整程序就不能解决问题。</p>
<p>因此完美的解决方法应该是在零停机前提下可以自如对文件系统的大小进行调整，可以方便实现文件系统跨越不同磁盘和分区。那么我们可以通过逻辑盘卷管理（LVM，Logical Volume Manager）的方式来非常完美的实现这一功能。</p>
<p>解决思路：将所有可用存储汇集成池，当池中某个分区空间不够时就会从池中继续划分空间给分区，池中空间不够就可以通过加硬盘的方式来解决。</p>
<h2 id="一、逻辑卷介绍"><a href="#一、逻辑卷介绍" class="headerlink" title="一、逻辑卷介绍"></a>一、逻辑卷介绍</h2><p>逻辑卷（LVM）：它是Linux环境下对磁盘分区进行管理的一种机制，它是建立在<strong>物理存储设备</strong>之上的一个抽象层，优点在于<strong>灵活</strong>管理。<br><strong>特点：</strong><br>1、动态在线扩容<br>2、离线裁剪<br>3、数据条带化<br>4、数据镜像</p>
<h2 id="二、名词解释："><a href="#二、名词解释：" class="headerlink" title="二、名词解释："></a>二、名词解释：</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602992183885.png" alt="lvm.png"></p>
<ul>
<li>物理卷<br>物理卷就是指硬盘分区或从逻辑上与磁盘分区具有同样功能的设备(如RAID)，是LVM的基本存储逻辑块，但和基本的物理存储介质（如分区、磁盘等）比较，却包含有与LVM相关的管理参数</li>
<li>卷组<br>LVM卷组类似于非LVM系统中的物理硬盘，其由物理卷组成。可以在卷组上创建一个或多个“LVM分区”（逻辑卷），LVM卷组由一个或多个物理卷组成。</li>
<li>逻辑卷<br>LVM的逻辑卷类似于非LVM系统中的硬盘分区，在逻辑卷之上可以建立文件系统(比如&#x2F;home或者&#x2F;usr等)。</li>
<li>PE<br>每一个物理卷被划分为称为PE(Physical Extents)的基本单元，具有唯一编号的PE是可以被LVM寻址的最小单元。PE的大小是可配置的，默认为4MB。</li>
<li>LE<br>逻辑卷也被划分为被称为LE(Logical Extents) 的可被寻址的基本单位。在同一个卷组中，LE的大小和PE是相同的，并且一一对应。</li>
</ul>
<h2 id="三、逻辑卷使用流程"><a href="#三、逻辑卷使用流程" class="headerlink" title="三、逻辑卷使用流程"></a>三、逻辑卷使用流程</h2><p>真实的物理设备—-&gt;物理卷（pv）—-&gt;卷组（vg）—-&gt;逻辑卷（lv）——&gt;逻辑卷格式化—-&gt;挂载使用</p>
<h1 id="逻辑卷常用命令"><a href="#逻辑卷常用命令" class="headerlink" title="逻辑卷常用命令"></a>逻辑卷常用命令</h1><p> 阅读 (241252) </p>
<p> 分享</p>
<h2 id="一、物理卷管理"><a href="#一、物理卷管理" class="headerlink" title="一、物理卷管理"></a>一、物理卷管理</h2><h3 id="1-1、物理卷的创建-pvcreate命令"><a href="#1-1、物理卷的创建-pvcreate命令" class="headerlink" title="1.1、物理卷的创建:pvcreate命令"></a>1.1、物理卷的创建:pvcreate命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pvcreate    [命令选项]    [参数]</span><br><span class="line">将物理分区转换为物理卷</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-f：强制创建物理卷，不需要用户确认；</span><br><span class="line">-u：指定设备的UUID；</span><br><span class="line">-y：所有的问题都回答“yes”；</span><br><span class="line">-Z：是否利用前4个扇区。</span><br></pre></td></tr></table></figure>

<h3 id="1-2、物理卷的移除-pvremove命令"><a href="#1-2、物理卷的移除-pvremove命令" class="headerlink" title="1.2、物理卷的移除:pvremove命令"></a>1.2、物理卷的移除:pvremove命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pvremove    [命令选项]    [参数]</span><br><span class="line">将物理卷转换为普通linux分区</span><br><span class="line"></span><br><span class="line">命令选项</span><br><span class="line">-d  调试模式</span><br><span class="line">-f  强制删除</span><br><span class="line">-y  对提问回答“yes”</span><br></pre></td></tr></table></figure>

<h3 id="1-3、物理卷查看命令-pvscan"><a href="#1-3、物理卷查看命令-pvscan" class="headerlink" title="1.3、物理卷查看命令:pvscan"></a>1.3、物理卷查看命令:pvscan</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pvs     显示PV简况</span><br><span class="line">pvdisplay   显示PV详细信息</span><br></pre></td></tr></table></figure>

<h3 id="1-4、物理卷扫描命令-pvscan"><a href="#1-4、物理卷扫描命令-pvscan" class="headerlink" title="1.4、物理卷扫描命令:pvscan"></a>1.4、物理卷扫描命令:pvscan</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvscan 扫描pv设备</span><br></pre></td></tr></table></figure>

<h3 id="删除物理卷-pvremove"><a href="#删除物理卷-pvremove" class="headerlink" title="删除物理卷: pvremove"></a>删除物理卷: pvremove</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除PV sdb1 sdc1</span><br><span class="line">[root@zutuanxue ~]# pvremove /dev/sdb1 /dev/sdc1</span><br></pre></td></tr></table></figure>

<h2 id="二、卷组管理"><a href="#二、卷组管理" class="headerlink" title="二、卷组管理"></a>二、卷组管理</h2><p>将多个物理卷组成一个卷组，形成一个存储池</p>
<h3 id="2-1、卷组创建：vgcreate命令"><a href="#2-1、卷组创建：vgcreate命令" class="headerlink" title="2.1、卷组创建：vgcreate命令"></a>2.1、卷组创建：vgcreate命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将pv sdb1 sdc1创建成卷组VG1000  PE大小为32M</span><br><span class="line">[root@zutuanxue ~]# vgcreate -s 32 vg1000 /dev/sdb1 /dev/sdc1</span><br></pre></td></tr></table></figure>

<h3 id="2-2、删除卷组中的PV：vgreduce命令"><a href="#2-2、删除卷组中的PV：vgreduce命令" class="headerlink" title="2.2、删除卷组中的PV：vgreduce命令"></a>2.2、删除卷组中的PV：vgreduce命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将vg1000卷组中的PV sdb1删除</span><br><span class="line">[root@zutuanxue ~]# vgreduce /dev/vg1000 /dev/sdb1</span><br></pre></td></tr></table></figure>

<h3 id="2-3、扩容卷组：vgextend命令"><a href="#2-3、扩容卷组：vgextend命令" class="headerlink" title="2.3、扩容卷组：vgextend命令"></a>2.3、扩容卷组：vgextend命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将pv sdb1 加入卷组vg1000</span><br><span class="line">[root@zutuanxue ~]# vgextend /dev/vg1000 /dev/sdb1</span><br></pre></td></tr></table></figure>

<h3 id="2-4、删除卷组：vgremove命令"><a href="#2-4、删除卷组：vgremove命令" class="headerlink" title="2.4、删除卷组：vgremove命令"></a>2.4、删除卷组：vgremove命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 删除vg1000卷组</span><br><span class="line">[root@zutuanxue ~]# vgremove /dev/vg1000/</span><br></pre></td></tr></table></figure>

<h2 id="三、逻辑卷管理"><a href="#三、逻辑卷管理" class="headerlink" title="三、逻辑卷管理"></a>三、逻辑卷管理</h2><h3 id="3-1、逻辑卷创建-lvcreate命令"><a href="#3-1、逻辑卷创建-lvcreate命令" class="headerlink" title="3.1、逻辑卷创建:lvcreate命令"></a>3.1、逻辑卷创建:lvcreate命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 从卷组vg1000上创建一个lv99的逻辑卷，容量为3G。</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv99 -L 3G /dev/vg1000</span><br></pre></td></tr></table></figure>

<h3 id="3-2、逻辑卷扩容-lvextend命令"><a href="#3-2、逻辑卷扩容-lvextend命令" class="headerlink" title="3.2、逻辑卷扩容: lvextend命令"></a>3.2、逻辑卷扩容: lvextend命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 注意扩容顺序，不能颠倒</span><br><span class="line"># a、扩容逻辑卷</span><br><span class="line">[root@zutuanxue ~]# lvextend -L 3.5G /dev/vg1000/lv99</span><br><span class="line"># b、扩容文件系统</span><br><span class="line">[root@zutuanxue ~]# resize2fs /dev/vg1000/lv99</span><br></pre></td></tr></table></figure>

<h3 id="3-3、逻辑卷缩小：lvreduce命令"><a href="#3-3、逻辑卷缩小：lvreduce命令" class="headerlink" title="3.3、逻辑卷缩小：lvreduce命令"></a>3.3、逻辑卷缩小：lvreduce命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 注意扩容顺序，不能颠倒</span><br><span class="line"># a、扫描逻辑卷文件系统，清晰该逻辑卷的使用情况，注意只能缩未使用的空间</span><br><span class="line">[root@zutuanxue ~]# e2fsck -f /dev/vg1000/lv99</span><br><span class="line"># b、缩小文件系统</span><br><span class="line">[root@zutuanxue ~]# resize2fs /dev/vg1000/lv99 2G</span><br><span class="line"># c、缩小逻辑卷</span><br><span class="line">[root@zutuanxue ~]# lvreduce -L 2G /dev/vg1000/lv99 (lvresize)</span><br></pre></td></tr></table></figure>

<h3 id="3-4、逻辑卷移除"><a href="#3-4、逻辑卷移除" class="headerlink" title="3.4、逻辑卷移除"></a>3.4、逻辑卷移除</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#remove LVM</span><br><span class="line"># 卸载分区</span><br><span class="line">[root@zutuanxue ~]# umount /dev/vg1000/lv99</span><br><span class="line"># 删除逻辑卷</span><br><span class="line">[root@zutuanxue ~]# lvremove /dev/vg1000/lv99</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>PE 和 LE的说明及应用策略</p>
<p>PE（physicalextent）<br>每一个物理卷被划分为称为PE(PhysicalExtents)的基本单元，具有唯一编号的PE是可以被LVM寻址的最小单元。PE的大小是可配置的，默认为4MB。</p>
<p>LE（logicalextent）<br>逻辑卷也被划分为被称为LE(LogicalExtents)的可被寻址的基本单位。在同一个卷组中，LE的大小和PE是相同的，并且一一对应。</p>
<p>设置使用大小为4MB的PE（默认为4MB），这表示卷组上创建的所有逻辑卷都以4MB为增量单位来进行扩充 或缩减。由于内核原因，PE大小决定了逻辑卷的最大大小，4MB的PE决定了单个逻辑卷最大容量为256GB，若希望使用大于256G的逻辑卷则创建卷组 时指定更大的PE。PE大小范围为8KB到512MB，并且必须总是2的倍数</p>
<h1 id="逻辑卷实战案例-逻辑卷应用"><a href="#逻辑卷实战案例-逻辑卷应用" class="headerlink" title="逻辑卷实战案例-逻辑卷应用"></a>逻辑卷实战案例-逻辑卷应用</h1><p> 阅读 (200735) </p>
<p> 分享</p>
<h2 id="案例需求："><a href="#案例需求：" class="headerlink" title="案例需求："></a>案例需求：</h2><p>创建一个2.5G大小的逻辑卷</p>
<h2 id="案例思路："><a href="#案例思路：" class="headerlink" title="案例思路："></a>案例思路：</h2><ol>
<li>物理的设备</li>
<li>将物理设备做成物理卷</li>
<li>创建卷组并将物理卷加入其中</li>
<li>创建逻辑卷</li>
<li>格式化逻辑卷</li>
<li>挂载使用</li>
</ol>
<h2 id="案例实现"><a href="#案例实现" class="headerlink" title="案例实现"></a>案例实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1. 物理设备</span><br><span class="line">[root@zutuanxue ~]# lsblk /dev/sdb</span><br><span class="line">NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb      8:16   0  20G  0 disk </span><br><span class="line">├─sdb1   8:17   0   2G  0 part /disk1</span><br><span class="line">├─sdb2   8:18   0   2G  0 part </span><br><span class="line">├─sdb3   8:19   0   2G  0 part </span><br><span class="line">├─sdb4   8:20   0   2G  0 part </span><br><span class="line">└─sdb5   8:21   0   2G  0 part </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 创建物理卷</span><br><span class="line">[root@zutuanxue ~]# pvcreate /dev/sdb&#123;1,2&#125;</span><br><span class="line">  Physical volume &quot;/dev/sdb1&quot; successfully created.</span><br><span class="line">  Physical volume &quot;/dev/sdb2&quot; successfully created.</span><br><span class="line">查看物理卷：</span><br><span class="line">[root@zutuanxue ~]# pvs</span><br><span class="line">  PV         VG Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  cl lvm2 a--  &lt;19.00g    0 </span><br><span class="line">  /dev/sdb1     lvm2 ---    2.00g 2.00g</span><br><span class="line">  /dev/sdb2     lvm2 ---    2.00g 2.00g</span><br><span class="line">[root@zutuanxue ~]# pvscan </span><br><span class="line">  PV /dev/sda2   VG cl              lvm2 [&lt;19.00 GiB / 0    free]</span><br><span class="line">  PV /dev/sdb1                      lvm2 [2.00 GiB]</span><br><span class="line">  PV /dev/sdb2                      lvm2 [2.00 GiB]</span><br><span class="line">  Total: 3 [&lt;23.00 GiB] / in use: 1 [&lt;19.00 GiB] / in no VG: 2 [4.00 GiB]</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# pvdisplay /dev/sdb1 </span><br><span class="line">  &quot;/dev/sdb1&quot; is a new physical volume of &quot;2.00 GiB&quot;</span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb1		#物理卷名称</span><br><span class="line">  VG Name               						#卷组名称</span><br><span class="line">  PV Size               2.00 GiB		#大小</span><br><span class="line">  Allocatable           NO					#是否已分配出去</span><br><span class="line">  PE Size               0   				#PE大小</span><br><span class="line">  Total PE              0						#PE总数</span><br><span class="line">  Free PE               0						#空闲PE</span><br><span class="line">  Allocated PE          0						#可分配PE</span><br><span class="line">  PV UUID               3M4...lT		#UUID</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 创建卷组并将物理卷加入其中</span><br><span class="line">[root@zutuanxue ~]# vgcreate vg1 /dev/sdb&#123;1,2&#125;</span><br><span class="line">  Volume group &quot;vg1&quot; successfully created</span><br><span class="line">查看卷组信息：</span><br><span class="line">[root@zutuanxue ~]# vgs vg1</span><br><span class="line">  VG  #PV #LV #SN Attr   VSize VFree</span><br><span class="line">  vg1   2   0   0 wz--n- 3.99g 3.99g</span><br><span class="line">  </span><br><span class="line">[root@zutuanxue ~]# vgscan	#扫描系统中有哪些卷组</span><br><span class="line">  Reading all physical volumes.  This may take a while...</span><br><span class="line">  Found volume group &quot;vg1&quot; using metadata type lvm2</span><br><span class="line">  Found volume group &quot;cl&quot; using metadata type lvm2</span><br><span class="line">  </span><br><span class="line"> [root@zutuanxue ~]# vgdisplay vg1</span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               vg1</span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        2</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                2</span><br><span class="line">  Act PV                2</span><br><span class="line">  VG Size               3.99 GiB		#卷组大小</span><br><span class="line">  PE Size               4.00 MiB		#PE大小</span><br><span class="line">  Total PE              1022				#PE数量</span><br><span class="line">  Alloc PE / Size       0/0   		#已分配的PE/容量</span><br><span class="line">  Free  PE / Size       1022/3.99 GiB	#可分配的PE/容量</span><br><span class="line">  VG UUID               CQ6p...K9I</span><br><span class="line"></span><br><span class="line">4. 创建逻辑卷</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv1 -L 2.5G vg1 </span><br><span class="line">  Logical volume &quot;lv1&quot; created.</span><br><span class="line">在操作系统层面映射两个地方：</span><br><span class="line">[root@zutuanxue ~]# ll /dev/mapper/vg1-lv1 </span><br><span class="line">lrwxrwxrwx 1 root root 7 12月 10 05:47 /dev/mapper/vg1-lv1 -&gt; ../dm-2</span><br><span class="line">[root@zutuanxue ~]# ll /dev/vg1/lv1 </span><br><span class="line">lrwxrwxrwx 1 root root 7 12月 10 05:47 /dev/vg1/lv1 -&gt; ../dm-2</span><br><span class="line">[root@zutuanxue ~]# ll /dev/dm-2 </span><br><span class="line">brw-rw---- 1 root disk 253, 2 12月 10 05:47 /dev/dm-2</span><br><span class="line"></span><br><span class="line">lvcreate参数</span><br><span class="line">-n：指定逻辑卷的名字</span><br><span class="line">-L：指定逻辑卷的大小</span><br><span class="line">-l：指定逻辑卷的大小</span><br><span class="line">举例：</span><br><span class="line">-l 100			100个PE，每个PE大小默认4M，故逻辑卷大小为400M</span><br><span class="line">-l 50%free		卷组剩余空间的50%</span><br><span class="line">[root@zutuanxue ~]# vgs vg1 </span><br><span class="line">  VG  #PV #LV #SN Attr   VSize VFree</span><br><span class="line">  vg1   2   1   0 wz--n- 3.99g 1.49g</span><br><span class="line"> </span><br><span class="line">创建大小为200M的逻辑卷lv02;每个PE为4M，-l 50指定50个PE,大小为200M</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv2 -l 50 vg1</span><br><span class="line">  Logical volume &quot;lv2&quot; created.</span><br><span class="line">[root@zutuanxue ~]# vgs vg1 </span><br><span class="line">  VG  #PV #LV #SN Attr   VSize VFree </span><br><span class="line">  vg1   2   2   0 wz--n- 3.99g &lt;1.30g</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# lvs /dev/vg01/lv02</span><br><span class="line">  LV   VG   Attr       LSize   Pool Origin Data%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv02 vg01 -wi-a----- 200.00m  </span><br><span class="line">  </span><br><span class="line">创建大小为剩余卷组vg01空间的50%的逻辑卷lv03</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv3 -l 50%free vg1</span><br><span class="line">  Logical volume &quot;lv3&quot; created.</span><br><span class="line">[root@zutuanxue ~]# vgs vg1 </span><br><span class="line">  VG  #PV #LV #SN Attr   VSize VFree  </span><br><span class="line">  vg1   2   3   0 wz--n- 3.99g 664.00m</span><br><span class="line"></span><br><span class="line">查看逻辑卷的信息：</span><br><span class="line">[root@zutuanxue ~]# lvs /dev/vg1/lv1 </span><br><span class="line">  LV   VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv1  vg1 -wi-a----- 2.50g                                                    </span><br><span class="line">[root@zutuanxue ~]# lvs /dev/vg1/lv2</span><br><span class="line">  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv2  vg1 -wi-a----- 200.00m                                                    </span><br><span class="line">[root@zutuanxue ~]# lvs /dev/vg1/lv3</span><br><span class="line">  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv3  vg1 -wi-a----- 664.00m                                                    </span><br><span class="line">[root@zutuanxue ~]# lvdisplay /dev/vg1/lv1 </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/vg1/lv1</span><br><span class="line">  LV Name                lv1</span><br><span class="line">  VG Name                vg1</span><br><span class="line">  LV UUID                jj9Sj1-zHuo-qpBZ-Dkk1-LVYB-HyUH-LQ6edW</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time localhost.localdomain, 2019-12-10 05:46:59 -0500</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                2.50 GiB</span><br><span class="line">  Current LE             640</span><br><span class="line">  Segments               2</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">5. 格式化逻辑卷</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/vg1/lv1 </span><br><span class="line"></span><br><span class="line">6. 挂载使用</span><br><span class="line">1）创建一个空的挂载点</span><br><span class="line">[root@zutuanxue /]# mkdir /lv1</span><br><span class="line">2）挂载使用</span><br><span class="line">[root@zutuanxue /]# mount /dev/vg1/lv1 /lv1/</span><br></pre></td></tr></table></figure>

<h1 id="逻辑卷实战案例-逻辑卷扩容"><a href="#逻辑卷实战案例-逻辑卷扩容" class="headerlink" title="逻辑卷实战案例-逻辑卷扩容"></a>逻辑卷实战案例-逻辑卷扩容</h1><p> 阅读 (161311) </p>
<p> 分享</p>
<h2 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h2><p>将&#x2F;lv1目录动态扩容到3G</p>
<h2 id="案例思路"><a href="#案例思路" class="headerlink" title="案例思路"></a>案例思路</h2><ol>
<li>查看&#x2F;lv1目录所对应的逻辑卷是哪一个 &#x2F;dev&#x2F;mapper&#x2F;vg1-lv1</li>
<li>查看当前逻辑卷所在的卷组vg1剩余空间是否足够</li>
<li>如果vg1空间不够，得先扩容卷组，再扩容逻辑卷</li>
<li>如果vg1空间足够，直接扩容逻辑卷</li>
</ol>
<h2 id="案例实现-1"><a href="#案例实现-1" class="headerlink" title="案例实现"></a>案例实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">1. 查看/lv1目录属于哪个卷组</span><br><span class="line">[root@zutuanxue /]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/vg1-lv1  2.4G  7.5M  2.3G    1% /lv1</span><br><span class="line"></span><br><span class="line">[root@zutuanxue /]# lvs</span><br><span class="line">  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root cl  -wi-ao---- &lt;17.00g                                                    </span><br><span class="line">  swap cl  -wi-ao----   2.00g                                                    </span><br><span class="line">  lv1  vg1 -wi-ao----   2.50g                                                    </span><br><span class="line">  lv2  vg1 -wi-a----- 200.00m                                                    </span><br><span class="line">  lv3  vg1 -wi-a----- 664.00m                                                    </span><br><span class="line">2. 卷组的剩余空间</span><br><span class="line">[root@zutuanxue /]# vgs</span><br><span class="line">  VG  #PV #LV #SN Attr   VSize   VFree  </span><br><span class="line">  cl    1   2   0 wz--n- &lt;19.00g      0 </span><br><span class="line">  vg1   2   4   0 wz--n-   3.99g 664.00m</span><br><span class="line">结果：当前卷组空间不足我扩容</span><br><span class="line"></span><br><span class="line">3. 扩容逻辑卷所在的卷组</span><br><span class="line">1）首先得有物理设备 /dev/sdb3</span><br><span class="line">2) 将物理设备做成物理卷</span><br><span class="line">[root@zutuanxue /]# pvcreate /dev/sdb3 </span><br><span class="line">  Physical volume &quot;/dev/sdb3&quot; successfully created.</span><br><span class="line">[root@zutuanxue /]# pvs</span><br><span class="line">  PV         VG  Fmt  Attr PSize   PFree  </span><br><span class="line">  /dev/sda2  cl  lvm2 a--  &lt;19.00g      0 </span><br><span class="line">  /dev/sdb1  vg1 lvm2 a--   &lt;2.00g      0 </span><br><span class="line">  /dev/sdb2  vg1 lvm2 a--   &lt;2.00g 464.00m</span><br><span class="line">  /dev/sdb3      lvm2 ---    2.00g   2.00g</span><br><span class="line">  3）将物理卷加入到卷组中（卷组扩容）</span><br><span class="line">[root@zutuanxue /]# vgextend vg1 /dev/sdb3 </span><br><span class="line">  Volume group &quot;vg1&quot; successfully extended</span><br><span class="line">[root@zutuanxue /]# pvs</span><br><span class="line">  PV         VG  Fmt  Attr PSize   PFree  </span><br><span class="line">  /dev/sda2  cl  lvm2 a--  &lt;19.00g      0 </span><br><span class="line">  /dev/sdb1  vg1 lvm2 a--   &lt;2.00g      0 </span><br><span class="line">  /dev/sdb2  vg1 lvm2 a--   &lt;2.00g 464.00m</span><br><span class="line">  /dev/sdb3  vg1 lvm2 a--   &lt;2.00g  &lt;2.00g</span><br><span class="line">  </span><br><span class="line">注意：</span><br><span class="line">正常情况下，应该先将/dev/sdb3物理设备创建为物理卷再加入到卷组中；如果直接加入卷组，系统会自动帮你将其做成物理卷。</span><br><span class="line"></span><br><span class="line">[root@zutuanxue /]# vgs</span><br><span class="line">  VG  #PV #LV #SN Attr   VSize   VFree </span><br><span class="line">  cl    1   2   0 wz--n- &lt;19.00g     0 </span><br><span class="line">  vg1   3   4   0 wz--n-  &lt;5.99g &lt;2.45g</span><br><span class="line"></span><br><span class="line">4. 扩容逻辑卷</span><br><span class="line">[root@zutuanxue /]# lvextend -L 3G /dev/vg1/lv1 </span><br><span class="line">		-L 3G最终的大小</span><br><span class="line">或者</span><br><span class="line">[root@zutuanxue /]# lvextend -L +1.5G /dev/vg1/lv1 	 -L +1.5G 扩容1.5G</span><br><span class="line"></span><br><span class="line">5. 查看结果</span><br><span class="line">[root@zutuanxue /]# lvs</span><br><span class="line">  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root cl  -wi-ao---- &lt;17.00g                                                    </span><br><span class="line">  swap cl  -wi-ao----   2.00g                                                    </span><br><span class="line">  lv1  vg1 -wi-ao----   3.00g       已经扩容到了3G</span><br><span class="line">  </span><br><span class="line">[root@zutuanxue /]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/vg1-lv1  2.4G  7.5M  2.3G    1% /lv1</span><br><span class="line">		实际并没有改变</span><br><span class="line"></span><br><span class="line">6. 同步文件系统</span><br><span class="line">[root@zutuanxue /]# resize2fs /dev/vg1/lv1    #该命令适用于ext分区</span><br><span class="line">[root@manage01  ~]# xfs_growfs /dev/vg1/lv1  #该命令适用于xfs分区</span><br><span class="line">7. 再次查看验证</span><br><span class="line">[root@zutuanxue /]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/vg1-lv1  2.9G  7.5M  2.8G    1% /lv1</span><br><span class="line">		扩容成功</span><br></pre></td></tr></table></figure>

<h1 id="逻辑卷实战案例-逻辑卷裁剪"><a href="#逻辑卷实战案例-逻辑卷裁剪" class="headerlink" title="逻辑卷实战案例-逻辑卷裁剪"></a>逻辑卷实战案例-逻辑卷裁剪</h1><p> 阅读 (227679) </p>
<p> 分享</p>
<h2 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h2><p>将lv1逻辑卷由原来的3G缩小为2G</p>
<h2 id="案例思路-1"><a href="#案例思路-1" class="headerlink" title="案例思路"></a>案例思路</h2><p>1、卸载逻辑卷<br>2、扫描逻辑卷<br>3、裁剪率lv1文件系统<br>4、裁剪逻辑卷lv1<br>5、挂载使用</p>
<h2 id="案例实现-2"><a href="#案例实现-2" class="headerlink" title="案例实现"></a>案例实现</h2><h3 id="ext分区逻辑卷裁剪"><a href="#ext分区逻辑卷裁剪" class="headerlink" title="ext分区逻辑卷裁剪"></a>ext分区逻辑卷裁剪</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue /]# umount /lv1</span><br><span class="line">[root@zutuanxue /]# e2fsck -f /dev/vg1/lv1		检验文件系统</span><br><span class="line">[root@zutuanxue /]# resize2fs /dev/vg1/lv1  2G	裁剪文件系统到2G</span><br><span class="line">[root@zutuanxue /]# lvreduce /dev/vg1/lv1 -L 2G	裁剪逻辑卷</span><br><span class="line">[root@zutuanxue /]# mount /dev/vg1/lv1 /lv1/		挂载使用</span><br><span class="line">[root@zutuanxue /]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/vg1-lv1  2.0G  9.0M  1.8G    1% /lv1</span><br></pre></td></tr></table></figure>

<h3 id="xfs分区逻辑卷裁剪"><a href="#xfs分区逻辑卷裁剪" class="headerlink" title="xfs分区逻辑卷裁剪"></a>xfs分区逻辑卷裁剪</h3><p><strong>案例思路：</strong><br>1、将lv2的文件系统格式化为xfs<br>2、将&#x2F;dev&#x2F;vg1&#x2F;lv2挂载到&#x2F;lv2<br>3、在&#x2F;lv2中建立一个文件，写入内容<br>4、备份数据<br>5、卸载分区并裁剪逻辑卷<br>6、格式化裁剪后的逻辑卷<br>7、导入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">1)备份数据命令</span><br><span class="line">xfsdump</span><br><span class="line">2）备份数据</span><br><span class="line">[root@zutuanxue /]# xfsdump -f /root/lv2.img /lv2</span><br><span class="line">#挂载点目录后面不要加&quot;/&quot;</span><br><span class="line">xfsdump: using file dump (drive_simple) strategy</span><br><span class="line">xfsdump: version 3.1.8 (dump format 3.0) - type ^C for status and control</span><br><span class="line"></span><br><span class="line"> ============================= dump label dialog ==============================</span><br><span class="line"></span><br><span class="line">please enter label for this dump session (timeout in 300 sec)</span><br><span class="line"> -&gt; lv2</span><br><span class="line">session label entered: &quot;lv2&quot;</span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: level 0 dump of localhost.localdomain:/lv2</span><br><span class="line">xfsdump: dump date: Tue Dec 10 06:33:44 2019</span><br><span class="line">xfsdump: session id: 15936371-b967-4c2c-8995-49eb702792fe</span><br><span class="line">xfsdump: session label: &quot;lv2&quot;</span><br><span class="line">xfsdump: ino map phase 1: constructing initial dump list</span><br><span class="line">xfsdump: ino map phase 2: skipping (no pruning necessary)</span><br><span class="line">xfsdump: ino map phase 3: skipping (only one dump stream)</span><br><span class="line">xfsdump: ino map construction complete</span><br><span class="line">xfsdump: estimated dump size: 20800 bytes</span><br><span class="line"></span><br><span class="line"> ============================= media label dialog =============================</span><br><span class="line"></span><br><span class="line">please enter label for media in drive 0 (timeout in 300 sec)</span><br><span class="line"> -&gt; lv2</span><br><span class="line">media label entered: &quot;lv2&quot;</span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: creating dump session media file 0 (media 0, file 0)</span><br><span class="line">xfsdump: dumping ino map</span><br><span class="line">xfsdump: dumping directories</span><br><span class="line">xfsdump: dumping non-directory files</span><br><span class="line">xfsdump: ending media file</span><br><span class="line">xfsdump: media file size 21016 bytes</span><br><span class="line">xfsdump: dump size (non-dir files) : 0 bytes</span><br><span class="line">xfsdump: dump complete: 14 seconds elapsed</span><br><span class="line">xfsdump: Dump Summary:</span><br><span class="line">xfsdump:   stream 0 /root/lv2.img OK (success)</span><br><span class="line">xfsdump: Dump Status: SUCCESS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3)裁剪</span><br><span class="line">[root@zutuanxue ~]# umount /lv2</span><br><span class="line">[root@zutuanxue ~]# lvreduce /dev/vg1/lv2 -L 100M</span><br><span class="line">  WARNING: Reducing active logical volume to 2.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce vg01/lv01? [y/n]: y</span><br><span class="line">  Size of logical volume vg01/lv01 changed from 7.00 GiB (1792 extents) to 2.00 GiB (512 extents).</span><br><span class="line">  Logical volume vg01/lv01 successfully resized.</span><br><span class="line"></span><br><span class="line">4）格式化</span><br><span class="line">[root@zutuanxue ~]# mkfs.xfs -f /dev/vg1/lv2</span><br><span class="line">[root@zutuanxue ~]# mount /dev/vg1/lv2 /lv2</span><br><span class="line"></span><br><span class="line">5）恢复数据 -f source</span><br><span class="line">[root@zutuanxue ~]# xfsrestore -f /root/lv2.img /lv2</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">xfsrestore: Restore Status: SUCCESS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@zutuanxue ~]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/vg1-lv2   95M  6.0M   89M    7% /lv2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cat /lv2/filea </span><br><span class="line">hahaha</span><br></pre></td></tr></table></figure>

<h1 id="逻辑卷实战案例-swap分区"><a href="#逻辑卷实战案例-swap分区" class="headerlink" title="逻辑卷实战案例-swap分区"></a>逻辑卷实战案例-swap分区</h1><p> 阅读 (252996) </p>
<p> 分享</p>
<p>swap分区在系统的运行内存不够用的时候，把运行内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到swap分区中，等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。可以缓解物理内存不足的压力，如果物理内存不足，还没有swap空间，会宕机</p>
<h2 id="扩容swap空间"><a href="#扩容swap空间" class="headerlink" title="扩容swap空间"></a>扩容swap空间</h2><p>方法1： 增加一个设备（硬盘，分区，逻辑卷）来扩容swap空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">查看swap空间大小：</span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3918        1309        2002          15         606        2358</span><br><span class="line">Swap:          2047           0        2047</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# swapon -s</span><br><span class="line">文件名				类型					大小			已用	权限</span><br><span class="line">/dev/dm-1   partition		2097148			0		-2</span><br><span class="line">[root@zutuanxue ~]# mkswap /dev/sdb4</span><br><span class="line">正在设置交换空间版本 1，大小 = 2 GiB (2147479552  个字节)</span><br><span class="line">无标签，UUID=8235e59a-1043-4251-8694-ba619cb36f1c</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# blkid /dev/sdb4</span><br><span class="line">/dev/sdb4: UUID=&quot;8...c&quot; TYPE=&quot;swap&quot; PARTUUID=&quot;b...e&quot;</span><br><span class="line"></span><br><span class="line">//激活swap分区。swap空间不能手动挂载</span><br><span class="line">[root@zutuanxue ~]# swapon /dev/sdb4</span><br><span class="line">[root@zutuanxue ~]# swapon -s</span><br><span class="line">文件名						类型				大小		已用	权限</span><br><span class="line">/dev/dm-1       partition	2097148		0		-2</span><br><span class="line">/dev/sdb4       partition	2097148		0		-3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">      total  used  free shared buff/cache available</span><br><span class="line">Swap:  4095   0    4095</span><br><span class="line"></span><br><span class="line">LVM形式</span><br><span class="line">[root@zutuanxue ~]# mkswap /dev/vg1/swap		#创建swap</span><br><span class="line">[root@zutuanxue ~]# swapon /dev/vg1/swap		#开启swap</span><br><span class="line">[root@zutuanxue ~]# lvextend -L 4G	/dev/vg1/swap	#放大LVM形式的swap</span><br><span class="line">[root@zutuanxue ~]# swapoff /dev/vg1/swap		#关闭lvm形式的swap</span><br><span class="line">[root@zutuanxue /]# mkswap /dev/vg1/lv-swap	#重新制作swap</span><br><span class="line">[root@zutuanxue ~]# swapon /dev/vg1/swap		#开启lvm形式的swap</span><br><span class="line">[root@zutuanxue ~]# free -m	#确认swap分区是否放大</span><br></pre></td></tr></table></figure>

<p>方法2： 使用dd命令模拟大文件来扩容swap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/tmp/swapfile bs=1M count=2048</span><br><span class="line"></span><br><span class="line">if=源文件,in file指定从哪里读入数据</span><br><span class="line">of=目标文件，out file指定将数据写入什么位置</span><br><span class="line">bs=复制数据的大小，block size</span><br><span class="line">count=复制的个数</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">1. 一般可以使用dd命令做块设备文件的备份</span><br><span class="line">2. /dev/zero 特殊设备，一般用来模拟一个大文件，源源不断的二进制的数据流;</span><br><span class="line">/dev/null  空设备，类似黑洞</span><br><span class="line"></span><br><span class="line">步骤：</span><br><span class="line">1. 使用dd命令模拟大文件</span><br><span class="line"># dd if=/dev/zero of=/tmp/swapfile bs=1M count=2048</span><br><span class="line">2. 格式化大文件</span><br><span class="line">[root@zutuanxue ~]# mkswap /tmp/swapfile </span><br><span class="line">mkswap: /tmp/swapfile：不安全的权限 0644，建议使用 0600。</span><br><span class="line">正在设置交换空间版本 1，大小 = 2 GiB (2147479552  个字节)</span><br><span class="line">无标签，UUID=3d855316-c97c-42ca-9c52-9df26a4517a0 </span><br><span class="line">[root@zutuanxue ~]# ll /tmp/swapfile </span><br><span class="line">-rw-r--r-- 1 root root 2147483648 12月 10 21:02 /tmp/swapfile</span><br><span class="line">[root@zutuanxue ~]# chmod 600 /tmp/swapfile </span><br><span class="line"></span><br><span class="line">3.激活大文件</span><br><span class="line">[root@zutuanxue ~]# swapon -p1 /tmp/swapfile</span><br><span class="line">-p：指定优先级，数字越大优先级越高，-1~32767</span><br><span class="line"></span><br><span class="line">4. 查看</span><br><span class="line">[root@zutuanxue ~]# swapon -s</span><br><span class="line">文件名							类型				大小			已用	权限</span><br><span class="line">/dev/dm-1         partition	2097148		 268	-2</span><br><span class="line">/dev/sdb4         partition	2097148		 0		-3</span><br><span class="line">/tmp/swapfile     file    	2097148		 0		 1</span><br><span class="line">[root@zutuanxue ~]# free -m</span><br><span class="line">      total used  free  shared  buff/cache available</span><br><span class="line">Swap:  6143  0    6143</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果开机自动挂载，需要修改文件：/etc/fstab</span><br><span class="line">[root@zutuanxue ~]# vim /etc/fstab </span><br><span class="line">/dev/sda4  			swap    swap     defaults       0 0</span><br><span class="line">/tmp/swapfile   swap    swap     dfaults,pri=1  0 0</span><br><span class="line">[root@zutuanxue ~]# swapon -a</span><br><span class="line"></span><br><span class="line">关闭swap</span><br><span class="line">[root@zutuanxue ~]# swapoff /dev/sdb4</span><br><span class="line">[root@zutuanxue ~]# swapoff /tmp/swapfile</span><br><span class="line">或者</span><br><span class="line">#关闭所有swap****慎用*****</span><br><span class="line">[root@zutuanxue ~]# swapoff -a	</span><br></pre></td></tr></table></figure>

<h1 id="逻辑卷实战案例-其他常见操作"><a href="#逻辑卷实战案例-其他常见操作" class="headerlink" title="逻辑卷实战案例-其他常见操作"></a>逻辑卷实战案例-其他常见操作</h1><p> 阅读 (90727) </p>
<p> 分享</p>
<h2 id="LVM中有PV出现了坏道"><a href="#LVM中有PV出现了坏道" class="headerlink" title="LVM中有PV出现了坏道"></a>LVM中有PV出现了坏道</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#LVM中有PV出现了坏道</span><br><span class="line">#数据拷贝 将/dev/sdc1拷贝到/dev/sdd1</span><br><span class="line">[root@zutuanxue ~]#lvchange -an /dev/baism/abc</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# pvmove /dev/sdc1 /dev/sdd1</span><br><span class="line">  /dev/sdc1: Moved: 2.7%</span><br><span class="line">  /dev/sdc1: Moved: 100.0%</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vgchange -a n /dev/baism</span><br><span class="line">  0 logical volume(s) in volume group &quot;baism&quot; now active</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vgreduce baism /dev/sdc1</span><br><span class="line">  Removed &quot;/dev/sdc1&quot; from volume group &quot;baism&quot;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vgchange -a y /dev/baism</span><br><span class="line">  1 logical volume(s) in volume group &quot;baism&quot; now active</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]#lvchange -ay /dev/baism/abc</span><br><span class="line"></span><br><span class="line">#卷组迁移</span><br><span class="line">#导出卷组 old machine</span><br><span class="line">[root@zutuanxue ~]# vgexport /dev/baism</span><br><span class="line">  Volume group &quot;baism&quot; successfully exported</span><br><span class="line"></span><br><span class="line">#导入卷组  new machine</span><br><span class="line">[root@zutuanxue ~]# pvscan</span><br><span class="line">[root@zutuanxue ~]# vgimport /dev/baism</span><br><span class="line">  Volume group &quot;baism&quot; successfully imported</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vgchange -a y /dev/baism</span><br><span class="line">  1 logical volume(s) in volume group &quot;baism&quot; now active</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]#lvchange -ay /dev/baism/abc</span><br></pre></td></tr></table></figure>

<h2 id="volume-merged-lv合并"><a href="#volume-merged-lv合并" class="headerlink" title="volume merged lv合并"></a>volume merged lv合并</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@zutuanxue lvm]# vgcreate baism1 /dev/sdc1</span><br><span class="line">  Volume group &quot;baism1&quot; successfully created</span><br><span class="line">[root@zutuanxue lvm]# vgcreate baism2 /dev/sdd1</span><br><span class="line">  Volume group &quot;baism2&quot; successfully created</span><br><span class="line">[root@zutuanxue lvm]# vgmerge -v baism1 baism2</span><br><span class="line">    Checking for volume group &quot;baism1&quot;</span><br><span class="line">    Checking for volume group &quot;baism2&quot;</span><br><span class="line">    Archiving volume group &quot;baism2&quot; metadata (seqno 1).</span><br><span class="line">    Archiving volume group &quot;baism1&quot; metadata (seqno 1).</span><br><span class="line">    Writing out updated volume group</span><br><span class="line">    Creating volume group backup &quot;/etc/lvm/backup/baism1&quot; (seqno 2).</span><br><span class="line">  Volume group &quot;baism2&quot; successfully merged into &quot;baism1&quot;</span><br></pre></td></tr></table></figure>

<h2 id="volume-spilt-lv分割"><a href="#volume-spilt-lv分割" class="headerlink" title="volume spilt lv分割"></a>volume spilt lv分割</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vgsplit baism1 baism2 /dev/sdd1</span><br><span class="line">  New volume group &quot;baism2&quot; successfully split from &quot;baism1&quot;</span><br><span class="line"></span><br><span class="line">baism1  Old volume</span><br><span class="line">baism2  New volume  /dev/sdd1</span><br></pre></td></tr></table></figure>

<h2 id="逻辑卷从旧机器迁移到新机器"><a href="#逻辑卷从旧机器迁移到新机器" class="headerlink" title="逻辑卷从旧机器迁移到新机器"></a>逻辑卷从旧机器迁移到新机器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#########Backing Up Volume Group Metadata:</span><br><span class="line"></span><br><span class="line">当创建vg的时候，系统默认会自动备份Metadata。/etc/lvm/backup下面存放的是metadata的备份信息，而/etc/lvm/archive下面存放的是metadata的archive信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue backup]# pwd</span><br><span class="line">/etc/lvm/backup</span><br><span class="line"></span><br><span class="line">[root@zutuanxue backup]# strings baism2</span><br><span class="line"># Generated by LVM2 version 2.02.87(2)-rhel7 (2011-10-12): Mon Jan 14 22:27:02 2013</span><br><span class="line">contents = &quot;Text Format Volume Group&quot;</span><br><span class="line">version = 1</span><br><span class="line"></span><br><span class="line">description = &quot;Created *after* executing &#x27;vgsplit baism1 baism2 /dev/sdd1&#x27;&quot;   #warn</span><br><span class="line"></span><br><span class="line">creation_host = &quot;rhel7&quot; # Linux rhel7 2.6.32-220.el6.x86_64 #1 SMP Wed Nov 9 08:03:13 EST 2011 x86_64</span><br><span class="line">creation_time = 1358173622      # Mon Jan 14 22:27:02 2013</span><br><span class="line">baism2 &#123;</span><br><span class="line">        id = &quot;Ft0eD7-oVca-mwY6-6FeK-TwW2-hTrj-aYxYbq&quot;</span><br><span class="line">        seqno = 2</span><br><span class="line">        status = [&quot;RESIZEABLE&quot;, &quot;READ&quot;, &quot;WRITE&quot;]</span><br><span class="line">        flags = []</span><br><span class="line">        extent_size = 8192              # 4 Megabytes</span><br><span class="line">        max_lv = 0</span><br><span class="line">        max_pv = 0</span><br><span class="line">        metadata_copies = 0</span><br><span class="line">        physical_volumes &#123;</span><br><span class="line">                pv0 &#123;</span><br><span class="line">                        id = &quot;m7aKrr-D0r9-jOJ2-aK51-ec25-4rwH-4ccbbh&quot;</span><br><span class="line">                        device = &quot;/dev/sdd1&quot;    # Hint only</span><br><span class="line">                        status = [&quot;ALLOCATABLE&quot;]</span><br><span class="line">                        flags = []</span><br><span class="line">                        dev_size = 4192902      # 1.99933 Gigabytes</span><br><span class="line">                        pe_start = 2048</span><br><span class="line">                        pe_count = 511  # 1.99609 Gigabytes</span><br></pre></td></tr></table></figure>

<h1 id="创建高可用逻辑卷"><a href="#创建高可用逻辑卷" class="headerlink" title="创建高可用逻辑卷"></a>创建高可用逻辑卷</h1><p> 阅读 (298063) </p>
<p> 分享</p>
<h2 id="一、逻辑卷条带化："><a href="#一、逻辑卷条带化：" class="headerlink" title="一、逻辑卷条带化："></a>一、逻辑卷条带化：</h2><p>把保存到逻辑卷的数据分成n等分，分别写到不同的物理卷，可以提高数据的读写效率；如果任何一个涉及到的物理卷出现故障，数据都会无法恢复。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">创建物理卷</span><br><span class="line">[root@manage01 ~]# pvcreate /dev/sdb[12]</span><br><span class="line"></span><br><span class="line">查看物理卷</span><br><span class="line">[root@manage01 ~]# pvs</span><br><span class="line">/dev/sdb1            lvm2 a--   2.01g  2.01g</span><br><span class="line">/dev/sdb2            lvm2 a--   2.01g  2.01g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建卷组：</span><br><span class="line">[root@manage01 ~]# vgcreate vg01 /dev/sdb[12]</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# pvs /dev/sdb[12]</span><br><span class="line">  PV         VG   Fmt  Attr PSize PFree</span><br><span class="line"> /dev/sdb1  vg01      lvm2 a--   2.00g  2.00g</span><br><span class="line"> /dev/sdb2  vg01      lvm2 a--   2.00g  2.00g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建实现条带化的逻辑卷：</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv1 -L 1G vg01 -i 2 /dev/sdb&#123;1,2&#125;</span><br><span class="line"></span><br><span class="line">-i 参数：给出条带化的数量</span><br><span class="line">[root@zutuanxue ~]# lvs /dev/vg01/lv01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">格式化挂载使用：</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/vg1/lv1</span><br><span class="line">[root@zutuanxue ~]# mount /dev/vg1/lv1 /lv1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">[root@zutuanxue ~]# dnf install sysstat -y</span><br><span class="line">[root@zutuanxue ~]# iostat -m -d /dev/sdb[12] 2 </span><br><span class="line">-d 查看磁盘</span><br><span class="line">-m 以什么速度显示，每秒M</span><br><span class="line"> 2 每隔2s显示一次 </span><br><span class="line">   如果后面还有数字则代表总共显示多少次</span><br><span class="line">   </span><br><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/lv1/test bs=1M count=1000    模拟写数据</span><br><span class="line">[root@zutuanxue ~]# iostat -m -d /dev/sdb[12] 1</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">Device tps  		MB_read/s  MB_wrtn/s MB_read MB_wrtn</span><br><span class="line">sdb1   4015.00  0.01       364.38    0       364</span><br><span class="line">sdb2   4005.00  0.00       364.33    0       364</span><br></pre></td></tr></table></figure>

<h2 id="二、逻辑卷实现镜像"><a href="#二、逻辑卷实现镜像" class="headerlink" title="二、逻辑卷实现镜像"></a>二、逻辑卷实现镜像</h2><p>镜像是一种文件存储形式，是冗余的一种类型，一个磁盘上的数据在另一个磁盘上存在一个完全相同的副本即为镜像。对某个逻辑卷的数据做镜像，起到数据备份的作用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">当前环境：</span><br><span class="line">[root@zutuanxue ~]# lsblk</span><br><span class="line">├─sdb3        8:19   0    2G  0 part </span><br><span class="line">├─sdb4        8:20   0    2G  0 part </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建物理卷：</span><br><span class="line">[root@zutuanxue ~]# pvcreate /dev/sdb[34]</span><br><span class="line">[root@zutuanxue ~]# pvs</span><br><span class="line">  PV         VG  Fmt  Attr PSize   PFree </span><br><span class="line">  /dev/sdb3      lvm2 ---    2.00g  2.00g</span><br><span class="line">  /dev/sdb4      lvm2 ---    2.00g  2.00g</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"> 将物理卷加入到vg1卷组：</span><br><span class="line">[root@zutuanxue ~]# vgextend vg1 /dev/sdb[34]</span><br><span class="line">  Volume group &quot;vg1&quot; successfully extended</span><br><span class="line">[root@zutuanxue ~]# vgs</span><br><span class="line">  VG  #PV #LV #SN Attr   VSize   VFree</span><br><span class="line">  vg1   4   1   0 wz--n-   7.98g 6.98g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建实现镜像的逻辑卷：</span><br><span class="line">[root@zutuanxue ~]# lvcreate -n lv2 -L 1G vg1 -m 1 /dev/sdb[34]</span><br><span class="line">  Logical volume &quot;lv2&quot; created.</span><br><span class="line"></span><br><span class="line">-m参数：给出镜像的个数；1表示1个镜像</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# lvs -a -o +devices</span><br><span class="line">[root@zutuanxue ~]# lvs -a -o +devices</span><br><span class="line">  LV             VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert Devices                        </span><br><span class="line">  root           cl  -wi-ao---- &lt;17.00g                                                     /dev/sda2(512)                 </span><br><span class="line">  swap           cl  -wi-ao----   2.00g                                                     /dev/sda2(0)                   </span><br><span class="line">  lv1            vg1 -wi-ao----   1.00g                                                     /dev/sdb1(0),/dev/sdb2(0)      </span><br><span class="line">  lv2            vg1 rwi-a-r---   1.00g                                    100.00           lv2_rimage_0(0),lv2_rimage_1(0)</span><br><span class="line">  [lv2_rimage_0] vg1 iwi-aor---   1.00g                                                     /dev/sdb3(1)                   </span><br><span class="line">  [lv2_rimage_1] vg1 iwi-aor---   1.00g                                                     /dev/sdb4(1)                   </span><br><span class="line">  [lv2_rmeta_0]  vg1 ewi-aor---   4.00m                                                     /dev/sdb3(0)                   </span><br><span class="line">  [lv2_rmeta_1]  vg1 ewi-aor---   4.00m                                                     /dev/sdb4(0)         </span><br><span class="line"></span><br><span class="line">说明： Cpy%Sync 18.77该值是100%说明复制ok </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">格式化逻辑卷：</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/vg1/lv2</span><br><span class="line">挂载使用</span><br><span class="line">[root@zutuanxue ~]# mount /dev/vg1/lv2 /lv2/</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# touch /lv2/file&#123;1..10&#125;</span><br><span class="line">[root@zutuanxue ~]# mkdir /lv2/dir&#123;1..10&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">测试验证：</span><br><span class="line">思路：损坏一个磁盘，测试数据是否在第二个物理卷中</span><br><span class="line">1. 使用dd命令破坏一个物理卷</span><br><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/dev/sdb3 bs=1M count=100</span><br><span class="line"></span><br><span class="line">2. 再次查看物理卷发现有一个unknown Device    pvs命令</span><br><span class="line"> [unknown]  vg1 lvm2 a-m   &lt;2.00g 1016.00m</span><br><span class="line"></span><br><span class="line">3. 将损坏的盘从卷组中移除</span><br><span class="line">[root@zutuanxue ~]# vgreduce vg1 --removemissing --force</span><br><span class="line"></span><br><span class="line">4. 再次查看挂载点/lv2数据依然存在</span><br><span class="line"></span><br><span class="line">自己也可以再次测试：</span><br><span class="line">1. 再拿刚刚人为损坏的盘做成物理卷再次加入到vg1卷组中</span><br><span class="line">[root@zutuanxue /]# pvcreate /dev/sdb3 </span><br><span class="line"> </span><br><span class="line">[root@zutuanxue /]# vgextend vg1 /dev/sdb3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 修复</span><br><span class="line">[root@zutuanxue /]# lvconvert --repair /dev/vg1/lv2 /dev/sdb[34]</span><br></pre></td></tr></table></figure>

<h2 id="三、逻辑卷快照"><a href="#三、逻辑卷快照" class="headerlink" title="三、逻辑卷快照"></a>三、逻辑卷快照</h2><p>快照的作用：保存做快照那一刻数据的状态，方便用户实现数据回滚，避免重要数据被覆盖。</p>
<p>快照的大小：快照需要占用卷组空间，快照的大小决定了允许有多少数据发生改变，如果制作快照时分配的容量与对应的逻辑卷相同，那么就允许逻辑卷中所有的数据发生改变。</p>
<p>COW：copy on write 当系统检测到做快照的逻辑卷当中的数据发生了改变，会在改变前将逻辑卷中的PE的数据复制到快照中的PE，然后再写入新的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1. 创建快照 (EXT4)</span><br><span class="line">[root@zutuanxue /]# lvcreate -L 200M -s -n lv1-snap /dev/vg1/lv1	给lv1逻辑卷创建快照</span><br><span class="line">[root@zutuanxue /]# mount -o ro /dev/vg1/lv1-snap /lv1-snap/	挂载快照</span><br><span class="line"></span><br><span class="line">[root@zutuanxue /]# lvscan </span><br><span class="line">  ACTIVE   Original &#x27;/dev/vg1/lv1&#x27; [2.00 GiB] inherit</span><br><span class="line">  ACTIVE   Snapshot &#x27;/dev/vg1/lv1-snap&#x27; [200.00 MiB] inherit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue /] dmsetup ls --tree</span><br><span class="line">vg1-lv2--snap (252:5)</span><br><span class="line"> ├─vg1-lv1--snap-cow (253:4)		保存原卷改变前的数据</span><br><span class="line"> │  └─ (8:17)</span><br><span class="line"> └─vg1-lv1-real (253:3)				真实的逻辑卷（原卷）</span><br><span class="line">    ├─ (8:17)</span><br><span class="line">    └─ (8:18)</span><br><span class="line">vg1-lv1 (253:2)</span><br><span class="line"> └─vg1-lv1-real (253:3)</span><br><span class="line">    ├─ (8:17)</span><br><span class="line">    └─ (8:18)</span><br><span class="line">    </span><br><span class="line">2. 修改原卷的数据</span><br><span class="line">[root@zutuanxue /]# dd if=/dev/zero of=/lv1/test bs=1M count=30</span><br><span class="line"></span><br><span class="line">3. 观察Snapshot</span><br><span class="line">[root@zutuanxue /]# lvs /dev/vg1/lv1-snap </span><br><span class="line">  LV       VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv1-snap vg1 swi-aos--- 200.00m      lv1    0.02                                   </span><br><span class="line">[root@zutuanxue /]# lvs /dev/vg1/lv1-snap </span><br><span class="line">  LV       VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv1-snap vg1 swi-aos--- 200.00m      lv1    15.10                                  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">XFS：</span><br><span class="line">[root@node1 ~]# mount -o nouuid,ro /dev/vg1/lv1-snap /lv1-snap</span><br><span class="line">挂载快照，尽量使用ro的方式，将不会破坏快照卷中的数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">快照实现自动扩容：</span><br><span class="line">/etc/lvm/lvm.conf </span><br><span class="line">snapshot_autoextend_threshold = 80</span><br><span class="line">snapshot_autoextend_percent = 20</span><br><span class="line">//当快照使用到80%时，自动扩容20%；当snapshot_autoextend_threshold = 100表示关闭自动扩容</span><br><span class="line"></span><br><span class="line">修改完成后建议重启</span><br></pre></td></tr></table></figure>

<h1 id="linux磁盘管理-RAID介绍"><a href="#linux磁盘管理-RAID介绍" class="headerlink" title="linux磁盘管理-RAID介绍"></a>linux磁盘管理-RAID介绍</h1><p> 阅读 (161995) </p>
<p> 分享</p>
<h2 id="一、RAID介绍"><a href="#一、RAID介绍" class="headerlink" title="一、RAID介绍"></a>一、RAID介绍</h2><p>RAID(Redundant Array of Independent Disk 独立冗余磁盘阵列)技术是加州大学伯克利分校1987年提出，最初是为了组合小的廉价磁盘来代替大的昂贵磁盘，同时希望磁盘失效时不会使对数据的访问受损失而开发出一定水平的数据保护技术。RAID就是一种由多块廉价磁盘构成的冗余阵列，在操作系统下是作为一个独立的大型存储设备出现。RAID可以充分发挥出多块硬盘的优势，可以提升硬盘速度，增大容量，提供容错功能，能够确保数据安全性，易于管理的优点，在任何一块硬盘出现问题的情况下都可以继续工作，不会 受到损坏硬盘的影响。</p>
<h2 id="二、常见的RAID级别"><a href="#二、常见的RAID级别" class="headerlink" title="二、常见的RAID级别"></a>二、常见的RAID级别</h2><h3 id="2-1、-RAID0"><a href="#2-1、-RAID0" class="headerlink" title="2.1、 RAID0"></a>2.1、 RAID0</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602994630063.png" alt="raid0.png"></p>
<p><strong>RAID0特点：</strong></p>
<ul>
<li>至少需要两块磁盘</li>
<li>数据条带化分布到磁盘，高的读写性能，100%高存储空间利用率</li>
<li>数据没有冗余策略，一块磁盘故障，数据将无法恢复</li>
<li>应用场景：<ul>
<li>对性能要求高但对数据安全性和可靠性要求不高的场景，比如音频、视频等的存储。</li>
</ul>
</li>
</ul>
<h3 id="2-2、-RAID1"><a href="#2-2、-RAID1" class="headerlink" title="2.2、 RAID1"></a>2.2、 RAID1</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602994658333.png" alt="raid1.png"></p>
<p><strong>RAID1特点：</strong></p>
<ul>
<li>至少需要2块磁盘</li>
<li>数据镜像备份写到磁盘上(工作盘和镜像盘)，可靠性高，磁盘利用率为50%</li>
<li>读性能可以，但写性能不佳</li>
<li>一块磁盘故障，不会影响数据的读写</li>
<li>应用场景：<ul>
<li>对数据安全可靠要求较高的场景，比如邮件系统、交易系统等。</li>
</ul>
</li>
</ul>
<h3 id="2-3、-RAID5"><a href="#2-3、-RAID5" class="headerlink" title="2.3、 RAID5"></a>2.3、 RAID5</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602994685133.png" alt="raid5.png"></p>
<p><strong>RAID5特点：</strong></p>
<ul>
<li>至少需要3块磁盘</li>
<li>数据条带化存储在磁盘，读写性能好，磁盘利用率为(n-1)&#x2F;n</li>
<li>以奇偶校验(分散)做数据冗余</li>
<li>一块磁盘故障，可根据其他数据块和对应的校验数据重构损坏数据（消耗性能）</li>
<li>是目前综合性能最佳的数据保护解决方案</li>
<li>兼顾了存储性能、数据安全和存储成本等各方面因素（性价比高）</li>
<li>适用于大部分的应用场景</li>
</ul>
<h3 id="2-4、-RAID6"><a href="#2-4、-RAID6" class="headerlink" title="2.4、 RAID6"></a>2.4、 RAID6</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602994696875.png" alt="raid6.png"></p>
<p><strong>RAID6特点：</strong></p>
<ul>
<li>至少需要<strong>4</strong>块磁盘</li>
<li>数据条带化存储在磁盘，读取性能好，容错能力强</li>
<li>采用双重校验方式保证数据的安全性</li>
<li>如果2块磁盘同时故障，可以通过两个校验数据来重建两个磁盘的数据</li>
<li>成本要比其他等级高，并且更复杂</li>
<li>一般用于对数据安全性要求非常高的场合</li>
</ul>
<h3 id="2-5、-RAID10"><a href="#2-5、-RAID10" class="headerlink" title="2.5、 RAID10"></a>2.5、 RAID10</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602994712492.png" alt="raid10.png"></p>
<p><strong>RAID10特点：</strong></p>
<ul>
<li>RAID10是raid1+raid0的组合</li>
<li>至少需要4块磁盘</li>
<li>两块硬盘为一组先做raid1，再将做好raid1的两组做raid0</li>
<li>兼顾数据的冗余（raid1镜像）和读写性能（raid0数据条带化）</li>
<li>磁盘利用率为50%，成本较高</li>
</ul>
<h2 id="三、RAID总结"><a href="#三、RAID总结" class="headerlink" title="三、RAID总结"></a>三、RAID总结</h2><table>
<thead>
<tr>
<th>类型</th>
<th>读写性能</th>
<th>可靠性</th>
<th>磁盘利用率</th>
<th>成本</th>
</tr>
</thead>
<tbody><tr>
<td>RAID0</td>
<td>最好</td>
<td>最低</td>
<td>100%</td>
<td>较低</td>
</tr>
<tr>
<td>RAID1</td>
<td>读快；写一般</td>
<td>高</td>
<td>50%</td>
<td>高</td>
</tr>
<tr>
<td>RAID5</td>
<td>读:近似RAID0 写:多了校验</td>
<td>RAID0&lt;RAID5&lt;RAID1</td>
<td>(n-1)&#x2F;n</td>
<td>RAID0&lt;RAID5&lt;RAID1</td>
</tr>
<tr>
<td>RAID6</td>
<td>读：近似RAID0 写:多了双重校验</td>
<td>RAID6&gt;RAID5</td>
<td>RAID6&lt;RAID5</td>
<td>RAID6&gt;RAID1</td>
</tr>
<tr>
<td>RAID10</td>
<td>读：RAID10&#x3D;RAID0 写：RAID10&#x3D;RAID1</td>
<td>高</td>
<td>50%</td>
<td>最高</td>
</tr>
</tbody></table>
<h2 id="四、RAID分类"><a href="#四、RAID分类" class="headerlink" title="四、RAID分类"></a>四、RAID分类</h2><h3 id="软RAID"><a href="#软RAID" class="headerlink" title="软RAID"></a>软RAID</h3><p>软RAID运行于操作系统底层，将SCSI或者IDE控制器提交上来的物理磁盘，虚拟成虚拟磁盘，再提交给管理程序来进行管理。软RAID有以下特点：</p>
<ul>
<li>节省成本，系统支持就可以使用相应功能</li>
<li>占用内存空间</li>
<li>占用CPU资源</li>
<li>如果程序或者操作系统故障就无法运行</li>
</ul>
<h3 id="硬RAID"><a href="#硬RAID" class="headerlink" title="硬RAID"></a>硬RAID</h3><p>通过用硬件来实现RAID功能的就是硬RAID，独立的RAID卡，主板集成的RAID芯片都是硬RAID。RAID卡就是用来实现RAID功能的板卡。硬RAID的特点：</p>
<ul>
<li>硬RAID有独立的运算单元，性能好</li>
<li>可能需要单独购买额外的硬件</li>
<li>不同RAID卡支持的功能不同，需要根据自己的需求选择</li>
</ul>
<h1 id="创建一个软raid阵列"><a href="#创建一个软raid阵列" class="headerlink" title="创建一个软raid阵列"></a>创建一个软raid阵列</h1><p> 阅读 (215967) </p>
<p> 分享</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>添加一个20G的虚拟硬盘，分成10个2G的分区</p>
<h2 id="一、创建raid0"><a href="#一、创建raid0" class="headerlink" title="一、创建raid0"></a>一、创建raid0</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">系统中如果没有mdadm命令请安装相关工具：</span><br><span class="line">[root@zutuanxue ~]# which mdadm</span><br><span class="line">/usr/sbin/mdadm</span><br><span class="line">[root@zutuanxue ~]# rpm -qf /usr/sbin/mdadm </span><br><span class="line">mdadm-4.1-4.el8.x86_64</span><br><span class="line">[root@zutuanxue ~]# dnf install -y mdadm</span><br><span class="line"></span><br><span class="line">创建raid0：</span><br><span class="line">[root@zutuanxue ~]# mdadm --create /dev/md0 --raid-devices=2 /dev/sdb1 /dev/sdb2 --level=0</span><br><span class="line">mdadm: Defaulting to version 1.2 metadata</span><br><span class="line">mdadm: array /dev/md0 started.</span><br><span class="line">或者</span><br><span class="line">[root@zutuanxue ~]# mdadm -C /dev/md0 -l 0 -n 2 /dev/sdb1 /dev/sdb2</span><br><span class="line">-C:创建软raid</span><br><span class="line">-l：指定raid级别</span><br><span class="line">-n：指定raid中设备个数</span><br><span class="line"></span><br><span class="line">查看RAID信息：</span><br><span class="line">/proc/mdstat文件记录了所有raid信息</span><br><span class="line">[root@zutuanxue ~]# cat /proc/mdstat </span><br><span class="line">Personalities : [raid0] </span><br><span class="line">md0 : active raid0 sdb2[1] sdb1[0]</span><br><span class="line">#md0为raid0，两个成员sdb2（第二个成员），sdb1（第一个成员）</span><br><span class="line">      41905152 blocks super 1.2 512k chunks</span><br><span class="line">#一共有多少个块（每块1K）	数据段的大小是512K</span><br><span class="line">#chunk决定了阵列中每个成员盘写入的数据量，大于这个值才会到下一个盘读写</span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line"></span><br><span class="line">查看指定的RAID信息：</span><br><span class="line">[root@zutuanxue ~]# mdadm -D/--detail /dev/md0</span><br><span class="line">[root@zutuanxue ~]# mdadm  --detail /dev/md0</span><br><span class="line">/dev/md0:	#名称</span><br><span class="line">         Version : 1.2	#工具版本</span><br><span class="line">   Creation Time : Wed Dec 11 03:05:31 2019	#建立时间</span><br><span class="line">   Raid Level : raid0	#类型</span><br><span class="line">   Array Size : 41905152 (39.96 GiB 42.91 GB)#容量</span><br><span class="line">   Raid Devices : 2	#组成RAID的硬盘数量</span><br><span class="line">   Total Devices : 2#成员总数，包含备用磁盘</span><br><span class="line">   Persistence : Superblock is persistent</span><br><span class="line"></span><br><span class="line">   Update Time : Wed Dec 11 03:05:31 2019</span><br><span class="line">   State : clean 	#raid的状态</span><br><span class="line">   Active Devices : 2	#活跃的设备数量</span><br><span class="line">   Working Devices : 2	#工作的设备数量</span><br><span class="line">   Failed Devices : 0	#故障的数量</span><br><span class="line">   Spare Devices : 0	#备用设备数量</span><br><span class="line"></span><br><span class="line">   Chunk Size : 512K	</span><br><span class="line"></span><br><span class="line">	 Consistency Policy : none</span><br><span class="line"></span><br><span class="line">   Name : localhost.localdomain:0  (local to host localhost.localdomain)</span><br><span class="line">   UUID : 06b2d3b2:3ace3ddf:b5b65dd7:eb40b040</span><br><span class="line">   Events : 0</span><br><span class="line"></span><br><span class="line">Number Major Minor RaidDevice State</span><br><span class="line"> 0     8     17    0      	active sync   /dev/sdb1</span><br><span class="line"> 1     8     33    1      	active sync   /dev/sdb2</span><br><span class="line"></span><br><span class="line">格式化挂载使用：</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/md0</span><br><span class="line">[root@zutuanxue ~]# mkdir /md0</span><br><span class="line">[root@zutuanxue ~]# mount /dev/md0 /md0/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看空间使用情况：</span><br><span class="line">[root@zutuanxue ~]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/md0           3.9G  16M  3.7G    1% /md0</span><br><span class="line">#可用空间100%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">[root@zutuanxue ~]# iostat -m -d /dev/sdb1 /dev/sdb2 2</span><br><span class="line">[root@zutuanxue ~]# dd if=/dev/zero of=/md0/file bs=1M count=1024</span><br></pre></td></tr></table></figure>

<h2 id="二、创建RAID1"><a href="#二、创建RAID1" class="headerlink" title="二、创建RAID1"></a>二、创建RAID1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">创建raid1：</span><br><span class="line">[root@zutuanxue ~]# mdadm -C /dev/md1 -l 1 -n 2 /dev/sdb3 /dev/sdb4 </span><br><span class="line">查看状态信息：</span><br><span class="line">root@zutuanxue ~]# watch -n1 &quot;cat /proc/mdstat&quot; 	watch命令监控该文件变化情况,1秒钟显示一次</span><br><span class="line">或者直接查看</span><br><span class="line">[root@zutuanxue ~]# cat /proc/mdstat </span><br><span class="line">Personalities : [raid0] [raid1] </span><br><span class="line">md1 : active raid1 sdb4[1] sdb3[0]</span><br><span class="line">      20953024 blocks super 1.2 [2/2] [UU]</span><br><span class="line">      #两个UU说明状态ok，一个盘故障则显示_U</span><br><span class="line">      [==============&gt;......]  resync = 73.5% (15404032/20953024) finish=0.4min speed=205582K/sec</span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line">      #以上信息说明两块盘在进行同步，100%说明同步完成</span><br><span class="line"></span><br><span class="line">查看raid1详细信息</span><br><span class="line">[root@zutuanxue ~]# mdadm -D /dev/md1   </span><br><span class="line"></span><br><span class="line">格式化挂载使用：</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/md1</span><br><span class="line">[root@zutuanxue ~]# mount /dev/md1 /md1</span><br><span class="line"></span><br><span class="line">查看空间使用情况：</span><br><span class="line">[root@zutuanxue ~]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/md1            2.0G  6.0M  1.9G    1% /md1</span><br><span class="line">#可用空间50%</span><br><span class="line"></span><br><span class="line">测试验证热插拔：</span><br><span class="line">1. 模拟一块盘故障（将磁盘标记为失效）</span><br><span class="line">[root@zutuanxue ~]# mdadm /dev/md1 -f /dev/sdb3</span><br><span class="line">mdadm: set /dev/sdb1 faulty in /dev/md1</span><br><span class="line"></span><br><span class="line">#-f or --fail  表示失效</span><br><span class="line"></span><br><span class="line">2. 查看raid1状态</span><br><span class="line">[root@zutuanxue ~]# cat /proc/mdstat </span><br><span class="line">Personalities : [raid0] [raid1] </span><br><span class="line">md1 : active raid1 sdb4[1] sdb3[0](F)	F表示失效失败</span><br><span class="line">      20953024 blocks super 1.2 [2/1] [_U]</span><br><span class="line">      #_表示有一块盘失效</span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# mdadm -D /dev/md1</span><br><span class="line">。。。</span><br><span class="line">Number Major Minor RaidDevice State</span><br><span class="line">-      0     0     0      		removed</span><br><span class="line">1      8     33    1          active sync  /dev/sdb4</span><br><span class="line">0      8     17    -          faulty       /dev/sdb3</span><br><span class="line"> #失效盘等待移除</span><br><span class="line">       </span><br><span class="line">3. 移除故障或者失效硬盘（热拔）</span><br><span class="line">[root@zutuanxue ~]# mdadm /dev/md1 -r /dev/sdb3</span><br><span class="line">mdadm: hot removed /dev/sdb3 from /dev/md1</span><br><span class="line"></span><br><span class="line">#-r or --remove 表示移除</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# mdadm -D /dev/md1</span><br><span class="line">。。。</span><br><span class="line">  Number   Major   Minor   RaidDevice State</span><br><span class="line">       -       0        0        0      removed</span><br><span class="line">       1       8       33        1      active sync   /dev/sdb4</span><br><span class="line"></span><br><span class="line">4. 加入新的磁盘到raid1中（热插）</span><br><span class="line">[root@zutuanxue ~]# mdadm  /dev/md1 -a /dev/sdb5</span><br><span class="line">mdadm: added /dev/sdd5</span><br><span class="line"></span><br><span class="line">#-a or --add 表示增加</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cat /proc/mdstat </span><br></pre></td></tr></table></figure>

<h2 id="三、创建RAID5"><a href="#三、创建RAID5" class="headerlink" title="三、创建RAID5"></a>三、创建RAID5</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">创建raid5:</span><br><span class="line">[root@zutuanxue ~]# mdadm -C /dev/md5 -l 5 -n 3 -x 1 /dev/sdb&#123;6,7,8,9&#125;</span><br><span class="line"></span><br><span class="line">#-x, --spare-devices=  表示指定热备盘</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cat /proc/mdstat </span><br><span class="line">Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] </span><br><span class="line">md5 : active raid5 sdb8[4] sdb9[3](S) sdb7[1] sdb6[0]	#S备用盘</span><br><span class="line">      4188160 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/3] [UUU]</span><br><span class="line">      </span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">说明：热备盘表示当其中一块盘故障后，热备盘会立马顶上去，而不需要人为手动干预。</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# mdadm -D /dev/md5 		查看详细信息</span><br><span class="line">。。。</span><br><span class="line">    Number   Major   Minor   RaidDevice State</span><br><span class="line">       0       8       22        0      active sync   /dev/sdb6</span><br><span class="line">       1       8       23        1      active sync   /dev/sdb7</span><br><span class="line">       4       8       24        2      active sync   /dev/sdb8</span><br><span class="line"></span><br><span class="line">       3       8       25        -      spare   /dev/sdb9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">格式化挂载使用：</span><br><span class="line">[root@zutuanxue ~]# mkfs.ext4 /dev/md5</span><br><span class="line">[root@zutuanxue ~]# mkdir /md5</span><br><span class="line">[root@zutuanxue ~]# mount /dev/md5 /md5/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看空间使用情况：</span><br><span class="line">[root@zutuanxue ~]# df -h</span><br><span class="line">文件系统             容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/md5             3.9G   16M  3.7G    1% /md5</span><br><span class="line">#可用空间 （磁盘数量-1）x 单一磁盘容量</span><br><span class="line"></span><br><span class="line">测试热备磁盘作用：</span><br><span class="line">1. 标记一块活动盘失效</span><br><span class="line">[root@zutuanxue /]# mdadm /dev/md5 -f /dev/sdb6</span><br><span class="line">mdadm: set /dev/sdb6 faulty in /dev/md5</span><br><span class="line"></span><br><span class="line">立即查看状态：</span><br><span class="line">[root@zutuanxue /]# cat /proc/mdstat </span><br><span class="line">Personalities : [raid0] [raid1] [raid6] [raid5] [raid4] </span><br><span class="line">md5 : active raid5 sdb8[4] sdb9[3] sdb7[1] sdb6[0](F)</span><br><span class="line">说明：</span><br><span class="line">sdb6(F)失效后，原来的sdb9(S)热备盘立马顶上去同步数据</span><br><span class="line">      4188160 blocks super 1.2 level 5, 512k chunk, algorithm 2 [3/2] [_UU]</span><br><span class="line">      [==&gt;..................]  recovery = 13.0% ..          </span><br><span class="line">unused devices: &lt;none&gt;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue /]# mdadm -D /dev/md5</span><br><span class="line">...</span><br><span class="line">      Number   Major   Minor   RaidDevice State</span><br><span class="line">       3       8       25        0      active sync   /dev/sdb9</span><br><span class="line">       1       8       23        1      active sync   /dev/sdb7</span><br><span class="line">       4       8       24        2      active sync   /dev/sdb8</span><br><span class="line"></span><br><span class="line">       0       8       22        -      faulty   /dev/sdb6</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">2. 移除失效的盘</span><br><span class="line">[root@zutuanxue /]# mdadm  /dev/md5 -r /dev/sdb6 </span><br><span class="line">mdadm: hot removed /dev/sdb6 from /dev/md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 为了日后考虑，再次添加一个热备盘到raid5中</span><br><span class="line">[root@zutuanxue /]# mdadm /dev/md5 -a /dev/sdb6</span><br><span class="line">mdadm: added /dev/sdb6</span><br></pre></td></tr></table></figure>

<h2 id="四、-保存RAID信息"><a href="#四、-保存RAID信息" class="headerlink" title="四、 保存RAID信息"></a>四、 保存RAID信息</h2><p>问：为什么要保存raid信息？<br>答：如果不做信息的保存，在CentOS6中，重启系统后raid不能自动被识别到，7,8系统中不会出现这种状况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 创建配置文件</span><br><span class="line">[root@zutuanxue ~]# mdadm -D --scan &gt;&gt; /etc/mdadm.conf </span><br><span class="line">[root@zutuanxue ~]# cat /etc/mdadm.conf </span><br><span class="line">ARRAY /dev/md/1 metadata=1.2 name=localhost.localdomain:1 UUID=170d690d:4f7ccd02:646c3ce0:8f6012be</span><br><span class="line">ARRAY /dev/md/0 metadata=1.2 name=localhost.localdomain:0 UUID=a845702e:9251cae9:25d1bc8b:9a337df2</span><br><span class="line">ARRAY /dev/md/5 metadata=1.2 spares=1 name=localhost.localdomain:5 UUID=d49e6cca:5312271b:7e8e83d5:adac4ed5</span><br></pre></td></tr></table></figure>

<h4 id="raid停止与启动"><a href="#raid停止与启动" class="headerlink" title="raid停止与启动"></a>raid停止与启动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">以RAID5为例说明：</span><br><span class="line">停止raid:</span><br><span class="line">1. 卸载raid</span><br><span class="line">[root@zutuanxue ~]# umount /md5 </span><br><span class="line">2. 使用命令停止raid</span><br><span class="line">[root@zutuanxue ~]# mdadm --stop /dev/md5</span><br><span class="line">mdadm: stopped /dev/md5</span><br><span class="line"></span><br><span class="line">启动raid：</span><br><span class="line">1. 配置文件(/etc/mdadm.conf)存在如下启动</span><br><span class="line">[root@zutuanxue ~]# mdadm -A /dev/md5</span><br><span class="line">mdadm: /dev/md5 has been started with 3 drives and 1 spare.</span><br><span class="line"></span><br><span class="line">#-A：Assemble a pre-existing array  表示装载一个已存在的raid</span><br><span class="line"></span><br><span class="line">2. 配置文件(/etc/mdadm.conf)不存在如下启动</span><br><span class="line">[root@zutuanxue ~]# mdadm -A /dev/md5 /dev/sdb[6789]</span><br><span class="line">mdadm: /dev/md5 has been started with 3 drives and 1 spare.</span><br><span class="line"></span><br><span class="line">3. 如果设备名不知道，可以去查看每个设备的raid信息，使用uuid把raid设备重新组合</span><br><span class="line">[root@zutuanxue ~]# mdadm -E /dev/sdb6 | grep UUID</span><br><span class="line">     Array UUID : d49e6cca:5312271b:7e8e83d5:adac4ed5</span><br><span class="line">    Device UUID : b933b8d5:04a6e003:90e9b230:d13cacf5</span><br><span class="line"></span><br><span class="line"> 说明：同一个raid里每个磁盘查看的UUID都是这个值</span><br><span class="line">。。。</span><br><span class="line">[root@zutuanxue ~]# mdadm -E /dev/sdb7 | grep UUID</span><br><span class="line">     Array UUID : d49e6cca:5312271b:7e8e83d5:adac4ed5</span><br><span class="line">    Device UUID : b8ca85bd:7809faa4:48882a21:98ef9349</span><br><span class="line"></span><br><span class="line">通过以上方法找到后进行重新组合，如下：</span><br><span class="line">[root@zutuanxue ~]# mdadm -A --uuid=d49e6cca:5312271b:7e8e83d5:adac4ed5 /dev/md5</span><br><span class="line">mdadm: /dev/md5 has been started with 3 drives and 1 spare.</span><br></pre></td></tr></table></figure>

<h4 id="raid的删除"><a href="#raid的删除" class="headerlink" title="raid的删除"></a>raid的删除</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 卸载设备</span><br><span class="line">[root@zutuanxue ~]# umount /md5/</span><br><span class="line">2. 移除所有磁盘</span><br><span class="line">[root@zutuanxue ~]# mdadm /dev/md5 -f /dev/sdb[6789]</span><br><span class="line">mdadm: set /dev/sdb6 faulty in /dev/md5</span><br><span class="line">mdadm: set /dev/sdb7 faulty in /dev/md5</span><br><span class="line">mdadm: set /dev/sdb8 faulty in /dev/md5</span><br><span class="line">mdadm: set /dev/sdb9 faulty in /dev/md5</span><br><span class="line">[root@zutuanxue ~]# mdadm /dev/md5 -r /dev/sdb[6789]</span><br><span class="line">mdadm: hot removed /dev/sdb6 from /dev/md5</span><br><span class="line">mdadm: hot removed /dev/sdb7 from /dev/md5</span><br><span class="line">mdadm: hot removed /dev/sdb8 from /dev/md5</span><br><span class="line">mdadm: hot removed /dev/sdb9 from /dev/md5</span><br><span class="line"></span><br><span class="line">3. 停止raid</span><br><span class="line">[root@zutuanxue ~]# mdadm --stop /dev/md5</span><br><span class="line">mdadm: stopped /dev/md5</span><br><span class="line"></span><br><span class="line">4. 擦出超级块（superblock）清除相关信息</span><br><span class="line">[root@zutuanxue ~]# mdadm --zero-superblock /dev/sdb[6789]</span><br></pre></td></tr></table></figure>

<h1 id="CentOS-8启动流程"><a href="#CentOS-8启动流程" class="headerlink" title="CentOS 8启动流程"></a>CentOS 8启动流程</h1><p> 阅读 (191549) </p>
<p> 分享</p>
<h2 id="一、BIOS与UEFI"><a href="#一、BIOS与UEFI" class="headerlink" title="一、BIOS与UEFI"></a>一、BIOS与UEFI</h2><p><strong>BIOS</strong></p>
<p>Basic Input Output System的缩写，翻译过来就是“基本输入输出系统”，是一种业界标准的固件接口，第一次出现在1975年，是计算机启动时加载的第一个程序，主要功能是检测和设置计算机硬件，引导系统启动。</p>
<p><strong>UEFI</strong><br>Unified Extensible Firmware interface的缩写，翻译过来为统一可扩展固件接口，是BIOS的替代方案，前身是Intel在1998年开始开发的Inter Bot Initiative，后来被命名为可扩展固件接口（Extensible Firmware Interface EFI），2005年交由统一可扩展固件接口论坛，并更名为UEFI</p>
<p><strong>UEFI的优势</strong></p>
<p>1、支持硬盘容量更大：相比于传统BIOS+MBR只能支持2048G的硬盘分区和4个主分区相比，UEFI+GPT不会受到硬盘容量大小、分区数量的限制，不过在Windows系统上由于系统的限制，支持最多128个GPT磁盘分区，最大分区18EB，并且GPT格式是没有主分区和逻辑分区这个概念的</p>
<p>2、容错特性：UEFI是模块化构建，比BIOS容错和纠错特性强。</p>
<p>3、鼠标操作：UEFI内置图形驱动，可以提供原生分辨率的图形环境，用户进入后可以使用鼠标调整。</p>
<p>4、扩展性强：UEFI包含一个可编程的开放接口，厂商利用这个接口可以对功能进行扩展，如：备份和诊断</p>
<p>5、支持联网：在不进入操作系统的前提下就可以通过网络进行远程故障诊断</p>
<h2 id="二、CentOS8启动流程"><a href="#二、CentOS8启动流程" class="headerlink" title="二、CentOS8启动流程"></a>二、CentOS8启动流程</h2><p>现代计算机是软件与硬件的复杂组合，从接通电源开始，到可以登录到系统中，需要大量的软件和硬件的配合，我们一起来了解一下CentOS8的x86_64系统在启动过程中所涉及的任务，虚拟机的流程也是大致相同的，但是某些与硬件相关的步骤是由虚拟机的相关程序在软件中处理的。</p>
<p><strong>1、接通电源</strong></p>
<p> 系统固件（UEFI或BIOS初始化）运行开机自检，并初始化部分硬件</p>
<p><strong>2、系统固件搜索可启动设备</strong></p>
<p> 启动设备可能是UEFI启动固件中配置的，也可能是按照BIOS中配置的顺序搜索所有磁盘上的主启动记录（MBR）</p>
<p><strong>3、读取启动加载器</strong>（boot loader）</p>
<p> 系统固件会从MBR中读取启动加载器，然后将控制权交给启动加载器，在CentOS8中启动加载器为GRUB2</p>
<p><strong>4、grub.cfg</strong></p>
<p> GRUB2将从&#x2F;boot&#x2F;grub2&#x2F;grub.cfg文件中加载配置并显示一个菜单，在这个菜单中可以选择要启动的内核，我们可以使用grub2-mkconfig命令配合&#x2F;etc&#x2F;grub.d&#x2F;目录和&#x2F;etc&#x2F;default&#x2F;grub文件生成grub.cfg文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cd /boot/grub2/</span><br><span class="line">[root@zutuanxue grub2]# ls</span><br><span class="line">device.map  fonts  grub.cfg  grubenv  i386-pc</span><br><span class="line">[root@zutuanxue grub2]# pwd</span><br><span class="line">/boot/grub2</span><br></pre></td></tr></table></figure>

<p><strong>5、initramfs</strong></p>
<p> 在选择内核或到达超时时间后，启动加载器会从磁盘加载内核(vmlinuz)和initramfs，并将它们放入内存中，initramfs中包含启动时所有必要硬件的内核模块（驱动）和初始化脚本等，使用lsinitrd和dracut命令配合&#x2F;etc&#x2F;dracut.conf.d&#x2F;目录可以查看和配置initramfs文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue grub2]# lsinitrd  | more</span><br><span class="line">Image: /boot/initramfs-4.18.0-80.el8.x86_64.img: 27M</span><br><span class="line">##可以在回显中看到系统的主要目录，包括/etc /usr /dev /lib /lib64等</span><br></pre></td></tr></table></figure>

<p><strong>6、启动加载器放权</strong></p>
<p> 启动加载器将控制权交给内核</p>
<p><strong>7、内核初始化</strong></p>
<p> 内核会在initramfs中寻找硬件的相关驱动并初始化相关硬件，然后启动&#x2F;usr&#x2F;sbin&#x2F;init（PID&#x3D;1），在CentOS8中&#x2F;sbin&#x2F;init是systemd的链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue grub2]# ll /sbin/init </span><br><span class="line">lrwxrwxrwx. 1 root root 22 5月  23 2019 /sbin/init -&gt; ../lib/systemd/systemd</span><br><span class="line">[root@zutuanxue grub2]# find / -name systemd</span><br><span class="line">/usr/lib/systemd/systemd</span><br></pre></td></tr></table></figure>

<p><strong>8、启动initrd.target并挂载</strong></p>
<p> systemd会执行initrd.target包含的所有单元，并将根文件系统挂载到&#x2F;sysroot&#x2F;目录,在initrd.target启动时的依赖单元，会按照&#x2F;etc&#x2F;fstab设置对硬盘进行挂载</p>
<p><strong>9、切换根文件系统</strong></p>
<p> 内核将根文件系统从initramfs切换为&#x2F;sysroot（硬盘上的根文件系统），systemd会找到磁盘上安装的systemd并自动重新执行</p>
<p><strong>10、启动相应目标</strong></p>
<p> 硬盘上安装的systemd会查找从内核命令行传递的目标或是系统中配置的默认目标并启动对应单元后就可以进入到对应的登录界面。默认目标是&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;default.target，</p>
<p><strong>注意：</strong><br>字符界面：</p>
<p> 如果默认目标为multi-user.target（字符界面），systemd会先执行sysinit.target初始化系统之后执行basic.target与getty.target准备基本系统环境和终端，再启动multi-user.target下的相关应用，同时执行&#x2F;etc&#x2F;rc.d&#x2F;rc.local(需要执行权限)与与登录服务（systemd-logind.service），开启登录界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl list-dependencies multi-user.target | grep target</span><br><span class="line">multi-user.target</span><br><span class="line">● ├─basic.target</span><br><span class="line">● │ ├─paths.target</span><br><span class="line">● │ ├─slices.target</span><br><span class="line">● │ ├─sockets.target</span><br><span class="line">● │ ├─sysinit.target</span><br><span class="line">● │ │ ├─cryptsetup.target</span><br><span class="line">● │ │ ├─local-fs.target</span><br><span class="line">● │ │ └─swap.target</span><br><span class="line">● │ └─timers.target</span><br><span class="line">● ├─getty.target</span><br><span class="line">● ├─nfs-client.target</span><br><span class="line">● │ └─remote-fs-pre.target</span><br><span class="line">● └─remote-fs.target</span><br><span class="line">●   └─nfs-client.target</span><br><span class="line">●     └─remote-fs-pre.target</span><br></pre></td></tr></table></figure>

<p>图形界面：</p>
<p> 在multi-user.target的基础上执行graphical.target启动所需要的服务，开启图形界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl list-dependencies graphical.target | grep target</span><br><span class="line">graphical.target</span><br><span class="line">● └─multi-user.target</span><br><span class="line">●   ├─basic.target</span><br><span class="line">●   │ ├─paths.target</span><br><span class="line">●   │ ├─slices.target</span><br><span class="line">●   │ ├─sockets.target</span><br><span class="line">●   │ ├─sysinit.target</span><br><span class="line">●   │ │ ├─cryptsetup.target</span><br><span class="line">●   │ │ ├─local-fs.target</span><br><span class="line">●   │ │ └─swap.target</span><br><span class="line">●   │ └─timers.target</span><br><span class="line">●   ├─getty.target</span><br><span class="line">●   ├─nfs-client.target</span><br><span class="line">●   │ └─remote-fs-pre.target</span><br><span class="line">●   └─remote-fs.target</span><br><span class="line">●     └─nfs-client.target</span><br><span class="line">●       └─remote-fs-pre.target</span><br></pre></td></tr></table></figure>

<h2 id="三、运行级别切换与相关配置文件"><a href="#三、运行级别切换与相关配置文件" class="headerlink" title="三、运行级别切换与相关配置文件"></a>三、运行级别切换与相关配置文件</h2><p><strong>运行级别切换</strong></p>
<p> 通过前面的课程我们了解到CentOS8在启动过程中需要判断对应的运行级别，在不同的运行级别中会启动不同的单元，那么运行级别如何切换呢？</p>
<p> 在CentOS8中运行级别的设置涉及到下面几个命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl isolate	.../init [0-6]	切换运行级别</span><br><span class="line">systemctl	get-default				查看当前的默认运行级别</span><br><span class="line">systemctl set-default ...		设置默认的运行级别</span><br><span class="line">runlevel										查看之前的运行级别和当前的运行级别</span><br></pre></td></tr></table></figure>


<p>运行级别对照</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost system]# cd /usr/lib/systemd/system</span><br><span class="line">[root@localhost system]# ll runlevel*.target</span><br><span class="line">runlevel0.target -&gt; poweroff.target</span><br><span class="line">runlevel1.target -&gt; rescue.target</span><br><span class="line">runlevel2.target -&gt; multi-user.target</span><br><span class="line">runlevel3.target -&gt; multi-user.target</span><br><span class="line">runlevel4.target -&gt; multi-user.target</span><br><span class="line">runlevel5.target -&gt; graphical.target</span><br><span class="line">runlevel6.target -&gt; reboot.target</span><br></pre></td></tr></table></figure>

<p>所以当我们使用init [0-6]切换运行级别的时候系统执行的是systemctl isolate runlevel[0-6].target</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# runlevel #查看运行级别</span><br><span class="line">N 5</span><br><span class="line">[root@zutuanxue ~]# init 3	#切换到字符界面</span><br><span class="line">[root@zutuanxue ~]# runlevel 	#查看运行级别</span><br><span class="line">5 3</span><br><span class="line">[root@zutuanxue ~]# systemctl isolate graphical.target 	#切换到图形界面</span><br><span class="line">[root@zutuanxue ~]# runlevel </span><br><span class="line">3 5</span><br><span class="line"></span><br><span class="line">#########</span><br><span class="line">emergency.target</span><br><span class="line">[root@zutuanxue ~]# systemctl isolate emergency.target </span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996176505.png" alt="image20191224152253190.png"></p>
<p>注意：此为紧急模式，用于紧急处理系统的错误，无法使用rescue.target时，可以尝试使用此模式。</p>
<h2 id="四、Boot-Loader与GRUB2"><a href="#四、Boot-Loader与GRUB2" class="headerlink" title="四、Boot Loader与GRUB2"></a>四、Boot Loader与GRUB2</h2><p>前面的课程我们了解的CentOS8的启动流程，在这个流程中有一个叫启动加载器，也就是boot loader的工具，如果没有这个boot loader就无法加载内核。在CentOS8中使用的是启动加载器是Grub2，在了解Grub2之前，我们先聊一下boot loader</p>
<h3 id="4-1、Boot-Loader的两个阶段"><a href="#4-1、Boot-Loader的两个阶段" class="headerlink" title="4.1、Boot Loader的两个阶段"></a>4.1、Boot Loader的两个阶段</h3><p>我们知道在BIOS或者UEFI加载完成之后，会到MBR中读取boot loader，这个boot loader可以让用户选择加载的内核并且移交系统的控制权限等，而加载内核只能通过boot loader，但是boot loader在MBR中，这个MBR是硬盘的第一个扇区，一个扇区的大小是512字节，boot loader的大小只有446字节，即便是GPT磁盘也没有足够的空间存储boot loader所包含的内容，所以为了避免空间的限制，导致无法引导系统正常启动的问题，Linux将boot loader的工作过程分为了两步。</p>
<p>stage1 执行boot loader的主程序<br>主程序必须安装在MBR或者是启动扇区，由于空间限制，MBR或启动扇区仅存放最小化的boot loader，并不会存放相关的配置文件</p>
<p>stage2 通过主程序加载配置文件<br>通过boot loader的主程序加载所有相关的配置文件，这些配置文件中包括定义文件系统类型的和CentOS8中的grub.cfg文件，而这些文件通常都存放在&#x2F;boot当中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ll -F /boot/grub2/</span><br><span class="line">总用量 32</span><br><span class="line">-rw-r--r--. 1 root root    64 12月 13 21:50 device.map</span><br><span class="line">drwxr-xr-x. 2 root root  4096 12月 13 21:50 fonts/</span><br><span class="line">-rw-r--r--. 1 root root  5032 12月 13 21:50 grub.cfg</span><br><span class="line">-rw-r--r--. 1 root root  1024 12月 13 21:50 grubenv</span><br><span class="line">drwxr-xr-x. 2 root root 12288 12月 13 21:50 i386-pc/</span><br><span class="line"></span><br><span class="line">device.map		设备对应文件，用来帮助系统判断磁盘与设备文件的对应关系</span><br><span class="line">fonts					开机过程中用到的字体文件</span><br><span class="line">grub.cfg			grub2的主配置文件</span><br><span class="line">grubenv				grub环境区块文件大小为1K，用来记录GRUB环境变量</span><br><span class="line">i386-PC				针对x86架构的电脑所需要的相关模块，包括电源管理支持，文件系统支持等模块</span><br></pre></td></tr></table></figure>

<p>在这些文件中最重要的就是grub.cfg文件，以及文件系统支持的相关模块</p>
<h3 id="4-2、GRUB2"><a href="#4-2、GRUB2" class="headerlink" title="4.2、GRUB2"></a>4.2、GRUB2</h3><p><strong>GRUB与LILO</strong><br>目前为止，linux下的启动加载器有两种，一种是LILO另外一种就是GRUB，由于GRUB的功能更强大，支持的文件系统较多，所以越来越多的操作系统使用GRUB做为boot loader，CentOS从7开始使用了功能更为强大的GRUB2</p>
<p><strong>GRUB2的优点</strong></p>
<ul>
<li>支持更多的文件系统</li>
<li>开机时可以手动调整启动参数</li>
<li>动态更新配置文件，修改完配置文件后不需要重新安装</li>
</ul>
<p><strong>GRUB2与硬盘</strong></p>
<p>由于grub2的主要任务是从硬盘当中加载内核，所以grub2必须要识别硬盘，但是grub2识别硬盘的方式与linux系统识别的方式还是有些区别的。在Linux系统中，硬盘一般会被识别为类似sda1这种形式，而在grub2中硬盘会统一被识别为hd的设备，排序方式全部是用数字进行排序，而不是用字母加数字的混合形式。这么做的目的是为了定义grub2的查找内核时的顺序。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hd0,1		搜索第一块硬盘的第一个分区</span><br><span class="line">hd0,msdos1	搜索第一块MBR硬盘的第一个分区</span><br><span class="line">hd0,gpt1	搜索第一块GPT磁盘的第一个分区</span><br><span class="line">简单来说，两个数字，第一个数字表示硬盘序号，第二个数字表示分区序号</span><br></pre></td></tr></table></figure>

<p><strong>grub2配置文件</strong></p>
<p>了解了grub2中的硬盘识别方式，我们就可以了解一下grub2的配置文件了，这个文件建议各位不要随意更改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># DO NOT EDIT THIS FILE</span><br><span class="line">#</span><br><span class="line"># It is automatically generated by grub2-mkconfig using templates</span><br><span class="line"># from /etc/grub.d and settings from /etc/default/grub</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">此部分内容提示我们不要编辑这个文件，此文件是有grub2-mkconfig命令自动建立的，相关模板与设置存放在/etc/grub.d/目录以及/etc/default/grub中，也就是说grub.cfg文件的内容会调用/etc/grub.d目录下的内容，如果需要修改的话需要调整/etc/default/grub文件</span><br></pre></td></tr></table></figure>

<p>基本上grub2不希望用户去修改grub.cfg这个文件，如果需要调整的话需要通过修改其它文件并配合grub2-mkconfig命令来生成新的grub.cfg文件，但是各位还是要了解一下这个文件的大致格式</p>
<h3 id="x2F-etc-x2F-default-x2F-grub与-x2F-etc-x2F-grub-d-x2F"><a href="#x2F-etc-x2F-default-x2F-grub与-x2F-etc-x2F-grub-d-x2F" class="headerlink" title="&#x2F;etc&#x2F;default&#x2F;grub与&#x2F;etc&#x2F;grub.d&#x2F;"></a>&#x2F;etc&#x2F;default&#x2F;grub与&#x2F;etc&#x2F;grub.d&#x2F;</h3><p>在前面的课程中我们知道了grub2的配置文件是grub.cfg，但是此文件内容比较复杂，且官方不建议我们手动修改，如果需要修改的话需要通过&#x2F;etc&#x2F;default&#x2F;grub文件以及&#x2F;etc&#x2F;grub.d&#x2F;目录内的内容来实现，那我们一起来看一下</p>
<p><strong>&#x2F;etc&#x2F;default&#x2F;grub</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/default/grub</span><br><span class="line">GRUB_TIMEOUT=5	定义在启动菜单默认的等待时间，单位是秒</span><br><span class="line">GRUB_DISTRIBUTOR=&quot;$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)&quot;		定义获取操作系统名称的方式</span><br><span class="line">GRUB_DEFAULT=saved	定义开机时默认启动的项目，可以是数字，也可以是标题名称，(这个标题就是开机时看到的那个标题），还可以是saved（表示默认启动上次启动成功的操作系统）	</span><br><span class="line">GRUB_DISABLE_SUBMENU=true	是否隐藏子菜单</span><br><span class="line">GRUB_TERMINAL_OUTPUT=&quot;console&quot;	定义启动时的界面使用哪种终端输出，值包含console，serial，gfxterm，vga_text等</span><br><span class="line">GRUB_CMDLINE_LINUX=&quot;resume=/dev/mapper/cl-swap rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet&quot;	定义额外的启动参数</span><br><span class="line">GRUB_DISABLE_RECOVERY=&quot;true&quot;	是否启用修复模式</span><br><span class="line">GRUB_ENABLE_BLSCFG=true	是否启用bootloader规范</span><br><span class="line"></span><br><span class="line">修改完成之后需要使用</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg,重新生成配置文件</span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;etc&#x2F;grub.d&#x2F;</strong></p>
<p>00_header 设置默认参数</p>
<p>00_tuned 额外调整的值</p>
<p>01_menu_auto_hide 与菜单隐藏相关的设置</p>
<p>01_users 与用户相关的设置</p>
<p>10_linux 与内核相关的设置</p>
<p>20_ppc_terminfo 与终端相关的设置</p>
<p>20_linux_xen 与虚拟化相关的设置</p>
<p>30_os-prober 与操作系统检测相关</p>
<p>30_uefi-firmware 与UEFI启动设置相关，需要硬件支持</p>
<p>40_custom&amp;41_custom 自定义设置</p>
<p>注：这些文件会按照数字的顺序由小到大加载</p>
<h1 id="linux启动常见问题"><a href="#linux启动常见问题" class="headerlink" title="linux启动常见问题"></a>linux启动常见问题</h1><p> 阅读 (166312) </p>
<p> 分享</p>
<h2 id="一、忘记root密码"><a href="#一、忘记root密码" class="headerlink" title="一、忘记root密码"></a>一、忘记root密码</h2><p>日常生活中，我们会接触到很多账号和密码，而这些账号和密码我们不能都很好的记忆，对于linux也是一样的，如果root密码忘记了怎么办？岂不是都无法登陆使用Linux了？现在我就教各位，在不知道root密码的前提下，如何给root设置一个新的密码</p>
<p>step 1 重启你的linux系统，在下图这个界面中按“E”</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996319687.png" alt="image20200112153327155.png"></p>
<p>step 2 将光标移动到开头为linux这行的行位，删除rhgb quiet并添加rd.break</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996339150.png" alt="image20200112153507293.png"></p>
<p>step 3 按键盘上的ctrl+x组合键继续启动linux，等待出现提示符后执行mount命令</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996350235.png" alt="image20200112153640666.png"></p>
<p>step 4 执行chroot命令将根目录切换为&#x2F;sysroot(因为硬盘上的数据都存放在&#x2F;sysroot目录中)</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996365227.png" alt="image20200112153755987.png"></p>
<p>step 5 看到提示符发生变化后执行passwd命令修改root密码</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996379180.png" alt="image20200112153933632.png"></p>
<p>注：由于字符编码问题可能会出现不能正常显示的情况，如：</p>
<p>![image-20200112154028844](第九章 启动流程.assets&#x2F;image-20200112154028844.png)没有关系，不影响密码的设置</p>
<p>step 6 修改完密码之后，建立autorelabel文件</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996393570.png" alt="image20200112154548103.png"></p>
<p>step 7 输入两次exit退出，系统会继续启动</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996407104.png" alt="image20200112154627704.png"></p>
<p>启动完成之后就可以用我们刚才设置的账号及密码进行登录了</p>
<h2 id="二、GRUB2加密"><a href="#二、GRUB2加密" class="headerlink" title="二、GRUB2加密"></a>二、GRUB2加密</h2><p>前面我们知道了，如果不知道root密码的话，也是可以以root身份登录系统，那这样岂不是很危险？所以GRUB2又提供了一种保护机制，这种保护机制就是为grub2设置密码，如果用户不知道这个密码，是无法编辑启动时所看到的那个菜单的，这样也就组织了root密码被修改的问题，那么如何为grub2加密呢？</p>
<p>setp 1 以root用户的身份登录系统并打开终端，在终端中输入grub2-setpassword命令，系统就会提示我们设置一个密码，这个密码就是grub2的密码</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996426298.png" alt="image20200112155155252.png"></p>
<p>step 2 重启系统，验证是否加密成功<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996443802.png" alt="image20200112155226916.png"></p>
<p>step 3 在启动菜单界面按”E”编辑内容时，系统会提示输入用户名和密码，这个用户名是root，密码就是我们前面设置的grub2密码</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996455058.png" alt="image20200112155403705.png"></p>
<p>注意：密码在输入的时候是不会显示任何信息的</p>
<p>step 4 如果密码输入错误就会返回启动菜单界面</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996465934.png" alt="image20200112155529537.png"></p>
<h2 id="三、删除-x2F-修改GRUB2密码"><a href="#三、删除-x2F-修改GRUB2密码" class="headerlink" title="三、删除&#x2F;修改GRUB2密码"></a>三、删除&#x2F;修改GRUB2密码</h2><p>前面我们学会了如何为grub2设置密码，这样能有效的避免root用户密码被修改，但是如果我忘记了grub2的密码怎么办呢？</p>
<p>如果忘记了grub2密码，你可以让系统正常启动，然后用root用户登录系统，登录完成后使用grub2-setpassword命令重新设置一个grub2密码，或者删除&#x2F;boot&#x2F;grub2&#x2F;user.cfg文件将密码删除。</p>
<p>但是如果连root密码也不知道呢？这个时候，我们就需要用到修复模式了</p>
<p>step 1 插入系统光盘，选择从光盘启动</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996486589.png" alt="image20200112160255030.png"></p>
<p>step 2 选择故障排除（troubleshooting）</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996498711.png" alt="image20200112160449625.png"></p>
<p>step 3 选择修复系统</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996515055.png" alt="image20200112160639592.png"></p>
<p>step 4 启动完成后，系统提示我们，修复模式会查找硬盘上是否安装有Linux系统，并将其挂载到&#x2F;mnt&#x2F;sysimage目录下，我们希望它如何操作，选择1是以读写的形式挂载，选择2是以只读的形式挂载，选择3是直接获取一个shell，选择4是重启，这里面我们选择1</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996527693.png" alt="image20200112161205845.png"></p>
<p>step 5 稍微等一下之后系统会提示我们已经挂载到&#x2F;mnt&#x2F;sysimage目录下了，按“enter”会得到一个shell</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996543674.png" alt="image20200112161319135.png"></p>
<p>step 6 执行chroot &#x2F;mnt&#x2F;sysimage将工作目录切换到硬盘中</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996554318.png" alt="image20200112161421279.png"></p>
<p>step 7 接下来就像没有忘记root密码一样，可以重新设置grub2密码，或者删除user.cfg文件了，然后输入两次exit重启</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602996566428.png" alt="image20200112161615836.png"></p>
<p><img src="blog\source_posts\test-pic\1602996588086.png" alt="image20200112161628253.png"></p>
<h1 id="linux-计划任务"><a href="#linux-计划任务" class="headerlink" title="linux 计划任务"></a>linux 计划任务</h1><p> 阅读 (191034) </p>
<p> 分享</p>
<h2 id="一、什么是计划任务"><a href="#一、什么是计划任务" class="headerlink" title="一、什么是计划任务"></a>一、什么是计划任务</h2><p>每个人在生活当中或多或少都有一些工作，有的工作是按照一定周期循环的， 例如每天固定时间的闹铃、工作打卡等等； 有的工作则是临时发生的，例如刚好有亲友到访，需要你在一个特定的时间去车站迎接！ 这个时候 Linux 的计划任务就可以派上场了！ 在不考虑硬件与我们服务器的连接状态下，我们的 Linux 可以帮你提醒很多任务， 那么 Linux 的例行性工作是如何进行的？ Linux 是通过 crontab 与 at 命令来实现的</p>
<p><strong>at ：</strong></p>
<p>at 是个可以处理仅执行一次就结束工作的命令，需要一个叫atd的服务支持，所以这个服务要启动</p>
<p><strong>crontab ：</strong></p>
<p>crontab 这个命令所设定的工作将会按照一定的周期去执行！ 可循环的时间为分钟、小时、日期、每周、每月等。crontab 除了可以使用命令执行外，也可以通过编辑 &#x2F;etc&#x2F;crontab 来支持。与at相同，crontab也需要一个叫crond的服务</p>
<p>那么计划任务在系统当中到底有什么作用呢？</p>
<p><strong>1、进行日志的切割 (log rotate)：</strong><br>Linux 会主动的将系统所发生的各种信息都记录到日志中。随着使用时间的增长，日志文件会越来越大！我们知道大型文件不但占容量还会造成读写效能的困扰， 因此适时的将日志文件数据挪一挪，让旧的数据与新的数据分别存放，这样既能记录日志信息又能提高读写效率。这就是 logrotate 的任务！</p>
<p><strong>2、日志文件分析 logwatch 的任务：</strong> 如果系统发生了问题等，绝大部分的错误信息都会被记录到日志文件中， 因此系统管理员的重要任务之一就是分析日志。但你不可能手动通过 vim 等软件去查看日志文件，因为数据量太大！ 我们可以通过一个叫“ logwatch ”的程序分析日志信息，在启动邮件服务的前提下，你的 root 老是会收到标题为 logwatch 的信件</p>
<p><strong>3、建立 locate 的数据库：</strong><br>有时候我们会通过locate命令来查询文件。而文件名数据库是放置到 &#x2F;var&#x2F;lib&#x2F;mlocate&#x2F; 中。 这个数据库也是通过计划任务定期的执行updatedb命令去更新的</p>
<p><strong>4、RPM 软件日志文件的建立：</strong></p>
<p>系统会经常安装或卸载软件包。为了方便查询，系统也会将这些软件包的名称进行记录！ 所以计划任务也会定期帮助我们更新rpm数据库</p>
<p><strong>5、移除临时文件：</strong><br>软件在运行中会产生一些临时文件，但是当这个软件关闭时，这些临时文件可能并不会主动的被删除。有些时候这些文件对于系统来讲没有什么用处了，还占用磁盘空间。系统通过计划任务来定期来删除这些临时文件！</p>
<h2 id="二、仅执行一次的计划任务"><a href="#二、仅执行一次的计划任务" class="headerlink" title="二、仅执行一次的计划任务"></a>二、仅执行一次的计划任务</h2><p>首先，我们先来谈谈仅运行一次的计划任务at</p>
<h3 id="2-1、-atd-的启动与-at-运行的方式"><a href="#2-1、-atd-的启动与-at-运行的方式" class="headerlink" title="2.1、 atd 的启动与 at 运行的方式"></a>2.1、 atd 的启动与 at 运行的方式</h3><p>在使用at之前我们要确保atd服务是运行的，这个需要我们去检查一下，因为并不是所有的发行版linux默认都是开启这个服务的，但是在CentOS中是默认开启的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl status atd</span><br><span class="line">● atd.service - Job spooling tools</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/atd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2020-01-13 09:34:03 CST; 1h 17min ago</span><br><span class="line">#查询atd服务的状态</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl is-enabled atd</span><br><span class="line">enabled</span><br><span class="line"></span><br><span class="line">#查询是否开启默认启动</span><br><span class="line"></span><br><span class="line">如果没有启动</span><br><span class="line">[root@zutuanxue ~]# systemctl start atd  </span><br><span class="line"># 启动</span><br><span class="line">[root@zutuanxue ~]# systemctl enable atd</span><br><span class="line">#设置为开启启动</span><br></pre></td></tr></table></figure>

<p><strong>at的工作模式</strong></p>
<p>at在运行的时候会将定义好的工作以文本文件的方式写入 &#x2F;var&#x2F;spool&#x2F;at&#x2F; 目录内，该工作便能等待 atd 这个服务的调用，但是出于安全考虑，并不是所有的人都可以使用 at 计划任务！所以系统给我们提供了两个文件 &#x2F;etc&#x2F;at.allow 与 &#x2F;etc&#x2F;at.deny 来进行 at 的使用限制！ 加上这两个文件后， at 的工作情况其实是这样的：</p>
<p>先找寻 &#x2F;etc&#x2F;at.allow 这个文件，写在这个文件中的用户才能使用 at ，没有在这个文件中的用户则不能使用 at (即使没有写在 at.deny 当中)；</p>
<p>如果 &#x2F;etc&#x2F;at.allow 不存在，就寻找 &#x2F;etc&#x2F;at.deny 这个文件，若写在这个 at.deny 的用户则不能使用 at ，而没有在这个 at.deny 文件中的用户，就可以使用 at ；</p>
<p>如果两个文件都不存在，那么只有 root 可以使用 at 这个命令。</p>
<p>在大多数发行版当中，由于假设系统上的所有用户都是可信任的， 因此系统通常会保留一个空的 &#x2F;etc&#x2F;at.deny 文件，允许所有人使用 at 。如果有需要的话可以手动建立at.allow文件</p>
<h3 id="2-2、at的使用"><a href="#2-2、at的使用" class="headerlink" title="2.2、at的使用"></a>2.2、at的使用</h3><p>单一计划任务的进行就使用 at 这个命令！将 at 加上一个时间即可！基本的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# at  [-mldv] TIME  </span><br><span class="line">[root@zutuanxue ~]# at -c 工作序号 </span><br><span class="line">选项与参数：  </span><br><span class="line">-m ：当 at 的工作完成后，发邮件通知用户，需要mail服务</span><br><span class="line">-l ：at -l 相当于 atq，查看用户使用at定制的工作</span><br><span class="line">-d ：at -d 相当于 atrm ，删除一个工作；  </span><br><span class="line">-v ：详细信息；  </span><br><span class="line">-c ：查看指定工作的具体内容。  </span><br><span class="line">TIME：时间格式  </span><br><span class="line">		HH:MM      ex&gt; 16:00    </span><br><span class="line">		在今天指定的时刻进行，若该时刻已超过，则明天的这个时间进行此工作。   </span><br><span class="line">		HH:MM  YYYY-MM-DD   ex&gt; 16:00 2021-07-30    </span><br><span class="line">		指定在某年某月的某一天的时间进行该工作！     </span><br><span class="line">		HH:MM[am|pm] [Month] [Date]  ex&gt;  04am Jun 15    			另外一种年月日和时间的指定方式     </span><br><span class="line">		HH:MM[am|pm] + number [minutes|hours|days|weeks]    		ex&gt; now  + 5 minutes 	五分钟之后</span><br><span class="line">		ex&gt; 04am + 3 days    	三天后的上午四点  </span><br></pre></td></tr></table></figure>

<p>at在使用过程中的时间指定很重要，另外在使用过程中如果涉及到路径的指定，强烈建议使用绝对路径，定义完成at之后使用键盘上的ctrl+d结束</p>
<p><strong>1、at 的管理</strong></p>
<p>有的时候我用at定义完计划任务之后，发现命令有错误，此时我们就可以使用atq 与 atrm 进行管理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# atq  </span><br><span class="line">[root@zutuanxue ~]# atrm 工作编号 </span><br><span class="line">[root@zutuanxue at]# atq</span><br><span class="line">2	Fri Feb 21 16:00:00 2020 a root</span><br><span class="line"># 在 2020-02-21 的 16:00 有一项工作，该项工作是root设置的，工作编号为2</span><br><span class="line">[root@zutuanxue ~]# atrm 2  </span><br><span class="line">[root@zutuanxue ~]# atq  # 没有任何信息，表示该工作被移除了！  </span><br></pre></td></tr></table></figure>

<p>这样，你可以利用 atq 来查询，利用 atrm 来删除，利用 at 来直接定义计划任务但是如果系统当前非常忙碌话，能不能让指定的工作在较闲的时候执行呢？那就是batch！</p>
<p><strong>2、batch：系统有空时才进行后台任务</strong></p>
<p>batch是at的一个辅助工具，也是利用at进行工作的，只是加入一些判断功能。它会在 CPU 的工作负载小于 0.8 的时候，才执行指定的工作！ 这个负载指的是 CPU 在单一时间点所负责的工作数量。不是 CPU 的使用率！ 比如说，如果我运行一个程序，这个程序可以使CPU 的使用率持续达到 100% ， 但是 CPU 的负载接近与1，因为 CPU 仅负责一个工作，而我同时运行了两个这样的程序，那么 CPU 的使用率还是 100% ，但是工作负载则变成 2 了。</p>
<p>也就是说，当 CPU 的负载越大，CPU 必须要在不同的工作之间进行频繁的切换。所以会非常忙碌！ 而用户还要额外进行 at 完成工作，就不太合理！所以才有 batch 命令的产生！</p>
<p>CentOS从7开始，batch 已经不再支持时间参数了，所以我们在使用batch定制计划任务的时候可以这样输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@zutuanxue at]# batch</span><br><span class="line">warning: commands will be executed using /bin/sh</span><br><span class="line">at&gt; cp /etc/passwd /root</span><br><span class="line">at&gt; &lt;EOT&gt;</span><br><span class="line">job 4 at Mon Jan 13 11:31:00 2020</span><br><span class="line">[root@zutuanxue at]# cd</span><br><span class="line">[root@zutuanxue ~]# ls</span><br><span class="line">公共  模板  视频  图片  文档  下载  音乐  桌面  anaconda-ks.cfg  initial-setup-ks.cfg  passwd</span><br></pre></td></tr></table></figure>

<p>所以，batch可以通过cpu负载自动判断是否可以执行指定的工作。</p>
<h2 id="三、周期执行的计划任务"><a href="#三、周期执行的计划任务" class="headerlink" title="三、周期执行的计划任务"></a>三、周期执行的计划任务</h2><p>相对于 at 是仅执行一次的工作，周期执行的计划任务则是由 crond这个系统服务来控制的。同样各位在使用的时候也要确认一下此服务的状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl status crond</span><br><span class="line">● crond.service - Command Scheduler</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/crond.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2020-01-13 09:34:03 CST; 2h 0min ago</span><br><span class="line">[root@zutuanxue ~]# systemctl is-enabled crond</span><br><span class="line">enabled</span><br></pre></td></tr></table></figure>

<h3 id="3-1、如何使用"><a href="#3-1、如何使用" class="headerlink" title="3.1、如何使用"></a>3.1、如何使用</h3><p>用户使用的是 crontab 这个命令来定义周期性的计划任务，但是为了安全性的问题， 与 at 同样的，我们可以限制使用 crontab 的用户账号！使用的限制数据有：</p>
<p><strong>&#x2F;etc&#x2F;cron.allow：</strong><br>将可以使用 crontab 的账号写入其中，若不在这个文件内的用户则不可使用 crontab；</p>
<p><strong>&#x2F;etc&#x2F;cron.deny：</strong><br>将不可以使用 crontab 的账号写入其中，若未记录到这个文件当中的用户，就可以使用 crontab 。</p>
<p>与 at 一样，以优先级来说， &#x2F;etc&#x2F;cron.allow 比 &#x2F;etc&#x2F;cron.deny 要高， 一般系统默认是提供 &#x2F;etc&#x2F;cron.deny ， 你可以将允许使用 crontab 用户写入 &#x2F;etc&#x2F;cron.deny 当中，一个账号一行。crontab 建立计划任务会存放在 &#x2F;var&#x2F;spool&#x2F;cron&#x2F; 目录中，</p>
<p>crontab 的使用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# crontab</span><br><span class="line">-u ：只有root可以使用，指定其它用户的名称</span><br><span class="line">-e ：建立计划任务  </span><br><span class="line">-l ：查看计划任务  </span><br><span class="line">-r ：删除所有计划任务，若只删除一项，只能使用-e进行编辑  </span><br><span class="line">[root@zutuanxue ~]# crontab -e</span><br><span class="line">#执行后会打开一个vim的页面，每个任务一行  </span><br><span class="line">0	12 	* 	*  *			cp	/etc/passwd /root</span><br><span class="line">分 时 日 	月 周				工作内容</span><br></pre></td></tr></table></figure>

<p>编辑完毕之后输入“ :wq ”保存退出， 在cron中每项工作 (每行) 的格式都是具有六个字段，这六个字段的意义为：</p>
<table>
<thead>
<tr>
<th>意义</th>
<th>分钟</th>
<th>小时</th>
<th>日期</th>
<th>月份</th>
<th>周</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>范围</td>
<td>0-59</td>
<td>0-23</td>
<td>1-31</td>
<td>1-12</td>
<td>0-7</td>
<td>工作内容</td>
</tr>
</tbody></table>
<p>比较有趣的是那个『周』！周的数字为 0 或 7 时，都代表『星期天』的意思！另外，还有一些辅助的字符，大概有底下这些：</p>
<table>
<thead>
<tr>
<th align="left">特殊字符</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*(星号)</td>
<td align="left">代表任何时刻</td>
</tr>
<tr>
<td align="left">,(逗号)</td>
<td align="left">代表分隔时段的意思。如3:00 与 6:00 时，就是：0 3,6 * * *</td>
</tr>
<tr>
<td align="left">-(减号)</td>
<td align="left">代表一段时间范围内，如：8 点到 12 点之间的每小时的 20 分都进行一项工作：20 8-12 * * *</td>
</tr>
<tr>
<td align="left">&#x2F;n(斜线)</td>
<td align="left">n 代表数字，间隔的单位的意思，如每五分钟进行一次，则：*&#x2F;5 * * * * 也可以写成 0-59&#x2F;</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# crontab -l		#查看root的计划任务</span><br><span class="line">0 16 1 * *	cp /etc/passwd /root</span><br><span class="line">root@zutuanxue ~]# crontab -u oracle -l	</span><br><span class="line">#查看指定用户的计划任务</span><br><span class="line">no crontab for oracle</span><br><span class="line">[root@zutuanxue ~]# crontab -r	#删除所有计划任务</span><br><span class="line">[root@zutuanxue ~]# crontab -l</span><br><span class="line">no crontab for root</span><br></pre></td></tr></table></figure>

<p>注意：crontab在使用的时候如果遇到路径，同样建议使用绝对路径，如果只是要删除某个项目，使用 crontab -e 来重新编辑，如果使用 -r 的参数，是会将所有的 crontab 内容都删掉。</p>
<h3 id="3-2、系统的配置文件：-x2F-etc-x2F-crontab-x2F-etc-x2F-cron-d-x2F"><a href="#3-2、系统的配置文件：-x2F-etc-x2F-crontab-x2F-etc-x2F-cron-d-x2F" class="headerlink" title="3.2、系统的配置文件： &#x2F;etc&#x2F;crontab, &#x2F;etc&#x2F;cron.d&#x2F;*"></a>3.2、系统的配置文件： &#x2F;etc&#x2F;crontab, &#x2F;etc&#x2F;cron.d&#x2F;*</h3><p>crontab -e是针对用户 来设计的，系统的计划任务是通过&#x2F;etc&#x2F;crontab文件来实现的，我们只要编辑&#x2F;etc&#x2F;crontab 这个文件就可以，由于cron的最低检测时间是分钟，所以编辑好这个文件，系统就会自动定期执行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/crontab</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"># For details see man 4 crontabs</span><br><span class="line"></span><br><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59)</span><br><span class="line"># |  .------------- hour (0 - 23)</span><br><span class="line"># |  |  .---------- day of month (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name  command to be executed</span><br></pre></td></tr></table></figure>

<p>与crontab -e的内容类似，但是多了几个部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash			shell类型</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin	执行文件搜索位置</span><br><span class="line">MAILTO=root		发生错误时通知邮件发送给谁</span><br><span class="line"></span><br><span class="line">*  *  *  *  * user-name  command to be executed</span><br><span class="line">#比crontab -e多了一个执行者的身份，因为并不是所有工作都需要root用户去执行</span><br></pre></td></tr></table></figure>

<p><strong>额外的文件</strong></p>
<p>crond有三个相关联的地方，他们分别是：</p>
<p>&#x2F;etc&#x2F;crontab 系统计划任务的配置文件</p>
<p>&#x2F;etc&#x2F;cron.d&#x2F; 此目录和下面的几个目录都是系统计划任务存放运行脚本的位置。</p>
<p>&#x2F;etc&#x2F;cron.hourly&#x2F;</p>
<p>&#x2F;etc&#x2F;cron.daily&#x2F;</p>
<p>&#x2F;etc&#x2F;cron.weekly&#x2F;</p>
<p>&#x2F;etc&#x2F;cron.monthly&#x2F;</p>
<p>&#x2F;var&#x2F;spool&#x2F;cron&#x2F;* 用户定制的计划任务存放位置</p>
<h2 id="四、anacron"><a href="#四、anacron" class="headerlink" title="四、anacron"></a>四、anacron</h2><p>有些时候，在cron需要执行相应工作的时候，你的系统关机了，该如何处理？这个时候就需要使用anacron</p>
<h3 id="4-1、什么是-anacron"><a href="#4-1、什么是-anacron" class="headerlink" title="4.1、什么是 anacron"></a>4.1、什么是 anacron</h3><p>anacron 并不是用来取代 crontab 的，anacron 存在的目的就在于处理由于一些原因导致cron无法完成的工作</p>
<p>其实 anacron 也是每个小时被 crond 执行一次，然后 anacron 再去检测相关的工作任务有没有被执行，如果有未完成的工作， 就执行该工作任务，执行完毕或无须执行任何工作时，anacron 就停止了。我们可以通过&#x2F;etc&#x2F;cron.d&#x2F;0hourly的内容查看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/cron.d/0hourly </span><br><span class="line"># Run the hourly jobs</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line">01 * * * * root run-parts /etc/cron.hourly</span><br></pre></td></tr></table></figure>

<p>由于 anacron 默认会以一天、七天、一个月为期去检测系统未进行的 crontab 任务，因此对于某些特殊的使用环境非常有帮助。</p>
<p>那么 anacron 又是怎么知道我们的系统何时关机？这就得要使用 anacron 读取的时间记录文件 (timestamps) 了！ anacron 会去分析现在的时间与时间记录文件所记载的上次执行 anacron 的时间，两者比较后若发现有差异， 那就是在某些时刻没有进行 crontab ！此时 anacron 就会开始执行未进行的 crontab 任务了！</p>
<h2 id="4-2、anacron-与-x2F-etc-x2F-anacrontab"><a href="#4-2、anacron-与-x2F-etc-x2F-anacrontab" class="headerlink" title="4.2、anacron 与 &#x2F;etc&#x2F;anacrontab"></a>4.2、anacron 与 &#x2F;etc&#x2F;anacrontab</h2><p>anacron 其实是一个程序并非一个服务！这个程序在系统当中已经加入 crontab 的工作！同时 anacron 会每个小时被主动执行一次！所以 anacron 的配置文件应该放置在 &#x2F;etc&#x2F;cron.hourly目录中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/cron.hourly/0anacron </span><br><span class="line">#!/bin/sh</span><br><span class="line"># Check whether 0anacron was run today already</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">/usr/sbin/anacron -s</span><br><span class="line">实际上，也仅仅是执行anacron -s命令，这个命令会根据/etc/anacrontab文件的定义去执行各项工作</span><br></pre></td></tr></table></figure>

<p><strong>anacrontab</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/anacrontab </span><br><span class="line"># /etc/anacrontab: configuration file for anacron</span><br><span class="line"></span><br><span class="line"># See anacron(8) and anacrontab(5) for details.</span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"># the maximal random delay added to the base delay of the jobs</span><br><span class="line">RANDOM_DELAY=45		#最大随机延迟时间，单位是分钟</span><br><span class="line"># the jobs will be started during the following hours only</span><br><span class="line">START_HOURS_RANGE=3-22	#仅执行延迟多少个小时之内的任务</span><br><span class="line"></span><br><span class="line">#period in days   delay in minutes   job-identifier   command</span><br><span class="line">1	5	cron.daily		nice run-parts /etc/cron.daily</span><br><span class="line">7	25	cron.weekly		nice run-parts /etc/cron.weekly</span><br><span class="line">@monthly 45	cron.monthly		nice run-parts /etc/cron.monthly</span><br><span class="line">间隔时间(天)	延迟时间(分钟)	工作名称	执行的内容</span><br></pre></td></tr></table></figure>

<p>以 &#x2F;etc&#x2F;cron.daily&#x2F; 那一行的为例</p>
<p>每隔一天，在开机后的第5分钟去执行cron.daily目录下的脚本</p>
<h1 id="shell-数据处理"><a href="#shell-数据处理" class="headerlink" title="shell 数据处理"></a>shell 数据处理</h1><p> 阅读 (33954) </p>
<p> 分享</p>
<h2 id="一、linux中的常用符号"><a href="#一、linux中的常用符号" class="headerlink" title="一、linux中的常用符号"></a>一、linux中的常用符号</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>代表任意字符串</td>
</tr>
<tr>
<td>？</td>
<td>代表任意字符</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>代表根目录或作为路径间隔符使用</td>
</tr>
<tr>
<td>\</td>
<td>转义字符。</td>
</tr>
<tr>
<td>&lt;ENTER&gt;</td>
<td>续行符。可以使用续行符将一个命令行分写在多行上</td>
</tr>
<tr>
<td>$</td>
<td>变量值置换，如：$PATH表示环境变量PATH的值</td>
</tr>
<tr>
<td>’</td>
<td>在’…’中间的字符都会被当做普通字符处理</td>
</tr>
<tr>
<td>‘’</td>
<td>在’’…’’中间的字符会被当做文字处理并允许变量值置换</td>
</tr>
<tr>
<td>&#96;</td>
<td>命令替换，置换`…&#96;中命令的执行结果</td>
</tr>
<tr>
<td>&lt;</td>
<td>输入重定向字符</td>
</tr>
<tr>
<td>&gt;</td>
<td>输出重定向字符</td>
</tr>
<tr>
<td>|</td>
<td>管道字符</td>
</tr>
<tr>
<td>&amp;</td>
<td>后台执行字符。在一个命令之后加上字符“&amp;”，该命令就会以后台方式执行</td>
</tr>
<tr>
<td>;</td>
<td>按照顺序执行的多个命令</td>
</tr>
<tr>
<td>()</td>
<td>在子Shell中执行命令</td>
</tr>
<tr>
<td>{}</td>
<td>在当前Shell中执行命令</td>
</tr>
<tr>
<td>!</td>
<td>执行命令历史记录中的命令</td>
</tr>
<tr>
<td>~</td>
<td>代表登录用户的宿主目录（自家目录）</td>
</tr>
</tbody></table>
<h2 id="二、历史记录"><a href="#二、历史记录" class="headerlink" title="二、历史记录"></a>二、历史记录</h2><p>linux系统在shell中保留了用户键入的每一个命令的历史记录，并且提供了很多种方法让用户通过历史记录找到曾经使用过的命令，并且调用这个历史记录的命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# history</span><br><span class="line">    1  ifconfig</span><br><span class="line">    2  nmcli connection modify ens33 ipv4.addresses 192.168.2.220/24 ipv4.gateway 192.168.2.1 ipv4.method manual autoconnect yes</span><br><span class="line">    3  route -n</span><br><span class="line">    4  nmcli connection down ens33</span><br><span class="line">   .</span><br><span class="line">   .</span><br><span class="line">   .</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>语法</th>
<th>替换</th>
</tr>
</thead>
<tbody><tr>
<td>！！</td>
<td>前一个命令</td>
</tr>
<tr>
<td>！n</td>
<td>命令号n</td>
</tr>
<tr>
<td>！-n</td>
<td>倒数第n个命令</td>
</tr>
<tr>
<td>！cmd</td>
<td>最后用来启动cmd的命令</td>
</tr>
</tbody></table>
<p><strong>与历史记录相关的文件和变量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# echo $HISTFILE</span><br><span class="line">/root/.bash_history</span><br><span class="line">#用户的历史记录保存的位置</span><br><span class="line">[root@zutuanxue ~]# echo $HISTFILESIZE</span><br><span class="line">1000</span><br><span class="line">#启动时，从历史记录中读取的记录条数</span><br><span class="line">[root@zutuanxue ~]# echo $HISTSIZE</span><br><span class="line">1000</span><br><span class="line">#退出时，被写入历史记录的最大条数</span><br></pre></td></tr></table></figure>

<p><strong>历史记录技巧</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esc+./alt+.	调用上一条命令的最后一部分内容</span><br><span class="line">ctrl+r	在历史记录中搜索给出关键字的命令</span><br></pre></td></tr></table></figure>

<h2 id="三、标准输入、标准输出、标准错误"><a href="#三、标准输入、标准输出、标准错误" class="headerlink" title="三、标准输入、标准输出、标准错误"></a>三、标准输入、标准输出、标准错误</h2><p>在linux系统中，大多数时候我们从键盘读取输入，在终端显示输出，而我们在键盘中输入的内容，多数都是执行命令，这些命令属于终端程序，除了终端程序还有图形程序和屏幕程序（如vim），不管是哪一种程序都会涉及到输入，输出，错误，多数情况下，我们在键盘输入信息，在显示器查看信息（正确的信息和错误的信息），这些输入的信息我们称之为标准输入（可以用0表示），输出的信息我们称之为标准输出（可以用1表示），而错误的信息（可以用2表示），我们称之为标准错误。在日常使用中我们除了可以使用键盘输入信息，从显示器读取信息之外，还可以指定程序从键盘以外的地方读取需要输入的内容，也可以让程序将信息输出到显示器以外的地方。</p>
<p><strong>重定向输入和输出</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#重定向输出</span><br><span class="line">[root@zutuanxue ~]# mkdir a</span><br><span class="line">[root@zutuanxue ~]# cd a</span><br><span class="line">[root@zutuanxue a]# mkdir aa ab ac</span><br><span class="line">[root@zutuanxue a]# cd aa</span><br><span class="line">[root@zutuanxue aa]# touch bb bc bd</span><br><span class="line">[root@zutuanxue ~]# ls a/ &gt; test	</span><br><span class="line">[root@zutuanxue ~]# cat test</span><br><span class="line">aa</span><br><span class="line">ab</span><br><span class="line">ac</span><br><span class="line">[root@zutuanxue ~]# ls a/aa/ &gt;&gt; test</span><br><span class="line">[root@zutuanxue ~]# cat test</span><br><span class="line">aa</span><br><span class="line">ab</span><br><span class="line">ac</span><br><span class="line">bb</span><br><span class="line">bc</span><br><span class="line">bd</span><br><span class="line"></span><br><span class="line">&gt;覆盖</span><br><span class="line">&gt;&gt;追加</span><br><span class="line">#重定向输入</span><br><span class="line">[root@zutuanxue ~]# wc -l test</span><br><span class="line">6 hello</span><br><span class="line">[root@zutuanxue ~]# wc -l &lt; test </span><br><span class="line">6</span><br><span class="line">注意：第一个例子，会输出文件名；第二个不会，因为它仅仅知道从标准输入读取内容。</span><br></pre></td></tr></table></figure>

<p>我们知道标准输入可以用0来表示，标准输出可以用1来表示，标准错误可以用2来表示，而有些时候这些输出的信息中即包含了正确的信息，也包含了错误的信息，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# ls /etc/rc.d/</span><br><span class="line">init.d  rc0.d  rc1.d  rc2.d  rc3.d  rc4.d  rc5.d  rc6.d  rc.local</span><br><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/*</span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/init.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc0.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc1.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc2.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc3.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc4.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc5.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc6.d&#x27; 时出错: 是一个目录</span><br><span class="line"></span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br></pre></td></tr></table></figure>

<p>我们通过ls命令查看&#x2F;etc&#x2F;rc.d这个目录的时候，我们发现，这个目录中即有目录，也有文件，而当我们使用“head -1”命令去查看文件的第一行内容的时候， 很显然目录是无法查看第一行的，这时就会有报错，当我想把这些信息都写入到一个指定的文件中而不想看到这些内容我该如何去做？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/* &gt; test</span><br><span class="line">head: 读取&#x27;/etc/rc.d/init.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc0.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc1.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc2.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc3.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc4.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc5.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc6.d&#x27; 时出错: 是一个目录</span><br><span class="line">[root@zutuanxue ~]# cat test</span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br></pre></td></tr></table></figure>

<p>我们可以利用之前的&gt;将输出的信息重定向到一个指定的文件，但是仍然会收到错误提示，这是为什么呢？因为在linux当中正确的输出和错误的输出实际上是两种数据流，默认情况下这两种数据流都会在显示器上打印出来，而我们使用的&gt;相当于1&gt;,也就是将正确的信息写入到了test文件中，错误的信息依旧会看到。利用前面的提到0，1，2这三个数字，我们可以这样做</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/* &gt; test 2&gt; test.err</span><br><span class="line">[root@zutuanxue ~]# cat test</span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br><span class="line">[root@zutuanxue ~]# cat test.err </span><br><span class="line">head: 读取&#x27;/etc/rc.d/init.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc0.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc1.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc2.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc3.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc4.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc5.d&#x27; 时出错: 是一个目录</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc6.d&#x27; 时出错: 是一个目录</span><br></pre></td></tr></table></figure>

<p>但是这依然是两个文件，能不能将这些信息都写入到一个文件中呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/* &gt; test.both 2&gt;&amp;1</span><br><span class="line">[root@zutuanxue ~]# cat test.both </span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/init.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc0.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc1.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc2.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc3.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc4.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc5.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc6.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/* &gt;&amp; test.both1</span><br><span class="line">[root@zutuanxue ~]# cat test.both1 </span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/init.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc0.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc1.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc2.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc3.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc4.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc5.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">head: 读取&#x27;/etc/rc.d/rc6.d&#x27; 时出错: 是一个目录</span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">这两种使用方式都是告诉shell将错误信息写入到正确信息所写入的文件中。</span><br><span class="line">如果这些错误信息是我们早就知道的，并且还不想看到的呢？</span><br><span class="line">[root@zutuanxue ~]# head -1 /etc/rc.d/* 2&gt; /dev/null </span><br><span class="line">==&gt; /etc/rc.d/init.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc0.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc1.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc2.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc3.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc4.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc5.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc6.d &lt;==</span><br><span class="line">==&gt; /etc/rc.d/rc.local &lt;==</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">/dev/null:表示的是一个黑洞，通常用于丢弃不需要的数据输出</span><br></pre></td></tr></table></figure>

<p>综上所述针对于输入输出重定向与合并的用法有</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>cmd &lt; file</td>
<td>从file重定向标准输入</td>
</tr>
<tr>
<td>cmd &gt; file</td>
<td>把标准输出重定向到file中，如果file存在的话，覆盖（损坏）它</td>
</tr>
<tr>
<td>cmd&gt;&gt;file</td>
<td>把标准输出重定向到file中，如果file存在，附加给它</td>
</tr>
<tr>
<td>cmd 2&gt;file</td>
<td>把标准错误重定向到file，如果file 存在，覆盖（损坏）它</td>
</tr>
<tr>
<td>cmd 2&gt;&gt; file</td>
<td>把标准错误重定向到file中，如果file 存在，附加给他</td>
</tr>
<tr>
<td>cmd&gt;file 2&gt;&amp;1</td>
<td>合并标准输出和标准错误，并且重定向到file中（可移植的语法）</td>
</tr>
<tr>
<td>cmd &gt;&amp; file</td>
<td>合并标准输出和标准错误，并且重定向到file中（方便的语法）</td>
</tr>
</tbody></table>
<h2 id="四、管道"><a href="#四、管道" class="headerlink" title="四、管道"></a>四、管道</h2><p>在前面，我们已经看到，进程的输出可以被重定向到终端显示器以外的地方，或者可以让进程从终端键盘以外的地方读取输入。一种最常用，最有力的重定向形式是把这二者结合起来，在这种形式下，一个命令的输出（标准输出）被直接“用管道输送”到另一个命令的输入（标准输入）中，从而构成了 Linux（和Unix）所谓的管道（pipe）。当两个命令用管道连接起来时，第一个进程的标准输出流被直接连接到第二个进程的标准输入序列。为了用bash创建管道，用一个垂直的小节线 | 把这两个命令连接起来。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603601398337.png" alt="image20200323144226709.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# pwd</span><br><span class="line">/root</span><br><span class="line">[root@zutuanxue ~]# ls | grep ana</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">注意：从管道读数据是一次性操作，数据一旦被读，它就从管道中被抛弃，释放空间以便写更多的数据。它只能处理经由前面一个指令传出的正确输出信息，对错误信息信息没有直接处理能力。然后，传递给下一个命令，作为标准的输入。</span><br></pre></td></tr></table></figure>

<h2 id="五、数据处理常用工具"><a href="#五、数据处理常用工具" class="headerlink" title="五、数据处理常用工具"></a>五、数据处理常用工具</h2><h3 id="5-1、find文件查找命令"><a href="#5-1、find文件查找命令" class="headerlink" title="5.1、find文件查找命令"></a>5.1、find文件查找命令</h3><p>. 代表当前目录</p>
<p>~ 代表用户家目录</p>
<p><strong>find命令选项</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">-name	按照文件名查找文件。</span><br><span class="line">[root@zutuanxue ~]# find ~ -name &quot;test.*&quot;</span><br><span class="line">/root/test.err</span><br><span class="line">/root/test.both</span><br><span class="line">/root/test.both1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-perm	按照文件权限来查找文件。</span><br><span class="line">[root@zutuanxue ~]# chmod 777 hello</span><br><span class="line">[root@zutuanxue ~]# find . -perm 777</span><br><span class="line">./hello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-user	按照文件属主来查找文件。</span><br><span class="line">-group	按照文件所属的组来查找文件。</span><br><span class="line">-uid	查找指定uid</span><br><span class="line">-gid	查找指定gid</span><br><span class="line">[root@zutuanxue ~]# chown hello.hello test</span><br><span class="line">[root@zutuanxue ~]# find . -user hello</span><br><span class="line">./test</span><br><span class="line">[root@zutuanxue ~]# find . -group hello</span><br><span class="line">./test</span><br><span class="line">[root@zutuanxue ~]# chown root.hello hello</span><br><span class="line">[root@zutuanxue ~]# find . -user root -group hello</span><br><span class="line">./hello</span><br><span class="line">[root@zutuanxue ~]# find . -uid 1000</span><br><span class="line">./test</span><br><span class="line">[root@zutuanxue ~]# find . -gid 1000</span><br><span class="line">./test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-mtime -n +n	按照文件的更改时间来查找文件， -n表示n天以内，+n表示n天以前。还有-atime和-ctime 选项</span><br><span class="line">-amin/-cmin/-mmin n		 查找系统中最后N分钟</span><br><span class="line"></span><br><span class="line">　　</span><br><span class="line">#如果-mtime +2 表示当前时间-2day以前的mtime的文件。即文件的mtime小于 sysdate -2</span><br><span class="line">#如果-mtime -2 表示当前时间-2day以后的mtime的文件。即文件的mtime大于 sysdate -2</span><br><span class="line">#如果-mtime  2 表示文件mtime在sysdate -2 与 sysdate-1 之间的文件。</span><br><span class="line">#！！！！！实际上再记不住，记住一般删除旧数据，一定是选择+。</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# find /etc -mtime -2 </span><br><span class="line">/etc</span><br><span class="line">/etc/cups</span><br><span class="line">/etc/cups/subscriptions.conf</span><br><span class="line">/etc/resolv.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-nogroup	查找无有效所属组的文件，即该文件所属的组在/etc/groups中不存在。</span><br><span class="line">-nouser	查找无有效属主的文件，即该文件的属主在/etc/passwd中不存在。</span><br><span class="line">[root@zutuanxue ~]# chown 1400.1400 hello</span><br><span class="line">[root@zutuanxue ~]# ll hello</span><br><span class="line">-rwxrwxrwx 1 1400 1400 8 3月  22 23:25 hello</span><br><span class="line">[root@zutuanxue ~]# find . -nogroup</span><br><span class="line">./hello</span><br><span class="line">[root@zutuanxue ~]# find . -nouser</span><br><span class="line">./hello</span><br><span class="line"></span><br><span class="line">-newer file1 查找更改时间比文件file1新的文件。</span><br><span class="line">[root@zutuanxue ~]# find /etc -newer initial-setup-ks.cfg </span><br><span class="line">/etc</span><br><span class="line">/etc/dnf/modules.d</span><br><span class="line">/etc/dnf/modules.d/httpd.module</span><br><span class="line">/etc/logrotate.d</span><br><span class="line">还有anewer和cnewer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-type	查找某一类型的文件，诸如：</span><br><span class="line">b - 块设备文件。</span><br><span class="line">d - 目录。</span><br><span class="line">c - 字符设备文件。</span><br><span class="line">p - 管道文件。</span><br><span class="line">l - 符号链接文件。</span><br><span class="line">f - 普通文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# find /etc -newer initial-setup-ks.cfg -type f</span><br><span class="line">/etc/dnf/modules.d/httpd.module</span><br><span class="line">/etc/logrotate.d/glusterfs</span><br><span class="line">/etc/pki/nssdb/cert9.db</span><br><span class="line">/etc/pki/nssdb/key4.db</span><br><span class="line">/etc/yum.repos.d/server.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-size n[bcwkMG] 查找文件长度为n块的文件，带有c时表示文件长度以字节计。</span><br><span class="line">			b	512字节一块</span><br><span class="line">			c	字节</span><br><span class="line">			w	字（2字节）</span><br><span class="line">			k	k字节（1024）</span><br><span class="line">			M	M字节（1024x1024字节）</span><br><span class="line">			G	G字节（1024x1024x1024字节）</span><br><span class="line">[root@zutuanxue ~]# find . -size +1M</span><br><span class="line">./.cache/tracker/meta.db</span><br><span class="line">./.cache/tracker/meta.db-wal</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/startupCache/startupCache.8.little</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/startupCache/scriptCache-child-current.bin</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/startupCache/scriptCache-current.bin</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/places.sqlite</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/favicons.sqlite</span><br><span class="line"># 在使用的时候注意一下单位，如find . -size 4k使用4k时会显示所有大与3k小于等于4k的文件，如果使用的是4096c则是查找大小为4k的文件</span><br><span class="line">[root@zutuanxue ~]# find . -size 4k</span><br><span class="line">.</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/startupCache/urlCache-current.bin</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/startupCache/urlCache.bin</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/safebrowsing</span><br><span class="line">./.config/pulse</span><br><span class="line">./.mozilla/firefox/mduza4q4.default</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/datareporting/archived/2020-02</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/saved-telemetry-pings</span><br><span class="line">[root@zutuanxue ~]# find . -size 4096c</span><br><span class="line">.</span><br><span class="line">./.cache/mozilla/firefox/mduza4q4.default/safebrowsing</span><br><span class="line">./.config/pulse</span><br><span class="line">./.mozilla/firefox/mduza4q4.default</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/datareporting/archived/2020-02</span><br><span class="line">./.mozilla/firefox/mduza4q4.default/saved-telemetry-pings</span><br><span class="line">[root@zutuanxue ~]# find . -size 4k |wc -l</span><br><span class="line">8</span><br><span class="line">[root@zutuanxue ~]# find . -size 4096c |wc -l</span><br><span class="line">6</span><br><span class="line">[root@zutuanxue ~]# ll -h .cache/mozilla/firefox/mduza4q4.default/startupCache/urlCache-current.bin </span><br><span class="line">-rw-r--r-- 1 root root 3.1K 2月  24 02:34 .cache/mozilla/firefox/mduza4q4.default/startupCache/urlCache-current.bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-follow：如果find命令遇到符号链接文件，就跟踪至链接所指向的文件。</span><br><span class="line">[root@zutuanxue ~]# ln -s /etc/ linketc</span><br><span class="line">[root@zutuanxue ~]# find . -name passwd</span><br><span class="line">[root@zutuanxue ~]# find . -name passwd -follow</span><br><span class="line">./linketc/pam.d/passwd</span><br><span class="line">./linketc/passwd</span><br><span class="line"></span><br><span class="line">-exec   command   &#123;&#125; \;      —–将查到的文件执行command操作,&#123;&#125; 和 \;之间有空格</span><br><span class="line">-ok 和-exec相同，只不过在操作前要询用户</span><br><span class="line">[root@zutuanxue ~]# find /etc -name passwd -exec grep &quot;hello&quot; &#123;&#125; \;</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">[root@zutuanxue ~]# find /etc -name passwd -ok grep &quot;hello&quot; &#123;&#125; \;</span><br><span class="line">&lt; grep ... /etc/pam.d/passwd &gt; ? y</span><br><span class="line">&lt; grep ... /etc/passwd &gt; ? y</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-empty	查找空文件或目录</span><br><span class="line">[root@zutuanxue ~]# find /etc -empty</span><br><span class="line">/etc/crypttab</span><br><span class="line">/etc/dnf/aliases.d</span><br><span class="line">/etc/dnf/modules.defaults.d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-inum	查找i节点编号为指定数值的文件</span><br><span class="line">-samefile	查找相同的文件</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# ln hello hello1</span><br><span class="line">[root@zutuanxue ~]# ln hello hello2</span><br><span class="line">[root@zutuanxue ~]# ll -i hello</span><br><span class="line">34510098 -rwxrwxrwx 3 1400 1400 8 3月  22 23:25 hello</span><br><span class="line">[root@zutuanxue ~]# find . -inum 34510098</span><br><span class="line">./hello</span><br><span class="line">./hello1</span><br><span class="line">./hello2</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# find . -samefile hello</span><br><span class="line">./hello</span><br><span class="line">./hello1</span><br><span class="line">./hello2</span><br></pre></td></tr></table></figure>

<h3 id="5-2、grep-amp-egrep-数据检索命令"><a href="#5-2、grep-amp-egrep-数据检索命令" class="headerlink" title="5.2、grep&amp;egrep 数据检索命令"></a>5.2、grep&amp;egrep 数据检索命令</h3><p>一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来，最常用。egrep是grep的扩展，支持更多的正则表达式元字符,等同于grep -E。</p>
<p>useradd HELLO</p>
<p>useradd helo</p>
<p>useradd helllo</p>
<p><strong>grep 与 正则表达式符号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">^ 行的开始 如：&#x27;^grep&#x27;匹配所有以grep开头的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;^he&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">$	行的结束 如：&#x27;grep$&#x27;匹配所有以grep结尾的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;sh$&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">.	匹配一个非换行符(&#x27;\n&#x27;)的字符如：&#x27;gr.p&#x27;匹配gr后接一个任意字符，然后是p。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;t.e&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">* 匹配零个或多个先前字符 如：&#x27; *grep&#x27; (注意*前有空格)匹配所有零个或多个空格后紧跟grep的行，需要用egrep 或者grep带上 -E 选项。 .*一起用代表任意字符。</span><br><span class="line">[root@zutuanxue ~]# grep -E &#x27;el*lo&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">[]	匹配一个指定范围内的字符，如&#x27;[Gg]rep&#x27;匹配Grep和grep。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;[Hh]el&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">[^] 匹配一个不在指定范围内的字符，如：&#x27;[^A-FH-Z]rep&#x27;匹配不包含A-F和H-Z的一个字母开头，紧跟rep的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;[^A-Z]ello&#x27; /etc/passwd</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;[^a-z]ello&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">\?	匹配零个或一个先前的字符。如：&#x27;gre\?p&#x27;匹配gr后跟一个或零个e字符，然后是p的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;hell\?o&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line"></span><br><span class="line">x\&#123;m\&#125; 重复字符x，m次，如：&#x27;o\&#123;5\&#125;&#x27;匹配包含5个o的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;l\&#123;2\&#125;&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">x\&#123;m,\&#125; 重复字符x,至少m次，如：&#x27;o\&#123;5,\&#125;&#x27;匹配至少有5个o的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;l\&#123;2,\&#125;&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">x\&#123;m,n\&#125; 重复字符x，至少m次，不多于n次，如：&#x27;o\&#123;5,10\&#125;&#x27;匹配5--10个o的行。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;l\&#123;1,3\&#125;&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">\b 单词锁定符，如: &#x27;\bgrep\b&#x27;只匹配grep。</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;hell&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helllo:x:1003:1003::/home/helllo:/bin/bash</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;\bhell\b&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">egrep和 grep -E的扩展集</span><br><span class="line">+	匹配一个或多个先前的字符。如：&#x27;[a-z]+able&#x27;，匹配一个或多个小写字母后跟able的串.</span><br><span class="line">[root@zutuanxue ~]# grep -E &#x27;[a-z]+llo&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helllo:x:1003:1003::/home/helllo:/bin/bash</span><br><span class="line">[root@zutuanxue ~]# grep -E &#x27;[a-z]+lo&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line">?	作用同\?,如：&#x27;gre?p&#x27;匹配gr后跟一个或零个e字符，然后是p的行。</span><br><span class="line">[root@zutuanxue ~]# grep -E &#x27;hel?lo&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;hel?lo&#x27; /etc/passwd</span><br><span class="line">[root@zutuanxue ~]# grep &#x27;hel\?lo&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line"></span><br><span class="line">a|b|c 匹配a或b或c。如：grep|sed匹配grep或sed</span><br><span class="line">[root@zutuanxue ~]# grep -E &#x27;llo|lllo&#x27; /etc/passwd</span><br><span class="line">hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">helllo:x:1003:1003::/home/helllo:/bin/bash</span><br><span class="line"></span><br><span class="line">*	0次或多次</span><br><span class="line">?	0次或1次</span><br><span class="line">+	1次或多次</span><br><span class="line"></span><br><span class="line">-E		支持扩展正则，相当于egrep</span><br><span class="line">-i		不区分大小写</span><br><span class="line">-v		取反，显示不匹配的</span><br><span class="line">--color=auto	高亮显示</span><br></pre></td></tr></table></figure>

<h3 id="5-3、sort-对文件内容进行排序"><a href="#5-3、sort-对文件内容进行排序" class="headerlink" title="5.3、sort 对文件内容进行排序"></a>5.3、sort 对文件内容进行排序</h3><p><strong>常用命令选项</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">-b 忽略每行前面开始出的空格字符。</span><br><span class="line">[root@zutuanxue ~]# sort passwd</span><br><span class="line">apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line"> hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">    HELLO:x:1001:1001::/home/HELLO:/bin/bash</span><br><span class="line">      helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">[root@zutuanxue ~]# sort -b passwd</span><br><span class="line">apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line"> hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">    HELLO:x:1001:1001::/home/HELLO:/bin/bash</span><br><span class="line">      helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">-c 检查文件是否已经按照顺序排序。</span><br><span class="line">[root@zutuanxue ~]# sort -c passwd </span><br><span class="line">sort：passwd:2：无序： bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line"></span><br><span class="line">-t	用指定的符号做为分隔符</span><br><span class="line">-k	指定区间</span><br><span class="line">-n 	依照数值的大小排序。</span><br><span class="line">-r 以相反的顺序来排序。</span><br><span class="line">[root@zutuanxue ~]# sort -t &#x27;:&#x27; -k 3 -r -n  passwd </span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">      helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">    HELLO:x:1001:1001::/home/HELLO:/bin/bash</span><br><span class="line"> hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line">   apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">或者</span><br><span class="line">[root@zutuanxue ~]# sort -t &#x27;:&#x27; -k 3rn passwd </span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">      helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">    HELLO:x:1001:1001::/home/HELLO:/bin/bash</span><br><span class="line"> hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line">   apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-o&lt;输出文件&gt; 将排序后的结果存入指定的文件。</span><br><span class="line">[root@zutuanxue ~]# sort -t &#x27;:&#x27; -k 3 -r -n  passwd -o /root/passwd-sort</span><br><span class="line">[root@zutuanxue ~]# cat /root/passwd-sort </span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin</span><br><span class="line">      helo:x:1002:1002::/home/helo:/bin/bash</span><br><span class="line">    HELLO:x:1001:1001::/home/HELLO:/bin/bash</span><br><span class="line"> hello:x:1000:1000:hello:/home/hello:/bin/bash</span><br><span class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</span><br><span class="line">   apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="5-4、uniq-数据去重"><a href="#5-4、uniq-数据去重" class="headerlink" title="5.4、uniq 数据去重"></a>5.4、uniq 数据去重</h3><p>一般配合sort使用</p>
<p><strong>案例文档</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat testuniq</span><br><span class="line">192.168.98.2</span><br><span class="line">192.168.98.8</span><br><span class="line">192.168.98.3</span><br><span class="line">192.168.98.3</span><br><span class="line">192.168.98.9</span><br><span class="line">192.168.98.8</span><br><span class="line">192.168.98.8</span><br><span class="line">192.168.98.0</span><br><span class="line">192.168.98.3</span><br></pre></td></tr></table></figure>

<p><strong>常用命令选项</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-c	在每列旁边显示该行重复出现的次数。</span><br><span class="line">[root@zutuanxue ~]# uniq -c testuniq </span><br><span class="line">      1 192.168.98.2</span><br><span class="line">      1 192.168.98.8</span><br><span class="line">      2 192.168.98.3</span><br><span class="line">      1 192.168.98.9</span><br><span class="line">      2 192.168.98.8</span><br><span class="line">      1 192.168.98.0</span><br><span class="line">      1 192.168.98.3</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# uniq -c testuniq | sort</span><br><span class="line">      1 192.168.98.0</span><br><span class="line">      1 192.168.98.2</span><br><span class="line">      1 192.168.98.3</span><br><span class="line">      1 192.168.98.8</span><br><span class="line">      1 192.168.98.9</span><br><span class="line">      2 192.168.98.3</span><br><span class="line">      2 192.168.98.8</span><br><span class="line"></span><br><span class="line">-d	仅显示重复出现的行列。</span><br><span class="line">[root@zutuanxue ~]# uniq -d testuniq </span><br><span class="line">192.168.98.3</span><br><span class="line">192.168.98.8</span><br><span class="line"></span><br><span class="line">-u	仅显示出一次的行列。</span><br><span class="line">[root@zutuanxue ~]# uniq -u testuniq </span><br><span class="line">192.168.98.2</span><br><span class="line">192.168.98.8</span><br><span class="line">192.168.98.9</span><br><span class="line">192.168.98.0</span><br><span class="line">192.168.98.3</span><br><span class="line">[root@zutuanxue ~]# uniq -u testuniq | sort</span><br><span class="line">192.168.98.0</span><br><span class="line">192.168.98.2</span><br><span class="line">192.168.98.3</span><br><span class="line">192.168.98.8</span><br><span class="line">192.168.98.9</span><br></pre></td></tr></table></figure>

<h3 id="5-5、tree-以树状结构列出目录内容"><a href="#5-5、tree-以树状结构列出目录内容" class="headerlink" title="5.5、tree 以树状结构列出目录内容"></a>5.5、tree 以树状结构列出目录内容</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">-a 显示所有文件和目录,默认不显示隐藏文件</span><br><span class="line">[root@zutuanxue ~]# tree -a</span><br><span class="line"></span><br><span class="line">-C 在文件和目录清单加上色彩，便于区分各种类型。</span><br><span class="line">[root@zutuanxue ~]# tree -C</span><br><span class="line"></span><br><span class="line">-d 只显示目录。</span><br><span class="line">[root@zutuanxue ~]# tree -d</span><br><span class="line"></span><br><span class="line">-D 列出文件或目录的更改时间。</span><br><span class="line">[root@zutuanxue ~]# tree -D</span><br><span class="line">.</span><br><span class="line">├── [Feb  4 15:07]  公共</span><br><span class="line">├── [Feb  4 15:07]  模板</span><br><span class="line"></span><br><span class="line">-f 在每个文件或目录之前，显示完整的路径名称。</span><br><span class="line">[root@zutuanxue ~]# tree -f</span><br><span class="line">.</span><br><span class="line">├── ./公共</span><br><span class="line">├── ./模板</span><br><span class="line"></span><br><span class="line">-F 加上文件类型标记，在执行文件，目录，Socket，管道名称名称，各自加上&quot;*&quot;,&quot;/&quot;,&quot;@&quot;,&quot;|&quot;号。</span><br><span class="line">[root@zutuanxue ~]# tree -F</span><br><span class="line">.</span><br><span class="line">├── 公共/</span><br><span class="line">├── 模板/</span><br><span class="line"></span><br><span class="line">-g -u 列出文件或目录的所属群组、主名称，没有对应的名称时，则显示群组、主的识别码。</span><br><span class="line">[root@zutuanxue ~]# tree -g</span><br><span class="line">.</span><br><span class="line">├── [root    ]  公共</span><br><span class="line">├── [root    ]  模板</span><br><span class="line"></span><br><span class="line">-i 不以阶梯状列出文件或目录名称。</span><br><span class="line">[root@zutuanxue ~]# tree -i</span><br><span class="line">.</span><br><span class="line">公共</span><br><span class="line">模板</span><br><span class="line">视频</span><br><span class="line"></span><br><span class="line">-n 不在文件和目录清单加上色彩。</span><br><span class="line">[root@zutuanxue ~]# tree -n</span><br><span class="line">.</span><br><span class="line">├── 公共</span><br><span class="line">├── 模板</span><br><span class="line"></span><br><span class="line">-p 列出权限标示。</span><br><span class="line">[root@zutuanxue ~]# tree -p</span><br><span class="line">.</span><br><span class="line">├── [drwxr-xr-x]  公共</span><br><span class="line">├── [drwxr-xr-x]  模板</span><br><span class="line"></span><br><span class="line">-s 列出文件或目录大小。</span><br><span class="line">[root@zutuanxue ~]# tree -s</span><br><span class="line">.</span><br><span class="line">├── [          6]  公共</span><br><span class="line">├── [          6]  模板</span><br><span class="line"></span><br><span class="line">-t 用文件和目录的更改时间排序。</span><br><span class="line">[root@zutuanxue ~]# tree -t</span><br><span class="line">.</span><br><span class="line">├── anaconda-ks.cfg</span><br><span class="line">├── initial-setup-ks.cfg</span><br><span class="line">├── 公共</span><br><span class="line"></span><br><span class="line">-u 列出文件或目录的拥有者名称，没有对应的名称时，则显示用户识别码。</span><br><span class="line">[root@zutuanxue ~]# tree -u</span><br><span class="line">.</span><br><span class="line">├── [root    ]  公共</span><br><span class="line">├── [root    ]  模板</span><br><span class="line"></span><br><span class="line">-L 显示目录层数，数值为正整数</span><br><span class="line">[root@zutuanxue ~]# tree -a -L 2</span><br><span class="line">.</span><br><span class="line">├── .cache</span><br><span class="line">│   ├── dconf</span><br><span class="line">│   ├── event-sound-cache.tdb.d5b6fe70a77f4945aa0999abdd33e686.x86_64-redhat-linux-gnu</span><br><span class="line">│   ├── evolution</span><br><span class="line">│   ├── gnome-shell</span><br><span class="line">│   ├── gnome-software</span><br></pre></td></tr></table></figure>

<h3 id="5-6、xargs命令"><a href="#5-6、xargs命令" class="headerlink" title="5.6、xargs命令"></a>5.6、xargs命令</h3><p>xargs 是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。用于一些不支持管道输入的命令如ls</p>
<p><strong>案例文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat xargtest </span><br><span class="line">a a a</span><br><span class="line">b b b</span><br><span class="line">c c c</span><br><span class="line">d d d</span><br><span class="line">e</span><br><span class="line">f</span><br><span class="line">g</span><br><span class="line">h</span><br><span class="line">i</span><br><span class="line">j</span><br><span class="line">k</span><br><span class="line">l</span><br></pre></td></tr></table></figure>

<p><strong>常用命令选项</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-n num 后面加列数</span><br><span class="line">[root@zutuanxue ~]# cat xargtest | xargs -n 2</span><br><span class="line">a a</span><br><span class="line">a b</span><br><span class="line">b b</span><br><span class="line">c c</span><br><span class="line">c d</span><br><span class="line">d d</span><br><span class="line">e f</span><br><span class="line">g h</span><br><span class="line">i j</span><br><span class="line">k l</span><br><span class="line">[root@zutuanxue ~]# cat xargtest | xargs</span><br><span class="line">a a a b b b c c c d d d e f g h i j k l</span><br><span class="line"></span><br><span class="line">-I	指定替换的字符串，并在后续的命令中用指定的字符串表示接收到的输入内容，并执行，可以用任意字符代替（不推荐有特殊含义的字符，如*等，如果使用请记得转意），一般为[]或&#123;&#125;</span><br><span class="line">[root@zutuanxue ~]# mkdir testx</span><br><span class="line">[root@zutuanxue ~]# find /var/ -name &quot;*.log&quot; | xargs  -I a cp a ./testx</span><br><span class="line">[root@zutuanxue ~]# ls testx | wc -l</span><br><span class="line">39</span><br><span class="line"></span><br><span class="line">-i	类似-I，相当于固定就是使用&#123;&#125;来表示接收到的输入内容</span><br><span class="line">[root@zutuanxue ~]# find /var/ -name &quot;*.log&quot; | xargs  -i cp &#123;&#125; ./testx</span><br><span class="line">[root@zutuanxue ~]# ls testx | wc -l</span><br><span class="line">39</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-d 指定分隔符</span><br><span class="line">[root@zutuanxue ~]# echo &quot;a9b9c9d9&quot; | xargs -d 9</span><br><span class="line">a b c d </span><br></pre></td></tr></table></figure>

<h1 id="Linux系统监控工具-glances"><a href="#Linux系统监控工具-glances" class="headerlink" title="Linux系统监控工具-glances"></a>Linux系统监控工具-glances</h1><p> 阅读 (480526) </p>
<p> 分享</p>
<h2 id="一、glances介绍"><a href="#一、glances介绍" class="headerlink" title="一、glances介绍"></a>一、glances介绍</h2><p>glances是一个基于python语言开发，可以为linux或者UNIX性能提供监视和分析性能数据的功能。glances在用户的终端上显示重要的系统信息，并动态的进行更新，让管理员实时掌握系统资源的使用情况，而动态监控并不会消耗大量的系统资源，比如CPU资源，通常消耗小于2%，glances默认每两秒更新一次数据。同时glances还可以将相同的数据捕获到一个文件，便于以后对报告进行分析和图形绘制，支持的文件格式有.csv电子表格格式和和html格式。</p>
<p>glances可以分析系统的：</p>
<ul>
<li>CPU使用率</li>
<li>内存使用率</li>
<li>内核统计信息和运行队列信息</li>
<li>磁盘I&#x2F;O速度、传输和读&#x2F;写比率</li>
<li>磁盘适配器</li>
<li>网络I&#x2F;O速度、传输和读&#x2F;写比率</li>
<li>页面监控</li>
<li>进程监控-消耗资源最多的进程</li>
<li>计算机信息和系统资源</li>
</ul>
<h2 id="二、glances安装方式"><a href="#二、glances安装方式" class="headerlink" title="二、glances安装方式"></a>二、glances安装方式</h2><ol>
<li>源码安装</li>
<li>基于pip命令安装</li>
<li>基于epel公网yum源</li>
</ol>
<p>由于源码安装需要解决大量的依赖包的问题，对于小白同学学习压力较大，所以本文将重点介绍基于yum的安装方法，让大家快速安装，并能及时体验到glances监控的强大和高效。</p>
<h2 id="三、基于epel公网源安装glances"><a href="#三、基于epel公网源安装glances" class="headerlink" title="三、基于epel公网源安装glances"></a>三、基于epel公网源安装glances</h2><p>由于glances运行需要python环境，所以我们需要首先安装好python环境，这里我给大家使用的是一个脚本安装python3.7.3，目前的最新版本。</p>
<h4 id="3-1、python3-7-3安装脚本"><a href="#3-1、python3-7-3安装脚本" class="headerlink" title="3.1、python3.7.3安装脚本"></a>3.1、python3.7.3安装脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># </span><br><span class="line">#Name: </span><br><span class="line">#Author: zutuanxue_com</span><br><span class="line">#Created Time: 2019/10/1 11:20</span><br><span class="line">#Release: </span><br><span class="line">#Description:python 3.7.3安装脚本</span><br><span class="line"></span><br><span class="line">#变量</span><br><span class="line">source_url=&quot;https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz&quot;</span><br><span class="line">source_pkg=&quot;Python-3.7.3.tgz&quot;</span><br><span class="line">source_doc=&quot;Python-3.7.3&quot;</span><br><span class="line"></span><br><span class="line">cpu_count=`egrep &quot;flags&quot; /proc/cpuinfo |wc -l`</span><br><span class="line"></span><br><span class="line">#程序</span><br><span class="line">check () &#123;</span><br><span class="line">  [ &quot;$USER&quot; != &quot;root&quot; ]&amp;&amp;echo &quot;need be root so that&quot;&amp;&amp;exit 1</span><br><span class="line">  [ ! -x /usr/bin/wget ]&amp;&amp;echo &quot;not found command: wget&quot;&amp;&amp;exit 1 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install_python () &#123;</span><br><span class="line"></span><br><span class="line">check</span><br><span class="line"></span><br><span class="line">#1、download python source package</span><br><span class="line">if ! (wget $source_url &amp;&gt;/dev/null) ;then</span><br><span class="line">   echo &quot;$source_pkg download fail&quot;</span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br><span class="line">#2、Decompression source package</span><br><span class="line">if [ -f $source_pkg ];then</span><br><span class="line">    tar xf $source_pkg</span><br><span class="line">else</span><br><span class="line">    echo &quot;not found package: $source_pkg&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#3、python install pre</span><br><span class="line">if ! (yum -y install gcc-* openssl-* libffi-devel  curses-devel lm_sensors sqlite-devel &amp;&gt;/dev/null);then</span><br><span class="line">    echo &quot;yum install software package fail&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4、configure python install env</span><br><span class="line">if [ -d $source_doc ];then</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">   #5、python configure</span><br><span class="line">   cd $source_doc</span><br><span class="line">   </span><br><span class="line">   sed -i.bak &#x27;212s/#//&#x27; Modules/Setup.dist</span><br><span class="line">   sed -i &#x27;213s/#//&#x27; Modules/Setup.dist</span><br><span class="line">   sed -i &#x27;214s/#//&#x27; Modules/Setup.dist</span><br><span class="line">   </span><br><span class="line">   echo &quot;python configure...please waiting&quot;</span><br><span class="line">   if ./configure --enable-optimizations --with-openssl=/usr/bin/openssl &amp;&gt;/dev/null ;then</span><br><span class="line"> </span><br><span class="line">           #6、python make </span><br><span class="line">           echo &quot;python make...please waiting&quot;</span><br><span class="line">           if make -j $cpu_count &amp;&gt;/dev/null ;then</span><br><span class="line">          </span><br><span class="line">                #7、python install</span><br><span class="line">                echo &quot;python install...please waiting&quot;</span><br><span class="line">                if make install &amp; &gt; /dev/null;then</span><br><span class="line">                    echo &quot;$source_doc install success&quot;</span><br><span class="line">                else</span><br><span class="line">                    echo &quot;python make install fail&quot;</span><br><span class="line">                    exit 1</span><br><span class="line">                fi</span><br><span class="line">            else</span><br><span class="line">                echo &quot;python make fail&quot;</span><br><span class="line">                exit 1</span><br><span class="line">            fi</span><br><span class="line">    else</span><br><span class="line">         echo &quot;python configure fail&quot;</span><br><span class="line">         exit 1</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">   echo &quot;not found $source_doc&quot;</span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_install</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">#Post-installation settings</span><br><span class="line">post_install () &#123;</span><br><span class="line">#update pip tool</span><br><span class="line">pip3 install --upgrade pip</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#函数调用</span><br><span class="line"></span><br><span class="line">install_python &amp;&amp; rm -rf $source_doc</span><br></pre></td></tr></table></figure>

<h4 id="3-2、glances-安装"><a href="#3-2、glances-安装" class="headerlink" title="3.2、glances 安装"></a>3.2、glances 安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@manager01 ~]# pip install glances</span><br><span class="line">Collecting glances</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/32/34/72f9202ad5b7ada314507a50b9ab1fb604d2f468b138679e0a4fedeb91fa/Glances-3.1.0.tar.gz (6.7MB)</span><br><span class="line">     |████████████████████████████████| 6.7MB 659kB/s </span><br><span class="line">Collecting psutil&gt;=5.3.0 (from glances)</span><br><span class="line">  Downloading https://files.pythonhosted.org/packages/1c/ca/5b8c1fe032a458c2c4bcbe509d1401dca9dda35c7fc46b36bb81c2834740/psutil-5.6.3.tar.gz (435kB)</span><br><span class="line">     |████████████████████████████████| 440kB 575kB/s </span><br><span class="line">Installing collected packages: psutil, glances</span><br><span class="line">  Running setup.py install for psutil ... done</span><br><span class="line">  Running setup.py install for glances ... done</span><br><span class="line">Successfully installed glances-3.1.0 psutil-5.6.3</span><br></pre></td></tr></table></figure>

<h4 id="3-3、温度监控工具安装"><a href="#3-3、温度监控工具安装" class="headerlink" title="3.3、温度监控工具安装"></a>3.3、温度监控工具安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manager01 ~]# yum -y install lm_sensors</span><br></pre></td></tr></table></figure>

<h4 id="3-4、epel公网源安装"><a href="#3-4、epel公网源安装" class="headerlink" title="3.4、epel公网源安装"></a>3.4、epel公网源安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@manager01 ~]# yum install epel* -y</span><br><span class="line">[root@manager01 ~]# yum -y install glances</span><br></pre></td></tr></table></figure>

<h2 id="四、glances监控"><a href="#四、glances监控" class="headerlink" title="四、glances监控"></a>四、glances监控</h2><h4 id="4-1、开启glances监控"><a href="#4-1、开启glances监控" class="headerlink" title="4.1、开启glances监控"></a>4.1、开启glances监控</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manager01 ~]# glances</span><br></pre></td></tr></table></figure>

<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/12/7/1607301391828.png" alt="glances_1.png"></p>
<p><strong>glances 工作界面的说明 :</strong><br>在上图 的上部是 CPU 、Load（负载）、Mem（内存使用）、 Swap（交换分区）的使用情况。在上图的中上部是网络接口、Processes（进程）的使用情况。通常包括如下字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%CPU：该进程占用的 CPU 使用率</span><br><span class="line">%MEM：该进程占用的物理内存和总内存的百分比</span><br><span class="line">VIRT: 虚拟内存大小</span><br><span class="line">RES: 进程占用的物理内存值</span><br><span class="line">PID: 进程 ID 号</span><br><span class="line">USER: 进程所有者的用户名</span><br><span class="line">NI: 进程优先级</span><br><span class="line">S: 进程状态，其中 S 表示休眠，R 表示正在运行，Z 表示僵死状态。</span><br><span class="line">TIME+: 该进程启动后占用的总的 CPU 时间</span><br><span class="line">IO_R 和 IO_W: 进程的读写 I/O 速率</span><br><span class="line">Command: 进程名称</span><br></pre></td></tr></table></figure>

<p>在上图的左侧是网络、磁盘IO、磁盘分区使用情况。 另外 glances 可以使用交互式的方式运行该工具，用户可以使用如下快捷键：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">h ： 显示帮助信息</span><br><span class="line">q ： 离开程序退出</span><br><span class="line">c ：按照 CPU 实时负载对系统进程进行排序</span><br><span class="line">m ：按照内存使用状况对系统进程排序</span><br><span class="line">i：按照 I/O 使用状况对系统进程排序</span><br><span class="line">p： 按照进程名称排序</span><br><span class="line">d ： 显示磁盘读写状况 </span><br><span class="line">w ： 删除日志文件</span><br><span class="line">l ：显示日志</span><br><span class="line">s： 显示传感器信息</span><br><span class="line">f ： 显示系统信息</span><br><span class="line">1 ：轮流显示每个 CPU 内核的使用情况（次选项仅仅使用在多核 CPU 系统）</span><br></pre></td></tr></table></figure>

<h4 id="4-2、glances-使用方法"><a href="#4-2、glances-使用方法" class="headerlink" title="4.2、glances 使用方法"></a>4.2、glances 使用方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">glances 是一个命令行工具包括如下命令选项：</span><br><span class="line">-b：显示网络连接速度 Byte/ 秒</span><br><span class="line">-B @IP|host ：绑定服务器端 IP 地址或者主机名称</span><br><span class="line">-c @IP|host：连接 glances 服务器端</span><br><span class="line">-C file：设置配置文件默认是 /etc/glances/glances.conf </span><br><span class="line">-d：关闭磁盘 I/O 模块</span><br><span class="line">-e：显示传感器温度</span><br><span class="line">-f file：设置输出文件（格式是 HTML 或者 CSV）</span><br><span class="line">-m：关闭挂载的磁盘模块</span><br><span class="line">-n：关闭网络模块</span><br><span class="line">-p PORT：设置运行端口默认是 61209 </span><br><span class="line">-P password：设置客户端 / 服务器密码</span><br><span class="line">-s：设置 glances 运行模式为服务器</span><br><span class="line">-t sec：设置屏幕刷新的时间间隔，单位为秒，默认值为 2 秒，数值许可范围：1~32767 </span><br><span class="line">-h : 显示帮助信息</span><br><span class="line">-v : 显示版本信息</span><br></pre></td></tr></table></figure>

<h2 id="五、glances-C-x2F-S模式"><a href="#五、glances-C-x2F-S模式" class="headerlink" title="五、glances C&#x2F;S模式"></a>五、glances C&#x2F;S模式</h2><p>glances还支持C&#x2F;S模式监控，被监控机运行服务端，监控端运行客户端既可以实现远程监控。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/12/7/1607301423160.png" alt="glances_cs.png"></p>
<p>注意：C&#x2F;S模式都必须安装glances才可以实现</p>
<h4 id="5-1、服务端启动"><a href="#5-1、服务端启动" class="headerlink" title="5.1、服务端启动"></a>5.1、服务端启动</h4><p><strong>服务端使用的端口默认是61209,如果使用服务端请注意开启防火墙。</strong><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/12/7/1607301474604.png" alt="glances_服务端.png"></p>
<h4 id="5-2、客户端访问"><a href="#5-2、客户端访问" class="headerlink" title="5.2、客户端访问"></a>5.2、客户端访问</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# glances -c 192.168.10.100</span><br></pre></td></tr></table></figure>

<h2 id="六、其他数据保存方式"><a href="#六、其他数据保存方式" class="headerlink" title="六、其他数据保存方式"></a>六、其他数据保存方式</h2><h4 id="6-1、导出数据为CSV电子表格"><a href="#6-1、导出数据为CSV电子表格" class="headerlink" title="6.1、导出数据为CSV电子表格"></a>6.1、导出数据为CSV电子表格</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manager01 ~]# glances --export-csv /tmp/1.csv</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/89/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/89/">89</a><span class="page-number current">90</span><a class="page-number" href="/page/91/">91</a><span class="space">&hellip;</span><a class="page-number" href="/page/274/">274</a><a class="extend next" rel="next" href="/page/91/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
