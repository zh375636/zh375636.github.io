<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hang&#39;s Blog">
<meta property="og:url" content="https://example.com/page/84/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/page/84/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Load-Balancing-with-Azure-14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Load-Balancing-with-Azure-14/" class="post-title-link" itemprop="url">AZ-500-Load-Balancing-with-Azure-14</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:41" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:41-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:11:50" itemprop="dateModified" datetime="2022-11-20T19:11:50-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Load-Balancing-with-Azure-14/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Load-Balancing-with-Azure-14/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><p>Hi there, and welcome to Load Balancing with Azure. My name is Thomas Mitchell and I’ll be taking you through this course.</p>
<p>I’m an Azure instructor at cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions about this course, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for those who wish to learn about different ways that you can perform load balancing in Azure. </p>
<p>We’re going to start things off with load balancers, where you’ll be introduced to the different types of load balancers, their components, and their use cases. You’ll even get to see a demonstration that shows you how to deploy a load balancer using the Azure portal.</p>
<p>After covering load balancers, we’ll dive into Application Gateway. You’ll learn what it is, what its features are, and what components comprise it. We’ll then work through the deployment of an Application Gateway.</p>
<p>Next, we’ll take a look at Azure Front Door. You’ll learn what it is and how to create a front door instance.</p>
<p>Down the home stretch, we’ll take a look at Web Application Firewall. You’ll learn what it is and when to use it. You’ll learn about using it with Application Gateway, Azure Front Door, and with Azure CDN. We’ll wrap up the section with a deployment of Web Application Firewall on Application Gateway.</p>
<p>After covering Web Application Firewall, we’ll wrap things up with Traffic Manager, which is essentially a DNS-type load balancer. You’ll learn what it is, how it works, and when to use it. You’ll also get to see a demonstration that shows you how to create a Traffic Manager profile.</p>
<p>After finishing this course, you’ll come away with a foundational understanding of the different ways you can load balance traffic in Microsoft Azure.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished. </p>
<p>If you’re ready to learn about load balancing with Azure, let’s get started!</p>
<h1 id="An-Intro-to-Azure-Load-Balancers"><a href="#An-Intro-to-Azure-Load-Balancers" class="headerlink" title="An Intro to Azure Load Balancers"></a>An Intro to Azure Load Balancers</h1><p>Hello and welcome to Azure load balancers! In this brief lecture, you will learn what Azure load balancers are and what they are used for.</p>
<p>In the context of networking, the term “load balancing” refers to the process of distributing incoming network traffic across multiple backend resources. Such backend resources are typically virtual machines that are deployed in a “backend pool” but can also be instances in a virtual machine scale set.</p>
<p>The Azure Load Balancer operates at the Transport Layer, which is layer 4 of the OSI model. When you place a load balancer in front of an application running on VMs or on a scale set, the load balancer serves as the single point of access for that application. As users hit the load balancer to access the application, the load balancer balances that incoming traffic across however many backend VMs or resources you’ve deployed in the backend pool.</p>
<p>Azure load balancers come in two varieties. There are public load balancers and internal load balancers, which are also known as private load balancers.</p>
<p>A public load balancer is used when you need to load balance incoming Internet traffic to your virtual machines. This type of load balancer requires you to assign a public IP address to the frontend of the load balancer. It’s also important to note that public load balancers can provide outbound connections to the Internet for VMs that are located inside your Azure virtual network. To make this happen, what public load balancers do is translate the private IP addresses of the virtual machines to public IPs. This allows them to communicate externally even though the VMs themselves have no public IP addresses.</p>
<p>Internal load balancers can be used in situations where only private IP addresses are required on the frontend. This means that internal load balancers are limited to use cases where you only need to load balance traffic within your Azure virtual network, or from an on-prem network that has been connected to your virtual network through a VPN or ExpressRoute connection.</p>
<p>The image on your screen depicts a typical use case for both internal and public load balancers.</p>
<p>When you deploy a load balancer, you’ll have a choice of two SKUs: Basic and Standard. The standard load balancer can support any scenario that a basic load balancer can support – and then some.</p>
<p>For example, while the basic load balancer can support up to 300 instances, the standard load balancer can support up to 1000 instances. Another benefit of the standard load balancer over the basic load balancer is the support for availability zones. While the standard load balancer supports zone-redundant and zonal frontends for inbound and outbound traffic, basic load balancers do not offer any support at all for availability zones.</p>
<p>The table on your screen shows the key differences between Basic and Standard load balancers.</p>
<p>So, why would you ever use a load balancer? Well, there are many use cases for load balancers, both public and internal. The most common use case for a load balancer is when you wish to increase availability of your application by distributing it across multiple VMs and across multiple zones. You might also want to deploy a load balancer if you wish to provide outbound connectivity for your VMs without assigning them their own public IP addresses.</p>
<p>As far as security goes, while the basic load balancer is open to the Internet by default, the standard load balancer is built upon the zero-trust model. This means that the standard load balancer is inherently secure. As a matter of fact, the standard load balancer is part of your virtual network. Unless you explicitly allow inbound traffic via a network security group, traffic is not allowed.</p>
<p>Because of the built-in security and better features Microsoft recommends using standard load balancers over basic load balancers whenever possible.</p>
<h1 id="Load-Balancer-Components"><a href="#Load-Balancer-Components" class="headerlink" title="Load Balancer Components"></a>Load Balancer Components</h1><p>Welcome to Load Balancer Components. Now that you know what a load balancer is and what it’s used for, let’s talk a little bit about the components that make up an Azure load balancer.</p>
<p>There are actually several pieces that make up a load balancer. You have the Frontend IP Configuration, the Backend Pool, Health Probes, and Load Balancing Rules. You also have High Availability Ports, Inbound NAT Rules, and Outbound Rules.</p>
<p>So, lets touch on each of these, starting with the Frontend IP Configuration.</p>
<p>The Frontend IP of a load balancer is the point of contact for clients. It can be a private IP address or a public IP address, depending on the type of load balancer. When someone needs to access an application that is load balanced, that person would access it through the Frontend IP. Load balancers can even have multiple Frontend IP addresses assigned to them.</p>
<p>The Backend Pool is really just a collection of VMs or VM instances within a scale set that is configured to service the incoming requests to a load balancer. When a request for an application comes in on the Frontend IP, the load balancer sends the request to the backend pool. The load balancer will even automatically reconfigure itself whenever you add or remove instances from the backend pool. This ensures that the load balancer never sends traffic to an instance that has been removed.</p>
<p>Health probes determine the status of the instances that are configured in the backend pool. They determine whether or not a specific instance is healthy and if it can receive traffic. When a health probe that you configure during load balancer set up stops responding, the load balancer will stop sending connections to the unhealthy instance.</p>
<p>Load balancing rules determine how inbound traffic gets distributed across the backend pool instances. A typical configuration for a load balanced Web server would include a load-balancing rule for port 80 traffic, or HTTP, that routes traffic from the front-end IP back to port 80 on the backend instances.</p>
<p>The picture on your screen depicts such a rule.</p>
<p>When you configure a load balancer rule with ‘protocol - all and port - 0’, what you are doing is configuring high-availability ports. What this rule does is allow you to use a single rule to load balance all TCP flows and UDP flows that hit all ports of an internal standard load balancer. You would typically leverage this feature if you need to load balance a large number of ports.</p>
<p>Inbound NAT rules are used to forward inbound traffic with a specific front-end IP address and port combination. Such traffic is sent to a specific VM or to a specific instance within the backend pool. A typical use case for inbound NAT rules would be one where you wish to allow RDP connections to multiple different VM’s behind a load balancer. Configuring NAT rules for your virtual machines allows you to connect to your VM’s over RDP without the need for jump box or a public IP for each VM.</p>
<p>And lastly, outbound rules are used to configure outbound network address translation, or NAT, for all VM’s within the backend pool. This kind of rule allows you to provide outbound communication to the Internet for your instances within the backend pool. I should mention, however, that outbound rules are only supported on the standard load balancer. They are not supported by the basic load balancer.</p>
<p>Join me in the next lesson, where I will show you how to perform a basic load balancer deployment.</p>
<h1 id="DEMO-Deploying-a-Load-Balancer"><a href="#DEMO-Deploying-a-Load-Balancer" class="headerlink" title="DEMO: Deploying a Load Balancer"></a>DEMO: Deploying a Load Balancer</h1><p>Welcome back, in this demonstration here, I want to show you how to deploy a basic load balancer. What this will be is a load balancer that load balances two VMs that I have already deployed. On the screen here, you can see I’m logged into my Azure portal. And what we have here is a VM called VM1 and a VM2. These VMs are both deployed into an availability set called AvailSet.</p>
<p>Now what I’ve done on each of these VMs is install IIS Web Services since they are both Windows 2019 servers. So what we’ll do is deploy a basic load balancer, and we’ll load balance port 80 or HTTP across both of these VMs. So to get started, what we’ll do here is we’ll create a new resource. And to do that we’ll select the hamburger here, and we’ll click Create a resource. And then what we’ll do is we’ll search the marketplace for load balancer. We’ll go ahead and select Load Balancer from the list. And then from here, we can read a little bit about the load balancer itself, how it works, what it offers, all that fun stuff. And then what we can do is click Create here.</p>
<p>Now what we’re going to do for this load balancer is deploy into the Lab Subscription and then into the LBLabs resource group that I’ve set up. This LBLabs resource group contains the VMs that are part of this lab. I like to keep things together.</p>
<p>Now as you can see here, we have quite a bit of information we need to provide here. What we’ll do is call our load balancer Myloadbalancer. Then what we’ll do is we’ll deploy into East US which is where my other resources are located. And we can see here the type offers us either an internal type or a public type. If we select Internal, we’ll be deploying an internal load balancer that is not exposed to the Internet. Public exposes it to the Internet, so we’ll leave this at Public. And like I mentioned earlier, we’re going to deploy a basic load balancer.</p>
<p>Now since the load balancer is public, we need to assign a public IP address for it. We don’t have an existing public IP that I’m going to use, so we’re going to select the option here to create a new one. And what I’ll do is I’ll call the public IP address myloadbalancerIP.</p>
<p>Now the SKU for the public IP address is going to match the SKU of the load balancer itself. And then the option here for assignment is whether or not we want to assign a static public IP to our load balancer or simply just use a dynamic one. For this exercise, we’ll use a dynamic IP address. And what that means is that can change over time. But normally in a production environment, you’d be accessing it through DNS anyway. So the IP address changing is typically not that big of a deal. And for this exercise, we do not need a public IPv6 address.</p>
<p>We’re not going to do any tagging for this particular load balancer, so we can just click Review and create here. And what it does here, it validates our configuration, makes sure everything that we’ve provided matches up with what is required for that particular load balancer. We can see we get the green validation passed check mark, so we can go ahead and create the load balancer.</p>
<p>Now the creation of the load balancer is just the first part of what we need to do here. We’ll go ahead and Go to resource here. And we can see that our load balancer has now been deployed. Now like I was saying, the creation of the load balancer itself is just the first piece of what we need to do here. We need to create a frontend IP configuration. We need to configure backend pools. We need to configure health probes, load balancing rules, and we need to make sure that we can load balance those two VMs properly.</p>
<p>Now since I’ve already gone ahead and deployed the VMs that I’m going to load balance, that’s one task that we don’t need to worry about. So the first task we’re going to complete here for our load balancer is to create the backend pool that’s going to host the two VMs that we’re going to load balance.</p>
<p>So to create that backend pool, we simply select Backend pools here. We can see we have none defined, so we’ll go ahead and add one. And we’ll give it a name, and we’ll just call it BackendPool. And then what we need to do is select a virtual network that this backend pool will run from. If we select the dropdown here, we can see we have our LBLabs vnet which is where our VMs are. So we’ll go ahead and select him. And again we’re using IPv4. And if we hover over Associated to here, what we need to do here is associate the backend pool to one or more VMs.</p>
<p>Now we could also associate it with instances within a VM scale set. But for this demonstration, we’re just using two basic virtual machines. So we’ll select the dropdown here. We’ll tell it we’re going to associate with virtual machines. And then when we do that, it’s going to ask us what virtual machines we want to associate with.</p>
<p>Now you’ll notice that we can only attach virtual machines in East US, and that’s because that’s where our load balancers being deployed. It also tells us here that the VMs need to have a basic SKU public IP configuration or no public IP configuration at all. So we’ll go ahead and add our virtual machines here. We have VM1 and VM2. And we’ll add them in.</p>
<p>Now that we have a name for our pool, an associated virtual network, and it’s associated with our backend VMs, we’ll go ahead and click Add. And what this is doing is adding the backend pool to the load balancer. So we can see our backend pool is now part of our load balancer. With our backend pool configured, we can go ahead and create the health probe that I talked about in the previous lesson. This health probe is going to allow the load balancer to monitor the status of the backend VMs.</p>
<p>So let’s go ahead and add a health probe down here. Go ahead and click Add. And we’ll just call this again MyHealthProbe. Since we are going to load balance HTTP traffic or port 80 traffic, we will select the dropdown for Protocol and select HTTP. We can leave the path at the default forward slash. And basically what that means is that’s the routes of the URI for that requesting health status from that backend point. So it’s just going to hit the root of the website on those VMs.</p>
<p>Now this interval here, this is the amount of time between the probe attempts. So it’s gonna go back every so many seconds to check the status of each of the backend endpoints. We’ll change this to 15 seconds. The unhealthy threshold is the number of times that it senses a failure before it actually raises an actual unhealthy failure. This basically tells the load balancer hey, you need to detect two probe failures consecutively before you label a VM as unhealthy. So we’ll leave this default two here, and we’ll go ahead and click okay.</p>
<p>Now what this does is create the health probe. So now we have the backend pool that contains our two VMs which are running IIS. And then we have the health probe that’s going to go back and check the root path for HTTP over port 80 on each of those VMs. If one of them fails twice in a row, the load balancer will mark that particular instance as failed and not send any traffic to it.</p>
<p>Now speaking of sending traffic, we now need to create the load balancing rule. And this load balancing rule will tell the load balancer where traffic goes and why and when. So we’ll go ahead and select a load balancing rule here, and we’ll click Add. We’ll give our rule a name here. And again we’re working with IPv4. Now this frontend IP address, we can only select the front IP address that has a public IP.</p>
<p>Now this frontend IP address is the frontend of the load balancer. If we select the dropdown here, we only have the load balancer frontend. Since HTTP comes over TCP port 80, we’ll leave the protocol set to TCP and the port as 80. The backend port is also 80. So basically what we’re doing here is we’re routing traffic hitting the frontend on 80 and then sending it to the backend port on 80.</p>
<p>So we’re not doing any kind of translations or anything. We can see we already have the backend pool filled in here for this dropdown here. And the health probe is already there by default. Now if we hover over Session Persistence here, we can see in this black box what Azure is telling us is that we can configure what is called Session Persistence. And this means that we can ensure that traffic from a specific client gets handled by the same virtual machine in the backend pool for the duration of that specific session.</p>
<p>Now if we select the dropdown, we can base it on client IP, client IP and protocol, or have no session persistence. We’re not interested in creating any kind of session persistence because you don’t need to for this demonstration. But if you have a situation where you need to ensure that a client session remains on a specific VM throughout that session, you would configure your Session Persistence here. So we’ll leave this set to none. And if we hover over Idle Timeout here, we can see that this Idle Timeout allows us to configure how to keep the session open without relying on the client to send keep alive messages. We’ll leave the default here at four minutes.</p>
<p>Now if we hover over this Floating IP direct server return, we can see here that Microsoft recommends using this only when you’re using SQL AlwaysOn Availability Group Listener and SQL Failover Clustered Instance IP Address. We’re not using SQL AlwaysOn here or any kind of failover, so we’ll leave this disabled. And then from here, we’ll click okay.</p>
<p>Now at this point, we have the rule saved. And if we click on Frontend IP configuration, we can see we have the load balancer frontend. And it’s using the myloadbalancerIP. Now what I’ll do here is go out to my LBLabs here, and we’ll start up VM1 and VM2 here. We’ll let these VMs spin up for a second. And then what we’ll do is we’ll go out and we’ll test our load balancer, and see if we can hit IIS on our load balancer.</p>
<p>Now to get the IP address for our load balancer, we can go ahead and select myloadbalancerIP. This is the public IP address that we created earlier. And we can see we have an IP address here of 52.149.165.55. So we’ll copy this. Let’s open up an incognito window. And we’ll paste and go. And we can see that VM1 has responded.</p>
<p>Now this VM1 here is showing up because I made a custom default HTML file on our VM1 IIS deployment. Now if we open up another tab, let’s see if I can get this to work on both. We can see VM1 shows up again. If we refresh, it’s gonna keep hitting whatever makes the most sense at the time. Try one more here. And the reason this is hitting VM one first is because there’s no real load on the load balancer to be distributing across VMs. So it’s just going to hit whatever makes sense.</p>
<p>Now if I do this, if I go back out to LBLabs and I stop VM1, we’ll give this a moment to stop. And then what we’ll do is we’ll try to hit the load balancer again. And you’ll see that the load balancer then recognizes that VM1 is not there and sends us over to VM2. Let’s go ahead and open an incognito window. And we can see here that the load balancer sent me over the VM2. And that’s because the health rule noticed that the VM1 server has gone offline. So the load balancer is smart enough to look at that and say okay, we know VM1 is down.</p>
<p>So let’s go over to VM2. And that’s pretty much it. So let’s minimize this here, and we’ll go back out to my load balancer. And we can see we have our frontend with an IP address that’s public. We can see the backend pool that points to our two VMs. We can see we have our health probe that is looking for port 80. So it’s going out to each of those VMs every 15 seconds and checking to see if port 80 is responding. If it doesn’t twice in a row, it marks that resource as down so it won’t send any traffic to it. And then we have the load balancing rules.</p>
<p>So with that, you now know how to deploy a basic load balancer and how to load balance a basic IIS deployment across two virtual machines.</p>
<h1 id="Application-Gateway-Intro"><a href="#Application-Gateway-Intro" class="headerlink" title="Application Gateway Intro"></a>Application Gateway Intro</h1><p>Hello, and welcome to Application Gateway! In this lesson, we are just going to touch on what Azure application Gateway is and what it offers.</p>
<p>Azure application Gateway is another load balancer offering that is used to load balance web traffic to web applications. While the Azure load balancer offering operates at the transport layer of the OSI model, and routes traffic based on source IP and port to a destination IP and port, the Azure application Gateway uses additional HTTP attributes to make routing decisions.</p>
<p>For example, when a request hits the application Gateway, the gateway can make routing decisions based on the URI path or based on host headers. Let’s assume, for example, that we have a website that hosts images and video. You could use application Gateway to route incoming traffic to the correct set of servers based on the URL. Incoming requests for a URL that includes &#x2F;images can be routed to the servers, or backend pool, that hosts your images. Incoming requests for a URL that includes &#x2F;video can be routed to the pool that hosts your videos. The pool that you route traffic to can consist of VM’s, a VM scale set, or even on-prem servers.</p>
<p>The image on your screen shows an example of how application Gateway can route traffic.</p>
<p>This is known as application layer routing and it happens at layer 7 of the OSI model.</p>
<p>The Azure application Gateway offers several features that allow you to load balance and manage traffic to web applications. Some key features include SSL termination, autoscaling, web application firewall, and zone redundancy. </p>
<p>SSL termination allows you to offload encryption and decryption to the gateway itself, rather than forcing the backend servers to handle it. </p>
<p>The autoscaling feature of application Gateway allows you to automatically scale up or down, based on traffic load. This feature is only supported by application Gateway standard V2. </p>
<p>The web application firewall is a service that offers centralized protection of web applications. The web application firewall, or WAF, protects such applications from many common exploits and vulnerabilities like SQL injection attacks, cross site scripting attacks, and many more. </p>
<p>By offering zone redundancy, the standard V2 application Gateway can be spanned across multiple availability zones. Because it can span multiple availability zones, you do not need to provision a separate application Gateway in each zone.</p>
<p>There are many other application Gateway features available. Visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/features">URL</a> that you see on your screen for a complete list and details of each.</p>
<h1 id="Application-Gateway-Components"><a href="#Application-Gateway-Components" class="headerlink" title="Application Gateway Components"></a>Application Gateway Components</h1><p>Welcome to application Gateway components. Now that you’ve been introduced to application Gateway and what it offers, let’s take a look at the difference components that make up the application Gateway.</p>
<p>The application Gateway consists of front-end IP addresses, listeners, request routing rules, HTTP, settings, backend pools, and health probes.</p>
<p>As is the case with load balancers, an application gateway has a front-end IP address associated with it. The front-end IP address can be public, private, or both. An application Gateway can support one public IP address or one private IP address.</p>
<p>Listeners are used to check for incoming connection requests to the gateway. When you configure a listener, you can specify a protocol, a port, a hostname, and an IP address. If an incoming request matches what has been configured in the listener, the listener accepts the request. The gateway will then route the request to whatever backend members are configured in the rule.</p>
<p>Speaking of rules, request routing rules are used to determine how to route traffic on the listeners. The request routing rule is essentially the glue that binds the listener, the backend pool, and the backend HTTP settings. What the rule does is pretty simple. It takes a request that has been accepted by the listener and forwards that request to the backend. The request routing rule defines which backend server pool that requests should be sent to.</p>
<p>The HTTP settings include ports and protocols that are used to determine whether or not the traffic between the application Gateway and the backend servers is encrypted or not. HTTP settings also determine whether or not cookie-based session affinity should be used to keep a specific user session on the same server.</p>
<p>The backend pools that I have mentioned can consist of NICs, VM scale sets, public IP addresses, internal IP addresses, FQDNs, and multitenant backends like App Service. Backend pools are essentially that - pools of resources that the gateway can direct traffic to.</p>
<p>Lastly, the health probes are used to monitor the health of the resources contained within the backend pool. When an unhealthy resource is detected by the health probe, that resource is removed from service. The health probe will then continue monitoring the unhealthy resource. If it becomes healthy again, the resource is added back to the pool automatically.</p>
<p>To learn more about the azure application gateway components, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-components">URL</a> that you see on your screen.</p>
<p>Join me in the next lesson, where I’ll show you how to deploy an application gateway.</p>
<h1 id="DEMO-Deploying-an-Application-Gateway"><a href="#DEMO-Deploying-an-Application-Gateway" class="headerlink" title="DEMO: Deploying an Application Gateway"></a>DEMO: Deploying an Application Gateway</h1><p>Welcome back. In this lesson, we are going to walk through the process of creating an application gateway. Now, if you remember from the lesson previously an application gateway is essentially a load balancer that’s built for load balancing web traffic specifically. So that’s what we’re going to do here.</p>
<p>We have two VMs called VM1 and VM2. Both have IIS installed. What we’re going to do is deploy a gateway and load balance that web traffic to both of those VMs through the use of a backend. So to begin the process of deploying our application gateway, we’ll go ahead and select the hamburger and Create a Resource. And then we’ll search the marketplace for application gateway. We’ll go ahead and select it and we’ll begin the creation process.</p>
<p>Now, when we create the application gateway, we have, looks like six different tabs here that we need to configure information for. Some of them will require more information than others. This basics tab, as you would expect is where we configure some of the basic information for our application gateway, the name, the subscription it’s going to, the resource group some of that information here. So what we’re going to do for this application gateway is deploy into our lab subscription and then into the resource group called LBLab.</p>
<p>Now in this application gateway name box we need to give our gateway a name. So I’ll just call it MyAppGateway. And what we’ll do here is we’ll deploy into East US since that’s where my other resources are here. And then in this teardrop down we can select the standard Standard V2 or web application firewall web application, Firewall V2. If we hover over the icon here we can see that the V2 tier offers performance enhancements over that of the standard original tier.</p>
<p>Now, if we hover over the, go back here. If we hover over the Learn more link here and open it up, we can see the information about the different features of the application gateway V2. The enhancements include like auto scaling, zone redundancy, you can even do a static virtual IP, header rewrites, all of this cool stuff that the V2 offers over the standard. So I encourage you to take a look at, that this page here and take a look and see what the application gateway enhancements are for the V2 SKU.</p>
<p>So we’ll bounce back over here and we’ll leave this set to standard V2 it is default, and then we’ll keep auto scaling enabled. Now, this minimum scale units here, if we hover over the icon here, this little black box will tell us that the minimum scale units refers to additional reserve capacity which is always maintained regardless of what traffic is hitting the gateway.</p>
<p>Now by selecting zero here, what this does is signify a purely auto-scaling application gateway and it doesn’t have any additional reserve capacity while still maintaining that high availability. So we’ll leave this at zero and then the maximum scale units again, we go up to 10. We’ll leave the default there. If we select the drop down for availability zone, we can see, we can select an availability zone to provide high availability for our application gateway.</p>
<p>If we hover over the icon on here, we can see that some regions will support the ability to put this application gateway into zones for availability or availability zones. Since we’re in East US that is a region that supports availability zones. We’re not going to do anything with high availability here so we’ll leave this set to None. Hovering over HTTP2 shows us that the application gateway does support HTTP2 protocols for clients that are going to connect to application gateway listeners only. We’re not doing anything with HTTP2, so we’ll leave that off.</p>
<p>Now, the tricky thing here with an application gateway is the virtual network. If we hover over the icon here for virtual network, we can see that we need to provide a virtual network for our application gateway to connect to. Now that being the case, the next sentence here the second sentence in this box is critical. The virtual network that we use needs to have either an empty sub-net or a sub-net that only contains application gateways. If we don’t have one of those two, we have to create a new virtual network and sub-net for that specific gateway.</p>
<p>Now for this exercise, I’m going to select the LBLab vnet where my virtual machines are installed. Now, if I select this, the default sub-net automatically appears because that’s the only sub-net there. And it turns red here. And this is because it’s not an empty sub-net because I have VMs on it and it’s not a sub-net that contains just application gateways.</p>
<p>So what I need to do here is create an empty sub-net on that virtual network. And to do that, I select the manage sub-net configuration here. And this takes me out to the LBLab vnet virtual network, where I can create another sub-net here. So I’m just going to call this AGSubnet.</p>
<p>Now the address range for the subnet needs to fall under the umbrella of the address space for the virtual network. The address space for this virtual network is 10000&#x2F;16. The existing default sub-net as 10010&#x2F;24. So what I’ll do here is call this 10020&#x2F;24. We’re not doing anything with Nat gateways, nothing with sub-net delegation or anything. We just need a dumb sub-net here. So we’ll okay it and if we refresh this, we can see we now have the AGSubnet.</p>
<p>So we’ll go back to the Create application gateway here, and what we’ll do here is select the AGSubnet. At this point, we need to configure the frontends. So we’ll go ahead and click Frontends here. Now the frontend is where traffic will enter the gateway to access whatever web application you have running. You can have a public frontend type, a private or both. For this exercise, we’re going to have a Public Frontend IP address and I can either use the existing IP, which in this case I only have two defined and it’s one for each of my VMs. So what I’ll do here is I’ll create a new one and I’ll just call this AGPublicIP.</p>
<p>Now you can see the SKU and assignments are great out because I can’t change those. The SKU is going to match that of my gateway and then the assignments going to be static. So, okay at here. At this point we have our frontend configured and now we can move on to the backends. We can see here, we have no backend pool and this obviously the backend pool is the pool of resources that the application gateway is going to send traffic to.</p>
<p>If you look at the note here you can see a backend pool can contain virtual machines, VM scale sets, app services, IP addresses, or even FQDNs. For this exercise, we’re going to build that pool from two virtual machines. So we’ll go ahead and add the backend pool. And I’m just going to call this AGBackend. Now this option here for adding backend pool without targets, if we don’t have targets already defined, we could select Yes here, Create the pool and then come back and add our backend targets later. But since we already have our VMs created, we just leave this at No and then in the target type, we select the dropdown for Virtual machine. Now from Virtual machine next to it for target, we go ahead and select VM1 and VM2.</p>
<p>Now you’ll notice I’m not even selecting VMs here, I’m selecting the NIC for each of those VMs. And there you go we go to VMs, we’ll add them in and we have two targets. So we’ll go ahead and Next here to Configuration. Now on this configuration tab what we’re going to do is connect the front end to the backend, using a routing rule.</p>
<p>We can see under frontend, we have the new AGPublic IP and we can have our backend here defined as AGBackend. What we need to do here is add a routing rule. I’m just going to call this rule RoutingRule. Now the very first thing we have to do is define a listener.</p>
<p>Now that listener is a component that listens on the specific port and IP address for any kind of traffic. If that traffic matches the traffic that we specify here the application gateway applies the rule. So I’ll just call this MyListener. Now we have to tell the listener where it needs to listen.</p>
<p>So in this dropdown here, we select the Public Frontend IP because this is the frontend IP that we created for it and then we’re going to listen for HTTP traffic which is Port 80. Now, if we hover over Listener type here this is where we can define whether we’re using a single site behind the gateway or if we’re using multiple sites. We’re not using multiple sites, so we’ll leave this at Basic Listener type and we don’t have an error page URLs. So we’ll leave this set to No. And then what we wanna do is go to the Backend targets tab here.</p>
<p>Now, since we have a backend pool we’re going to specify the backend pool target type and then we’re going to select our AGBackend that we defined. Now, this HTTP settings option here. This is what defines the behavior of the rule. It’s where we’ll specify ports, protocols, backend settings, affinity, that kind of fun stuff. Now we don’t have an HTTP setting defined yet, so we’ll go ahead and click Add new. And for the name, we’ll just call it myHTTPSettings.</p>
<p>Now we’re not balancing HTTPS traffic, we’re doing HTTP. So we’ll leave HTTP set and the backend port at 80. Now Cookie-based affinity is a way to ensure that the application gateway forces a user session to a specific backend server or instance for the duration of the session. We’re not doing any kind of a Cookie based affinity here, so we’ll leave this disabled. And then for connection draining here what this does is allow you to more gracefully remove backend pool members during planned service updates.</p>
<p>I’m not worried about connection draining for this simple demonstration, so I’ll leave this disabled as well. Hovering over the Request time-out, what this is, this is the number of seconds that the application gateway will wait for a response from the backend pool before it comes back and says there’s a connection time out, or any kind of error message that it has to return to the end user. The default here is 20 seconds, so we’ll leave that there. That works for me. And then this override backend path, this allows you to override the path in the URL so any requests for a specific path can get rerouted to a different path. </p>
<p>So if we read what’s noted in this box, we can see that for example, if he wants to route requests for contoso.com&#x2F;images to the default path, we enter a forward slash here and then attach this HTTP setting to the rule associated with contoso.com&#x2F;images. We’re not doing any redirections or overrides here so we can leave this blank. And then under host name here, we can override with new host names. These are more advanced features we don’t need to do anything with overrides here.</p>
<p>So we’ll go ahead and click Add and we’ll go ahead and finish up here. So now we have the Frontend, the Routing rule, and the Backend configured. And then if we’re going to do any tagging, we can click Next for tags but we’re not gonna do any tagging here. And then we’ll Review and Create. And what Azure will do here is look at our configuration and validate it. Everything looks good. We get the green check mark. We can go ahead and Create the application gateway. We can see our deployment is now complete.</p>
<p>So we’ll bounce back to our Resource group here. Now to test our gateway, what we need to do is identify the public IP address for it. And to do that, you can see here, we’re in our LBLab Resource group. If we select the public IP that we created, we can see the IP address of it. So this is the public IP of our application gateway.</p>
<p>If we copy that and open up a new incognito window, we can paste and go. We can see that the gateway has defaulted at least on this load to VM2. If we refresh here a few times, we may be able to get it to hit VM1. Maybe we’ll try to open an incognito window, do it again and we still hit VM2. Now, the reason for this is because there’s really no load on these. So it’s just gonna pick whatever is working and it’s gonna go with it. </p>
<p>So what I can do to confirm that the gateway works, is I’ll bounce out of this and what I’ll do is I’ll go back into my LBLab Resource group here and what I’ll do is I’ll shut down VM2. Let’s Refresh. So let’s go ahead and open our incognito window and we can see we hit VM1. So the application gateway knows VM2 is no longer available, so it’s now sending traffic to VM1.</p>
<p>If we close this out, we can go back to our application gateway here and there you have it. That’s how you deploy an application gateway and how you load balance web traffic using the application gateway.</p>
<h1 id="An-Intro-to-Azure-Front-Door"><a href="#An-Intro-to-Azure-Front-Door" class="headerlink" title="An Intro to Azure Front Door"></a>An Intro to Azure Front Door</h1><p>Hello and welcome to Azure Front Door. In this lesson, we’ll take a look at what Azure Front Door is, and what it offers.</p>
<p>Azure Front Door is a service offering that is delivered from the edge of Microsoft’s global network. This service offers global load balancing for applications and even microservices. With Azure Front Door, you can fail over such apps and microservices across different regions or even different clouds. You can use it to define, manage, and monitor global routing for your web traffic. It also provides high availability.</p>
<p>Key features and benefits of Azure Front Door include improved application performance, increased availability, URL-based routing, session affinity, and much, much more.</p>
<p>Improved app performance is attained through the use of split TCP-based anycast protocol. What this does is ensure that users of an application connect to the nearest point of presence to them. This speeds access and reduces latency.</p>
<p>Increased availability is made possible with smart health probes. These smart health probes monitor the backend resources for latency and availability. When a backend resource goes down, the health probes facilitate a quick failover to remaining backend resources.</p>
<p>The URL-based routing that Front Door offers allows you to route traffic to backend pools based on the URL paths of the requests. For example, requests for a URL like <a target="_blank" rel="noopener" href="http://www.bluewidgetcorp.com/video">http://www.bluewidgetcorp.com/video</a> could be configured to go to resources hosting videos, while a URL like <a target="_blank" rel="noopener" href="http://www.bluewidgetcorp.com/images">http://www.bluewidgetcorp.com/images</a> could be configured to go to resources hosting images.</p>
<p>The cookie-based session affinity that Front Door offers can be used to ensure that a specific user session remains on the same backend for the duration of the session.</p>
<p>There are also many other features and benefits of Front Door, including things like TLS termination, custom domain support, URL redirection, and others.</p>
<p>For a complete list of Azure Front Door features and benefits, along with an explanation of each, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/frontdoor/front-door-overview">URL</a> that you see on your screen.</p>
<h1 id="DEMO-Creating-a-Front-Door"><a href="#DEMO-Creating-a-Front-Door" class="headerlink" title="DEMO: Creating a Front Door"></a>DEMO: Creating a Front Door</h1><p>Welcome back. In this demonstration, we’re going to walk through the process of configuring Azure Front Door so that it directs user traffic based on lowest latency between two web apps. Now, what I’ve done here to prepare for this demonstration is deploy two different web apps in my environment, within the LBLab, Resource group I created a web app called BlueWidget1. This application is hosted in Central US.</p>
<p>In the LBLab2 resource group that I’ve spun up, I created a web app called BlueWidget2. This application runs in East US. What we’re going to do is configure front door to front end both BlueWidget1 and BlueWidget2. So let me bounce back into LBLab which is my primary resource group here for some of my labs. And to create our front door, what we’re going to do is go to the hamburger and create a resource. And then from here, we can search for front door or we could browse it by going into Networking and then finding front door down here in the feature or if we See all, we could find it down in here.</p>
<p>So for this demonstration, we’ll search for front door, we’ll select it and we will deploy our Front Door. When we create a front door we need to tell Azure what subscription to deploy to and into what resource group. So we’ll go into LBLab for this. Now we can see the Resource group location is greyed out because we can’t change that.</p>
<p>Next, we’ll go into the configuration of the door and we can see here that this configuration happens in three steps. We create the Front end, we create the Backend, and then we create the Routing rules. So let’s go ahead and click the plus sign here to create a frontend. Now this frontend is going to be where traffic enters. This host name here is upended with this domain of Azure FD for front door. It’s Azurefd.net. So the name I give it needs to be globally unique across the entire landscape. So I’m going to call this bluewidgetFD.</p>
<p>So, for our host name, we’ll call it bluewidgetFD which stands for bluewidget front door. So the complete host name will be bluewidgetFD.azure.net. Now for this demonstration we’re not going to configure session affinity. Now that session affinity would allow us to direct traffic from a specific user session to the same application backend for the duration of the session. I’m not worried about affinity right now, so we’ll leave that alone nor am I going to configure web application firewall this time.</p>
<p>So at this point, we can click Add. At this point we have our front end configured for our front door. Now we need to tell Azure what the backend is going to be where are we going to send our traffic to. So we’ll go ahead and plus it up here and we’ll just call this MyBackend. Actually we’ll call it MyBackendPool.</p>
<p>We’ll go ahead and add a backend and the backend host type allows us to define what that backend is. In our case here, it’s an app service. So we’ll select App service. We can see it fills in the backend host name, the backend host header. All of this HTTP information is automatically filled in. We’ll go ahead and add this backend and then we’ll add the second backend bluewidget2 and we add.</p>
<p>These health probes here allow the front door to check the status of our backends. These can be left at their defaults. And then the load balancing settings down here are used as it says here to define what sample set we need to call the backend as healthy or unhealthy. We’ll go ahead and add. And now we have our front end and our backend defined.</p>
<p>At this point, we need to add a routing rule. Now this routing rule is going to map the front end host to a backend pool. So let’s go ahead and create a routing rule here and we’ll just call this MyRule. Now for this demonstration we can accept the default settings here because the accepted protocol is HTTP and HTTPS which is what we’re going to send to our backend. And we can see the front end is already free filled with the front end that we defined earlier.</p>
<p>The pattern to match is the default URL path and then the route details here tell front door what to do. For example, with the forward setting, if we hover over this, we tell the front door to forward traffic to the backend rather than redirect it. We can see the backend pool is configured. If we hover over URL rewrite, we can take a look here and see that by enabling this, we can configure a path to use when constructing this request for the URL and use a rewrite to forward that to the backend. And the same thing with caching here. We can enable caching for this particular routing rule.</p>
<p>Now for this demonstration, we’re not going to do any rewriting or caching so we can go ahead and add our rule. At this point, we have our front end configured, our backend and our routing rule. So we’ll go ahead and create our front door here, we get the validation and then we can create.</p>
<p>Now once this deployment completes, we’ll go in and I’ll let you see what happens with Azure front door here by viewing it in action here. Now what Azure front door is going to do for us is perform pretty much an instant global fail over. Remember one of our apps is in the East region and the other one is in Central.</p>
<p>So let’s go ahead and open up an incognito window and browse to our front door. And now the bluewidgetfd.azurefd.net is directing to our app service. And what front door will do is keep track of which application is running and if one of them goes down, front door will ensure that traffic instead of being sent to the down instance is sent to the instance that remains up. And that’s pretty much it. I mean, setting up the front door service, isn’t terribly complicated, you simply set up a frontend, a backend and your rule to route that traffic. That traffic is then directed to each of your backends that you’ve configured behind that front door service.</p>
<h1 id="What-is-Web-Application-Firewall"><a href="#What-is-Web-Application-Firewall" class="headerlink" title="What is Web Application Firewall?"></a>What is Web Application Firewall?</h1><p>Welcome to web application firewall! In this lesson, I’m going to introduce you to the Azure web application firewall and what it offers.</p>
<p>Also known as WAF, the web application firewall in Azure offers a way to protect web applications from common vulnerabilities and exploits, like SQL injection attacks and cross-site scripting attacks.</p>
<p>While such attacks CAN be prevented within application coding, doing so is tedious and requires ongoing maintenance. The centralized protection that web application firewall offers vastly simplifies such protection – and it can often allow you to respond to threats far more quickly by patching known vulnerabilities instead of needing to secure every individual web application behind it.</p>
<p>The image on your screen depicts what a typical WAF solution looks like.</p>
<p>You can deploy web application firewall in conjunction with several different Azure services. It can be deployed with Azure Application Gateway, Azure Front Door, and with the Azure Content Delivery Network. The features of web application firewall can be customized for each service.</p>
<p>When used with Application Gateway, web application firewall offers protection for web applications against web vulnerabilities and attacks without any need for changes to the application code itself. You can even protect multiple applications simultaneously. As a matter of fact, you can host and protect up to 40 websites with web application firewall on a single instance of Application Gateway. The ability to create custom WAF policies allows you to use different policies for different sites.</p>
<p>The image on your screen depicts a typical WAF deployment with Application Gateway.</p>
<p>Just as it does when used with Application Gateway, web application firewall provides centralized protection against web threats when use with Azure Front Door. This type of global solution is deployed on edge locations on the Azure network around the world. Every incoming request to the Front Door is inspected at the edge of the network. This means attacks are prevented by WAF before they even enter your virtual network.</p>
<p>The image on your screen depicts a typical web application firewall deployment with Front Door.</p>
<p>When used with the Azure Content Delivery Network, the web application firewall can be used to protect web content itself. A global and centralized solution, WAF with the Azure CDN mitigates malicious attacks closer to their sources, rather than after they reach your network.</p>
<p>The image on your screen depicts a typical WAF deployment with Azure CDN.</p>
<p>So, to recap, web application firewall is designed to protect against various web threats, and it can be used with Application Gateway, Azure Front Door, and with the Azure Content Delivery Network. </p>
<p>For more technical details on Web Application Firewall, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/web-application-firewall/">URL</a> that you see on your screen.</p>
<h1 id="DEMO-Enabling-Web-Application-Firewall-on-Application-Gateway"><a href="#DEMO-Enabling-Web-Application-Firewall-on-Application-Gateway" class="headerlink" title="DEMO: Enabling Web Application Firewall on Application Gateway"></a>DEMO: Enabling Web Application Firewall on Application Gateway</h1><p>Hello and welcome back. In this demonstration, what we’re going to do is enable Web Application Firewall with app Gateway. Now on the screen here, you can see I’m logged into my Azure portal and I’m looking at my Application Gateway, which is aptly called MyAppGateway. There are two servers on the backend of this. They’re two virtual machines. It’s called VM1 and VM2 and both are running IIS.</p>
<p>So our app Gateway is already set up as is the backend. So all we need to do here is enable Web Application Firewall. Now to do that, the first thing I need to do is create a storage account to store data for detection and prevention purposes. Now we could also use Azure monitor logs or Event Hub but for this demonstration, we’ll just create a storage account.</p>
<p>So we’ll go ahead and click the hamburger, create the resource and we’ll select Storage Account from the popular list here. We’ll deploy this in the LB Lab Resource Group and we’ll just call this something like BW Diag Storage. There we go. Remember that storage account name needs to be unique. So we got a unique name here. We’ll leave this in East U.S. and the performance can remain standard here for diagnostics and we’ll leave it at the default storage V2 which is the recommended storage account kind that Microsoft recommends. And we can leave the default replication which is not really critical here.</p>
<p>The same thing goes for access here. We’re not really using cool data. We’ll use this hot. And then what we’ll do is we’ll review and create here. Now once we have this storage account created, what we’ll do is configure the diagnostics to record data into our Application Gateway Access Log, the Application Gateway Performance log and the Application Gateway Firewall Log.</p>
<p>So let’s go back out and we’ll go into my app Gateway here. Now what we do here is go down under monitoring here and we select the Diagnostic Settings option. We can see here, we don’t have any diagnostics configured for our app Gateway. So what we’ll do here is we’ll add one and we’re just going to call this MyDiags. And then what we’re going to do is archive to a storage account here and we’ll keep our logs here. We’re not going to worry about metrics at this point. We’ll just leave the logs here collected.</p>
<p>Now obviously in these boxes, we can configure the retention for each of these. Now leaving this at zero means we’re not setting any retention policy and what this will do is retain our data forever. So now that we’re archiving to a storage account, we need to make sure that we select our storage account to archive to. We only have the one storage account here so it’s been selected by default.</p>
<p>At this point, we can save our diagnostic setting. Let’s go back out to our resource group here and now the next step in the process is to create what’s called a WAF policy or a Web Application Firewall policy. We need to create that policy and then associate it with our Application Gateway. What we’ll do here for this demonstration is create a basic policy with a managed default rule set. Basically, it’s just a basic vanilla policy. </p>
<p>Now to do this, we’ll go up into the hamburger, create a resource, and then we’ll search for WAF. And we can see Web Application Firewall appears. And then we’ll go ahead and begin the creation process of the Web Application Firewall policy. On this screen here, we’re going to configure some basics.</p>
<p>For the policy here, We need to indicate what resource type we’re trying to protect. We select the dropdown here. We have Azure CDN Application Gateway or front door. We’re going to protect Application Gateway and we’ll put this in the LB Lab Resource Group. Now for instance details, we need to specify the location, the policy state and we need to give the policy a name. This policy name must be unique.</p>
<p>So we’ll just call it MyBWPolicy. It’s my blue widget policy. Now since this is a vanilla policy, we don’t have to do anything crazy at this point. You can go ahead and click through to next. Under policy settings, here we can leave the defaults. If we hover over mode here, we can see that detection mode will monitor and log all threat alerts to a log file.</p>
<p>Prevention mode will take some corresponding action if that request matches a rule. We’re gonna leave this in its default configuration here. We’ll leave our rules in place. It’s already pre-configured with a specific rule set and we can see what those rules are. So we’ll leave the default rules in place. We’re not going to do any custom rules but what we do want to do is go into association here and associate our WAF policy with an Application Gateway.</p>
<p>So what we’ll do here is we’ll associate our Application Gateway and if we do a dropdown, we can see we don’t have any gateways to associate. Now I know for a fact we have the Application Gateway already created. But if you notice here, it needs to be a WAF V2 SKU for the gateway.</p>
<p>So what we’re going to do is open up another tab here and we’ll go into my app Gateway. If we look at the configuration for our Gateway, we can see that the tier is standard V2. It’s not this WAF V2. So what I need to do here is change the tier and save that. So that gateway needs to be a WAF V2 tier in order to work with the Application Gateway WAF policy. So we’ll cancel this. So let’s go back in here and we’ll go ahead and associate our Application Gateway and we’ll go ahead and save it. And we can see that our deployment has succeeded.</p>
<p>So now that our policy has been associated with our Application Gateway, we can test the Application Gateway. What we’ll do here we’ll go out to our Gateway. We’ll copy the IP and we can see that we’re now hitting the Gateway and it’s still up and running where I hit VM1 which is one of the backend VMs of the Gateway.</p>
<p>If we close this out, go back out to our LB Lab and then we can take a look at our policy. We can see the status is enabled. We can take a look at the activity log and we now have a Web Application Firewall policy associated with our Application Gateway.</p>
<h1 id="An-Intro-to-Traffic-Manager"><a href="#An-Intro-to-Traffic-Manager" class="headerlink" title="An Intro to Traffic Manager"></a>An Intro to Traffic Manager</h1><p>Welcome to Traffic Manager! In this lesson, we’ll touch on yet another load balancing feature, called Traffic Manager. We’ll look at what it is and what it does.</p>
<p>Azure Traffic Manager is a load balancer that works by distributing traffic using DNS. It’s a bit different from the Azure load balancer offerings that we discussed earlier. You typically use Traffic Manager to distribute traffic to services that are located across different global Azure regions. When you use Traffic Manager, you can ensure that your European users can access your application from and endpoint closest to them, while your North American users can access the same app from a service endpoint closest to them. This provides higher availability of your app and makes it more responsive to end user requests.</p>
<p>The way it works is pretty straightforward. What Traffic Manager will do is use DNS to send access requests to the service endpoint with the least latency for the requester, based on the configured traffic routing method and on the health of the endpoints that have been configured. The configured endpoints can be any Internet-facing service that’s hosted inside or outside of Azure. Its flexibility protects applications against failures, including the failure of an entire Azure region.</p>
<p>Because it works at the DNS level, Traffic Manager will use DNS to route incoming connections to the necessary endpoint, based on how the rules are configured and on the traffic routing method. Speaking of routing methods, there are several available when using Traffic Manager.</p>
<p>You have Priority, Weighted, Performance, Geographic, Multivalue, and Subnet.</p>
<p>If you want to send all incoming traffic to a primary service endpoint, while making backup endpoints available in the event the primary endpoint is not available, you would choose the Priority method.</p>
<p>The Weighted routing method can be used in situations where you need to split traffic out across multiple endpoints, based on weighting that you define. Weighted routing can also be used to evenly split traffic across multiple endpoints.</p>
<p>The Performance routing method is often used with applications that are distributed across multiple geographic locations. Choosing the Performance routing method allows you to direct users to the closest endpoint to them, when they access your application. This reduces latency for those users.</p>
<p>Geographic routing also allows you to force users to an endpoint closest to them, but it works a little differently than Performance routing. Geographic routing is performed based on the geographic location of the original DNS query. You would typically use Geographic routing to ensure a user in Europe access your application from a European endpoint. This is a useful option when you need to comply with sovereignty mandates.</p>
<p>The Multivalue option should be used for Traffic Manager profiles that can only have IPv4 or IPV6 addresses as endpoints.</p>
<p>And lastly, the Subnet routing method allows you to map specific ranges of end-user IP addresses to specific endpoints. This means you can force specific users, based on their IP addresses, to connect to certain endpoints.</p>
<p>Now, I should point out here, because its not always evident when I talk about it, that Traffic Manager is NOT a proxy or gateway. Despite all these routing methods that are available, what Traffic Manager actually does is play traffic cop. No traffic ever passes through Traffic Manager. Instead, Traffic Manager directs clients to the endpoints. The clients then make connections directly to those endpoints. Keep that in mind.</p>
<p>The picture on your screen shows how a client typically connects to an endpoint, using Traffic Manager.</p>
<p>Notice what happens here. (1) The process starts off with a DNS query for the app called app.bluewidgetco.com from the client to the client’s DNS service.</p>
<p>Next, (2) the DNS service reaches out to the name servers for the domain hosting the application, and those name servers return the CNAME record that points to the Traffic Manager implementation for the app. In this case, the CNAME record is called bluewidgetco.trafficmanager.net. The root domain will always be trafficmanager.net for Traffic Manager implementations.</p>
<p>At this point (3) the client’s DNS service finds the name servers for the trafficmanager.net domain. These servers are provided by the Traffic Manager service itself. After finding the name servers for the trafficmanager.net domain, the client’s DNS service sends a request for bluewidgetco.trafficmanager.net.</p>
<p>Once the Traffic Manager (4) name servers receive the request, they determine the correct endpoint, based on the state of the configured endpoints, the health of the endpoints, and the routing method that has been configured.</p>
<p>Traffic Manager (5) then returns the CNAME record of the proper endpoint to the client’s DNS service. In this example, there are two deployments of the app. The app is deployed at bluewidget-us.cloudapp.net and at bluewidget-eu.cloudapp.net. Let’s assume the users is US-based and should hit the US-based deployment of bluewidget-us.cloudapp.net. In this scenario, the endpoint of bluewidget-us.cloudapp.net is returned to the client’s DNS service.</p>
<p>Once it receives the endpoint DNS name, (6) the client’s DNS service finds the DNS name servers for the cloudapp.net domain and requests the DNS record for bluewidget-us.cloudapp.net. The cloudapp.net name servers respond to the client’s DNS service with the IP address of the US-based endpoint.</p>
<p>The (7) client’s DNS service sends this information back to the client requesting access.</p>
<p>Once the client receives the DNS information and IP address for the US-based deployment, the (8) client connects directly to that deployment.</p>
<p>So, as you can see here, Traffic Manager is heavily dependent on DNS. After all, like I mentioned at the outset, it’s a DNS-specific load balancing solution.</p>
<p>Join me in the next lesson, where I’ll show you how to create a Traffic Manager profile.</p>
<h1 id="DEMO-Creating-a-Traffic-Manager-Profile"><a href="#DEMO-Creating-a-Traffic-Manager-Profile" class="headerlink" title="DEMO: Creating a Traffic Manager Profile"></a>DEMO: Creating a Traffic Manager Profile</h1><p>Welcome back. What we’re going to do in this demonstration here is deploy a Traffic Manager profile. The process is going to be pretty straightforward. We’re going to deploy the profile, and then we’re going to add two backend endpoints to that profile. The endpoints will be two web apps that I’ve deployed in Microsoft Azure.</p>
<p>On the screen here, you can see I’m logged in to my Azure portal, as my admin. And I’m sitting in the LB Lab resource group. We have two web apps deployed here, Blue Widget 1 and Blue Widget 2 is going to live in the other research group of LB Lab 2. So these will be the end points.</p>
<p>So let’s bounce back to LB Lab. Now to begin the process, we’ll go into the hamburger here and we’ll create a resource. And what we’ll do here is we’ll search for Traffic Manager. And you can see here Traffic Manager profile shows up in the list, so we’ll go ahead and begin the process here.</p>
<p>Now when we create our Traffic Manager profile, we need to give it a unique name across the Azure landscape. We need to specify the routing method that we talked about earlier, the subscription, and the resource group we want to deploy it into. When we create our profile, the name we use here is going to append the trafficmanager.net domain name. So that’s why this needs to be unique.</p>
<p>So what we’ll do here is we’ll try to call this MyBWApp. So mybwapp.trafficmanager.net will be the URL that we use to hit the web applications that are sitting behind the Traffic Manager profile. In the drop-down here for routing method, we have the different routing methods we talked about. Performance, weighted, priority, the geographic multi-value and subnet. We’ll leave this set to performance, we’ll deploy into the lab subscription, and we will deploy into LB Lab.</p>
<p>Now you’ll notice the resource group location grays out based on the resource group that we select. So we’ll go ahead and create the profile. We can see our deployment has succeeded, so we’ll go to our resource here. And we now have My BW App Traffic Manager profile.</p>
<p>Now at this point, what we’re going to do is create the endpoints. We’ll create a primary endpoint that points to our app 1, and then a secondary that points to app 2. So we’ll go ahead, to do this under Settings here we select Endpoints, and we can see we have no endpoints currently created, so we’ll go ahead and add the first one. And you can see here there’s not too much information we need to provide.</p>
<p>In the Type drop-down here, we need to tell Azure what kind of endpoint we’re going to add, whether it’s an Azure endpoint, an external endpoint, or a nested endpoint. Since our endpoints are going to be a web app, we’ll select Azure Endpoint. And then we need to give our endpoint a name here, so I’ll just call it Endpoint 1.</p>
<p>Now in the target resource type, you can see we have a couple of different options here. Cloud service, app service, App Service Slot, and Public IP. Since we are using App Service as our endpoints, it stands to reason that we deploy App Service as our target resource type. And then once we do that, the Target Resource dropdown allows us to select our app service. We can see we have one in the central US and one in east US. So we’ll select the blue widget 1 for a primary endpoint here.</p>
<p>Now, if we hover over custom header settings here, what this does is allow us to configure custom headers for the app. We don’t need any custom headers for our applications here, so we’ll leave this box alone. Now we could add our endpoint in a disabled state by checking the Disabled box, but we’ll add this in in an active state. And to do that, we simply click the Add button.</p>
<p>To add the second endpoint, we just repeat the process. We go ahead and add. We’ll select the Azure endpoint, We’ll call this Endpoint 2. We’ll select the app service, and then we’ll choose Blue Widget 2 this time. Now to test our Traffic Manager, if we bounce out to Overview here, we can copy the URL, which is the DNS name for our Traffic Manager. And to get to our Traffic Manager, we’re going to hit <a target="_blank" rel="noopener" href="http://mybwapp.trafficmanager.net/">http://mybwapp.trafficmanager.net</a>.</p>
<p>Let’s open up an Incognito window here, and there you go. So Traffic Manager is now going to send me to the closest iteration of our web app. In my case here, I have an east US deployment and a central US deployment. Me personally, I’m located in the eastern part of the United States.</p>
<p>So what Traffic Manager will do is look at where the request for the application is coming from and send me to the closest iteration of that web app based on the DNS request. And that’s pretty much it. That is how you deploy and configure a Traffic Manager profile.</p>
<h1 id="Course-Conclusion"><a href="#Course-Conclusion" class="headerlink" title="Course Conclusion"></a>Course Conclusion</h1><p>Congratulations! You’ve come to the end of Load Balancing with Azure. Let’s review what you’ve learned.</p>
<p>We started things off with load balancers, where you were introduced to the different types of load balancers, their components, and their use cases. You even got to see a demonstration that showed you how to deploy a load balancer using the Azure portal.</p>
<p>After covering load balancers, we dove into Application Gateway. You learned what it is, what its features are, and what components comprise it.</p>
<p>We then worked through the deployment of an Application Gateway.</p>
<p>Next, we took a look at Azure Front Door, where you learned what the Azure Front Door service is and how to create a front door instance.</p>
<p>We then dove into Web Application Firewall. You learned what it is and when to use it. You also learned about using it with Application Gateway, Azure Front Door, and with Azure CDN. We wrapped up the section with a deployment of Web Application Firewall on Application Gateway.</p>
<p>After covering Web Application Firewall, we wrapped up with Traffic Manager, which is essentially a DNS-type load balancer. You learned what Traffic Manager is, how it works, and when to use it. You also got to see a demonstration of how to create a Traffic Manager profile.</p>
<p>At this point, you should have a good understanding of how to load balance with Microsoft Azure.</p>
<p>To learn more about load balancing with Azure, you can, and should, read Microsoft’s published documentation. You should also keep an eye out for new courses on Cloud Academy because we’re always publishing new ones. </p>
<p>Be sure to give this course a rating, and if you have any questions or comments, please let us know.</p>
<h1 id="5Application-Gateway-Intro"><a href="#5Application-Gateway-Intro" class="headerlink" title="5Application Gateway Intro"></a>5<strong>Application Gateway Intro</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/features">List of Gateway Features</a></p>
<h1 id="6Application-Gateway-Components"><a href="#6Application-Gateway-Components" class="headerlink" title="6Application Gateway Components"></a>6<strong>Application Gateway Components</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-components">Azure Application Gateway Components</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Implementing-Azure-Network-Security-13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Implementing-Azure-Network-Security-13/" class="post-title-link" itemprop="url">AZ-500-Implementing-Azure-Network-Security-13</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:39" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:39-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:11:36" itemprop="dateModified" datetime="2022-11-20T19:11:36-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Implementing-Azure-Network-Security-13/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Implementing-Azure-Network-Security-13/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to Implementing Azure Network Security. My name is Thomas Mitchell and I’ll be taking you through this course. I’m an Azure trainer at Cloud Academy and I have over 25 years of deep IT experience, several of those with cloud technologies. If you have any questions on this course, feel free to connect with me on LinkedIn or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. This course is intended for IT professionals who are interested in earning Azure certification and for those who work with <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Microsoft Azure</a> on a daily basis. To get the most from this course, you should have at least a basic understanding of Azure network resources, such as <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/virtual-network/vnet-intro-1/">virtual networks</a>, Azure firewalls, and network security groups.</p>
<p>Throughout this course, we’ll cover topics such as virtual network connectivity, network security group configuration, and Azure firewall configuration. We’ll also cover the Azure Front Door Service and how to configure application security groups. We’ll round out the course by covering the configuration of remote access management via just-in-time access and we’ll cover tools that are used to configure baselines. By the time you complete this course, you should have a good understanding of how to implement Azure network security. We’d love to get your feedback on this course, so please give it a rating when you’re finished. If you’re ready to learn about implementing Azure network security, let’s get started.</p>
<h1 id="Azure-Virtual-Networks"><a href="#Azure-Virtual-Networks" class="headerlink" title="Azure Virtual Networks"></a>Azure Virtual Networks</h1><p>The Azure virtual network, or VNET, is the key piece of <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/introduction/">Azure security services</a>. A virtual network is really just a logical isolation of Azure’s cloud network that’s been carved out and dedicated to your specific subscription. Virtual networks allow you to securely connect many different Azure resources to one another and VNETs can also be connected to physical on-prem networks over the internet via site-to-site VPNs.</p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Microsoft Azure</a> also supports dedicated WAN link connectivity from Azure VNETs to on-prem networks through Azure’s ExpressEoute offering. With ExpressRoute, the connection between Azure and the on-prem site uses a dedicated connection that does not ride over the public internet. This creates a more secure and more robust connection between an Azure virtual network and the physical on-prem network.</p>
<p>It’s important to note that a virtual network is scoped to a single Azure region, which is a set of datacenters deployed within a latency-defined parameter. Each virtual network consists of one or more subnets, which is a range of IP addresses within the virtual network itself. Subnets, just like the virtual networks they’re a part of, are also scoped to a single Azure region. </p>
<p>It’s also important to note that each virtual network is isolated from other virtual networks. When you create a virtual network, you can specify a private IP address space for it using both public and private addresses. Azure then assigns resources in the virtual network a private IP address from the address space that you assign. By using subnets, you can subnet the virtual network which allocates just a portion of the virtual network’s address space to each subnet. You can even configure a virtual network to use a custom DNS server for name resolution instead of using the default Azure provided name resolution.</p>
<p>In the next lesson, we’ll talk a little bit more in detail about <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/ip-addresses-subnets/">IP addresses and subnets</a>.</p>
<h1 id="IP-Addresses-amp-Subnets"><a href="#IP-Addresses-amp-Subnets" class="headerlink" title="IP Addresses &amp; Subnets"></a>IP Addresses &amp; Subnets</h1><p>Resources like VMs and load balancers that live on a virtual network require unique IP addresses, just like any resource on a physical network.</p>
<p>In Azure, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/azure-virtual-networks/">virtual networks</a> use two types of IP addresses: private and public.</p>
<p>A private IP can be either dynamically or statically allocated to a VM from the range of IP addresses that’s been defined for a given virtual network. These addresses are then used by resources to communicate with one another. Public IPs allow Azure resources to communicate externally with resources that do not reside on the virtual network. Public IPs are assigned to the virtual adapter of a VM or to the front end of a load balancer.</p>
<p>Public IP addresses can also be used within Azure-only virtual networks. When used in this fashion, the IPs within the virtual network will only be routable within the network itself. They will not be reachable from the outside.</p>
<p>The IP addresses that are dynamically assigned to VMs and other services within an Azure virtual network are determined by the IP addressing scheme that’s deployed. This process of IP range planning is not all that different than how you would plan the addressing scheme of a physical network.</p>
<p>As mentioned earlier, a virtual network can be subdivided using subnets. Each subnet consists of its own range of IP addresses that fall within the address space defined for the parent virtual network.</p>
<p>You use subnetting to mask the details of the internal network organization from external routers. It also makes it easier to segment the hosts within a network and to more effectively apply network security.</p>
<h1 id="Virtual-Private-Networks"><a href="#Virtual-Private-Networks" class="headerlink" title="Virtual Private Networks"></a>Virtual Private Networks</h1><p>Virtual private networks, or VPNs, are used to extend physical on-prem networks into <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. To be honest, you can even use VPNs to connect separate virtual networks. For example, you can use a site-to-site VPN to connect an Azure virtual network to a virtual network in AWS or even GCP.</p>
<p>For a more robust connection between an on-prem network and Azure, you can use what’s called ExpressRoute instead of a VPN connection. Using ExpressRoute allows you to create a connection to an Azure virtual network without requiring your traffic to traverse the internet.</p>
<p>Whether you use a site-to-site VPN connection or ExpressRoute, you can allow all on-prem users to access Azure resources and services as if they’re physically located on-prem within your own datacenter.</p>
<p>In cases where you need to allow an individual user to connect to an Azure virtual network, you can even use a point-to-site VPN. This type of VPN connection is similar to solutions like FortiGate or Cisco AnyConnect. In the next lesson, I’m going to show you how to connect two networks using a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/connecting-networks-with-a-site-to-site-vpn/">site-to-site VPN connection</a>.</p>
<h1 id="Connecting-Networks-with-a-Site-to-Site-VPN"><a href="#Connecting-Networks-with-a-Site-to-Site-VPN" class="headerlink" title="Connecting Networks with a Site-to-Site VPN"></a>Connecting Networks with a Site-to-Site VPN</h1><p>Hello everyone! And welcome back. In this demonstration, I’m going to walk you through the process of creating a route-based site-to-site VPN connection. What we’re going to do here is connect my vNet-Azure virtual network to my on-prem network, using a route-based site-to-site VPN.</p>
<p>In my on-prem network, I have a public-facing VPN device with an IP address of 40.79.70.195. On my VPN device, I’ve configured a pre-shared key. I’ll use that same pre-shared key when I setup the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/virtual-private-networks/">VPN in Azure</a> here.</p>
<p>To begin the VPN setup, I need to deploy a virtual network gateway in Azure. This virtual network gateway will serve as the Azure endpoint, so to speak, of the VPN connection. However, before I create a virtual network gateway, I need to create a gateway subnet within the vNet-azure virtual network.</p>
<p>The gateway subnet doesn’t have to be large, since it’s only going to host a couple of VPN-related resources that Azure automatically deploys under the covers when creating the virtual network gateway. These resources that Azure deploys cannot be seen, nor can they be managed by me. Because they’re used by the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure platform</a> itself to create the VPN connection. </p>
<p>To kick things off, let’s go ahead and create our gateway subnet. Now, like I mentioned, this subnet can be very small. Only a handful of available IPs are necessary, so we’re going to use a &#x2F;27 range. It’s important to note that the gateway subnet that I define must fall within the network address space that’s defined for the actual vNet. And I should also point out that it can’t overlap any other subnets within my virtual network.</p>
<p>Now, since my virtual network address space for this vNet is 10.1.0.0&#x2F;16, and I already have a subnet of 10.1.0.0&#x2F;24, what I’m going to use is 10.1.255.0&#x2F;27 for my gateway subnet.</p>
<p>So, let’s go ahead and create the gateway subnet by clicking the plus Gateway subnet link here at the top. You’ll notice my gateway subnet is automatically named GatewaySubnet, and I can’t change this. This name tells Azure to recognize the subnet as my gateway subnet. So, let me just configure the address range here so it reflects my chosen range of 10.1.255.0&#x2F;27. I can leave the rest of the settings here at their defaults and we’ll go ahead and click OK here. But before I do that, I do wanna mention, you never ever want to assign a network security group to your gateway subnet. Just keep that in mind. So we’ll go ahead and click OK here.</p>
<p>So we now have the gateway subnet deployed. With my gateway subnet deployed, I can begin the deployment of my virtual network gateway. I should point out that the creation of the gateway can take upwards of 45 minutes to complete, so what I’ll do here is show you how to create it. And then we’ll then cut away and come back once it’s deployed.</p>
<p>The virtual network gateway that I deploy here is going to use this gateway subnet that I provisioned. So, let’s get this virtual network gateway deployed. In the portal here, what I’m going to do, on the left side, is create a resource here. And then I’ll search for Virtual Network Gateway. And then from the search results here, I’ll click virtual network gateway. And then from this Virtual network gateway blade, I have to click Create here to begin the process. And what this does is open the virtual network gateway blade. And then from this blade, I need to fill in the values for my gateway.</p>
<p>I’m going to call my gateway GW-Azure. And what I’m going to is deploy into my VPNDemo resource group. However, you’ll see here I can’t select a resource group until I select a virtual network. And that’s because it needs to be in the same resource group. So what we’ll do here, is we’ll select the region where my vNet-Azure virtual network is. And it’s in East US 2. And then what we’ll do, is we’ll filter on our networks, and select vNet-Azure. And then we can see here the resource group is derived from the virtual networks resource group.</p>
<p>Now, as I mentioned earlier, I’m going to create a route-based VPN. You see we have two options here. If I hover over here on this icon, I can see that this option allows me to choose a route-based VPN if I plan to use point-to-site, inter-virtual network, or multiple site-to-site connections. If I was going to create a VPN to coexist with an ExpressRoute gateway or if I need to use IKEv2, I could also use a route-based gateway. A Policy-based VPN supports only IKEv1.</p>
<p>For this VPNDemo here, I’m going to create a route-based VPN. And what we’re going to do is deploy a Basic SKU here. Now hovering over Generation here, we can see that we can choose a generation of VPN gateway. Now that being said, Basic and the VPN GW1 SKUs are always supported on Generation1 only. So that’s all we’re going to leave it at here.</p>
<p>Now down here, I need to either create a new public IP for my gateway or use an existing one. Now for this demo, I’m going to create a new public IP. This public IP is going to be the IP that my on-prem VPN device is going to communicate with. So we’ll go ahead and create a new one here. And we’ll call it PublicIP-GWAzure. Now I can only enable active-active mode when I use one of the more advanced SKUs, so I don’t have the option available to me here. That said, I would really only enable active-active mode if I was creating an active-active gateway configuration. And I’m not doing anything with BGP in this demo, so I’ll leave BGP ASN disabled as well. Now if I hover over the icon for BGP here, I can see that BGP ASN can only be configured with route-based VPN gateways that are supported on SKUs of VPN GW1, 2, or 3, so it wouldn’t even be supported for my basic SKU anyway.</p>
<p>So at this point, I need to click Review and Create here to run validation. Now after the validation passes, and I can see it in the green bar here, I can click Create here to deploy my gateway. Now, this can take up to 45 minutes to complete, so what I’ll do here is pause the video and then we’ll return when it’s completed.</p>
<p>Okay, welcome back. Now that the virtual network gateway has been created, I need to create an endpoint in Azure that represents the on-prem VPN device. To do this, I need to create what’s called a local network gateway.</p>
<p>To create the local network gateway, I need to click create a resource up top here. And I’ll go ahead and search the marketplace for Local network gateway. And from the list of results here, I’ll select it. And then we’ll create it.</p>
<p>Now when this Create local network gateway page opens, I’m going to give my gateway a name. I’m going to call it GW-OnPrem. And then what I need to do is provide the public IP address of the on-prem VPN device. Now, in this exercise, the public IP of my on-prem VPN device is 40.79.70.195.</p>
<p>Now, in this address space field here, I need to tell Azure what network address ranges that this local network represents. Now, I can add multiple address space ranges here, but for this exercise, I’m simply going to add 10.101.0.0&#x2F;16, which is the only address range for my on-prem network.</p>
<p>Now what Azure will do is route traffic to the address range through the on-prem VPN device IP address. I only have to configure the BGP settings here if I’m using BGP. Since we aren’t doing that here, I’ll leave this option alone.</p>
<p>I also have to specify the subscription and resource group where I’m deploying these resources. And the location here is the same as Region in other settings. So what I need to do is choose where I want my local gateway to be created. So what I do is I’ll select my VPNDemo resource group here. And it’ll go in the East US 2. So at this point, I can create my local gateway here by clicking Create at the bottom. And let me go back into my resource group here for my VPNDemo. And we’ll wait for our local gateway to complete deployment here, which takes a few minutes. It’s not as long as the virtual network gateway.</p>
<p>Alright, so now that I have my gateway subnet, my virtual network gateway, and my local network gateway created, at this point, I need to configure my on-prem VPN device and create the actual VPN connection between the on-prem environment and my Azure network.</p>
<p>To configure my on-prem VPN device, regardless of what type it is, I need to specify the shared key that the Azure virtual network gateway and that on-prem device are going to use to establish connectivity. I also need the Public IP address of my virtual network gateway in Azure.</p>
<p>To get this public IP address via the portal, I can just browse to my virtual network gateway here, and then identify the public IP address. So let’s go back to our VPNDemo resource group here.</p>
<p>Now, to configure the VPN device, I’m going to need to download a configuration script for that device. Now before I get that configuration script, I need to create the site-to-site VPN connection between the virtual network gateway and my on-prem device. To do this, I need to open the page for my virtual network gateway. And then from here, I can go to Connections under Settings. We can see we have no current connections. But what I’m going to do here, at the top, I’m going to click Add button here. And then from here, I can configure the values for my connection.</p>
<p>Now I have to give my connection a name and I need to choose a connection type here. So we’ll just call this Azure-OnPrem. Now, I can’t change the Virtual network gateway because I’m connecting from this gateway. And then my connection type is going to be site-to-site. Now, from here, I need to choose the local network gateway. And this is the one that I created. This local gateway represents the on-prem VPN device. And then the shared key here is the shared key value that I used to configure my VPN device. They need to match. So I’ll type this in here.</p>
<p>We can leave our IKE set to IKEv2. And then we can go ahead and click OK. I can see my new connection here. And the status will switch from things like Unknown to Connecting to Successful to Connected, depending on the status of the connection. What I can do here is click on my connection here to see more details.</p>
<p>Now, at this point, I need to download the configuration script for whatever on-prem VPN device I’m using. Now, to do this, I can click the Download Configuration link at the top and then from here I can specify my on-prem device. So let’s assume we’re using a Cisco ASA. And we can download the configuration.</p>
<p>Now, when I download my script, it comes down as a text file. After downloading it, what I need to do is open it and then search for the keyword “REPLACE” within this text file. And then what I need to do is provide any parameters that need to be added to my script. So if we do Edit, Find, excuse me, Find, Replace. We can see different information regarding our specific device. And then we would fill this information in as necessary. And then what I could do is save my script and use it to configure my on-prem VPN device so that it can connect.</p>
<p>Now I’m not going to get into the configuration of the on-prem device because that process is different for every device, and frankly, Microsoft really doesn’t care that you know how to configure a Cisco VPN device. Suffice it to say though, once I’ve taken this script and configured my on-prem VPN device, I can then verify my VPN connection. So let me hop away here. And I’ll go ahead and configure my VPN device. Give me a moment. And then we’ll come back and we’ll check our connection.</p>
<p>So my on-prem VPN is now configured. And since I’m already on the Connection page here, what I’ll see here normally is that my connection is showing Connecting. After a few moments, this will go to Succeeded and then to Connected. So let’s give it a few moments here. And as you can see now, we now show a successful connection. So at this point, you now know how to create a route-based site-to-site VPN in Microsoft Azure.</p>
<h1 id="Intro-to-the-Azure-Front-Door-Service"><a href="#Intro-to-the-Azure-Front-Door-Service" class="headerlink" title="Intro to the Azure Front Door Service"></a>Intro to the Azure Front Door Service</h1><p>The Azure Front Door Service is an offering from Microsoft that allows you to define, manage, and monitor the global routing for web traffic. It optimizes for best performance and offers instant global failover for high availability. Azure Front Door allows organizations to transform their multi-region apps, both consumer and enterprise grade, into high-performance applications, APIs, and content that can reach a global audience through <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>.</p>
<p>Azure Front Door works at Layer 7, the HTTP&#x2F;HTTPS layer. By leveraging the anycast protocol with split TCP and Microsoft’s global network, it improves global connectivity. When properly configured, Azure Front Door will route client requests to the fastest and most available application backend, which is defined as any Internet-facing service hosted inside or outside of Azure.</p>
<p>Front Door offers several traffic-routing methods and backend health monitoring options to choose from. That being the case, it meets the needs of many different applications and automatic failover models. Like Azure’s Traffic Manager offering, Azure Front Door is resilient to failures, including the failure of an entire Azure region.</p>
<p>Azure Front Door accelerates app performance by ensuring end users connect to the nearest Front Door Point of Presence when accessing the application. The Front Door Service uses smart health probes to monitor the backends for latency and availability. When a backend goes down, the app is instantly and automatically failed over.</p>
<p>Through URL-based routing, Azure Front Door allows organizations to route traffic to backend pools based on URL paths of the requests. You can even configure more than one website on the same Front Door configuration. What this does is offer you the ability to configure a more efficient topology for app deployments.</p>
<p>By leveraging session affinity, Azure Front Door allows you to keep a user session on the same application backend. Front Door managed cookies ensure that subsequent traffic from a user session gets directed to the same application backend for processing. Session affinity is useful in situations where session state is saved locally on the backend for a user session.</p>
<p>Front Door also supports SSL termination at the edge. What this means is that individual users can establish SSL connections directly with Front Door environments rather than establishing those connections with the application’s backend. One caveat of the Front Door Service is that when you use it to deliver content, you must use a custom domain if you wish to have your domain name visible in the Front Door URL. I should also note that Front Door also supports HTTPS for custom domain names.</p>
<p>Other features of Azure Front Door include things like custom web application firewall rules, URL redirection, URL rewrite, IPv6 and HTTP&#x2F;2 protocol support.</p>
<p>In the next lesson, I’m going to show you how to create and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-and-configuring-azure-front-door/">configure Azure Front Door</a>.</p>
<h1 id="Creating-and-Configuring-Azure-Front-Door"><a href="#Creating-and-Configuring-Azure-Front-Door" class="headerlink" title="Creating and Configuring Azure Front Door"></a>Creating and Configuring Azure Front Door</h1><p>Hi everyone, welcome back. In this demonstration, I’m going to show you how to create a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/intro-to-the-azure-front-door-service/">Front Door</a> profile. I’m going to use two instances of web app, each running in different Azure region, which I’ve already deployed. The first instance is called MyAppEast01 and the second is MyAppWest01.</p>
<p>What I’m going to do here is add a frontend host for Front Door, and then add an application backend and backend pools. I’ll then add a routing rule so my Front Door can route traffic to my web apps.</p>
<p>So, let’s create a Front Door configuration that will direct traffic based on the lowest latency between two backends that I’ll set up. What I’m going to do here to get started is click Create a resource over here in the left. And then from the Networking category, what I’m going to do is select Front Door. Now let’s specify my resource group here. And I think I put everything in myRG. And everything goes in my Lab Subscription. Now you’ll notice I can’t select a location here. That’s because the location is locked to wherever my resource group is deployed.</p>
<p>With my basic Front Door information provided, I now have to define the frontend host for my configuration. Now, because this is going to result in a publicly-accessible domain name, the hostname of my Front Door needs to be unique across the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> landscape. If it’s not unique, Azure’s going to tell me as much.</p>
<p>What I’m going to do is create my frontend and call it MyAzFD01. Now what I could do here if I wanted to is enable sessions affinity and even a web application <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-and-configuring-microsoft-azure-firewall/">firewall</a>. For this demo, I’ll leave these at their defaults.</p>
<p>Now clicking Add here, what this does is create the frontend for my Front Door. At this point, I need to configure my application backends in a backend pool. This tells Front Door where my application lives.</p>
<p>To do this, I need to click the little plus icon here in the Backend pools pane. And then I have to specify a name for my backend pool. So I’ll call it simply BackendPool. Now, clicking on Add a Backend here lets me add my websites that I created earlier. The backend host type lets me specify what the host’s type is for my backend.</p>
<p>I have a couple of different options here. I’m going to choose App Service here since my web apps are app service apps. I then have to choose my Azure subscription that contains my websites. And like I said, everything’s in the Lab Subscription. And then from here, I can choose the first website from the dropdown.</p>
<p>We can see I have West01 and East01. I can leave the remaining fields as they are for now and then I’ll click Add. Now what I’m going to do here is repeat the process to add my second website. Now, although I can choose to update the Health Probes here and configure the load balancing for my backend pool, the default values will work for this exercise. So I’ll leave them at their default.</p>
<p>And then from here, I’ll click Add to finish up my backend config. At this point, I need to add a routing rule. To do this, I have to click the little plus icon here again in the Routing Rules pane. What this does is map my frontend host to my backend pool that I just created. Essentially, what I’m doing here is telling my configuration to forward incoming requests from my frontend to my backend pool.</p>
<p>I’m going to call my rule DefaultRouting. The Accepted Protocol field here allows me to specify which protocols will be allowed for the rule. You can see here that the frontend hosts field defaulted to my only configured frontend already.</p>
<p>Notice here that the default pattern to match is &#x2F;*. This means all traffic that hits the root of my site, or anything below it, will match the rule.</p>
<p>Now, since we aren’t doing any redirecting of traffic, we’ll leave the Route Type set to Forward so that it forwards my traffic to my back end. The Backend pool dropdown here shows where my traffic will go. We can see it’s going to my backend pool.</p>
<p>Now, the Forwarding Protocol here refers to the protocol to use for forwarding requests to the backend or to match from the incoming request. What I’m going to do here is set this to match the request. So the request that comes in is http, it’s going to forward http. By changing to https, I could forward it on as https. I’ll just match the request as it comes in.</p>
<p>We’re going to leave URL Rewrite and Caching disabled since we don’t need either feature here. And then, what I’ll do is I’ll click Add here to add the routing for my Front Door. And now with everything configured, from here, what I can do is click on Review and Create. And this will validate my Front Door configuration.</p>
<p>Now, when it passes validation, I can click Create to begin the deployment. So, with my Front Door created now, I can access it by going to a web browser and browsing to its URL. In this case, what I’ll do is I’ll go to the resource here. The URL of my Front Door is https&#x2F;&#x2F;myazfd01.azurefd.net. And what I’ll do here is open this in an incognito window. Now what happens is that my request is automatically routed to the backend that’s nearest to me, and it will failover in the event one of my backends goes down. So, with that, you’ve learned how to deploy and configure Azure Front Door.</p>
<h1 id="Intro-to-Network-Security-Groups"><a href="#Intro-to-Network-Security-Groups" class="headerlink" title="Intro to Network Security Groups"></a>Intro to Network Security Groups</h1><p>Network security groups are used to filter network traffic to and from <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> resources in an <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/azure-virtual-networks/">Azure virtual network</a>. When you create a network security group, that group will contain security rules that allow or deny inbound network traffic to or outbound network traffic from many types of Azure resources.</p>
<p>A network security group can contain many security rules as you require or it can contain zero security rules. Each rule defined within a network security group requires a unique name within the security group, a priority, a source or destination, a protocol, a direction, a port range, and an action.</p>
<p>The priority is a number between 100 and 4,096. This priority determines the order in which rules are processed. Rules with lower priority numbers are processed before those with higher numbers and once traffic matches a specific rule, processing of remaining rules stops.</p>
<p>When you define a source or destination for a security rule, what you are doing is telling the rule whether the destination is an individual IP address, any IP address, a CIDR block, a particular service tag, or an application security group.</p>
<p>The protocols that you can configure within a security rule include TCP, UDP, ICMP, or Any, and as far as directions go, you can configure security rules to apply to either inbound or outbound traffic.</p>
<p>When defining a security rule, you can specify an individual port for it to apply to or you can specify a range of ports. For example, you can specify something like port 443 or you can specify a range like ports 10,000 to 11,000.</p>
<p>Defining ranges allows you to create fewer security rules, since you don’t have to create an individual rule for each port.</p>
<p>The action that you define for a security rule can be either allow or deny. This determines what happens when the rule is matched.</p>
<p>In the next lesson, I’m going to show you how to create a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-a-network-security-group/">network security group</a> and how to configure a security rule.</p>
<h1 id="Creating-a-Network-Security-Group"><a href="#Creating-a-Network-Security-Group" class="headerlink" title="Creating a Network Security Group"></a>Creating a Network Security Group</h1><p>Hi, everyone, and welcome back. What I want to do here in this lesson is quickly show you how to create a network security group, so let’s jump right in.</p>
<p>I’m logged in to my Azure portal here and what I want to do is choose the hamburger up here in the top-left. And after I click it, I can click Create a resource here. What I need to do is choose Networking and then, I’m going to select the Network security group option here. I could also search for it in the Marketplace.</p>
<p>Now, from here, I need to tell <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> which subscription I want to deploy to and into which resource group. So let me select my resource group here and I’ll deploy into my lab subscription.</p>
<p>I need to give my network security group a name, so I’m going to call it MyNSG, and then, what I’ll do here is I’ll deploy into Central US.</p>
<p>Now, if I wanted to tag my network security group, I could click the Next Tags down here at the bottom, and typically, you would use tags to further break out or group resources. I’m not going to tag anything here, so what I’ll do is just click Review and Create.</p>
<p>Now, at this point, Azure validates the information I’ve supplied. We can see that it passed validation by looking at the green stripe here, so let’s launch the deployment by clicking Create down here. What I’ll do here is click Go to resource and with my network security group created, I can now create a custom rule for it. I’ll show you how to do that in the next <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/network-security-rules/">demonstration</a>.</p>
<h1 id="Network-Security-Rules"><a href="#Network-Security-Rules" class="headerlink" title="Network Security Rules"></a>Network Security Rules</h1><p>Hi, everyone, and welcome back. Before I show you how to create network security rules within a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-a-network-security-group/">network security group</a>, I just wanted to quickly run through an overview of the different options that are available when configuring a rule. On the screen here, I’m on the page of my network security group, where I can view the security rules for MyNSG. As you can see here on the screen, this security group only contains the default set of rules that’s created when the group is created. If I want to create inbound rules, I need to click over here on the Inbound Security Rules option. I would click on Outbound Security Rules to create an outbound rule.</p>
<p>Clicking on Add opens up the new rule blade. Now, in this source box here I have a few different options. I can set my source to Any, Application security group, IP addresses, or Service tag. If I select Application security group here, I’m prompted to select one or more existing application security groups. If I select IP addresses, I can specify either source IP addresses, or entire CIDR ranges. I can specify a single value, or a comma-separated list of multiple values. For example, I could specify multiple values like 10.0.0.0&#x2F;16 and then separate it with a comma and then an individual address, 192.168.0.0.</p>
<p>Now, I should point out that if I specify an IP address of an Azure VM here, I need to ensure that I specify the private IP address and not the public IP address that’s assigned to the VM. This is because security rules are processed after Azure translates the public IP to a private IP for inbound security rules and before <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> translates a private IP to a public IP for outbound rules.</p>
<p>Now, if I select Service tag here, I can then select one service tag. These service tags are predefined identifiers for different categories of IP addresses. They include things like HTTP, RDP, storage, load balancers, you name it. There are really too many options to list here, so I do suggest that you play around with this to see all the different options.</p>
<p>Now, for the source port ranges field here, I can specify a single port like port 80. Now, I can also specify a range of ports like 1024, for example, through 1200. I can even specify a comma-delimited list of port ranges, or even ports. For example, I can do port 80,443,3389 and then I can even do like 1000 to 1200. So, I can use comma-delimited lists as well.</p>
<p>Now what I can also do, and if you see down here at the bottom, the recommended value. The recommended value for source port ranges is * or Any, and this is because port filtering, as Microsoft notes here, is typically used with a destination port. So, we can leave this at * for Any as well.</p>
<p>The destination field offers me some additional options here. I can select Any, IP Addresses, Virtual Network, or Application security group. As was the case up here with source, if I select Application security group, it’s going to ask me to specify a defined security group. I don’t have any configured here, so it’s telling me as much right here. And then of course, if I specify an IP address here, the same rules apply in my destination IP addresses CIDR ranges as applied up here in my source IP addresses and CIDR ranges.</p>
<p>As was the case in the source, if the IP address that I specify is assigned to an Azure VM, I need to make sure that I specify the private IP, not the public IP, assigned to that VM for the same reasons I mentioned up here.</p>
<p>Now, selecting virtual network here for destination, which is actually a service tag. What this means is that traffic is allowed to all IP addresses within the address space of the specified virtual network. Now, selecting virtual network here, which is actually a service tag, means that traffic is allowed to all IP addresses within the address space of the virtual network. The destination port ranges option allows me to specify a single value or a comma-separated list of values that specify the destination ports that I’m allowing traffic to.</p>
<p>The protocol option here allows me to select Any protocol, TCP, UDP, or ICMP. So, I can filter down on what protocols I’m allowing. And then, of course, the action field determines the result of matching the rule. I can choose to either allow or deny.</p>
<p>Priority allows me to provide a value between 100 and 4,096. This has to be unique for all security rules within the network security group. Security rules are processed in priority order and what that means is, the lower the number, the higher the priority.</p>
<p>Microsoft actually recommends that you leave a gap between priority numbers when you create your rules. So for example, instead of setting priorities of one, two, and three, use values like 100, 200, and 300. Leaving gaps makes it easier to add rules in the future without juggling priority values.</p>
<p>Then when you create a rule, the name for the rule needs to be unique within the network security group. It can be up to 80 characters in length and it must begin with a letter, or a number, end with a letter, number, or underscore, and it can only contain letters, numbers, underscores, periods, or hyphens. Essentially no spaces. And, of course, the description here is optional. We don’t have the little red star here telling us it’s mandatory.</p>
<p>So now that you have an idea of what all is involved in creating a rule, we’ll jump into the next lesson where I’ll show you exactly how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/configuring-security-rules-in-an-nsg/">create a new rule</a>.</p>
<h1 id="Configuring-Security-Rules-in-an-NSG"><a href="#Configuring-Security-Rules-in-an-NSG" class="headerlink" title="Configuring Security Rules in an NSG"></a>Configuring Security Rules in an NSG</h1><p>Hi, everyone, and welcome back. In this lesson, I’m going to show you how to configure <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/network-security-rules/">network security rules</a> within a network security group.</p>
<p>To get started, I’m going to click on the network security group that we just created. We’ll add a security rule to it. For this exercise, I’m going to add an inbound security rule.</p>
<p>Now, to do so, I simply choose Inbound security rules option under Settings. I could also create outbound security rules as well. This pane here shows all of the existing configured inbound and outbound security rules that are configured for this network security group. You’ll see these default rules shown here since a collection of rules is automatically created when the network security group is created.</p>
<p>So what I’ll do is click on inbound security rules here and what I’m going to do here is create my new rule by clicking Add. I’m going to open up port 80 from anywhere using this rule.</p>
<p>So what this is going to do is allow anything on the internet to hit whatever is protected by this network security group over port 80. Now, since I’m opening 80 up from anywhere, I’m going to choose Any as my source. I’ll enter port 80 here in the Source port ranges field and then, selecting Any in the destination field allows port 80 to anything this network security group is applied to. And then, what I’ll do is I’ll change my destination port range from 8080 to straight 80 and I’ll leave the protocol selection set to Any and the Action option to Allow. We’re allowing this traffic. I’ll just accept the default priority and I’ll call my rule allow_port_80.</p>
<p>Now, we’ll see at the bottom here, we get a notification that the recommended value for source port ranges is * because port filtering is mainly used with the destination port. So what we’re going to do, if we change this back to the recommended value, I just wanted to show you how this affects things, we then see the warning go away. So what that means is you typically perform your filtering on the destination rather than the source.</p>
<p>Now, I’m not worried about a description here, so I’ll just leave this blank. And what I’ll do here is click Add to add my rule and I’ll go ahead and refresh my screen here. And we can see allow_port_80 is now listed in the inbound security rules of MyNSG.</p>
<p>So at this point, I can associate my network security group with a subnet that it should protect. Now, to do this, I would simply select Subnets here under the Settings option and then, from here, I can click Associate. And then, what I’ll do here is I’ll select a virtual network that I wanna protect, select my subnet, and we’ll OK it. So at this point, any resources that are connected to or will be connected to my protected subnet will now be reachable on port 80.</p>
<h1 id="Intro-to-Microsoft-Azure-Firewall"><a href="#Intro-to-Microsoft-Azure-Firewall" class="headerlink" title="Intro to Microsoft Azure Firewall"></a>Intro to Microsoft Azure Firewall</h1><p>Hi everyone, and welcome back. Azure Firewall is a cloud-based network security service that is designed to protect <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/azure-virtual-networks/">Azure Virtual Network</a> resources. It’s fully stateful and features built-in high availability as well as unrestricted cloud scalability.</p>
<p>Using Azure Firewall, organizations can centrally create application and network connectivity policies across subscriptions and networks. Because Azure Firewall uses a static, public IP address for the virtual network resources behind it, it permits outside firewalls to identify traffic that comes from the protected virtual network. Because Azure Firewall is fully integrated with <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Monitor, organizations can also perform logging and analysis against it.</p>
<p>Azure firewall offers several key features, including built-in high availability, availability-zone spanning, unrestricted cloud scalability, application FQDN traffic-filtering rules, and network traffic-filtering rules. Other features of Azure Firewall include things like: support for FQDN tags, service tags, and threat intelligence. You can even associate up to 100 different public IP addresses with an Azure Firewall.</p>
<p>To see a complete and detailed list of all Azure Firewall features, visit <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/firewall/overview">the URL</a> that you see on your screen.</p>
<p>In the next lesson, I’ll show you how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-and-configuring-microsoft-azure-firewall/">create and configure Azure Firewall</a>. So hop over there, and let’s get started.</p>
<h1 id="Creating-and-Configuring-Microsoft-Azure-Firewall"><a href="#Creating-and-Configuring-Microsoft-Azure-Firewall" class="headerlink" title="Creating and Configuring Microsoft Azure Firewall"></a>Creating and Configuring Microsoft Azure Firewall</h1><p>Hello, everyone, and welcome back. In this lesson here, we’re going to create and configure <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/intro-to-microsoft-azure-firewall/">Azure firewall</a>. To prepare for this demonstration, I’ve already set up a virtual network and a few subnets that we’re going to use. This vNet-FirewallDemo virtual network is the virtual network we’re going to work with. Within this virtual network, I’ve created two subnets. I did this to simulate a production environment.</p>
<p>The first subnet is called subnet-workloads. The second subnet is called subnet-jump. In the workloads subnet, I have a VM called PROD01, this PROD01 can simulate an app server or a file server or whatever the case might be. Now I’ve configured PROD01 without a public IP and I’ve configured the public inbound ports for it to none.</p>
<p>In my jump subnet, I also have a VM running, this VM is called JUMP01. And it’s going to serve as my jump box to access my PROD01 in the workloads subnet. The address range for the subnet workloads subnet is 10.0.2.0&#x2F;24. The address range for subnet-jump is 10.0.3.0&#x2F;24.</p>
<p>So with our lab environment explained here, let’s get into the deployment of Azure firewall.</p>
<p>To start our configuration, we need to create a subnet with a specific name. We need to create a subnet called AzureFirewallSubnet within our <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/azure-virtual-networks/">virtual network</a> here, this subnet will house our firewall.</p>
<p>So we’ll go ahead and create my sub net and I’m not going to do a play-by-play here because I assume you already know how to do this. What I’m going to do here is give this a range of 10.0.1.0&#x2F;26. And this is because Microsoft recommends a size of &#x2F;26 for the firewall subnet.</p>
<p>Okay, so we have our firewall subnet here with our range of 10.0.1.0&#x2F;26. With our firewall subnet created, we can deploy our firewall into the vNet-FirewallDemo virtual network. To do this, I’m going to click Create a Resource from my portal page here and I’m just going to search for firewall and then we’ll select it from the list. We’ll go ahead and create.</p>
<p>Now, from this Create page, I’m going to configure my new firewall that we’re deploying here. I need to make sure that I’m deploying into my intended subscription and into the resource group I intend. So we’ll go ahead and select our DemoRG. I’m going to call my firewall, simply MyFirewall. And then I’ll set my region to the same as my other resources, which is Central U.S., and I’m not worried about high availability here. So I’ll leave the availability zone set to none for this exercise here.</p>
<p>Now, in this, choose a virtual network here. What I need to do is either create a new virtual network for this firewall or use an existing one. So we’re going to use an existing one. We’ll select our vNet-FirewallDemo and then what I need to do is specify a public IP address. Now, I can either create a new one or select an existing one. So bear with me here while I create a new one. Just going to call it PublicIP-FW.</p>
<p>Now, I should point out here that the SKU section here for my public IP needs to be standard and it needs to be static. And we can see here that these are already set for us. So we’ll okay this and now what I’ll do is click Review and Create here to create the firewall. And then we’ll go ahead and create it. And this deployment can take a few minutes to finish. So we’ll let this run and then we’ll come back and do our configuration.</p>
<p>So with the deployment complete, I can click on Go to Resource here to see my firewall details. Now I need to note the private IP here, because I’m going to use this later on when I create my default route. Now my default route is going to send all traffic from the workload subnet through the firewall. To create my default route, what I’m going to do is browse to All Services here. And then what I’m going to do is browse to Networking and then I’m going to choose Route tables. And then I can either click Create Route Table or Add and we’re going to create a new route table and we’ll call it MyRouteTable.</p>
<p>We’re going to deploy into my lab subscription and into my demo resource group. Location again will be Central U.S. and if we planned to associate this route table to a subnet in a virtual network that’s connected to an on-prem network through a VPN gateway, disabling propagation would cause our on-prem routes to not propagate to the network interfaces in our subnet. We’re going to leave propagation enabled here. And then with all my choices made, I can click Create.</p>
<p>Now once it’s been deployed, and it takes a few moments, I can refresh here and see my new route table. Let’s go ahead and refresh here. And we can see my route table’s now showing up. So now what I need to do is associate my table with my virtual network. So I’ll click my route table here, and then select subnets. We can see there are currently no subnets associated with the route table, so we’ll click Associate here. And then from here, I will select my vNet-FirewallDemo virtual network. Now the subnet that I choose here is going to be my workload subnet. Then we’ll Okay it.</p>
<p>Next, I need to click on Routes, and then click Add. This is where I’m going to define my actual route that sends all traffic through the firewall. I’m going to call my route DefaultRoute. For address prefix, I need to type 0.0.0.0&#x2F;0, since I’m sending all traffic through this route. The next hop type here should be set to virtual appliance. And this is because my next hop is Azure firewall. Now you might be saying to yourself, I thought Azure firewall was a service, it is but for this exercise, it’s seen as a virtual appliance.</p>
<p>Now for the next hop address, I need to provide the private IP address for my firewall. Remember, we noted this earlier, At this point, I can click Okay. And this adds my route to my route table.</p>
<p>So now that we have our default route configured, what we’re going to do is create an application rule that allows outbound access to <a target="_blank" rel="noopener" href="http://www.cloudacademy.com/">www.cloudacademy.com</a>. Essentially, what we’re doing is locking everything down to just cloudacademy.com. To do this, we’re going to browse to our firewall. Let’s go back out, to home, go to our firewall here. And then what we’re going to do is go to Rules under Settings here. And since we’re setting up an application rule, we’ll choose the Application Rule Collection tab. And then under the Application Rule Collection tab we’ll click Add Application Rule Collection.</p>
<p>We’re going to call our collection here, MyAppCollection. And what we’ll do here, is give it a priority of 200. Since we want to allow traffic, we’re going to select Allow here for our action. And now under rules, we want to target FQDNs. So what we’ll do is we’ll provide a name for our new rule, and we’ll call it AllowCloudAcademy.</p>
<p>For source addresses, we need to specify what network is allowed to reach Cloud Academy. So for this exercise, we’re going to allow the workload subnet, the 10.0.2.0&#x2F;24. And for protocols, we’ll allow HTTP and HTTPS. And then of course, for the target FQDNs, we’re going to target <a target="_blank" rel="noopener" href="http://www.cloudacademy.com/">www.cloudacademy.com</a>. And then what I’ll do, is I’ll add my rule here.</p>
<p>Okay, so now I’ve shown you how to create a route table, a default route, and an application rule. Now what I’m going to do is show you how to create a network rule. The network rule we’re going to create allows outbound access to two different IP addresses on port 53, which is DNS. Because we’re going to need DNS to resolve the cloudacademy.com domain name. </p>
<p>To create our network rule, we need to select the Network Rule Collection tab. Now from here, we’ll choose the option to add a network rule collection and we’ll call this NetworkCollection. Again, we’ll set our priority to 200 and we’re going to allow our traffic. At this point, we need to define our rule. So under IP addresses, under the Rule section here. For our name, we’re going to call it AllowDNS. We’ll choose UDP for the protocol since DNS is UDP traffic. For this source address here, we’re going to set the source to our workload subnet which is 10.0.2.0&#x2F;24. And then we’re going to specify Google’s public DNS servers of 8.8.8.8 and 8.8.8.4 for our destinations and then we can use a comma here. And for destination ports here, we’ll use Port 53, because that’s what DNS operates over. Then we’ll go ahead and click Add.</p>
<p>So what we just did was create a rule that allows DNS traffic through our firewall, but only to Google’s public DNS servers. And we’ll let this rule appear here, and then we’ll move on to the next step. Okay, so now our new rule is in place. So to test things out, we need to configure the primary and secondary DNS servers that our virtual machine is going to use. Now, just to be clear, this isn’t an Azure firewall requirement, we’re just doing this because it’s a test environment and we’re testing things out here in a demo.</p>
<p>So what I’m going to do is browse to the network interface for our PROD01 virtual machine. So let’s go back here into this network interface here, the PROD01739 network interface here is the NIC for PROD01. So we’ll select our NIC here. And what we’re going to do is change the DNS servers to custom and specify Google’s servers here. And we’ll save it.</p>
<p>Now once this updates, what I’ll do is I’ll go out to my PROD01 VM here and we’ll start him up. We’ll let this VM come up and then what we’ll do is we’ll test our rules to make sure everything’s working the way it’s supposed to.</p>
<p>So our PROD01 is running, but we can see we have no public IP address here. So we can’t RDP to it directly and this was by design. So what we’re going to do is go out to our JUMP01 box here that I deployed. And he is in the process of starting up, we’re going to connect to our JUMP01. And then from there, jump over to PROD01. So we’ll go ahead and connect here, now that it’s running. And I’m just connecting off-screen here. And I’ll drag this into my live screen.</p>
<p>Now I’ll minimize this and remember, we’re going to connect to PROD01 and that’s 10.0.2.4. All right, so JUMP01 is up here. Let’s launch our RDP console here or RDP client, I should say. And these are some slower lab machines so bear with me here. So the first test we’re going to do here is see if we can actually RDP to our PROD server from JUMP. And it does appear that it’s going to let me so now that I’m on my PROD01 VM, I can launch a browser here and try to browse to cloudacademy.com. What we’ll do here is we’ll minimize and open Chrome here. And what we’ll do is we’ll browse to <a target="_blank" rel="noopener" href="http://www.cloudacademy.com/">www.cloudacademy.com</a>. And you can see we’ve actually hit the page.</p>
<p>Now, the reason we have a mess here with no styling is because our firewall is blocking all traffic to everything but cloudacademy.com. So a lot of the styling is coming from an outside site or like a CDN. Now, if I try to go to, for example, microsoft.com, I can’t even get to the site and it tells me that the request is denied because there’s no rule matched. So we can see that I was allowed to hit Cloud Academy but wasn’t allowed to hit microsoft.com, I’m blocked by the firewall. This confirms that my firewall rules are working. It confirms that I can only browse to the allowed FQDN and it confirms that DNS access to Google’s DNS servers is working as well. Otherwise, I wouldn’t have been able to resolve the names. So with that, you now know how to create a route table, a default route application rules, and network rules. You now know how to create and configure an Azure firewall.</p>
<h1 id="Intro-to-Application-Security-Groups"><a href="#Intro-to-Application-Security-Groups" class="headerlink" title="Intro to Application Security Groups"></a>Intro to Application Security Groups</h1><p>Hi, everyone. Welcome to Application Security Groups. Before I get into showing you how to create and configure application security groups, I just wanted to give you a brief overview of what they are and what they do. </p>
<p>So what exactly are application security groups? An application security group is a grouping of virtual network interfaces that is used to configure network security for the virtual machines that the NICs are attached to. Using an application security group allows you to define network security policies based on the group that you define. You can even reuse your defined security policy at scale without the need to manually maintain a list of included IP addresses.</p>
<p>While application security groups offer a more streamlined way to secure applications running on VMs, they do come with some constraints.</p>
<p>For example, you are limited to 30,000 application security groups that can be defined within a subscription. In addition, you can specify only one application security group as the source and destination when configuring a security rule. You are not allowed to specify multiple application security groups in either the source or destination.</p>
<p>Also, when configuring an application security group, all network interfaces that are assigned to the group must exist within the same <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/azure-virtual-networks/">virtual network</a> as the first network interface that is assigned to the application security group. For example, if you create an application security group and the first NIC that you assign to is connected to vNet1, all subsequent NICs assigned to the group must also be connected to vNet1. You can’t add NICs from different virtual networks to the same application security group.</p>
<p>Lastly, if you specify an application security group as the source and destination in a security rule, the NICs in both groups must exist within the same virtual network. So, for example, if you define a group called Group1 that contains NICs from VNet1 and then, you define another group called Group2 that contains NICs from VNet2, you can’t assign Group1 as the source and Group2 as the destination in a rule that you define because all NICs for both the source and destination application security groups need to exist in the same virtual network.</p>
<p>In the next lesson, I’ll show you how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-an-application-security-group/">create an application security group</a>.</p>
<h1 id="Creating-an-Application-Security-Group"><a href="#Creating-an-Application-Security-Group" class="headerlink" title="Creating an Application Security Group"></a>Creating an Application Security Group</h1><p>Hi everyone, and welcome back. In this lesson, I’m going to show you how to create an <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/intro-to-application-security-groups/">application security group</a>. So let’s jump right in.</p>
<p>To get started, I need to click Create A Resource up here in the left corner of the portal. What I’ll do here is search for Application Security Group. And then I’ll select Application Security Group from the results. When I click Create here, the Create an Application Security Group blade appears.</p>
<p>From here, I need to specify a new or existing resource group for my application security group. So I’ll put this in my DemoRG. I need to name my security group. So what I’ll do here is call it MyAppSecurityGroup. And what I’ll do here is deploy into the Central US region. Now what’s important to know about this region is that the application security group needs to be in the same region as any VMs that you plan to protect. So if you have VMs in the East region, then you would select the East region. I’m just going to select Central US here.</p>
<p>Now, from here, I can click either Next to do any tagging that I wanna do or I can simply do the Review and Create and begin the process. So we’ll go ahead and click Review and Create. And what it does here is validate my settings. And I can click Create to create my application security group.</p>
<p>So now that we have our deployment complete, we’ll go to our resource here. And we can see we have our application security group. Now you’ll notice there’s not a whole lot of configuration that can be done here. And that’s because an application security group is really just a logical collection of virtual machines, or really the NICs that are attached to those virtual machines. What you do is join virtual machines to the application security group and then use the application security group as a source or destination in network security group rules.</p>
<p>Now, I’m going to bounce out to my DemoRG here. And take a look at one of my virtual machines here. If we look at the Networking blade of my VM here, we see that there’s an option here for application security groups.</p>
<p>Now, this option here is related to the network interface of the VM. Clicking this option allows me to select which application security group that this virtual machine’s NIC should join. So if I click the Configure the application security groups button here, I can then select the dropdown and select my application security group and save it.</p>
<p>Now, with my settings saved and committed here, I can see that under our network interface for the PROD01 virtual machine, I now have my app security group listed as one of the application security groups.</p>
<p>Now, with my application security group created, what I could now do, if I go back to my DemoRG here, is I can <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-a-network-security-group/">create a network security group</a>. And what I’m going to do is show you where I could create some rules that would allow me to specify my new application security group. I’ll just call this testnsg. And we’ll deploy into Central.</p>
<p>So let’s go to our resource here. And now I’m in my network security group. If I select, let’s say, for example, inbound security rules. If I create a new rule, I can now select a source here, specify application security group, and now I have my application security group listed.</p>
<p>Now, what this does, in turn, is configure the network security group rule to apply to any associated virtual machine NICs that are a part of this application security group. So that’s how you do it. There’s not a whole lot involved in creating and configuring an application security group. And hopefully, after watching this video, you now have an idea of all that’s involved.</p>
<h1 id="Managing-Access-to-Resources-with-JIT-Provisioning"><a href="#Managing-Access-to-Resources-with-JIT-Provisioning" class="headerlink" title="Managing Access to Resources with JIT Provisioning"></a>Managing Access to Resources with JIT Provisioning</h1><p>Hi, everyone. Welcome back. In this lesson, I want to talk a little bit about just-in-time provisioning. Just-in-time provisioning is used to lock down inbound traffic to Azure virtual machines. By using just-in-time provisioning, you can ensure that only those who need access to your VMs get access, but that they only get access when it’s needed. This reduces exposure to attacks while providing access to connect to virtual machines only when needed.</p>
<p>Just-in-time provisioning is useful for protecting against brute-force attacks. Such attacks will often target management ports as a means to gain access to a virtual machine. When a brute-force attack is successful, the attacker can take control of a VM and establish a foothold in your environment.</p>
<p>Just-in-time provisioning protects against brute-force attacks by limiting the amount of time that the ports for a VM are open. Protecting virtual machines via Just-in-Time VM Access reduces the amount of time that an account has access privileges and it increases visibility into the use of such privileged accounts. To enable Just-in-Time VM Access for virtual machines, you need to create a policy that determines which ports to protect, how long those ports need to remain open, and any approved IP addresses that can access those ports. By creating such a policy, you can maintain control over what users can do when they request access.</p>
<p>Access requests are also logged in the Azure activity log. This allows you to monitor and audit access. You can then easily identify existing virtual machines that have Just-in-Time VM Access enabled, as well as any virtual machines where Just-in-Time VM Access is recommended.</p>
<p>To leverage Just-in-Time VM Access, you need to be in the Standard pricing tier of Azure Security Center. In the next lesson, I’ll show you how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/configuring-just-in-time-access-to-a-vm/">configure just-in-time access for a virtual machine</a>.</p>
<h1 id="Configuring-Just-in-Time-Access-to-a-VM"><a href="#Configuring-Just-in-Time-Access-to-a-VM" class="headerlink" title="Configuring Just-in-Time Access to a VM"></a>Configuring Just-in-Time Access to a VM</h1><p>Hello everyone, and welcome back. Now that we’ve touched on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/managing-access-to-resources-with-jit-provisioning/">just-in-time access</a>, let’s walk through the process of configuring just-in-time access for a VM. Now, you can do this in one of two ways. You can do this right from the VM’s properties blade by going into Settings and then Configuration, or you can do it from Security Center. For this demonstration, I’m going to show you the Security Center option.</p>
<p>To do this from Security Center, we’re going to open the Security Center dashboard. Now, from the Security Center dashboard, in the left pane here, what we need to do is click on Just in time VM access. And if we scroll down here, it’s under the Advanced Cloud Defense area here.</p>
<p>Now, when this just in time access window opens, if just in time access isn’t already enabled, you’ll receive an option here to enable it. Now, if it’s already enabled, like it is here, you’re presented with information on the state of existing virtual machines. A status of Configured indicates a VM that’s been configured to support just in time VM access. The data for the last week is shown, and it includes info for the VM.</p>
<p>If we go to Activity Log here, we can see information. This would typically include information on the number of approved requests, last access date and time, and last user. We haven’t done anything with this VM, so this activity log is pretty barren.</p>
<p>If we go back and we look at Recommended, the Recommended status for VMs indicates that the VM listed here can support just in time VM access, but that it also hasn’t been configured yet. So the VMs listed here are VMs that are recommended for just in time VM access, but I haven’t configured them yet.</p>
<p>Now, when a status of No recommendation is shown here, and I got two here that show this, this indicates that the VM listed is not recommended for just in time access.</p>
<p>Now, the reasons for this can vary. Most commonly this is due to a network security group not being in place for the VM because the just in time solution requires a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/intro-to-network-security-groups/">network security group</a> to be in place first.</p>
<p>Now, what I’m going to do here is click the Recommended tab, and under the virtual machines here, I’m going to select this EX1 virtual machine here, and I’m going to enable it.</p>
<p>Now, notice the check mark here. And what I’m going to do is enable just in time. Now, clicking that enable just in time displays the default ports that are recommended by Azure Security Center. Now, however, I could also configure custom ports as well, by clicking the Add button here. But for this demonstration, I’ll accept the default ports.</p>
<p>For each port that I want to configure, I can customize quite a few things here. I can customize the protocol type, which is the protocol that’s allowed on this port when a request is approved. I can also customize the allowed source <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/ip-addresses-subnets/">IPs</a>, which specifies the ranges that are allowed on this port when that request is approved. And I can also customize the maximum request time. This refers to the maximum time window during which a specific port can be opened.</p>
<p>I’m going to close this here. And then if I click Add here, I could add additional ports that I want to configure for this access. I’ll close this out. Now, when I’m happy with my settings, all I do is click Save and this saves my configuration. And with that, we can see that just in time access is configured for my virtual machine.</p>
<h1 id="Tools-for-Configuring-Security-Baselines"><a href="#Tools-for-Configuring-Security-Baselines" class="headerlink" title="Tools for Configuring Security Baselines"></a>Tools for Configuring Security Baselines</h1><p>Hello, everyone, and welcome back. Let’s talk a little bit about security baselines. Microsoft Azure doesn’t monitor for, or respond to, any security incidents that are considered to be within the customer’s area of responsibility. Instead, Azure provides tools like Azure Security Center that are intended for this purpose. Although Microsoft makes every effort to make every service as secure as possible by default, there is no way to predict how each customer will use each service. That being the case, you really need to review these security controls to ensure that they mitigate risks adequately.</p>
<p>Every <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure service</a> comes with a default baseline that is already designed to provide security for most common uses. However, each customer is responsible for creating its own set of baselines to ensure adequate protection.</p>
<p>Now, because every environment is different, I’m not going to try telling you how to create a security baseline, because what I tell you might not fit your specific environment. Instead, we’re going to talk a little bit about the tools that are available to you for configuring security baselines.</p>
<p>Let’s start with the Azure Portal and Azure Resource Manager. These tools are most useful for creating resources and for applying access controls to those resources. These tools can also be used to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/introduction/">secure virtual networks</a> and to configure backups and disaster recovery options.</p>
<p>Azure Key Vault can be used to encrypt virtual drives as well as PaaS storage and databases. Azure Active Directory provides the identity management platform that’s used to apply access controls to resources within Azure. It’s also used to manage hybrid identity services.</p>
<p>Azure Policy is used to secure virtual networks and to restrict allowed types of resources. It can also be used to enforce geo-regional restrictions. Using Security Center, organizations can monitor the security health of networks and resources, and to detect malicious activity. Security Center also preemptively detects vulnerabilities. And like Azure Security Center, Azure Monitor can also be used to detect malicious activity within your environment.</p>
<p>Understanding these tools and how to use them will allow you to create security baselines that fit your organization.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>I hope you’ve enjoyed learning about <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/introduction/">implementing Azure network security</a>. Let’s review what you’ve learned.</p>
<p>In this course, you learned about virtual network connectivity, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/connecting-networks-with-a-site-to-site-vpn/">how to configure site-to-site VPNs</a>, and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-a-network-security-group/">how to configure network security groups</a>.</p>
<p>As you progressed through the course, you learned about <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/creating-and-configuring-microsoft-azure-firewall/">Azure firewall configuration</a> and about the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-azure-network-security/intro-to-the-azure-front-door-service/">Azure Front Door Service</a>. You also learned how to configure application security groups.</p>
<p>Rounding out the course, you learned how to configure remote access management with just-in-time access and about what tools you can use to configure baselines.</p>
<p>To learn more about implementing Azure network security, you can, and should, read Microsoft’s published documentation. Be sure to also watch for new Azure courses on Cloud Academy because we’re always publishing new courses. Please give this course a rating and if you have any questions or comments, please let us know. Thanks for watching and happy learning!</p>
<h1 id="12Intro-to-Microsoft-Azure-Firewall"><a href="#12Intro-to-Microsoft-Azure-Firewall" class="headerlink" title="12Intro to Microsoft Azure Firewall"></a>12<strong>Intro to Microsoft Azure Firewall</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/firewall/overview">Azure Firewall overview</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Managing-Azure-Data-Protection-and-Security-Compliance-12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Managing-Azure-Data-Protection-and-Security-Compliance-12/" class="post-title-link" itemprop="url">AZ-500-Managing-Azure-Data-Protection-and-Security-Compliance-12</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:37" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:37-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:12:20" itemprop="dateModified" datetime="2022-11-20T19:12:20-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Managing-Azure-Data-Protection-and-Security-Compliance-12/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Managing-Azure-Data-Protection-and-Security-Compliance-12/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><p>Welcome to Managing Data Protection and Security Compliance in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. My name is Thomas Mitchell, and I’ll be teaching you about the data protection and security compliance features within the Microsoft Azure environment. I am an Azure content author at Cloud Academy and I’ve had over 25 years of IT experience. Several of those with Cloud technologies. If you have any questions feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. This course is intended for people who want to become certified Azure architects. This course maps closely to the data protection and security compliance learning objectives of Microsoft’s 70-533 exam. To get the most from this course, you should have a general understanding of Microsoft Azure. We will get started by covering the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/creating-and-importing-encryption-keys/">creation and import of encryption keys</a> with Key Vault. And then work through how to prevent and respond to security threats, using the Azure Security Center. After that we’ll talk about configuring access to SaaS applications with Single Sign-On, and how to manage access to those applications. We will wrap up by covering the process of configuring federation with public consumer identity providers such as Facebook. By the end of this course, you should be able to manage encryption keys with Key Vault, manage security in Azure, configure and manage application access, and set up federation with third-party identity providers. We’d love to get your feedback on this course, so please give it a rating when you’re finished. If you’re ready to learn about some cool Azure functionality and how to use it, let’s get started.</p>
<h1 id="Creating-and-Importing-Encryption-Keys"><a href="#Creating-and-Importing-Encryption-Keys" class="headerlink" title="Creating and Importing Encryption Keys"></a>Creating and Importing Encryption Keys</h1><p>The Azure Key Vault protects cryptographic keys and secrets that are used by cloud applications and cloud services. With the Key Vault, you can encrypt keys and secrets with HSM-protected keys. HSM, by the way, stands for hardware security modules. Keys and secrets that you can encrypt with the Key Vault include such items as storage account keys, data encryption keys, .PFX files, authentication keys, and even passwords. Leveraging Key Vault allows you to streamline the key management process, allowing you to maintain control of keys that are used to access and encrypt your data. Developers and resource owners can create specific keys for access to development environments within minutes. As a matter of fact, the keys created for development can then be seamlessly migrated to production keys, if necessary. Security administrators, of course, can control access to keys by granting and revoking permissions to them. Keys in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Key Vault can be used for signing and verifying data, protecting other keys, and for encrypting and decrypting data.</p>
<h1 id="Adding-a-New-Software-Protected-Key-to-the-Key-Vault"><a href="#Adding-a-New-Software-Protected-Key-to-the-Key-Vault" class="headerlink" title="Adding a New Software-Protected Key to the Key Vault"></a>Adding a New Software-Protected Key to the Key Vault</h1><p>If you want the Azure Key Vault to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/creating-and-importing-encryption-keys/">create</a> a software-protected key for you, use the Add-AzureKeyVaultKey command. It’s a relatively simple command and only requires a few switches. As you can see on the screen, I’ve got my PowerShell session opened. I’ve connected to my <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> tenant already, and I have my Key Vault, called BlueWidgetKeyVault, already provisioned. To create the new key in the Key Vault, I’m going to run the Add-AzureKeyVaultKey command. And with it, I’m going to specify the name of the vault, the name that I want to call the key that I’m creating and whether I want to store the key as a software-protected key or an HSM-protected key.</p>
<p>The command that I ran here creates a key named MyFirstKey in the Key Vault named BlueWidgetKeyVault. And it adds it as a software-protected key as defined by the software value in the destination switch. If I wanted to store the key as an HSM-protected key, I would have specified HSM as the value for destination instead. To view the URI for my newly-created key, I just need to call the key ID that’s stored in the key variable from this command above. To do that, I simply type key.id. So essentially, I’m calling the ID attribute of the key variable.</p>
<p>When I hit enter here, the URI of my first key is returned. This URI is significant because the keys created or uploaded to the Azure Key Vault are referenced by URIs. The fact that we can retrieve the key’s URI tells us that the key creation has actually been successful. We can further confirm the existence of this newly-created key by running the Get-AzureKeyVaultKey command and specifying the BlueWidgetKeyVault and MyFirstKey. So what I’ll do here is copy this command into my session here, as you can see, we’ve got Get-AzureKeyVaultKey and we’re simply specifying the name of the key and the vault name.</p>
<p>When we hit enter here, you can see that the command confirms that my MyFirstKey is stored in the vault. Now, the only required switch is VaultName when we run this command. However, by specifying that name switch up here, we can retrieve just the key that we’re interested in.</p>
<h1 id="Importing-an-Existing-Software-Protected-Key-into-Azure-Key-Vault"><a href="#Importing-an-Existing-Software-Protected-Key-into-Azure-Key-Vault" class="headerlink" title="Importing an Existing Software-Protected Key into Azure Key Vault"></a>Importing an Existing Software-Protected Key into Azure Key Vault</h1><p>In addition to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/adding-new-software-protected-key-key-vault/">creating new keys</a>, Azure Key Vault allows you to import existing keys as well. Since we’ve already worked through the process of creating a new key in the key vault, let’s work through the process of importing an existing software-protected key using the the Add-AzureKeyVaultKey command. In this demo, I’m going to walk you through this import process. I have here, in my keys folder, a software-protected key called swkey.pfx. This exported key is protected with a password. I used A123456z! to secure this key when I exported it from my workstation. To upload this key to my key vault in Azure, I first need to store this password in a variable using the ConvertTo-SecureString command. I can then access the key and import it from the PFX file into my key vault. </p>
<p>As you can see on the screen here, I’m converting the exported keys password to a secure string and storing it in the secure pfxpwd variable. Hitting ENTER runs this command and it usually doesn’t do a whole lot. We’re just saving a value to a variable. However, when it finishes, I can then import the key from the PFX file by running the Add-AzureKeyVaultKey command that I’m going to paste into the PowerShell session right now. When importing a software-protected key using this command, we need to specify the KeyFilePath and the KeyFilePassword. The KeyFilePath switch references the path to the PFX file that we’re going to import. The KeyFilePassword is the secure password that we need to access the PFX file. That’s the password we stored up here in the secure pfxpwd variable. Hitting ENTER here will create the key and store it in the vault. </p>
<p>We can display the URI for this imported key by typing Key-ID at the PowerShell prompt. So we go ahead and type in our command here to pull up the URI for our newly imported key. Now as you can see here, the full URI references MyImportedPFX. The MyImportedPFX key is the name of the key that we imported in our command. Now to view the actual key, we need to use the Get-AzureKeyVaultKey command. I’m going to go ahead and paste that command into our window here. </p>
<p>And as you can see on your screen, this command is essentially identical to the one we used previously to view the newly created key, except in this case, we’re just specifying MyImportedPFX as our key that we’re interested in. You can go ahead and hit ENTER here and what it’s going to do is return some key attributes about our imported key. It’s going to tell us when it was created when it was updated, and it gives us the vault name along with the ID. Now, if we wanted to view the properties of this imported key or really any other keys in our key vault, we could go into our <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal, as you can see here on the screen, browse into our actual key vault here and select Keys. On the screen where you can see that the portal tells us we have two keys in our vault, MyFirstKey which we created and MyImportedPFX which we imported. </p>
<p>Clicking on either one of those pulls up properties for those keys. So with that said, let’s <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/preventing-responding-security-threats-azure-security-center/">move on</a>.</p>
<h1 id="Preventing-and-Responding-to-Security-Threats-with-Azure-Security-Center"><a href="#Preventing-and-Responding-to-Security-Threats-with-Azure-Security-Center" class="headerlink" title="Preventing and Responding to Security Threats with Azure Security Center"></a>Preventing and Responding to Security Threats with Azure Security Center</h1><p>With the prevalence of data breaches and high profile hacks nowadays, it’s critical to understand how to prevent and respond to security threats. As such, it’s important to know how to leverage the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Security Center. </p>
<p>The Azure Security Center provides centralized threat protection and security management across hybrid cloud workloads. By leveraging the Azure Security Center you can apply security policies across your workloads, limit your exposure to threats, and detect and respond to attacks. Through centralized policy management, compliance with company and regulatory security requirements is ensured. </p>
<p>Administrators can monitor the security of machines, networks, storage services, and more to uncover potential security issues. The Security Center can make recommendations on actions to take to remediate security vulnerabilities before they are exploited. By offering the ability to collect, search, and analyze security data the Azure Security Center provides administrators with a way to ensure the security of all workloads. </p>
<p>The Azure Security Center helps with meeting security requirements through the definition of security policies used to maintain the desired configuration of workloads. Policies defined in the Azure subscription can be adapted to the type of workload or to the sensitivity of the data being protected. Azure Security Center can also provide security recommendations for resources such as compute, networking, SQL, storage, and applications. In this demonstration, you will learn how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/configuring-security-policy/">configure a security policy</a> and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/assess-security-resources/">assess the security of Azure resources</a>. </p>
<p>To follow along with the steps in this demonstration, you must be on Security Center’s Standard pricing tier.</p>
<h1 id="Configuring-a-Security-Policy"><a href="#Configuring-a-Security-Policy" class="headerlink" title="Configuring a Security Policy"></a>Configuring a Security Policy</h1><p>Although security center automatically creates a default security policy for each of your <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> subscriptions, you’ll often find that you need to specially configure certain aspects of your policy. </p>
<p>To configure a security policy, log into the Azure portal and click on Security Center in the left pane. From the security center overview page, click Security Policy located under Policy and Compliance. From here, select the subscription that you want to manage. Now, in the top part of the screen here, we can see that I have one policy assignment configured and it’s my default policy. </p>
<p>Down here on the bottom half of the page, we can see which policies are enabled as part of this assignment. Hovering over each icon here will give you information about the specific security policy. To modify this policy assignment, what I need to do is click on the policy assignment up here at the top. From here, we can enable and disable each individual setting by selecting the dropdown box for each. </p>
<p>Now our choices here are typically enable, disable, and AuditIfNotExists. AuditIfNotExists enables auditing on a resource that matches the if-condition but doesn’t have the components specified in the details of the then-condition. If we scroll back up to the top here, we can even exempt specific resources from our policy assignment if we wish to. If we were to make any changes here, we would just need to scroll back down to the bottom here and click the Save button to save our changes. Now, we’re not making any changes here so I’ll just click Cancel here. </p>
<p>What security center does is assess the configuration of your environment on a continuous basis and when a vulnerability is detected, security recommendations are generated based on the settings you make here. As recommendations become available in the security center dashboard, you can begin <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/assess-security-resources/">assessing the security</a> of your individual resources.</p>
<h1 id="Assessing-Security-of-Resources"><a href="#Assessing-Security-of-Resources" class="headerlink" title="Assessing Security of Resources"></a>Assessing Security of Resources</h1><p>Based on the security policies that are enabled, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/protect-your-resources-azure-security-center/">Security Center</a> provides a set of security recommendations as needed. </p>
<p>Assess resource security by reviewing the recommendations made. Generally, starting with virtual machines and applications. To do this, browse to the Security Center dashboard. Ensure overview opens and then click compute and apps under resource security hygiene. From this overview tab, you can review all recommendations by severity with anything in red being high severity. While some recommendations can be remediated directly from Security Center, other recommendations have only guidelines to apply the remediation such as the missing disc encryption recommendation. You can see here it offers remediation steps and instructions.</p>
<p>Click through each recommendation to see how each issue can be remediated. To dig down further into the recommendations, you can browse each of these tabs here along the top. Clicking on VMs and computers reveals recommendations that are specific to virtual machines and computers while the VM scale sets tab reveals recommendations for any scale sets within your subscription. </p>
<p>As you can see here, you can do the same for cloud services, app services, containers and compute resources. The compute resources tab reveals recommendations for things like event hubs, automation accounts, service busts and other compute resources. After addressing all recommendations for compute and apps, move onto networking by clicking networking under the resource security hygiene section. </p>
<p>As was the case with compute and apps, the networking recommendations page defaults to the overview page. This page presents you with a clickable network topology map that shows risky resources in the subscription. You are also presented with information on adaptive network hardening. When you click the adaptive network hardening tile, you’re presented with information about overly permissive network security groups as well as network security rules along with recommendations for hardening them. </p>
<p>Going back out to the overview page allows you to click the VNet tab to see recommendations that are specific to individual virtual networks. After remediating outstanding network issues, move onto IoT hubs and resources and then onto data and storage. The data and storage page contains recommendations revolving around auditing for <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> SQL servers and databases, storage accounts, write as cache, Data Lake analytics and Data Lake store. Obviously, if these workloads don’t exist in your environment, you won’t see any recommendations for them. </p>
<p>Just like the other resource recommendations, some data and storage recommendations will provide integrated remediation options while some other recommendations will not. Continue working through each recommendation and remediate them as you progress until all outstanding issues are resolved. </p>
<p>In this demonstration, you learned about the assessment of your workloads with Security Center. You learned how to assess security for compute, apps, networking, scale sets, SQL, storage, IoT and application resources.</p>
<h1 id="Protecting-Your-Resources-with-Azure-Security-Center"><a href="#Protecting-Your-Resources-with-Azure-Security-Center" class="headerlink" title="Protecting Your Resources with Azure Security Center"></a>Protecting Your Resources with Azure Security Center</h1><p>Azure Security Center leverages access and application controls to block malicious activity, limiting your exposure to threats. A feature of this protection called, just in time virtual machine access reduces your attack exposure by allowing you to deny persistent access to VMs.</p>
<p>With just in time VM access, you provide controlled access to virtual machines only when it’s needed, and this controlled access is also audited. Another feature called Adaptive Application Controls help you harden virtual machines against malware by controlling the applications that can be run. <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/protect-your-resources-azure-security-center/">Azure Security Center</a> uses machine learning to analyze the processes that are running on a virtual machine and allows you to apply whitelisting rules using this intelligence.</p>
<p>In the next lesson, you’ll learn how to configure a just in time <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/manage-vm-access/">VM access policy</a>.</p>
<h1 id="Managing-VM-Access"><a href="#Managing-VM-Access" class="headerlink" title="Managing VM Access"></a>Managing VM Access</h1><p>Just in time VM access can be used to lock down inbound traffic to your <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> VMs, reducing exposure to attacks while providing easy access to connect to the VMs when needed. Management ports for a virtual machine don’t need to be open all the time. They only need to be open while you are connected to the VM and performing management tasks. When just in time is enabled, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/protect-your-resources-azure-security-center/">security center</a> uses network security group rules to lock down access to the management ports. This greatly reduces the attack surface of the virtual machines. To manage access to your virtual machines using just in time, browse to the security center main menu which is what you see here on the screen. From here you’ll want to select just in time VM access under the advanced cloud defense section. </p>
<p>So let’s scroll down here to advanced cloud defense and here we’ll see just in time VM access. From this pane just in time VM access provides information on the state of your virtual machines. VMs that have been configured to support just in time VM access are listed under the configured heading. As you can see here I don’t have anything configured for just in time in my lab environment quite yet. VMs that support just in time VM access, but have yet to be configured are listed under recommended. As you can see here I have server 01 listed as a recommended virtual machine because I don’t have it protected with just in time VM access yet. Now VMs that are missing a network security group or that have had just in time specifically turned off are shown under no recommendation. Now one thing to note here is classic VMs are not supported by just in time so they too will be shown under no recommendation. </p>
<p>To enable just in time for a particular VM, select a VM from the recommended list and click enable just in time on one VM to configure a just in time policy for that particular VM. So as you can see here we have one server listed under the recommended tab so we’ll select server one and enable just in time. Now when just in time is enabled, you’re presented with the default port setting that security center recommends. You can either accept these defaults or you can add and configure a new port on which you want to enable the just in time solution. </p>
<p>In this demo we’re going to add a port by selecting the add option from the just in time VM access configuration pane here. After clicking add, we need to specify a port number we wish to configure access for. And we also need to configure the protocol type and the allowed source IP ranges. In addition a maximum request time that the specific port can be opened for is also necessary. So for this demonstration we’ll allow port 80 through our just in time. So we select port 80, we’ll do any protocol here and in this little section here for allowed source IPs there’s two options here, per request or site or block. </p>
<p>When you select per request here, what this means is the request for just in time access is made from the IP that the client is currently at. So for example if Joe in my office needs port 80 access to this machine, when he goes ahead and requests that just in time access, it’s gonna look at his specific IP and use that in the request. However if I wanted to allow access through this configuration to a specific range or a specific subnet or even specific IPs, I would select site or block here. What we’re going to do here is we’re going to allow the source IPs per request. And then the max request time here is three hours. </p>
<p>We can change this to one or five or 15 or whatever we wanna set it to. And this max request time essentially is how long is that access opened for that request. We’ll go ahead and click okay here and then once we’re done with that we’ll click save.</p>
<h1 id="Configuring-Access-to-SaaS-Applications-with-Single-Sign-On"><a href="#Configuring-Access-to-SaaS-Applications-with-Single-Sign-On" class="headerlink" title="Configuring Access to SaaS Applications with Single Sign-On"></a>Configuring Access to SaaS Applications with Single Sign-On</h1><p>When a user logs into an application, that user will go through an authentication process where he or she is required to prove that they are who they say they are. Unless a single sign-on is configured, this authentication process is typically completed by answering a password that is stored at the application. Users are required to know this password. To improve security, <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> AD supports single sign-on for securing applications. </p>
<p>As an admin, you can configure <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/using-federation/">federated single sign-on</a>, which allows applications to redirect to Azure AD for user authentication rather than prompting for its own password. Password-based single sign-on is another option available to admins when securing applications. With password-based single sign-on, the existing password process is retained. However, the administrator manages the password and the end user does not know it.</p>
<h1 id="Using-Federation"><a href="#Using-Federation" class="headerlink" title="Using Federation"></a>Using Federation</h1><p>To configure federated single sign-on for an application from the Azure AD gallery, you need to add the application from the Azure AD gallery, configure the URLs, select the user identifier that’s to be sent to the application during authentication, retrieve the Azure AD metadata and certificate, configure the Azure AD metadata values within the application itself and then assign users to the application. So there are quite a few things that have to happen to allow <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/configuring-access-saas-applications-single-sign-/">single sign-on</a> to work. We’ll walk through all of these steps one by one throughout the course of this demo, starting with the addition of the app from the Azure AD gallery. In this demonstration, we’re going to use Dropbox as the application that we’re going to enable single sign-on for. </p>
<p>What I’ve done prior to this demonstration is to sign up for a Dropbox account. It’s actually a Dropbox business account which allows single sign-on. To add an application from the Azure AD gallery, what you need to do is open the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal and sign in as a global administrator which I’ve already done here as you can see on your screen. From here we simply have to click on Azure Active Directory. Once in the Azure Active Directory, you go ahead and select enterprise applications. </p>
<p>To add a new application, you go ahead and click new application up at the top here and then you can search for your application. So we’re going to add and configure Dropbox as our chosen application here. After selecting Dropbox from the list, you can see here on the right-hand side that you can actually change the name of the application within your dashboard if you’d like to. We’re going to leave it as the default Dropbox for Business. We can add the application simply by clicking the add button. When we switch back to our enterprise applications list and refresh it, after a moment or two we should see Dropbox appear. </p>
<p>So now that the application’s been added, we need to set up the single sign-on for it by configuring metadata values within Azure AD. So to start configuring this application for single sign-on, we select the application from our list and then once this loads we can click on single sign-on from the application’s left hand navigation menu. As you can see it opens up as single sign-on disabled by default. We’re going to configure this application for SAML single sign-on. Now from this screen, we’re going to have to do some configuration. First and foremost we have to enter some of our URLs here for Dropbox. Now, these values typically come from the application itself. In the case of Dropbox for Business, we can get the sign-on URL which is listed here from our Dropbox for the Business portal by opening that business portal and clicking on copy link under the SSO sign-in URL. So what I’m going to do is switch over to my Dropbox portal and where I have the single sign-on setup screen here. </p>
<p>And this process will be different for each application because each application handles single sign-on differently. But to get my sign-on URL for Azure I’m going to go here under SSO sign-in URL and copy that link. I can then paste that into my sign-on URL field. We can leave the Dropbox identifier at the default and in our case we don’t need any advanced URL settings. So now that we’ve added our URLs we need to select the user identifier and attributes that are going to be sent to the application during the authentication process. So under user attributes what we do is we select a unique user identifier that is going to be passed to the application during authentication. Now an important note to keep in mind here is that the selected option here needs to match the expected value within the application in order to authenticate the user. So for example, if the application expects a user login of <a href="mailto:&#x66;&#x69;&#114;&#115;&#116;&#x2e;&#108;&#x61;&#x73;&#x74;&#x40;&#x64;&#111;&#x6d;&#x61;&#105;&#x6e;&#46;&#99;&#111;&#109;">&#x66;&#x69;&#114;&#115;&#116;&#x2e;&#108;&#x61;&#x73;&#x74;&#x40;&#x64;&#111;&#x6d;&#x61;&#105;&#x6e;&#46;&#99;&#111;&#109;</a> and you supply <a href="mailto:&#108;&#97;&#x73;&#116;&#x2e;&#102;&#x69;&#x72;&#x73;&#x74;&#64;&#x64;&#111;&#x6d;&#x61;&#105;&#x6e;&#46;&#x63;&#x6f;&#109;">&#108;&#97;&#x73;&#116;&#x2e;&#102;&#x69;&#x72;&#x73;&#x74;&#64;&#x64;&#111;&#x6d;&#x61;&#105;&#x6e;&#46;&#x63;&#x6f;&#109;</a>, authentication’s going to fail. </p>
<p>In our case, we’re going to use the user.mail attribute. So this tells SSO to pass the user’s email address when authenticating. And what we’ll do is make sure that our user’s email address matches the Dropbox login later on. So the next step in the process is to download the application metadata or certificate from Azure AD so that it can be supplied to the application in the application’s management portal. And just to explain that to you a little better, if we switch over to our portal, you can see here that I previously uploaded a certificate in preparation and we’ll upload another one, but this is where we’re going to upload it. </p>
<p>This allows for secure authentication. So to get our SAML sign-in certificate, we scroll down here to the SAML sign-in certificate section. However, you can see that no certificates have been configured yet. If a cert doesn’t yet exist, you can click create a new certificate to create a certificate and then save it. So we’re gonna create a new certificate here that expires in 2021 and we’ll click save. And then we’ll go ahead and make the new certificate active. Now we can’t quite download the certificate yet because we have to save this configuration. </p>
<p>However what I do want to note though is that although our Dropbox application requires a certificate, some applications may need the metadata XML instead. If so you have the option to download the metadata XML instead of the certificate by clicking right here. Now, this requirement is going to be application dependent. Of course here you have a notification email field and this is basically the email that you’re going to receive notifications on when the certificate comes up for renewal. </p>
<p>So to get this certificate into a state where we can download it, we’re going to save our configuration here. So with the configuration saved, the certificate now becomes downloadable so we’ll go ahead and download the certificate. So now that we have our certificate downloaded which we’ll use in a moment to upload it to our Dropbox account, we also have to get what’s called the Azure AD single sign-on service URL. That URL is this URL here in Dropbox and as you can see here this actually verifies members when they enter their credentials. Now to get that URL, we click on configure Dropbox for Business and if we scroll down here we can see the Azure AD single sign-on service URL is right here. And this is going to be specific to your application and your application instance so we’ll copy this URL. And we’ll add this into the sign-in URL for Dropbox. </p>
<p>So now that we have our sign-in URL configured in Dropbox, we can upload the new certificate as well. And this is the certificate we downloaded from Azure. We’re gonna turn off the Google sign-in. We don’t need Google. And with that we have our application configured. We don’t need anything else configured here. The identity provider sign-out URL is optional. We can click save here so now we have our application configured for single sign-on. Now we can finish up the single sign-on configuration in Azure. </p>
<p>So with the certificate downloaded from Azure and installed in our application and with the Azure AD single sign-on service URL copied and pasted into our application, we are now done with the configuration. So once we’re done with that configuration we have to go in and assign a user to our application to test access. So to assign a user to our application, it’s pretty straightforward. You can assign users directly to the app by clicking on the users and groups link here on the left and from here we simply click the add user button or link, whatever you wanna call it, and then we select which users we want to have access to this application.</p>
<p>In this case, we’re going to add my account as an assignment for this application and then we click select. And after clicking select we click the Assign button to assign the user to the application. So at this point, we have our Dropbox application configured for single sign-on and we have my <a href="mailto:&#x74;&#x6f;&#x6d;&#64;&#x74;&#x68;&#111;&#x6d;&#97;&#x73;&#109;&#105;&#116;&#99;&#104;&#x65;&#108;&#108;&#46;&#x6e;&#101;&#116;">&#x74;&#x6f;&#x6d;&#64;&#x74;&#x68;&#111;&#x6d;&#97;&#x73;&#109;&#105;&#116;&#99;&#104;&#x65;&#108;&#108;&#46;&#x6e;&#101;&#116;</a> user account assigned to the application. So what that means is after a few minutes I can use my user account to launch this application. And I’m going to launch it using federated single sign-on. </p>
<p>Now we can test this using the test SAML settings within the application here. Just click on single sign-on for the app that we’re working with and then test SAML settings. So although Microsoft recommends installing my app secure sign-on extension, we don’t need to do that just to test the authentication for our new single sign-on app. We can go ahead and click sign in to Dropbox for Business and as you can see here it gives me the prompt for single sign-on and that I’m about to use my Dropbox business account as <a href="mailto:&#x74;&#111;&#109;&#64;&#x74;&#104;&#x6f;&#x6d;&#x61;&#x73;&#x6d;&#105;&#x74;&#x63;&#x68;&#x65;&#x6c;&#x6c;&#46;&#110;&#101;&#x74;">&#x74;&#111;&#109;&#64;&#x74;&#104;&#x6f;&#x6d;&#x61;&#x73;&#x6d;&#105;&#x74;&#x63;&#x68;&#x65;&#x6c;&#x6c;&#46;&#110;&#101;&#x74;</a>. We can go ahead and click continue and Dropbox lets me in. So I’ve confirmed that my Dropbox application works with single sign-on and I’ve configured that the application within Azure is configured correctly with single sign-on as well.</p>
<h1 id="Using-Password-Based-Authentication"><a href="#Using-Password-Based-Authentication" class="headerlink" title="Using Password Based Authentication"></a>Using Password Based Authentication</h1><p>When adding an application from the Azure AD Application Gallery, you can configure authentication to leverage single sign-on. One of the single sign-on methods available is the password-based single sign-on option. Using password-based single sign-on is a great way to get an application integrated into Azure AD quickly. To configure a password-based single sign-on for an application, browse to the Azure portal, and sign in as a Global Administrator. </p>
<p>As you can see here, I’ve already done so. From within the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal, click on Azure Active Directory in the left navigation menu. In the blade that opens, select Enterprise Applications. For the purposes of this demonstration, we’re going to add GoToMeeting as an application, and we’re going to turn on password-based single sign-on. So we click Add to add an application and select GoToMeeting. You can go ahead and click Add. And from the there, the application is added. </p>
<p>When we go back into Azure Active Directory and into Enterprise Applications, we can see GoToMeeting listed. To configure password-based single sign-on for this application, we simply select the application and click single sign-on. As you can see, the application by default has single sign-on disabled. To enable single sign-on, change the dropdown to password-based sign-on, and click Save. Refreshing the screen will update the sign-on URL. As an administrator, you can also provide the app credentials on behalf of your users, by going into <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/adding-users-and-groups-applications/">Users and groups</a> and updating credentials for your users. </p>
<p>For example, I could go ahead and select Jen here, and update Jen’s credentials. And from the Update Credentials screen, I can enter Jen’s email address and password, that is used to access GoToMeeting, so when she authenticates to the GoToMeeting application, she doesn’t even need to know the login information. Clicking Save stores the credentials, and the next time Jen launches GoToMeeting from her application dashboard, the credentials will be presented and she won’t even have to know what they are. So as you can see, leveraging password-based single sign-on makes onboarding applications into a single sign-on environment rather straightforward.</p>
<h1 id="Adding-Users-and-Groups-to-Applications"><a href="#Adding-Users-and-Groups-to-Applications" class="headerlink" title="Adding Users and Groups to Applications"></a>Adding Users and Groups to Applications</h1><p>Before your users can access an application, they first need to be <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/assign-user-or-group-application/https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/assign-user-or-group-application/">assigned</a> to it. Until you assign your users to an application, they will not be able to access it via the application URL, nor will they be able to access the application via the user access URL. As a matter of fact, users will not even see the application appear on the application access panel nor on their mobile application. It also won’t appear on their Office 365 application launcher.</p>
<p>It’s essentially like the application doesn’t even exist as far as your users are concerned. As such, this demo will explain how to add users and groups to applications. There are three ways you can do this with <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Active Directory. You can assign a user directly to an application, you can assign a group directly to an application or you can enable self-service application access to allow users to find their own applications.</p>
<h1 id="Assign-a-user-or-group-to-an-application"><a href="#Assign-a-user-or-group-to-an-application" class="headerlink" title="Assign a user or group to an application"></a>Assign a user or group to an application</h1><p>As a global admin for the Azure Directory that has appropriate permissions to manage an Enterprise application, you can assign users to applications. The only caveat is that the Azure Active Directory must be Azure Active Directory Premium P1 or Premium P2. To assign one or more users to an application directly, browse to the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal as a global admin. We’ve already done that here as you can see on the screen. From here, open Azure Active Directory, and then select Enterprise applications. </p>
<p>Select the application that you need to assign. In this case, we’re going to assign box. And once it loads here, select <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/adding-users-and-groups-applications/">users and groups</a>. As you can see, we have no users or groups assigned to our box application yet. To do so, simply click the add user button at the top. And then from the add assignment blade, select users and groups. And then you can see all your users and groups that are available to you. In this case, I’m going to assign both the box users group that I created, and my own specific account to the application. Go ahead and click select. And from here, click assign. At this point, we’ve assigned our users and groups to the application. After a few moments, the users, and members of the groups that we added, should be able to launch the application that they have been assigned to.</p>
<h1 id="Enable-self-service-application-access"><a href="#Enable-self-service-application-access" class="headerlink" title="Enable self-service application access"></a>Enable self-service application access</h1><p>In addition to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/assign-user-or-group-application/">assigning users and groups</a> to applications directly, access can also be granted via self-service. Self-service application access allows users to self-discover applications. And you can allow the business group to manage the credentials signed to those users. Before your users can self-discover your application right from their access panels you need to enable self-service application access for those applications that you want to allow self-discovery for. </p>
<p>To enable self-service application access to a particular app launch the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal and sign in as a global administrator. We’ve already done that here. Once logged in as a global admin open the active directory extension and select Enterprise applications. From a list of applications enabled in your tenant click on the application that you wish to enable self-service for. Once it loads simply click self-service from the applications left-hand navigation menu. And select yes to allow users access this application. </p>
<p>After enabling self-service for the application select a group of users that should be able to request access to this application. In this case, we’re going to select Dropbox users. And from here we just click select. Now if business approval is required before users are allowed to access the application you can set the required approval before granting access toggle switch to yes. And in that case, you would select the approvers that would be enabled to approve access to this application. </p>
<p>If there are multiple roles within the application you can also select the role that users should be assigned within the application here. In our case, we only have the default access role. After making our selections here we click save. This point it will ask if we’re sure and we click yes. After you’ve completed the self-service application configuration your users can navigate to their application access panel and click on the add button. This will allow them to find the apps to which they’ve been allowed self-service. On the screen where I’m in my application access dashboard and what I can do is click add an app and as you can see we can now add Dropbox as an application via self-service.</p>
<h1 id="Revoking-Access-to-SaaS-Applications"><a href="#Revoking-Access-to-SaaS-Applications" class="headerlink" title="Revoking Access to SaaS Applications"></a>Revoking Access to SaaS Applications</h1><p>Removing a user’s or group’s access to an enterprise application is pretty straightforward. This, of course, assumes that you have appropriate permissions to manage the enterprise app and are a global admin for the directory. In the next demo, we will walk through the process of <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/remove-user-or-group-assignment-enterprise-app-azure-portal/">removing a user</a> who has been assigned access to an application.</p>
<h1 id="Remove-a-user-or-group-assignment-from-an-enterprise-app-in-the-Azure-portal"><a href="#Remove-a-user-or-group-assignment-from-an-enterprise-app-in-the-Azure-portal" class="headerlink" title="Remove a user or group assignment from an enterprise app in the Azure portal"></a>Remove a user or group assignment from an enterprise app in the Azure portal</h1><p>Removing a user or group assignment from an Enterprise application in the portal is as simple as adding it was. To remove a user assignment or a group assignment from an Enterprise app in the portal, sign into the portal with an account that’s a global admin for the directory.</p>
<p>I’ve done that already here. After logging in, select <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Active Directory on the left side and click on Enterprise applications. In our case, we assigned some users in groups to the Box application, so what we do to remove that access is simply click on the application we’d like to manage, select Users and groups and then remove our access. And there you have it. Removing access to an application is actually even a little bit easier than assigning it in the first place.</p>
<h1 id="Configuring-Federation-with-Public-Consumer-Identity-Providers"><a href="#Configuring-Federation-with-Public-Consumer-Identity-Providers" class="headerlink" title="Configuring Federation with Public Consumer Identity Providers"></a>Configuring Federation with Public Consumer Identity Providers</h1><p>Azure Active Directory B2C offers customer identity and access management in the cloud by integrating authentication with entities such as social accounts, emails, custom IDPs. <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> Active Directory B2C supports all platforms and open standards and allows you to customize the customer’s identity experience while meeting security, scalability and compliance needs. In the next demonstrations, we will walk through the process of integrating authentication with <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/facebook/">Facebook</a> and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/google/">Google</a>.</p>
<h1 id="Facebook"><a href="#Facebook" class="headerlink" title="Facebook"></a>Facebook</h1><p>Configuring sign up and sign on options to leverage Facebook is actually not terribly difficult. And really only consists of a couple key steps. First, you need to create a Facebook application and then, you need to configure Facebook as an identity provider in the Azure tenant. Lastly, you need to configure your application to leverage the actual authentication of Facebook. One key thing to note here is that using Facebook to login to applications does require an Azure active directory B2C Tenant. </p>
<p>The standard Azure active directory tenant doesn’t work, you need a B2C Tenant. In this demonstration, I’m going teach you how to configure a basic Azure web app to use Facebook for authentication. To prepare for this demo, I’ve already deployed An Azure active directory B2C Tenant and I also deployed a basic PHP web application in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. As we work through this demonstration, we’ll create the Facebook application first. We will then configure Facebook as an identity provider in the Azure tenant. </p>
<p>Lastly, we’ll configure the web app to use Facebook for authentication. for granting access to the application. Using Facebook as an identity provider in Azure active directory B2C requires you to first create a Facebook application and supply it with the proper parameters. As such, you’re going to need a Facebook account to do this. Now, to create a Facebook application, what you need to do is visit the Facebook for developers website and sign in with the Facebook account credentials. </p>
<p>You’re also going to need to register as a Facebook developer. To do this, you would simply visit the developer website and I’m going to switch over here, It’s actually developers.facebook.com and what you would do is you would click register, accept the policies and then complete the free registration. I already have a developer account so I don’t need to go through the registration process and to be honest, this particular demonstration isn’t about registering with Facebook it’s about Facebook as an identity provider within Azure. Once you’ve registered as a developer you need to start the process of creating a Facebook application. To do that, click My Apps here up in the upper right hand corner. And then click add new app. You’re going to need to provide a display name and a valid contact email address here. </p>
<p>So what we’ll do for our display name for our application, we’ll call it my demo application. And we’ll keep my throw away email here as my contact. Create the new app id, we simply click create app id. If you’re prompted to confirm that you’re not a robot, go ahead and confirm that you’re not a robot. After creating the app id, what you need to do is over in the left column click settings. And then basic. So in this configuration screen, we’re gonna make some changes to create our application. First thing we’re gonna do is select a category, and this category can be anything, but what I typically do is select business and pages. After selecting our category, you can scroll down to the bottom here and click on add platform. Since we’re creating this application to integrate authentication for a website, we’ll select website. In the site url field, enter the url of the web app and then what we’ll do is we’ll click save changes. </p>
<p>The url of the web app can be tracked down through the Azure dashboard by clicking on the application. As you can see here up in the upper right hand corner we have a url for our application. So we’ll copy this url and this gets pasted into the site url screen. At this point we can save our changes. After saving our changes, we’re presented with an app id and an app secret. We need to note both of these. To view the app secret we can click show and then we’re prompted to re-authenticate to Facebook. In addition to our app id and our app secret we also have to specify a privacy policy to conform with Facebook privacy policies. </p>
<p>Typically this would be a privacy policy page on the website that you’re giving people access to. For this demonstration, I’m just going to use my understandingazure.com just as a filler. From here we can click save. Next we need to add a product. The product we’re going to add is the Facebook login. So from the add a product screen, we click setup under Facebook login. Now instead of using the quick start here to configure the Facebook login we’re going to click settings underneath. On the client oauth settings screen, we need to provide valid oauth redirect URIs. And what these URIs do is prompt for a login when a person hits the website and isn’t logged in to Facebook and at the same time it also allows when a person is logged into Facebook to get the little prompt that says, we’re going to share your information with this application. </p>
<p>We’re going to do here is paste in two URLs here. As you can see here, the first valid oauth redirect URI is actually the url of the website with a trailing signin-facebook. The second URI that we’re going to enter is the same thing, we have the url to our application but we’re trailing it with a .auth&#x2F;login&#x2F;Facebook&#x2F;callback that’s the call back url. After adding the redirect URIs we click save. Now you can see up here, it’s hidden, it tells me that it’s actually saved. So we now have the application in Facebook created, however before the Facebook application is usable my Azure AD B2C it needs to be made publicly available. You can make the application publicly available by clicking app review on the left navigation here and setting the make my demo application public switch to yes. It will ask you if you’re sure and you can confirm it. </p>
<p>With the Facebook application created and configured you can figure Facebook as an identity provider in the Azure tenant, which is what we’re going to do now. With the Facebook application created and configured, we can now configure Facebook as an identity provider within the Azure Tenant. To configure Facebook as an identity provider what we do is, we switch over to the tenant and we browse to the B2C features blade in the Azure portal. From the B2C features blade here we simply click identity providers. </p>
<p>After clicking on identity providers, click add at the top of the screen here and provide a friendly name for the identity provider configuration. You may typically call this Facebook. Next, click on identity provider type and select Facebook from the list. And then click okay. At this you click setup this identity provider and then you need to supply the app id and app secret from the application in Facebook. We supply the app id and the app secret in their respective fields. Then we create and save the configuration by clicking okay and then create. </p>
<p>At this point, we now have Facebook configured as an identity provider within the tenant. With the Facebook application created and Facebook configured as an identity provider, the web app can now be configured to leverage Facebook authentication. To configure the web app to use Facebook for authentication, browse to the application in the resource group to which it’s been deployed. From our dashboard here, we’ll click our demo app. And from here, we click on authentication and authorization. Keep in mind this setting is listed under the settings subheader. From here we turn on app service authentication by switching the toggle to on. And to prevent anonymous access we change the option for action to take when request is not authenticated to login with Facebook. So what this will do is force authentication before allowing access to the web app. </p>
<p>Next we click Facebook here to configure it. Again we need to provide our app id and app secret from our Facebook application. We provide the app id and the app secret and click okay. Lastly, click save up top, to save the configuration. By saving this configuration, we complete the configuration of the web app to use Facebook for authentication. To test the login for the web app, browse to the web app and right click on the url that’s listed for the web app. What we’ll do here is open the link in an incognito window. </p>
<p>And what will happen here is the application will actually direct us to Facebook to login. As you can see we’re prompted for a Facebook login and supply my credentials here and login. We’re then prompted to continue as Tom. From there, we are redirected back to the application which is just a dummy PHP app, but as you can see, the login information was accepted and the authentication process took me back to the web app after being successfully authenticated via Facebook. So in this demonstration you learned how to configure a web app, to use Facebook authentication by creating the necessary Facebook application configuring Facebook as an identity provider and then configuring the web app to use Facebook for authentication.</p>
<h1 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h1><p>In this demonstration, I’m going to teach you how to configure a basic Azure web app to use Google for authentication. To prepare for this demo, I’ve already deployed an Azure Active Directory B2C Tenant, which is what you see here on the screen. And I’ve also deployed a basic PHP Web App in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. </p>
<p>As we work through this demo, we’ll create a Google App first, we will then configure Google as an Identity Provider in the Azure Tenant, lastly we’ll configure the web app to use Google for authentication, and we’ll test authentication. Before configuring Google as an Identity Provider, you need to create a Google Plus application, and supply it with the right parameters. To do this you need to have a Google Plus account already. If you don’t have a Google Plus account you can set one up at <a target="_blank" rel="noopener" href="https://accounts.google.com/signup">https://accounts.google.com/signup</a>. </p>
<p>After getting your Google Plus account, browse to the Google Cloud Platform Console and sign in with your Google Plus account credentials. As I bounce over here into my other tab, you can see that I’m already logged into my Google Cloud Platform Console. To get started, click the project drop down box at the top here, and select New Project. From here, give the New Project a name. After giving it a name, you can click Create. Before continuing, ensure that the proper project is selected, and then, hover over APIs and Services, and select Credentials. </p>
<p>From this screen, you should click on OAuth consent screen. From here you’ll need to provide a valid email address, and a product name to show users. We’ll just call it Azure Authentication here. The rest of these fields are optional at this point. After providing an email address and product name, click save. After saving your project, select Create credentials, and then OAuth client ID. From here select Web application. At this point, you need to give your web app a name, I’m just going to leave the default name here for Web client 1. However, we also need to enter the Web app’s URL in the authorized JavaScript origins field, and we also have to add a version of our Web app URL into the Authorized redirect URIs field. To get our Web app URL, we switch over to Azure, and select our web app. In the right corner here, we see the URL for the web app, and we can copy it. </p>
<p>We take that URL, supply it in the origins field, and we also supply it in the redirect field. However, we need to append this URL. What we need to do is add the following. We need to append our URL with .auth&#x2F;login&#x2F;google&#x2F;callback. This is essentially the path that the application uses for redirection after they’re authenticated with Google. After supplying this information, you click Create. From the OAuth client screen, copy the values for the client ID and the client secret, these will be used later on. After copying your values click okay. </p>
<p>So now that we’ve created the Google Plus application, we can go ahead and configure Google Plus as an Identity Provider in the Tenant. To configure Google as an Identity Provider in our Tenant, we switch over to our Tenant, and browse to the Azure AD B2C blade, which I’ve done here on a screen. To add Google we simply select Identity providers. As you can see, we already have <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/facebook/">Facebook</a> here from the previous exercise. To add Google, click add, and then give the provider a friendly name. We’ll give it Google. After supplying a name, we click Identity provider type, and select Google from the list, and click OK. </p>
<p>Next, we click Set up this identity provider, and we provide the client ID and secret codes that we got from our Google app. After supplying our client ID and secret, we click OK, and then Create. With that, you’d configured Google as an Identity provider. With the Google app created, and Google configured as an Identity provider, the web app itself can now be configured to leverage Google authentication. To configure the web app to use Google for authentication, browse through the application in the resource group where it’s been deployed. And then once the application opens, click on Authentication and Authorization. </p>
<p>Authentication and Authorization is listed below settings, in the left pane here. We already have the app service authentication turned on because we turned it on when we configured Facebook. If it’s not on already, you just click the On toggle. After ensuring that the app service authentication is on, change the action to take when request is not authenticated to log in with Google. What this will do is force Google authentication before allowing access to the web app. Next, click Google under the Authentication Providers section. </p>
<p>And again you’re going to provide the Client ID, and the Client Secret that you got from your Google app earlier on. Click okay to save your values. And then lastly, click Save up above to save the configuration for this web app. Doing so completes configuration of the web app to use Google for authentication. To test log in, browse to the web app, and open it’s URL in an incognito window, or private window if you’re using IE. As you can see, the web app directs me to Google to log in first. So I’ll go ahead and log in here. </p>
<p>And after logging in, access is granted to the web app. Now of course the web app isn’t doing a whole lot, it’s just a blank PHP page, but as you can see, it took my authentication and redirected me back to the web app. So in this demonstration you learned how to configure a web app to use Google Authentication by creating a necessary Google app, configuring Google as an Identify Provider in the Azure Tenant, and configuring the web app itself to use Google for authentication.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>I hope you’ve enjoyed learning about <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-azure-data-protection-and-security-compliance/course-introduction/">managing data protection and security compliance</a> in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Microsoft Azure</a>. Let’s review what you’ve learned. The Azure Key Vault allows you to create encryption keys and to also import existing keys. Using the add Azure Key Vault key power cell command allows you to perform both functions. You learned how to create a new software protected key in the Vault as well as how to import an existing PFX file from your workstation into the Vault using the add Azure Key Vault key power cell command. Although Security Center automatically creates a default security policy for each of your Azure subscriptions, you’ll often find that you need to specially configure certain aspects of your policy. Through the Azure Security Center you can define and assess security policies that help protect your Azure resources. You can manage conditional access to VMs with access policies and harden them against malware with application policies. You also learned how to provision just in time virtual machine access to reduce attack exposure of your VMs by denying persistent access to VMs via policies. In addition to configuring security options to protect your VMs you also learned how to triage security alerts and how to investigate alerts and incidents using the security center. In addition to robust security features, Azure also offers the ability to provide access to applications via single sign-on using federation or password-based authentication. You learned how to configure both options. In addition to learning how to configure single sign-on, you also learned how to assign users and groups to applications as an administrator using the Azure portal. Additionally, you learned how to provision self-serve application access to allow end users to discover applications. As an extension to the single sign-on capabilities that Azure offers, a key feature of Azure security is the ability to configure federation with public consumer identity providers such as Facebook. You learned in this course how to configure Facebook as an identity provider for an Azure application. This allows you to leverage Facebook authentication for access to applications. The topics covered in this course map very closely to those covered in the 70-533 exam. Mastering the concepts in this course is critical to preparing for this exam. To learn more about managing data protection and security compliance in Azure, you can read Microsoft’s documentation. Be sure to also watch for new Microsoft Azure courses on CloudAcademy because we’re always publishing new ones. Please give this course a rating and if you have any questions or comments, please let us know. Thanks for watching and happy learning.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Lab-Monitoring-Resources-with-Azure-Monitor-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Lab-Monitoring-Resources-with-Azure-Monitor-11/" class="post-title-link" itemprop="url">AZ-500-Lab-Monitoring-Resources-with-Azure-Monitor-11</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:35" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:35-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:17:26" itemprop="dateModified" datetime="2022-11-20T19:17:26-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Lab-Monitoring-Resources-with-Azure-Monitor-11/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Lab-Monitoring-Resources-with-Azure-Monitor-11/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Monitoring-Microsoft-365-Security-with-Azure-Sentinel-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Monitoring-Microsoft-365-Security-with-Azure-Sentinel-10/" class="post-title-link" itemprop="url">AZ-500-Monitoring-Microsoft-365-Security-with-Azure-Sentinel-10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:33" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:33-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:15:24" itemprop="dateModified" datetime="2022-11-20T19:15:24-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Monitoring-Microsoft-365-Security-with-Azure-Sentinel-10/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Monitoring-Microsoft-365-Security-with-Azure-Sentinel-10/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hi there. Welcome to Monitoring Microsoft 365 Security with Azure Sentinel. My name is Thomas Mitchell and I’ll be taking you through this course.</p>
<p>I’m an Azure and Microsoft 365 instructor at cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions about this course, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for those who wish to learn what Azure Sentinel is and how to use it to monitor Microsoft 365.</p>
<p>We’re going to start things off with an introductory look at what Azure Sentinel is and at what it offers. You’ll also learn how to onboard Azure Sentinel.</p>
<p>We’ll then take a look at the process required for connecting Azure Sentinel to Microsoft 365. You’ll also get to watch over my shoulder as I connect Azure Sentinel to Office 365.</p>
<p>After covering the onboarding of Azure Sentinel and the connection of Sentinel to Microsoft 365, we’ll look at how you can visualize data using Azure Sentinel.</p>
<p>We’ll wrap things up by covering workbooks.</p>
<p>By the time you finish this course, you should have an understanding of how to onboard Azure Sentinel and how to connect it to Microsoft 365 and Office 365.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished. If you’re ready to learn about Azure Sentinel, let’s get started.</p>
<h1 id="Intro-to-Azure-Sentinel"><a href="#Intro-to-Azure-Sentinel" class="headerlink" title="Intro to Azure Sentinel"></a>Intro to Azure Sentinel</h1><p>Hello and welcome to intro to Azure Sentinel. Before we get into the meat of monitoring Microsoft 365 with Azure Sentinel, it makes sense to just touch on what Azure Sentinel is and what it offers.</p>
<p>Microsoft Azure Sentinel is a cloud-native security information and event management system, or SIEM. It’s also a security orchestration automated response solution, or SOAR. Essentially, what this means, is that Azure Sentinel can be used to collect and view security analytics data and threat intelligence data across your entire enterprise.</p>
<p>It allows you to detect previously undetected threats using Microsoft’s analytics and threat intelligence, and it allows you to investigate critical incidents using artificial intelligence. You can also use it to hunt down suspicious activities. And lastly, you can use Azure Sentinel to respond rapidly to incidents and you can automate protection of your environment.</p>
<p>Essentially, what Azure Sentinel offers, is the ability to improve your threat investigation and detection capabilities through the use of artificial intelligence.</p>
<p>To implement Azure Sentinel, you first onboard it by connecting it to your security sources. This is done via numerous connectors that are available right out of the box. Once you’ve connected your data sources to Azure Sentinel. You can then monitor that data using the integration with Azure monitor workbooks that Azure Sentinel offers.</p>
<p>Azure Sentinel then uses analytics to correlate alerts into incidents. Now incidents are groups of related alerts that when taken together can create an actionable possible-threat that you can investigate and resolve. By correlating alerts into incidents, what Azure Sentinel does is it reduces the amount of noise that you have to sift through in order to review and investigate real alerts.</p>
<p>Azure Sentinel is built on the foundation of Azure logic apps. Because of this Azure Sentinel offers automation and orchestration features that allow you to automate common tasks and to simplify security orchestration with playbooks, which you can build with Azure logic apps. There are over 200 connectors that you can use to integrate with various services. For example, there are connectors that allow you to integrate with ServiceNow, Zendesk, slack, cloud app security, and many other applications.</p>
<p>For example, if you use Zendesk as your ticketing system, you can use the tools that Azure logic apps offers to automate workflows and to automatically open tickets in Zendesk any time a specific event is detected.</p>
<p>Azure Sentinel also offers deep investigation tools that allow you to better understand the scope and root cause of specific security threats. Its hunting tools, or search and query tools, allow you to proactively hunt for security threats across all of your organization’s data sources before an actual alert even gets triggered. This hunting capability allows you to get ahead of many security threats.</p>
<p>There is even an Azure Sentinel community that you can leverage. You can use the community to improve your threat detection and automation. This is made possible because Microsoft security analysts regularly create new workbooks, playbooks, and hunting queries and they post them to the community. You can then use these resources in your own environment.</p>
<p>So, to sum up, Azure Sentinel in a nutshell, it allows you to collect security data, it allows you to detect threats using threat intelligence, it allows you to investigate critical incidents using artificial intelligence, and it allows you to respond to such threats.</p>
<h1 id="Onboarding-Azure-Sentinel"><a href="#Onboarding-Azure-Sentinel" class="headerlink" title="Onboarding Azure Sentinel"></a>Onboarding Azure Sentinel</h1><p>Hello and welcome to Onboarding Azure Sentinel. In this lesson, we’ll take a look at some of the requirements for Azure Sentinel and at some of the pre-requisites for onboarding it.</p>
<p>So, before you begin using Azure Sentinel with Microsoft 365, you first need to onboard it. Once you’ve onboarded it, you then need to connect your data sources. Now, in the context of this course, we are going to discuss Azure Sentinel as it relates to Microsoft 365. And that being the case, I want to point out that Azure Sentinel comes with several connectors for Microsoft 365 offerings. It includes a connector for Microsoft 365 defender, Microsoft 365 sources, which includes office 365, and it includes a connector for Microsoft defender for identity, which was formerly Azure ATP. Azure Sentinel also includes connectors for Microsoft cloud app security, Azure ad, and several other features and offerings.</p>
<p>Once you connect your data sources to Azure Sentinel, you can then use workbooks from a gallery to gather insights into your organization, based on the data that is collected.</p>
<p>Before you onboard Azure Sentinel, you need to meet some global prerequisites.</p>
<p>First and foremost, you need to have an active Azure subscription. That kind of goes without saying. However, you also need a log analytics workspace to use Azure Sentinel. Now, once you meet these global prerequisites, in order to enable and use Azure Sentinel, you’ll need specific permissions. To enable Azure Sentinel, contributor permissions are needed to the subscription that contains the Azure Sentinel workspace. Using Azure Sentinel requires you to have either contributor or reader permissions on the resource group that contains the Azure Sentinel workspace. And depending on the specific data sources you want to connect to; you may need other permissions to those data sources as well.</p>
<p>Enabling Azure Sentinel is actually pretty straightforward. All you have to do is sign into the portal and then search for Azure Sentinel. From there, you simply click add and then create a workspace. After creating a workspace, you can add Azure Sentinel. In the upcoming demonstration, I will walk you through this process.</p>
<h1 id="DEMO-Onboard-Azure-Sentinel"><a href="#DEMO-Onboard-Azure-Sentinel" class="headerlink" title="DEMO: Onboard Azure Sentinel"></a>DEMO: Onboard Azure Sentinel</h1><p>Hello, and welcome back. What we’re gonna do here in this brief demonstration is just walk through the process of enabling Azure Sentinel in Microsoft Azure. On the screen here, I’m logged into my Azure portal. I’m at the homepage and I’m logged in as an admin for my fictional Berks Batteries organization.</p>
<p>To enable Azure Sentinel, what I can do here is search up the top here in the search bar for Azure Sentinel. And what we’ll do here is we’ll select it from services and we can see, we have no Azure Sentinel to display here. So let’s go ahead and create Azure Sentinel. And then what we have to do here is create a workspace for Azure Sentinel.</p>
<p>Now, if we had an existing workspace available, we could select it, but we don’t have any. So we’ll go ahead and create a new workspace here. Now to create our workspace, we need to provide some basic information. Essentially, what we’re creating is a log analytics workspace. So what we’ll do here is we’ll deploy into our Berks Batteries subscription. And then what we’ll do is deploy into the Berks RG resource group. We could create a new one if we wanted to. But this one works for this demonstration.</p>
<p>Now, if we hover over the icon here for name, we can see that the workspace name needs to be between four and 63 characters. It can be letters, digits, or the hyphen. So what we’ll do here is we’ll just call this MyWorkspace. Now, if we next over to pricing here, we can choose a pricing tier. Now the only pricing tier I have available to me is pay as you go. So that’s what we’ll go with here.</p>
<p>We’ll go ahead and click through to tags. We’re not gonna do any tagging here, so we’ll review and create. And then from here, we can review our settings and then go ahead and deploy the log analytics workspace. So we’ll close our notification here. And so now we have a workspace here, and we’ll go ahead and add. And what we’re doing here is adding Azure Sentinel to the new workspace.</p>
<p>And now we can see we’ve successfully deployed Azure Sentinel. And from this getting started page here, we can connect to data sources to collect data. We can create security alerts, and we can perform automation and orchestration. Under threat management, we can look at incidents. We can look at workbooks. We can perform hunting. And then of course, under configuration, we can configure data connectors, analytics, and configure the watch list.</p>
<h1 id="Connecting-Azure-Sentinel-to-Microsoft-365"><a href="#Connecting-Azure-Sentinel-to-Microsoft-365" class="headerlink" title="Connecting Azure Sentinel to Microsoft 365"></a>Connecting Azure Sentinel to Microsoft 365</h1><p>Welcome to connecting Azure Sentinel to Microsoft 365. In this lesson, will take a look at the different Microsoft 365 services that Azure Sentinel can be connected to.</p>
<p>Now, before we get into the specifics of each of the Microsoft 365 services, let’s just take a quick look at the generic overview process of how Azure Sentinel connects to data sources.</p>
<p>We’ve already established that Azure Sentinel pulls data in from different services and apps by connecting to them and then forwarding events and logs into Azure Sentinel. To connect to the different data sources in your environment, including Microsoft 365 data sources, you use the data connectors page in Azure Sentinel. From the data connectors page, you can open the data connectors, gallery, which is a list of all of the different data sources that you can connect to. From here, you can select the data source you are most interested in. Once you connect Azure Sentinel to your data source, you can then stream logs from that data source into Azure Sentinel.</p>
<p>Azure Sentinel comes with a Microsoft 365 defender connector. This allows you to connect Azure Sentinel to Microsoft 365 defender, which was actually formerly known as Microsoft threat protection. This connector includes incident integration and allows you to stream all Microsoft 365 defender incidents and alerts into Azure Sentinel. It also ensures that the incidents between both portals, meaning the Microsoft 365 defender portal and Azure Sentinel are synchronized.</p>
<p>The Microsoft 365 defender connector also allows you to stream advanced hunting events from Microsoft defender for endpoint into Azure Sentinel as well.</p>
<p>Visit the URL on your screen to read more about integration with Microsoft 365 defender:</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-microsoft-365-defender">https://docs.microsoft.com/azure/sentinel/connect-microsoft-365-defender</a></p>
<p>Another Microsoft 365 service that you can connect to from Azure Sentinel is Microsoft defender for endpoint. Azure Sentinel’s Microsoft defender for endpoint connector can be used to stream alerts from Microsoft defender for endpoint into Azure Sentinel. This allows you to analyze security events across the organization, and it also allows you to build playbooks to facilitate a more effective and immediate response to threats.</p>
<p>The URL on your screen provides more information about integration with Microsoft defender for endpoint:</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-microsoft-defender-advanced-threat-protection">https://docs.microsoft.com/azure/sentinel/connect-microsoft-defender-advanced-threat-protection</a></p>
<p>Azure Sentinel’s office 365 log connector allows you to pull in ongoing user and admin activities in exchange, SharePoint, one drive, and teams into Azure Sentinel. The information that gets pulled in includes things like file downloads, access requests sent, mailbox operations, team events, and many other important bits of office 365 information. When you connect office 365 logs to Azure Sentinel, you can view and analyze all of this data in workbooks, you can create custom alerts, and you can incorporate the data into existing investigation processes.</p>
<p>Visit the URL on your screen to read more about integrating office 365 logs and Azure Sentinel:</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-office-365">https://docs.microsoft.com/azure/sentinel/connect-office-365</a></p>
<p>You can also connect Azure Sentinel to Microsoft defender for office 365. Microsoft defender for office 365 was formerly known as office 365 advanced threat protection. Now, I’m not going to go into details on this offering because, at the time of this course creation, the ingestion of Microsoft defender for office 365 alerts is in public preview. Since it’s in public preview, things could change.</p>
<p>To read all about integration with Microsoft defender for office 365, visit the URL that you see on your screen:</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-office-365-advanced-threat-protection">https://docs.microsoft.com/azure/sentinel/connect-office-365-advanced-threat-protection</a></p>
<p>Join me in the next lesson, where I’ll show you how to connect office 365 logs to Azure Sentinel.</p>
<h1 id="DEMO-Connect-Office-365-Logs-to-Azure-Sentinel"><a href="#DEMO-Connect-Office-365-Logs-to-Azure-Sentinel" class="headerlink" title="DEMO: Connect Office 365 Logs to Azure Sentinel"></a>DEMO: Connect Office 365 Logs to Azure Sentinel</h1><p>Hello, and welcome back. What we’re gonna do in this demonstration here is connect Azure Sentinel to our Office 365 logs. Now on the screen here, I’m logged in to my Azure portal. I’m at the Azure Sentinel overview page for the Sentinel that we deployed earlier. And what we’re gonna do here is connect it to Office 365.</p>
<p>Now to do that, we simply browse down to data connectors here under Configuration in the left-hand pane. And then from here, this data connectors page shows us all of the different data connectors we have at our disposal. Now, one of these data connectors, if we scroll down here, is going to be Office 365. So what we’ll do here is we’ll select Office 365 from the list. And then if we scroll down further, we have an option here to open the connector page, which is what we’ll do here.</p>
<p>Now on this instructions pane, we have really two separate pieces. We have the prerequisites pane and the configuration pane. Prerequisites here tell us what we need in terms of a workspace and in terms of tenant permissions. The green check marks here tell us we’re good. And then under Configuration here, this is where we can tell Azure Sentinel what we’re interested in. Essentially we can select what record types we want to collect from Office 365. For this demonstration here, we’ll just select Exchange logs, and then we’ll apply the changes.</p>
<p>Now we don’t have any previously connected tenants here, so we don’t have to do anything here. If we click Next steps here, we can see the recommended workbooks and query samples along with analytics rule templates that come with the Office 365 log connector. We can use these to get insight into our environment.</p>
<p>If we select Exchange Online, we’ll go ahead and select it. The green check mark here tells us we do have the required data types for this particular template. If we scroll down, we can view the template. And then from here we gonna notice that the query can’t run because we haven’t set any parameters. So we do this in activities here. So we’ll select the dropdown for activities. And we’ll select all.</p>
<p>Now, since the Berks Batteries tenant here, this subscription is just a lab environment, I haven’t been using Exchange. So I wouldn’t expect to see any activities here. And that’s what’s happening here. If we scroll down, we could also see user activities, admin activities, any kind of external access activities, access activities by activity. And these are all listed under suspicious. We can see hard delete activities.</p>
<p>So everything that happens within our Exchange environment would be shown through Azure Sentinel through this workbook. But like I said, since I’m not doing anything with Exchange in this particular lab, I really have nothing to show here. But that’s how you connect a data source to Azure Sentinel using the Azure portal.</p>
<h1 id="Visualizing-with-Azure-Sentinel"><a href="#Visualizing-with-Azure-Sentinel" class="headerlink" title="Visualizing with Azure Sentinel"></a>Visualizing with Azure Sentinel</h1><p>Welcome to Visualizing with Azure Sentinel. In this lesson, you’ll learn how to use Azure Sentinel to view and monitor what’s going on in your environment. </p>
<p>Once you’ve connected your Microsoft 365 data sources to Azure Sentinel, it begins providing visualization and analysis of that data. This visualization and analysis allows you to better see what’s happening in your environment. As I mention elsewhere in this course, workbooks are used to gather insights into the environment.</p>
<p>To visualize and analyze data collected about your environment, you can start with the overview dashboard, because the overview dashboard shows the overall security posture of your organization. From the dashboard, you can click on specific information within the tiles to drill down into the raw data that you are most interested in. </p>
<p>Viewing the Azure Sentinel dashboard is as easy as browsing to the Azure portal and selecting Azure Sentinel. From Azure Sentinel, you can then choose the workspace you want to monitor.</p>
<p>The image on your screen shows what a typical workspace looks like. Notice the toolbar across the top. What this toolbar does is show you how many events were generated during the selected time period. It compares them to the previous 24 hours. The toolbar also shows you the alerts that were triggered from those events. It tells you how many are open, how many are still in progress, and how many are closed. </p>
<p>The main pane of the overview page shows the overall security status of the workspace. For example, the <strong>Events and alerts over time</strong> tile shows the number of events and how many alerts were generated as a result of those events. </p>
<p>The <strong>Potential malicious events</strong> tile shows where in the world alerts are generated due to traffic sources that are known to be malicious. The orange notations represent inbound traffic, which in turn, represents people trying to access your organization from known malicious IP addresses. Red denotes outbound activity. These entries refer to incidents where data is being streamed out of the organization to known malicious IP addresses.</p>
<p>Over on the right side, you’ll notice the <strong>Recent incidents</strong> pane. This pane allows you to view recent incidents, along with their severity and the number of alerts associated with each incident. </p>
<p>Underneath the recent incidents pane is the <strong>Data source anomalies</strong> pane. This pane shows anomalies in your data sources that are based on models created by Microsoft’s data analysts.</p>
<p>In each of these panels, you can click on the underlying data to further investigate.</p>
<h1 id="Using-Workbooks"><a href="#Using-Workbooks" class="headerlink" title="Using Workbooks"></a>Using Workbooks</h1><p>Once you’ve connected Azure Sentinel with the data sources you are interested in, you can begin visualizing and monitoring that data. This is accomplished through the use of workbooks. Using workbooks to visualize and monitor things allows you to create custom dashboards that display only what you are interested in. You can use built-in workbook templates, or you can build custom workbooks, depending on what data you are interested in.</p>
<p>Using a built-in workbook is pretty straightforward. Simply browse to Workbooks within the Sentinel portal to select Templates. Doing so displays the full list of built-in Azure Sentinel workbooks. If a workbook is relevant to any data types you’ve connected Sentinel to, the <strong>Required data types</strong> field for the selected workbook will show a green checkmark.</p>
<p>After selecting the relevant workbook, clicking <strong>View template</strong> allows you to view the template populated with your data.</p>
<p>You can then edit the workbook and then click Save. You’ll be prompted to choose a location where you want to save the JSON file for the template.</p>
<p>Once you’ve saved the new workbook, you can click View saved workbook, to view it. To edit it, click the Edit button at the top. Editing a workbook allows you to customize it for your specific needs. </p>
<p>Once you are done making your changes, you can save the workbook.</p>
<p>To read more about workbooks in Azure Sentinel, visit the URL you see on your screen:</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data">https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data</a></p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations. You’ve come to the end of Monitoring Microsoft 365 Security with Azure Sentinel. Let’s review what you’ve learned.</p>
<p>We kicked things off with an introductory look at what Azure Sentinel is and at what it offers. You also learned how to onboard Azure Sentinel.</p>
<p>We then took a look at the process required for connecting Azure Sentinel to Microsoft 365. You also got to watch over my shoulder as I connected Azure Sentinel to Office 365.</p>
<p>After covering the onboarding of Azure Sentinel and the connection of Sentinel to Microsoft 365, we looked at how you can visualize data using Azure Sentinel.</p>
<p>We wrapped things up by covering workbooks.</p>
<p>At this point, you should have an understanding of how to onboard Azure Sentinel and how to connect it to Microsoft 365 and Office 365.</p>
<p>To learn more about Azure Sentinel, you can, and should, read Microsoft’s published documentation. You should also keep an eye out for new courses on Cloud Academy, because we’re always publishing new ones. </p>
<p>Be sure to give this course a rating, and if you have any questions or comments, please let us know. As always, thanks for watching, and happy learning!</p>
<h1 id="5Connecting-Azure-Sentinel-to-Microsoft-365"><a href="#5Connecting-Azure-Sentinel-to-Microsoft-365" class="headerlink" title="5Connecting Azure Sentinel to Microsoft 365"></a>5<strong>Connecting Azure Sentinel to Microsoft 365</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-microsoft-365-defender">Integration with Microsoft 365 defender</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-microsoft-defender-advanced-threat-protection">Integration with Microsoft defender for endpoint:</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-office-365">Integrating office 365 logs and Azure Sentinel:</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/connect-office-365-advanced-threat-protection">Integration with Microsoft defender for office 365</a></p>
<h1 id="8Using-Workbooks"><a href="#8Using-Workbooks" class="headerlink" title="8Using Workbooks"></a>8<strong>Using Workbooks</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data">Workbooks in Azure Sentinel</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Analyzing-Resource-Utilization-on-Azure-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Analyzing-Resource-Utilization-on-Azure-9/" class="post-title-link" itemprop="url">AZ-500-Analyzing-Resource-Utilization-on-Azure-9</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:32" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:32-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:13:28" itemprop="dateModified" datetime="2022-11-20T19:13:28-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Analyzing-Resource-Utilization-on-Azure-9/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Analyzing-Resource-Utilization-on-Azure-9/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to Analyzing Resource Utilization on Azure. My name is Matthew Quickenden, and I’m going to be guiding you through analyzing and diagnosing resource utilization and understanding consumption. I have over 20 years of industry experience, and I’ve recently been working with cloud and hybrid cloud technologies with a specific focus on Azure and Azure Stack. If you have any questions, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. This course is intended for people who want to become certified Azure architects or who are simply tasked with managing and supporting resources in Azure.</p>
<p>To get the most out of this course, you should have a general understanding of Microsoft Azure and how to deploy and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/azure-arm-intro/">manage resources</a>. Being familiar with <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/azure-ps-intro/course-intro-17/">PowerShell</a> is very useful but not essential. We are going to explore adding diagnostic logging to resources, collecting that data to different output locations, and creating alerts based on it. In addition, we will look into costs associated with Azure consumption and how to generate reports and track Azure spend. By the end of this course, you should be able to set up diagnostic logging to various sources, create alerts based on these logs, and understand Azure cost consumption. Your feedback on this course is important, so please give it a rating when you’re finished. Let’s get started.</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Azure is based on a consumption and usage model. As administrators, it is important to monitor utilization, and understand where and how the resources we have deployed are being used, and how much they’re costing us. To help facilitate this, we can use tools built into Azure. We are going to explore diagnostic logging, which is captured in a resource level and allows us to view detailed logs. Metric counters help us look at performance and cost in relation to metrics. Azure Advisor is built into Azure at many layers and leverages Azure’s power to analyze your usage, and provide recommendations to help reduce excessive spend.</p>
<p>We could set up alerts on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/diagnostic-logging/">logs</a> or metrics to trigger a variety of actions via action groups. Log Analytics can be leveraged to perform custom queries on log data. Azure Cost Management provides a view into resource cost allocation.</p>
<h1 id="Diagnostic-Logging"><a href="#Diagnostic-Logging" class="headerlink" title="Diagnostic Logging"></a>Diagnostic Logging</h1><p>Azure provides different logging options around resources. We are going to be taking a look at diagnostic options available to tenants. The Azure monitor helps facilitate logging and collection of these logs. There are three types of logs we need to be aware of: activity logs, diagnostic logs, and application logs, or guest OS logs. Let’s take a look at where these logs exist within an <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> subscription in relation to the resources they are monitoring. Here we have a Non-Compute Resource, which is tightly integrated and delivered through Azure providers, for example a network security group. Next to this, we have a Compute Resource.</p>
<p>This is a virtual machine with a guest OS, like Windows or Linux, and it has an application installed like IIS or Apache. Activity logs provide a record of operations from a subscription level, executed against the resource. For example, when administrative tasks are performed on the resource, like creating a resource or updating the properties of an existing resource, this will generate an event in the activity log. Diagnostic logs are collected within a subscription at an Azure resource level for services like VPN gateways or network security groups. Not all Azure services have an option for diagnostic logging, and the level of detail you can capture varies. You can view a full list of resources that support diagnostic logging from the Microsoft Azure website. Application logs are logs generated by applications or services within a guest OS. These logs are collected from within the operating system through an agent. Application logs can be collected from core services, like Windows Event logs, or from applications like IIS. Diagnostic logging can be enabled in a couple of ways: using the Azure portal, PowerShell, Azure CLI or the REST API via Azure Resource Manager. </p>
<p>When enabling diagnostic logging, you can choose where you want to export your logs to. You can export them to Log Analytics, to an event hub, or directly to a storage account. The Azure Portal allows us to easily browse through resources to enable diagnostic logging. Select the resource in question under the heading Monitoring and you should see a heading Diagnostic Settings. This will open a blade that contains diagnostic logging options for the type of resource you’re currently looking at. If it’s not already enabled, you’ll see an option to turn on diagnostics, to enable diagnostic collection. This will give you a choice of export <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/creating-locations-for-diagnostic-logging/">locations</a> we looked at earlier and the options related to them. For instance, when you select storage account, you get a choice of which storage account and retention settings. You will also notice different log events to capture, specific to the resource you’re working on. One of the first steps to take if you’re experiencing an issue is to select the resource and go to the Diagnose and Solve Problems blade. </p>
<p>This shows any general issues related to this resource’s health. With regards to virtual machines on the diagnostic settings blade, you have an option to enable guest-level monitoring. Once enabled, you’ll have more capability to collect logs from within the system without having to set up anything inside the system yourself. We will investigate more about these options in the demonstration. Log Analytics, formally known as Operations Management Suite, or OMS, is a log search analytics tool. It allows you to collect logs from different sources and correlate the data. You can write queries and create charts and graphs to help gain operational insight into your environment. You can create alerts based on metric thresholds or activity log events and consume pre-built management solutions, which includes queries and graphs. We can also send our diagnostic data to an event hub, which is a big data streaming platform. It can receive, process and transform thousands of events per second. Data can be stored or displayed as needed. Anomaly detection, live dashboards and application logging are among some of the ways we can utilize event hubs. Finally, we can send logs in their raw format to a storage account. It is important to understand the naming convention used to store it. Logs can be broken down by a subscription, resource group, provider and, finally, date and time with a JSON file called PT1H.json. An example of the file structure in the blob would look like this. The PT1H.json file contains an array of records, which we can see in the image shown. </p>
<p>To help collate different logs together to determine the correlation between events, it is important to have a common structure to the logs. Azure diagnostic logs have that. This is a top-level diagnostic schema that includes several required fields and some optional fields. Required fields include time, resource ID, tenant, and operation name. Some optional fields are duration, correlation ID, and location. Each type of service will have its own specific data fields that relate to it. For instance, auditing within Azure Active Directory includes AuditEventCategory, IdentityType, OperationType, TargetResourceType, TargetResourceName, and AdditionalTargets. Or in the case of Azure Automation accounts, the additional schema fields include RunbookName, ResultType, and ResultDescription. On a virtual machine, you can enable boot diagnostics. </p>
<p>Once you specify a storage account, you can then see the screen and view the serial log that is an output from the virtual machine. This is particularly useful for Linux machines, as they often have an output log to the console screen. You can see and download a screenshot of the current state the virtual machine is in from the screenshot tab. This is also accessible through PowerShell for automation. Using Resource Manager templates, you can automatically enable Diagnostic Settings at the time of resource creation. Using templates helps ensure consistency in how settings are configured. You may decide you always want to export diagnostic logs to specific services, like event hub or a central Log Analytics instance. Using templates can help allow for standards to be applied to resources at the time of deployment without user intervention. The resource type that supports this is providers&#x2F;diagnosticSettings. Here is an example of a diagnostic resource. If we look closely we can see the storage account ID, event hub authorization rule, event hub name, or workspace ID. Now we also have settings regarding logs and the retention period and particular metrics you want to capture and retention.</p>
<h1 id="Creating-Locations-for-Diagnostic-Logging"><a href="#Creating-Locations-for-Diagnostic-Logging" class="headerlink" title="Creating Locations for Diagnostic Logging"></a>Creating Locations for Diagnostic Logging</h1><p>For this exercise we are going to set up <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/diagnostic-logging/">diagnostic logging</a> on a network security group, exploring all three export options and the different methods to configure them. This is a prerequisites video so we are going to go through what we need to have in place and set up the destinations. Here I have a resource group called Jenkins and I’ve used an Azure Marketplace template to deploy a Jenkins instance. So we have a Linux virtual machine and a Windows 2016 server. This has deployed both a jenkins-nsg and a windemo-nsg. From here we are going to create the objects in another resource group called the AzureDiagnostic. </p>
<p>So I’ve created it already. And we’re going to add the resources we need here to do our diagnostic logging. So first things first, let’s go and create the OMS or Log Analytics workspace. Log Analytics, and we’ll click create. Not a lot of parameters here. I’ll pause the video and come back in a second. So we’ve given it a name and selected the appropriate subscription. We’ve selected the existing resource group we’ve created and the location, pricing tier free. With the OMS deployment, you cannot navigate away until this window’s finished validating. So this needs to finish its process before you can do the next thing. So we can see that validation succeeded and the deployment was successful. So if we go back to the resource group we can now see the AzureDiagnostics OMS instance. Next, we will create the event hub. So we’ve given it a name, selected a pricing tier, basic. Got the subscription and resource group and a location. We’ll click create. </p>
<p>Now this job is submitted to Azure resource manager and we can continue to do the next thing. So the last thing we need is a storage account. And create. So we’ve chosen the resource group, we’ve given the storage account a name, that’s lowercase. The account kind we need to make general purpose V1. The other options don’t matter at this stage. So we’re just going to do review and create. And create. Your deployment is underway and we can go look at the resource group. We can see that our Event Hub Namespace is there. OMS workspace is here and if we just give it a moment we can see the deploying storage account and we’ll look for that success. And here we can see the success of that account. And now we have our three prerequisites for logging: event hub, storage account, and an OMS workspace.</p>
<h1 id="Enabling-Diagnostic-Logs-Using-the-Azure-Portal"><a href="#Enabling-Diagnostic-Logs-Using-the-Azure-Portal" class="headerlink" title="Enabling Diagnostic Logs Using the Azure Portal"></a>Enabling Diagnostic Logs Using the Azure Portal</h1><p>So, in this resource group, we have our prerequisite <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/creating-locations-for-diagnostic-logging/">destinations for the Diagnostic Logs</a>. We will now return to the Jenkins resource group, and take a look at the Jenkins-NSG. This is attached to the Linux machines. If we go down here to Diagnostic Settings, we get an option to turn on to collect data. So we’re going to set up one setting per output. In this case, we’ll call this Linux NSG DiagStorage Account. So archive to a storage account. Now, we would like to configure the storage account to be AZUREDIAGDEMO. Select okay and then we want to pick these two logs and their retention setting. So this setting applies to the storage account in terms of the retention. </p>
<p>If we click save for that, and we return back a screen and refresh, we can now see we have this particular setting and the setting there for storage account, with event hub and Log Analytics not selected. So next we can add the event hub. That’s optional, and we’ll pick the default policy. Give it a name. And now we can see that one and we’ll create one more for Log Analytics, which is the easiest. Just pick the workspace, and that’s it. Give it a name: LogOMSDiag. So now we have three different policies set up for diagnostic logging for the NSG. So, the next thing we can do is if we go to the monitor, so you can find this in under services and monitor, and diagnostic settings. So, here we can see these are the different objects within that resource group that we can connect diagnostic settings to diagnostic logging, and in this case, we have it connected to one of the NSGs. </p>
<p>So if we’ve also wanted to connect the Windows NSG, click on it from there. So we got to that from monitor. Turn on diagnostic settings, and we’ll call this AllInOne. We can create one for diagnostic demo. Stream on events hubs, okay. Configure the event hub again…and Log Analytics. There we go, so now we can see we’ve enabled diagnostic logging for both NSGs. So what we saw in the NSGs were two different log options. So if we go back and look at what the different settings were within here, there’s a network security event and network security group rule counter. So, if we look at the other options we have for a different type of resource - so let’s choose the Public IP addresses that are attached to these systems. If we go in here and turn on diagnostic settings, we have a different set of logs and we also have metrics. So this wasn’t shown in the last one. The metric counters are numeric n-digit numbers that allow us to track and graph things rather than event-based. So, let’s turn on one of these so we can get some other information. Just configure all of them.</p>
<p> And if we return to the monitor, logging settings have been set up for three resources now. These are address specific resource types. So, if you want to enable guest logging for the machines this is the difference of a resource based monitoring and what we’re about to do now is guest logs. So, we’ll return to the resource group Jenkins. Type in here so we can easily find it. Then we go to the Linux Virtual Machine to start with and we scroll down to diagnostic settings. Enable guest level monitoring. So, we can now see this is a Linux Machine and we’re getting different logs which are Linux specific. And if we look at the metrics, we have processor, memory, network, file system, and disk. You can also choose to do custom. So there are additional, more specific counters, if you want to enable those. In this case, we’ll just leave it with the basic.</p>
<p> And additional SYSLOG levels so you can go to higher levels so you get less information. And then there are additional settings here for the storage account that you have chosen to log that information to. So, let’s connect the Windows server where we can go look at the information that we’re collecting. So here’s the Windows machine and diagnostic settings. Choose enable guest level monitoring. This takes a while so we’ll just pause the video and return once it’s complete. And here we can see the job completed. So, we can also go and look at custom and basic performance counters and add additional Windows counters to that list. There are additional logs so you can directly click IIS logs, if you have that installed, in different levels as well. It does understand .NET applications. One thing worth noting is if you’re having trouble with the log collection you may need to remove and reinstall the agent. So, you can do that from this screen here.</p>
<h1 id="Enabling-Diagnostic-Logs-Using-PowerShell"><a href="#Enabling-Diagnostic-Logs-Using-PowerShell" class="headerlink" title="Enabling Diagnostic Logs Using PowerShell"></a>Enabling Diagnostic Logs Using PowerShell</h1><p>So we have a brief demo here of using PowerShell to view the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/enabling-diagnostic-logs-using-azure-portal/">diagnostic settings</a> that we’ve added to the Jenkins-nsg. So we’ve got the login-AzureRm PowerShell commandlet here, which I’ve already run and logged in with my credentials. We’ve got four parameters here we’re going to set which include the target resource group name, target nsg, diagnostic resource group, and diagnostic Log Analytics instance. So we’re going to assign the nsg into this variable with the Get-AzureRmNetworkSecurityGroup and the appropriate values, run that command, and we check that value. We can see we’ve got the Jenkins-nsg. If we run this command, the Get-AzureRmOperationalInsightsWorkspace with the appropriate settings, we will see we’ve got the Log Analytics instance. So to check that we’ve got the right settings already on there, we created the AllInOne setting. So if we do the Get-AzueRmDiagnosticSettings, we can see, there it is, AllInOne, and each of the different locations for storing diagnostic data. So we’ve got the workspace, the event hub, and we’re using metrics, logs, and seven days retention. So going into the storage account, it’s also in here: StorageAccountId.</p>
<p>So this is basically the outline of what we’ve already created in the portal. You should be able to use this command, but at the moment the commandlets are broken, so this is a known issue. At the time of this video, there isn’t a workaround. You need to do it in the portal, so that’s a bit unfortunate, however you should be sending in values very similar to this. So we’re going to have a quick look at the CLI commands. So here, this is sort of what the CLI version would look like. So az, then run your login. You’ve got the diagnostic-settings create, and then again just fill out the properties for each of these different items. And in the last section of this code, how we can generate these things with code, is if you’re using Azure resource group templates, the resource here, under resources, you have diagnostic settings. So the type is provider&#x2F;diagnosticSettings and then you’d create your setting name, what resource you’re going to depend on, api version will change over time, and here we have the properties for each of the different items: eventHubAuthorizationRuleId, event hub, workspace or storage account id, and the logs or metrics you want to record. These are going to be different for different types of resources and the same thing for the log categories. So you’re going to have to tailor these for your specific purposes. That was a brief overview of how to set diagnostic settings using code.</p>
<h1 id="Viewing-and-Accessing-Diagnostic-Data"><a href="#Viewing-and-Accessing-Diagnostic-Data" class="headerlink" title="Viewing and Accessing Diagnostic Data"></a>Viewing and Accessing Diagnostic Data</h1><p>So what we’re going to focus on in this session is looking at the diagnostic data that we’ve sent to the storage account and to Log Analytics. We’re going to have a look and interrogate the data and see what’s there and run a query against it. So first thing, we’ll look at the storage account because that’s an easy step. We’ll use the Storage Explorer built into <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> now. We could also use the Storage Explorer as a simple application. We’ll expand the subscription and the storage blob where we put that data, and if we have a look here under blob containers, we can see we’ve got insight logs for the network security group event and network security group event rule counter. If we drill into one of these logs, these containers, we can see we’ve got resource ID, subscriptions, and we’ll just go down through this chain, resource groups, and Jenkins. </p>
<p>So, each one of these providers you have that goes to the storage account will have a separate folder. Then if we go up to windows, we’ve got a date, time, day, hour, minute, and at the end of that, we have a PT1H.JSON file. If we download that file we can see inside the file is a lot of information about the logging that we’ve collected. So, if we scroll across we can see we’ve got deny, direction, priority. There’s a lot of information regarding the resource type that we’ve recorded. It’s very specific information to a network security group. So these logs exist one file per folder and you’ll see the breadcrumb trail to that log here. If we go back to the tables under storage account, we can see there’s also Windows diagnostic information. So this is from the event table. Under Windows metrics, we can see we’ve got…counters. So, here’s the disk times, CPU times, mirror accounts, page faults. It’s all those standard windows counters but they’re stored in this table that we can query with many different tools. So, that’s showing us what we’ve got in the storage account. </p>
<p>Next, we’re going to go to the Log Analytics instance. Go over here and log in. So if we go to the Azure Diagnostics Log Analytics instance, Workspace Summary and click add, we’re going to jumpstart our query language here with some pre-canned Microsoft queries around network security groups. So if I scroll down we can find the Azure Network Security Group Analytics. So this gives you a preview of what there is and we’ll click create. So, that’s been created. If we go to the resource, we can see the chart here is actually displaying the data that we’ve already been collecting. Click on that summary chart and we’ll drill into the solution itself and we can see some additional queries. So what we’re really interested in here is the data that’s backing these queries. This is all the stuff that we’ve set up from the security groups and merged and we’re learning how to query it ourselves. So this is diagnostic information that we want to enrich and display through graphs, charts or PowerBI and how we need to display that information. In this case, we’ll drill into one of these existing queries and what we can see is basically the query version. There’s some information here on the side with other information you could filter by. And if we look at the options here we can export to CSV files or go to PowerBI. In our case, we really want to understand how to write our own queries because that’s where we’re going to be able to get specifically what we’re interested in seeing. So, from here we can go to the advanced analytics, and on the left, we can see the Azure Diagnostics OMS workspace and then Log Management. So, in this case, we’re just going to delete this query and start again. So if we double-click on the left, on the table, and click run (we’ll start very simple), we can see we’ve been given 10,000 items (that’s been limited). </p>
<p>If we expand this we can see more information around that specific query. So there are all the different fields in the row. If we click the direction, we ought to find the blocked traffic. Down here, you can click on this and that’ll actually put in the filter for you: where TYPE_S is equal to ALLOW. When we run this query, we can see we now have 4,564 records. We also want to summarize this now. This query window has intellisense built in. If you’ve languages like SQL, TSQL, or <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/enabling-diagnostic-logs-using-powershell/">PowerShell</a>, there are a lot of similarities. Although, this language is different. The intellisense will help us summarize and understand what we need to do. So here we can see if we click summarize, there’s some information. It explains to us how we need to do it so we can do “count by” and then the field we want. In our case, we want to summarize and count records by direction. And we can see we’ve had as many packets going in as going out. The next thing we’re really interested in doing is seeing this in time boxes. What we’re going to use is a bin. Bins allow us to aggregate this data into different categories of time. So, if we do bin, I’ll need Time Generated, and we’ll do one-hour buckets, so we just type in 1HR there. And if we run that query, we can now see the total traffic going in and out over time, and if we click chart, we can see each packet coming in and out and we’ve split that data. So, once we’ve got our specific queries we can <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/alerting/">create alert rules</a>, again for diagnostic information you’re trying to find. You can generate charts to put back on the dashboard yourself. There are a lot of other things you can do once you have this query from the diagnostic data. So, that’s a brief overview of how to view the data in the storage account and how to write queries against that data.</p>
<h1 id="Alerting"><a href="#Alerting" class="headerlink" title="Alerting"></a>Alerting</h1><p>In this section, we’re going to look at the Azure Monitor. The Azure Monitor is the central component built into the Azure fabric. The Monitor provides infrastructure-level monitoring and logging for supported services and is central to all monitoring toolsets in Azure. When you’re creating an alert, you have to understand what type of signal you’re going to monitor. There are two types: Metric Alerts and Log Alerts. You can collect Metric Alerts like CPU memory, disk usage, and network usage. In addition, there are metrics specific to Azure resources like “under DDoS Attack or not”. </p>
<p>There are also activity log alerts which look for events like create or update network security groups. So you can monitor administrative changes to your infrastructure. An alert consists of three parts: the Target which is the specific Azure resource that is being monitored, the Criteria, which is the conditional logic that will trigger the Action, and finally the Action, which is the call sent to an Action Group. An action group is a reusable collection of notifications defined by the user. These notifications can be a wide variety of actions such as voice call, SMS, email, call to a webhook, or trigger an automation runbook. In addition, you can push data into other resource tools like creating an ITSM ticket or a logic app. Alerts can be set up to trigger a specific action group, and action groups can be reused by different alerts. For this email alert, the receiver will get a confirmation email letting them know that they are in the alert action group.</p>
<h1 id="Analyzing-and-Creating-Alerts"><a href="#Analyzing-and-Creating-Alerts" class="headerlink" title="Analyzing and Creating Alerts"></a>Analyzing and Creating Alerts</h1><p>For this next example, let’s use a WordPress website running as a PaaS service to create an alert looking for page 404 HTTP responses and send ourselves an email. So, the first thing you want to do is go to the Monitor in Azure and select <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/alerting/">Alerts</a>. Again, this is a central place to record all the alerts. We can see here we’ve got a total of alert rules (14), and 8 are enabled. You’ll also notice here that there are different severities, so when you create your alert, you can choose your severity. This helps you collect all your infrastructure into a single place and gives you an idea of what’s critical and what’s not. So, we’re going to create a new rule, and here are the conditions we mentioned earlier: an alert condition, which is a target, and criteria. There’s the alert action, where you define the rules, severity, and the action group. So, the first thing we do is select a target, and select App Services, and we can see Azurefieldnotes. We’ll select that. We can now see what’s our target, and we want to add the criteria. So what we do notice here is there are 168 different signals we can alert on.</p>
<p>So as we said, there are some metrics, these come from the platform itself, and there are also activity logs. Within the activity logs, there are different categories. So here’s Administrative, Security, Recommendations, and Policy. In our case, we want to alert on Http 404. When we select the metric signal, we get a sample graph of data collected over the last 6 hours. We also see, in this case, there happen to be multiple instances because, in the App Services plan, there are three instances that run this website. So we want to select all of them, and what this allows us to see is a sum of the time of each of these. So before, when we had the aggregation, we can see that above 40 is where we want alerts.</p>
<p>So we want to ignore these bumps and just alert when we have this kind of spike. So, we’ll make it 50. We’re not going to select a specific instance, and we’re just going to say when greater than a total aggregation of 50, and select Done. Now we’re going to put in an alert name for our rule. We’ll call it Page404 Greater than 50. And we’ll set it to severity 3. Enable the rule upon creation. And now we need to create an action group. We’re going to do a new action group. We’re going to call this WebAlerts and also have a short name of WebAlerts. We need to choose a resource group to put this in. We have a default resource group here that’s already set up. Then we choose email, and we’re going to send an email to Matt. Select OK…and OK.</p>
<p>So we need to wait for that action group to get created. It’s done, so it added that for us. If we already had an action group we wanted to use, we could say “Select action group” and see our existing action groups that we’ve already created. In this case, we’re using a new one. Click “Create rule”. As we wait for that rule to be created, we should get an email that tells us we’ve been added to the action monitor group. This allows us to know that we can receive the email and that the alert is set up. If we go back to Manage alerts, we can see our “Page404 Greater than 50” response. Here’s the Target Resource, Target Resource Type, and the Signal. So that’s our alert. If we look in here, we can go and modify the conditions if we need to. Here we can see the bar where it’s going to get triggered. And that’s it for creating an alert.</p>
<h1 id="Azure-Advisor"><a href="#Azure-Advisor" class="headerlink" title="Azure Advisor"></a>Azure Advisor</h1><p>Azure has some built-in algorithms to help identify cost savings. These can vary depending on how you use the system, but it’s worth taking some time to review the suggestions and recommendations. One of the most common recommendations, if you have long-running virtual machine instances, is to purchase reserved instances. If we take a look at the screenshot, the Azure Advisor shows nine VMs it has determined to be around long enough to suggest that if we had reserved instance, and made a commitment to these resources, we could potentially save $2,700 US per year. Advisor recommendations are based on the last 14 days of usage and target low utilization systems.</p>
<p>Recommendations could include:</p>
<ul>
<li>Eliminating unprovisioned ExpressRoute circuits. It identifies ExpressRoute circuits that have been in the status of Not Provisioned for more than a month.</li>
<li>Deleting or reconfiguring idle virtual network gateways (virtual network gateways that have been idle for over 90 days). Since these gateways are built hourly, you should consider reconfiguring them or deleting them if you don’t tend to use them anymore.</li>
<li>Based on usage, recommending a more appropriate VM size. Virtual machines whose CPU utilization is 5% or less, and the network usage is 7 meg or less for four days or more, are considered low utilization virtual machines.</li>
</ul>
<h1 id="Resource-Baseline"><a href="#Resource-Baseline" class="headerlink" title="Resource Baseline"></a>Resource Baseline</h1><p>A baseline is helpful to ensure that your systems operate as expected. It’s good to be able to track what has changed since the resources were first deployed. Azure Resource Manager, or ARM, allows us to use JSON files called ARM templates to define resources in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. This template uses what’s described as declarative syntax rather than scripts. That allows us to repeatedly deploy resources with great consistency and allows us to determine if the resources have changed from their original state. Declarative syntax means you define what the resources look like, and their dependencies between the resources, and the Azure Resource Manager takes care of the actual deployment. With a template, you can use Desired State Configuration packages (or DSC). These packages are the same within the operating system. </p>
<p>You can define a declarative configuration, and the provider takes care of ensuring the operating system looks like what you have defined. This style of configuration is often referred to as infrastructure as code. A benefit of using this method is that the configuration code can be submitted to a version control system to ensure that the changes are tracked and approved. This is in contrast to using scripts that execute command line operations in batches. Another approach can be to use change tracking. Change tracking is a solution that can be added to Azure resources and works by using Log Analytics and Azure Automation. You can enable this on a virtual machine. Once this feature is enabled, activity logs are collected in Log Analytics and analyzed and a dashboard is created to help identify events and changes to the operating system. The screenshot here shows Windows services and software have changed on this operating system.</p>
<h1 id="Monitoring-Cost-Consumption"><a href="#Monitoring-Cost-Consumption" class="headerlink" title="Monitoring Cost Consumption"></a>Monitoring Cost Consumption</h1><p>Understanding costs is very important when operating in the cloud at any scale. Over time, it can become a difficult task to understand exactly which groups or systems are costing you a lot of money. We will cover some tools and methods that will hopefully help keep your costs under control.</p>
<p>One of the first steps is to utilize Resource Tagging. Tagging exists on every resource in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> whether the resource is free or charged by usage. This tagging structure is completely up to you and your organization. It is department based, cost center based, or you could just put the person’s name on the resource. Here we can see we have added three tags to a resource group: Solution, Owner, and Environment. You can also include resource tags within your JSON ARM templates or through PowerShell.</p>
<p>Here’s how to view costs by resource tag. In the Azure portal, go to the ‘Cost Management and Billing’ section. In the Cost Management section, go to Cost Analysis, then select ‘Group by’ and select ‘Tag’ from the bottom of the drop-down menu. In this screenshot, we can clearly see that tagging has only been partially successful, with the largest cost under ‘Subscription’ coming from untagged resources.</p>
<h1 id="Resource-Tagging"><a href="#Resource-Tagging" class="headerlink" title="Resource Tagging"></a>Resource Tagging</h1><p>It is worth noting that you can enforce tagging through <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> policies, meaning no matter how a user or administrator tries to deploy a resource, if they don’t have appropriate tags defined, the deployment will fail. Alternatively, you can use auditing, which will allow the deployment to continue but will issue a warning. These resources will be marked as non-compliant in the Azure policy service. Let’s take a look at creating a policy to audit and enforce tags. We’re going to leverage some Azure policy samples for resource groups located here at this GitHub project. We will use PowerShell to deploy these definitions. Note that you will require subscription owner rights to execute the following commands. Here we have the “deploy audit resource tag policy” PowerShell command. We are using the New-AzureRmPolicyDefinition commandlet and referencing the GitHub project (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure</a>). </p>
<p>We’ve also filled out the description and the different parameters required to execute this command. This command here will show us how to deploy the “enforce resource tag” policy PowerShell command. In the Azure portal, under policy services and definitions, if we search for the keyword “Tag”, we’ll get these results. We can see the four built-in policies and the two custom policies we just created from the JSON template using PowerShell. If you select the assignment from the left side of the navigation bar, you’ll be able to create an assignment using this policy. Here is a screen showing the fields required to create an audit policy for the resource tag Owner. We are going to create an assignment of an audit policy for the resource tag Owner. We can see here the policy definition is what we created through PowerShell and an assignment name and description with the final text box being tag name having the resource tag you want to audit. Once the policy has been evaluated, we can see the compliant and non-compliant numbers of resources. You can also assign enforce policies to ensure that during deployment tags are assigned. If they are not, the deployment will fail. If you would like to learn more about creating policy definitions, here is a reference link (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure</a>).</p>
<h1 id="Azure-Cost-Management"><a href="#Azure-Cost-Management" class="headerlink" title="Azure Cost Management"></a>Azure Cost Management</h1><p>Azure Cost Management. Microsoft had previously purchased and integrated Cloudyn as a separate cost management solution that was accessible through the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. This functionality has now been fully integrated into the portal. The Azure portal now provides native tooling with Azure Cost Management. You can apply budgets to create alerts, to monitor spend, and you’re able to take proactive action before the end of a billing cycle.</p>
<p>We’re going to be looking at generating some reports for use to monitor cloud spend. There are a series of built views for accumulated cost, cost by resource, daily costs, cost by service, and invoice details. There is also the ability to slice and group data so you can track down where your Azure spend is. We will look at <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/cloudyn/">Azure Cost Management</a> in the next demo.</p>
<h1 id="Azure-Cost-Management-Demo"><a href="#Azure-Cost-Management-Demo" class="headerlink" title="Azure Cost Management Demo"></a>Azure Cost Management Demo</h1><p>Let’s start the demo. For this demo, I’d like you to note that I’m using not the portal.azure.com. I’m actually gonna be using the preview portal as this will likely be in production in the near future. So that is a slight difference between what you may see.</p>
<p>Here, we have the cost analysis. So we can get to here from the dashboard, and we go down to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/cost-management-report/">Cost Management</a> and Billing. Got a couple of subscriptions here. We’ll go onto the one that’s got some charges in it, and we can see cost by resource. So let’s jump into cost analysis, and we can see the charts have loaded. So we have the ability to choose different reports, different ways we view costs. There’s accumulated cost or amortized cost.</p>
<p>So the first thing here is amortized cost is used over a period of time. So if you have Windows licenses or one-off purchases, you can have that spread over a longer month or the one-off charge. We could also see it in US dollars if that’s helpful. We also have the ability to choose different views. So these are the accumulated costs.</p>
<p>So we could also look at the cost by resource, and we can see the individual resources and the meters that they’re spending. So here it’s a premium SSD, and that’s the meter, and it’s cost that much. And that’s over this time period. So we can also change that to be last month, last seven days, there’s a bunch of predefined ranges here, and you can also choose your own custom dates. So if we do this quarter, still very low charges here.</p>
<p>If I can also choose now the cost by service, we can see we’ve got it by months, and we have these charts here that we can help drill down into. So, for location or resource group, you can choose to group the data differently. So we could say, let’s group by resource rather than by resource group. Hence, now we have a different summary down here.</p>
<p>So we can see our most expensive resource group here is $74. And you can also click on these charts to filter down the graphs. So, when we look at this over the month, we’ll see, now there’s where our charges come, and this is basically one resource is taking up all our charge. There’s also the ability to choose the granularity. So the granularity, again, could be daily. How detailed do you want the data? Microsoft will summarize some of this data after a period of time, but the reporting still has an aggregate, which allows you to report on it.</p>
<p>So we can see here, these are obviously the end of the month where it rolls over, but we’ve now gone to daily granularity. And this is an interesting one. We can see it over time. So we can see this one stopped running and maintained its cost, this one’s run the same over the whole time, and here was a new charge that started, and it’s been running consistently since. Again, if we click on that one result, we can drill into it. So we can see this is a disc, it’s in US West, and it’s storage. We can also choose to save these views, and you can also make them private, so it’s useful for enterprise management. You can share these views with people.</p>
<p>The other option here under Settings is we can set up an export. The first thing we’re gonna need to do is actually register the resource provider for that. So I’ve got another page here, which has my subscription, and if I go into the subscription, we can see the resource providers down here, and we can see cost, management, exports. In this case, it’s already registered.</p>
<p>So if I go back to the schedule export, choose a name, sample, we’re gonna choose weekly cost for the last seven days, and the storage account’s gonna be me, cost, export. Next and Create. And that says there, your first export will be available in four hours. So there’s the export sample data. Run now. Successfully queued. So we can create different jobs to export data. We’ve also seen the different ways we can drill down into it. We’ve looked at granularity. You can also choose different visualizations to help you understand how your data is being displayed. I can also view it on a table, which you can download and export. So here, we can see download to Excel, CSV. If we download to Excel, we can see that cost file’s come down now, and our export data isn’t too different, and here’s our data.</p>
<p>So we can see the charges, the billing period, and if we chose by resource, we’d also have that sort of data inside this table. We also have the ability under the Settings tab to connect AWS. So if we click on that, we can add a connector. This will add AWS properties, and allow you to review those costs inside the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal as well. Gonna go back to the cost management, and into here again, and look at budgets as the final thing.</p>
<p>So the final thing we’re gonna do is create a budget. If we click Add, we get the choice to change the scope to a different subscription. We’re gonna add ourselves $100 budget. We can choose the expiration and start of this budget. We can see there’s a suggested amount here. Now, you have to wait for the cost data to appear, and we can see where this budget is. So previously we were spending over 120, this month was 180, and it’s dropped over since then. So I don’t wanna spend that again. Just wanna make sure that we don’t catch that cost.</p>
<p>So if we go Next, we should see the percent of budget. So I wanna know when I’m at 80%, and that’s $80, and I wanna send an email to an action group, so I’ve already created this earlier, but you can manage that through this link. And then, I also wanna know when I’m at 100% of that budget. You could send an SMS or trigger an action, different action as well. It’s saying to also make sure you add this to your spam email, just in case you miss the emails. We’re gonna click Create, and that’s our budget. Budget 100 successfully created. And we can see if we’ve got a progress through that budget at the time.</p>
<p>This brings us to the end of the demo. I hope you found this useful.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>This session covered a wide range of topics and was focused on understanding diagnostic logging and what the differences are between activity logs, resource logs, and guest OS logging. We looked at various ways to enable diagnostic logging, including through the portal, PowerShell, CLI, and through Resource Group templates. We looked at where we could send the information: into a storage account, blobs for files and tables for metrics, event hubs for streaming information, and into Log Analytics where we could run queries against the data and enable a range of out-of-the-box solutions. We also looked into creating alerts and sending them to an action group and exploring ways we could baseline deployed resources using armed templates, DSC, and change tracking. </p>
<p>In the final section, we covered material around tracking costs, including applying and enforcing resource tags, creating and running reports, and scheduling reports to be sent via email or saved to a storage account. I hope you’ve enjoyed this course and you found it useful.</p>
<h1 id="13Resource-Tagging"><a href="#13Resource-Tagging" class="headerlink" title="13Resource Tagging"></a>13<strong>Resource Tagging</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">Creating Policy Definitions</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Lab-Manage-Access-to-Azure-With-Role-Based-Access-Control-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Lab-Manage-Access-to-Azure-With-Role-Based-Access-Control-8/" class="post-title-link" itemprop="url">AZ-500-Lab-Manage-Access-to-Azure-With-Role-Based-Access-Control-8</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:30" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:30-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:16:58" itemprop="dateModified" datetime="2022-11-20T19:16:58-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Lab-Manage-Access-to-Azure-With-Role-Based-Access-Control-8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Lab-Manage-Access-to-Azure-With-Role-Based-Access-Control-8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Managing-Role-Based-Access-Control-on-Azure-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Managing-Role-Based-Access-Control-on-Azure-7/" class="post-title-link" itemprop="url">AZ-500-Managing-Role-Based-Access-Control-on-Azure-7</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:28" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:28-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:15:50" itemprop="dateModified" datetime="2022-11-20T19:15:50-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Managing-Role-Based-Access-Control-on-Azure-7/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Managing-Role-Based-Access-Control-on-Azure-7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to Managing Role-Based Access Control on Azure. My name is Eric Leonard and I’ll be leading you through this course. I’m a Microsoft Azure MVP and an Azure content author at Cloud Academy. I have over 15 years of experience in IT, several of those working with cloud technologies in the public and private sectors. If you have a question, feel free to connect with me on LinkedIn and send me a message, or send an email to <a href="mailto:&#x73;&#x75;&#x70;&#x70;&#111;&#x72;&#116;&#64;&#99;&#x6c;&#111;&#117;&#x64;&#97;&#x63;&#x61;&#100;&#101;&#x6d;&#x79;&#46;&#x63;&#111;&#x6d;">&#x73;&#x75;&#x70;&#x70;&#111;&#x72;&#116;&#64;&#99;&#x6c;&#111;&#117;&#x64;&#97;&#x63;&#x61;&#100;&#101;&#x6d;&#x79;&#46;&#x63;&#111;&#x6d;</a>. Who should take this course? This course is intended for people who want to take the AZ-101 exam to become a certified Azure administrator, or for people who are tasked with administrating Azure resources and security.</p>
<p>To get the most from this course, you should have a general understanding of the Azure portal. We’ll begin the course by touching on an overview of managing role-based access control on Azure. We will then work through how we configure access to Azure resources, create custom roles, and finally go over some troubleshooting steps. By the end of this course, you should be able to configure and assign the appropriate role-based access controls. We would love to get your feedback on this course, so please give it a rating when you are finished. So if you are ready to learn more about managing role-based access control, let’s get started.</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>RBAC provides fine-grained access management to your resources in Azure. What this does is it allows you to segregate duties between different teams in your organization. As an example, one team could be tasked with managing VMs and a subscription, or someone could be tasked with cost management, or give your IT security team access to Azure Security Center. Making these RBAC examples work is by creating role assignments. Role assignments define how you can access resources in Azure. This can be at the management group level and all the way down to the resource itself. A role assignment consists of three elements, the security principal, the role definition, and the scope you apply it to. A security principal can be a user, group, service principal, or managed identity that requires access to Azure resources. A role definition is a list of actions that you can or cannot do. Your role definition could allow you to create and manage virtual machines but prevent you from deleting them. </p>
<p>The following are the most common or known RBAC roles. Owner provides full access to resources in Azure, and you can delegate access to other users. Contributor, just like the owner role, provides full access to resources in Azure, but you cannot delegate control. As the name implies, the reader can only view resources in Azure. And lastly, the user access administrator role is granted permission to manage access to Azure resources. Beyond these fundamental roles, Azure provides many built-in roles to meet your organization needs. As an example, the security admin role provides access to Azure Security Center, where they can read, edit security policies, and view and dismiss alerts. The last element is scope. In Azure, the RBAC roles can be assigned at different levels depending on how wide you want to provide access. Scope can be applied at the management group level, or at the subscription, or at the resource group, all the way down to individual resources. Combining these three elements makes the role assignments work by defining the role definition it will apply to a security principal and then is assigned to a scope.</p>
<h1 id="Configure-Access-to-Azure-Resources"><a href="#Configure-Access-to-Azure-Resources" class="headerlink" title="Configure Access to Azure Resources"></a>Configure Access to Azure Resources</h1><p>Role-based access control is how you can manage access to resources in Azure. As you navigate through Azure, from the management group, subscription, resource group all the way down to the individual resources, you will notice a blade called Access Control IAM. This is where you can view, add and remove role assignments. Let’s go to the Azure portal and see how we can view, add and remove these role assignments. Here we are in the Azure portal under Resource Groups. Let’s select our resource group and we will notice that we have a virtual machine that is already deployed. Let’s give access to Ari as he is tasked with managing all virtual machines in this resource group. Click on Access Control. To add a role assignment, we can add it by clicking on the Add button on the right-hand side or we can hit the Add Role Assignment in the menu bar. Under Role, we will see a list of all the built-in roles possible. And we’ll scroll all the way down to Virtual Machine Contributor. In the Select field, we can search for Ari’s name, select his name and hit Save. Now Ari has access to this user’s group and to manage the virtual machine. </p>
<p>We can check Ari’s access by typing in his name. And here we’ll see the results of the access that he has. We can close that. As well as you can go to Role Assignments. Here we’ll see all of the role assignments for the resource group. Some of them are inherited and Ari is at the bottom, we’re a virtual machine contributor for this resource group. We can remove Ari’s access by selecting his user and clicking Remove. In this short demo, we added our user, Ari, to the virtual machine contributor role. We then verified his access by going to Check Access and reviewed the Role Assignments tab. We then finished off by removing the role assignment to the resource group.</p>
<h1 id="Activity-Logs"><a href="#Activity-Logs" class="headerlink" title="Activity Logs"></a>Activity Logs</h1><p>The Azure Activity Log provides visibility into subscription-level events that have occurred in Azure. Using the Activity Log, you can determine what operations were taken on the resources in your subscription. The Activity Log has eight categories. Administrative. This will contain all the records for create, update, delete, and actions operations performed. Here we will see events related to RBAC like create role assignment and delete role assignment. Service health. Service health will contain any health-related events that affect Azure. Resource health will contain the records of any resource health events that have occurred to your deployed resources in Azure. Alerts will contain all the alerts that were activated. Autoscale will include the records related to autoscaling. Recommendations. This will have the recommendations from Azure Advisor. </p>
<p>Security, which will contain all of the logs generated by Azure Security Center. And finally, policy. The policy will contain records of all effect actions performed by Azure Policy. The Azure Activity Log only retains records for the last 90 days, and if you need to keep them longer for auditing or compliance reasons, you will need to use an Azure Event Hub to send your logs to your security information and event management application or archive the records in an Azure storage account. For Role-Based Access Control, the Azure Activity Log will log any changes made to role assignments or role definitions in your subscription. The events will be recorded as create role assignment, delete role assignment, create or update custom role definition, and delete custom role definition.</p>
<h1 id="Custom-Roles"><a href="#Custom-Roles" class="headerlink" title="Custom Roles"></a>Custom Roles</h1><p>Create a custom role for RBAC. Azure has many built-in roles that cover most of the needs for any team, but sometimes those built-in roles don’t cut it. You can create your own custom role to meet those needs. Custom roles can be created using Azure PowerShell, Azure CLI or the REST API. For this demonstration we will use the Azure Cloud Shell to create a custom role using Azure CLI. Here we are back in the Azure portal, where we will create a custom role. To start we need to go to the Azure Cloud Shell. We can open the Cloud Shell by selecting the Cloud Shell icon at the top of the page, or we can open a new tab and go to shell.azure.com. We will be creating a custom role called Virtual Machine Operator. Let’s open Visual Studio Code and look at our custom role. Our template is broken down into several sections. We have the name of the custom role, then we have the IsCustom, which indicates that this is a custom role. We have the description, which provides a short description of the role so others can understand what this custom role does. Action, which specifies what you’re allowed to do. NotActions, which is to deny actions. And AssignableScope, this is where we will list our scope for our custom role. </p>
<p>Let’s apply the custom role to the subscription. Type in AZ role definition create dash dash role definition and the name of the file, which is vmoperator.json, and hit Enter. After we have applied the command we can go back to the Azure portal, where we will select our resource group and go to Access control, Roles and scroll to the bottom to find our Virtual Machine Operator custom role. You will notice that the icon is different to easily indicate that this is a custom role. If during your testing of the new custom role, you notice that the role cannot do a certain action, you can return to your role definition and add the missing action. In this instance we will allow the role the ability to schedule shutdowns. We will add the Microsoft.DevTestLab&#x2F;schedules. We will then save the file and then we’ll type AZ role definition update dash dash role-definition and the name of the file. If the custom role is no longer needed you can delete it by typing AZ role definition delete name and provide the name of the custom role. In summary, we looked at a custom role definition and reviewed all the sections. We then created a new custom role, updated the role and then deleted the roll as we no longer needed it.</p>
<h1 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h1><p>Role-based access control changes in Azure don’t always go as planned. Let’s look at some scenarios where you may encounter issues. Scenario one. You can’t create a new resource in a resource group. Check access control to verify the user has the appropriate role assignment. If the user is part of a custom role, verify that the role definition can deploy that resource. Scenario two. You attempt to add a role assignment in your subscription and you receive an error role assignment limit exceeded. In your subscription, there is a limit of 2,000 role assignments. If you see this error, consider assigning roles to groups instead of individual users. Scenario three. You attempt to create or update a custom role but you get an error. Confirm that the user has the Microsoft.Authorization&#x2F;roleDefinition&#x2F;write permission. Scenario four. You attempt to create a new custom role and you receive an error role definition limit exceeded. In your tenant, there is a limit of 2,000 custom roles. Scenario five. You make a change in Access Control or you add a custom role and the changes do not reflect in the portal or in the console. Sometimes these changes can take time to take effect. You can log out and re-log in to force the refresh.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>I hope you enjoyed learning about managing role-based access control on Azure. Let’s review what you learned in this course. RBAC provides fine-grained access management to your resources in Azure. A role assignment consists of three elements, the security principal, that’s the user group, service principal, or managed identity. Then we have the role definition, that’s the role definition which is a list of actions that you can or cannot do and lastly, the scope that it applies to. We configured access to Azure resources by going to Access Control at the resource group level where we can also make these modifications at the management group, subscription or individual resource levels. In the resource group, we added a role assignment, checked the individual access, reviewed the role assignments and then removed the access. The Azure Activity Log provides visibility into subscription-level events that have occurred in Azure. Using the Activity Log, you can determine what operations were taken on the resources in your subscription. </p>
<p>The RBAC events will be recorded as create role assignment, delete role assignment, create or update custom role definition and delete custom role definition. Activity logs are kept for only 90 days and if you need them for auditing or compliance reasons, you will need to export your logs using an event hub or a storage account. Custom roles can be created in Azure to meet the necessary requirements. You can use the Azure Cloud Shell with Azure CLI or PowerShell to create, update and delete role definitions. Adding role assignments or creating custom roles in Azure can lead to configuration errors. We reviewed some common scenarios in troubleshooting RBAC. To learn more about managing role-based access, be sure to read Microsoft’s documentation. Be sure to also watch for new Microsoft Azure courses on Cloud Academy because we’re always publishing new courses. Please give this course a rating. If you have any questions or comments, please let us know. Thanks for watching and happy learning.</p>
<h1 id="4Activity-Logs"><a href="#4Activity-Logs" class="headerlink" title="4Activity Logs"></a>4<strong>Activity Logs</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log#send-to-log-analytics-workspace">Sending to a Log Analytics Workspace</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6/" class="post-title-link" itemprop="url">AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:27" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:27-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:14:18" itemprop="dateModified" datetime="2022-11-20T19:14:18-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to managing Azure subscriptions and resource groups. My name is Thomas Mitchell and I’ll be leading you through this course. I’m an Azure content author at Cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions, feel free to connect with me on LinkedIn or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course was developed with an eye toward people who want to become certified Azure architects or those who are simply tasked with managing and supporting Azure resources. To get the most from this course, you should have a general understanding of Microsoft Azure.</p>
<p>In the first part of this course, we’ll cover the management of Azure subscriptions. More specifically, we’ll take a look at some of the key built-in roles that are used to manage Azure subscriptions. These roles include contributor, owner, reader, and user access administrator. You’ll learn what each role does and what permissions each role grants. We’ll then get into subscription policies and how to apply them.</p>
<p>The second part of the course will cover resource groups and it will talk about resource policies and how to assign them. We’ll also cover resource locks and tagging. In addition to some lecture time, we’ll work through a few demonstrations to reinforce the concepts covered.</p>
<p>We’ll wrap up the course by covering how to move resources between resource groups and how to delete resource groups altogether.</p>
<p>By the end of this course, you should be able to effectively manage Azure subscriptions as well as resource groups within those subscriptions.</p>
<p>We love to get your feedback, so please give this course a rating when you’re finished. So if you’re ready to learn about Azure subscriptions and resource groups, let’s get started.</p>
<h1 id="Overview-of-Key-Roles"><a href="#Overview-of-Key-Roles" class="headerlink" title="Overview of Key Roles"></a>Overview of Key Roles</h1><p>Hello and welcome to key roles. To effectively manage Azure subscriptions and resource groups, you must be familiar with the different RBAC roles. What we’re going to do here is take a look at some of the key built-in roles along with some of the other more important RBAC roles.</p>
<p>The four key roles that I want to introduce you to are contributor, owner, reader, and user access administrator. The contributor role is used to grant full access to manage all Azure resources. However, this role does not allow the user to whom it’s been assigned to assign roles in Azure RBAC. In other words, a user with a contributor role assigned to him can only manage resources. He cannot assign roles to other users.</p>
<p>The owner role is similar to the contributor role. However, as you might expect, it grants additional permissions. Like the contributor role, the owner role grants the user to whom it’s been assigned full access to manage all Azure resources. However, it also allows the user to assign roles to other users in Azure RBAC. The owner role can be viewed as essentially having the keys to the kingdom for whatever resource it applies to.</p>
<p>The reader role is pretty self-explanatory. A user that’s been assigned the reader role will be able to view resources or read them, but will not be allowed to make any changes. User access administrators are allowed to manage user access to Azure resources and that’s it. They have no access to the actual resources themselves. Rather, they manage the access to those resources.</p>
<p>Now, these four key roles are not by far the only roles that are used to manage Azure subscriptions and resource groups. There are literally dozens or maybe even hundreds of different roles that are available depending on the Azure resource that you’re talking about. For example, for compute resources, we have roles like the virtual machine contributor which allows you to manage virtual machines without providing access to them. This role also blocks access to the virtual networks and storage accounts that virtual machines are connected to.</p>
<p>Other compute roles include virtual machine administrator login, virtual machine user login, and classic virtual machine contributor. There are even more built-in roles for networking resources, including network contributor which allows you to manage networks, but not access them.</p>
<p>There are several CDN-related roles as well that allow for different levels of CDN management. There are also several other networking-related roles to choose from. The same thing goes for storage, web, containers, databases, and a host of other types of Azure resources. The <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">URL</a> on your screen provides a complete and updated list of all the different built-in RBAC roles that come into play when managing Microsoft Azure.</p>
<p>Now, I should point out that you aren’t going to be expected to memorize a list of hundreds of different roles, that’s just not practical, but you should really familiarize yourself with the four key roles that I mentioned earlier. They include the contributor role, the owner role, the reader role, and the user access administrator role.</p>
<p>You should also be aware that in addition to all of these built-in roles, you can create custom roles when necessary as well. That being said, the built-in roles are more often than not sufficient for typical environments. Join me in the next lesson where I’ll demonstrate how to add an owner to an Azure subscription.</p>
<h1 id="DEMO-Add-an-RBAC-Owner"><a href="#DEMO-Add-an-RBAC-Owner" class="headerlink" title="DEMO: Add an RBAC Owner"></a>DEMO: Add an RBAC Owner</h1><p>Hello, and welcome back. what I’m going to do here in this demonstration and admittedly, it is a, a brief demonstration but I wanted to just make sure that I showed you how you can use our back to add an owner to a resource or to a subscription.</p>
<p>So what we’re going to do here is add a second owner to the Azurelabs subscription here in my Azure environment. On the screen here, I’m logged in as the administrator for my red widget corporation a fictitious organization here, I guess it you will.</p>
<p>Now to add an owner to my subscription, I simply select my Azurelabs subscription here from my Microsoft Azure homepage here and then from Azure labs here see this access control here, or I am entry. What we do here is we go into access control. And from here, we can look at the existing role assignments for this specific subscription, and we can see we have administrator here as owner.</p>
<p>Now, if I want to add an owner to this subscription what I can do is click the add button here up in the top menu pane here. And we can add a role assignment, we can add a co administrator, or we can add a custom role.</p>
<p>What we’re going to do here is Add role assignment and then from here, we’ll select Owner. And then what we’ll do is we’ll make Joe Kinish an owner of this subscription. And now we can see that under the owner role assignment here for the Azure subscription, we have Joe Kinish listed and we can do the same thing for a complete resource group.</p>
<p>If we go back home here and we go into our Azurelabs resource group here we can see the focus is at the resource group level. And again, we use the access control entry here, or I am we can look at the existing role assignments and we can see Joe Kinish is already an owner at the resource group level because it’s inherited from the subscription. But if I wanted to add a user as an owner specifically at this level directly on the resource group we do the same thing, we click Add we’d Add role assignment, select Owner. And then what we could do is we could make, say Lester Murphy an owner here and there you have it. And that’s pretty much it. That’s how you add an owner at both the subscription level and at the resource group level.</p>
<h1 id="DEMO-Add-or-Change-Azure-Subscription-Administrators"><a href="#DEMO-Add-or-Change-Azure-Subscription-Administrators" class="headerlink" title="DEMO: Add or Change Azure Subscription Administrators"></a>DEMO: Add or Change Azure Subscription Administrators</h1><p>Hello and welcome back. In this brief demonstration here, what we’re gonna do is walk through the process of adding or maybe changing an Azure subscription administrator. Now on the screen here, I’m logged into the Azure portal. I’m at my home page here, and I’m logged in as an administrator here.</p>
<p>What we’re going to do is browse to Azure labs through either the recent resources that I’ve worked with which is a subscription here, or I can navigate to subscriptions under the navigate section here or I can browse to subscriptions through Azure services.</p>
<p>What I’ll do here is browse to subscriptions. And then from here, I can see I only have one Azure subscription here and it’s called Azure labs. So we’ll go ahead and open up our subscription. And it takes us to the overview page.</p>
<p>To add or change subscription administrators for this subscription, what we’re going to do is browse into access control. And before I do that, I just wanna make a quick note here. The Azure portal changes rather frequently or at least more frequently than I’d like it to. So don’t focus as much attention on where you’re clicking, the actual physical location, but more on what you’re clicking. And in this case we want to use, I am or access control for the Azure lab subscription.</p>
<p>So if you try this in your own environment and this access control link is somewhere else in the list then that’s fine. The idea is you wanna click access control. So that PSA out of the way, let’s go ahead and get into access control here. And we can see from access control.</p>
<p>What we’re going to do is add a subscription administrator. And to do that, we click add here, and then we have a couple options. Role assignment, the co-administrator which is what we’re going to do here or we’re going to add a custom role.</p>
<p>So to add our administrator, which is essentially a co-administrator, we select the co-administrator option and then from here, we can select the user we want to make a co-administrator. So for this demonstration here, we’ll select John Gold and we’ll make him a co-administrator of this Azure labs subscription. And if we select role assignments here we can see that our new co-administrator and even administrators for that matter are not shown. That’s because these permissions are not role assignments. They’re actually permissions over the subscription for actual administrators.</p>
<p>Now to remove that co-administrator, we can actually go into classic administrators. And that’s because this is more of a classic role. If we select classic administrators, we can see that John Gold is listed as a co-admin. And this is the important piece here. We can see that classic administrators are only needed if you’re still using Azure classic deployments.</p>
<p>If you’re not using Azure classic deployments you wouldn’t be assigning co-admin roles within your subscription. But I wanted to just show you what that was because if you happen to go into, I am, you’ll see that option here. So I wanted to at least let you know what this is and how you use it.</p>
<p>So what we’re going to do here is we’re going to remove John Gold as a classic administrator. And there we now have our classic co-administrator access removed for John Gold. Then from here, we’ll bounce back to the role assignments.</p>
<p>And from here, this is where you would want to grant the permissions to the subscription as you see fit. So with that, let’s call it a wrap and I’ll see you in the next lesson.</p>
<h1 id="Configure-Subscription-Policies"><a href="#Configure-Subscription-Policies" class="headerlink" title="Configure Subscription Policies"></a>Configure Subscription Policies</h1><p>The Azure Security Center creates a default security policy automatically for each Azure subscription. These policies can be edited and monitored for compliance in Security Center. Security Center policies can also be extended by using Azure policy, which is a service in Azure that you use to create, assign, and manage policies.</p>
<p>Because security requirements for development resources typically vary from the requirements for production resources, it’s critical to maintain policies that fit these requirements. As such, security policies are used to drive security recommendations and monitoring. This helps identify potential vulnerabilities and mitigates threats.</p>
<p>As you can see on the screen, the default security policy contains numerous policies and definitions that govern among other things, system updates, security configurations, endpoint protection, and disk encryption. The system updates policy retrieves a daily list of available security and critical updates and recommends that missing updates be applied.</p>
<p>The security configurations policy analyzes OS configurations to identify virtual machine vulnerabilities and recommends configuration changes to mitigate such vulnerabilities.</p>
<p>Endpoint protection and disk encryption policies make recommendations for protecting virtual machines from viruses and data theft. In addition to these policies, other policies are also useful for protecting the environment, such as network security groups, web application firewall, next-gen firewall, SQL auditing, and threat detection, SQL encryption, vulnerability assessment, storage encryption, and just-in-time network access. By leveraging all of these different policies, you can help identify potential vulnerabilities in the environment and mitigate any threats identified.</p>
<h1 id="Overview-of-Resource-Groups"><a href="#Overview-of-Resource-Groups" class="headerlink" title="Overview of Resource Groups"></a>Overview of Resource Groups</h1><p>A resource group in Microsoft Azure is a logical container so to speak. It is used to group a collection of Azure resources, such as virtual machines, VNets, storage accounts, et cetera into logical groupings for easy provisioning, monitoring, and access control.</p>
<p>Resource groups are also very effective for management of costs. A key benefit of using resource groups in Azure is that by grouping related resources together, they typically share a unified lifecycle. Although Azure requires the admin to specify a region when creating a resource group, resources contained within that resource group can span across multiple regions.</p>
<p>The requirement of a resource group being deployed to a specific region comes from the need to store the deployment metadata and definitions associated with that resource group in a specific location. As such, it doesn’t dictate that resources belonging to that resource group need to be in the same region as the resource group itself.</p>
<p>As easy as resource groups make management of Azure resources, it’s important to use resource groups with care. The key to clean and meaningful use of resource groups is an understanding of the resources that are included in them. For example, if a line of business application requires resources that need to be updated together, it makes sense to group these resources in the same resource group.</p>
<p>It’s equally important, however, to use different resource groups to separate out dev&#x2F;test resources, staging resources, production resources, et cetera. This is important because resources in each bucket so to speak will typically have different lifecycles.</p>
<p>In the upcoming lectures and demonstrations, you are going to learn how to manage resource groups by using policies, resource locks, and tags. You’ll also learn how to move resources between resource groups and how to delete resource groups altogether.</p>
<h1 id="Resource-Policies"><a href="#Resource-Policies" class="headerlink" title="Resource Policies"></a>Resource Policies</h1><p>IT governance is critical to organizations. It ensures achievable goals through effective and efficient use of IT by creating clarity between business goals and IT projects. As such, IT governance requires careful planning of initiatives and setting priorities on a strategic level to help manage and prevent issues.</p>
<p>Azure Policy helps accomplish this. Azure Policy is an Azure service used to create, assign and manage policies that enforce different rules over Azure resources. In doing so, such resources remain compliant with corporate standards and SLAs.</p>
<p>Azure Policy accomplishes this by evaluating deployed resources and scanning for those not compliant with the policies that have been defined. An example of this would be a case in which a policy is defined to allow only a certain size of virtual machine in an Azure environment. Such a policy once implemented would be evaluated when creating and updating resources as well as over existing resources.</p>
<p>Managing resources with Azure Policy begins with the creation of a policy definition in the portal. Attached to such a definition are conditions under which it is enforced along with an effect that takes place when the defined conditions are met.</p>
<p>Azure Policy offers several built-in policies that are available by default require SQL Server 12.0 contains conditions and rules to ensure that all SQL servers deployed use version 12. This policy denies all servers that do not meet these criteria.</p>
<p>Allowed Storage Account SKUs contains conditions and rules that determine if a storage account being deployed is within a certain set of SKU sizes. It denies all storage accounts that do not adhere to the defined set of SKU sizes.</p>
<p>Allowed Resource Type contains conditions and rules to specify which resource types can be deployed. This policy denies any resources that are not part of this defined list. Allowed Locations restricts the locations to which resources can be deployed. It is used to enforce geo-compliance requirements. The Allowed Virtual Machine SKUs policy restricts the set of virtual machine SKUs that can be deployed.</p>
<p>Apply tag and its default value applies a required tag and its default value to resources if it is not specified by the user. The enforce tag and its value policy enforces a required tag and its value to a resource. Not allowed resource types enables the ability to specify resource types that cannot be deployed.</p>
<p>To leverage these policy definitions as well as any other custom definitions, they need to first be assigned. This can be accomplished through the Azure portal, PowerShell or through Azure CLI. Policy re-evaluation happens about once an hour. As such, changes to a policy definition after implementation of the policy will be re-evaluated over the resources within the hour.</p>
<h1 id="DEMO-Assigning-Policies"><a href="#DEMO-Assigning-Policies" class="headerlink" title="DEMO: Assigning Policies"></a>DEMO: Assigning Policies</h1><p>Understanding compliance in Microsoft Azure requires the ability to identify the status of resources in a subscription. In this demonstration, we’ll walk through the process of creating a policy assignment to identify virtual machines that are not using managed disks.</p>
<p>To get started, let’s create a policy assignment and assign the audit virtual machines without managed disks policy definition. To do this, browse to the Azure portal, and then click All services. From here, search for Policy, and then select it from the results list.</p>
<p>Click Assignments in the left pane. An assignment is a policy that’s been assigned to take place within a specific scope. Next, click Assign policy from the top of the Policy Assignments page. From the Assign policy page, select a scope by clicking the ellipsis, and then choosing either a management group or a subscription. The scope determines which resources the policy assignment gets applied to.</p>
<p>Click Select at the bottom of the scope page. Exclusions are optional, so we’ll leave this option blank since we aren’t excluding anything. Click the policy definition ellipsis to open the list of available definitions. By default, Azure policy offers built-in policy definitions that you can use. For this exercise, we can search through the list of policy definitions to find the Audit VMs that do not use managed disks definition.</p>
<p>Click on that policy, and then click Select. The assignment name is automatically populated with the policy name, but that can be changed. For this exercise, we’re just going to leave Audit VMs that do not use managed disks. Adding a description is optional. The description, if used, should provide details about the policy assignment itself.</p>
<p>Assigned by is filled in automatically, based on who is logged in. This field is also optional, and as such, custom information can be entered here as well. For this exercise, I’m going to leave Create a Managed Identity unchecked. This option must be checked if the policy being assigned includes a policy with the deploy if not exists effect. Since the policy we are working with in this exercise does not, we can leave it blank.</p>
<p>Click Assign to assign the policy. With the policy assigned, we can identify non-compliant resources To do so, click Compliance in the left side of the page, and then find the Audit VMS that do not use managed disks policy assignment that was created.</p>
<p>Resources that are not compliant with this new assignment will appear under Non-compliant resources. When conditions are evaluated against resources and are found to be true, those resources are marked as non-compliant with the assigned policy. Compliance State results are either compliant or non-compliant. So, as you can see from this demonstration, policies are extremely helpful when trying to ensure resource compliance with predefined standards.</p>
<h1 id="Resource-Locks"><a href="#Resource-Locks" class="headerlink" title="Resource Locks"></a>Resource Locks</h1><p>Day-to-day administration will sometimes require you to lock a subscription, resource group, or specific resource to prevent other users from accidentally deleting or modifying critical resources. When this need arises, you can set resource locks by setting lock levels to CanNotDelete or to ReadOnly you can ensure resources are not deleted or modified.</p>
<p>In the Azure portal, the locks are called Delete and ReadOnly respectively. The CanNotDelete lock allows authorized users to read and modify a resource, but not delete the resource. ReadOnly allows authorized users to read a resource but not delete or update the resource.</p>
<p>Applying the ReadOnly lock is similar to restricting all authorized users to the permissions granted by the reader role. When a lock is applied at a parent scope all resources within that scope inherit the lock. Resources added later, will also inherit the lock from the parent.</p>
<p>The most restrictive lock in any inheritance takes precedence. It’s important to note that applying ReadOnly can sometimes lead to unexpected results because some operations that appear to be read operations are actually operations that require additional actions. For example, a read-only lock on a storage account will prevent all users from listing the keys. This is because the list keys operation is handled through a post request because the keys returned are available for right operations.</p>
<p>Similarly, placing a ReadOnly lock on an app service resource will prevent visual studio server Explorer from displaying files for the resource because displaying files requires right access. To create or delete management locks, you must have access to Microsoft.authorization&#x2F;* or Microsoft.authorization&#x2F;locks&#x2F;*actions. Only the built-in owner and user access administrator roles are granted these actions.</p>
<h1 id="DEMO-Setting-a-Resource-Lock"><a href="#DEMO-Setting-a-Resource-Lock" class="headerlink" title="DEMO: Setting a Resource Lock"></a>DEMO: Setting a Resource Lock</h1><p>To set a resource lock, browse to the settings blade for the resource, resource group or subscription that you wish to lock and then click locks. To add a lock, click add. You can create a lock at a parent level by selecting the parent. Resources will inherit the lock from the parent.</p>
<p>Provide a name for the lock and specify the lock level. You can also add notes that describe the lock if you wish. You can delete a lock simply by selecting ellipsis and then clicking delete from the available options.</p>
<h1 id="Implement-and-Set-Tagging-on-Resource-Groups"><a href="#Implement-and-Set-Tagging-on-Resource-Groups" class="headerlink" title="Implement and Set Tagging on Resource Groups"></a>Implement and Set Tagging on Resource Groups</h1><p>Applying tags to Azure resources provides metadata that’s used to logically organize those resources into a taxonomy. Each tag consists of a name and a value pair. A common example is the use of a tag named Environment along with the value of Production that’s applied to all resources in production.</p>
<p>Applying tags offers the ability to retrieve all resources in a subscription that are assigned a specific tag name and value. Using tags enables the administrator to even retrieve related resources from different resource groups. This is helpful when organizing resources for billing and management.</p>
<p>As helpful as tags, there are some limitations that apply to them. For example, each resource or resource group is limited to a maximum of 15 tag name&#x2F;value pairs that can be directly applied to the resource group or resource.</p>
<p>Another limitation is tag name length. Tag names are limited to 512 characters. Tag values are limited to 256 characters. For storage accounts, the tag name is limited to 128 characters and the value is limited to 256. Virtual machines are limited to a total of 2048 characters for all tag names and values.</p>
<p>It’s important to note that tags that are applied to a resource group are not inherited by the resources within that resource group. Also, tags can’t be applied to classic resources such as Cloud Services and they can’t contain special characters. The ability to apply tags to resources requires the user to have write access to that resource type.</p>
<p>Use the Contributor role to enable the ability to apply tags to all resource types. If it’s necessary to provide the ability to apply tags to only one resource type, use the Contributor role for that particular resource. For example, to apply tags to virtual machines, use the Virtual Machine Contributor role.</p>
<h1 id="DEMO-Tagging-Resources"><a href="#DEMO-Tagging-Resources" class="headerlink" title="DEMO: Tagging Resources"></a>DEMO: Tagging Resources</h1><p>To view tags for a resource, browse to the resource and click overview. From here, click tags. If tags have been applied, they will be listed. If you have not previously applied tags, the list will be empty. To add a tag, select the name dropdown and provide a name and then a value for the new tag and then click save to add the tag. The new tag will now be displayed in the overview window.</p>
<p>You can delete a tag by highlighting it and then clicking the trash icon. Clicking save completes the deletion. If you need to bulk assign a tag to multiple resources, browse to a resource group, or really any list of resources, and click the checkbox for the resources you want to assign a tag to and then click assign tags. When done, click save.</p>
<p>To view all resources with a specific tag, click tags in the left pane and then select the tag from the dropdown box. Click the show resources icon on the right. By leveraging tags, you can make your day-to-day administration of resources far easier and more organized.</p>
<h1 id="Moving-Resources-across-Resource-Groups"><a href="#Moving-Resources-across-Resource-Groups" class="headerlink" title="Moving Resources across Resource Groups"></a>Moving Resources across Resource Groups</h1><p>Day-to-day operations will sometimes require that resources be moved from one resource group to another. While this is possible, it’s important to note that when moving resources between resource groups, both the source group and the target group are locked during the operation.</p>
<p>Write and delete operations are both blocked on the resource groups involved until the move completes. As such, resources can’t be added, updated, or deleted in the locked resource groups while the move is in progress. However, this doesn’t mean the resources themselves are frozen. For example, if you move an application server and its database to a new resource group, the application experiences no downtime. It continues to function as normal.</p>
<p>It’s important to note that the location of a resource cannot be changed. Moving a resource only moves it to a new resource group. While the new resource group may have a different location, this fact doesn’t change the location of the resource itself being moved to the new resource group.</p>
<p>Before moving a resource to a new resource group, there are some important steps to perform to prepare for such a move. By taking these steps, errors can be avoided. For starters, the source and destination subscriptions must exist within the same Azure Active Directory tenant. The destination subscription must be registered for the resource provider of the resource being moved.</p>
<p>If the destination subscription isn’t registered for that resource type being moved, you’ll see an error stating that the subscription is not registered for a resource type. This often happens when moving a resource to a new subscription but that subscription has never been used with that resource type before.</p>
<p>The account moving the resources must have the permissions you see on your screen. Before moving resources, ensure the subscription quotas for the subscription you’re moving the resources to supports the resources you plan to move.</p>
<p>If moving the resources will cause the destination subscription to exceed its limits, an increase in the quota for that resource must first be requested. When moving resources, it’s best to break large moves into separate smaller move operations. As a matter of fact, Resource Manager will immediately fail if there is an attempt to move more than 800 resources in a single move operation. That said, a move of fewer than 800 resources may also fail, but that would be due to timeouts and other miscellaneous reasons.</p>
<h1 id="DEMO-Move-Resource-to-New-Resource-Group"><a href="#DEMO-Move-Resource-to-New-Resource-Group" class="headerlink" title="DEMO: Move Resource to New Resource Group"></a>DEMO: Move Resource to New Resource Group</h1><p>To move resources to a different resource group select the resource group containing those resources, and then click the Move button. Choose move to another resource group from the dropdown, and then select the resources to move along with the destination resource group.</p>
<p>Acknowledge that you need to update scripts for these resources, and then click Okay to move the resources. In notifications, you see that the move operation is running and when the move is completed you’re notified of the result.</p>
<h1 id="Removing-Resource-Groups"><a href="#Removing-Resource-Groups" class="headerlink" title="Removing Resource Groups"></a>Removing Resource Groups</h1><p>As a course instructor, I often have dozens of resource groups provisioned, each containing resources associated with a separate course or lab. When I’m done with the course or lab I simply delete the entire resource group. Doing so deletes all of the resources contained within it. This makes it easy for me to keep my Azure subscription clean of any unused resources.</p>
<p>Deleting a resource group is pretty straightforward. To do so, simply browse to the resource group, in the Azure portal, and then click the delete icon at the top. Confirm that you want to delete the resource group and then begin the deletion. Be careful when deleting a resource group, because when it’s deleted all resources contained in it are also deleted.</p>
<p>The amount of time it takes to delete a resource group, largely depends on how many resources are inside of the resource group, at the time of deletion. Obviously, the deletion of an empty resource group will be far quicker than that of a resource group that contains 800 objects in it.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>I hope you’ve enjoyed learning about managing Azure subscriptions and resource groups. Let’s review what you’ve learned. We kicked things off by covering key roles within an Azure subscription, including the contributor role, the owner role, reader, and user access administrator. You learned what each role does and how to assign and change roles.</p>
<p>We then dove into subscription policies and what role they play within a subscription. Next, we took a look at resource groups and how to manage those. You learned about resource policies and how to assign them. You also learned what Resource Locks are and how to use them to secure Azure resources.</p>
<p>Coming down the homestretch, we cover tagging and how to use tags to group resources together. Rounding out the course, you learned how to move resources between resource groups and how to delete resource groups altogether.</p>
<p>To learn more about managing Azure subscriptions and resource groups, be sure to review the documentation published by Microsoft. Be sure to also watch for new Microsoft Azure courses on Cloud Academy because we’re always publishing new ones. Please give this course a rating, and if you have any questions or comments, please let us know. Thanks for watching and happy learning.</p>
<h1 id="2Overview-of-Key-Roles"><a href="#2Overview-of-Key-Roles" class="headerlink" title="2Overview of Key Roles"></a>2<strong>Overview of Key Roles</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles">List of built-in RBAC roles</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/" class="post-title-link" itemprop="url">AZ-500-Configuring-Azure-VM-and-Container-Security-5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:25" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:25-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:12:06" itemprop="dateModified" datetime="2022-11-20T19:12:06-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-500/" itemprop="url" rel="index"><span itemprop="name">AZ-500</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hi there. Welcome to Configuring Azure VM and Container Security. My name is Thomas Mitchell and I’ll be leading you through this course.</p>
<p>I’m an Azure instructor at Cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions, feel free to connect with me on LinkedIn or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for people who want to become Microsoft-certified Azure security engineers or those who are simply tasked with implementing security controls, maintaining the security posture of an Azure environment, or protecting data, applications, and networks. To get the most from this course, you should have a moderate understanding of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Microsoft Azure</a> and of basic security principles.</p>
<p>To kick things off, we’re going to start with host security. We’re going to dive into <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-endpoint-security-within-vms/">configuring endpoint security</a> within VMs and how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/hardening-virtual-machines/">harden VMs in Microsoft Azure</a>. We’ll also get into configuring system updates for VMs in Azure, as well as baseline configuration.</p>
<p>Next, we’ll get into configuring container security. You’ll learn how to configure networks, authentication, and container isolation. You’ll also learn how to configure AKS security and how to configure container registry.</p>
<p>Lastly, you’ll learn about vulnerability management tools and strategies.</p>
<p>By the time you finish this course, you should have a full understanding of how to configure Azure VM and container security.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished.</p>
<p>If you’re ready to learn how to configure Azure VM and container security, let’s get started.</p>
<h3 id="Lectures"><a href="#Lectures" class="headerlink" title="Lectures"></a>Lectures</h3><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-endpoint-security-within-vms/">Configuring Endpoint Security within VMs</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-and-monitoring-antimalmare-vms/">Configuring and Monitoring Antimalmare for VMs</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-virtual-machine-security/">Configuring Virtual Machine Security</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/hardening-virtual-machines/">Hardening Virtual Machines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-system-updates-for-virtual-machines/">Configuring System Updates for Virtual Machines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/starting-runbook-azure-portal/">Starting a Runbook from the Azure Portal</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-baselines/">Configuring Baselines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/azure-networking/">Azure Networking</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-authentication/">Configuring Authentication</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/container-isolation/">Container Isolation</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/aks-security/">AKS Security</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/azure-container-registry/">Azure Container Registry</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/creating-container-registry/">Creating a Container Registry</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/implementing-vulnerability-management/">Implementing Vulnerability Management</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/conclusion/">Conclusion</a></p>
<h1 id="Configuring-Endpoint-Security-within-VMs"><a href="#Configuring-Endpoint-Security-within-VMs" class="headerlink" title="Configuring Endpoint Security within VMs"></a>Configuring Endpoint Security within VMs</h1><p>Hi there, welcome to Configuring Endpoint Security within VMs. The term endpoint system refers to a computer system that interacts directly with an end user. So this means that devices like desktop computers, laptops, tablets and smartphones are all considered endpoint systems. That being the case, they need to be secured. Failing to properly secure these endpoint systems opens them up to becoming launchpads for security attacks on other networked systems.</p>
<p>Because securing infrastructure-as-a-service offerings requires more customer responsibility than platform-as-a-service and software-as-a-service did, Microsoft has made available the Azure Security Center. The Azure Security Center provides you with the tools that are necessary for hardening your network and securing your services.</p>
<p>The first step to protecting your virtual machines is to protect them from malware. To do this, you need to install anti-malware on them. This helps you identify and remove viruses, spyware, and many other kinds of malicious software. There are two ways you can go about this. You can either install Microsoft Antimalware, or you can install a third-party endpoint protection solution.</p>
<p>Once you have your anti-malware solution installed on your virtual machines, you’ll want to integrate that solution with Azure Security Center so you can monitor the status of your anti-malware protection on those VMs.</p>
<p>Azure Security Center allows you to view reports on the Endpoint protection issues blade. What it does is highlight detected threats and insufficient protection, which obviously make your VMs vulnerable to malware threats. By deploying anti-malware on your machines and then integrating it with Azure Security Center, you’ll have the information necessary to create plans for addressing potential threats.</p>
<p>In the upcoming demonstration, I’ll show you how to configure and monitor anti-malware on virtual machines.</p>
<h1 id="Configuring-and-Monitoring-Antimalmare-for-VMs"><a href="#Configuring-and-Monitoring-Antimalmare-for-VMs" class="headerlink" title="Configuring and Monitoring Antimalmare for VMs"></a>Configuring and Monitoring Antimalmare for VMs</h1><p>In this demonstration, I’m going to show you how to enable and configure Microsoft Antimalware while provisioning a new VM in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal.</p>
<p>On the screen here, you can see I’m in the Azure portal. So what I’m going to do is deploy a new VM. Now, we’re not gonna do step by step on VM deployment because I’m going to assume you know how to do that already. I just want to show you where you’d go to deploy the Microsoft Antimalware during this process.</p>
<p>So what we’re going to do is select virtual machines here. And then we’re going to click add to deploy a new VM. And what we’ll do here is we’ll just select one of my test resource groups here. And we’ll give our new VM a name, not doing anything specific here. And we’ll leave our region and information here at their defaults. We will select our Windows Server OS image here, since we are installing the Microsoft Antimalware. And we’ll specify a username here. Okay, and we’ll leave everything else here at its default.</p>
<p>We’ll move on to disks. Again, we’ll leave everything at its default. What we’re going to do is get over here into advanced. So we’ll click through networking. We’ll leave our default network interface information set here. We’ll go into management. Again, we’ll leave everything at the default here. I’m not trying to show you how to configure management of a VM. And then we’ll go into advanced. Now, under advanced here, under extensions, what we do is click the select an extension to install link. And what this is going to do is allow us to select an extension we want to install. And over here on the right, we can see Microsoft Antimalware as an option. We’ll select that, and then we’ll click create.</p>
<p>Now, in the installation configuration screen here, we can exclude certain files and locations. We can exclude different extensions and even processes for Antimalware. And then we can enable or disable real-time protection, or we can configure it to run a scheduled scan. The scan type here allows us to specify whether we want to do a quick scan or a full scan. And then, of course, we can specify the day and the scan time. I’ll leave these options at their defaults. We’ll click OK. And then from here, what we would do is go back down to the bottom of the page for our VM creation. We would review and create. And then what we would do is create the VM. When this VM is deployed, it’s going to be deployed with Microsoft Antimalware installed. And that’s pretty much it. It’s not real difficult to get Microsoft Antimalware installed, but I wanted to show you that process and where you needed to go to install that extension.</p>
<h1 id="Configuring-Virtual-Machine-Security"><a href="#Configuring-Virtual-Machine-Security" class="headerlink" title="Configuring Virtual Machine Security"></a>Configuring Virtual Machine Security</h1><p>Hi there, welcome to Configuring VM Security. Before we get into VM policies and templates, I should probably make sure that you first understand the key features of Azure Resource Manager, since it serves as the deployment and management service for Azure subscriptions.</p>
<p>The main function of Azure Resource Manager is to provide a consistent management layer for creating, updating, and removing resources. The Resource Manager is also used to manage access control, auditing, and tagging. This, in turn, helps you secure and organize <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> resources after they’ve been deployed.</p>
<p>Any time you perform an action via one of the management tools, like the portal, or Azure PowerShell, the Azure CLI, or one of the other available management tools, it’s actually the Resource Manager API that handles the request. This produces consistent results and capabilities across all the different management tools.</p>
<p>Whenever you deploy a resource in Azure, the request is handled by the Resource Manager API. Successful requests result in the creation of the resource and the assignment of it to a resource group. Whenever you need to deploy resources that are related to each other, you should use Resource Manager to deploy them into the same resource group. This allows you to deploy, update, manage, and monitor them as a group.</p>
<p>So, now that we’ve given Resource Manager a good once-over, let’s take a look at some key terms that you should be familiar with when working with Resource Manager.</p>
<p>The term Resource Provider refers to a service that supplies Azure resources. One of the more common resource providers in Azure is Microsoft.Compute. The Microsoft.Compute resource provider, as you may have guessed, supplies VM resources. I’ll let you guess what the Microsoft.Storage resource provider supplies.</p>
<p>A Resource Manager Template is a JSON file. The JSON file defines one or more resources that you wish to deploy into a resource group or subscription. Using Resource Manager Templates allow you to consistently and repeatedly deploy resources over and over again, without the need to manually configure them each time.</p>
<p>Declarative Syntax is a syntax that you use to create resources without having to write out the sequence of programming commands that are necessary to create them. A prime example of Declarative Syntax is actually the Resource Manager template, because within the JSON file, you define the properties for the infrastructure to deploy to in Azure.</p>
<p>When you use a Resource Manager template to define your virtual machines, you can easily deploy and redeploy them later on, if necessary. As a matter of fact, Microsoft actually recommends periodically redeploying your virtual machines, why? Because it forces the deployment of a freshly updated and security-enhanced virtual machine OS. That said, it’s likely difficult to do in practice, due to business SLAs, approvals, and the coordination involved. But that still doesn’t mean it’s a bad idea.</p>
<p>It’s important to understand that Resource Manager processes templates like any other request. What it does is parse the template and then convert the syntax into REST API operations.</p>
<p>Now, because this course isn’t about building templates, I’m not going to get into the weeds on template building. However, if you want to learn about building them, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">URL</a> that you see on your screen (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax</a>).</p>
<p>I should also point out, that, because RBAC, or role-based access control, is integrated into the management platform, you can apply access controls to all services in your resource group.</p>
<p>At this point, I want to talk a little bit about the four levels of scope, in the context of Azure management. They include management groups, subscriptions, resource groups, and resources.</p>
<p>The image that you see on your screen now shows how these scopes are related. So, what’s the significance of scope? Well, what you can do is apply management settings at any one of these levels. Obviously, the level you apply your settings to will dictate how widely your settings are applied. Lower scope levels will generally inherit settings that are applied at the higher scope levels.</p>
<p>For example, if you apply a policy to a resource group, that policy will apply to not only the resource group itself, but it will filter down and apply to the resources within the resource group.</p>
<p>It’s also important to understand that you can deploy templates to management groups, subscriptions, and resource groups.</p>
<p>Speaking of resource groups, let’s talk a little bit about them now. Although they are quite possibly the simplest resources that you can deploy, there are some things to consider when defining a resource group.</p>
<p>First and foremost, when planning your resource group deployments, it’s important to understand that all resources within a resource group should share the same lifecycle. You should be deploying, updating, and deleting such resource all together. An example of this would be an internet-facing web app that communicates with a backend database. Generally speaking, in such a scenario, you’d have a web server, an app server, and a database server, that all exist solely to support the app. In such a case, they would all go in one resource group. However, if one of those resources, say the database server, for example, exists on a different deployment cycle because it supports other apps, that database server should be deployed in another resource group.</p>
<p>While we’re on the subject of which resource groups should house which resources, I should also point out that each resource can only exist in one resource group. You can’t add a resource to two different resource groups. That said, you can add and remove resources to and from a resource group at any time. You can even move resources from one resource group to another.</p>
<p>I should also note that a resource group, despite being located in one region, can contain resources that are located in different regions. For example, a resource group in East US can host resources that are deployed in West US. And, of course, resources in one resource group have no problem interacting with resources in another resource group. Essentially, resource groups serve as LOGICAL groupings.</p>
<p>You can also use a resource group to scope access control for administrative actions.</p>
<p>When you create a resource group, you are prompted to provide a location for that resource group. The location you choose is important because it tells Azure where to store metadata about the resources within that resource group. This has potential compliance ramifications, especially if you need to ensure that your data is stored in a particular region.</p>
<p>In the next lesson, we’ll get into VM hardening.</p>
<h1 id="Hardening-Virtual-Machines"><a href="#Hardening-Virtual-Machines" class="headerlink" title="Hardening Virtual Machines"></a>Hardening Virtual Machines</h1><p>Hi there, welcome to Hardening Virtual Machines. In this lecture, we’re going to look at some of the steps that you can take to harden your Azure VMs, using Azure Security Center.</p>
<p>As I mentioned earlier in this course, Azure Security Center is a service offering that you can use to prevent, detect and respond to threats. It also provides increased visibility into your Azure resources as well as added control over them. Using Security Center, you can safeguard virtual machine data in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> because of this improved visibility.</p>
<p>When you use Security Center to help protect your virtual machines, several capabilities become available to you. For example, you can configure OS security settings by leveraging recommended configuration rules. You can also manage system security updates and see which critical updates are missing. Security Center also provides endpoint protection recommendations and disk encryption validation.</p>
<p>Other capabilities that become available to you include threat detection and the ability to perform vulnerability assessments and remediations.</p>
<p>Before Azure Security Center can collect the information necessary to make recommendations and to generate alerts, you need to enable data collection. On the screen you can see that data collection has been enabled in this example.</p>
<p>Once you’ve begun collecting data, you can begin configuring security policies. A security policy defines a set of controls that are recommended for resources within the subscription or resource group.</p>
<p>Security Center analyzes the security state of your resources in Azure, and when it identifies potential security vulnerabilities, it creates recommendations, which are based on your security policies. The recommendations will even walk you through the process of configuring the necessary controls.</p>
<p>The recommendations that security policy makes are presented in a table format. Each line in the table represents one recommendation. When you select a recommendation in the table, Security Center presents you with information that can assist you with the implementation of that recommendation.</p>
<p>You can also use Security Center to monitor and analyze your enabled security policies in order to identify possible vulnerabilities. You can check on the security state of resources from the resource security health blade.</p>
<p>The way threat detection works in Security Center is pretty straightforward. Essentially what happens is that Security Center collects security information from your Azure resources, the network itself, and other connected partner solutions. It then analyzes the collected information. It will then correlate information from multiple sources to identify threats.</p>
<p>Azure Security Center uses advanced security analytics and leverages big data and machine learning to evaluate events across the entire cloud. Using these technologies, Security Center can detect threats that would otherwise be impossible to identify via manual methods.</p>
<p>The Advanced Security analytics that Security Center relies on include things like integrated threat intelligence, behavioral analytics and anomaly detection.</p>
<p>These types of analytics allow Security Center to effectively disrupt the kill chain because they result in detection at different phases of it. The image that you see on your screen highlights a few common alerts for each phase.</p>
<h1 id="Configuring-System-Updates-for-Virtual-Machines"><a href="#Configuring-System-Updates-for-Virtual-Machines" class="headerlink" title="Configuring System Updates for Virtual Machines"></a>Configuring System Updates for Virtual Machines</h1><p>Hi there! Welcome to Configuring System Updates for Virtual Machines. Azure Update Management is a service that’s included with each Azure subscription. This service allows you to assess your update status across your entire environment and to manage updates for both on-prem and Azure-hosted Windows servers and Linux servers from a single location.</p>
<p>The Azure Update Management service is a free offering. The only costs that you incur are for the log data that Azure Log Analytics stores. To use Azure Update Management, all you need to do is browse to the VM tab in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>, and then enable Update Management for one or more virtual machines. Update Management can also be enabled from your Azure Automation account.</p>
<p>Computers that are managed by the Azure Update Management service use the services and features that you see on your screen to perform assessments and to update deployments. They include:</p>
<ul>
<li>Microsoft Monitoring Agent for Windows or Linux </li>
<li>Desired State Configuration in Windows PowerShell for Linux </li>
<li>Hybrid Runbook Worker in Azure Automation </li>
<li>Microsoft Update for Windows computers</li>
<li>Windows Server Update Services for Windows computers</li>
</ul>
<p>Azure Automation uses Runbooks to install updates. Essentially, what happens, is when an update deployment is created, a schedule is also created. That schedule starts a master update runbook at the specified time for the included computers. The master runbook, in turn, starts a child runbook on each agent. This child runbook on each agent installs the required updates.</p>
<p>The diagram that you see on your screen depicts the flow and how the solution assesses and applies security updates.</p>
<p>In the upcoming demonstration, I’ll show you how to start a runbook from the Azure portal.</p>
<p>Welcome back. In this quick demonstration, I’m going to show you how to start a runbook from the Azure portal. On the screen here, you can see I’m logged in to my Azure portal as my administrator.</p>
<p>To start my runbook, what I’m going to do here is go into Automation, and we’ll select myautomationaccount. Now, from myautomationaccount, I simply select Runbooks under Process Automation and then, I can either create a new runbook or I can run an existing runbook simply by selecting the runbook and then clicking Start. Go ahead and click Yes to start the runbook. And then from the job page here, I can view the status of my runbook job. I can view any input, any output, errors, warnings, any kind of logs and any exceptions. And that’s all it really takes to manually run a runbook from the Azure portal.</p>
<h1 id="Starting-a-Runbook-from-the-Azure-Portal"><a href="#Starting-a-Runbook-from-the-Azure-Portal" class="headerlink" title="Starting a Runbook from the Azure Portal"></a>Starting a Runbook from the Azure Portal</h1><p>Welcome back. In this quick demonstration, I’m going to show you how to start a runbook from the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. On the screen here, you can see I’m logged in to my Azure portal as my administrator. To start my runbook, what I’m going to do here, is go into Automation. And we’ll select Myautomationaccount. Now from my automation account, I simply select Runbooks under process automation, and then I can either create a new runbook or I can run an existing runbook, simply by selecting the runbook and then clicking Start. Go ahead and click Yes to start the runbook. And then from the job page here, I can view the status of my runbook job. I can view any input, any output, errors, warnings, any kind of logs, and any exceptions. And that’s all it really takes to manually run a runbook from the Azure portal.</p>
<h1 id="Configuring-Baselines"><a href="#Configuring-Baselines" class="headerlink" title="Configuring Baselines"></a>Configuring Baselines</h1><p>Hi there. Welcome to Configuring Baselines. Before we get started, I want to mention that this section alone could probably be its own entire course if we wanted to go down the rabbit hole of every type of baseline. However, what we’re going to do instead is touch on each of the types of baselines that are available so you know where to go when you need to configure a specific baseline.</p>
<p>Before we do that, let’s talk a little bit about the best practices that Microsoft’s cybersecurity group and the Center for Internet Security or CIS have developed.</p>
<p>Microsoft initially partnered with the Center for Internet Security to develop an off-the-shelf-hardened Azure VM. This soon turned into an initiative to use CIS benchmarks, along with Azure security services and tools to provide security and compliance for applications that run on <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>.</p>
<p>The CIS Microsoft Azure Foundations Security Benchmark guide provides organizations with guidelines for establishing a secure baseline configuration for Azure. Throughout the rest of this lecture, we’re going to look at the recommended technology groupings that can help you create secure cloud-enabled workloads.</p>
<p>There are two different implementation levels that CIS bases their recommendations on. There are also several different categories of recommendations that are made. The two levels are called Level 1 and Level 2. I know, very original.</p>
<p>Level 1 recommendations are the minimum recommended security settings that should be configured on all systems. Level 1 recommendations typically cause little or no interruption of services, nor do they usually result in reduced functionality. Level 2 recommendations are designed for highly secure environments. That being the case, they can sometimes result in reduced functionality of the systems they’re implemented on.</p>
<p>On the screen is a table that shows you each technology group that we’re going to touch on, along with an overall description of the recommendations for each group. Also included in this table are the total number of recommendations for each technology group. As you can see, there are lots, which is why we’re not going to get down into the weeds on these.</p>
<p>Let’s start by taking a quick look at identity and access management. Identity management is critical to the security of corporate assets. To ensure security and control of your assets, you need to manage identity and access for the Azure administrators in your organization, the application developers in your organization and for the application users as well. An identity and access management baseline is a big part of this.</p>
<p>Some of the key recommendations when configuring an identity and access management baseline include: Level 1 actions like restricting access to the Azure AD administration portal, ensuring that no unnecessary guest users exist, notifying users on password resets and requiring two methods to reset passwords.</p>
<p>Some key Level 2 actions that you should be taking include things like: enabling Azure MFA, blocking the ability to remember MFA on trusted devices, notifying all admins when other admins reset passwords and establishing an interval for reconfirming user authentication methods.</p>
<p>Some other recommended Level 2 actions include: not allowing members and guests to invite external users, not allowing users to create and manage security groups, disabling self-service group management and disabling the ability for users to register apps.</p>
<p>The Azure Security Center offering provides security management and threat protection for on-prem workloads, Azure workloads and workloads in other clouds.</p>
<p>The Security Center recommendations that you see on your screen will set various security policies on your Azure subscription. By implementing these recommendations on your own Azure subscription, you can further secure your environment.</p>
<p>These recommendations include: enabling the standard pricing tier, enabling the automatic provisioning of a monitoring agent and enabling system updates. Other key recommendations include: enabling security configurations enabling endpoint protection and enabling disk encryption.</p>
<ul>
<li>Enabling Network Security Groups (Level 1)</li>
<li>Enabling Web Application Firewall (Level 1)</li>
<li>Enabling Vulnerability Assessment (Level 1)</li>
<li>Enabling Storage Encryption (Level 1)</li>
<li>Enabling JIT Network Access (Level 1)</li>
<li>Enabling Adaptive Application Controls (Level 1)</li>
<li>Enabling SQL Auditing &amp; Threat Detection (Level 1)</li>
<li>Enabling SQL Encryption (Level 1)</li>
<li>Setting a Security Contact Email and Phone Number (Level 1)</li>
<li>Enabling the Send me emails about alerts option (Level 1)</li>
<li>Enabling the Send email also to subscription owners option (Level 1)</li>
</ul>
<p>As you can see on your screen, there are also several other recommendations to follow when creating an Azure Security Center baseline. </p>
<p>Azure storage accounts provide namespaces that you can use to store and access Azure Storage data objects. The seven key recommendations that you see on your screen are those that you should implement to validate your storage security.</p>
<p>They include:</p>
<ul>
<li>Requiring security-enhanced transfers (Level 1)</li>
<li>Enabling blob encryption (Level 1)</li>
<li>Periodically regenerating access keys (Level 1)</li>
<li>Requiring Shared Access Signature (SAS) tokens to expire within an hour (Level 1)</li>
<li>Requiring SAS tokens to be shared only via HTTPS (Level 1)</li>
<li>Enabling Azure Files encryption (Level 1)</li>
<li>Requiring only private access to blob containers (Level 1)</li>
</ul>
<p>By implementing these recommendations as part of a storage account baseline, you can vastly improve your security position.</p>
<p>Azure SQL Server is Microsoft’s cloud-based relational database server offering. It supports many of the same features as the on-prem version of Microsoft SQL Server and it’s a good way to transition from an on-prem database into a cloud-based database.</p>
<p>The security recommendations that you see on your screen are those that you should implement when creating an Azure SQL Database security baseline. They include:</p>
<ul>
<li>Enabling auditing (Level 1)</li>
<li>Enabling a threat detection service (Level 1)</li>
<li>Enabling all threat detection types (Level 1)</li>
<li>Enabling the option to send security alerts (Level 1)</li>
<li>Enabling the email service and co-administrators (Level 1)</li>
<li>Configuring audit retention for more than 90 days (Level 1)</li>
<li>Configuring threat detection retention for more than 90 days (Level 1)</li>
</ul>
<p>Implementing these recommendations improves the security posture of your Azure SQL Server environment.</p>
<p>When it comes time to identify and mitigate security threats, if you aren’t performing any sort of logging and monitoring, you’re going to be in for a world of hurt. Properly configured logging policies will not only help you determine when a security violation has occurred, but it will also help identify the culprit responsible as your activity logs can provide information about external access to resources and it can also provide diagnostic logs that provide information about the operation of those resources.</p>
<p>Follow these Level 1 recommendations that you see on your screen to set logging and monitoring policies on your Azure subscriptions:</p>
<ul>
<li>Ensure that a log profile exists </li>
<li>Ensure that activity log retention is set to 365 days or more </li>
<li>Create an activity log alert for “Creating a policy assignment” </li>
<li>Create an activity log alert for “Creating, updating, or deleting a Network Security Group” </li>
<li>Create an activity log alert for “Creating or updating an SQL Server firewall rule”</li>
</ul>
<p>Azure networking service are designed to maximize flexibility, availability and security. These services provide connectivity between resources in Azure, on-prem resources and the Internet. The key security recommendations you see on your screen can be used to set Azure networking policies in your Azure subscriptions. These recommendations include:</p>
<ul>
<li>Restricting RDP and SSH access from the Internet (Level 1) </li>
<li>Restricting SQL Server access from the Internet (Level 1)</li>
<li>Configuring the NSG flow log retention period for more than 90 days (Level 2)</li>
<li>Enabling Network Watcher (Level 1)</li>
</ul>
<p>Aside from configuring the NSG flow log retention period, which is a Level 2 recommendation, all listed recommendations are Level 1 recommendations.</p>
<p>When it comes to security recommendations for virtual machines, the ones you see on your screen should be followed to set virtual machine policies on your Azure subscription. These recommendations include: </p>
<ul>
<li>Installing a VM agent on all VMs and enabling the agents for data collection for Azure Security Center (Level 1) </li>
<li>Ensuring that OS disks are encrypted (Level 1)</li>
<li>Ensuring only approved extensions are installed (Level 1)</li>
<li>Ensuring that the OS patches for the VMs are applied (Level 1)</li>
<li>Ensuring that VMs have an installed and running endpoint protection solution (Level 1)</li>
</ul>
<p>Performing these steps will allow you to validate the security for VMs in your environment. In addition to the recommendations we’ve already introduced, there are some other security recommendations that should be followed.</p>
<p>These additional recommendations include:</p>
<ul>
<li>Setting an expiration date on all keys in Azure Key Vault (Level 1) </li>
<li>Setting an expiration date on all secrets in Azure Key Vault (Level 1) </li>
<li>Setting resource locks for mission-critical Azure resources (Level 2)</li>
</ul>
<p>These additional recommendations that you see on your screen can be followed to set general security and operational controls on an Azure subscription.</p>
<p>To download the complete CIS Microsoft Azure Foundations Security Benchmark document, which includes over 200 pages of baseline and benchmark information, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/security/benchmark/azure/v2-cis-benchmark">URL</a> that you see on your screen.</p>
<h1 id="Azure-Networking"><a href="#Azure-Networking" class="headerlink" title="Azure Networking"></a>Azure Networking</h1><p>Hi there, welcome to Azure Networking. In this lecture, we’re going to take a quick look at several key networking components that you need to be familiar with before attempting to configure networking and <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. We’re not going to get into too much detail, because I’m going to assume that if you’re preparing for the Microsoft Azure Security Technologies exam, you already have at least a basic knowledge of these concepts already. So for most of you, this should be more like a refresher than anything.</p>
<p>Let’s start with virtual networks. Virtual networks are used to connect resources. Whether those resources reside in Azure or on-prem. You use Azure virtual networks to enable secure communication between all kinds of Azure resources between Azure resources and on-prem environments and between Azure resources and the internet. It’s important to note that each virtual network which consists of one or more subnets is scoped to a single Azure region.</p>
<p>While you can deploy multiple virtual networks within each Azure subscription and within each Azure region, it’s important to understand that each virtual network is isolated from other virtual networks.</p>
<p>When you deploy a virtual network, you can specify a custom private IP address space that consists of public or private addresses. When you connect resources to a virtual network, Azure assigns a private IP address to that resource. The address that it assigns comes from the address space that you assign.</p>
<p>For name resolution, you can use either Azure provided name resolution, or you can provide your own custom DNS server. Resources on the virtual network you are configuring will use this DNS for name resolution. </p>
<p>In much the same way as physical on-prem machines do, Azure resources like VMs, load balancers, and application gateways require unique IP addresses to function. Virtual networks use two types of IP addresses. They include private IPs and public IPs.</p>
<p>Private IP addresses can be allocated to resources dynamically or statically. Resources use these addresses to communicate with other Azure resources or on-prem devices.</p>
<p>Public IP addresses allow Azure resources to communicate with external clients. This kind of address is assigned directly to the virtual network adapter of a virtual machine or to the load balancer. Public IP addresses can also be added to Azure only virtual networks. With that being said, in an Azure only virtual network, all IPs are routable only within the customer’s network. Meaning that they won’t be reachable from outside. </p>
<p>Subnets in Azure, in the same way as physical subnets on-prem, allow you to subdivide your virtual network. This helps attain logical and security related isolation of Azure resources. A subnets range of addresses must fall within the defined address space of the parent virtual network. What subnetting does is hide the details of the organization of the internal network from external routers. It also segments the hosts within the network. This makes it easier to apply network security at the interconnections between subnets.</p>
<p>Virtual network adapters are used by virtual machines to communicate with other virtual machines as well as with other resources. When you deploy a virtual machine, you configure the virtual machine’s virtual network adapter with a private IP address and optionally, a public IP address. It’s also important to note that a virtual machine can have more than one virtual network adapter attached to it.</p>
<p>DNS or the Domain Name System allows clients to resolve fully qualified domain names to IP addresses. Although Azure does provide a built-in DNS that supports most name resolution scenarios, there will be times when you need to configure custom external DNS in order to provide the necessary name resolution services. A typical use-case for custom DNS is a scenario where you want to extend an on-prem Active Directory into Azure by deploying a VM in Azure that will function as a domain controller for the on-prem AD.</p>
<p>In situations where you wish to increase scalability or availability of an application that’s hosted on a VM, what you can do is create two or more VMs and publish the same application on them. You can then use an Azure load balancer to distribute traffic among the VMs that host the application. In such a configuration, all of the VMs share the same endpoint. That being the case, you can spread the traffic load across multiple servers.</p>
<p>You have two types of load balancers at your disposal; a public load balancer and an internal load balancer.</p>
<p>A public load balancer is used to map the public IP address and port number of incoming traffic to the private IP address and port number of your VMs. And of course, vice versa for the response traffic from your VMs.</p>
<p>You use an internal load balancer to direct traffic to resources that exist inside a virtual network, or to resources that use a VPN to access the Azure infrastructure. This is what differentiates internal load balancers from public load balancers.</p>
<p>I should also note that Azure restricts access to the load-balanced front-end IP address of a virtual network. In other words, the front-end IP addresses and virtual networks are never directly exposed to the internet. </p>
<p>The application gateway is another service that you can use to deploy load balanced solutions. However, unlike load balancers, application gateways are designed strictly for HTTP traffic. That being the case, they use routing rules as application-level policies that can offload SSL processing from load-balanced VMs. I should also mention that you can use application gateways when cookie-based session affinity is required.</p>
<p>Azure Traffic Manager is yet another Azure-based load balancing solution. You typically use traffic manager to balance loads across endpoints in different Azure regions, across hosted providers or across different on-prem data centers. The endpoints of Traffic Manager can be Azure VMs or Azure websites. Generally speaking, you use the Traffic Manager load balancing service to ensure that end users connect to an endpoint that is located closest to their physical location. This typically results in faster response times.</p>
<p>It’s important to note that Traffic Manager works at the DNS level. In other words, it uses DNS to direct users to specific service endpoints based on a combination of the traffic routing method you choose, and the current endpoint health. This doesn’t mean that Traffic Manager is a proxy, it’s not. Once clients are directed to the appropriate endpoint, they directly connect to that endpoint. Traffic Manager doesn’t see the traffic passing between the client and the service being load balanced.</p>
<p>At this point, we just have a few more networking concepts to review. Let’s take a quick moment to touch on network security groups. Network security groups are used to provide network isolation for Azure resources. This is accomplished by defining security rules that either allow or deny specific traffic to specific VMs or subnets.</p>
<p>A common use case for network security groups is a scenario where you want to isolate traffic between multi-tier applications. For example, if you have a three-tier web app that consists of a web front-end VM, a VM hosting the app and a back-end SQL server that the app VM talks to, you might leverage network security groups to ensure that only the app VM can communicate with the SQL VM over Port 1433. Since there’s no need for the front-end web VM to be communicating directly with the back-end SQL VM.</p>
<p>Lastly, let’s take a look at cross-prem network connectivity. Using Azure virtual networks and VPNs, you can extend your on-prem network to Microsoft Azure. You can create connectivity between an on-prem network and an Azure virtual network by deploying a site to site VPN that traverses the public internet. However, if you’re looking for more security and reliability you can use ExpressRoute to create a connection that doesn’t cross the internet. Using either of these two methods allows you to provide on-prem users access to Azure resources as if they were physically located on-prem in your own data center.</p>
<p>A point to site VPN can be used to allow individual users or computers to connect to Azure, just like you might leverage Cisco AnyConnect or any other VPN service to allow users to connect to your on-prem network from home.</p>
<p>With that said, we’ll wrap up this lecture. Like I said at the outset, this lecture was probably just a refresher for most of you. But I had to mention these concepts because you may run into them while sitting the exam. I’d rather run through that and have you not see them on the exam, that not go through them and then have you getting hit with questions about them when you sit the exam.</p>
<h1 id="Configuring-Authentication"><a href="#Configuring-Authentication" class="headerlink" title="Configuring Authentication"></a>Configuring Authentication</h1><p>Hi there, welcome to configuring authentication. In this lecture, we’re going to take a look at how to create and use service principals for AKS clusters.</p>
<p>So before an AKS cluster can interact with Azure APIs, it needs an Azure AD service principal. This is required to dynamically create and manage other <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> resources, like Azure load balancer or container registry. </p>
<p>Over the next few minutes here, I’m going to explain how to create a service principal for an AKS cluster.</p>
<p>Before we dive in, I need to point out that in order to create an Azure AD service principal, you need permissions to register an application with the Azure AD tenant. You also need permissions to assign the app to a role in the subscription.</p>
<p>To create a service principle for an AKS cluster using Azure CLI, you’ll need to use Azure CLI version 2.0.59 or later installed and configured.</p>
<p>When you create an AKS cluster, be it in the Azure portal or by using the az aks create command in Azure CLI, Azure can automatically create a service principal for you.</p>
<p>Using the Azure CLI command that you see on your screen (shown below) does not specify a service principal, so what happens in this case is Azure CLI automatically creates a service principal for the cluster.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks create --name MyCoolAKSCluster --resource-group myRG</span><br></pre></td></tr></table></figure>

<p>Now, if you want to manually create a service principal using the Azure CLI, you can use this next command that you see on your screen:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ad sp create-for-rbac --skip-assignment --name myAKSClusterSP</span><br></pre></td></tr></table></figure>

<p>In this example, we’re using the <code>az ad sp create-for-rbac</code> command. The <code>--skip-assignment</code> parameter in this example command prevents any additional default assignments from being assigned.</p>
<p>After running the command you see here, what you need to do is take a look at your output, which should look something like what you see on your screen, and you’ll need to make a note of the appID and password because you’ll use these when you create your AKS cluster. Once you’ve created your service principal, you can use it when you create the AKS cluster.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JSONCopy</span><br><span class="line">&#123;</span><br><span class="line">  &quot;appId&quot;: &quot;559513bd-0c19-4c1a-87cd-851a26afd5fc&quot;,</span><br><span class="line">  &quot;displayName&quot;: &quot;myAKSClusterSP&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;http://myAKSClusterSP&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;e765722a-5eee-40e8-a466-dc87d980f315&quot;,</span><br><span class="line">  &quot;tenant&quot;: &quot;72f985bf-86f1-41af-92ab-2d7ce011db48&quot;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To specify this existing service principal while you create the AKS cluster, you can use the <code>az aks create</code> command, along with the <code>--service-principal</code> and <code>--client-secret</code> parameters. Using these parameters allows you to specify the appID and password that you noted.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks create --resource-group myResourceGroup --name myCoolAKSCluster --service-principal &lt;appId&gt; --client-secret &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>Now, if you’re doing things the easier way and deploying your AKS cluster via the Azure portal, what you can do is, once you get to the Authentication page of the Create Kubernetes cluster dialog, you can choose the option to Use Existing when prompted to Configure service principal. What you would do in this case is provide your appID in the Service principal client ID field and your password in the Service principal client secret field.</p>
<p>Before we wrap up this lecture, I do want to point out a couple things to keep in mind when using AKS and Azure AD service principals.</p>
<p>First and foremost, while the service principal for Kubernetes is a part of the cluster configuration, it should not be used to deploy the cluster. Secondly, by default, service principal credentials are only valid for one year. That being the case, you’ll need to either update or rotate the service principal credentials on a regular basis.</p>
<p>Speaking of service principals, every service principal is associated with an Azure AD application. In the case of a Kubernetes cluster, the service principal for it can be associated with any valid Azure AD application name. However, the application URL doesn’t have to be a real endpoint. This sometimes trips people up.</p>
<p>I should also point out that the service principal credentials are stored in a file called &#x2F;etc&#x2F;kubernetes&#x2F;azure.json on the agent node VMs within the Kubernetes cluster.</p>
<p>Lastly, even if you delete an AKS cluster that was created via the <code>az aks create</code> command, the service principal that was automatically created is not deleted. This is another point that sometimes trips people up.</p>
<h1 id="Container-Isolation"><a href="#Container-Isolation" class="headerlink" title="Container Isolation"></a>Container Isolation</h1><p>Hi, everyone, welcome to container isolation. Azure Container Instances, also known as ACI, provide the easiest way to deploy containers in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> without worrying about any higher level service overhead. This is because you can deploy independent containers without the need to manage any backend virtual machines.</p>
<p>Container instances are, inherently, deployed securely. This ensures that a deployed application runs in isolation, much like it would if it was run on an Azure virtual machine.</p>
<p>Because the Azure Container Instances service is a deep security model, each individual container that’s deployed is isolated at the hypervisor level. This offers a much stronger security boundary for multi-tenant scenarios. The ability to enable this type of isolation without the need for a separate hosting cluster makes Azure Container Instances a true cloud-native model.</p>
<h1 id="AKS-Security"><a href="#AKS-Security" class="headerlink" title="AKS Security"></a>AKS Security</h1><p>Hi there, welcome to AKS security. In this lecture, we’re going to take a look at various concepts that you need to be familiar with in order to configure AKS security. We’ll look at master components security, node security, network security, and Kubernetes secrets.</p>
<p>In AKS, Kubernetes master components are provided by Microsoft as part of the managed service. That being the case, each AKS cluster has its own single-tenanted, dedicated Kubernetes master. This dedicated Kubernetes master, which is managed and maintained by Microsoft, provides the API server, scheduler, and other functionality.</p>
<p>The Kubernetes API server uses a public IP address and is accessible via a fully qualified domain name. Access to the API server can be controlled via Kubernetes RBAC controls and Azure AD.</p>
<p>We already know that AKS nodes are actually Azure VMs that we need to manage and maintain. Linux nodes run Ubuntu using the Moby container runtime. Windows Server nodes run Windows Server 2019. They, too, use the Moby container runtime. Whenever a new AKS cluster is created or when an existing cluster is scaled up, the nodes of that cluster are automatically deployed with the latest OS security updates and configurations.</p>
<p>Then, in the case of Linux nodes, <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> automatically applies the latest OS security patches on a nightly basis. However, it’s important to note that if a particular Linux OS update requires a host reboot, that reboot is not automatically performed. Instead, you can manually reboot the node when it’s convenient. You can also use Kured, which is an open-source reboot daemon for Kubernetes.</p>
<p>Windows Server nodes are updated via Windows Update. However, Windows Update does not automatically run nor apply the latest updates. Instead, what you should do on a regular basis is perform an upgrade on your Windows Server node pool, or pools, in your AKS cluster. What this upgrade process does is create nodes that run the latest Windows Server image and patches. Once you have the new nodes created, you can remove the older ones.</p>
<p>I should point out that, when nodes are deployed, they’re deployed into a private virtual network subnet. There are no public IP addresses assigned. That being the case, SSH is enabled by default. You can use this SSH access, using the internal IP address, to manage your nodes.</p>
<p>AKS nodes use Azure Managed Disks for storage. The data that gets stored on these managed disks is automatically encrypted at rest by Azure.</p>
<p>It’s important to understand that Kubernetes environments, in general, aren’t considered to be completely safe for hostile multi-tenant usage. While security features like Pod Security Policies and role-based access controls make exploits a little more difficult, the best way to achieve true security when running hostile multi-tenant workloads is to leverage a hypervisor.</p>
<p>For more information on cluster isolation in AKS, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation">URL</a> that you see on your screen (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation">https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation</a>)</p>
<p>To facilitate security and connectivity with on-prem networks, AKS clusters can be deployed into existing Azure virtual networks that have Azure Site-to-Site VPN connections or Express Route connections back to your on-prem network. You can define Kubernetes ingress controllers with private IP addresses, so those services are only accessible via an internal network connection.</p>
<p>I should mention here that as you create services with load balancers, port mappings, or ingress routes, the Azure Kubernetes Service will automatically modify the applicable network security groups to ensure traffic flows as necessary.</p>
<p>The last security component that I want to touch on is the concept of Kubernetes secrets. So what is a Kubernetes secret and what does it do? Well, a Kubernetes secret injects sensitive data, like access credentials or keys, into pods. After you’ve created a secret using the Kubernetes API, you can request that secret when you define your pod or deployment.</p>
<p>A Kubernetes Secret is only supplied to a node that contains a scheduled pod that requires it, and instead of being written to disk, the secret is stored in tmpfs.</p>
<p>It’s important to note that when the last pod on a node that requires a secret is deleted, the secret itself is also deleted from that node’s tmpfs. I should also point out that secrets are stored within a specific namespace. That being the case, they can only be accessed by pods within that namespace.</p>
<p>Using secrets reduces the amount of sensitive information that needs to be defined in YAML manifest for pods and services. Instead of defining sensitive data in the manifest, what you do is you request the secret that’s stored in Kubernetes API Server. Taking this approach, you only provide the specific pod with access to the secret.</p>
<h1 id="Azure-Container-Registry"><a href="#Azure-Container-Registry" class="headerlink" title="Azure Container Registry"></a>Azure Container Registry</h1><p>Welcome to Container Registry. This is going to be a rather brief lecture because all I want to do here is introduce you to Container Registry.</p>
<p>So what is an Azure Container Registry? Well, an Azure container registry is really just a managed, private Docker registry in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. It’s based on the open-source Docker Registry 2.0. You use Azure container registries to store and manage private Docker container images along with related artifacts.</p>
<p>You can use Azure container registries with existing container development and deployment pipelines, or you can use Azure Container Registry Tasks to build container images in Azure.</p>
<p>You can pull images from an Azure container registry to various deployment targets, including orchestration systems like Kubernetes and Docker Swarm, and you can also pull images from the container registry to Azure services that help you build and run apps at scale. These services include Azure Kubernetes Service, App Service, Service Fabric, and several others.</p>
<p>In the upcoming demonstration, we’ll create a container registry with the Azure portal.</p>
<h1 id="Creating-a-Container-Registry"><a href="#Creating-a-Container-Registry" class="headerlink" title="Creating a Container Registry"></a>Creating a Container Registry</h1><p>Welcome back. In this demonstration, I’m going to quickly show you how to create a container registry using the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. On the screen here you can see I’m logged in to my portal and I’m logged in as an Administrator. To create my container registry, what I’m going to do is click on Create a Resource here and then I’m going to browse to Containers here within the Azure marketplace.</p>
<p>Now within Containers here, I can select Container Registry. To create my Container Registry, I need to provide a unique registry name and when I say unique, I mean it needs to be unique across Azure because it’s going to get an FQDN with the domain name here of Azure CR.IO. So what I’ll do here is I’ll call it my 9878 registry. This name that I give it can contain anywhere between five and 50 alphanumeric characters. And then what I do here is select the subscription I’m going to deploy to and then a resource group.</p>
<p>So I’ll select one of my resource groups here and then of course as with any other Azure resource, I need to select the location. I’ll leave it in East U.S. Now if we hover over the icon next to Admin User, we can see that if we enable this option, we can use the registry name as username and Admin User Access Key as the password to dock or log in for the container registry. I’m going to leave this disabled here and go with the standard SCU. We’ll go ahead and click Create and what this will do is create my new container registry.</p>
<p>Now that my registry had been created, what I’ll do here is browse out to the resource group that contains it and we’ll open up our registry.</p>
<h1 id="Implementing-Vulnerability-Management"><a href="#Implementing-Vulnerability-Management" class="headerlink" title="Implementing Vulnerability Management"></a>Implementing Vulnerability Management</h1><p>Hi there. Welcome to “Implementing Vulnerability Management.” In this lecture, I want to talk a little bit about security measures that you can take to manage vulnerabilities.</p>
<p>To ensure effective vulnerability management, you need to secure and protect your container ecosystem, from build to run. You need to protect against vulnerabilities throughout the entire container lifecycle, from development to production deployment. You also need to ensure that you protect all container orchestrators, hosts, and platforms.</p>
<p>An effective vulnerability management plan that’s implemented throughout the entire container development lifecycle makes it more likely that you’ll be able to identify and resolve security concerns before they become a serious problem.</p>
<p>There are several steps you should take when implementing vulnerability management. These include scanning for vulnerabilities, mapping image vulnerabilities to running containers, and ensuring that only approved images are used in the environment. You also want to allow only approved registries and ensure the integrity of your images throughout the lifecycle.</p>
<p>Other steps that you can take to manage vulnerabilities include the enforcement of least privileges in runtime and the removal of unneeded privileges, which reduces the container attack surface. You can also whitelist files and executables that each container is allowed to access or run.</p>
<p>Some other best practices for managing vulnerabilities include network segmentation of running containers, monitoring container activity user access, and container resource activity. Logging container administrative access for auditing purposes is also, of course, a best practice.</p>
<p>Because new vulnerabilities are constantly discovered, scanning for them and identifying related vulnerabilities needs to be performed on a continuous basis. That being the case, you really need to incorporate vulnerability scanning that is threaded throughout the entire container lifecycle.</p>
<p>To ensure security issues can be more easily mitigated, you need to ensure that you’re mapping vulnerabilities that are identified in container images to running containers.</p>
<p>Speaking of images, you need to ensure that you only allow approved container images. You need to have tools and processes in place that you can rely on to monitor for, and prevent, the use of unapproved container images. You can leverage image signing or fingerprinting to create a chain of custody that you can rely on to verify the integrity of your containers.</p>
<p>In addition to only allowing approved images, you should also ensure that you use only approved container registries. This is important because requiring the use of approved container registries only reduces exposure to risks by limiting the possibility of introducing unknown vulnerabilities or security issues.</p>
<p>Managing vulnerabilities throughout the container lifecycle requires you to ensure the integrity of your container images in the registry and whenever those images are altered or deployed.</p>
<p>The best way to do this is to periodically audit any images deployed in production to identify images that are out of date.</p>
<p>The concept of least privileges is a widely-accepted security best practice that applies to all sorts of resources. It also applies to containers. Generally speaking, whenever a vulnerability is exploited, the attacker often assumes access and privileges that are equal to that of the compromised application or process. By locking things down with least privileges, your containers will operate with the lowest privileges and access required to get the job done. This obviously limits exposure.</p>
<p>Removing unused and unneeded processes or privileges from the container runtime reduces the container attack surface.</p>
<p>To maintain a stable environment, you should ensure that your containers can access or run only pre-approved or whitelisted files and executables. Not only does this help you maintain a stable container environment, but it also limits your exposure to risk.</p>
<p>Enforcing network segmentation helps protect containers in one subnet from any potential security risks in another subnet.</p>
<p>I should also mention that, as is the case with any other IT environment, you always need to be consistently monitoring activity and user access to your container ecosystem. This allows you to quickly identify suspicious activity. You can use Azure Monitor for Containers and the Azure Container Monitoring Solution, both of which are <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> solutions, to perform this monitoring.</p>
<p>Monitoring resource activity and consumption helps you not only manage performance but it also serves as a helpful security measure. You can use Azure Monitor’s activity log to see what new resources are created or modified.</p>
<p>Maintaining an accurate audit trail of administrative access to your container ecosystem is critical. It’s most useful when you need to dig up forensic evidence after a security incident. The Azure Container Monitoring Solution can be used to perform this auditing.</p>
<p>As you can see, there are quite a few pieces to a solid vulnerability management implementation, but by leveraging them all you can ensure a secure environment.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations! You’ve reached the end of Configuring Azure VM and Container Security. Let’s review what you’ve learned. We kicked things off with host security. Throughout the early part of this course, you learned about configuring endpoint security within VMs and how to harden VMs in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. You also learned how to configure system updates for VMs in Azure as well as how to configure baselines. As we moved through this course, you learned about container security. You learned how to configure networks, authentication and container isolation. You also learned how to configure AKS security and how to configure container registry. Rounding things out, you learned about vulnerability management tools and strategies.</p>
<p>So now that you’ve been through this course, you should have a full understanding of how to configure Azure VM and container security. We’d love to get your feedback on this course, so please give it a rating. As always, thanks for watching and happy learning.</p>
<h1 id="4Configuring-Virtual-Machine-Security"><a href="#4Configuring-Virtual-Machine-Security" class="headerlink" title="4Configuring Virtual Machine Security"></a>4<strong>Configuring Virtual Machine Security</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">Building Templates</a></p>
<h1 id="12AKS-Security"><a href="#12AKS-Security" class="headerlink" title="12AKS Security"></a>12<strong>AKS Security</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation%C2%A7">Cluster Isolation in AKS</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/83/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/83/">83</a><span class="page-number current">84</span><a class="page-number" href="/page/85/">85</a><span class="space">&hellip;</span><a class="page-number" href="/page/266/">266</a><a class="extend next" rel="next" href="/page/85/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2653</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
