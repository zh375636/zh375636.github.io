<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hang&#39;s Blog">
<meta property="og:url" content="https://example.com/page/75/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/page/75/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Implementing-DNS-based-Traffic-Routing-with-Azure-Traffic-Manager-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Implementing-DNS-based-Traffic-Routing-with-Azure-Traffic-Manager-11/" class="post-title-link" itemprop="url">AZ-700-Lab-Implementing-DNS-based-Traffic-Routing-with-Azure-Traffic-Manager-11</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:47" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:47-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:16:06" itemprop="dateModified" datetime="2022-11-22T21:16:06-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Implementing-DNS-based-Traffic-Routing-with-Azure-Traffic-Manager-11/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Implementing-DNS-based-Traffic-Routing-with-Azure-Traffic-Manager-11/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Designing-an-Azure-Network-Implementation-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Designing-an-Azure-Network-Implementation-10/" class="post-title-link" itemprop="url">AZ-700-Designing-an-Azure-Network-Implementation-10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:45" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:45-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 22:06:40" itemprop="dateModified" datetime="2022-11-22T22:06:40-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Designing-an-Azure-Network-Implementation-10/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Designing-an-Azure-Network-Implementation-10/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to “Designing an Azure Network Implementation”. My name’s Guy Hummel and I’ll be helping you with the network aspects of architecting an Azure solution. I’m the Azure Content Lead at Cloud Academy and I have over 10 years of experience with cloud technologies. If you have any questions, feel free to connect with me on LinkedIn and send me a message, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for people who want to become Azure cloud architects.</p>
<p>To get the most from this course, you should have a general knowledge of networking.</p>
<p>We’ll start with an overview of virtual networks, which are the fundamental building blocks of Azure networking. Then I’ll go over the different options for load balancing traffic to applications. Next, you’ll see how to connect Azure virtual networks to external networks, such as in your own datacenter. After that, I’ll explain how to secure your Azure networks. Finally, I’ll show you how to design connectivity for hybrid applications that access on-premises data.</p>
<p>By the end of this course, you should be able to design Azure virtual networks; design external connectivity for Azure virtual networks; design network security strategies for Azure; and design connectivity for hybrid Azure applications.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished.</p>
<p>Now, if you’re ready to learn how to get the most out of Azure’s network services, then let’s get started.</p>
<h1 id="Azure-Virtual-Networks"><a href="#Azure-Virtual-Networks" class="headerlink" title="Azure Virtual Networks"></a>Azure Virtual Networks</h1><p>As soon as you deploy more than one virtual machine in Azure, you’ll probably have to get them to communicate with each other. You can do that easily by putting them in the same Azure virtual network (or vnet). You can put lots of other Azure services in vnets, too, such as Service Fabric, Kubernetes Service, and HDInsight. You can also create multiple vnets and they will all be isolated from each other.</p>
<p>When you create a virtual network, you specify what IP address space to use. You also need to create at least one subnet that uses a portion of the vnet’s IP address space. Then an Azure DHCP server will assign addresses from that subnet’s IP address range to the network interfaces on the VMs.</p>
<p>If you need name resolution so the VMs in a virtual network can communicate with each other more easily, then the easiest solution is to use Azure-provided name resolution, which doesn’t require any configuration. If you need additional capabilities, such as name resolution for your on-premises servers, then you can provision your own DNS server in the vnet. You can still let Azure take care of the name resolution for your VMs by having your DNS server forward those types of queries to Azure.</p>
<p>If you want to use custom domain names or if you need name resolution between virtual networks, then one option is to use the Private Zones feature of Azure DNS. It’s specifically designed for these scenarios.</p>
<p>By default, all resources in a virtual network can send outbound requests to the internet. If you need any of your resources to accept <em>inbound</em> connections from the internet, then you can assign public IP addresses to them. Bear in mind that there’s an hourly charge for reserving public IP addresses, whether you’re using them or not.</p>
<p>Not every type of Azure service can reside in a virtual network, particularly storage and databases. You can get a secure connection between those services and your vnets, though, by using a virtual network service endpoint. This lets you extend the address space in your vnet to the other service and it ensures that the traffic between them stays on the Azure backbone network. Service endpoints are configured on specific subnets. The services supported by service endpoints are Azure Storage, SQL Database, Cosmos DB, and SQL Data Warehouse.</p>
<p>And that’s it for virtual network design.</p>
<h1 id="Load-Balancing"><a href="#Load-Balancing" class="headerlink" title="Load Balancing"></a>Load Balancing</h1><p>Scaling an application horizontally by adding more VMs is a great solution, but how do you distribute requests to all of those VMs? You have two options: Azure Load Balancer and Azure Application Gateway.</p>
<p>Azure Load Balancer is the right choice for the most common scenarios. It acts as a frontend that distributes incoming traffic to a pool of backend VMs. It supports TCP and UDP applications. By default, it distributes requests equally to the VMs. If the application layer served by these VMs is stateless, then this distribution method will work well. If it’s stateful, though, then you’ll need to use source IP affinity mode. In this mode, all requests from the same IP address will always go to the same VM. You should avoid designing this sort of solution, though, because if a VM goes down, then all of its clients will be down.</p>
<p>If you have a stateless application layer and a VM goes down, then a health probe will detect that the instance is no longer available and it will remove it from the pool. Since no client sessions are tied to that specific instance, all of their requests will go to healthy instances.</p>
<p>A health probe is typically an HTTP request to an instance. By default, the load balancer sends a probe every 15 seconds, but you can change the timing if you want. If your VMs are hosting something other than a web application, then you can configure the health probe to try to establish a TCP session on a specific port.</p>
<p>If you’re using the load balancer for an internet-facing application, then you need to assign a public IP address to it. In this scenario, it’s called a public load balancer. All of the VMs behind it still use private IP addresses, though, and all incoming traffic from the internet must go through the load balancer.</p>
<p>When a VM initiates an <em>outbound</em> connection, then the load balancer performs network address translation (or NAT). In other words, it translates the VM’s private IP address to the public IP address on the load balancer plus a port that it maps to that VM. Because it has this capability, the load balancer can be useful even in situations where you don’t need load balancing. If you need a NAT gateway on Azure, then you can just deploy a public load balancer that only manages outbound connections.</p>
<p>If you have an internal application that shouldn’t be exposed to the internet, then don’t assign a public IP address to the load balancer. Instead, it will use a private IP address. In this configuration, it’s known as an internal load balancer.</p>
<p>You can also use both types of load balancers for the same application. For example, you could use a public load balancer for the web tier and a private load balancer for the business logic tier.</p>
<p>The other way to provide load balancing is to use Azure Application Gateway. Unlike Azure Load Balancer, which operates at layer 4 of the network stack, Application Gateway operates at layer 7. This gives you more flexibility in how you can route requests. Instead of just routing based on IP addresses and ports, it can route based on the URL. For example, if the URL of the request begins with the path to your videos folder, then you could tell the application gateway to route the request to your pool of video servers.</p>
<p>You can do lots of other handy things with it too. A few examples are redirecting all HTTP requests to HTTPS, serving traffic to multiple websites, and supporting websockets.</p>
<p>One especially useful feature is SSL or TLS termination. Because encrypting and decrypting traffic is computationally expensive, you can offload that task to the application gateway so the web servers don’t have to do it. However, if your security requirements won’t allow any unencrypted traffic, then you shouldn’t do this, because the traffic between the gateway and the backend web servers would be unencrypted.</p>
<p>Speaking of security, one of the biggest reasons for using an application gateway is the built-in web application firewall. It protects your applications from common exploits, such as SQL injection and cross-site scripting attacks.</p>
<p>Both of Azure’s load balancing options work within a single region. If you want to provide load balancing for VMs or web apps that are distributed across multiple regions, then you’ll need to use Azure Traffic Manager. This service redirects traffic at the DNS level. It <em>doesn’t</em> act as a gateway—it simply tells the client which address it should connect to.</p>
<p>For example, suppose you have an application that’s deployed in 3 regions: East US, West Europe, and Southeast Asia. To minimize the network latency for every user, you could configure Traffic Manager to check where each request is coming from and direct it to the closest region. This is called performance routing. If one of the regions goes down, then Traffic Manager can redirect requests to the next nearest region. This is called priority routing.</p>
<p>There are also two other routing methods available. With weighted routing, it will distribute requests either evenly among the endpoints or according to weights, such as 50% to endpoint 1, 30% to endpoint 2, and 20% to endpoint 3. Geographic routing is similar to performance routing because it looks at the client’s location. The difference is that you can specify exactly which region you want a client to connect to based on their location. For example, if your European customers require that their data stays in Europe, then you could always route them to a European region.</p>
<p>In most cases, you’ll want to use Traffic Manager in conjunction with one of the other two load balancing solutions. You could even use all three of them together. For example, within each region, you could have an application gateway for SSL offloading and an Azure load balancer to distribute requests to the VMs.</p>
<p>Traffic Manager will also work with non-Azure endpoints, such as applications that are on-premises or in another public cloud.</p>
<p>And that’s it for load balancing.</p>
<h1 id="External-Connectivity"><a href="#External-Connectivity" class="headerlink" title="External Connectivity"></a>External Connectivity</h1><p>When most organizations migrate to the cloud, they continue to have a significant amount of infrastructure on-premises and they need to connect those local resources with what they’ve deployed in the cloud. Microsoft provides several ways to do this.</p>
<p>The first decision to make is whether you’ll connect them over the internet. You might not want to do this if you’re concerned about the reliability, performance, or security of this method. If any or all of those concerns are deal-breakers for your organization, then you should choose ExpressRoute.</p>
<p>There are four ways to connect to Azure using ExpressRoute. If your infrastructure is colocated in a datacenter that has a cloud exchange, then you can get an Azure cross-connection through the colocation provider. If you’re not in that sort of facility, but you use a WAN provider, then they can make the Azure cloud look like one of your branch offices. The third option is to use a point-to-point ethernet provider.</p>
<p>All three of these methods use a service provider to connect your infrastructure to Azure. Alternatively, if your infrastructure is located in what Microsoft calls an ExpressRoute location, then you can use ExpressRoute Direct. With this method, you connect to Azure directly without going through a service provider. One advantage of ExpressRoute Direct is that it can support connections up to 100 gigabits per second, which is 10 times as much as you can get through a service provider.</p>
<p>Regardless of which of these methods you use, you’ll have a redundant layer 3 connection that doesn’t go over the internet. Routing is handled using BGP.</p>
<p>If you’re okay with using encrypted connections over the internet instead of taking on the expense of a direct connection, then you can put an Azure VPN Gateway in a virtual network. Once you’ve set that up, there are two ways to to create an encrypted connection to it.</p>
<p>For a site-to-site connection, you install a VPN device with a public IP address at your on-premises location. Then you deploy a VPN gateway in your Azure virtual network. It must be in a gateway subnet that doesn’t have any VMs in it. You also have to make sure that the IP address space of the virtual network doesn’t overlap with the address space of your on-premises network. When both sides are ready, you can set up an IPsec tunnel between the two networks.</p>
<p>If you want to connect multiple sites to the same virtual network, you can set up a VPN device at each location and connect them all to the same VPN gateway. You can only have one VPN gateway per virtual network. This is known as a multi-site configuration. All connections to the same VPN gateway share its available bandwidth.</p>
<p>The second way to connect is called point-to-site. With this method, you connect individual computers to the VPN gateway in your virtual network. You don’t have to use a VPN device, so this is suitable for remote workers and telecommuters. It uses the Secure Socket Tunneling Protocol (or SSTP) on Windows devices and IKEv2 VPN on Macs.</p>
<p>Point-to-site connections use certificate-based authentication. To set this up, first you need either a root certificate from a certificate authority or a self-signed root certificate that you create yourself. Next, you generate client certificates from the root certificate. Then you need to install a client certificate on each client device that will be using a point-to-site connection.</p>
<p>You can connect to the same VPN gateway with both site-to-site and point-to-site methods as long as you can use the same configuration for both. The main issue is what type of routing you configure the VPN gateway to use. Site-to-site connections can use either route-based or policy-based routing. For most scenarios, route-based is the best option, because it’s dynamic, requires less maintenance, and can tolerate failures in the network path. Policy-based routing is static, so you have to maintain all of the routes manually. You’d only want to choose this option is you require strict control of your routing.</p>
<p>Multi-site and point-to-site configurations have to use route-based routing, so they can’t share a VPN gateway with a site-to-site configuration that uses policy-based routing, because a VPN gateway can only be configured to support one type of routing.</p>
<p>Even when you’re using ExpressRoute to connect to your Azure virtual networks, there’s still a reason to use a VPN gateway. You can set up a site-to-site connection as a failover in case your ExpressRoute connection goes down. Traffic would only go through the VPN tunnel if the ExpressRoute connection is not available.</p>
<p>You can also use VPN gateways to connect two virtual networks, but it’s much easier to use virtual network peering, which is a newer feature. To do it, go into one of the virtual networks in the portal, select Peerings from the menu, and click Add. Give it a name. I’ll use the name of the first virtual network dash and the name of the second virtual network. To complete the connection, you also need to create a peering in the other direction in the second virtual network. Then choose the subscription where the second virtual network resides, and finally, choose the second VNet.</p>
<p>Okay, it’s done. The peering from vnet1 to vnet2 is showing a status of “Connected”. Let’s check the second peering as well. It’s connected, too. Once the status of both peerings is “Connected”, instances in the two VNets will be able to communicate with each other as if they were in the same VNet.</p>
<p>You can even do this with virtual networks that are in different regions, which is known as global vnet peering. Traffic between them still goes through the Microsoft backbone network rather than the internet, so the connection is private and has high bandwidth and low latency.</p>
<p>When you create a virtual network, Azure automatically creates a route table for each of the subnets. It then adds system default routes to each table. For example, it creates routes so all of the instances within the virtual network can connect to each other. It also creates a catch-all route that sends traffic to the internet if no other route is applicable. If you don’t want traffic to go to the internet, then you need to override it with a custom route, also known as a user-defined route.</p>
<p>Another example of when you’d use a custom route is if you set up a virtual appliance, such as a firewall, and you need to route traffic through it. In this case, in addition to adding a custom route to the table, you’d also need to enable IP forwarding on the network interface that’s attached to the virtual appliance. Otherwise, Azure would prevent it from forwarding traffic.</p>
<p>So far, I’ve been talking about connectivity for VM instances, but it’s also possible to get the same networking benefits with containers. When you create an Azure Kubernetes Service cluster, you can select the advanced networking option and specify a virtual network and subnet to put the cluster in. Then the nodes in the cluster will use the Azure Container Networking Interface plugin to connect to the virtual network. With this setup, Kubernetes pods can communicate with the rest of your network, including your on-premises network through ExpressRoute or a VPN gateway.</p>
<p>And that’s it for external connectivity.</p>
<h1 id="Security-Strategies"><a href="#Security-Strategies" class="headerlink" title="Security Strategies"></a>Security Strategies</h1><p>When you put an application on the web, you can be sure that hackers and bots will probe it for weaknesses soon afterward. If they find weaknesses, then they’ll likely compromise it in either an obvious way, or even worse, in a way that you don’t notice. So before you deploy any web applications, you need to architect a security solution.</p>
<p>The first step is for your application developers to design secure code. That’s a good start, but it’s difficult to ensure that every application can withstand attacks. So you’ll need to put some type of centralized protection in front of all of your applications.</p>
<p>Azure provides a lot of great network security features to help with this, such as DDoS protection, virtual network isolation, and network security groups (which we’ll talk about more in a minute), but you should also add a layer that’s designed to combat a broad array of threats to web apps.</p>
<p>One good option is the Web Application Firewall that comes with the Azure Application Gateway. It’s based on the well-known Open Web Application Security Project (or OWASP) core rule sets. It protects against attacks like:</p>
<ul>
<li>SQL injection</li>
<li>Cross-site scripting</li>
<li>HTTP request smuggling</li>
<li>Remote file inclusion, and</li>
<li>HTTP protocol violations and anomalies</li>
</ul>
<p>It also detects common misconfigurations in web servers like Apache or IIS.</p>
<p>You can run it in either detection or prevention mode. In detection mode, it simply logs all security alerts. In prevention mode, it actually blocks the attacks that it detects. To monitor the firewall’s activities in either mode, you can look in Azure Monitor, Azure Security Center, and Log Analytics, because they’re all integrated with it.</p>
<p>Although Microsoft’s Web Application Firewall is very capable, you may still want to use a different solution, either because your organization has standardized on a third-party security product or because you need a firewall with additional features. Fortunately, a number of vendors, such as Barracuda and Palo Alto Networks, provide pre-built virtual machines that you can get from the Azure Marketplace. These are known as network virtual appliances.</p>
<p>Ideally, these appliances should be put in a demilitarized zone (or DMZ). This is a perimeter network that keeps unwanted traffic, including attacks, from getting through to your backend network. In this example, the perimeter network and the backend network are two subnets within the same virtual network.</p>
<p>To control the flow of traffic between these two subnets, you can use an NSG (which stands for network security group). An NSG contains security rules that allow or deny traffic to resources in a subnet of a virtual network. They’re similar to firewall rules. You can also apply NSGs to the network interfaces of specific VMs (if they were deployed using Resource Manager) or to all of the traffic to and from specific VMs (if they were deployed using the classic model), but it’s usually better to apply them to an entire subnet.</p>
<p>Here’s an example NSG. It has inbound and outbound rules. The most important are the inbound rules. The first inbound rule allows DNS traffic over port 53 from anything inside the virtual network to the DNS server, which has this address.</p>
<p>Notice that I didn’t have to specify an address range for the source. That’s because Microsoft lets you use service tags instead. This greatly simplifies your rules and makes them easier to read and understand. For example, the VirtualNetwork tag includes the virtual network address space, all connected on-premises address spaces, and all peered virtual networks or virtual networks connected through a VPN gateway. If you had to specify all of those address ranges yourself, the rule would be pretty complicated and it would be easy to make a mistake when creating the rule. Another advantage is that the addresses in a service tag are automatically updated when something changes, so you don’t need to update your rules. In case you’re wondering, you can’t create your own service tags. You can only use the predefined ones.</p>
<p>The second rule allows RDP traffic over port 3389 from the internet to this virtual network so you can remotely administer the VMs. Notice that “Internet” is also a service tag again. The third rule allows traffic to the firewall, which has this address. The next one allows traffic between the web server and the app servers. The destination is a list of both addresses.</p>
<p>After all of these allow rules, we add deny rules. The first one denies all traffic from the internet to this virtual network. Since it has a lower priority than this allow rule, it will only be applied for traffic that doesn’t match the allow rule. Finally, we deny all traffic between the frontend and backend subnets that wasn’t explicitly allowed above. These three rules at the bottom are added by default. You can’t change or delete them, but you can override them with the rules above, which is what we’ve done. To activate this NSG, you’d need to associate it with both the frontend and backend subnets.</p>
<p>By default, the outbound rules allow all outgoing internet traffic. This could be dangerous as your VMs might accidentally leak sensitive information to the internet. You can add a security layer by using forced tunneling.</p>
<p>With this configuration, all internet-bound traffic has to go through your on-premises network before going out to the internet. This gives you the opportunity to run this traffic through an inspection and auditing system that’s installed on-premises.</p>
<p>The way to do this is pretty straightforward. You create a user-defined default route that points to the VPN gateway in your virtual network. Then, on the VPN gateway, you set the default site to the on-premises location where you want to redirect the traffic. If you’re using ExpressRoute rather than a site-to-site VPN, then instead you advertise a default route via the BGP peering sessions.</p>
<p>Since forced tunneling can significantly slow down internet-bound traffic, you usually shouldn’t use it on frontend web servers. It’s more suitable for backend servers.</p>
<p>And that’s it for security strategies.</p>
<h1 id="Connectivity-for-Hybrid-Applications"><a href="#Connectivity-for-Hybrid-Applications" class="headerlink" title="Connectivity for Hybrid Applications"></a>Connectivity for Hybrid Applications</h1><p>In an earlier lesson, you learned how to make external connections from Azure, especially using ExpressRoute or a VPN. Those solutions are great, but if you only need external connectivity for a single application, then they’re probably overkill, because you need to modify your network to use them. Fortunately, there are much simpler, more focused solutions that you can use instead.</p>
<p>Azure provides many services to help you build hybrid applications that combine Azure and on-premises resources. Which one you use depends on what you’re trying to do. Azure WCF Relay lets you expose Windows Communication Foundation services in on-premises applications to Azure. Azure Relay Hybrid Connections is a newer service that does the same thing for WebSockets and HTTP rather than WCF. You can also use Hybrid Connections from within Azure App Service. The Azure Data Management Gateway, now known as the Self-hosted Integration Runtime, lets you copy data between Azure and on-premises data stores. Finally, the Azure On-Premises Data Gateway connects on-premises data sources with Azure Analysis Services.</p>
<p>I have to admit that I get the Data Management Gateway and the On-Premises Data Gateway confused sometimes, because their names sound very similar, even though they’re totally different. Maybe that’s why Microsoft renamed Data Management Gateway to Self-hosted Integration Runtime. Of course, the new name doesn’t really help you remember what it does either. Oh well, after you’ve worked with them for a while, you’ll remember which one is which.</p>
<p>Azure Relay service allows you to expose on-premises applications to Azure without having to open a port on your firewall. The way this works is the server and the client communicate through an Azure Service Bus namespace. The on-premises application communicates with Service Bus over HTTP or HTTPS. Since these ports are already open on most firewalls, no changes are needed. Of course, both the server and the client need to include code that connects to Azure Relay.</p>
<p>Originally, Azure Relay was called Service Bus Relay and it only worked with Windows Communication Foundation services. Microsoft renamed it WCF Relay, because they created an alternative feature that doesn’t use WCF. It’s called Hybrid Connections and it works with WebSockets and HTTP. WCF Relay and Hybrid Connections exist as side-by-side alternatives in the Azure Relay service.</p>
<p>Microsoft considers WCF Relay to be a legacy service, though. If you have existing WCF-based applications, then WCF Relay is the way to go, but if you’re developing new applications, you should write them with WebSockets or HTTP instead and use Hybrid Connections. The biggest advantage of using WebSockets or HTTP is that they’re open standards, so you can use them in any language on any platform that supports them.</p>
<p>Azure App Service has a Hybrid Connections feature as well, but it works slightly differently. Suppose you have an Azure app that needs to access an on-premises database. You’d have to install a Hybrid Connection Manager (or HCM) in the network where the database resides. It runs on Windows Server 2012 and higher. Both sides would still connect to Service Bus, but the on-premises side would connect through the HCM to get to Service Bus. This would set up a TCP tunnel between the app and the database. The connection would be over HTTPS. Authentication and authorization would be done using a shared access signature.</p>
<p>By the way, if you already have a VPN connection between an Azure virtual network and an on-premises location, then App Service can use it through its VNet Integration feature. OK, on to the Self-hosted Integration Runtime (formerly known as the Data Management Gateway). This is an on-premises client that works with Azure Data Factory, so let’s go over how Data Factory works before diving into the Integration Runtime client.</p>
<p>Data Factory is used to move and transform data. For example, suppose that every night you want to copy records from SQL Database to Data Lake Store, then run a Spark job on an HDInsight cluster to process that data, and finally, store the processed data in SQL Data Warehouse. You could automate this process by creating a Data Factory pipeline that consists of three activities, one for each step.</p>
<p>Before creating the pipeline and activities, you’d need to define the data sources and sinks. First, you’d create a linked service for each data source. A linked service contains the connection information Data Factory will use to access the data. For example, the linked service for the input data would give the connection string for the SQL Database instance. Then you’d create a dataset that tells Data Factory which data to access. In this case, it would be the name of the table. You’d also need to create linked services and datasets for Data Lake Store and SQL Data Warehouse.</p>
<p>Now you could create a pipeline with 3 activities in it, one to copy the data from SQL Database to Data Lake Store, one to spin up an HDInsight cluster and run a Spark job, and one to copy the output data to SQL Data Warehouse. Once the pipeline is ready, you could run it manually, but it would be much easier to schedule it to run every night automatically, which you could do by setting a schedule trigger.</p>
<p>OK, so that’s how Data Factory normally works, but how do you get it to work with external data? That’s where the Self-hosted Integration Runtime comes in. You install it in your on-premises environment, register it with Azure, and connect it to your SQL Server instance. Then, when you create the linked service for the data source, you give it the connection details for the SQL Server instance, but you tell it to connect using the integration runtime.</p>
<p>Data Factory supports two other integration runtimes as well. The Azure Integration Runtime is the default, so you don’t normally need to explicitly create it. The Azure-SSIS Integration Runtime lets you run SQL Server Integration Services packages on Azure. An SSIS package is actually kind of like a Data Factory pipeline. It contains a series of tasks to transform data. If you already have SSIS packages that you’ve been running locally, then this is a great way to lift and shift them to Azure.</p>
<p>When you create an SSIS Integration Runtime, you are provisioning a cluster that can run SSIS packages. Once it’s provisioned, you can even use SQL Server Data Tools or SQL Server Management Studio to deploy packages to it. However, the SSIS integration runtime incurs charges while it’s running, so to save money, you can use Data Factory to start it, execute an SSIS package, and stop it. This is similar to how Data Factory spins up an HDInsight cluster to process data. If your SSIS packages need to access on-premises data, then you have to connect the integration runtime to a virtual network that’s connected to your on-premises environment.</p>
<p>Alright, now we’ll move on to the Azure On-Premises Data Gateway. This is something you install onsite that will let Azure Analysis Services retrieve on-premises data. First, you install it as a Windows service. Then you register it with the Gateway Cloud Service. Next, you create a gateway resource in Azure. Finally, you connect your Azure Analysis Services servers to your gateway resource.</p>
<p>Once you have it set up, your data models can access your on-premises data sources through the gateway resource, which goes through Azure Service Bus to reach the On-Premises Data Gateway, which connects to your data sources.</p>
<p>As you’ve seen, there are usually better ways to connect specific on-premises resources to Azure than using a VPN or ExpressRoute. Another example of this is with domain services. Most Azure customers already have a locally-installed Active Directory Domain, so if you have a direct connection to Azure, then it might seem like a good idea to just connect your Azure VMs to your on-premises domain servers. Although that would work, it could potentially be unreliable or slow, especially over a VPN.</p>
<p>A better solution is to use Azure Active Directory Domain Services. I won’t go into the details of synchronizing it with your on-premises domain, because that’s covered in our Active Directory course. I do want to point out a couple of things to watch out for when you’re joining an Azure VM to a domain, though. First, the VM needs to be in a virtual network that’s connected to the one where your managed domain resides. Otherwise, it won’t be able to join. Second, the user whose credentials you specify for joining the VM to the domain has to be a member of the Azure AD domain controller administrators group or it won’t work.</p>
<p>And that’s it for hybrid application connectivity.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>I hope you enjoyed learning about Azure’s network services. Let’s do a quick review of what you learned.</p>
<p>An Azure virtual network has an IP address space and at least one subnet. IP addresses are assigned by an Azure DHCP server. VMs in a virtual network can communicate with each other using Azure-provided name resolution. You can provision your own DNS server in the vnet to resolve other addresses. Use Azure DNS Private Zones if you need custom domain names or name resolution between virtual networks. To accept inbound connections from the internet, assign public IP addresses to resources in a vnet. A virtual network service endpoint lets you extend the address space in your vnet to services that can’t reside in a vnet, such as Azure Storage and Azure SQL Database.</p>
<p>Azure Load Balancer acts as a frontend that distributes incoming traffic to a pool of backend VMs. It supports TCP and UDP applications. By default, the load balancer sends a probe to each backend VM every 15 seconds. If a health probe fails, then the VM is removed from the pool. A public load balancer has a public IP address for internet-facing applications. When a VM initiates an outbound connection, the load balancer performs network address translation. An internal load balancer doesn’t have a public IP address.</p>
<p>The other way to provide load balancing is to use Azure Application Gateway, which operates at layer 7 of the network stack. It can route based on the URL, redirect all HTTP requests to HTTPS, serve traffic to multiple websites, support WebSockets, and handle SSL offloading.</p>
<p>To provide load balancing across multiple regions, use Azure Traffic Manager, which redirects traffic at the DNS level. Performance routing directs a request to the closest region. Priority routing redirects requests to the next best region if there’s an outage. Weighted routing distributes requests either evenly among the endpoints or according to weights. Geographic routing directs a request to a specific region based on the client’s location.</p>
<p>ExpressRoute provides a redundant layer 3 connection between your on-premises location and Azure. You can connect using a colocation provider, a WAN provider, or a point-to-point ethernet provider. Routing is handled using BGP.</p>
<p>To connect over the internet instead, deploy an Azure VPN Gateway in a virtual network. In a site-to-site configuration, you create an IPsec tunnel to the gateway through an on-premises VPN device. In a multi-site configuration, there’s a VPN device at each remote location, but still only one VPN Gateway in the Azure virtual network. Point-to-site connections use certificate-based authentication instead of a VPN device. This configuration is intended for individual computers or devices.</p>
<p>Multi-site and point-to-site configurations have to use route-based routing, which is dynamic. Site-to-site connections can use either route-based or policy-based routing, which is static. Policy-based routing requires more maintenance, so it should only be used when necessary. Also, a VPN gateway can only be configured to support one type of routing, so a site-to-site configuration that uses policy-based routing can’t share a VPN gateway with multi-site or point-to-site configurations. If you have an ExpressRoute connection, you can set up a site-to-site connection as a failover in case your primary connection goes down.</p>
<p>Virtual network peering allows instances in two virtual networks to communicate with each over the Microsoft backbone network, even if they’re in different regions.</p>
<p>Each subnet in a virtual network has a route table with system default routes in it. You can override these routes with custom routes, also known as user-defined routes.</p>
<p>If you put an Azure Kubernetes Service cluster in a subnet of a virtual network, then the nodes in the cluster can use the Azure Container Networking Interface plugin to communicate with the rest of the network.</p>
<p>The Web Application Firewall that comes with the Azure Application Gateway protects against attacks, such as SQL injection and cross-site scripting. You can run it in either detection or prevention mode. Alternatively, you could use a network virtual appliance from a third-party vendor. These appliances should be put in a demilitarized zone that keeps unwanted traffic from getting through to your backend network.</p>
<p>A network security group contains rules that allow or deny traffic to resources in a subnet of a virtual network. You can also apply NSGs to the network interfaces of specific VMs if they were deployed using Resource Manager.</p>
<p>Service tags simplify your rules. For example, the VirtualNetwork tag includes the virtual network address space, all connected on-premises address spaces, and all peered virtual networks or virtual networks connected through a VPN gateway.</p>
<p>By default, the outbound rules allow all outgoing internet traffic. To force all internet-bound traffic to go through an inspection and auditing system first, use forced tunneling to your on-premises network.</p>
<p>Azure WCF Relay lets you expose Windows Communication Foundation (or WCF) services in on-premises applications to Azure without having to open a port on your firewall. Azure Relay Hybrid Connections is a newer service that does the same thing for WebSockets and HTTP rather than WCF. You can also use Hybrid Connections from within Azure App Service, but you have to install a Hybrid Connection Manager in the network where the database resides. The Azure Data Management Gateway, now known as the Self-hosted Integration Runtime, lets Azure Data Factory copy data between Azure and on-premises data stores. The Azure On-Premises Data Gateway connects on-premises data sources with Azure Analysis Services.</p>
<p>To copy on-premises data using Data Factory, first install the Self-hosted Integration Runtime on-premises, register it with Azure, and connect it to your local data source. Next, create a linked service that accesses the data source via the integration runtime. Also create a linked service for the Azure data sink. Then create datasets for the data source and data sink. Finally, create a pipeline and a copy activity.</p>
<p>An Azure-SSIS Integration Runtime is an Azure cluster that lets you run SQL Server Integration Services packages.</p>
<p>To join a VM to a domain, make sure it’s in a virtual network that’s connected to the one where your Azure Active Directory managed domain resides.</p>
<p>Now you know how to design Azure virtual networks; design external connectivity for Azure virtual networks; design network security strategies for Azure; and design connectivity for hybrid Azure applications.</p>
<p>To learn more about Azure’s network services, you can read Microsoft’s documentation. Also watch for new Microsoft Azure courses on Cloud Academy, because we’re always publishing new courses. Please give this course a rating, and if you have any questions or comments, please let us know. Thanks and keep on learning!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Implementing-Azure-Virtual-Network-NAT-with-Azure-Functions-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Implementing-Azure-Virtual-Network-NAT-with-Azure-Functions-9/" class="post-title-link" itemprop="url">AZ-700-Lab-Implementing-Azure-Virtual-Network-NAT-with-Azure-Functions-9</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:44" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:44-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:16:36" itemprop="dateModified" datetime="2022-11-22T21:16:36-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Implementing-Azure-Virtual-Network-NAT-with-Azure-Functions-9/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Implementing-Azure-Virtual-Network-NAT-with-Azure-Functions-9/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Application-Load-Balancing-with-Azure-Application-Gateways-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Application-Load-Balancing-with-Azure-Application-Gateways-8/" class="post-title-link" itemprop="url">AZ-700-Lab-Application-Load-Balancing-with-Azure-Application-Gateways-8</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:42" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:42-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:16:46" itemprop="dateModified" datetime="2022-11-22T21:16:46-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Application-Load-Balancing-with-Azure-Application-Gateways-8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Application-Load-Balancing-with-Azure-Application-Gateways-8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Create-and-Configure-Load-Balancers-in-Microsoft-Azure-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Create-and-Configure-Load-Balancers-in-Microsoft-Azure-7/" class="post-title-link" itemprop="url">AZ-700-Lab-Create-and-Configure-Load-Balancers-in-Microsoft-Azure-7</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:41" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:41-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:17:00" itemprop="dateModified" datetime="2022-11-22T21:17:00-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Create-and-Configure-Load-Balancers-in-Microsoft-Azure-7/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Create-and-Configure-Load-Balancers-in-Microsoft-Azure-7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Load-Balancing-with-Azure-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Load-Balancing-with-Azure-6/" class="post-title-link" itemprop="url">AZ-700-Load-Balancing-with-Azure-6</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:39" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:39-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 22:01:02" itemprop="dateModified" datetime="2022-11-22T22:01:02-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Load-Balancing-with-Azure-6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Load-Balancing-with-Azure-6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><h1 id="An-Intro-to-Azure-Load-Balancers"><a href="#An-Intro-to-Azure-Load-Balancers" class="headerlink" title="An Intro to Azure Load Balancers"></a>An Intro to Azure Load Balancers</h1><p>Hello and welcome to Azure load balancers! In this brief lecture, you will learn what Azure load balancers are and what they are used for.</p>
<p>In the context of networking, the term “load balancing” refers to the process of distributing incoming network traffic across multiple backend resources. Such backend resources are typically virtual machines that are deployed in a “backend pool” but can also be instances in a virtual machine scale set.</p>
<p>The Azure Load Balancer operates at the Transport Layer, which is layer 4 of the OSI model. When you place a load balancer in front of an application running on VMs or on a scale set, the load balancer serves as the single point of access for that application. As users hit the load balancer to access the application, the load balancer balances that incoming traffic across however many backend VMs or resources you’ve deployed in the backend pool.</p>
<p>Azure load balancers come in two varieties. There are public load balancers and internal load balancers, which are also known as private load balancers.</p>
<p>A public load balancer is used when you need to load balance incoming Internet traffic to your virtual machines. This type of load balancer requires you to assign a public IP address to the frontend of the load balancer. It’s also important to note that public load balancers can provide outbound connections to the Internet for VMs that are located inside your Azure virtual network. To make this happen, what public load balancers do is translate the private IP addresses of the virtual machines to public IPs. This allows them to communicate externally even though the VMs themselves have no public IP addresses.</p>
<p>Internal load balancers can be used in situations where only private IP addresses are required on the frontend. This means that internal load balancers are limited to use cases where you only need to load balance traffic within your Azure virtual network, or from an on-prem network that has been connected to your virtual network through a VPN or ExpressRoute connection.</p>
<p>The image on your screen depicts a typical use case for both internal and public load balancers.</p>
<p>When you deploy a load balancer, you’ll have a choice of two SKUs: Basic and Standard. The standard load balancer can support any scenario that a basic load balancer can support – and then some.</p>
<p>For example, while the basic load balancer can support up to 300 instances, the standard load balancer can support up to 1000 instances. Another benefit of the standard load balancer over the basic load balancer is the support for availability zones. While the standard load balancer supports zone-redundant and zonal frontends for inbound and outbound traffic, basic load balancers do not offer any support at all for availability zones.</p>
<p>The table on your screen shows the key differences between Basic and Standard load balancers.</p>
<p>So, why would you ever use a load balancer? Well, there are many use cases for load balancers, both public and internal. The most common use case for a load balancer is when you wish to increase availability of your application by distributing it across multiple VMs and across multiple zones. You might also want to deploy a load balancer if you wish to provide outbound connectivity for your VMs without assigning them their own public IP addresses.</p>
<p>As far as security goes, while the basic load balancer is open to the Internet by default, the standard load balancer is built upon the zero-trust model. This means that the standard load balancer is inherently secure. As a matter of fact, the standard load balancer is part of your virtual network. Unless you explicitly allow inbound traffic via a network security group, traffic is not allowed.</p>
<p>Because of the built-in security and better features Microsoft recommends using standard load balancers over basic load balancers whenever possible.</p>
<h1 id="Load-Balancer-Components"><a href="#Load-Balancer-Components" class="headerlink" title="Load Balancer Components"></a>Load Balancer Components</h1><p>Welcome to Load Balancer Components. Now that you know what a load balancer is and what it’s used for, let’s talk a little bit about the components that make up an Azure load balancer.</p>
<p>There are actually several pieces that make up a load balancer. You have the Frontend IP Configuration, the Backend Pool, Health Probes, and Load Balancing Rules. You also have High Availability Ports, Inbound NAT Rules, and Outbound Rules.</p>
<p>So, lets touch on each of these, starting with the Frontend IP Configuration.</p>
<p>The Frontend IP of a load balancer is the point of contact for clients. It can be a private IP address or a public IP address, depending on the type of load balancer. When someone needs to access an application that is load balanced, that person would access it through the Frontend IP. Load balancers can even have multiple Frontend IP addresses assigned to them.</p>
<p>The Backend Pool is really just a collection of VMs or VM instances within a scale set that is configured to service the incoming requests to a load balancer. When a request for an application comes in on the Frontend IP, the load balancer sends the request to the backend pool. The load balancer will even automatically reconfigure itself whenever you add or remove instances from the backend pool. This ensures that the load balancer never sends traffic to an instance that has been removed.</p>
<p>Health probes determine the status of the instances that are configured in the backend pool. They determine whether or not a specific instance is healthy and if it can receive traffic. When a health probe that you configure during load balancer set up stops responding, the load balancer will stop sending connections to the unhealthy instance.</p>
<p>Load balancing rules determine how inbound traffic gets distributed across the backend pool instances. A typical configuration for a load balanced Web server would include a load-balancing rule for port 80 traffic, or HTTP, that routes traffic from the front-end IP back to port 80 on the backend instances.</p>
<p>The picture on your screen depicts such a rule.</p>
<p>When you configure a load balancer rule with ‘protocol - all and port - 0’, what you are doing is configuring high-availability ports. What this rule does is allow you to use a single rule to load balance all TCP flows and UDP flows that hit all ports of an internal standard load balancer. You would typically leverage this feature if you need to load balance a large number of ports.</p>
<p>Inbound NAT rules are used to forward inbound traffic with a specific front-end IP address and port combination. Such traffic is sent to a specific VM or to a specific instance within the backend pool. A typical use case for inbound NAT rules would be one where you wish to allow RDP connections to multiple different VM’s behind a load balancer. Configuring NAT rules for your virtual machines allows you to connect to your VM’s over RDP without the need for jump box or a public IP for each VM.</p>
<p>And lastly, outbound rules are used to configure outbound network address translation, or NAT, for all VM’s within the backend pool. This kind of rule allows you to provide outbound communication to the Internet for your instances within the backend pool. I should mention, however, that outbound rules are only supported on the standard load balancer. They are not supported by the basic load balancer.</p>
<p>Join me in the next lesson, where I will show you how to perform a basic load balancer deployment.</p>
<h1 id="DEMO-Deploying-a-Load-Balancer"><a href="#DEMO-Deploying-a-Load-Balancer" class="headerlink" title="DEMO: Deploying a Load Balancer"></a>DEMO: Deploying a Load Balancer</h1><p>Welcome back, in this demonstration here, I want to show you how to deploy a basic load balancer. What this will be is a load balancer that load balances two VMs that I have already deployed. On the screen here, you can see I’m logged into my Azure portal. And what we have here is a VM called VM1 and a VM2. These VMs are both deployed into an availability set called AvailSet.</p>
<p>Now what I’ve done on each of these VMs is install IIS Web Services since they are both Windows 2019 servers. So what we’ll do is deploy a basic load balancer, and we’ll load balance port 80 or HTTP across both of these VMs. So to get started, what we’ll do here is we’ll create a new resource. And to do that we’ll select the hamburger here, and we’ll click Create a resource. And then what we’ll do is we’ll search the marketplace for load balancer. We’ll go ahead and select Load Balancer from the list. And then from here, we can read a little bit about the load balancer itself, how it works, what it offers, all that fun stuff. And then what we can do is click Create here.</p>
<p>Now what we’re going to do for this load balancer is deploy into the Lab Subscription and then into the LBLabs resource group that I’ve set up. This LBLabs resource group contains the VMs that are part of this lab. I like to keep things together.</p>
<p>Now as you can see here, we have quite a bit of information we need to provide here. What we’ll do is call our load balancer Myloadbalancer. Then what we’ll do is we’ll deploy into East US which is where my other resources are located. And we can see here the type offers us either an internal type or a public type. If we select Internal, we’ll be deploying an internal load balancer that is not exposed to the Internet. Public exposes it to the Internet, so we’ll leave this at Public. And like I mentioned earlier, we’re going to deploy a basic load balancer.</p>
<p>Now since the load balancer is public, we need to assign a public IP address for it. We don’t have an existing public IP that I’m going to use, so we’re going to select the option here to create a new one. And what I’ll do is I’ll call the public IP address myloadbalancerIP.</p>
<p>Now the SKU for the public IP address is going to match the SKU of the load balancer itself. And then the option here for assignment is whether or not we want to assign a static public IP to our load balancer or simply just use a dynamic one. For this exercise, we’ll use a dynamic IP address. And what that means is that can change over time. But normally in a production environment, you’d be accessing it through DNS anyway. So the IP address changing is typically not that big of a deal. And for this exercise, we do not need a public IPv6 address.</p>
<p>We’re not going to do any tagging for this particular load balancer, so we can just click Review and create here. And what it does here, it validates our configuration, makes sure everything that we’ve provided matches up with what is required for that particular load balancer. We can see we get the green validation passed check mark, so we can go ahead and create the load balancer.</p>
<p>Now the creation of the load balancer is just the first part of what we need to do here. We’ll go ahead and Go to resource here. And we can see that our load balancer has now been deployed. Now like I was saying, the creation of the load balancer itself is just the first piece of what we need to do here. We need to create a frontend IP configuration. We need to configure backend pools. We need to configure health probes, load balancing rules, and we need to make sure that we can load balance those two VMs properly.</p>
<p>Now since I’ve already gone ahead and deployed the VMs that I’m going to load balance, that’s one task that we don’t need to worry about. So the first task we’re going to complete here for our load balancer is to create the backend pool that’s going to host the two VMs that we’re going to load balance.</p>
<p>So to create that backend pool, we simply select Backend pools here. We can see we have none defined, so we’ll go ahead and add one. And we’ll give it a name, and we’ll just call it BackendPool. And then what we need to do is select a virtual network that this backend pool will run from. If we select the dropdown here, we can see we have our LBLabs vnet which is where our VMs are. So we’ll go ahead and select him. And again we’re using IPv4. And if we hover over Associated to here, what we need to do here is associate the backend pool to one or more VMs.</p>
<p>Now we could also associate it with instances within a VM scale set. But for this demonstration, we’re just using two basic virtual machines. So we’ll select the dropdown here. We’ll tell it we’re going to associate with virtual machines. And then when we do that, it’s going to ask us what virtual machines we want to associate with.</p>
<p>Now you’ll notice that we can only attach virtual machines in East US, and that’s because that’s where our load balancers being deployed. It also tells us here that the VMs need to have a basic SKU public IP configuration or no public IP configuration at all. So we’ll go ahead and add our virtual machines here. We have VM1 and VM2. And we’ll add them in.</p>
<p>Now that we have a name for our pool, an associated virtual network, and it’s associated with our backend VMs, we’ll go ahead and click Add. And what this is doing is adding the backend pool to the load balancer. So we can see our backend pool is now part of our load balancer. With our backend pool configured, we can go ahead and create the health probe that I talked about in the previous lesson. This health probe is going to allow the load balancer to monitor the status of the backend VMs.</p>
<p>So let’s go ahead and add a health probe down here. Go ahead and click Add. And we’ll just call this again MyHealthProbe. Since we are going to load balance HTTP traffic or port 80 traffic, we will select the dropdown for Protocol and select HTTP. We can leave the path at the default forward slash. And basically what that means is that’s the routes of the URI for that requesting health status from that backend point. So it’s just going to hit the root of the website on those VMs.</p>
<p>Now this interval here, this is the amount of time between the probe attempts. So it’s gonna go back every so many seconds to check the status of each of the backend endpoints. We’ll change this to 15 seconds. The unhealthy threshold is the number of times that it senses a failure before it actually raises an actual unhealthy failure. This basically tells the load balancer hey, you need to detect two probe failures consecutively before you label a VM as unhealthy. So we’ll leave this default two here, and we’ll go ahead and click okay.</p>
<p>Now what this does is create the health probe. So now we have the backend pool that contains our two VMs which are running IIS. And then we have the health probe that’s going to go back and check the root path for HTTP over port 80 on each of those VMs. If one of them fails twice in a row, the load balancer will mark that particular instance as failed and not send any traffic to it.</p>
<p>Now speaking of sending traffic, we now need to create the load balancing rule. And this load balancing rule will tell the load balancer where traffic goes and why and when. So we’ll go ahead and select a load balancing rule here, and we’ll click Add. We’ll give our rule a name here. And again we’re working with IPv4. Now this frontend IP address, we can only select the front IP address that has a public IP.</p>
<p>Now this frontend IP address is the frontend of the load balancer. If we select the dropdown here, we only have the load balancer frontend. Since HTTP comes over TCP port 80, we’ll leave the protocol set to TCP and the port as 80. The backend port is also 80. So basically what we’re doing here is we’re routing traffic hitting the frontend on 80 and then sending it to the backend port on 80.</p>
<p>So we’re not doing any kind of translations or anything. We can see we already have the backend pool filled in here for this dropdown here. And the health probe is already there by default. Now if we hover over Session Persistence here, we can see in this black box what Azure is telling us is that we can configure what is called Session Persistence. And this means that we can ensure that traffic from a specific client gets handled by the same virtual machine in the backend pool for the duration of that specific session.</p>
<p>Now if we select the dropdown, we can base it on client IP, client IP and protocol, or have no session persistence. We’re not interested in creating any kind of session persistence because you don’t need to for this demonstration. But if you have a situation where you need to ensure that a client session remains on a specific VM throughout that session, you would configure your Session Persistence here. So we’ll leave this set to none. And if we hover over Idle Timeout here, we can see that this Idle Timeout allows us to configure how to keep the session open without relying on the client to send keep alive messages. We’ll leave the default here at four minutes.</p>
<p>Now if we hover over this Floating IP direct server return, we can see here that Microsoft recommends using this only when you’re using SQL AlwaysOn Availability Group Listener and SQL Failover Clustered Instance IP Address. We’re not using SQL AlwaysOn here or any kind of failover, so we’ll leave this disabled. And then from here, we’ll click okay.</p>
<p>Now at this point, we have the rule saved. And if we click on Frontend IP configuration, we can see we have the load balancer frontend. And it’s using the myloadbalancerIP. Now what I’ll do here is go out to my LBLabs here, and we’ll start up VM1 and VM2 here. We’ll let these VMs spin up for a second. And then what we’ll do is we’ll go out and we’ll test our load balancer, and see if we can hit IIS on our load balancer.</p>
<p>Now to get the IP address for our load balancer, we can go ahead and select myloadbalancerIP. This is the public IP address that we created earlier. And we can see we have an IP address here of 52.149.165.55. So we’ll copy this. Let’s open up an incognito window. And we’ll paste and go. And we can see that VM1 has responded.</p>
<p>Now this VM1 here is showing up because I made a custom default HTML file on our VM1 IIS deployment. Now if we open up another tab, let’s see if I can get this to work on both. We can see VM1 shows up again. If we refresh, it’s gonna keep hitting whatever makes the most sense at the time. Try one more here. And the reason this is hitting VM one first is because there’s no real load on the load balancer to be distributing across VMs. So it’s just going to hit whatever makes sense.</p>
<p>Now if I do this, if I go back out to LBLabs and I stop VM1, we’ll give this a moment to stop. And then what we’ll do is we’ll try to hit the load balancer again. And you’ll see that the load balancer then recognizes that VM1 is not there and sends us over to VM2. Let’s go ahead and open an incognito window. And we can see here that the load balancer sent me over the VM2. And that’s because the health rule noticed that the VM1 server has gone offline. So the load balancer is smart enough to look at that and say okay, we know VM1 is down.</p>
<p>So let’s go over to VM2. And that’s pretty much it. So let’s minimize this here, and we’ll go back out to my load balancer. And we can see we have our frontend with an IP address that’s public. We can see the backend pool that points to our two VMs. We can see we have our health probe that is looking for port 80. So it’s going out to each of those VMs every 15 seconds and checking to see if port 80 is responding. If it doesn’t twice in a row, it marks that resource as down so it won’t send any traffic to it. And then we have the load balancing rules.</p>
<p>So with that, you now know how to deploy a basic load balancer and how to load balance a basic IIS deployment across two virtual machines.</p>
<h1 id="Application-Gateway-Intro"><a href="#Application-Gateway-Intro" class="headerlink" title="Application Gateway Intro"></a>Application Gateway Intro</h1><p>Hello, and welcome to Application Gateway! In this lesson, we are just going to touch on what Azure application Gateway is and what it offers.</p>
<p>Azure application Gateway is another load balancer offering that is used to load balance web traffic to web applications. While the Azure load balancer offering operates at the transport layer of the OSI model, and routes traffic based on source IP and port to a destination IP and port, the Azure application Gateway uses additional HTTP attributes to make routing decisions.</p>
<p>For example, when a request hits the application Gateway, the gateway can make routing decisions based on the URI path or based on host headers. Let’s assume, for example, that we have a website that hosts images and video. You could use application Gateway to route incoming traffic to the correct set of servers based on the URL. Incoming requests for a URL that includes &#x2F;images can be routed to the servers, or backend pool, that hosts your images. Incoming requests for a URL that includes &#x2F;video can be routed to the pool that hosts your videos. The pool that you route traffic to can consist of VM’s, a VM scale set, or even on-prem servers.</p>
<p>The image on your screen shows an example of how application Gateway can route traffic.</p>
<p>This is known as application layer routing and it happens at layer 7 of the OSI model.</p>
<p>The Azure application Gateway offers several features that allow you to load balance and manage traffic to web applications. Some key features include SSL termination, autoscaling, web application firewall, and zone redundancy. </p>
<p>SSL termination allows you to offload encryption and decryption to the gateway itself, rather than forcing the backend servers to handle it. </p>
<p>The autoscaling feature of application Gateway allows you to automatically scale up or down, based on traffic load. This feature is only supported by application Gateway standard V2. </p>
<p>The web application firewall is a service that offers centralized protection of web applications. The web application firewall, or WAF, protects such applications from many common exploits and vulnerabilities like SQL injection attacks, cross site scripting attacks, and many more. </p>
<p>By offering zone redundancy, the standard V2 application Gateway can be spanned across multiple availability zones. Because it can span multiple availability zones, you do not need to provision a separate application Gateway in each zone.</p>
<p>There are many other application Gateway features available. Visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/features">URL</a> that you see on your screen for a complete list and details of each.</p>
<h1 id="Application-Gateway-Components"><a href="#Application-Gateway-Components" class="headerlink" title="Application Gateway Components"></a>Application Gateway Components</h1><p>Welcome to application Gateway components. Now that you’ve been introduced to application Gateway and what it offers, let’s take a look at the difference components that make up the application Gateway.</p>
<p>The application Gateway consists of front-end IP addresses, listeners, request routing rules, HTTP, settings, backend pools, and health probes.</p>
<p>As is the case with load balancers, an application gateway has a front-end IP address associated with it. The front-end IP address can be public, private, or both. An application Gateway can support one public IP address or one private IP address.</p>
<p>Listeners are used to check for incoming connection requests to the gateway. When you configure a listener, you can specify a protocol, a port, a hostname, and an IP address. If an incoming request matches what has been configured in the listener, the listener accepts the request. The gateway will then route the request to whatever backend members are configured in the rule.</p>
<p>Speaking of rules, request routing rules are used to determine how to route traffic on the listeners. The request routing rule is essentially the glue that binds the listener, the backend pool, and the backend HTTP settings. What the rule does is pretty simple. It takes a request that has been accepted by the listener and forwards that request to the backend. The request routing rule defines which backend server pool that requests should be sent to.</p>
<p>The HTTP settings include ports and protocols that are used to determine whether or not the traffic between the application Gateway and the backend servers is encrypted or not. HTTP settings also determine whether or not cookie-based session affinity should be used to keep a specific user session on the same server.</p>
<p>The backend pools that I have mentioned can consist of NICs, VM scale sets, public IP addresses, internal IP addresses, FQDNs, and multitenant backends like App Service. Backend pools are essentially that - pools of resources that the gateway can direct traffic to.</p>
<p>Lastly, the health probes are used to monitor the health of the resources contained within the backend pool. When an unhealthy resource is detected by the health probe, that resource is removed from service. The health probe will then continue monitoring the unhealthy resource. If it becomes healthy again, the resource is added back to the pool automatically.</p>
<p>To learn more about the azure application gateway components, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-components">URL</a> that you see on your screen.</p>
<p>Join me in the next lesson, where I’ll show you how to deploy an application gateway.</p>
<h1 id="DEMO-Deploying-an-Application-Gateway"><a href="#DEMO-Deploying-an-Application-Gateway" class="headerlink" title="DEMO: Deploying an Application Gateway"></a>DEMO: Deploying an Application Gateway</h1><p>Welcome back. In this lesson, we are going to walk through the process of creating an application gateway. Now, if you remember from the lesson previously an application gateway is essentially a load balancer that’s built for load balancing web traffic specifically. So that’s what we’re going to do here.</p>
<p>We have two VMs called VM1 and VM2. Both have IIS installed. What we’re going to do is deploy a gateway and load balance that web traffic to both of those VMs through the use of a backend. So to begin the process of deploying our application gateway, we’ll go ahead and select the hamburger and Create a Resource. And then we’ll search the marketplace for application gateway. We’ll go ahead and select it and we’ll begin the creation process.</p>
<p>Now, when we create the application gateway, we have, looks like six different tabs here that we need to configure information for. Some of them will require more information than others. This basics tab, as you would expect is where we configure some of the basic information for our application gateway, the name, the subscription it’s going to, the resource group some of that information here. So what we’re going to do for this application gateway is deploy into our lab subscription and then into the resource group called LBLab.</p>
<p>Now in this application gateway name box we need to give our gateway a name. So I’ll just call it MyAppGateway. And what we’ll do here is we’ll deploy into East US since that’s where my other resources are here. And then in this teardrop down we can select the standard Standard V2 or web application firewall web application, Firewall V2. If we hover over the icon here we can see that the V2 tier offers performance enhancements over that of the standard original tier.</p>
<p>Now, if we hover over the, go back here. If we hover over the Learn more link here and open it up, we can see the information about the different features of the application gateway V2. The enhancements include like auto scaling, zone redundancy, you can even do a static virtual IP, header rewrites, all of this cool stuff that the V2 offers over the standard. So I encourage you to take a look at, that this page here and take a look and see what the application gateway enhancements are for the V2 SKU.</p>
<p>So we’ll bounce back over here and we’ll leave this set to standard V2 it is default, and then we’ll keep auto scaling enabled. Now, this minimum scale units here, if we hover over the icon here, this little black box will tell us that the minimum scale units refers to additional reserve capacity which is always maintained regardless of what traffic is hitting the gateway.</p>
<p>Now by selecting zero here, what this does is signify a purely auto-scaling application gateway and it doesn’t have any additional reserve capacity while still maintaining that high availability. So we’ll leave this at zero and then the maximum scale units again, we go up to 10. We’ll leave the default there. If we select the drop down for availability zone, we can see, we can select an availability zone to provide high availability for our application gateway.</p>
<p>If we hover over the icon on here, we can see that some regions will support the ability to put this application gateway into zones for availability or availability zones. Since we’re in East US that is a region that supports availability zones. We’re not going to do anything with high availability here so we’ll leave this set to None. Hovering over HTTP2 shows us that the application gateway does support HTTP2 protocols for clients that are going to connect to application gateway listeners only. We’re not doing anything with HTTP2, so we’ll leave that off.</p>
<p>Now, the tricky thing here with an application gateway is the virtual network. If we hover over the icon here for virtual network, we can see that we need to provide a virtual network for our application gateway to connect to. Now that being the case, the next sentence here the second sentence in this box is critical. The virtual network that we use needs to have either an empty sub-net or a sub-net that only contains application gateways. If we don’t have one of those two, we have to create a new virtual network and sub-net for that specific gateway.</p>
<p>Now for this exercise, I’m going to select the LBLab vnet where my virtual machines are installed. Now, if I select this, the default sub-net automatically appears because that’s the only sub-net there. And it turns red here. And this is because it’s not an empty sub-net because I have VMs on it and it’s not a sub-net that contains just application gateways.</p>
<p>So what I need to do here is create an empty sub-net on that virtual network. And to do that, I select the manage sub-net configuration here. And this takes me out to the LBLab vnet virtual network, where I can create another sub-net here. So I’m just going to call this AGSubnet.</p>
<p>Now the address range for the subnet needs to fall under the umbrella of the address space for the virtual network. The address space for this virtual network is 10000&#x2F;16. The existing default sub-net as 10010&#x2F;24. So what I’ll do here is call this 10020&#x2F;24. We’re not doing anything with Nat gateways, nothing with sub-net delegation or anything. We just need a dumb sub-net here. So we’ll okay it and if we refresh this, we can see we now have the AGSubnet.</p>
<p>So we’ll go back to the Create application gateway here, and what we’ll do here is select the AGSubnet. At this point, we need to configure the frontends. So we’ll go ahead and click Frontends here. Now the frontend is where traffic will enter the gateway to access whatever web application you have running. You can have a public frontend type, a private or both. For this exercise, we’re going to have a Public Frontend IP address and I can either use the existing IP, which in this case I only have two defined and it’s one for each of my VMs. So what I’ll do here is I’ll create a new one and I’ll just call this AGPublicIP.</p>
<p>Now you can see the SKU and assignments are great out because I can’t change those. The SKU is going to match that of my gateway and then the assignments going to be static. So, okay at here. At this point we have our frontend configured and now we can move on to the backends. We can see here, we have no backend pool and this obviously the backend pool is the pool of resources that the application gateway is going to send traffic to.</p>
<p>If you look at the note here you can see a backend pool can contain virtual machines, VM scale sets, app services, IP addresses, or even FQDNs. For this exercise, we’re going to build that pool from two virtual machines. So we’ll go ahead and add the backend pool. And I’m just going to call this AGBackend. Now this option here for adding backend pool without targets, if we don’t have targets already defined, we could select Yes here, Create the pool and then come back and add our backend targets later. But since we already have our VMs created, we just leave this at No and then in the target type, we select the dropdown for Virtual machine. Now from Virtual machine next to it for target, we go ahead and select VM1 and VM2.</p>
<p>Now you’ll notice I’m not even selecting VMs here, I’m selecting the NIC for each of those VMs. And there you go we go to VMs, we’ll add them in and we have two targets. So we’ll go ahead and Next here to Configuration. Now on this configuration tab what we’re going to do is connect the front end to the backend, using a routing rule.</p>
<p>We can see under frontend, we have the new AGPublic IP and we can have our backend here defined as AGBackend. What we need to do here is add a routing rule. I’m just going to call this rule RoutingRule. Now the very first thing we have to do is define a listener.</p>
<p>Now that listener is a component that listens on the specific port and IP address for any kind of traffic. If that traffic matches the traffic that we specify here the application gateway applies the rule. So I’ll just call this MyListener. Now we have to tell the listener where it needs to listen.</p>
<p>So in this dropdown here, we select the Public Frontend IP because this is the frontend IP that we created for it and then we’re going to listen for HTTP traffic which is Port 80. Now, if we hover over Listener type here this is where we can define whether we’re using a single site behind the gateway or if we’re using multiple sites. We’re not using multiple sites, so we’ll leave this at Basic Listener type and we don’t have an error page URLs. So we’ll leave this set to No. And then what we wanna do is go to the Backend targets tab here.</p>
<p>Now, since we have a backend pool we’re going to specify the backend pool target type and then we’re going to select our AGBackend that we defined. Now, this HTTP settings option here. This is what defines the behavior of the rule. It’s where we’ll specify ports, protocols, backend settings, affinity, that kind of fun stuff. Now we don’t have an HTTP setting defined yet, so we’ll go ahead and click Add new. And for the name, we’ll just call it myHTTPSettings.</p>
<p>Now we’re not balancing HTTPS traffic, we’re doing HTTP. So we’ll leave HTTP set and the backend port at 80. Now Cookie-based affinity is a way to ensure that the application gateway forces a user session to a specific backend server or instance for the duration of the session. We’re not doing any kind of a Cookie based affinity here, so we’ll leave this disabled. And then for connection draining here what this does is allow you to more gracefully remove backend pool members during planned service updates.</p>
<p>I’m not worried about connection draining for this simple demonstration, so I’ll leave this disabled as well. Hovering over the Request time-out, what this is, this is the number of seconds that the application gateway will wait for a response from the backend pool before it comes back and says there’s a connection time out, or any kind of error message that it has to return to the end user. The default here is 20 seconds, so we’ll leave that there. That works for me. And then this override backend path, this allows you to override the path in the URL so any requests for a specific path can get rerouted to a different path. </p>
<p>So if we read what’s noted in this box, we can see that for example, if he wants to route requests for contoso.com&#x2F;images to the default path, we enter a forward slash here and then attach this HTTP setting to the rule associated with contoso.com&#x2F;images. We’re not doing any redirections or overrides here so we can leave this blank. And then under host name here, we can override with new host names. These are more advanced features we don’t need to do anything with overrides here.</p>
<p>So we’ll go ahead and click Add and we’ll go ahead and finish up here. So now we have the Frontend, the Routing rule, and the Backend configured. And then if we’re going to do any tagging, we can click Next for tags but we’re not gonna do any tagging here. And then we’ll Review and Create. And what Azure will do here is look at our configuration and validate it. Everything looks good. We get the green check mark. We can go ahead and Create the application gateway. We can see our deployment is now complete.</p>
<p>So we’ll bounce back to our Resource group here. Now to test our gateway, what we need to do is identify the public IP address for it. And to do that, you can see here, we’re in our LBLab Resource group. If we select the public IP that we created, we can see the IP address of it. So this is the public IP of our application gateway.</p>
<p>If we copy that and open up a new incognito window, we can paste and go. We can see that the gateway has defaulted at least on this load to VM2. If we refresh here a few times, we may be able to get it to hit VM1. Maybe we’ll try to open an incognito window, do it again and we still hit VM2. Now, the reason for this is because there’s really no load on these. So it’s just gonna pick whatever is working and it’s gonna go with it. </p>
<p>So what I can do to confirm that the gateway works, is I’ll bounce out of this and what I’ll do is I’ll go back into my LBLab Resource group here and what I’ll do is I’ll shut down VM2. Let’s Refresh. So let’s go ahead and open our incognito window and we can see we hit VM1. So the application gateway knows VM2 is no longer available, so it’s now sending traffic to VM1.</p>
<p>If we close this out, we can go back to our application gateway here and there you have it. That’s how you deploy an application gateway and how you load balance web traffic using the application gateway.</p>
<h1 id="An-Intro-to-Azure-Front-Door"><a href="#An-Intro-to-Azure-Front-Door" class="headerlink" title="An Intro to Azure Front Door"></a>An Intro to Azure Front Door</h1><p>Hello and welcome to Azure Front Door. In this lesson, we’ll take a look at what Azure Front Door is, and what it offers.</p>
<p>Azure Front Door is a service offering that is delivered from the edge of Microsoft’s global network. This service offers global load balancing for applications and even microservices. With Azure Front Door, you can fail over such apps and microservices across different regions or even different clouds. You can use it to define, manage, and monitor global routing for your web traffic. It also provides high availability.</p>
<p>Key features and benefits of Azure Front Door include improved application performance, increased availability, URL-based routing, session affinity, and much, much more.</p>
<p>Improved app performance is attained through the use of split TCP-based anycast protocol. What this does is ensure that users of an application connect to the nearest point of presence to them. This speeds access and reduces latency.</p>
<p>Increased availability is made possible with smart health probes. These smart health probes monitor the backend resources for latency and availability. When a backend resource goes down, the health probes facilitate a quick failover to remaining backend resources.</p>
<p>The URL-based routing that Front Door offers allows you to route traffic to backend pools based on the URL paths of the requests. For example, requests for a URL like <a target="_blank" rel="noopener" href="http://www.bluewidgetcorp.com/video">http://www.bluewidgetcorp.com/video</a> could be configured to go to resources hosting videos, while a URL like <a target="_blank" rel="noopener" href="http://www.bluewidgetcorp.com/images">http://www.bluewidgetcorp.com/images</a> could be configured to go to resources hosting images.</p>
<p>The cookie-based session affinity that Front Door offers can be used to ensure that a specific user session remains on the same backend for the duration of the session.</p>
<p>There are also many other features and benefits of Front Door, including things like TLS termination, custom domain support, URL redirection, and others.</p>
<p>For a complete list of Azure Front Door features and benefits, along with an explanation of each, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/frontdoor/front-door-overview">URL</a> that you see on your screen.</p>
<h1 id="DEMO-Creating-a-Front-Door"><a href="#DEMO-Creating-a-Front-Door" class="headerlink" title="DEMO: Creating a Front Door"></a>DEMO: Creating a Front Door</h1><p>Welcome back. In this demonstration, we’re going to walk through the process of configuring Azure Front Door so that it directs user traffic based on lowest latency between two web apps. Now, what I’ve done here to prepare for this demonstration is deploy two different web apps in my environment, within the LBLab, Resource group I created a web app called BlueWidget1. This application is hosted in Central US.</p>
<p>In the LBLab2 resource group that I’ve spun up, I created a web app called BlueWidget2. This application runs in East US. What we’re going to do is configure front door to front end both BlueWidget1 and BlueWidget2. So let me bounce back into LBLab which is my primary resource group here for some of my labs. And to create our front door, what we’re going to do is go to the hamburger and create a resource. And then from here, we can search for front door or we could browse it by going into Networking and then finding front door down here in the feature or if we See all, we could find it down in here.</p>
<p>So for this demonstration, we’ll search for front door, we’ll select it and we will deploy our Front Door. When we create a front door we need to tell Azure what subscription to deploy to and into what resource group. So we’ll go into LBLab for this. Now we can see the Resource group location is greyed out because we can’t change that.</p>
<p>Next, we’ll go into the configuration of the door and we can see here that this configuration happens in three steps. We create the Front end, we create the Backend, and then we create the Routing rules. So let’s go ahead and click the plus sign here to create a frontend. Now this frontend is going to be where traffic enters. This host name here is upended with this domain of Azure FD for front door. It’s Azurefd.net. So the name I give it needs to be globally unique across the entire landscape. So I’m going to call this bluewidgetFD.</p>
<p>So, for our host name, we’ll call it bluewidgetFD which stands for bluewidget front door. So the complete host name will be bluewidgetFD.azure.net. Now for this demonstration we’re not going to configure session affinity. Now that session affinity would allow us to direct traffic from a specific user session to the same application backend for the duration of the session. I’m not worried about affinity right now, so we’ll leave that alone nor am I going to configure web application firewall this time.</p>
<p>So at this point, we can click Add. At this point we have our front end configured for our front door. Now we need to tell Azure what the backend is going to be where are we going to send our traffic to. So we’ll go ahead and plus it up here and we’ll just call this MyBackend. Actually we’ll call it MyBackendPool.</p>
<p>We’ll go ahead and add a backend and the backend host type allows us to define what that backend is. In our case here, it’s an app service. So we’ll select App service. We can see it fills in the backend host name, the backend host header. All of this HTTP information is automatically filled in. We’ll go ahead and add this backend and then we’ll add the second backend bluewidget2 and we add.</p>
<p>These health probes here allow the front door to check the status of our backends. These can be left at their defaults. And then the load balancing settings down here are used as it says here to define what sample set we need to call the backend as healthy or unhealthy. We’ll go ahead and add. And now we have our front end and our backend defined.</p>
<p>At this point, we need to add a routing rule. Now this routing rule is going to map the front end host to a backend pool. So let’s go ahead and create a routing rule here and we’ll just call this MyRule. Now for this demonstration we can accept the default settings here because the accepted protocol is HTTP and HTTPS which is what we’re going to send to our backend. And we can see the front end is already free filled with the front end that we defined earlier.</p>
<p>The pattern to match is the default URL path and then the route details here tell front door what to do. For example, with the forward setting, if we hover over this, we tell the front door to forward traffic to the backend rather than redirect it. We can see the backend pool is configured. If we hover over URL rewrite, we can take a look here and see that by enabling this, we can configure a path to use when constructing this request for the URL and use a rewrite to forward that to the backend. And the same thing with caching here. We can enable caching for this particular routing rule.</p>
<p>Now for this demonstration, we’re not going to do any rewriting or caching so we can go ahead and add our rule. At this point, we have our front end configured, our backend and our routing rule. So we’ll go ahead and create our front door here, we get the validation and then we can create.</p>
<p>Now once this deployment completes, we’ll go in and I’ll let you see what happens with Azure front door here by viewing it in action here. Now what Azure front door is going to do for us is perform pretty much an instant global fail over. Remember one of our apps is in the East region and the other one is in Central.</p>
<p>So let’s go ahead and open up an incognito window and browse to our front door. And now the bluewidgetfd.azurefd.net is directing to our app service. And what front door will do is keep track of which application is running and if one of them goes down, front door will ensure that traffic instead of being sent to the down instance is sent to the instance that remains up. And that’s pretty much it. I mean, setting up the front door service, isn’t terribly complicated, you simply set up a frontend, a backend and your rule to route that traffic. That traffic is then directed to each of your backends that you’ve configured behind that front door service.</p>
<h1 id="What-is-Web-Application-Firewall"><a href="#What-is-Web-Application-Firewall" class="headerlink" title="What is Web Application Firewall?"></a>What is Web Application Firewall?</h1><p>Welcome to web application firewall! In this lesson, I’m going to introduce you to the Azure web application firewall and what it offers.</p>
<p>Also known as WAF, the web application firewall in Azure offers a way to protect web applications from common vulnerabilities and exploits, like SQL injection attacks and cross-site scripting attacks.</p>
<p>While such attacks CAN be prevented within application coding, doing so is tedious and requires ongoing maintenance. The centralized protection that web application firewall offers vastly simplifies such protection – and it can often allow you to respond to threats far more quickly by patching known vulnerabilities instead of needing to secure every individual web application behind it.</p>
<p>The image on your screen depicts what a typical WAF solution looks like.</p>
<p>You can deploy web application firewall in conjunction with several different Azure services. It can be deployed with Azure Application Gateway, Azure Front Door, and with the Azure Content Delivery Network. The features of web application firewall can be customized for each service.</p>
<p>When used with Application Gateway, web application firewall offers protection for web applications against web vulnerabilities and attacks without any need for changes to the application code itself. You can even protect multiple applications simultaneously. As a matter of fact, you can host and protect up to 40 websites with web application firewall on a single instance of Application Gateway. The ability to create custom WAF policies allows you to use different policies for different sites.</p>
<p>The image on your screen depicts a typical WAF deployment with Application Gateway.</p>
<p>Just as it does when used with Application Gateway, web application firewall provides centralized protection against web threats when use with Azure Front Door. This type of global solution is deployed on edge locations on the Azure network around the world. Every incoming request to the Front Door is inspected at the edge of the network. This means attacks are prevented by WAF before they even enter your virtual network.</p>
<p>The image on your screen depicts a typical web application firewall deployment with Front Door.</p>
<p>When used with the Azure Content Delivery Network, the web application firewall can be used to protect web content itself. A global and centralized solution, WAF with the Azure CDN mitigates malicious attacks closer to their sources, rather than after they reach your network.</p>
<p>The image on your screen depicts a typical WAF deployment with Azure CDN.</p>
<p>So, to recap, web application firewall is designed to protect against various web threats, and it can be used with Application Gateway, Azure Front Door, and with the Azure Content Delivery Network. </p>
<p>For more technical details on Web Application Firewall, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/web-application-firewall/">URL</a> that you see on your screen.</p>
<h1 id="DEMO-Enabling-Web-Application-Firewall-on-Application-Gateway"><a href="#DEMO-Enabling-Web-Application-Firewall-on-Application-Gateway" class="headerlink" title="DEMO: Enabling Web Application Firewall on Application Gateway"></a>DEMO: Enabling Web Application Firewall on Application Gateway</h1><p>Hello and welcome back. In this demonstration, what we’re going to do is enable Web Application Firewall with app Gateway. Now on the screen here, you can see I’m logged into my Azure portal and I’m looking at my Application Gateway, which is aptly called MyAppGateway. There are two servers on the backend of this. They’re two virtual machines. It’s called VM1 and VM2 and both are running IIS.</p>
<p>So our app Gateway is already set up as is the backend. So all we need to do here is enable Web Application Firewall. Now to do that, the first thing I need to do is create a storage account to store data for detection and prevention purposes. Now we could also use Azure monitor logs or Event Hub but for this demonstration, we’ll just create a storage account.</p>
<p>So we’ll go ahead and click the hamburger, create the resource and we’ll select Storage Account from the popular list here. We’ll deploy this in the LB Lab Resource Group and we’ll just call this something like BW Diag Storage. There we go. Remember that storage account name needs to be unique. So we got a unique name here. We’ll leave this in East U.S. and the performance can remain standard here for diagnostics and we’ll leave it at the default storage V2 which is the recommended storage account kind that Microsoft recommends. And we can leave the default replication which is not really critical here.</p>
<p>The same thing goes for access here. We’re not really using cool data. We’ll use this hot. And then what we’ll do is we’ll review and create here. Now once we have this storage account created, what we’ll do is configure the diagnostics to record data into our Application Gateway Access Log, the Application Gateway Performance log and the Application Gateway Firewall Log.</p>
<p>So let’s go back out and we’ll go into my app Gateway here. Now what we do here is go down under monitoring here and we select the Diagnostic Settings option. We can see here, we don’t have any diagnostics configured for our app Gateway. So what we’ll do here is we’ll add one and we’re just going to call this MyDiags. And then what we’re going to do is archive to a storage account here and we’ll keep our logs here. We’re not going to worry about metrics at this point. We’ll just leave the logs here collected.</p>
<p>Now obviously in these boxes, we can configure the retention for each of these. Now leaving this at zero means we’re not setting any retention policy and what this will do is retain our data forever. So now that we’re archiving to a storage account, we need to make sure that we select our storage account to archive to. We only have the one storage account here so it’s been selected by default.</p>
<p>At this point, we can save our diagnostic setting. Let’s go back out to our resource group here and now the next step in the process is to create what’s called a WAF policy or a Web Application Firewall policy. We need to create that policy and then associate it with our Application Gateway. What we’ll do here for this demonstration is create a basic policy with a managed default rule set. Basically, it’s just a basic vanilla policy. </p>
<p>Now to do this, we’ll go up into the hamburger, create a resource, and then we’ll search for WAF. And we can see Web Application Firewall appears. And then we’ll go ahead and begin the creation process of the Web Application Firewall policy. On this screen here, we’re going to configure some basics.</p>
<p>For the policy here, We need to indicate what resource type we’re trying to protect. We select the dropdown here. We have Azure CDN Application Gateway or front door. We’re going to protect Application Gateway and we’ll put this in the LB Lab Resource Group. Now for instance details, we need to specify the location, the policy state and we need to give the policy a name. This policy name must be unique.</p>
<p>So we’ll just call it MyBWPolicy. It’s my blue widget policy. Now since this is a vanilla policy, we don’t have to do anything crazy at this point. You can go ahead and click through to next. Under policy settings, here we can leave the defaults. If we hover over mode here, we can see that detection mode will monitor and log all threat alerts to a log file.</p>
<p>Prevention mode will take some corresponding action if that request matches a rule. We’re gonna leave this in its default configuration here. We’ll leave our rules in place. It’s already pre-configured with a specific rule set and we can see what those rules are. So we’ll leave the default rules in place. We’re not going to do any custom rules but what we do want to do is go into association here and associate our WAF policy with an Application Gateway.</p>
<p>So what we’ll do here is we’ll associate our Application Gateway and if we do a dropdown, we can see we don’t have any gateways to associate. Now I know for a fact we have the Application Gateway already created. But if you notice here, it needs to be a WAF V2 SKU for the gateway.</p>
<p>So what we’re going to do is open up another tab here and we’ll go into my app Gateway. If we look at the configuration for our Gateway, we can see that the tier is standard V2. It’s not this WAF V2. So what I need to do here is change the tier and save that. So that gateway needs to be a WAF V2 tier in order to work with the Application Gateway WAF policy. So we’ll cancel this. So let’s go back in here and we’ll go ahead and associate our Application Gateway and we’ll go ahead and save it. And we can see that our deployment has succeeded.</p>
<p>So now that our policy has been associated with our Application Gateway, we can test the Application Gateway. What we’ll do here we’ll go out to our Gateway. We’ll copy the IP and we can see that we’re now hitting the Gateway and it’s still up and running where I hit VM1 which is one of the backend VMs of the Gateway.</p>
<p>If we close this out, go back out to our LB Lab and then we can take a look at our policy. We can see the status is enabled. We can take a look at the activity log and we now have a Web Application Firewall policy associated with our Application Gateway.</p>
<h1 id="An-Intro-to-Traffic-Manager"><a href="#An-Intro-to-Traffic-Manager" class="headerlink" title="An Intro to Traffic Manager"></a>An Intro to Traffic Manager</h1><p>Welcome to Traffic Manager! In this lesson, we’ll touch on yet another load balancing feature, called Traffic Manager. We’ll look at what it is and what it does.</p>
<p>Azure Traffic Manager is a load balancer that works by distributing traffic using DNS. It’s a bit different from the Azure load balancer offerings that we discussed earlier. You typically use Traffic Manager to distribute traffic to services that are located across different global Azure regions. When you use Traffic Manager, you can ensure that your European users can access your application from and endpoint closest to them, while your North American users can access the same app from a service endpoint closest to them. This provides higher availability of your app and makes it more responsive to end user requests.</p>
<p>The way it works is pretty straightforward. What Traffic Manager will do is use DNS to send access requests to the service endpoint with the least latency for the requester, based on the configured traffic routing method and on the health of the endpoints that have been configured. The configured endpoints can be any Internet-facing service that’s hosted inside or outside of Azure. Its flexibility protects applications against failures, including the failure of an entire Azure region.</p>
<p>Because it works at the DNS level, Traffic Manager will use DNS to route incoming connections to the necessary endpoint, based on how the rules are configured and on the traffic routing method. Speaking of routing methods, there are several available when using Traffic Manager.</p>
<p>You have Priority, Weighted, Performance, Geographic, Multivalue, and Subnet.</p>
<p>If you want to send all incoming traffic to a primary service endpoint, while making backup endpoints available in the event the primary endpoint is not available, you would choose the Priority method.</p>
<p>The Weighted routing method can be used in situations where you need to split traffic out across multiple endpoints, based on weighting that you define. Weighted routing can also be used to evenly split traffic across multiple endpoints.</p>
<p>The Performance routing method is often used with applications that are distributed across multiple geographic locations. Choosing the Performance routing method allows you to direct users to the closest endpoint to them, when they access your application. This reduces latency for those users.</p>
<p>Geographic routing also allows you to force users to an endpoint closest to them, but it works a little differently than Performance routing. Geographic routing is performed based on the geographic location of the original DNS query. You would typically use Geographic routing to ensure a user in Europe access your application from a European endpoint. This is a useful option when you need to comply with sovereignty mandates.</p>
<p>The Multivalue option should be used for Traffic Manager profiles that can only have IPv4 or IPV6 addresses as endpoints.</p>
<p>And lastly, the Subnet routing method allows you to map specific ranges of end-user IP addresses to specific endpoints. This means you can force specific users, based on their IP addresses, to connect to certain endpoints.</p>
<p>Now, I should point out here, because its not always evident when I talk about it, that Traffic Manager is NOT a proxy or gateway. Despite all these routing methods that are available, what Traffic Manager actually does is play traffic cop. No traffic ever passes through Traffic Manager. Instead, Traffic Manager directs clients to the endpoints. The clients then make connections directly to those endpoints. Keep that in mind.</p>
<p>The picture on your screen shows how a client typically connects to an endpoint, using Traffic Manager.</p>
<p>Notice what happens here. (1) The process starts off with a DNS query for the app called app.bluewidgetco.com from the client to the client’s DNS service.</p>
<p>Next, (2) the DNS service reaches out to the name servers for the domain hosting the application, and those name servers return the CNAME record that points to the Traffic Manager implementation for the app. In this case, the CNAME record is called bluewidgetco.trafficmanager.net. The root domain will always be trafficmanager.net for Traffic Manager implementations.</p>
<p>At this point (3) the client’s DNS service finds the name servers for the trafficmanager.net domain. These servers are provided by the Traffic Manager service itself. After finding the name servers for the trafficmanager.net domain, the client’s DNS service sends a request for bluewidgetco.trafficmanager.net.</p>
<p>Once the Traffic Manager (4) name servers receive the request, they determine the correct endpoint, based on the state of the configured endpoints, the health of the endpoints, and the routing method that has been configured.</p>
<p>Traffic Manager (5) then returns the CNAME record of the proper endpoint to the client’s DNS service. In this example, there are two deployments of the app. The app is deployed at bluewidget-us.cloudapp.net and at bluewidget-eu.cloudapp.net. Let’s assume the users is US-based and should hit the US-based deployment of bluewidget-us.cloudapp.net. In this scenario, the endpoint of bluewidget-us.cloudapp.net is returned to the client’s DNS service.</p>
<p>Once it receives the endpoint DNS name, (6) the client’s DNS service finds the DNS name servers for the cloudapp.net domain and requests the DNS record for bluewidget-us.cloudapp.net. The cloudapp.net name servers respond to the client’s DNS service with the IP address of the US-based endpoint.</p>
<p>The (7) client’s DNS service sends this information back to the client requesting access.</p>
<p>Once the client receives the DNS information and IP address for the US-based deployment, the (8) client connects directly to that deployment.</p>
<p>So, as you can see here, Traffic Manager is heavily dependent on DNS. After all, like I mentioned at the outset, it’s a DNS-specific load balancing solution.</p>
<p>Join me in the next lesson, where I’ll show you how to create a Traffic Manager profile.</p>
<h1 id="DEMO-Creating-a-Traffic-Manager-Profile"><a href="#DEMO-Creating-a-Traffic-Manager-Profile" class="headerlink" title="DEMO: Creating a Traffic Manager Profile"></a>DEMO: Creating a Traffic Manager Profile</h1><p>Welcome back. What we’re going to do in this demonstration here is deploy a Traffic Manager profile. The process is going to be pretty straightforward. We’re going to deploy the profile, and then we’re going to add two backend endpoints to that profile. The endpoints will be two web apps that I’ve deployed in Microsoft Azure.</p>
<p>On the screen here, you can see I’m logged in to my Azure portal, as my admin. And I’m sitting in the LB Lab resource group. We have two web apps deployed here, Blue Widget 1 and Blue Widget 2 is going to live in the other research group of LB Lab 2. So these will be the end points.</p>
<p>So let’s bounce back to LB Lab. Now to begin the process, we’ll go into the hamburger here and we’ll create a resource. And what we’ll do here is we’ll search for Traffic Manager. And you can see here Traffic Manager profile shows up in the list, so we’ll go ahead and begin the process here.</p>
<p>Now when we create our Traffic Manager profile, we need to give it a unique name across the Azure landscape. We need to specify the routing method that we talked about earlier, the subscription, and the resource group we want to deploy it into. When we create our profile, the name we use here is going to append the trafficmanager.net domain name. So that’s why this needs to be unique.</p>
<p>So what we’ll do here is we’ll try to call this MyBWApp. So mybwapp.trafficmanager.net will be the URL that we use to hit the web applications that are sitting behind the Traffic Manager profile. In the drop-down here for routing method, we have the different routing methods we talked about. Performance, weighted, priority, the geographic multi-value and subnet. We’ll leave this set to performance, we’ll deploy into the lab subscription, and we will deploy into LB Lab.</p>
<p>Now you’ll notice the resource group location grays out based on the resource group that we select. So we’ll go ahead and create the profile. We can see our deployment has succeeded, so we’ll go to our resource here. And we now have My BW App Traffic Manager profile.</p>
<p>Now at this point, what we’re going to do is create the endpoints. We’ll create a primary endpoint that points to our app 1, and then a secondary that points to app 2. So we’ll go ahead, to do this under Settings here we select Endpoints, and we can see we have no endpoints currently created, so we’ll go ahead and add the first one. And you can see here there’s not too much information we need to provide.</p>
<p>In the Type drop-down here, we need to tell Azure what kind of endpoint we’re going to add, whether it’s an Azure endpoint, an external endpoint, or a nested endpoint. Since our endpoints are going to be a web app, we’ll select Azure Endpoint. And then we need to give our endpoint a name here, so I’ll just call it Endpoint 1.</p>
<p>Now in the target resource type, you can see we have a couple of different options here. Cloud service, app service, App Service Slot, and Public IP. Since we are using App Service as our endpoints, it stands to reason that we deploy App Service as our target resource type. And then once we do that, the Target Resource dropdown allows us to select our app service. We can see we have one in the central US and one in east US. So we’ll select the blue widget 1 for a primary endpoint here.</p>
<p>Now, if we hover over custom header settings here, what this does is allow us to configure custom headers for the app. We don’t need any custom headers for our applications here, so we’ll leave this box alone. Now we could add our endpoint in a disabled state by checking the Disabled box, but we’ll add this in in an active state. And to do that, we simply click the Add button.</p>
<p>To add the second endpoint, we just repeat the process. We go ahead and add. We’ll select the Azure endpoint, We’ll call this Endpoint 2. We’ll select the app service, and then we’ll choose Blue Widget 2 this time. Now to test our Traffic Manager, if we bounce out to Overview here, we can copy the URL, which is the DNS name for our Traffic Manager. And to get to our Traffic Manager, we’re going to hit <a target="_blank" rel="noopener" href="http://mybwapp.trafficmanager.net/">http://mybwapp.trafficmanager.net</a>.</p>
<p>Let’s open up an Incognito window here, and there you go. So Traffic Manager is now going to send me to the closest iteration of our web app. In my case here, I have an east US deployment and a central US deployment. Me personally, I’m located in the eastern part of the United States.</p>
<p>So what Traffic Manager will do is look at where the request for the application is coming from and send me to the closest iteration of that web app based on the DNS request. And that’s pretty much it. That is how you deploy and configure a Traffic Manager profile.</p>
<h1 id="Course-Conclusion"><a href="#Course-Conclusion" class="headerlink" title="Course Conclusion"></a>Course Conclusion</h1><p>Congratulations! You’ve come to the end of Load Balancing with Azure. Let’s review what you’ve learned.</p>
<p>We started things off with load balancers, where you were introduced to the different types of load balancers, their components, and their use cases. You even got to see a demonstration that showed you how to deploy a load balancer using the Azure portal.</p>
<p>After covering load balancers, we dove into Application Gateway. You learned what it is, what its features are, and what components comprise it.</p>
<p>We then worked through the deployment of an Application Gateway.</p>
<p>Next, we took a look at Azure Front Door, where you learned what the Azure Front Door service is and how to create a front door instance.</p>
<p>We then dove into Web Application Firewall. You learned what it is and when to use it. You also learned about using it with Application Gateway, Azure Front Door, and with Azure CDN. We wrapped up the section with a deployment of Web Application Firewall on Application Gateway.</p>
<p>After covering Web Application Firewall, we wrapped up with Traffic Manager, which is essentially a DNS-type load balancer. You learned what Traffic Manager is, how it works, and when to use it. You also got to see a demonstration of how to create a Traffic Manager profile.</p>
<p>At this point, you should have a good understanding of how to load balance with Microsoft Azure.</p>
<p>To learn more about load balancing with Azure, you can, and should, read Microsoft’s published documentation. You should also keep an eye out for new courses on Cloud Academy because we’re always publishing new ones. </p>
<p>Be sure to give this course a rating, and if you have any questions or comments, please let us know.</p>
<h1 id="5Application-Gateway-Intro"><a href="#5Application-Gateway-Intro" class="headerlink" title="5Application Gateway Intro"></a>5<strong>Application Gateway Intro</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/features">List of Gateway Features</a></p>
<h1 id="6Application-Gateway-Components"><a href="#6Application-Gateway-Components" class="headerlink" title="6Application Gateway Components"></a>6<strong>Application Gateway Components</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-components">Azure Application Gateway Components</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-Peering-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-Peering-5/" class="post-title-link" itemprop="url">AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-Peering-5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:38" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:38-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:17:16" itemprop="dateModified" datetime="2022-11-22T21:17:16-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-Peering-5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-Peering-5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Lab-Create-Your-First-Azure-Virtual-Network-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Lab-Create-Your-First-Azure-Virtual-Network-4/" class="post-title-link" itemprop="url">AZ-700-Lab-Create-Your-First-Azure-Virtual-Network-4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:36" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:36-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:30:36" itemprop="dateModified" datetime="2022-11-22T21:30:36-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Lab-Create-Your-First-Azure-Virtual-Network-4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Lab-Create-Your-First-Azure-Virtual-Network-4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Getting-Started-with-Azure-Virtual-Networks-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Getting-Started-with-Azure-Virtual-Networks-3/" class="post-title-link" itemprop="url">AZ-700-Getting-Started-with-Azure-Virtual-Networks-3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:35" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:35-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:50:24" itemprop="dateModified" datetime="2022-11-22T21:50:24-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Getting-Started-with-Azure-Virtual-Networks-3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Getting-Started-with-Azure-Virtual-Networks-3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hi there, and welcome to Getting Started with Azure Virtual Networks. My name is Thomas Mitchell and I’ll be taking you through this course.</p>
<p>I’m an Azure instructor at cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions about this course, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for those who wish to learn about Azure virtual networks, how to create them, and how to connect them.</p>
<p>We’re going to start things off with a vNet overview. You’ll learn about basic Azure virtual network concepts and about some key best practices. We’ll cover communications topics, filtering, routing, and integration, before working through a demo that shows you how to deploy a virtual network in Microsoft Azure.</p>
<p>After covering the basics of azure virtual networks in the first half of this course, we’ll use the second half to dive into VPNs, where you’ll learn about site-to-site VPNs, point-to-site VPNs, ExpressRoute, and vNet peering. You’ll even get to see a demo that shows you how to peer two vNets in Azure. </p>
<p>After finishing this course, you’ll come away with a foundational understanding of what Azure virtual networks are, how to deploy them, and how to connect them.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished. If you’re ready to learn about Azure virtual networks, let’s get started!</p>
<h1 id="Concepts-and-Best-Practices"><a href="#Concepts-and-Best-Practices" class="headerlink" title="Concepts and Best Practices"></a>Concepts and Best Practices</h1><p>Hello and welcome to concepts and best practices. In this lesson, we are going to take a look at some key vNet concepts and best practices that you should follow when deploying vNets.</p>
<p>Azure virtual networks are the foundation upon which many or most other Azure resources are built. They allow resources like virtual machines to securely communicate with each other, with resources deployed to on-prem networks, and with the Internet. While a virtual network in Azure is quite similar to a physical network that you would see in on-prem data center, the virtual network offers additional benefits, including improved availability, scalability, and isolation.</p>
<p>There are four key terms or concepts that you must be familiar with before deploying an Azure virtual network. They include the address space, subnets, regions, and subscriptions.</p>
<p>Whenever you deploy a virtual network in Azure, you’ll be prompted to define an address space. The address space that you define must consist of public or private addresses that conform to RFC 1918. When you deploy resources and attach them to a virtual network in Azure, the private IP addresses that are assigned to them are pulled from the address space that you define. For example, if you were to provision a virtual network with an address space of 192.168.0.0&#x2F;16, any resources that are connected to that virtual network would be assigned addresses from that range. Those devices would get addresses like 192.168.0.4, 192.168.0.5, and so on and so forth.</p>
<p>Just as they do in a physical network, subnets allow you to segment a specific virtual network into one or more different subnetworks, hence the name subnets. When you do this, what you are really doing is carving out a portion of the virtual network’s address space and assigning it to each subnet that you create. Azure resources can then be deployed to each subnet as necessary. Segmenting a virtual network address space into different subnets allows you to more efficiently leverage your addressing in a way that matches your organization’s requirements. Subnets also allow you to better secure resources through the use of network security groups.</p>
<p>When you deploy a virtual network in Microsoft Azure, it is scoped to a single region or location. That being said, if you need to enable connectivity across different regions, you can connect multiple virtual networks from multiple different regions through virtual network peering, which we will talk about in more detail later on.</p>
<p>In addition to being scoped to a single region or location, each virtual network that you deploy is scoped to a specific subscription.</p>
<p>there are several best practices that you should keep in mind as you build out your virtual networks in Microsoft Azure.</p>
<p>First and foremost, when deploying a virtual network, you need to ensure that the address space that you define for that virtual network does not overlap with any other network ranges that your organization uses. A real-world example of this best practice would be a situation where you plan to deploy a virtual network that will be connected to your physical on-prem network over a site to site VPN. If your on-prem network consists of a 192.168.0.0&#x2F;16 address space or subnet, you wouldn’t want your Azure virtual network to overlap that specific address space or subnet because such an overlap could cause routing issues.</p>
<p>Speaking of subnets, you should never create a subnet that encompasses the entire address space of the virtual network. In other words, if you deploy a virtual network with an address space of 192.168.0.0&#x2F;16, you really should not be creating a subnet for that virtual network with an address range of 192.168.0.0&#x2F;16. Instead, you should be planning ahead and leaving some of the address space available for future use. This means any subnets that are defined on that virtual network should only use a portion of the complete virtual network address space.</p>
<p>It’s also recommended that instead of defining numerous smaller virtual networks, you should define fewer larger virtual networks. By leveraging fewer large virtual networks rather than a bunch of little virtual networks, you can prevent or minimize management overhead.</p>
<p>And last but not least, you should be securing all virtual networks that you create with network security groups. By assigning network security groups to the subnets that have been defined for a virtual network, you can retain control over what traffic passes between those subnets.</p>
<p>For those who may not be familiar with network security groups, a network security group is an Azure resource that you use to filter network traffic to and from Azure resources that are attached to a virtual network. When you create a network security group, that security group contains security rules that you can define. These security rules are used to allow and deny inbound and outbound network traffic to and from your subnets and the resources that are attached to them.</p>
<p>For more information on network security groups, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">https://docs.microsoft.com/en-us/azure/virtual-network/security-overview</a></p>
<h1 id="Communications"><a href="#Communications" class="headerlink" title="Communications"></a>Communications</h1><p>Welcome to Communications! In this lesson, we are going to take a look at the different ways that Azure virtual networks facilitate communication.</p>
<p>The purpose of virtual networks in Azure is to allow Azure resources to securely communicate with one another, with the internet, and with on-prem networks.</p>
<p>By default, all resources that are connected to a virtual network can communicate outbound to the internet. To enable inbound communication from the internet to an Azure resource, you can either assign a public IP address to that resource OR you can by provisioning a public load balancer.</p>
<p>Communication between Azure resources can be achieved in a few different ways. For example, virtual machines and other types of Azure resources like Scale sets and App Service Environments can be deployed to a virtual network, which, in turn, allows for secure communications among those resources. </p>
<p>Virtual network service endpoints can also be used to facilitate communications. What a virtual network service endpoint does is allow you to extend a virtual network’s private address space and identity to certain Azure resources, like Azure Storage accounts and Azure SQL databases, over a direct connection. Service endpoints allow you to secure such Azure resources to only a virtual network.</p>
<p>vNet peering is another way that you can facilitate communication between Azure resources. When you peer a virtual network with another virtual network, what you are doing is connecting the two virtual networks together. When you do this, you allow azure resources on one virtual network to talk to the other virtual network that you are peered with.</p>
<p>When you need to connect your Azure virtual network to an on-prem network, you can use a point-to-site VPN, a site-to-site VPN, or ExpressRoute.</p>
<p>A point-to-site VPN allows you to establish a connection between a single computer in your on-prem network and your virtual network. When you use point-to-site connections to facilitate communication, you need to setup a separate point-to-site connection for each on-prem computer that needs to connect to the Azure virtual network. These types of connections are often used to allow remote workers to connect into your Azure virtual network so they can access Azure resources. This type of connection allows communication between the individual computer and your virtual network through an encrypted tunnel over the internet.</p>
<p>When you want to connect an entire on-prem network to an Azure virtual network, you can use a site-to-site VPN. This type of VPN establishes a secure, encrypted connection over the internet between an Azure VPN Gateway that’s deployed in the virtual network and the on-prem VPN device. </p>
<p>If a more robust connection is needed between Azure and your on-prem network, you can deploy an Azure ExpressRoute connection. An Azure ExpressRoute connection is a private connection between your on-prem network and your Azure environment. The traffic does not flow over the internet. This type of connection is established through an ExpressRoute partner.</p>
<p>So, before we dive into the next lesson, let’s just recap. </p>
<p>Virtual networks are used to facilitate communication with the internet, communication between Azure resources, and communication with an on-prem environment. Outbound communication to the internet is available by default, while inbound communications from the internet are achieved via a public load balancer or public IP address.</p>
<p>Communications between azure resources is achieved through a virtual network, a virtual network service endpoint, or through vNet peering.</p>
<p>To establish communications between an Azure environment and an on-prem environment, you can deploy a point-to-site VPN, and site-to-site VPN, or an Azure ExpressRoute connection.</p>
<p>Join me in the next lesson, where we will look at filtering, routing, and integration.</p>
<h1 id="Filtering-Routing-and-Integration"><a href="#Filtering-Routing-and-Integration" class="headerlink" title="Filtering, Routing, and Integration"></a>Filtering, Routing, and Integration</h1><p>Hello and welcome to Filtering, Routing, and Integration. In this lesson, we’ll take a look at ways you can filter network traffic in Azure and at ways you can route network traffic in Azure. We will also touch on ways you can integrate Azure services in a virtual network.</p>
<p>In a production environment, you’ll often find that you need to filter traffic between subnets. You’ll need to allow certain traffic while blocking other traffic. There are two key ways to accomplish this type of filtering. You can use security groups, or you can use network virtual appliances.</p>
<p>Security groups fall into two types: network security groups and application security groups. A network security group, when you create it in Azure, can be assigned to a specific NIC or to an entire subnet. Any rules that are defined within the network security group are then applied to that NIC or to all NICs and virtual machines on the subnet when the security group is applied to the entire subnet. This works for many, even most scenarios. However, if you need more flexibility, you can leverage an application security group.</p>
<p>When you deploy an application security group, you can logically group the NICs of several different virtual machines on the same virtual network and then apply a network security group rule to only those grouped NICs. This allows you to create different traffic rules for different groups of NICs on the same network without needing to assign the different rules on a one-off basis. You could essentially have a group of SQL VMs connected to the same vNet as your group of application VMs. Using a separate application security group for each group of VMs allows you to manage the network security rules for each different group of VMs – even though they all reside on the same network.</p>
<p>While security groups provide a great way to filter network traffic, you can also use network virtual appliances. A network virtual appliance (or NVA) is really just a virtual machine that is used to perform a specific network task. For example, you can deploy an NVA that acts as a firewall or one that provides WAN optimization.</p>
<p>Some available NVAs include the “Barracuda CloudGen WAF for Azure” and the “Citrix SD-WAN Center”.</p>
<p>While Azure automatically handles routing of network traffic between subnets, vNets, on-prem networks, and the internet by default, if you need to create your own routes, you can leverage route tables and BGP routes.</p>
<p>Route tables are custom tables that allow you to define custom routes that control how traffic is routed for each of your subnets. BGP routes, or border gateway protocol routes, are typically used when you connect an Azure virtual network to an on-prem network via an ExpressRoute connection or via an Azure VPN Gateway. In these scenarios, you use BGP routes to propagate your existing on-prem BGP routes to your virtual networks in Azure.</p>
<p>The details of how BGP works are out of scope for this getting started course but if you want to learn more about BGP, you can visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json</a></p>
<p>Before we wrap this lesson up, let’s talk a little bit about virtual network integration. When you integrate an Azure service to an Azure virtual network, what you are really doing is enabling private access to whatever service you are integrating from VMs or other compute resources that reside on the virtual network.</p>
<p>You can create these integrations in a few different ways. For example, you can deploy a dedicated HDInsight instance and directly transfer data between it and SQL server that’s running on a VM on the virtual network, via a private IP address.</p>
<p>For more technical details on this option, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services</a></p>
<p>Another way to achieve vNet integration is to use private links. A private link can be used to privately access a specific service instance from your virtual network or from your on-prem network.</p>
<p>To learn more about Private Link, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/private-link/private-link-overview">https://docs.microsoft.com/en-us/azure/private-link/private-link-overview</a></p>
<p>Lastly, you can use service endpoints to extend a virtual network to a specific Azure service. When you configure service endpoints to access an Azure service, you can secure that service to the virtual network. In other words, you can use service endpoints to create secure and direct connectivity to Azure resources over an optimized route across the Azure backbone network.</p>
<p>To learn more about service endpoints, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</a></p>
<h1 id="DEMO-Provisioning-a-Virtual-Network"><a href="#DEMO-Provisioning-a-Virtual-Network" class="headerlink" title="DEMO: Provisioning a Virtual Network"></a>DEMO: Provisioning a Virtual Network</h1><p>Hello, and welcome back. What we’re going to do here in this brief demonstration is work through the process of creating a basic vanilla virtual network in the Microsoft Azure portal. On the screen here, you can see I’m actually showing my vNetDemos Resource Group here, which is where I’m going to deploy my virtual network. I currently have nothing deployed in this resource group.</p>
<p>So, this virtual network that we deploy is going to be the first resource that we put in here. To create my virtual network, what I’m going to do is click the hamburger up here in the left-hand corner. And then I’m going to click Create a resource here.</p>
<p>Now from the Marketplace here, I have two options. I can either browse to the virtual network from the Networking category under Azure Marketplace. Or what I can do is search for virtual network. So what we’ll do is we’ll create our virtual network, and then you’ll see here, we have a couple of different tabs we can work through. We have a Basics tab, an IP Addresses tab, a Security tab, Tags, and then Review and create.</p>
<p>In this Basics tab here, we need to provide some basic information about the virtual network we’re going to deploy. We need to tell Azure what subscription we want to deploy to, which resource group will host our new virtual network, and then information about the virtual network itself, which includes the name of the network and the region we want to deploy to. We’re going to deploy into our lab subscription here, and in the dropdown I’m going to select the vNetDemos Resource Group I already have.</p>
<p>Now, I could also create a new resource group here, but we’ll go ahead and select vNetDemos. And then what we’ll do is we’ll give our virtual network a name and we’ll just call it MyVnet. And we’ll deploy into Central US. This drop-down allows us to select any of the existing regions that are available. We’ll just leave it at Central US.</p>
<p>Now, if I click Review and create here, what Azure is going to do is it’s going to create the virtual network without giving me any kind of ability to specify the address space for that network. I don’t wanna do that here, so what we’ll do is we’ll click Next for IP Addresses.</p>
<p>Now, in the IP Addresses tab here, we see we already have a default subnet that Azure is going to give us, and it’s giving us a default address space for the virtual network. Now, what I could do is click next here for security to move on. But what we’ll do here is we’ll edit this address space. And instead of using 10.1.00&#x2F;16, we’ll go with 192.168.00&#x2F;16. The green check mark tells me it’s a valid address space, but now what Azure is telling me here is we don’t have any subnets to find. So we need to have a subnet.</p>
<p>So we’ll go ahead and click Add a subnet. And over here we need to name our, what is called really the default subnet, but we’ll just call this MySubnet. Now, the address range for the subnets, or not only this subnet, but any subnet that we define within this virtual network, the address range needs to fall within the address space that’s been defined for the virtual network itself. So I can’t give the subnet here an address range of 10.000, when the address space for the entire virtual network is 192.168.</p>
<p>So consider the address space of the virtual network as the umbrella, and any address range for any subnet within that virtual network needs to fall within that umbrella. So what we’ll do here is we’ll give my subnet an address range of 192.168.1.0&#x2F;24. And then when we do that, Azure is telling me how many usable addresses I have with that range.</p>
<p>Now, this service endpoints option here allows us to define service endpoints, and what these service endpoints do is allow us to send traffic to specific Azure resources from the virtual network over whatever our defined service endpoints are. If we select the dropdown here, we can see all of the different services that are available when we wanna create service endpoints.</p>
<p>Now we’re not going to do any service endpoints here. So we’ll close outta that and we’ll add our subnet. So now we have the address space of the virtual network as 192.168.00&#x2F;16. And then we have the subnet, which is a piece of that complete address space configured at 192.168.1.0&#x2F;24. So we’ll go ahead and click Next for Security.</p>
<p>Now in this Security tab, we have some security options that we can configure here. We can configure Bastion Host, DDoS protection, and Azure Firewall. Now, if we hover over the icon next to Bastion Host here, we can see that the Azure Bastion service is a fully platform-managed platform as a service service that you can provision inside the virtual network. You can use the Bastion Host service to essentially connect to your virtual machines in the Azure portal over SSL.</p>
<p>Now, you can connect to them via RDP in the case of Windows machines and via SSH for your Linux machines. The purpose of this Bastion Host service is to allow you to remote to your virtual machines over the internet, without needing to give them public IP addresses, because that’s always been a big no-no when you deploy a VM. You put a VM out on the public internet with a public IP, the only thing you have protecting your VM from the bad guys is a username and password, which can be brute-forced.</p>
<p>So, Bastion Host allows you to access those VMs without giving them public IP addresses. We’re not going to do anything with Bastion Host here, but I do wanna hover over here for DDoS protection. And this DDoS protection comes in two flavors, Basic and Standard. The Basic protection is built into the Azure platform by default, and incurs no costs. However, the Standard flavor of Azure DDoS protection is a premium service and it can get quite expensive quickly. And that’s because it offers lots of enhanced mitigation capabilities.</p>
<p>As you see here in this pop-up, you’ve got adaptive tuning, attack notification, and all kinds of telemetry to protect against different DDoS attacks. For this demonstration, we’ll just leave this at its Basic option. And then if we hover over Firewall here, we can see that Azure Firewall is really a managed Cloud-based network security service that you use to protect virtual network resources.</p>
<p>Now, if I click Enabled here for Firewall, we can see, I can give my firewall a name, and then I can specify the subnet address space for the firewall, which is separate from the actual virtual network we’re creating. And then of course, I need to give my firewall a public IP address. For this demonstration, we are not going to enable firewall. So we’ll disable this, we’ll click Next for Tags. And here is where we can provide tags for our resources that we’re deploying here. We’re not going to do any tagging here, so we can go ahead and click Review and create.</p>
<p>Now, what this does is provide us with the information that we’ve provided for our setup here. And what we can do here is validate that everything looks like it should. What Azure does here is validate that all of my options are valid. So we’re going to create my VNet with an address space of 192.168.00&#x2F;16, and then we have our subnet here.</p>
<p>Bastion Host is disabled. The DDoS protection plan was left at Basic, and we did not enable firewall. So we’ll go ahead and create the new virtual network. The creation of a virtual network takes just a few moments and we can see it’s already been completed. So we’ll go ahead and click Go to resource here. And we’re now in MyVNet.</p>
<p>If we click on Address space under Settings here, we can see we have the address space defined. Connected devices tells us what devices are connected. We haven’t deployed anything, so we don’t have anything connected. And then we can see what subnets are defined here. And then we could even add another subnet.</p>
<p>This option here for Gateway subnet we’ll get to later. This is used when you’re creating a VPN connection, and I’ll show you what this does later on. And of course, we have the DDoS protection, Firewall and Security, DNS servers that are assigned to this. By default new virtual networks get the Azure provided DNS servers assigned to them. And then we can look at any service endpoints, peerings, properties. And of course, you got the Monitoring options down here.</p>
<p>So with that, you now know how to deploy a pretty basic virtual network in Microsoft Azure.</p>
<h1 id="VPN-Gateways"><a href="#VPN-Gateways" class="headerlink" title="VPN Gateways"></a>VPN Gateways</h1><p>Welcome to VPN Gateways. Over the next few lessons and demos, we are going to dive into different types of VPNs that you can deploy in Azure. A key component of VPNs in Azure is the VPN Gateway, so let’s talk a little bit about what the VPN Gateway is and what it does.</p>
<p>Before you deploy a VPN connection in Azure, you need to deploy a VPN gateway. This VPN Gateway is a special kind of virtual network gateway. It’s typically used to send encrypted network traffic between an Azure virtual network and an on-prem network over the public internet. However, you can also use a VPN Gateway to send encrypted traffic between different Azure virtual networks over the Microsoft network if you wish.</p>
<p>You can only define one VPN gateway per virtual network. However, each VPN Gateway supports multiple connections to it. This allows you to connect multiple networks to the same gateway.</p>
<p>When you deploy a virtual network gateway, quite a few things happen under the hood. The process begins with Azure deploying at least two hidden VMs that you can’t see. These VMs are deployed to a gateway subnet that you specify during the gateway deployment, and they contain routing tables and the gateway services. Since they are hidden and used only by Azure, you cannot configure the VMs at all.</p>
<p>When you deploy a virtual network gateway, you need to tell Azure what type of gateway it should be. Specifying a type of “VPN” tells Azure that the gateway will be used to build a typical VPN connection. If you specify “ExpressRoute” as the type, the gateway will be configured for an ExpressRoute connection.</p>
<p>When you deploy a virtual network gateway, it can take up to 45 minutes for the deployment to complete. This makes sense since so much stuff happens under the hood. Once the gateway is deployed, you can create an IPSec or IKE VPN tunnel between the newly deployed virtual network gateway and any one of a number of other gateways. For example, you can create a vNet-to-vNet connection to another VPN gateway in Azure, or you can create a site-to-site connection to an on-prem VPN device. You can even create a point-to-site connection that will allow you to connect to your virtual network from a remote location.</p>
<p>To learn more about virtual network gateways, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways</a> </p>
<p>Later on, I’ll show you how to deploy a virtual network gateway and how to use it to build a site-to-site VPN connection.</p>
<h1 id="Site-to-Site-VPNs"><a href="#Site-to-Site-VPNs" class="headerlink" title="Site-to-Site VPNs"></a>Site-to-Site VPNs</h1><p>Welcome to Site-to-Site VPNs! In this lesson, we are going to look at what a site-to-site VPN is, why you would use it, and how you would deploy one.</p>
<p>In most cases, when you need to connect an on-prem network to an Azure virtual network, you’ll use a site-to-site VPN gateway. This type of connection allows you to establish an IPSec or IKE VPN tunnel between the on-prem network and the Azure vNet. To deploy this type of connection, you need to have a VPN device deployed on-prem. This on-prem VPN device needs to have a public IP address assigned to it so that the Azure-based VPN gateway can communicate with it.</p>
<p>The image that you see on your screen shows what a typical connection would look like.</p>
<p>The overall process for creating a site-to-site VPN connection is pretty straightforward. You start by creating the Azure virtual network that you’ll be connecting to the on-prem network. </p>
<p>Once you have the virtual network created, you create a gateway subnet on your virtual network, and then you create a VPN gateway. The creation of the gateway subnet takes just a few minutes to create, while the deployment of the VPN gateway can take up to 45 minutes to complete. </p>
<p>After you’ve created the VPN gateway, you can create the local network gateway. This local network gateway that you create represents the on-prem endpoint of the eventual VPN connection. </p>
<p>With both the VPN gateway and the local network gateway created, you need to configure the on-prem VPN device. This process will differ, based on the device you have. </p>
<p>Once the on-prem device is configured, you can deploy a VPN connection in Azure. This VPN connection creates the site-to-site connection between the VPN gateway, which represents the Azure side of the VPN, and the local network gateway, which represents the on-prem endpoint of the VPN connection.</p>
<p>Once the VPN connection is provisioned, you need to verify the connection.</p>
<p>Join me in the next lesson, where I’ll show you in more detail how to create a site-to-site VPN connection.</p>
<h1 id="DEMO-Building-a-Site-to-Site-VPN-Part-One"><a href="#DEMO-Building-a-Site-to-Site-VPN-Part-One" class="headerlink" title="DEMO: Building a Site-to-Site VPN - Part One"></a>DEMO: Building a Site-to-Site VPN - Part One</h1><p>Hello, and welcome back. In this demonstration here, what we’re going to do is deploy a site to site VPN. We are going to connect the MyVnet virtual network that we created earlier to an on-prem network. What we’re going to do here is deploy a virtual network gateway, a local gateway, and then we’re going to create a VPN connection that connects our virtual network gateway, which represents MyVnet, and we’re going to connect that to the local gateway, which is going to represent our VPN device on the on-prem network.</p>
<p>Now, what we need to do before we get started is deploy a gateway subnet on our MyVnet virtual network. Now, this gateway subnet is going to host the underlying VMs that Azure spins up to facilitate the VPN connection. These are VMs that we can’t see, but trust me, they’re there. To create our gateway subnet, what we do from our MyVnet virtual network here is select subnets. And then we can see, we have my subnet that was provisioned earlier. And then what we’re going to do is click on gateway subnet. And what this does is allow us to create this special subnet that the VPN will use to establish connectivity between MyVnet and the on-prem network.</p>
<p>What we need to do here is specify an address range for our gateway subnet. And if you notice, you can’t even change the name of gateway subnet. This name gateway subnet is important because Azure looks at that and says, oh, okay, this must be the subnet we need to use for this VPN gateway that we’re setting up.</p>
<p>Now, what we’re going to do here is change this CIDR block. Right now the default address range for our gateway subnet is one 192.168.00&#x2F;24. I don’t need a gateway subnet that encompasses most of my address space. So what we’ll do is we’ll make this a .2.0 and we’ll make it a &#x2F;28. So what I’ve just done here is I took a very small piece of my overall address space of 192.168.00, and carved it out for my gateway subnet.</p>
<p>Since only a few resources are deployed to this gateway subnet by Azure, we don’t need a whole lot of network addresses available. To be honest, even 11 here plus the five reserved is probably too many. We could probably even get away with a &#x2F;29 here, but we’ll go ahead and leave it at 28, just to make sure.</p>
<p>We don’t need to configure a gateway or any network security groups, routing tables… This stuff all is left at its default setting when creating a gateway subnet, so we’ll go ahead and click okay here. So we now have our gateway subnet deployed and what we’ll do now is create the virtual network gateway for our VPN. Now, this process is going to take 45 minutes to complete, so what I’m going to do is just walk you through the process of beginning the deployment, and then we’ll come back when the deployment is finished.</p>
<p>So let’s go ahead and hit the hamburger here and create a resource. And what we’ll do here is search for virtual network gateway. And we have it here and we’ll go ahead and create it. As you can see on your screen, there’s quite a bit of information we need to supply here, although a lot of these are defaults.</p>
<p>So what we’ll do here is we’ll deploy into the lab subscription. And what we’ll do here is we’ll call it my gateway. And we’ll deploy into Central US, which is where I typically install stuff. Now we have two choices of gateway here, either a VPN or ExpressRoute. We’re not deploying an ExpressRoute, so VPN is the default and we’ll leave it there. And the same thing with VPN type, we can deploy a route-based VPN or a policy-based VPN.</p>
<p>If we hover over the icon here for type, we can see that the VPN we choose is going to depend on the make and model of the VPN device we’re trying to connect to. It’s also gonna be driven by the kind of VPN connection we want to create. As you can see in this box, what we wanna do is choose the route based option if we’re going to create a point of site inter virtual network, or if we’re going to create multiple sites to site connections.</p>
<p>We can see that policy-based gateways only support IK V1. If we need IK V2, we need to go route based. For this demonstration here, we’re going to go route based. And then here we have the SKU. If we select the dropdown we can see all of the different options we have. We’re going to do basic here. But if I hover over SKU here, we can see that route-based VPNs are offered in three different SKUs, basic, standard, and high performance.</p>
<p>If we’re going to create a VPN that co-exists with ExpressRoute, we can see here that we need to choose standard or high performance. If we’re going to go active, active, we need to select high performance. This is a basic demonstration. We’re not doing anything crazy so we can get away with a basic generation one gateway.</p>
<p>If we hover over the icon here for virtual network, we can see that the virtual network that we specify in this dropdown is the virtual network that we’re going to configure so that it can send and receive traffic on this gateway. So what we’ll do here is we will select MyVnet and we can see here that it found the gateway subnet automatically.</p>
<p>Now, since the on-prem device needs to be able to communicate with this gateway over the internet, this gateway needs to have a public IP address. We can either use an existing public IP or create a new one. I don’t have an existing public IP, so we’ll let this process create a new one and we’ll call the public IP gateway IP. The public IP address SKU is going to match the SKU of the gateway we’re setting up. We can leave these last two options disabled since we’re not doing any kind of active, active stuff, and we’re not replicating using BGP.</p>
<p>Since we’re not going to tag anything, we can go ahead and review and create here. And what Azure has done is validated my configurations. So we are deploying a gateway called my gateway into the Vnet demo’s resource group within my lab subscription. We’re deploying into Central US and the SKU for this gateway is a basic generation one. This gateway is going to allow traffic to and from the MyVnet network, and the gateway subnet is the one that we defined earlier.</p>
<p>We’re deploying a route-based VPN type using a VPN type gateway. We’ve disabled the active active mode in BGP, and we’ve assigned a new IP called gateway IP to our virtual network gateway. Once this virtual network gateway creation process completes, Azure will assign a dynamic public IP address to it. And we will need that to configure our VPN device on-prem, which by the way, I am not going to cover in this demonstration. And I’m not going to cover that because every VPN device is different.</p>
<p>What I’m doing here in this demonstration is showing you all of the pieces that you need to do within the Azure portal to make Azure talk to an on-prem VPN device. The steps you need to take to configure your given VPN device in your own environment will be drastically different depending on the device itself. So let’s go ahead and create our gateway here, and we can see that the deployment is underway.</p>
<p>So this really is going to take about 40 to 45 minutes to complete, so I’m going to let this run, and then when it’s completed, we’ll come back and I’ll show you what the next steps are, and then we’ll take it from there.</p>
<h1 id="DEMO-Building-a-Site-to-Site-VPN-Part-Two"><a href="#DEMO-Building-a-Site-to-Site-VPN-Part-Two" class="headerlink" title="DEMO: Building a Site-to-Site VPN - Part Two"></a>DEMO: Building a Site-to-Site VPN - Part Two</h1><p>Okay, welcome back. So our deployment has now completed, and we have the virtual network gateway deployed, and if we click on Go to resource here, we can see MyGateway is now deployed. We can see it’s associated with the MyVNet virtual network, and we have a public IP address here of 23.99.178.64. This gateway IP here, this public IP address, is what we will need when we configure the on-prem VPN device because the on-prem VPN device needs to know what the public IP is of the Azure site so it can communicate with it.</p>
<p>So now that we have MyGateway deployed, what we’ll do here is we’ll note this IP address, and I’ll just copy this. I’m going to paste this over into Notepad here, and I’ll drag this into my second screen. So now that we have our public IP for our virtual network gateway documented, what we’ll do is we’ll create a local network gateway.</p>
<p>Now, the local network gateway is the reference to the on-prem VPN device. So essentially, what we do is we deploy the virtual network gateway, which is MyGateway, and this gateway represents the Azure endpoint of the VPN connection. The local network gateway we’re about to deploy represents the on-prem VPN device, that endpoint of the VPN connection.</p>
<p>Once we have the virtual network gateway and the local gateway configured, we then deploy a VPN connection, which connects the two, so let’s go ahead and deploy our local network gateway, and we’ll just search for it here in the marketplace. And we’ll go ahead and create. Now, there’s not as much to configure for the local network gateway. All we need to do is give the local network gateway a name, and then we need to provide the public IP address of our VPN device in the on-prem environment. We also need to add any additional address ranges that are behind that VPN device so that Azure knows that it’s going to be able to talk to those networks, and then of course, we need to decide which subscription it’s gonna go in and which resource group, along with the location.</p>
<p>So we’re going to call our local gateway just OnPrem-Local, and I’m going to copy, I have the actual public IP of my on-prem VPN device here, and the on-prem address space for the on-prem network is 10.1.0.0&#x2F;16. So what this information is doing is telling Azure that the on-prem VPN device can be reached at this public IP, and this address space is the underlying network address range that we can access through the VPN. We’re not going to do any BGP stuff, and we will deploy this into our vNetDemos resource group. We’ll leave it in Central US since that’s where everything else is, so we’ll go ahead and create this local gateway, and we’ll go back into our resource group here.</p>
<p>Now, the deployment of the local gateway takes far less time than the virtual gateway, and as you can see, it’s already been deployed, so we’ll refresh here, and we can see our OnPrem-Local. So now that I have the virtual network gateway, which represents the Azure endpoint, and the local gateway, which represents the on-prem VPN endpoint, what we can do is create the VPN connection between those two endpoints.</p>
<p>So we’ll go ahead and go back to the Hamburger, create a resource, and we’ll search for Connection. And we have Connection here, and we’ll go ahead and create the connection. We have a couple different options here for connection type. We can to a VNet-to-VNet, a Site-to-site, or an ExpressRoute. For this demonstration, we’re working through the Site-to-site process, so we’ll go ahead and click Site-to-site, and again, we’ll deploy into our vNetDemos resource group, and we’ll okay it.</p>
<p>Now, when we do that, this Settings page appears. Now, what this Settings page does is allow us to specify each of the endpoints of our virtual private network. We need to tell Azure what our virtual network gateway is and what the local network gateway is. This creates the connection between the two. So we’ll go ahead and select our virtual network gateway and our local network gateway.</p>
<p>You can see here, it fills in the connection name automatically, and we’re going to leave this connection here, although you can change this if you want to.</p>
<p>Now, we also need to specify a shared key. Now, this shared key, whatever we add here, we need to save that because we’re going to need to enter that same information into the on-prem VPN device, so that shared key matches both sides, the Azure side and the on-prem VPN device. If we hover over the icon here, we can see that this can be a mixture of numbers and letters, and it’s used to establish that encryption for the connection, so what I’ll do here is I’ll create a shared key. And remember, we’ll need this same shared key for our VPN device, and then we can select which protocol we wanna use, IKEv1 or v2.</p>
<p>IKEv2 will work for us, and since we’re not using BGP, we do not need to enable it, so we’ll go ahead and okay it. This will give me a summary, and we’ll go ahead and okay it again. We can go back into vNetDemos here, and it only takes a few moments for the connection to be created, and we can see it’s been created, and there’s our connection. Now, as we can see here, we have an unknown status, and the status is unknown because we haven’t configured the on-prem VPN device yet.</p>
<p>Now, as I mentioned earlier, configuring the VPN device, that process is going to be different, depending on the device itself, but what we can do here is we can download a configuration, and we can choose what device we’re configuring on the other side, and this gives us some information that we can use to configure that VPN device.</p>
<p>In the first drop-down, we can select the vendor. For example, if we were configuring a Cisco device, we’re configuring an ASA, and then we can select the firmware version, and then what we can do here is download that configuration. If we open this up, we can see we have all of the information we need to configure a Cisco ASA with a firmware of 9.8 or later, and then we would use this to configure the ASA, so let me close this, close this, and give me a few minutes. I will go over and configure my VPN device, and then what we’ll do is we’ll come back, and we’ll see this status change to show Connected.</p>
<p>Okay, so I’ve configured my on-prem VPN device, and we can now see we have a Not Connected status. We’ll give this a few minutes, and what should happen is this should show that we now have a status of Connected. So we’ll give it a few moments here, and then we’ll refresh. Go ahead and refresh here, and let’s give it one more refresh here, and there you have it.</p>
<p>So the process we followed was actually pretty straightforward when you think about it. You first deploy a virtual network in Microsoft Azure. You then deploy a gateway subnet that is attached to that virtual network. Once you have your gateway subnet, you go ahead and you deploy your virtual network gateway in Azure, and that virtual network gateway references the Azure endpoint of the VPN connection. Once you have your virtual network gateway deployed, you create your local gateway, which references the on-prem VPN device. Once you have the local gateway configured, you then create the connection between the virtual network gateway and the local gateway. Once you have that set up, you can go ahead and download the configuration for whatever device it is you’re using on-prem, and then you can go ahead and configure your on-prem device so that it can connect to Azure. You need to make sure that your shared key is the same in both Azure and in your on-prem VPN device. Once you configure the on-prem VPN device, you can come back and refresh, and you should see your VPN connection between your Azure virtual network, and your on-prem network shows Connected.</p>
<h1 id="Point-to-Site-VPNs"><a href="#Point-to-Site-VPNs" class="headerlink" title="Point-to-Site VPNs"></a>Point-to-Site VPNs</h1><p>Hello and welcome to Point-to-Site VPNs. In this lesson, you will be introduced to point-to-site VPNs. You’ll learn what they are and when to use them.</p>
<p>A point-to-site VPN gateway connection is a type of connection that you typically use to securely connect a single client computer to a virtual network in Azure. This is a common connection type for remote workers who need access to resources on your Azure virtual network. These types of connections are initiated from the client computer.</p>
<p>When you create a point-to-site VPN, you have a choice of protocols. You can use OpenVPN Protocol, Secure Socket Tunneling Protocol, otherwise known as SSTP, orIKEv2 VPN. </p>
<p>The OpenVPN Protocol is an SSL&#x2F;TLS-based VPN protocol that can be used through a firewall, since most firewalls allow TCP port 443 outbound. The OpenVPN Protocol is flexible because it can be used to connect from a variety of client machines, including those running Android, Windows, Linux, and Mac OSX.</p>
<p>Secure socket tunneling protocol is a proprietary VPN protocol that leverages TLS. It, too, can penetrate firewalls for the same reason OpenVPN can. However, unlike OpenVPN Protocol, SSTP only supports Windows devices.</p>
<p>IKEv2 VPN is a standards-based IPSec VPN solution. It can be used to connect from Mac OSX devices.</p>
<p>When a user initiates a point-to-site VPN connection to Azure, the user must first be authenticated before Azure accepts the connection. There are a couple different ways the user can be authenticated. These include native Azure certificate authentication, native Azure AD authentication, or a traditional Active Directory Domain Server.</p>
<p>The Azure certificate authentication option requires a client certificate to be present on the device that the user is connecting from. This certificate is validated by the VPN gateway during the connection handshake.</p>
<p>With Azure AD authentication, users can connect using their Azure AD credentials. It should be noted, however, that the native Azure AD authentication option is only supported for OpenVPN protocol. Windows 10 will also require the use of the Azure VPN Client to make this work.</p>
<p>Users in a traditional AD Domain can be authenticated using the traditional AD domain server through the use of a RADIUS server that needs to be integrated with the domain controller.</p>
<p>The table on your screen shows which Azure gateway SKUs support point-to-site VPNs.</p>
<p>For complete technical details on point-to-site VPNs, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about">https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about</a></p>
<h1 id="ExpressRoute"><a href="#ExpressRoute" class="headerlink" title="ExpressRoute"></a>ExpressRoute</h1><p>Hello and welcome to ExpressRoute. In this lesson, we are going to take a look at what ExpressRoute is and what it offers.</p>
<p>ExpressRoute is an offering you can use to extend your on-prem networks into Azure. It’s essentially a private connection from your network to Azure that’s facilitated by a third-party connectivity provider.</p>
<p>You can use ExpressRoute to establish connectivity from an any-to-any network, a point-to-point Ethernet network, or from a virtual cross-connection through a connectivity provider at a co-location facility. It’s important to note that connections made with ExpressRoute do NOT traverse the public internet. Because they do not traverse the internet, ExpressRoute connections are inherently more secure, more reliable, and typically faster than site-to-site connections that traverse the internet.</p>
<p>ExpressRoute connections offer several benefits. For example, such connections allow you to establish connectivity to Microsoft cloud services across all regions within a geopolitical region. Global connectivity across all regions to Microsoft services can be achieved trough the use of the ExpressRoute premium add-on.</p>
<p>ExpressRoute connections also provide for dynamic routing between your on-prem networks and Microsoft via BGP, and the built-in redundancy that ExpressRoute offers provides higher reliability. There is even a connection uptime SLA of 99.95% for ExpressRoute dedicated circuit availability.</p>
<p>You can use ExpressRoute connections to access Microsoft Azure services and Microsoft Office 365 services. ExpressRoute circuits come in a variety of bandwidths. You can purchase a circuit with as little as 50Mbps in bandwidth, and you can purchase a circuit with as much as 10Gbps in bandwidth. There are also several options in between.</p>
<p>The table on your screen shows what’s available:</p>
<ul>
<li>50 Mbps</li>
<li>100 Mbps</li>
<li>200 Mbps</li>
<li>500 Mbps</li>
<li>1 Gbps</li>
<li>2 Gbps</li>
<li>5 Gbps</li>
<li>10 Gbps</li>
</ul>
<p>You can even increase the bandwidth of your ExpressRoute circuit without having to tear down existing connections. This is a huge plus in my book.</p>
<p>When you deploy an ExpressRoute circuit, you’ll have to decide what billing model you wish to use. The “Unlimited Data” billing model is based on a monthly fee. It offers unlimited inbound and outbound transfer for a single fee.</p>
<p>“Metered Data” billing is also based on a monthly fee. However, it’s a little different from “Unlimited Data” because, while all inbound data transfer is included free of charge, outbound data transfers are charged on a “per-GB” basis.</p>
<p>The “Express Route Premium Add-On” that I mentioned earlier is a paid add-on to the ExpressRoute circuit. This premium add-on increases the number of route limits for Azure public and private peering from 4,000 routes to 10,000 routes. It also offers global connectivity across any region except for the national clouds. The ExpressRoute Premium Add-On also increases the number of vNet links per circuit from the default of 10 to a larger limit, which is determined by the bandwidth of the circuit that you purchase.</p>
<p>Be sure to check out the ExpressRoute FAQ at the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs">https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs</a></p>
<h1 id="vNet-Peering"><a href="#vNet-Peering" class="headerlink" title="vNet Peering"></a>vNet Peering</h1><p>Hello and welcome to vNet Peering. </p>
<p>If you find yourself in a spot where you need to establish connectivity between two different Azure virtual networks, you can leverage virtual network peering, or vNet Peering. What vNet Peering does is allow you to seamlessly connect different Azure virtual networks. As far as connectivity goes, both virtual networks appear as one. Any traffic that flows between peered networks will use the Microsoft backbone infrastructure. </p>
<p>There are two types of peering that Azure supports. They include Virtual Network Peering and Global Virtual Network Peering. Virtual Network Peering allows you to connect virtual networks that are located within the same Azure region as one another, while Global Virtual Network Peering allows you to connect virtual networks deployed in different Azure regions.</p>
<p>Whether its local or global peering that you leverage, both options offer low-latency, high-bandwidth connectivity between Azure resources that are connected to different virtual networks. This connectivity facilitates data transfer across different virtual networks, even when they are in different Azure subscriptions, Azure Active Directory tenants, and Azure regions.</p>
<p>Peering offers you the ability to connect virtual networks that were created through the Azure Resource Manager and it also provides you the ability to connect virtual networks that were created through Resource Manager to those that were created through the classic deployment model. </p>
<p>I should also mention that creating a peering causes no downtime to resources during the peering process nor after the peering is completed.</p>
<p>Since the traffic between peered virtual networks remains on the Microsoft backbone network, it remains private without the need for the public Internet, gateways, or even encryption.</p>
<p>Network latency between VMs on separate peered virtual networks in the same region is no different than the latency you would see between two VMs within a single virtual network. You can even apply network security groups to either virtual network in the peering if you wish to block access to other virtual networks or subnets. </p>
<p>Join me in the next lesson, where I’ll show you how to peer two existing virtual networks.</p>
<h1 id="DEMO-Peering-Two-vNets"><a href="#DEMO-Peering-Two-vNets" class="headerlink" title="DEMO: Peering Two vNets"></a>DEMO: Peering Two vNets</h1><p>Hello and welcome back. In this brief demonstration, I want to walk you through the process of using vNet peering to connect two different virtual networks in Microsoft Azure. On my screen here I’m logged in to my Azure portal as my administrator and I’m in the vNetDemos resource group where I’ve deployed a virtual network called MyVnet.</p>
<p>If I bounce out to Resource Groups here and go into my OnPrem resource group, we can see I have a second virtual network called OnPrem-vNet. So what we’re going to do here is connect these two virtual networks through what is called vNet peering. The process for creating the peering is actually pretty straightforward. What we need to do here is select one of the virtual networks, and then from the Overview page for the virtual network, under the Settings section here we have an option here for peerings.</p>
<p>We’ll select Peerings here and we can see we have no peerings currently configured. To create a peering we simply click Add and then we need to give the peering a name. Now before I give my peering a name here, I just want to point out this note here that we see. And it’s basically telling us that for peering to work we need to create a peering link from the OnPrem-vNet out to the remote virtual network that we’re going to peer with, but then we also have to create a peer that comes back from that remote virtual network to this OnPrem-vNet virtual network. So what I’ll do here is I’ll call this peering OnPremtoRemote, just keep it simple.</p>
<p>Now under Peer details here we need to specify a virtual network deployment model. We have two options, resource manager or classic. Since both of my virtual networks are resource manager, I’ll leave Resource manager selected. Now this option here for the resource ID, if we hover over this icon here we can see that we can, instead of browsing for our virtual network, what we can do is enter the resource ID of the network directly. I have access to everything I need to have access to, so what we’re going to do I choose the Lab Subscription, which is where we’re doing our work, so we’ll go ahead and select the virtual network we want to peer with.</p>
<p>Now you’ll notice under this “Cannot be peered with this virtual network” heading is the OnPrem-vNet. That’s because you can’t peer with yourself. So we’re going to peer with MyVnet here. So we’ll select it, and what we need to do in this box is provide a name of the peering from MyVnet back to OnPrem. So what I’ll do for this, I’ll just call this MyVnettoRemote.</p>
<p>Now under configuration here we have a couple different things that we can optionally configure. If we hover over the icon here for “Allow virtual network access from OnPrem-vNet to MyVnet”, what this does is allow communications between the two virtual networks. If you’re going to peer your networks it stands to reason that you’d want those networks to communicate with one another. So this option is enabled by default. And the same for this second option, which is allowing virtual network access from MyVnet to OnPrem-vNet. This, again, is enabled by default.</p>
<p>Now you could turn these off and block traffic in between them, but then what would be the sense of peering them? And in a similar fashion, we have the option to configure forwarded traffic. If we hover over the icon here for traffic forwarding from MyVnet to OnPrem, we can see that this setting allows us to forward traffic from MyVnet, which is traffic that isn’t originating from MyVnet, and then forward that into the OnPrem-vNet. These are turned off by default, which is a typical configuration.</p>
<p>And then lastly we have the gateway transit settings. If we hover over the icon here for “Allow gateway transit”, we can see that what gateway transit does is it allows one virtual network to use the VPN gateway in the peered virtual network for cross prem, or even VNet-to-VNet connectivity. We have no need for gateway transit in this configuration, so we can leave this unchecked. And at this point, once I click OK here, what’s gonna happen is this peering is going to be created going both ways. That’s why we needed to provide the name for the peering from OnPrem to MyVnet, and then from from MyVnet to OnPrem.</p>
<p>So we’ll go ahead and click OK here, and we can see the peering is actually being added twice. And we see it’s connected. Now if we go back out to our resource groups and we go into vNetDemos and we look MyVnet, if we select Peerings here we can see we now have the peering from MyVnettoRemote and it is showing a status of “Connected”.</p>
<p>So that’s pretty much it. If you’re going to connect different Azure virtual networks to one another, you don’t have to go through the whole process of doing a site-to-site VPN. You could and it’ll still work, but why? I mean, at this point, if you’re gonna connect those two Azure virtual networks, then you would do it via peering. It’s a much cleaner process and involves a lot less work. So with that let’s call it a wrap and I’ll see you in the next lesson.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations. You’ve come to the end of Getting Started with Azure Virtual Networks. Let’s review what you’ve learned.</p>
<p>We started things off with a vNet overview. You learned about basic Azure virtual network concepts and about some key best practices. We also covered communications topics, filtering, routing, and integration, before working through a demo that showed you how to deploy a virtual network in Microsoft Azure.</p>
<p>After covering the basics of azure virtual networks in the first half of this course, we used the second half to dive into VPNs, where you learned about site-to-site VPNs, point-to-site VPNs, ExpressRoute, and vNet peering. You also get to see a demo that showed you how to peer two vNets in Azure. </p>
<p>At this point, you should have a good understanding of how to deploy and connect Azure virtual networks.</p>
<p>To learn more about Azure virtual networks, you can, and should, read Microsoft’s published documentation. You should also keep an eye out for new courses on Cloud Academy because we’re always publishing new ones. Be sure to give this course a rating, and if you have any questions or comments, please let us know. Thanks for watching and happy learning!</p>
<h1 id="2Concepts-and-Best-Practices"><a href="#2Concepts-and-Best-Practices" class="headerlink" title="2Concepts and Best Practices"></a>2<strong>Concepts and Best Practices</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">Network security groups</a></p>
<h1 id="4Filtering-Routing-and-Integration"><a href="#4Filtering-Routing-and-Integration" class="headerlink" title="4Filtering, Routing, and Integration"></a>4<strong>Filtering, Routing, and Integration</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json">BGP Overview</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services">Transferring Data via Private IP Address</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/private-link/private-link-overview">Private Link overview</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">Service Endpoints</a></p>
<h1 id="6VPN-Gateways"><a href="#6VPN-Gateways" class="headerlink" title="6VPN Gateways"></a>6<strong>VPN Gateways</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways">VPN Gateways overview</a></p>
<h1 id="10Point-to-Site-VPNs"><a href="#10Point-to-Site-VPNs" class="headerlink" title="10Point-to-Site VPNs"></a>10<strong>Point-to-Site VPNs</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about">Point-to-Site VPNs overview</a></p>
<h1 id="11ExpressRoute"><a href="#11ExpressRoute" class="headerlink" title="11ExpressRoute"></a>11<strong>ExpressRoute</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs">ExpressRoute info</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Overview-of-Azure-Services-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/18/AZ-700-Overview-of-Azure-Services-2/" class="post-title-link" itemprop="url">AZ-700-Overview-of-Azure-Services-2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:33" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:33-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 21:40:52" itemprop="dateModified" datetime="2022-11-22T21:40:52-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Overview-of-Azure-Services-2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Overview-of-Azure-Services-2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><h1 id="Azure-Overview"><a href="#Azure-Overview" class="headerlink" title="Azure Overview"></a>Azure Overview</h1><p>So what is <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">Microsoft Azure</a>? To put it simply, it’s a collection of online services that organizations can use to build, host, and deliver applications. The best part is that you don’t need to have your own data center or even any servers because Azure runs in Microsoft’s data centers around the world, which your users can access over the internet.</p>
<p>Not only does this approach save you the trouble of having to build and maintain your own on-premises IT infrastructure, but it can also save you money because you only have to pay for what you use, and you can scale your Azure resources up and down as needed.</p>
<p>For most applications, you need three core elements: compute, storage, and networking. Let’s start with compute. In Azure’s early days, Microsoft offered only one type of compute service: virtual machines, or VMs for short. These are machines that run either Windows or Linux. If you currently have an application running on a Windows or Linux server, then the most straightforward way to migrate it to Azure is to do what’s called a “lift and shift” migration. That is, you simply lift the application from your on-premises server and shift it to a virtual server in the cloud. Azure VMs are known as Infrastructure-as-a-Service because they’re traditional IT infrastructure components that are offered as a service.</p>
<p>Later, Microsoft came out with what’s known as a Platform-as-a-Service offering called Azure App Service. This platform lets you host web and mobile applications without having to worry about the underlying infrastructure. After doing a minor amount of configuration, you can just upload your code to an App Service instance and let Azure take care of the details. In most cases, this is a better solution than using virtual machines, but there are times when it makes more sense to use VMs. For example, if you have an application that’s not a web or mobile app, then you can’t use App Service, so you’ll have to use a VM.</p>
<p>These days, the hottest compute technology is containers. These are self-contained software environments. For example, a container might include a complete application plus all of the third-party packages it needs. Containers are somewhat like virtual machines except they don’t include the operating system. This makes it easy to deploy them because they’re very lightweight compared to virtual machines. In fact, containers run on virtual machines.</p>
<p>Microsoft provides a variety of ways to run containers. The simplest way is to use Azure Container Instances. This service lets you run a container using a single command. If you have a more complex application that involves multiple containers, then you’ll probably want to use Azure Kubernetes Service, which is what’s known as a container orchestrator. It makes it easy to deploy and manage multi-container applications.</p>
<p>Before we move on, I should mention one more compute service. It’s called Azure Functions, and it’s Microsoft’s main “serverless” offering. Azure Functions is kind of like Azure App Service except that it executes individual functions rather than entire applications, and you only pay for it when it gets used. When you provision an App Service instance, it runs until you shut it down, and you pay for it the whole time it’s running. Although it’s possible to configure Azure Functions in the same way, it’s usually better to use the Consumption plan, which means that it only uses resources when a function is running, so you only pay when a function is running.</p>
<p>Okay, that was a lot of compute options. Now let’s move on to storage. Believe it or not, there are even more options for storage than for compute. That’s because I’m also including databases and other data stores in the storage category.</p>
<p>The simplest form of storage is called Blob storage. It’s referred to as object storage, but really it’s just a collection of files. It’s not like a normal file system, though, because it doesn’t have a hierarchical folder structure. It has a flat structure. It’s typically used for unstructured data, such as images, videos, and log files.</p>
<p>One of the great things about it is that it has multiple access tiers: hot, cool, and archive. The hot tier is for frequently accessed files. The cool tier is for files you expect to access only about once a month or less. The advantage is that it costs less than the hot tier as long as you don’t access it frequently. The archive tier is for files that are rarely accessed, such as backup files. It has the lowest storage costs but the highest retrieval costs. It also takes several hours to retrieve files from the archive tier.</p>
<p>If you need hierarchical file storage, there are a couple of options. The one that will probably seem more familiar is Azure File Storage, which is like a typical SMB file server. It serves up file shares that you can mount on Windows servers. The less familiar option is Azure Data Lake Storage Gen2. This is Hadoop-compatible storage for use with data analytics applications. </p>
<p>Okay, now how about relational databases? In an on-premises Microsoft environment, SQL Server is the most commonly used database. The cloud equivalent is Azure SQL Database. It’s very similar to SQL Server, although it’s not 100% compatible. If you need to run an open source database, then Microsoft still has you covered. It offers Azure Database for MySQL, MariaDB, and PostgreSQL.</p>
<p>All of these databases, including both SQL Database and the open source options, are suitable for online transaction processing. On the other hand, if you need to build a data warehouse, then Azure Synapse Analytics is the best choice.</p>
<p>If you release an application that attracts a very large number of users, you may find that a traditional relational database can’t scale to meet the demand. One common solution is to use a so-called NoSQL database. These databases are designed to handle far more data than relational databases. However, in order to achieve that massive scalability, they have to sacrifice something, so they don’t support all of the features of relational databases. Nonetheless, they have become a cornerstone of many cloud-based applications.</p>
<p>Microsoft’s main NoSQL offering is called Cosmos DB. It’s an amazing database service that can scale globally. Another NoSQL service is Azure Cache for Redis, which is typically used to speed up applications by caching frequently requested data.</p>
<p>That’s a lot of storage options, and I still didn’t cover them all, but you don’t need to know every single option at this point, so let’s move on to network services.</p>
<p>When you create a virtual machine on Azure, you have to put it in a virtual network, or VNet. A virtual network is very similar to an on-premises network. Each virtual machine in a VNet gets an IP address, and it can communicate with other VMs in the same VNet. You can also divide a VNet into subnets and define routes to specify how traffic should flow between them. </p>
<p>By default, all outbound traffic from a VM to the internet is allowed. If you also want to allow inbound traffic, then you need to assign a public IP address to the VM.</p>
<p>If you want VMs in one VNet to be able to communicate with VMs in another VNet, then you can connect the VNets together using VNet peering. By the way, so far, I’ve only been talking about virtual machines, but other resources, such as Kubernetes clusters, can be in VNets, too.</p>
<p>If you want to create a secure connection between a VNet and an on-premises network, then you can use either a VPN, which stands for Virtual Private Network, or Azure ExpressRoute. A VPN sends encrypted traffic over the public internet, whereas ExpressRoute communicates over a private, dedicated connection between your site and Microsoft’s Azure network. ExpressRoute is much more expensive than a VPN, but it provides higher speed and reliability since it’s a dedicated connection.</p>
<p>There are plenty of other network services available as well, but the ones I’ve covered are enough to give you a good high-level understanding of Azure networking.</p>
<p>Azure also provides a wide variety of other services outside of the core compute, storage, and networking categories, such as in hot areas like artificial intelligence and DevOps. I’ll go over some of those later.</p>
<p>The easiest way to understand how Azure works is to actually use it, so in the next lesson, we’ll create a virtual machine. If you’re ready, then go to the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-portal/">next video</a>.</p>
<h1 id="Using-the-Azure-Portal"><a href="#Using-the-Azure-Portal" class="headerlink" title="Using the Azure Portal"></a>Using the Azure Portal</h1><p>Now we’re going to dive into using <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">Azure</a>. Suppose you have a server application that you want to migrate to the cloud. As I mentioned earlier, the most straightforward way to do this is to move the application to a virtual machine on Azure.</p>
<p>There are many ways to interact with Azure, the Azure portal runs in a browser, so you don’t need to install anything to use it. Alternatively, you can install the CLI, which stands for command-line interface, or Azure PowerShell or the SDK, which stands for Software Development Kit.</p>
<p>If you want to use a command-based interface, and you have a lot of experience with PowerShell, then that’s probably your best bet. Otherwise, use the CLI, which is easier to learn than PowerShell. It’s actually possible to use the CLI and PowerShell from inside the browser too without having to install anything on your desktop. I’ll show you how to do that in the next lesson.</p>
<p>The SDK is what you need to use if you’re going to add code in your applications to interact with Azure.</p>
<p>It’s even possible to interact with Azure from a mobile device by using the Azure mobile app. You can even use the CLI and PowerShell from the mobile app.</p>
<p>The easiest way to get started, though, is to use the Azure portal. So if you’re following along on your own account, go to portal.azure.com. There are a few different ways to get to the place where you can create a VM. In this search box, you can start typing virtual machine and you’ll see it come up at the top of the search results.</p>
<p>Another way is to go into the menu on the left and select virtual machines. It takes you to the same place. Once you’re here, you can click Add.</p>
<p>The first thing it wants to know is what subscription to put this VM in. It always sets this to your default subscription, so you can usually just leave it that way. But I should explain what a subscription is.</p>
<p>When you sign up for an Azure account, Microsoft creates both a billing account and a subscription. It’s easy to get the two mixed up because they’re both involved in billing. A <em>billing account</em> is an agreement you or your organization sign to use Microsoft services. A <em>subscription</em> is actually just a collection of Azure resources. But all of the resources in a subscription are on the same monthly bill, so it’s also a unit of billing.</p>
<p>So why do you need to have both a billing account and a subscription? Well, you might want to have multiple subscriptions in your billing account. Since each subscription generates a separate invoice, it can be useful to have a separate subscription for each department in your organization. Also, since the resources in different subscriptions are isolated from each other, you might want to have multiple subscriptions for security or compliance reasons.</p>
<p>Okay, so we’ll leave the subscription with the default. Next, it’s asking for the resource group. Like a subscription, a resource group is a collection of resources, but a subscription can have multiple resource groups so it’s a way of further grouping the resources within a subscription.</p>
<p>There are a variety of ways to divide resources into resource groups. But the best practice is to group related resources together, such as a VM and its associated storage account. Generally speaking, the resources in a group should be created and deleted at the same time, which makes sense if they’re components that work together to provide a solution.</p>
<p>All right, so let’s create a new resource group to hold this VM. I’ll call it example-RG. Now we need to give the VM a name. I’ll call it example-VM. Next we need to decide which region the VM should run in.</p>
<p>Microsoft has data centers on every continent except Antarctica. Each of these dots is a region, and each region contains multiple Azure data centers. You usually want to choose a region that’s closest to where your users are located. I’ll choose West US 2. Notice that it has a diamond in it. That’s because it has availability zones. I’ll explain what those are in a minute.</p>
<p>You need to set an availability option if you want to make sure your application will still be available, even if Azure experiences an outage that affects this VM. The first option is “Availability zone”, which is what I just showed you on the map. A region that supports availability zones has at least three data centers, each of which is called a zone. If you put VMs in multiple zones, then a data center outage won’t take down your application, because your VMs and other zones will still be running.</p>
<p>It added another field called “Availability zone”. We can choose 1, 2, or 3. It doesn’t really matter which one we choose for this VM, but if we were to create a second VM, we’d need to put it in a different availability zone. I’ll choose “1”. </p>
<p>Next, we need to choose a VM image. This is a copy of the disk that will be used for the VM. The choices are different versions of Linux and Windows, such as Ubuntu, Red Hat, and Windows Server. This is only a small subset of the images that are available. You can click on this link to see more. For example, suppose you want an image that includes not only Windows Server but also SQL Server, click on Databases and then type “sql server”. Surprisingly, there are images of SQL Server on Linux first. I’ll add windows to the search to narrow it down. There we go. There are lots of SQL Server image options. For this example, we’ll just go back and pick one of the basic options though. I’ll pick the Ubuntu server option.</p>
<p>If you use an Azure spot instance for this VM, then the cost will be dramatically lower, but the VM might be shut down with only 30 seconds’ notice. So you should only use this option for non-critical workloads.</p>
<p>There are lots of options for the size of the VM. At the top of the list, there’s a size with only one virtual CPU, half a gig of memory, and four gigs of temporary storage. You can see that the cost per month is very low. Some of these other options are much bigger, but so is the cost. Since we’re not actually going to use this VM, I’ll choose the cheapest option.</p>
<p>Here, we need to create the administrator account. In most cases, you should use an SSH public key for authenticating to the VM. But to keep it simple for this demo, I’ll use a password. You can name your administrator account almost anything.</p>
<p>The inbound port rules let you open up the VM to access from the internet. If this VM will be acting as a web server, then you’ll want to open up ports 80 and 443. There’s also an option to open up the SSH port so you can log into the VM remotely. The problem with opening up the SSH port here is that it will allow access from all internet addresses, which is dangerous. There are other more secure ways to give yourself access to the VM. So you shouldn’t select this unless you’re just doing some testing. I’m going to set this to “None”.</p>
<p>That’s it for the basic settings, but there are a few more settings we should have a look at. We’ll click this button to go to the disks tab. The operating system disk is set to premium SSD by default. That option has the highest performance, but it’s much more expensive than the other two. I’ll set it to Standard SSD. You can also add data disks if you want.</p>
<p>And now let’s have a look at the networking options. By default, it creates a virtual network, a subnet inside that virtual network, and a public IP address. If we already had another virtual network, we could put it in there instead if we wanted to.</p>
<p>Okay, that takes care of the compute, storage, and networking options for this VM. So let’s create it. First, click “Review + Create”. It says that our settings have passed validation testing. Then it summarizes all of our settings. Now click the Create button.</p>
<p>It’ll take a little while to create, so I’ll fast forward. All right, it’s done. We can click on “Go to resource” to have a look at the VM. </p>
<p>Here it shows the details of this VM, such as its status, and its public IP address. Up here it has some controls that let you stop and restart the VM or even delete it. If we had set up SSH authentication, then we could connect to it from here too. In the menu on the left, there are all kinds of options for things like activity logs, security, backups, and monitoring.</p>
<p>That’s it for this demo, you should have a pretty good idea of how to create resources in the portal now, because the process is fairly similar, regardless of what kind of Azure resources you’re creating. If you’re following along on your own Azure account, you might want to look around and see what you can do with your new VM.</p>
<p>When you’re done, make sure you delete the VM so you don’t incur any ongoing charges. The best way to delete everything associated with the VM, including the public IP address, etc., is to delete its resource group. Select Resource groups in this menu, and then click on “example-rg”. Here’s a list of all the resources associated with the VM. Now click “Delete resource group”. Then type the name of the resource group. Then click the Delete button.</p>
<p>Now if you’re ready to see how to work with Azure using the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-cli/"><em>command-line interface</em></a>, then please go to the next video.</p>
<h1 id="Using-the-Azure-CLI"><a href="#Using-the-Azure-CLI" class="headerlink" title="Using the Azure CLI"></a>Using the Azure CLI</h1><p>As you saw in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-portal/">last demo</a>, it’s pretty easy to use the portal to create Azure resources but it’s definitely not the most efficient way to do it because it requires a lot of pointing and clicking. An alternative is to use the command line. Although it can be more difficult since you have to know the exact names of all the command line options. Once you’ve mastered it, you can often create and manage resources much more quickly.</p>
<p>In this demo, I’m going to show you how to create a website using Azure App Service. Do you remember when I said that it’s possible to use the command line without having to install anything on your desktop? Well, now that you’re familiar with the portal, I’ll show you how.</p>
<p>You see this icon to the right of the search bar? That’s how you start something called the Cloud Shell. It’s a very small virtual machine that you can use to run Azure commands. Click on it.</p>
<p>The first time you run Cloud Shell, it’ll ask you for permission to create a storage account that the Cloud Shell VM can use. This isn’t the first time I’ve used Cloud Shell, so my storage account is already set up. If you do get a dialogue box asking for permission, then click the option to create a storage account.</p>
<p>Cloud Shell supports both PowerShell and the Bash shell. You can switch between them using this menu. We’re going to use the Bash Shell because the commands are simpler. If you’re familiar with Linux commands, then it will be especially easy.</p>
<p>First, we need to download the files for a sample website. The command to do that is pretty long, so it’s easiest to copy and paste it. You can get it from the read me file in the GitHub repository for <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">this course</a>. You can find a link to the repository at the bottom of the overview tab below this video.</p>
<p>Okay, copy this <code>git clone</code> command and paste it into the Cloud Shell window. It created a directory (which is the Linux term for folder) called html-docs-hello-world. Change into that directory with the <code>cd</code> command. I’m just going to use keyboard shortcuts to do the copying and pasting now. Now we can create an Azure App Service Web App using one command. Here it is.</p>
<p>It starts with <code>az</code> which means it’s an Azure command. Then we say <code>webapp</code> which is the command for Azure App Service. Then <code>up</code> which means to create the web app using the code in the current directory. Then we say <code>--location</code> and the name of the region where we want to deploy the web app. I’ve set it to <code>westus</code>. Then we say <code>--name</code> and what we want to call the app. I’m calling it <code>ca-example,</code> but you’ll have to call it something else because the name has to be unique among all of the out service names across all Azure customers. Then we say <code>--html</code> to tell it that we’re creating a static HTML website. Now hit Enter.</p>
<p>That’s all you have to do to create a website running on Azure App Service. It’ll take a little while to deploy so I’ll fast forward.</p>
<p>Okay, it’s done. Now we can make sure the website is working by going to this URL. Remember to change this name to the one you used. Great, there’s the sample website.</p>
<p>All right, now let’s delete the web app, so we don’t incur any more charges. In the VM demo, we deleted everything associated with the VM by deleting its resource group. We can do the same thing here but since we didn’t specify a resource group name in the command, how do we do that? App Service created a resource group for us. You’ll see it in the output from the command. Type <code>az group delete --name</code> then copy and paste the resource group name from here. Type “y”.</p>
<p>While that’s getting deleted, I should mention that there are many ways to deploy a web app. For example, both Visual Studio and Visual Studio Code can publish an app directly to Azure App Service without you needing to use the Azure portal or the command line. Once the app is deployed, though, you’ll need to use the portal or the CLI to manage it.</p>
<p>And that’s it for using the CLI.</p>
<h1 id="Service-Categories"><a href="#Service-Categories" class="headerlink" title="Service Categories"></a>Service Categories</h1><p>So far, I’ve only talked about compute, storage, and networking services, but Microsoft offers services in many other categories as well. I won’t talk about all of the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">Azure services</a> available, but I’ll go over some of the highlights.</p>
<p>If your organization is just getting started with Azure, then one of the first things you’ll want to do is figure out how you can migrate at least some of your existing applications to Azure. Microsoft provides a great tool for this called Azure Migrate.</p>
<p>First, it discovers your on-premises servers, both physical and virtual. On the virtual side, this includes both Hyper-V and VMware. Then it assesses these machines. For each one, it tells you whether or not it’s ready to migrate, how big the Azure VM will be, how much it will cost, and any dependent servers that will also need to be migrated. When you’re ready, it will even help you do the migration. Azure Migrate is also integrated with other tools to help you migrate SQL Server databases, web apps, and data. Also, if you have a virtual desktop infrastructure, there’s a tool that will do an assessment to help you migrate it to Windows Virtual Desktop, which is hosted on Azure.</p>
<p>Another question that always comes up is, “How do we integrate our on-premises identities with Azure?” In most cases, organizations are using Active Directory for identity management. Naturally, Microsoft has a good solution for these customers. And, not surprisingly, it’s called Azure Active Directory. This is a managed identity service that takes care of authentication. It’s not exactly the same as Active Directory, but it’s very similar, and there are many options for synchronizing your on-premises directory with your Azure directory.</p>
<p>Let’s move on to the development area. The DevOps approach has spread rapidly in organizations around the world. If you’re not familiar with it, the idea is that you can automate large portions of the building, testing, and releasing of application updates. Microsoft offers a suite of services called Azure DevOps to help you implement these processes. The most important service in this suite is called Azure Pipelines. It lets you create automated workflows to continuously build, test, and deploy code.</p>
<p>Another service that helps with the development process is Azure DevTest Labs, which makes it easy to spin up non-production environments. You could do this in other ways, but DevTest Labs gives you some extra capabilities, such as allowing administrators to control costs by setting limits on how many VMs can be deployed at once and ensuring that VMs are shut down when they’re not in use.</p>
<p>One really helpful service for speeding up the responsiveness of your applications is Azure Content Delivery Network, which lets you take advantage of Microsoft’s extensive global network. It caches your most frequently accessed content in locations around the world so your end-users will retrieve it from the closest point on the network. This really helps with making your web applications feel more like local applications.</p>
<p>Although there are billions of computers connected to the internet, they’re dwarfed by the number of other devices connected to the internet, such as smart thermostats or power meters. This is often referred to as the Internet of Things or IoT.</p>
<p>Microsoft offers a suite of services to help organizations connect, monitor, and control IoT devices. The simplest way to get started is to use Azure IoT Central, which is a fully managed SaaS solution that takes care of the technical details for you. It lets you create IoT applications without writing any code.</p>
<p>If you need something more customized, then you can integrate your applications with Azure IoT Hub. It’s a service that handles secure communications with thousands, or even millions, of IoT devices. In fact, it’s the service that IoT Central uses behind the scenes.</p>
<p>Microsoft also offers a solution called Azure Sphere to make your IoT devices more secure. It includes certified chips, the Azure Sphere operating system, and the Azure Sphere Security Service, all of which provide layers of protection for your IoT devices.</p>
<p>When you have a large volume of data coming in, whether it’s from IoT devices or applications, you’ll probably want to perform analytics on it. Microsoft’s analytics offerings have evolved over time, which is why you’ll see a variety of services in this area.</p>
<p>The oldest one is HDInsight. It supports a wide variety of open-source big data frameworks, including Hadoop, Spark, Hive, Storm, and many others. Azure Databricks is a similar service because it runs Spark as well, but it’s more user-friendly and easier to manage than HDInsight. Azure Synapse Analytics is the new version of Azure SQL Data Warehouse. It includes all of the old data warehouse functionality, but it also supports Spark analytics. Have you noticed a common theme? Apache Spark seems to be the king of big data analytics, and it’s just a question of which service you want to use to run it.</p>
<p>A more sophisticated type of analytics is artificial intelligence. You’ve probably heard about the amazing advances in AI that have enabled computers to do everything from language translation to facial recognition to beating humans at games like chess and Go.</p>
<p>Even though AI seems like it must be incredibly complex, the basic idea is fairly simple. The most common method is called machine learning. The way it works is you feed lots of real-world data into a program and the program tries to make generalizations about the data. This is known as training a model. It then uses these generalizations to make predictions when it’s given new data. For example, it can analyze the viewing habits of millions of Netflix customers and make generalizations about the kinds of movies that different types of people like to watch. Then it can look at movies you’ve watched in the past and predict which movie you’d like to watch now. That’s how Netflix makes its recommendations.</p>
<p>Microsoft offers lots of different AI services. If you’re new to AI, then the best place to start is Azure Cognitive Services. This is a collection of pre-built artificial intelligence tools. These services let you add AI capabilities to applications even if you don’t know anything about machine learning.</p>
<p>They’re grouped into five categories: decision, language, speech, vision, and web search. For example, the vision category includes the Computer Vision API, which can classify images, and the Face API, which can detect faces in images.</p>
<p>A related offering is Azure Bot Service, which gives you the tools to create a chatbot. This is an intelligent agent that can answer questions. For example, you could create a chatbot to handle simple support requests from customers.</p>
<p>If you have some basic knowledge of machine learning, then you might want to try Azure Machine Learning Studio. It lets you train and deploy machine learning models without any coding, using a drag-and-drop interface. I highly recommend it for learning the basics of machine learning.</p>
<p>A much more sophisticated option is Azure Machine Learning Services, which gives you full control over every stage of the machine learning process. You can use any Python-based machine learning framework, such as TensorFlow or PyTorch, train models using services such as Azure Databricks, and deploy models using services such as Azure Kubernetes Service. Azure Machine Learning Services is usually the best solution when you need to build your own custom artificial intelligence application.</p>
<p>The last category I’ll mention is integration tools. Since we use so many applications and services, it would be nice to be able to perform certain tasks on them automatically. For example, suppose you have an Azure blob container that your customer uploads documents to, and you’d like to be notified by email as soon as one arrives so that you can respond to it as quickly as possible. Microsoft offers a service called Azure Logic Apps that lets you automate this sort of task without writing any code. You can create a logic app using a drag-and-drop interface. </p>
<p>In this example, the logic app would be able to detect events that occur in Blob storage, but in most cases, you’d need to use another service called Azure Event Grid to notify your logic app of particular events. For example, if you want to get an email every time a virtual machine is created in a subscription, then you would configure Event Grid to send a message to your logic app whenever this occurs.</p>
<p>These examples are actually pretty trivial. Azure Logic Apps can be used to build complex workflows involving not only Azure services but also third-party services, such as Twitter and Dropbox.</p>
<p>I’ve covered some of the most important Azure services, but there are many more that I didn’t cover. So if you have a need that doesn’t seem to fit with any of these services, there are plenty of other options. First, you can look through Microsoft’s Azure Products page. Another way is to select all services from the main menu in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-portal/">Azure Portal</a> and then search for what you need. If you still can’t find what you’re looking for, then you can search the Azure Marketplace from the search bar at the top of the portal. The Marketplace includes a wide variety of third-party solutions that work with Azure, such as Docker Enterprise or Barracuda Firewall.</p>
<p>Okay, that’s it for my services overview.</p>
<h1 id="Designing-a-Solution"><a href="#Designing-a-Solution" class="headerlink" title="Designing a Solution"></a>Designing a Solution</h1><p>Now that we have a good idea of what <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">services are available in Azure</a>, let’s see how we can put them together to create a more complex solution. One of the best ways to get started is to look at the examples in the Azure Architecture Center. If you click on reference architectures, you’ll see some recommended architectures for particular types of solutions. You can also check out these example workloads for specific business and technical challenges. I’m going to walk you through this e-commerce example.</p>
<p>The scenario in this example is that we need to build an Azure-based solution for customers who want to buy concert tickets. The diagram they use is a bit confusing, so we’ll use our own. </p>
<p>The first service we need to use is Azure App Service because it’s the easiest way to host a web app. To buy concert tickets, our customers will connect to our website, which will be hosted on Azure App Service.</p>
<p>The website won’t be able to do very much, though, until we add more services. For example, it would be pretty difficult to have a continually updated list of concerts without using a database. We could connect our website to a variety of databases, such as MySQL or Cosmos DB. But the most obvious choice is to use Azure SQL database. We can store concert information there and then have a list of upcoming concerts appear on the website.</p>
<p>If we’re going to have a lot of concerts to choose from, then we should also allow customers to search for specific concerts. Azure Cognitive Search is a good choice for that. It indexes your content so it can provide quick responses to search queries.</p>
<p>Next, we’ll want to give customers the ability to purchase tickets. This example solution for Microsoft doesn’t include the actual payment handling part of the transaction, but it does include a couple of the important pieces. First, we’ll want to give customers the option to create an account so they don’t have to re-enter their information every time they use our app to purchase tickets. The good solution is to use Azure Active Directory, B2C. The B2C stands for business to consumer. It provides everything you need to handle authentication for people outside of your organization.</p>
<p>When we receive custom orders, we should put them in a queue. Then we can have a separate component that pulls orders from the queue and processes them. This is one of the best ways to pass data from one component to another because it makes applications more reliable and scalable. Even if a component goes down, the data will be buffered in the queue until that component comes back up. Microsoft has a special type of storage to handle this need, and it’s called, not surprisingly, Queue Storage. It scales up and down as needed.</p>
<p>To retrieve orders from the queue and process them, we can use an Azure Function. The function will be triggered automatically whenever a new item is added to the queue. The function then creates a printable concert ticket for the customer. When it’s done, it stores the ticket in Blob Storage, which is the perfect place for image files. The ticket will then be sent to the customer, although that’s not shown in this example app.</p>
<p>Okay, now we have a complete solution (other than the couple of missing pieces that I mentioned), but we can add more functionality to our app. Another feature we can add is to allow people to post a review after they’ve seen a concert.</p>
<p>This can be handled in a similar way to the order processing feature. We’ll add new concert reviews to another queue and have an Azure Function that retrieves those concert reviews from the queue. And then it will store the reviews in SQL Database so they can be displayed on the website.</p>
<p>All right, now we have all the functionality we need, but we can add some more services to make our app better.</p>
<p>First, we can add Azure Cache for Redis and use it to cache concert information. This will make searches faster when customers are looking for concerts.</p>
<p>Another important way to make our app faster is to use the Azure Content Delivery Network. It’ll cache our website static files, so they’ll come up faster when customers access our site. </p>
<p>Yet another way to improve responsiveness is to use a service called Azure Traffic Manager. If we create multiple copies of our web app and host them in different regions around the world, then we can configure traffic manager to serve each customer from the web app instance that’s closest to the customer on the internet. So now not only do they get the static website files from the closest point on the content delivery network, but they also interact with the web app using the nearest instance.</p>
<p>To ensure that our app is functioning properly, we can use the application insight service. It takes care of monitoring the app and alerting us if there are issues. It also provides us with analytics to help diagnose issues and to understand how users are interacting with our app.</p>
<p>Finally, if we want to automatically classify concert reviews as positive or negative, we can use the Text Analytics component of cognitive services. We’ll have an Azure Function that runs a sentiment analysis on each concert review and then updates the concert review in the database to show whether it’s positive or negative.</p>
<p>That’s a lot of services for one application. So how much will everything cost? Thankfully, Microsoft provides sample pricing on the solution example page. It even has options for small, medium, and large implementations, depending on how much customer traffic we think we’ll get. Let’s try the medium option, which can handle up to 100,000 users per month.</p>
<p>This brings up the pricing calculator, which is a really handy feature for estimating the price of nearly any Azure service. I’m going to click the “Collapse all button” so we can see a summary of all the costs. The total is up here. It’s around $900 per month for everything.</p>
<p>If you look through the breakdown of the price, you might be surprised to see that app service is not the number one cost on this list. Considering that it hosts the core application, it seems like it should have the highest cost. But actually Azure Active Directory, B2C, and Azure Cognitive Search are higher. That’s a bit misleading, though, because this pricing example only includes app service hosting in one region. If we want to host the app in multiple regions and use traffic manager to make it more responsive for users around the world, then we’ll pay at least this much for each region, which would easily make app service the most expensive component.</p>
<p>And that’s it for designing a solution.</p>
<h1 id="Managing-Services"><a href="#Managing-Services" class="headerlink" title="Managing Services"></a>Managing Services</h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/designing-solution/">Building a solution</a> is one thing, but making sure it continues to run properly and cost-efficiently is another. And, of course, you also need to make sure everything is secure and compliant. Fortunately, Microsoft has lots of services to help you with these tasks, too.</p>
<p>Azure Monitor is your one-stop shop for keeping track of what’s happening with your Azure resources. It’s a collection of a variety of monitoring tools. Remember when I mentioned Application Insights in the last lesson? That’s actually just one component of Azure Monitor. Another is Log Analytics, which lets you run complex queries on multiple logs collected from your Azure resources.</p>
<p>But the core features of Azure Monitor are metrics and alerts. Metrics are basically statistics on various aspects of your resources, such as CPU usage on virtual machines and space used on Blob Storage. Azure Monitor creates graphs showing how these metrics have changed over time. It can also watch critical metrics you specify and send you an alert if there’s a problem. For example, it could text you if a database is overwhelmed by a sudden spike in activity.</p>
<p>Microsoft also provides a dashboard called Service Health where you can find out about problems with the Azure platform itself as well as upcoming maintenance events. You can even create alerts so you’ll be notified of both planned and unplanned outages.</p>
<p>Speaking of outages, it’s always a good idea to have backups of your critical resources to help recover from service failures. Most Azure services, such as Cosmos DB, have their own built-in backup capabilities. Azure VMs are a little different because you back them up using a service called Azure Backup. Surprisingly, you can even use this service to back up your on-premises systems.</p>
<p>Even if you’re doing a good job of maintaining your Azure systems, you might still be able to make some improvements. Microsoft provides a very helpful service called Azure Advisor that will not only suggest ways to improve the performance and availability of your applications, but it will even suggest ways to reduce your costs. For example, if it finds underutilized virtual machines, it will recommend that you use smaller (and less expensive) VMs to perform the same tasks.</p>
<p>Azure Advisor also provides security recommendations. It actually gets these recommendations from an important service called Microsoft Defender for Cloud, which was formerly known as Azure Security Center. So if you want to get more details, that’s the place to go. It’s a dashboard that gathers security information from resources across your subscriptions and assesses your vulnerabilities.</p>
<p>First, it shows you your secure score, which is an assessment of how secure your Azure resources are. You can click on it to see a list of recommendations to improve the security of your compute, storage, networking, and identity resources. Each recommendation shows you how much your secure score would be improved if you were to implement the recommendation. You don’t have to implement these recommendations, but it’s usually a good idea.</p>
<p>Then it shows you how well the resources in your Azure subscriptions meet regulatory compliance standards. By default, it will measure your compliance with a set of policies called the Azure Security Benchmark. You can customize these default policies if you want, or you can create your own custom policies from scratch in a service called, naturally, Azure Policy. For example, you could create a policy saying that all storage resources must reside in the European Union, and then if someone in your organization created a storage resource outside of the EU, it would show up in this compliance panel. You can also add other regulatory compliance standards, such as ISO 27001.</p>
<p>Finally, the Workloads protection panel shows you how many security alerts you have. These are potential threats that were detected by Microsoft Threat Intelligence. You can click on it to see the actual alerts so you can address them.</p>
<p>Be aware that only secure score and its recommendations are free. To get the other features, you need to enable enhanced security. This’ll give you lots of additional features as well. One really important feature is the ability to add your on-premises environments to the set of resources that are protected. Another enhanced feature is called just-in-time VM access. This blocks access to a virtual machine until an administrator allows specific users or IP addresses to get in for a limited period of time.</p>
<p>So far in <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">this course</a>, I’ve only talked about creating Azure resources manually, but once you’re happy with a particular configuration for a resource, such as a virtual machine, you’ll probably want to create nearly identical resources in a more automated way. The solution is something called an ARM template. ARM is short for Azure Resource Manager.</p>
<p>First, you create an ARM template that specifies all of the configuration details for one or more resources. For example, suppose you create an ARM template for a specific VM configuration. Then, whenever you need to create a VM with those characteristics, you can just run a certain command using that template, and voila, it takes care of all of the details for you. The best part is that Microsoft makes it really easy to create an ARM template. All you have to do is go to an existing resource that has the configuration you want and select “Export template” from the menu.</p>
<p>An even more powerful tool is Azure Blueprints, which lets you automate the deployment of entire Azure environments. A blueprint is a collection of ARM templates plus a few other details, such as policies and user permissions. When a blueprint is assigned to a subscription, it not only automates the creation of an environment, but it also keeps a record of the deployment. This makes it a critical governance tool because it enables the tracking and auditing of deployments.</p>
<p>We’ve covered a lot of Azure management tools, and that’s not even all of them. You can rest assured that Microsoft has the services you need to manage your Azure infrastructure.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>I hope you enjoyed <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/course-introduction/">learning about Azure</a>. Let’s do a quick review of what you learned.</p>
<p>Azure is a collection of online services that organizations can use to build, host, and deliver applications, and it runs in Microsoft’s data centers around the world.</p>
<p>Azure’s primary compute offerings are virtual machines, App Service, Azure Kubernetes Service, and Azure Functions.</p>
<p>In the raw storage area, Microsoft provides Blob storage for unstructured objects, File Storage for traditional file sharing, and Data Lake Storage Gen2 for Hadoop-compatible data analytics.</p>
<p>Azure’s relational database offerings are SQL Database, which is similar to SQL Server, and Azure Database for MySQL, MariaDB, and PostgreSQL for people who need those particular open source alternatives.</p>
<p>Microsoft’s main NoSQL offering is Cosmos DB. Another NoSQL service is Azure Cache for Redis, which is typically used to speed up applications by caching frequently requested data. </p>
<p>Azure’s equivalent of an on-premises network is a virtual network, or Vnet. You can connect VNets together using VNet peering. To create a secure connection between a VNet and an on-premises network, you can either use a VPN, which stands for Virtual Private Network, or Azure ExpressRoute, which is a dedicated, private connection.</p>
<p>Azure Migrate will help you move applications from your on-premises environment to Azure.</p>
<p>Azure Active Directory is a managed identity service that takes care of authentication and integrates with on-premises Active Directory servers.</p>
<p>Azure DevOps can help you automate large portions of the building, testing, and releasing of application updates. Azure DevTest Labs makes it easy to spin up non-production environments.</p>
<p>Azure Content Delivery Network caches your most frequently accessed content in locations around the world so your end-users will retrieve it from the closest point on the network.</p>
<p>Azure IoT Central lets you create Internet of Things applications without writing any code. If you need something more customized, then you can integrate your applications with Azure IoT Hub. Azure Sphere provides extra layers of protection for your IoT devices.</p>
<p>Some of Microsoft’s data analytics services include Azure Databricks, Azure Synapse Analytics, and HDInsight. All of these services can run Apache Spark.</p>
<p>Azure Cognitive Services is a collection of pre-built artificial intelligence tools. Azure Bot Service is a framework for creating chatbots. Azure Machine Learning Studio lets you train and deploy machine learning models without any coding. Azure Machine Learning Services is more sophisticated and gives you full control over every stage of the machine learning process. </p>
<p>Azure Logic Apps lets you automate integration tasks using a drag-and-drop interface.</p>
<p>Azure Monitor is a centralized place for keeping track of what’s happening with your Azure resources. Azure Security Center is a dashboard that gathers security information from your resources and assesses your vulnerabilities.</p>
<p>You can automate your deployments using Azure Resource Manager templates and Azure Blueprints.</p>
<p>You can access Azure using the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-portal/">Azure Portal</a>, the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-azure-services/using-azure-cli/">command-line interface</a>, PowerShell, the Azure Software Development Kit, or the Azure Mobile App. You can run CLI or PowerShell commands in a browser by using Cloud Shell in the Azure Portal.</p>
<p>When you sign up for an Azure account, Microsoft creates both a billing account and a subscription. A billing account can contain multiple subscriptions, each of which contains its own isolated set of resources. Within a subscription, each resource is part of a resource group.</p>
<p>Azure has many regions around the world, and each region contains multiple data centers. You can provide high availability by distributing virtual machines across availability zones, which are in separate data centers.</p>
<p>Whew! I think that’s by far the most times I’ve said the word Azure in one video. Okay, now I’m going to say it just a few more times.</p>
<p>To learn more about Azure, please look through our Azure Library. We have courses, labs, and practice exams on nearly every Azure topic, and we have more content coming out all the time.</p>
<p>Please give this course a rating, and if you have any questions or comments, please let us know. Thanks and have fun with Microsoft Azure!</p>
<h1 id="1Course-Introduction"><a href="#1Course-Introduction" class="headerlink" title="1Course Introduction"></a>1<strong>Course Introduction</strong></h1><p><a target="_blank" rel="noopener" href="https://github.com/cloudacademy/azure-overview">Course GitHub repo</a></p>
<h1 id="4Using-the-Azure-CLI"><a href="#4Using-the-Azure-CLI" class="headerlink" title="4Using the Azure CLI"></a>4<strong>Using the Azure CLI</strong></h1><p><a target="_blank" rel="noopener" href="https://github.com/cloudacademy/azure-overview">Course GitHub repo</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/74/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/74/">74</a><span class="page-number current">75</span><a class="page-number" href="/page/76/">76</a><span class="space">&hellip;</span><a class="page-number" href="/page/274/">274</a><a class="extend next" rel="next" href="/page/76/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
