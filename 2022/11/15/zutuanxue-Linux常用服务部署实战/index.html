<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="DHCP服务 阅读 (225935)   分享 一、DHCP介绍在LAN(局域网)中我们常会遇到以下的情况： 123451）不知道如何配置IP地址及相关信息的员工，无法上网；2）IP地址配置冲突，无法上网；3）来访用户因不熟悉公司网络情况无法上网；  以上这些情况都是日常最常见也是最无脑的工作，公司网络管理员需要不停的去帮忙去解决这些问题，以此来保障公司网络的正常使用及员工的正常用网需求。而这些工">
<meta property="og:type" content="article">
<meta property="og:title" content="zutuanxue-Linux常用服务部署实战">
<meta property="og:url" content="https://example.com/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="DHCP服务 阅读 (225935)   分享 一、DHCP介绍在LAN(局域网)中我们常会遇到以下的情况： 123451）不知道如何配置IP地址及相关信息的员工，无法上网；2）IP地址配置冲突，无法上网；3）来访用户因不熟悉公司网络情况无法上网；  以上这些情况都是日常最常见也是最无脑的工作，公司网络管理员需要不停的去帮忙去解决这些问题，以此来保障公司网络的正常使用及员工的正常用网需求。而这些工">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602997688363.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998062358.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998078641.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998138816.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603525992068.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526014361.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526031950.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526050140.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526488594.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526515184.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526811897.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526828444.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526884300.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526915193.png">
<meta property="article:published_time" content="2022-11-15T16:19:39.000Z">
<meta property="article:modified_time" content="2022-11-15T19:16:58.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602997688363.png">

<link rel="canonical" href="https://example.com/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>zutuanxue-Linux常用服务部署实战 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          zutuanxue-Linux常用服务部署实战
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-11-15 12:19:39 / Modified: 15:16:58" itemprop="dateCreated datePublished" datetime="2022-11-15T12:19:39-04:00">2022-11-15</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/zutuanxue-Linux%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="DHCP服务"><a href="#DHCP服务" class="headerlink" title="DHCP服务"></a>DHCP服务</h1><p> 阅读 (225935) </p>
<p> 分享</p>
<h2 id="一、DHCP介绍"><a href="#一、DHCP介绍" class="headerlink" title="一、DHCP介绍"></a>一、DHCP介绍</h2><p>在LAN(局域网)中我们常会遇到以下的情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1）不知道如何配置IP地址及相关信息的员工，无法上网；</span><br><span class="line"></span><br><span class="line">2）IP地址配置冲突，无法上网；</span><br><span class="line"></span><br><span class="line">3）来访用户因不熟悉公司网络情况无法上网；</span><br></pre></td></tr></table></figure>

<p>以上这些情况都是日常最常见也是最无脑的工作，公司网络管理员需要不停的去帮忙去解决这些问题，以此来保障公司网络的正常使用及员工的正常用网需求。而这些工作对于网络管理员来说实在是太低级、太无脑、太繁琐了，会消耗网络管理员的大量工作时间，也会影响公司员工的工作效能。那么如何通过其他的方法让计算机就能直接解决了上述问题，从而解放网络管理员呢？DHCP就是一个不二的选择。</p>
<p>DHCP(Dynamic Host Configuration Protocol，动态主机配置协议),通常被应用在局域网络环境中，主要作用是集中的管理、分配IP地址，使网络环境中的主机动态的获得IP地址、Gateway地址、DNS服务器地址等信息，并能够提升地址的使用率。由于DHCP是一个UDP协议，所以运行起来更加高效。</p>
<p>DHCP协议采用客户端&#x2F;服务器模型(C&#x2F;S模型)，服务端可以为客户端提供IP、掩码、网关、主机名、DNS等信息。客户端只需将IP获得方式设置为自动获取即可。</p>
<p>目前可以提供DHCP服务的设备有很多，比如:</p>
<ul>
<li>DHCP服务器(windows server、linux)</li>
<li>硬件路由器</li>
<li>家用宽带路由</li>
</ul>
<h2 id="二、DHCP应用场景"><a href="#二、DHCP应用场景" class="headerlink" title="二、DHCP应用场景"></a>二、DHCP应用场景</h2><p>1）公司局域网环境</p>
<p>2）家庭局域网环境</p>
<p>3）公共场合的wifi环境</p>
<p>4）宽带环境网络</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用DHCP的优点：</span><br><span class="line"></span><br><span class="line">1）傻瓜式接入：用户只需懂得插网线到电脑，或者输入WiFi密码接入网络即可实现联网</span><br><span class="line"></span><br><span class="line">2）IP高效利用：及时回收IP机制，保证IP的高利用性，特别是对IP不足的网络</span><br><span class="line"></span><br><span class="line">3）避免IP冲突：避免IP冲突，保证网络的高效利用，保证公司员工及临时人员高效工作</span><br><span class="line"></span><br><span class="line">4）降低了公司网络管理员的工作量，提升了工作效率</span><br></pre></td></tr></table></figure>

<h2 id="三、DHCP工作原理"><a href="#三、DHCP工作原理" class="headerlink" title="三、DHCP工作原理"></a>三、DHCP工作原理</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602997688363.png" alt="image20200113193556339.png"></p>
<h3 id="3-1）工作方式"><a href="#3-1）工作方式" class="headerlink" title="3.1）工作方式"></a>3.1）工作方式</h3><p>IP获得需要通过发广播来实现客户端和服务器的通信，所以DHCP只能工作在局域网。</p>
<h3 id="3-2）工作原理解析"><a href="#3-2）工作原理解析" class="headerlink" title="3.2）工作原理解析"></a>3.2）工作原理解析</h3><p>1、Client：向网络中发送广播，通过自己的UDP协议的68号端口向网络中发送DHCP Discover包，用来寻找网络中的DHCP Server.类似于你在你的公司大喊一声:”谁是公司老板”一样的道理。</p>
<p>2、Server：局域网中的所有DHCP服务器都能收到该Client发送的广播包，然后DHCP Server会检查自己的IP池中(也叫做作用域)是否还有可用IP可以分发。如果有的话，会直接将这个IP地址从池中拿出来，避免在发给别的客户端，并且通过自己的UDP协议的67号端口给Client发一个响应包DHCP Offer,同样通信是采用广播的方式，明确告诉其可以提供哪个IP给Client使用。类似于公司的几个老板都在公司喊了一声：“我是X老板，我有时间在哪个办公室接待你”。</p>
<p>3、Client：Client会收到局域网中的所有DHCP服务器发给自己的DHCP Offer包，默认选一个最优的DHCP Server进行IP获取（在这里就是第一个发送给他DHCP Offer的服务器算作最优）。然后继续向网络中通过UDP的68号端口发广播DHCP Resquest，明确指定DHCP Server IP地址和需要租用的IP地址,告诉它要从他这里获得IP信息。自然其他DHCP Server也能收到广播，确认不从自己这里拿IP信息后，会将上步从IP池中拿出来的IP在释放到池中，以便别人使用。类似于你在公司大喊一声：“李老板，我找你接待”，那么其他老板刚才计划接待你的时间就会被释放出来，用于接待别的客户。</p>
<p>4、Server：被确认的DHCP Server就会通过其UDP协议的67号端口发送DHCP ACK确认包，采用广播将IP、掩码、网关、DNS等信息还有IP租约一起发送给DHCP Client，Client确认IP可用后，根据IP租约开始计算使用时间。类似于李老板把你请进他的办公室，开始和你聊天，并计算聊天时间为30分钟，开始倒计时。</p>
<h3 id="3-3-计算机获得IP的时间点"><a href="#3-3-计算机获得IP的时间点" class="headerlink" title="3.3)计算机获得IP的时间点"></a>3.3)计算机获得IP的时间点</h3><p>a、计算机开机</p>
<p>b、网卡接通网络</p>
<p>c、重启网卡服务</p>
<h3 id="3-4）租约更新阶段"><a href="#3-4）租约更新阶段" class="headerlink" title="3.4）租约更新阶段"></a>3.4）租约更新阶段</h3><p>a、租约完成1&#x2F;2</p>
<p>b、租约完成7&#x2F;8</p>
<p>c、租约到期</p>
<h2 id="四、DHCP服务器部署"><a href="#四、DHCP服务器部署" class="headerlink" title="四、DHCP服务器部署"></a>四、DHCP服务器部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，计算机名称:localhost.localdomain,IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<h3 id="4-1）DHCP安装"><a href="#4-1）DHCP安装" class="headerlink" title="4.1）DHCP安装"></a>4.1）DHCP安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf -y install dhcp-server</span><br></pre></td></tr></table></figure>

<h3 id="4-2）DHCP配置文件详解"><a href="#4-2）DHCP配置文件详解" class="headerlink" title="4.2）DHCP配置文件详解"></a>4.2）DHCP配置文件详解</h3><p>默认情况下，dhcp服务并没有提供配置文件，只是给提供了一个demo,存放在&#x2F;usr&#x2F;share&#x2F;doc&#x2F;dhcp-server&#x2F;目录下.我们将demo文件拷贝到&#x2F;etc&#x2F;dhcp目录下，并且命名为dhcpd.conf。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cp /usr/share/doc/dhcp-server/dhcpd.conf.example /etc/dhcp/dhcpd.conf </span><br><span class="line">cp：是否覆盖&quot;/etc/dhcp/dhcpd.conf&quot; y</span><br></pre></td></tr></table></figure>

<p>配置文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line"># #号代表注释</span><br><span class="line"># DHCP服务配置文件分为全局配置和作用域配置，很好区分：subnet的就是作用域 不在subnet里面的就是全局设置。</span><br><span class="line"># dhcpd.conf</span><br><span class="line">#</span><br><span class="line"># Sample configuration file for ISC dhcpd</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">#DNS全局选项，指定DNS服务器的地址，可以是IP，也可以是域名。</span><br><span class="line"># option definitions common to all supported networks...</span><br><span class="line"># DNS的域名</span><br><span class="line">option domain-name &quot;example.org&quot;;</span><br><span class="line"></span><br><span class="line">#具体的DNS服务器</span><br><span class="line">option domain-name-servers ns1.example.org, ns2.example.org;</span><br><span class="line"></span><br><span class="line">#默认租约为600s</span><br><span class="line">default-lease-time 600;</span><br><span class="line">#最大租约为7200s，客户机会在default-lease-time快到期时向服务器续租，如果此时客户机死机/重启，而默认租约时间到期了，服务器并不会立即回收IP地址，而是等到最大租约时间到期，客户机还没有过来续约，才会回收IP地址。</span><br><span class="line">max-lease-time 7200;</span><br><span class="line"></span><br><span class="line">#动态DNS更新方式(none:不支持；interim:互动更新模式；ad-hoc:特殊更新模式)</span><br><span class="line"># Use this to enble / disable dynamic dns updates globally.</span><br><span class="line">#ddns-update-style none;</span><br><span class="line"></span><br><span class="line">#如果该DHCP服务器是本地官方DHCP就将此选项打开，避免其他DHCP服务器的干扰。</span><br><span class="line">#当一个客户端试图获得一个不是该DHCP服务器分配的IP信息，DHCP将发送一个拒绝消息，而不会等待请求超时。当请求被拒绝，客户端会重新向当前DHCP发送IP请求获得新地址。保证IP是自己发出去的</span><br><span class="line">#</span><br><span class="line"># If this DHCP server is the official DHCP server for the local</span><br><span class="line"># network, the authoritative directive should be uncommented.</span><br><span class="line">#authoritative;</span><br><span class="line"></span><br><span class="line"># Use this to send dhcp log messages to a different log file (you also</span><br><span class="line"># have to hack syslog.conf to complete the redirection).</span><br><span class="line"># 日志级别</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line"># No service will be given on this subnet, but declaring it helps the </span><br><span class="line"># DHCP server to understand the network topology.</span><br><span class="line"></span><br><span class="line">#作用域相关设置指令</span><br><span class="line">#subnet 定义一个作用域</span><br><span class="line">#netmask 定义作用域的掩码</span><br><span class="line">#range 允许发放的IP范围</span><br><span class="line">#option routers 指定网关地址</span><br><span class="line">#option domain-name-servers 指定DNS服务器地址</span><br><span class="line">#option broadcast-address 广播地址</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#案例:定义一个作用域 网段为10.152.187.0 掩码为255.255.255.0</span><br><span class="line">#此作用域不提供任何服务</span><br><span class="line">subnet 10.152.187.0 netmask 255.255.255.0 &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># This is a very basic subnet declaration.</span><br><span class="line"></span><br><span class="line">#案例:定义一个基本的作用域</span><br><span class="line">#网段10.254.239.0 掩码255.255.255.224</span><br><span class="line">#分发范围10.254.239.10-20</span><br><span class="line">#网关为rtr-239-0-1.example.org, rtr-239-0-2.example.org</span><br><span class="line">subnet 10.254.239.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.254.239.10 10.254.239.20;</span><br><span class="line">  option routers rtr-239-0-1.example.org, rtr-239-0-2.example.org;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># This declaration allows BOOTP clients to get dynamic addresses,</span><br><span class="line"># which we don&#x27;t really recommend.</span><br><span class="line">#案例:允许采用bootp协议的客户端动态获得地址</span><br><span class="line">#bootp DHCP的前身</span><br><span class="line">#BOOTP用于无盘工作站的局域网中，可以让无盘工作站从一个中心服务器上获得IP地址。通过BOOTP协议可以为局域网中的无盘工作站分配动态IP地址，</span><br><span class="line">#这样就不需要管理员去为每个用户去设置静态IP地址。</span><br><span class="line">subnet 10.254.239.32 netmask 255.255.255.224 &#123;</span><br><span class="line">  range dynamic-bootp 10.254.239.40 10.254.239.60;</span><br><span class="line">  option broadcast-address 10.254.239.31;</span><br><span class="line">  option routers rtr-239-32-1.example.org;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#案例:一个简单的作用域案例</span><br><span class="line"># A slightly different configuration for an internal subnet.</span><br><span class="line">subnet 10.5.5.0 netmask 255.255.255.224 &#123;</span><br><span class="line">  range 10.5.5.26 10.5.5.30;</span><br><span class="line">  option domain-name-servers ns1.internal.example.org;</span><br><span class="line">  option domain-name &quot;internal.example.org&quot;;</span><br><span class="line">  option routers 10.5.5.1;</span><br><span class="line">  option broadcast-address 10.5.5.31;</span><br><span class="line">  default-lease-time 600;</span><br><span class="line">  max-lease-time 7200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Hosts which require special configuration options can be listed in</span><br><span class="line"># host statements.   If no address is specified, the address will be</span><br><span class="line"># allocated dynamically (if possible), but the host-specific information</span><br><span class="line"># will still come from the host declaration.</span><br><span class="line">#</span><br><span class="line">#保留地址:可以将指定的IP分发给指定的机器，根据网卡的MAC地址来做触发</span><br><span class="line">#host: 启用保留。</span><br><span class="line">#hardware:指定客户端的mac地址</span><br><span class="line">#filename:指定文件名</span><br><span class="line">#server-name:指定下一跳服务器地址</span><br><span class="line">#fixed-address: 指定保留IP地址</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">#案例:这个案例中分发给客户端的不是IP地址信息，而是告诉客户端去找toccata.fugue.com服务器，并且下载vmunix.passacaglia文件</span><br><span class="line">host passacaglia &#123;</span><br><span class="line">  hardware ethernet 0:0:c0:5d:bd:95;</span><br><span class="line">  filename &quot;vmunix.passacaglia&quot;;</span><br><span class="line">  server-name &quot;toccata.fugue.com&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Fixed IP addresses can also be specified for hosts.   These addresses</span><br><span class="line"># should not also be listed as being available for dynamic assignment.</span><br><span class="line"># Hosts for which fixed IP addresses have been specified can boot using</span><br><span class="line"># BOOTP or DHCP.   Hosts for which no fixed address is specified can only</span><br><span class="line"># be booted with DHCP, unless there is an address range on the subnet</span><br><span class="line"># to which a BOOTP client is connected which has the dynamic-bootp flag</span><br><span class="line"># set.</span><br><span class="line"># 案例:保留地址，将指定IP(fantasia.fugue.com对应的IP)分给指定客户端网卡(MAC:08:00:07:26:c0:a5)</span><br><span class="line">host fantasia &#123;</span><br><span class="line">  hardware ethernet 08:00:07:26:c0:a5;</span><br><span class="line">  fixed-address fantasia.fugue.com;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#超级作用域</span><br><span class="line">#超级作用域是DHCP服务中的一种管理功能，使用超级作用域，可以将多个作用域组合为单个管理实体。</span><br><span class="line"># You can declare a class of clients and then do address allocation</span><br><span class="line"># based on that.   The example below shows a case where all clients</span><br><span class="line"># in a certain class get addresses on the 10.17.224/24 subnet, and all</span><br><span class="line"># other clients get addresses on the 10.0.29/24 subnet.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#在局域网中，可以配置策略根据各个机器的具体信息分配IP地址和其他的网络参数，客户机的具体信息：客户机能够给dhcp服务提供的信息由有两个，</span><br><span class="line">#第一个就是网卡的dhcp-client-identifier（mac地址），</span><br><span class="line">#第二个就是设备的vendor-class-identifier。</span><br><span class="line">#管理员可以根据这两个信息给不同的机器分组。</span><br><span class="line"></span><br><span class="line">#案例:</span><br><span class="line">#按client某种类型分组DHCP,而不是按物理接口网段</span><br><span class="line">#例子: SUNW 分配地址段10.17.224.0/24</span><br><span class="line"># 非SUNW的主机,分配地址段10.0.29.0/24</span><br><span class="line">#定义一个dhcp类:foo</span><br><span class="line">#request广播中vendor-class-identifier字段对应的值前四个字节如果是&quot;SUNW&quot;,则视合法客户端.</span><br><span class="line">class &quot;foo&quot; &#123;</span><br><span class="line">  match if substring (option vendor-class-identifier, 0, 4) = &quot;SUNW&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#定义一个超级作用域: 224-29</span><br><span class="line">shared-network 224-29 &#123;</span><br><span class="line">#定义第一个作用域</span><br><span class="line">  subnet 10.17.224.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-224.example.org;</span><br><span class="line">  &#125;</span><br><span class="line">#定义第二个作用域</span><br><span class="line">  subnet 10.0.29.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    option routers rtr-29.example.org;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">#关连池,如果客户端匹配foo类，将获得该池地址</span><br><span class="line">  pool &#123;</span><br><span class="line">    allow members of &quot;foo&quot;;</span><br><span class="line">    range 10.17.224.10 10.17.224.250;</span><br><span class="line">  &#125;</span><br><span class="line">#关连池,如果客户端配置foo类，则拒绝获得该段地址</span><br><span class="line">  pool &#123;</span><br><span class="line">    deny members of &quot;foo&quot;;</span><br><span class="line">    range 10.0.29.10 10.0.29.230;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3）DHCP启动"><a href="#4-3）DHCP启动" class="headerlink" title="4.3）DHCP启动"></a>4.3）DHCP启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# systemctl enable dhcpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/dhcpd.service to /usr/lib/systemd/system/dhcpd.service.</span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line"></span><br><span class="line">注意：可能发现无法启动DHCP服务，原因是DHCP在启动的时候检查配置文件，发现并没有有效作用域（和服务器同网段的作用域）。</span><br></pre></td></tr></table></figure>

<h2 id="五、DHCP作用域"><a href="#五、DHCP作用域" class="headerlink" title="五、DHCP作用域"></a>五、DHCP作用域</h2><p><strong>教学案例一、配置一个作用域，用于为本地局域网中的计算机发放IP信息。要求：</strong></p>
<p>本地网段:192.168.11.0&#x2F;24</p>
<p>发放IP地址：192.168.11.153–252</p>
<p>网关：192.168.11.254</p>
<p>DNS1：202.106.0.20</p>
<p>DNS2：114.114.114.114</p>
<p>默认租约为两个小时</p>
<p>最大租约为3个小时</p>
<p><strong>本DHCP服务器为本地权威DHCP，要求可以本地所有计算机获得IP都是由本DHCP发放</strong></p>
<h3 id="5-1-DHCP服务配置"><a href="#5-1-DHCP服务配置" class="headerlink" title="5.1)DHCP服务配置"></a>5.1)DHCP服务配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue dhcp]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">#声明DNS服务器</span><br><span class="line">default-lease-time 7200;  #定义默认租约时间</span><br><span class="line">max-lease-time 10800;		#定义最大租约时间</span><br><span class="line">authoritative;	#拒绝不正确的IP地址的要求</span><br><span class="line">log-facility local7;	#定义日志</span><br><span class="line"></span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 192.168.11.153 192.168.11.252;</span><br><span class="line">  option routers 192.168.11.254;</span><br><span class="line">  option broadcast-address 192.168.11.255;</span><br><span class="line">  default-lease-time 7200;</span><br><span class="line">  max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">请根据4.2中的讲解理解配置文件内容。</span><br></pre></td></tr></table></figure>

<h3 id="5-2）重启DHCP服务，生效配置"><a href="#5-2）重启DHCP服务，生效配置" class="headerlink" title="5.2）重启DHCP服务，生效配置"></a>5.2）重启DHCP服务，生效配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#重启dhcpd服务</span><br><span class="line">[root@zutuanxue dhcp]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">#查看启动情况，同时也验证了客户端使用的是68端口，服务端使用的是67端口</span><br><span class="line">[root@zutuanxue dhcp]# lsof -i :68</span><br><span class="line">COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dhclient 55234 root    6u  IPv4 110700      0t0  UDP *:bootpc </span><br><span class="line">[root@zutuanxue dhcp]# lsof -i :67</span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq  1507 nobody    3u  IPv4  27149      0t0  UDP *:bootps </span><br><span class="line">dhcpd   56570  dhcpd    7u  IPv4 129157      0t0  UDP *:bootps</span><br></pre></td></tr></table></figure>

<h3 id="5-3）测试IP分发"><a href="#5-3）测试IP分发" class="headerlink" title="5.3）测试IP分发"></a>5.3）测试IP分发</h3><p>打开一个客户端机器，IP获得方式为自动获取，测试是否获得到了自己这个DHCP服务器发放的IP地址。本例子中测试机使用了centos 8系统。来看下测试结果吧！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">1) 查看一下当前eth0的IP地址、MAC地址，并保证其IP获得方式为:DHCP</span><br><span class="line">[root@test 桌面]# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:172.16.44.132  Bcast:172.16.44.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:86 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:63 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:15294 (14.9 KiB)  TX bytes:6769 (6.6 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）使用dhclient命令来获得IP，看一下重要输出</span><br><span class="line">[root@test 桌面]# dhclient -d eth0</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 6 (xid=0x316768c3)      发广播寻找DHCP服务器</span><br><span class="line">DHCPOFFER from 192.168.11.16                                                     192.168.11.16DHCP服务器应答</span><br><span class="line">DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x316768c3)                  client向服务器请求IP地址</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x316768c3)                                      确认租赁关系</span><br><span class="line">bound to 192.168.11.156 -- renewal in 2983 seconds.                              client分得IP:192.168.11.156</span><br><span class="line"></span><br><span class="line">注意：看到这些信息后，按CTRL+C退出。</span><br><span class="line">dhclient是一个DHCP协议客户端，它使用DHCP协议或者BOOTP协议或在这两个协议都不可用时使用静态地址来配置一个或多个网络接口</span><br><span class="line">dhclient -r 释放IP地址</span><br><span class="line">dhclient -d 强制dhclient作为前台进程运行。 通常情况下，DHCP客户端将在前台运行,直到配置了一个接口,此时它将恢复为在后</span><br><span class="line">            台运行。               </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3) 服务器日志查看验证获取信息</span><br><span class="line">[root@zutuanxue ~]# tailf /var/log/messages</span><br><span class="line">Feb 21 13:40:44 baism dhcpd: DHCPDISCOVER from 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPOFFER on 192.168.11.156 to 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPREQUEST for 192.168.11.156 (192.168.11.16) from 00:0c:29:1a:f8:bd via ens33</span><br><span class="line">Feb 21 13:40:45 baism dhcpd: DHCPACK on 192.168.11.156 to 00:0c:29:1a:f8:bd via ens33</span><br><span class="line"></span><br><span class="line">4) 在client上通过ifconfig命令再次查看eth0 IP地址，验证是否为192.168.11.156</span><br><span class="line">[root@test 桌面]# ifconfig eth0</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:192.168.11.156  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:97 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:67 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:17364 (16.9 KiB)  TX bytes:7537 (7.3 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5）查看网关，确定网关为192.168.11.254</span><br><span class="line">[root@test 桌面]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">192.168.11.0    0.0.0.0         255.255.255.0   U     0      0        0 eth1</span><br><span class="line">192.168.11.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0</span><br><span class="line">169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eth1</span><br><span class="line">0.0.0.0         192.168.11.254  0.0.0.0         UG    0      0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6）查看DNS配置文件，看DNS是否为DHCP服务器发放的DNS服务器IP</span><br><span class="line">[root@test 桌面]# cat /etc/resolv.conf </span><br><span class="line">; generated by /sbin/dhclient-script</span><br><span class="line">nameserver 202.106.0.20</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>

<h3 id="5-4）通过DHCP服务器租约文件查看具体租约"><a href="#5-4）通过DHCP服务器租约文件查看具体租约" class="headerlink" title="5.4）通过DHCP服务器租约文件查看具体租约"></a>5.4）通过DHCP服务器租约文件查看具体租约</h3><p>租约文件的路径: &#x2F;var&#x2F;lib&#x2F;dhcpd&#x2F;dhcpd.leases</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat /var/lib/dhcpd/dhcpd.leases</span><br><span class="line"># The format of this file is documented in the dhcpd.leases(5) manual page.</span><br><span class="line"># This lease file was written by isc-dhcp-4.3.6</span><br><span class="line"></span><br><span class="line"># authoring-byte-order entry is generated, DO NOT DELETE</span><br><span class="line">authoring-byte-order little-endian;</span><br><span class="line"></span><br><span class="line">server-duid &quot;\000\001\000\001%\257\376\022\000\014)c.\345&quot;;</span><br><span class="line"></span><br><span class="line">lease 192.168.11.153 &#123;</span><br><span class="line">  starts 2 2020/01/14 04:21:04;	#开始时间</span><br><span class="line">  ends 2 2020/01/14 06:21:04;		#结束时间</span><br><span class="line">  cltt 2 2020/01/14 04:21:04;</span><br><span class="line">  binding state active;</span><br><span class="line">  next binding state free;</span><br><span class="line">  rewind binding state free;</span><br><span class="line">  hardware ethernet 00:0c:29:6d:1c:b3;</span><br><span class="line">  uid &quot;\001\000\014)m\034\263&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：当你发现这里的时间和你的服务器时间不一致的时候，建议你修改时区解决问题，一般是差8个小时，大家明白就好。</span><br></pre></td></tr></table></figure>

<h3 id="5-5）保留IP"><a href="#5-5）保留IP" class="headerlink" title="5.5）保留IP"></a>5.5）保留IP</h3><p>在IP租约到期后，如果无法续订租约，client只能乖乖交出IP地址，重新获得一个其他IP使用。但是在公司有些服务器的IP地址是不能变化的，因为变了用户就无法连接到服务器了，比如公司文件服务器、打印服务器等等。那么在这种环境中我们既想使用DHCP管理公司IP，又想实现部分机器的IP永久不变，那么怎么实现呢。</p>
<p>DHCP的作者在写DHCP的时候也想到了这个问题，提出了保留IP的概念，就是将某些IP保留，然后服务器来获得IP的时候，根据其MAC地址做匹配，将对应的IP分给它即可。</p>
<p><strong>教学案例:希望这个MAC地址为00:0C:29:1A:F8:C7的网卡能永久获得IP 192.168.11.252，实现方式如下:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"> a、在配置文件/etc/dhcp/dhcpd.conf末尾添加以下内容</span><br><span class="line"> host print &#123;         </span><br><span class="line">  hardware ethernet 00:0C:29:1A:F8:C7;</span><br><span class="line">  fixed-address 192.168.11.252;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host print    host为指令，print是个名字，随便起，但是最好有意义，要不过一段你也记不住了。</span><br><span class="line">hardware ethernet 指定以太网网卡MAC地址</span><br><span class="line">fixed-address 指定要绑定的IP</span><br><span class="line"></span><br><span class="line">b、重启DHCP服务</span><br><span class="line">[root@zutuanxue ~]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">c、测试，登陆测试机，释放挡墙IP，重新获得新的IP，查看IP地址是否正确分发</span><br><span class="line">[root@test 桌面]# ifconfig eth1</span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.11.155  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4071 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:187 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:433880 (423.7 KiB)  TX bytes:16888 (16.4 KiB)</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# dhclient -r eth1</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# dhclient -d eth1</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth1 to 255.255.255.255 port 67 interval 4 (xid=0x45c162c2)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth1 to 255.255.255.255 port 67 (xid=0x45c162c2)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x45c162c2)</span><br><span class="line">bound to 192.168.11.252 -- renewal in 2881 seconds.</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">[root@test 桌面]# ifconfig eth1</span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.11.252  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4081 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:191 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:436337 (426.1 KiB)  TX bytes:17656 (17.2 KiB)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">完美！</span><br></pre></td></tr></table></figure>

<h2 id="六、DHCP超级作用域"><a href="#六、DHCP超级作用域" class="headerlink" title="六、DHCP超级作用域"></a>六、DHCP超级作用域</h2><p>体验了DHCP服务器给大家带来的方便后，我们工作轻松了很多，但是随着时间的推移，突然有这么一个问题急需你解决，由于公司的发展壮大，公司人员数量越来越多，公司一个网段的IP无法满足日常使用，所以又加了一个网段。但是默认情况下，DHCP服务器只能发放和自己网卡在同一网段的IP地址，目前我们DHCP的网卡IP地址为192.168.11.0段，我们新加的网段为192.168.12.0，那么怎么能让DHCP服务器既能发11网段，又能发放12网段呢？学会超级作用域就可以解决这个问题。</p>
<p>超级作用域：将两个或以上的不同网段的作用域合成一个作用域既是超级作用域。</p>
<p><strong>案例:部署一个超级作用域，作用域是192.168.11.0&#x2F;24网段，192.168.12.0&#x2F;24网段。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">a、编辑配置文件</span><br><span class="line">[root@zutuanxue ~]# cat /etc/dhcp/dhcpd.conf</span><br><span class="line">option domain-name-servers 4.2.2.2, 4.2.2.1;</span><br><span class="line"></span><br><span class="line">default-lease-time 28800;</span><br><span class="line">max-lease-time 43200;</span><br><span class="line">#authoritative;</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line">#share-network 部署一个超级作用域</span><br><span class="line">#supper 超级作用域名称，随便起，但是建议有意义。</span><br><span class="line">shared-network supper &#123;</span><br><span class="line">#192.168.11.0作用域</span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">range 192.168.11.150 192.168.11.150;</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">option routers 192.168.11.254;</span><br><span class="line">default-lease-time 7200;</span><br><span class="line">max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#192.168.12.0作用域</span><br><span class="line">subnet 192.168.12.0 netmask 255.255.255.0 &#123;</span><br><span class="line">range 192.168.12.150 192.168.12.150;</span><br><span class="line">option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">option routers 192.168.12.254;</span><br><span class="line">default-lease-time 7200;</span><br><span class="line">max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：案例中为了方便验证，我每个作用域只发布一个IP，否者测试无法保证能100%分到两个网段。</span><br><span class="line"></span><br><span class="line">b、重启DHCP服务，生效配置文件</span><br><span class="line">[root@zutuanxue dhcp]# systemctl restart dhcpd</span><br><span class="line"></span><br><span class="line">c、验证</span><br><span class="line">#释放两网卡IP</span><br><span class="line">[root@test 桌面]# dhclient -r eth0</span><br><span class="line">[root@test 桌面]# dhclient -r eth1</span><br><span class="line"></span><br><span class="line">#释放成功</span><br><span class="line">[root@test 桌面]# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:1591 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:162 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:282324 (275.7 KiB)  TX bytes:30619 (29.9 KiB)</span><br><span class="line"></span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4719 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:216 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:559954 (546.8 KiB)  TX bytes:19582 (19.1 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span class="line">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:720 (720.0 b)  TX bytes:720 (720.0 b)</span><br><span class="line"></span><br><span class="line">#分别获取IP地址 </span><br><span class="line">[root@test 桌面]# dhclient -d eth0</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   LPF/eth0/00:0c:29:1a:f8:bd</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 6 (xid=0x2574199a)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x2574199a)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x2574199a)</span><br><span class="line">bound to 192.168.11.150 -- renewal in 3026 seconds.</span><br><span class="line">^C</span><br><span class="line">#确保都是来自我们实验中的DHCP服务器</span><br><span class="line">[root@test 桌面]# dhclient -d eth1</span><br><span class="line">Internet Systems Consortium DHCP Client 4.1.1-P1</span><br><span class="line">Copyright 2004-2010 Internet Systems Consortium.</span><br><span class="line">All rights reserved.</span><br><span class="line">For info, please visit https://www.isc.org/software/dhcp/</span><br><span class="line"></span><br><span class="line">Listening on LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   LPF/eth1/00:0c:29:1a:f8:c7</span><br><span class="line">Sending on   Socket/fallback</span><br><span class="line">DHCPDISCOVER on eth1 to 255.255.255.255 port 67 interval 7 (xid=0x2cebde11)</span><br><span class="line">DHCPOFFER from 192.168.11.16</span><br><span class="line">DHCPREQUEST on eth1 to 255.255.255.255 port 67 (xid=0x2cebde11)</span><br><span class="line">DHCPACK from 192.168.11.16 (xid=0x2cebde11)</span><br><span class="line">bound to 192.168.12.150 -- renewal in 3102 seconds.</span><br><span class="line"></span><br><span class="line">#确保都是来自我们实验中的DHCP服务器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看IP情况，发现实验成功了，分别获得到了不同网段IP</span><br><span class="line">[root@test 桌面]# ifconfig</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:BD  </span><br><span class="line">          inet addr:192.168.11.150  Bcast:192.168.11.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8bd/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:1613 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:166 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:287076 (280.3 KiB)  TX bytes:31387 (30.6 KiB)</span><br><span class="line"></span><br><span class="line">eth1      Link encap:Ethernet  HWaddr 00:0C:29:1A:F8:C7  </span><br><span class="line">          inet addr:192.168.12.150  Bcast:192.168.12.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::20c:29ff:fe1a:f8c7/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:4741 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:220 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:564706 (551.4 KiB)  TX bytes:20350 (19.8 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span class="line">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:12 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:720 (720.0 b)  TX bytes:720 (720.0 b)</span><br></pre></td></tr></table></figure>

<h2 id="七、补充"><a href="#七、补充" class="headerlink" title="七、补充"></a>七、补充</h2><h3 id="7-1-如果客户端获得不到-IP会怎么办"><a href="#7-1-如果客户端获得不到-IP会怎么办" class="headerlink" title="7.1) 如果客户端获得不到 IP会怎么办"></a>7.1) 如果客户端获得不到 IP会怎么办</h3><p>当客户端获得不到IP地址，会得到一个169.254开头的临时IP，此IP不能和其他网段通信，但是Client会继续向网络中发DHCP广播，继续坚持不懈申请IP。</p>
<h3 id="7-2）DHCP会面临单机故障，如何解决"><a href="#7-2）DHCP会面临单机故障，如何解决" class="headerlink" title="7.2）DHCP会面临单机故障，如何解决"></a>7.2）DHCP会面临单机故障，如何解决</h3><p>两台设备互相分发对方网段一段IP，将作用域采用8&#x2F;2原则，彼此互相冗余，当一台服务器出现问题，不至于整个网段故障。</p>
<h3 id="7-3）抓包验证方法"><a href="#7-3）抓包验证方法" class="headerlink" title="7.3）抓包验证方法"></a>7.3）抓包验证方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue dhcp]# tcpdump -nn -vvv -s 1500 -i ens33 host 192.168.11.16 and udp port 67 or udp port 68</span><br></pre></td></tr></table></figure>

<h3 id="7-4）如何发放计算机名称"><a href="#7-4）如何发放计算机名称" class="headerlink" title="7.4）如何发放计算机名称"></a>7.4）如何发放计算机名称</h3><p>发放计算机名称只能在保留中完成，要求Client的计算机名配置文件中将对应字段删除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">option domain-name-servers 4.2.2.2, 4.2.2.1;</span><br><span class="line"></span><br><span class="line">default-lease-time 28800;</span><br><span class="line">max-lease-time 43200;</span><br><span class="line">authoritative;</span><br><span class="line">log-facility local7;</span><br><span class="line"></span><br><span class="line">subnet 192.168.11.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 192.168.11.153 192.168.11.252;</span><br><span class="line">  option domain-name-servers 202.106.0.20, 114.114.114.114;</span><br><span class="line">  option routers 192.168.11.254;</span><br><span class="line">  option broadcast-address 192.168.11.255;</span><br><span class="line">  default-lease-time 7200;</span><br><span class="line">  max-lease-time 10800;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">host print &#123;</span><br><span class="line">  #指定计算机名称</span><br><span class="line">  option host-name &quot;test.hello.com&quot;;</span><br><span class="line">  hardware ethernet 00:0c:29:af:f1:84;</span><br><span class="line">  fixed-address 192.168.11.252;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：请把/etc/hostname 中的计算机名称清除</span><br><span class="line">      /etc/sysconfig/network中的hostname字段清除</span><br></pre></td></tr></table></figure>

<h1 id="DNS服务"><a href="#DNS服务" class="headerlink" title="DNS服务"></a>DNS服务</h1><p> 阅读 (274324) </p>
<p> 分享</p>
<p>DNS：域名系统（英文：Domain Name System)是一个域名系统，是万维网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。类似于生活中的114服务，可以通过人名找到电话号码，也可以通过电话号码找到人名(生活中没有那么准确的原因是人名有重名，而域名是全世界唯一的)。</p>
<p>DNS协议运行在UDP协议之上，使用端口号53</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">域名:</span><br><span class="line">域名是一个网站的逻辑地址，比如www.zutuanxue.com，相比IP地址更加方便人类记忆，所以被广泛使用。</span><br></pre></td></tr></table></figure>

<h2 id="一、DNS介绍"><a href="#一、DNS介绍" class="headerlink" title="一、DNS介绍"></a>一、DNS介绍</h2><p>计算机的发展起源于上世纪60年代，最初只有美国的几所高校在使用，计算机之间通信需要知道对方的地址(IP地址)，但是人们对IP地址的记忆又是不敏感的(就像生活中你能记住多少个好友的手机号码一样)。为了方便人类记忆，大学的科学家们把计算机的名字和对应的IP地址写入到计算机中的hosts文件，以此文件来做解析。</p>
<p>但是随着计算机和网络的发展出现了局域网，计算机的数量随之增加；后来为了解决方便通信问题，我们使用了wins服务器来进行计算机名和IP的注册服务，通过一个名称服务器来自动管理局域网中的计算机，并提供解析服务。人们在局域网中通过计算机名就能连接到了对应的计算机。该技术中要求计算机名称必须唯一，正是由于这个原因使得局域网中的计算机又不能太多。</p>
<p>微型计算机的出现和局域网的发展推动了广域网的发展，hosts文件只能针对极少的计算机网络，wins可以管理局域网的解析。到了广域网，人们就迫切需要一个新的服务做解析服务器，使解析方便、快速、高效的应对广域网环境。为了解决广域网解析问题，美国人研发出了DNS服务，以及成立了管理DNS相关的机构，并提出了域名命名规则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">域名管理机构</span><br><span class="line">Internet 域名与地址管理机构（ICANN）是为承担域名系统管理，IP地址分配，协议参数配置，以及主服务器系统管理等职能而设立的非盈利机构.</span><br><span class="line">现由IANA和其他实体与美国政府约定进行管理。</span><br><span class="line"></span><br><span class="line">域名分国际域名和国内域名两种，对于国际域名而言，其命名规则是：</span><br><span class="line">域名可以由（a-z、A-Z大小写等价）26个英文字母、数字（0-9）以及连接符“-”组成，但是域名的首位必须是字母或数字。对于域名的长度也有一定</span><br><span class="line">的限制：国际通用顶级域名长度不得超过26个字符，中国国家顶级域名长度不得超过20个字符</span><br></pre></td></tr></table></figure>

<h2 id="二、DNS的解析原理"><a href="#二、DNS的解析原理" class="headerlink" title="二、DNS的解析原理"></a>二、DNS的解析原理</h2><p>目前，因特网的命名方法是层次树状结构的方法。采用这种命名方法，任何一个连接在因特网上的主机或设备，都有一个某一的层次结构的名字，即域名(domain name)。域是名字空间中一个可被管理的划分。域可以继续按层次划分为子域，如二级域、三级域等等。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998062358.png" alt="image20200114172132398.png"></p>
<h2 id="三、DNS查询"><a href="#三、DNS查询" class="headerlink" title="三、DNS查询"></a>三、DNS查询</h2><p>递归查询:一般客户机和服务器之间属递归查询，即当客户机向DNS服务器发出请求后,若DNS服务器本身不能解析,则会向另外的DNS服务器发出查询请求，得到结果后转交给客户机；如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那本地 DNS就会扮演DNS客户的角色，去代理原客户去帮忙找根域名服务器发出请求，递归即递给服务器，所有操作都有服务器来完成。</p>
<p>迭代查询:一般DNS服务器之间属迭代查询，如：DNS1问DNS2,DNS2不知道会告诉DNS1一个DNS3的IP地址，让DNS1去问问DNS3知不知道，以此类推，就是迭代查询。</p>
<p>关于递归和迭代举个生活例子帮助大家理解：比如你问张老师一个问题，张老师告诉他答案这之间的叫递归查询。这期间也许张老师也不会，这时张老师问李老师，张老师去问崔老师，这之间的查询叫迭代查询！</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998078641.png" alt="image20200114180942259.png"></p>
<p>正向查找：将域名解析为IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">www.zutuanxue.com  ---&gt; 118.190.209.153</span><br></pre></td></tr></table></figure>

<p>反向查找：将IP解析为域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">118.290.209.153  ---&gt; www.zutuanxue.com</span><br></pre></td></tr></table></figure>

<h2 id="四、DNS服务器部署"><a href="#四、DNS服务器部署" class="headerlink" title="四、DNS服务器部署"></a>四、DNS服务器部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<h3 id="4-1）DNS安装"><a href="#4-1）DNS安装" class="headerlink" title="4.1）DNS安装"></a>4.1）DNS安装</h3><p>DNS服务是由bind程序提供的，所以要实现DNS服务就需要安装bind程序包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf -y install bind bind-chroot</span><br><span class="line">bind  DNS主程序包</span><br><span class="line">bind-chroot DNS安全包，改变默认DNS根目录，将DNS运行在监牢模式</span><br><span class="line"></span><br><span class="line">说明:chroot监牢模式</span><br><span class="line">监牢是一个软件机制，其功能是使得某个程序无法访问规定区域之外的资源，同样也为了增强安全性（LCTT 译注：chroot “监牢”，所谓“监牢”就是指通过chroot机制来更改某个进程所能看到的根目录，即将某进程限制在指定目录中，保证该进程只能对该目录及其子目录的文件进行操作，从而保证整个服务器的安全）。Bind Chroot DNS 服务器的默认“监牢”为 /var/named/chroot。</span><br></pre></td></tr></table></figure>

<h3 id="4-2）DNS启动"><a href="#4-2）DNS启动" class="headerlink" title="4.2）DNS启动"></a>4.2）DNS启动</h3><p>DNS的守护进程叫做named,DNS是以named用户身份来运行，named用户在安装包的时候会在系统中自动创建。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">CentOS8下安装了bind-chroot之后，若要使用named-chroot.service，则需要关闭named.service。两者只能运行一个</span><br><span class="line"></span><br><span class="line">方法一: 不使用chroot模式启动DNS</span><br><span class="line">开启开机启动</span><br><span class="line">[root@zutuanxue ~]# systemctl enable named</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named.service to /usr/lib/systemd/system/named.service.</span><br><span class="line"></span><br><span class="line">启动DNS服务</span><br><span class="line">[root@zutuanxue ~]# systemctl start named</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@zutuanxue ~]# lsof -i :53</span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq 1520 nobody    5u  IPv4  27001      0t0  UDP bogon:domain </span><br><span class="line">dnsmasq 1520 nobody    6u  IPv4  27002      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2553  named   21u  IPv4  38662      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2553  named   22u  IPv6  38664      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2553  named  512u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  513u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  514u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  515u  IPv4  38660      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  516u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  517u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  518u  IPv6  38663      0t0  UDP localhost:domain </span><br><span class="line">named   2553  named  519u  IPv6  38663      0t0  UDP localhost:domain</span><br><span class="line"></span><br><span class="line">方法二: 使用chroot模式DNS</span><br><span class="line">将对应的文件移动到chroot根目录</span><br><span class="line">主配文件</span><br><span class="line">[root@zutuanxue ~]# cp /etc/named.conf /var/named/chroot/etc/</span><br><span class="line">[root@zutuanxue ~]# chgrp named /var/named/chroot/etc/named.conf</span><br><span class="line">[root@zutuanxue ~]# named-checkconf /var/named/chroot/etc/named.conf</span><br><span class="line"></span><br><span class="line">区域数据库文件</span><br><span class="line">[root@zutuanxue named]# cd /var/named/</span><br><span class="line">[root@zutuanxue named]# cp -r data /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cp -r dynamic /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cp named.* /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# cd /var/named/chroot/var/named/</span><br><span class="line">[root@zutuanxue named]# chown -R named.named *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动DNS服务</span><br><span class="line">开机启动</span><br><span class="line">[root@zutuanxue ~]# systemctl enable named-chroot.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to /usr/lib/systemd/system/named-chroot.service.</span><br><span class="line">启动服务</span><br><span class="line">[root@zutuanxue ~]# mv /etc/named.conf /root/</span><br><span class="line">[root@zutuanxue ~]# systemctl start named-chroot</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@zutuanxue ~]# lsof -i :53</span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">dnsmasq 1525 nobody    5u  IPv4  27359      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named   21u  IPv4  44717      0t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   2877  named   22u  IPv4  44719      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2877  named   23u  IPv4  44721      0t0  TCP bogon:domain (LISTEN)</span><br><span class="line">named   2877  named  512u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  513u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  514u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  515u  IPv4  44715      0t0  UDP localhost:domain </span><br><span class="line">named   2877  named  516u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  517u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  518u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  519u  IPv4  44718      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  520u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  521u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  522u  IPv4  44720      0t0  UDP bogon:domain </span><br><span class="line">named   2877  named  523u  IPv4  44720      0t0  UDP bogon:domain</span><br></pre></td></tr></table></figure>

<h3 id="4-3）DNS配置文件"><a href="#4-3）DNS配置文件" class="headerlink" title="4.3）DNS配置文件"></a>4.3）DNS配置文件</h3><p>默认情况下，如果不安装bind-chroot这个包，配置文件的路径如下：</p>
<p>配置文件:&#x2F;etc&#x2F;named.conf</p>
<p>区域数据库文件:&#x2F;var&#x2F;named&#x2F;</p>
<p>由于我们安装了bind-chroot这个用于改变默认DNS配置文件的路径的包，所以相对应的配置文件的路径也发生了变化。</p>
<p>变化如下：</p>
<p>配置文件:&#x2F;var&#x2F;named&#x2F;chroot&#x2F;etc&#x2F;named.conf</p>
<p>区域数据库文件:&#x2F;var&#x2F;named&#x2F;chroot&#x2F;var&#x2F;named&#x2F;</p>
<p>a、主配文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// named.conf</span><br><span class="line">//</span><br><span class="line">// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS</span><br><span class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</span><br><span class="line">//</span><br><span class="line">// See /usr/share/doc/bind*/sample/ for example named configuration files.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">options</span><br><span class="line">&#123;</span><br><span class="line">		</span><br><span class="line">    #IPv4监听端口为53，只允许本机连接</span><br><span class="line">    listen-on port 53    &#123; 127.0.0.1; &#125;;</span><br><span class="line">    #IPv6监听端口为53，只允许本机连接</span><br><span class="line">    listen-on-v6 port 53    &#123; ::1; &#125;;</span><br><span class="line">		#定义工作目录</span><br><span class="line">    directory         &quot;/var/named&quot;; </span><br><span class="line">    #CACHE文件路径,指定服务器在收到rndc dump命令时，转储数据到文件的路径。默认cache_dump.db</span><br><span class="line">    dump-file         &quot;data/cache_dump.db&quot;;</span><br><span class="line">    #静态文件路径,指定服务器在收到rndc stats命令时，追加统计数据的文件路径。默认named.stats</span><br><span class="line">    statistics-file     &quot;data/named_stats.txt&quot;;</span><br><span class="line">    #内存静态文件路径,服务器在退出时，将内存统计写到文件的路径。默认named.mem_stats</span><br><span class="line">    memstatistics-file     &quot;data/named_mem_stats.txt&quot;;</span><br><span class="line">        #在收到rndc secroots指令后，服务器转储安全根的目的文件的路径名。默认named.secroots</span><br><span class="line">    secroots-file        &quot;data/named.secroots&quot;;</span><br><span class="line">    # 指定服务器在通过rndc recursing命令指定转储当前递归请求到的文件路径。默认named.recursing</span><br><span class="line">    recursing-file        &quot;data/named.recursing&quot;;</span><br><span class="line">    </span><br><span class="line">    #指定允许哪些主机可以进行普通的DNS查询,可以是关键字:any/localhost/none,也可以是IPV4,IPV6地址</span><br><span class="line">    allow-query        &#123; localhost; &#125;;</span><br><span class="line">    #指定允许哪些主机可以对缓存的访问</span><br><span class="line">    allow-query-cache    &#123; localhost; &#125;;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</span><br><span class="line">    假如你建立的是一个权威DNS你不需要开启递归</span><br><span class="line">     - If you are building a RECURSIVE (caching) DNS server, you need to enable recursion. </span><br><span class="line">    假如你建立的是一个递归DNS,你需要开启递归服务</span><br><span class="line">     - If your recursive DNS server has a public IP address, you MUST enable access control to limit queries to your legitimate users. Failing to do so will</span><br><span class="line">     如果你的递归DNS是具有公网IP，你必须要设置访问控制来限制对合法用户的查询.</span><br><span class="line">       cause your server to become part of large scale DNS amplification </span><br><span class="line">    否则你的DNS会被大规模的攻击</span><br><span class="line">       attacks. Implementing BCP38 within your network would greatly</span><br><span class="line">    在您的网络中实现BCP38将非常重要减少此类攻击面</span><br><span class="line">       reduce such attack surface </span><br><span class="line">     */</span><br><span class="line">    #开启递归</span><br><span class="line">    recursion yes;</span><br><span class="line"></span><br><span class="line">    #开启DNSSEC在权威或者递归服务器之间信任服务</span><br><span class="line">    dnssec-enable yes;</span><br><span class="line"></span><br><span class="line">    #开启DNSSEC验证在递归服务器</span><br><span class="line">    dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">    #指定目录，其中保存着跟踪被管理DNSSEC密钥文件。默认为工作目录。</span><br><span class="line">    managed-keys-directory &quot;/var/named/dynamic&quot;;</span><br><span class="line">    </span><br><span class="line">    #PID文件路径</span><br><span class="line">    pid-file &quot;/run/named/named.pid&quot;;</span><br><span class="line">    #session-keyfile文件路径</span><br><span class="line">    session-keyfile &quot;/run/named/session.key&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging </span><br><span class="line">&#123;</span><br><span class="line">#开启DNS日志记录</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file &quot;data/named.run&quot;;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    #定义一个根域</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">        #域类型为hint,还有master slave forward等类型</span><br><span class="line">            type hint;</span><br><span class="line">        #区域数据库文件路径</span><br><span class="line">            file &quot;/var/named/named.ca&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">    #包含两个子配置文件</span><br><span class="line">    include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">    include &quot;/etc/named.root.key&quot;;</span><br></pre></td></tr></table></figure>

<p>b、区域数据库文件详解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">正向解析</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/named.localhost </span><br><span class="line">;缓存时间</span><br><span class="line">$TTL 1D</span><br><span class="line">;@表示相应的域名</span><br><span class="line">	@    				IN 	SOA        @ 					rname.invalid. (</span><br><span class="line">;解析的域名   类型 授权域    授权域名服务器   管理员邮箱</span><br><span class="line">                    0    ; serial  </span><br><span class="line">         序列号,每次更新该文件系列号都应该变大</span><br><span class="line">                    1D    ; refresh </span><br><span class="line">刷新时间,即规定从域名服务器多长时间查询一个主服务器，以保证从服务器的数据是最新的</span><br><span class="line">                    1H    ; retry   </span><br><span class="line">重试时间,即当从服务试图在主服务器上查询更时，而连接失败了，则这个值规定了从服务多长时间后再试 </span><br><span class="line">                    1W    ; expire  </span><br><span class="line">   过期时间,从服务器在向主服务更新失败后多长时间后清除对应的记录</span><br><span class="line">                    3H )    ; minimum </span><br><span class="line">   这个数据用来规定缓存服务器不能与主服务联系上后多长时间清除相应的记录</span><br><span class="line">    NS   				@</span><br><span class="line">    ;NS 名称服务器，表示这个主机为域名服务器</span><br><span class="line">    			A    		127.0.0.1</span><br><span class="line">;主机头  	A记录   	IP</span><br><span class="line">    AAAA    		::1</span><br><span class="line">;   AAAA 				解析为IPV6地址</span><br><span class="line"></span><br><span class="line">#反向解析</span><br><span class="line">[root@zutuanxue ~]# cat named.loopback </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    @ rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    		@</span><br><span class="line">    PTR    		localhost</span><br><span class="line">;IP 反向指针     主机名</span><br><span class="line">;PTR 反向指针 反解</span><br></pre></td></tr></table></figure>

<h2 id="五、部署一个正向解析"><a href="#五、部署一个正向解析" class="headerlink" title="五、部署一个正向解析"></a>五、部署一个正向解析</h2><h3 id="5-1）教学案例"><a href="#5-1）教学案例" class="headerlink" title="5.1）教学案例"></a>5.1）教学案例</h3><p><strong>对zutuanxue.com域名做解析，解析要求如下：</strong></p>
<p><strong>www 解析为A记录 IP地址为 192.168.11.88</strong></p>
<p><strong>news 做别名解析CNAME 解析为 www</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1）主配置文件</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/chroot/etc/named.conf </span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为master</span><br><span class="line">    type master;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）区域数据库文件</span><br><span class="line">[root@zutuanxue named]# cat zutuanxue.com.zone </span><br><span class="line">$TTL 1D</span><br><span class="line">zutuanxue.com.    IN SOA    ns1.zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">;zutuanxue.com.  需要做解析的域名</span><br><span class="line">;ns1.zutuanxue.com.  为zutuanxue.com.做解析的DNS    这里我们既是DNS也同时为自己域名做了解析</span><br><span class="line"></span><br><span class="line">    NS    ns1.zutuanxue.com.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;A         域名机械为IP</span><br><span class="line">;PTR        IP解析为域名</span><br><span class="line">;MX        邮件标记</span><br><span class="line">;CNAME        别名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ns1    A    192.168.11.16</span><br><span class="line">www    A    192.168.11.88</span><br><span class="line">news  CNAME    www</span><br></pre></td></tr></table></figure>

<h3 id="5-2）测试方法"><a href="#5-2）测试方法" class="headerlink" title="5.2）测试方法"></a>5.2）测试方法</h3><p>域名解析linux系统为大家提供了三个命令，看大家喜欢用哪个都可以。</p>
<p>a、host采用非交互式解析，</p>
<p>b、nslookup可以采用交互或非交互式解析</p>
<p>c、dig显示详细的解析流程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">测试注意：请将你的测试客户端机器的DNS指向你自己的DNS服务器的IP地址。本例中我使用DNS服务器给自己当测试端，我修改了自己的DNS服务器地址</span><br><span class="line">[root@zutuanxue ~]# cat /etc/resolv.conf </span><br><span class="line"># Generated by NetworkManager</span><br><span class="line">nameserver 192.168.11.16</span><br><span class="line"></span><br><span class="line">#host命令</span><br><span class="line">[root@zutuanxue ~]# host news.zutuanxue.com</span><br><span class="line">news.zutuanxue.com is an alias for www.zutuanxue.com.</span><br><span class="line">www.zutuanxue.com has address 192.168.11.88</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#nslookup 命令---交互式解析</span><br><span class="line">[root@zutuanxue ~]# nslookup</span><br><span class="line">&gt; news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line">&gt; exit</span><br><span class="line"></span><br><span class="line">#nslookup 命令---非交互式解析</span><br><span class="line">[root@zutuanxue ~]# nslookup news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#dig命令</span><br><span class="line">[root@zutuanxue ~]# dig news.zutuanxue.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-73.el7_6 &lt;&lt;&gt;&gt; news.zutuanxue.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 28487</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;news.zutuanxue.com.        IN    A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">news.zutuanxue.com.    86400    IN    CNAME    www.zutuanxue.com.</span><br><span class="line">www.zutuanxue.com.    86400    IN    A    192.168.11.88</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">zutuanxue.com.        86400    IN    NS    www.zutuanxue.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 192.168.11.16#53(192.168.11.16)</span><br><span class="line">;; WHEN: 一 2月 25 10:52:19 CST 2019</span><br><span class="line">;; MSG SIZE  rcvd: 93</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">技巧：</span><br><span class="line">在dig解析中，后面跟上+trace来显示详细解析流程</span><br><span class="line">[root@zutuanxue ~]# dig www.zutuanxue.com +trace</span><br></pre></td></tr></table></figure>

<h2 id="六、部署一个反向解析"><a href="#六、部署一个反向解析" class="headerlink" title="六、部署一个反向解析"></a>六、部署一个反向解析</h2><p><strong>案例:对<a href="http://www.zutuanxue.com做反向解析，其对应的IP地址为192.168.11.88">www.zutuanxue.com做反向解析，其对应的IP地址为192.168.11.88</a></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1）主配置文件添加反向解析zone</span><br><span class="line">[root@zutuanxue ~]# cat /var/named/chroot/etc/named.conf </span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为master</span><br><span class="line">    type master;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个反向解析</span><br><span class="line">//此处需要倒写网段</span><br><span class="line">zone &quot;11.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;192.168.11.arpa&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2）区域数据库文件设置</span><br><span class="line">[root@zutuanxue named]# cat 192.168.11.arpa </span><br><span class="line">$TTL 1D</span><br><span class="line">11.168.192.in-addr.arpa.    IN SOA    ns1.zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    ns1.zutuanxue.com.</span><br><span class="line">88    PTR    www.zutuanxue.com.</span><br><span class="line"></span><br><span class="line">注意：文件的所有者和所有者组都是named</span><br><span class="line">3）使用nslookup测试</span><br><span class="line">[root@zutuanxue ~]# nslookup 192.168.11.88</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">88.11.168.192.in-addr.arpa    name = www.zutuanxue.com.</span><br></pre></td></tr></table></figure>

<h2 id="七、DNS服务器冗余"><a href="#七、DNS服务器冗余" class="headerlink" title="七、DNS服务器冗余"></a>七、DNS服务器冗余</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/18/1602998138816.png" alt="image20200114172337009.png"></p>
<p>DNS服务器在网络中为全世界的服务器提供了域名解析服务，扮演着至关重要的角色。网络中的某台DNS一旦宕机，就会造成部分域名无法解析，用户无法顺利访问到对应的服务器。但是我们学习的过程中也发现了，我们的DNS部署在单台服务器上，如果出现单点故障，我们应该如何应对呢？我们可以通过部署多台相同解析的DNS来解决单点故障，就算一台DNS服务器出现问题，也不会影响解析服务。怎么部署呢？如何保障多台之间的解析一致？这就是我们要讨论的问题了。我们来学习辅助DNS吧！</p>
<p>辅助DNS是从主DNS拉取区域数据库文件的的，当主DNS解析的域名对应的区域数据库文件发生变化，辅助就会去找主DNS拉取新的区域数据库文件，保证和主的解析一致，而且是自动的不需要人为干预的，确保了主从DNS的区域数据库文件的一致性。</p>
<p><strong>教学案例:按照图例,为主DNS(192.168.11.16）部署一台辅助DNS(192.168.11.116)，实现数据同步。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">辅助DNS设置</span><br><span class="line">a、软件包安装</span><br><span class="line">[root@slave ~]# dnf -y install bind bind-chroot</span><br><span class="line"></span><br><span class="line">b、设置主配文件</span><br><span class="line">[root@slave etc]# cat /var/named/chroot/etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义根域</span><br><span class="line">//用于DNS向根递归查询</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">    type hint;</span><br><span class="line">    //保存了DNS根级服务器的地址</span><br><span class="line">    file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个主域</span><br><span class="line">//注意每行都要;结尾</span><br><span class="line">zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">//类型为slave  代表辅助</span><br><span class="line">    type slave;</span><br><span class="line">//区域数据库文件名称</span><br><span class="line">    file &quot;zutuanxue.com.zone&quot;;</span><br><span class="line">//设置主DNS IP,向该IP去同步数据</span><br><span class="line">    masters &#123; 192.168.11.16; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义一个反向解析</span><br><span class="line">//此处需要倒写网段</span><br><span class="line">zone &quot;11.168.192.in-addr.arpa&quot; IN &#123;</span><br><span class="line">//类型写slave  代表辅助</span><br><span class="line">    type slave;</span><br><span class="line">    file &quot;192.168.11.arpa&quot;;</span><br><span class="line">//设置主DNS IP,向该IP去同步数据</span><br><span class="line">    masters &#123; 192.168.11.16; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">修改权限</span><br><span class="line">[root@slave etc]# chgrp named named.conf </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c、启动服务</span><br><span class="line">[root@slave chroot]# systemctl enable named-chroot.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/named-chroot.service to</span><br><span class="line"> /usr/lib/systemd/system/named-chroot.service.</span><br><span class="line">[root@slave chroot]# systemctl start named-chroot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d、验证</span><br><span class="line">[root@slave ~]# ls /var/named/chroot/var/named/</span><br><span class="line">192.168.11.arpa  zutuanxue.com.zone  chroot  data  dynamic  named.ca  named.empty  named.localhost  named.loopback  slaves</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">发现192.168.11.arpa  zutuanxue.com.zone 这两个数据库文件已经同步过来了，解析一下看看吧！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置客户端的DNS IP为192.168.11.116，我的测试机就是这台slave机器，所以设置为192.168.11.116即可</span><br><span class="line">[root@slave ~]# cat /etc/resolv.conf </span><br><span class="line">nameserver 192.168.11.116</span><br><span class="line"></span><br><span class="line">使用nslookup验证一下</span><br><span class="line">[root@slave ~]# nslookup news.zutuanxue.com</span><br><span class="line">Server:        192.168.11.116</span><br><span class="line">Address:    192.168.11.116#53</span><br><span class="line"></span><br><span class="line">news.zutuanxue.com    canonical name = www.zutuanxue.com.</span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 192.168.11.88</span><br><span class="line"></span><br><span class="line">[root@slave ~]# nslookup 192.168.11.88</span><br><span class="line">Server:        192.168.11.116</span><br><span class="line">Address:    192.168.11.116#53</span><br><span class="line"></span><br><span class="line">88.11.168.192.in-addr.arpa    name = www.11.168.192.in-addr.arpa.</span><br><span class="line"></span><br><span class="line">看到结果了，完美！！</span><br></pre></td></tr></table></figure>

<h2 id="八、智能DNS"><a href="#八、智能DNS" class="headerlink" title="八、智能DNS"></a>八、智能DNS</h2><p>在我们访问WEB的时候，发现有的网站打开的速度非常快，有的网站打开的非常慢，这是为什么呢？原因就是很多公司为了提升用户的体验，自己的网站使用了CDN内容加速服务，让你直接在你本地城市的服务器上拿数据并展示给你看。什么是CDN我们暂且理解为本地缓存服务器就好，那么你是怎么准确知道你本地的缓存服务器的呢！因为很多CDN公司的DNS使用了智能解析服务，根据你的源IP判断你属于哪个城市，让后再把本地的缓存服务器解析给你，你就会直接去找该服务器拿数据了。</p>
<p>智能解析原理</p>
<p>在DNS中植入全世界的IP库以及IP对应的地域，当用户来请求解析时，DNS会根据其源IP来定位他属于哪个区域，然后去找这个区域的view视图查询对应的域名的区域数据库文件做解析。从而使得不同地域的用户解析不同。</p>
<p><strong>教学案例:部署一台DNS智能解析服务器，对zutuanxue.com域名做智能解析：</strong></p>
<p><strong>上海的用户解析IP为 1.1.1.1</strong></p>
<p><strong>北京的用户解析IP为 2.2.2.2</strong></p>
<p><strong>其他用户解析为 3.3.3.3</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">智能解析</span><br><span class="line">a、设置主配文件</span><br><span class="line">定义IP库，DNS根据IP库判断源IP属于哪个区域</span><br><span class="line">根据地域定义视图，将该区域的客户端的解析请求都由该视图中的zone来解析</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/etc/named.conf</span><br><span class="line">options &#123;</span><br><span class="line">    directory     &quot;/var/named&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//定义IP库</span><br><span class="line"></span><br><span class="line">acl shanghai &#123; 192.168.11.50; &#125;;</span><br><span class="line">acl beijing &#123; 192.168.11.100; &#125;;</span><br><span class="line"></span><br><span class="line">//定义视图，通过IP匹配后，通过不同的区域数据库文件进行解析</span><br><span class="line">view sh &#123;</span><br><span class="line">	match-clients &#123; shanghai; &#125;;</span><br><span class="line">	zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">    type master;</span><br><span class="line">    file &quot;zutuanxue.com.zone.sh&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">view bj &#123;</span><br><span class="line">	match-clients &#123; beijing; &#125;;</span><br><span class="line">	zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;zutuanxue.com.zone.bj&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">view other &#123;</span><br><span class="line">	match-clients &#123; any; &#125;;</span><br><span class="line">  zone &quot;zutuanxue.com&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;zutuanxue.com.zone.any&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b、根据主配文件设置不同的区域数据库文件</span><br><span class="line">[root@master named]# cd /var/named/chroot/var/named</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.bj</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.sh</span><br><span class="line">[root@master named]# cp zutuanxue.com.zone zutuanxue.com.zone.any</span><br><span class="line">[root@master named]# chgrp named  zutuanxue.com.zone.*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.sh </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    1.1.1.1</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.bj</span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    2.2.2.2</span><br><span class="line"></span><br><span class="line">[root@master named]# cat /var/named/chroot/var/named/zutuanxue.com.zone.any </span><br><span class="line">$TTL 1D</span><br><span class="line">@    IN SOA    zutuanxue.com. rname.invalid. (</span><br><span class="line">                    0    ; serial</span><br><span class="line">                    1D    ; refresh</span><br><span class="line">                    1H    ; retry</span><br><span class="line">                    1W    ; expire</span><br><span class="line">                    3H )    ; minimum</span><br><span class="line">    NS    www.zutuanxue.com.</span><br><span class="line">www    A    3.3.3.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c、测试</span><br><span class="line">依次修改主配的IP库中的IP为本机，观看解析情况</span><br><span class="line"></span><br><span class="line">[root@master named]# nslookup www.zutuanxue.com</span><br><span class="line">Server:        192.168.11.16</span><br><span class="line">Address:    192.168.11.16#53</span><br><span class="line"></span><br><span class="line">Name:    www.zutuanxue.com</span><br><span class="line">Address: 1.1.1.1</span><br></pre></td></tr></table></figure>

<h1 id="FTP文件服务器"><a href="#FTP文件服务器" class="headerlink" title="FTP文件服务器"></a>FTP文件服务器</h1><p> 阅读 (293262) </p>
<p> 分享</p>
<h2 id="一、FTP介绍"><a href="#一、FTP介绍" class="headerlink" title="一、FTP介绍"></a>一、FTP介绍</h2><p>FTP (File transfer protocol) 是TCP&#x2F;IP 协议组中的协议之一。他最主要的功能是在服务器与客户端之间进行文件的传输。FTP就是实现两台计算机之间的拷贝，从远程计算机拷贝文件至自己的计算机上，称之为“下载 （download）”文件。将文件从自己计算机中拷贝至远程计算机上，则称之为“上传（upload）”文件。这个古老的协议使用的是明码传输方式，且过去有相当多的安全危机历史。为了更安全的使用 FTP 协议，我们主要介绍较为安全但功能较少的 vsftpd(very secure File transfer protocol ) 这个软件。FTP是一个C&#x2F;S类型的软件，FTP监听TCP端口号为21，数据端口为20。</p>
<h2 id="二、应用场景"><a href="#二、应用场景" class="headerlink" title="二、应用场景"></a>二、应用场景</h2><p>下载服务器：提供对外的下载服务</p>
<p>文件服务器：提供上传和下载服务</p>
<h2 id="三、FTP的权限"><a href="#三、FTP的权限" class="headerlink" title="三、FTP的权限"></a>三、FTP的权限</h2><p>FTP 服务器的功能除了单纯的进行文件的传输与管理之外，依据服务器软件的设定架构，它还可以提供几个主要的功能。：<br>不同等级的用户身份：user, guest, anonymous<br>FTP 服务器在默认的情况下，依据使用者登录的情况而分为三种不同的身份，分别是：</p>
<p>(1)本地用户：系统中真实存在的用户</p>
<p>(2)来宾, guest；</p>
<p>(3)匿名登录者, anonymous</p>
<p>这三种身份的用户在系统上面的权限差异很大！例如实体用户取得系统的权限比较完整， 所以可以进行比较多的动作；至于匿名登录者，大概我们就仅提供他下载资源的能力而已，并不许匿名者使用太多主机的资源！ 当然，这三种人物因为权限的不同能够使用的【在线命令】自然也就不相同！</p>
<h2 id="四、FTP的工作模式"><a href="#四、FTP的工作模式" class="headerlink" title="四、FTP的工作模式"></a>四、FTP的工作模式</h2><p>FTP支持两种模式，一种方式叫做Standard (也就是 PORT方式，主动方式)，一种是 Passive (也就是PASV，被动方式)。 Standard模式 FTP的客户端发送 PORT 命令到FTP服务器。Passive模式FTP的客户端发送 PASV命令到 FTP Server。</p>
<p>下面介绍一个这两种方式的工作原理：</p>
<p>Port模式FTP 客户端首先和FTP服务器的TCP 21端口建立连接，通过这个通道发送命令，客户端需要接收数据的时候在这个通道上发送PORT命令。 PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP 20端口连接至客户端的指定端口发送数据。 FTP server必须和客户端建立一个新的连接用来传送数据。</p>
<p>Passive模式在建立控制通道的时候和Standard模式类似，但建立连接后发送的不是Port命令，而是Pasv命令。FTP服务器收到Pasv命令后，随机打开一个高端端口（端口号大于1024）并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，然后FTP服务器将通过这个端口进行数据的传送，这个时候FTP server不再需要建立一个新的和客户端之间的连接。</p>
<p>很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP 20无法和内部网络的客户端建立一个新的连接，造成无法工作。</p>
<h2 id="五、FTP安装部署"><a href="#五、FTP安装部署" class="headerlink" title="五、FTP安装部署"></a>五、FTP安装部署</h2><p><strong>约定：本实验中使用过的机器为centos8.0_x86_64系统，IP地址192.168.11.16&#x2F;24.请关闭防火墙和SELINUX。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vsftp安装</span><br><span class="line">[root@localhost ~]# dnf -y install vsftpd ftp</span><br><span class="line"></span><br><span class="line">vsftp开机启动</span><br><span class="line">[root@localhost ~]# systemctl enable vsftpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to </span><br><span class="line">/usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br><span class="line">启动vsftp服务</span><br><span class="line">[root@localhost ~]# systemctl start vsftpd</span><br><span class="line"></span><br><span class="line">验证启动</span><br><span class="line">[root@localhost ~]# lsof -i :21</span><br><span class="line">COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">vsftpd  1951 root    4u  IPv6  32837      0t0  TCP *:ftp (LISTEN)</span><br></pre></td></tr></table></figure>

<h2 id="六、FTP配置文件"><a href="#六、FTP配置文件" class="headerlink" title="六、FTP配置文件"></a>六、FTP配置文件</h2><h3 id="6-1）相关文件"><a href="#6-1）相关文件" class="headerlink" title="6.1）相关文件"></a>6.1）相关文件</h3><p>主配文件:&#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf</p>
<p>下载目录:&#x2F;var&#x2F;ftp&#x2F;</p>
<p>FTP日志:&#x2F;var&#x2F;log&#x2F;xferlog</p>
<h3 id="6-2）主配文件详解"><a href="#6-2）主配文件详解" class="headerlink" title="6.2）主配文件详解"></a>6.2）主配文件详解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"># Example config file /etc/vsftpd/vsftpd.conf</span><br><span class="line">#</span><br><span class="line"># The default compiled in settings are fairly paranoid. This sample file</span><br><span class="line"># loosens things up a bit, to make the ftp daemon more usable.</span><br><span class="line"># Please see vsftpd.conf.5 for all compiled in defaults.</span><br><span class="line">#</span><br><span class="line"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span><br><span class="line"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&#x27;s</span><br><span class="line"># capabilities.</span><br><span class="line">#</span><br><span class="line">#匿名用户访问,YES是允许，NO是拒绝</span><br><span class="line"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow local users to log in.</span><br><span class="line"># 本地用户登录,YES是允许，NO是拒绝.默认访问的是本地用户家目录，如果你开启了selinux</span><br><span class="line"># 请设置开启布尔值ftp_home_dir为ON</span><br><span class="line"># When SELinux is enforcing check for SE bool ftp_home_dir</span><br><span class="line">local_enable=YES</span><br><span class="line">#</span><br><span class="line">#允许本地用户上传</span><br><span class="line"># Uncomment this to enable any form of FTP write command.</span><br><span class="line">write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Default umask for local users is 077. You may wish to change this to 022,</span><br><span class="line"># 上传的权限是022，使用的是umask权限。对应的目录是755，文件是644</span><br><span class="line"># if your users expect that (022 is used by most other ftpd&#x27;s)</span><br><span class="line">local_umask=022</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow the anonymous FTP user to upload files. This only</span><br><span class="line"># has an effect if the above global write enable is activated. Also, you will</span><br><span class="line"># obviously need to create a directory writable by the FTP user.</span><br><span class="line"># When SELinux is enforcing check for SE bool allow_ftpd_anon_write, allow_ftpd_full_access</span><br><span class="line"># 开启匿名用户上传功能，默认是拒绝的</span><br><span class="line">#anon_upload_enable=YES</span><br><span class="line">#</span><br><span class="line"># Uncomment this if you want the anonymous FTP user to be able to create</span><br><span class="line"># new directories.</span><br><span class="line"># 开启匿名用户创建文件或文件夹权限</span><br><span class="line">#anon_mkdir_write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Activate directory messages - messages given to remote users when they</span><br><span class="line"># go into a certain directory.</span><br><span class="line"># 开启目录欢迎消息，一般对命令行登陆有效</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">#</span><br><span class="line"># Activate logging of uploads/downloads.</span><br><span class="line"># 开启上传和下载日志记录功能</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">#</span><br><span class="line">#使用标准模式</span><br><span class="line"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">#</span><br><span class="line"># If you want, you can arrange for uploaded anonymous files to be owned by</span><br><span class="line"># a different user. Note! Using &quot;root&quot; for uploaded files is not</span><br><span class="line"># recommended!</span><br><span class="line"># 声明匿名用户上传文件的所有者</span><br><span class="line"># 允许更改匿名用户上传文件的所有者</span><br><span class="line">#chown_uploads=YES</span><br><span class="line">#所有者为whoever</span><br><span class="line">#chown_username=whoever</span><br><span class="line">#</span><br><span class="line"># You may override where the log file goes if you like. The default is shown</span><br><span class="line"># below.</span><br><span class="line"># 日志文件路径</span><br><span class="line">#xferlog_file=/var/log/xferlog</span><br><span class="line">#</span><br><span class="line"># If you want, you can have your log file in standard ftpd xferlog format.</span><br><span class="line"># Note that the default log file location is /var/log/xferlog in this case.</span><br><span class="line"># 日志文件采用标准格斯</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out an idle session.</span><br><span class="line"># 会话超时时间</span><br><span class="line">#idle_session_timeout=600</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out a data connection.</span><br><span class="line"># 数据传输超时时间</span><br><span class="line">#data_connection_timeout=120</span><br><span class="line">#</span><br><span class="line"># It is recommended that you define on your system a unique user which the</span><br><span class="line"># ftp server can use as a totally isolated and unprivileged user.</span><br><span class="line"># FTP子进程管理用户</span><br><span class="line">#nopriv_user=ftpsecure</span><br><span class="line">#</span><br><span class="line"># Enable this and the server will recognise asynchronous ABOR requests. Not</span><br><span class="line"># recommended for security (the code is non-trivial). Not enabling it,</span><br><span class="line"># however, may confuse older FTP clients.</span><br><span class="line"># 是否允许客户端发起“async ABOR”请求，该操作是不安全的默认禁止。</span><br><span class="line">#async_abor_enable=YES</span><br><span class="line">#</span><br><span class="line"># By default the server will pretend to allow ASCII mode but in fact ignore</span><br><span class="line"># the request. Turn on the below options to have the server actually do ASCII</span><br><span class="line"># mangling on files when in ASCII mode. The vsftpd.conf(5) man page explains</span><br><span class="line"># the behaviour when these options are disabled.</span><br><span class="line"># Beware that on some FTP servers, ASCII support allows a denial of service</span><br><span class="line"># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</span><br><span class="line"># predicted this attack and has always been safe, reporting the size of the</span><br><span class="line"># raw file.</span><br><span class="line"># ASCII mangling is a horrible feature of the protocol.</span><br><span class="line"># 该选项用于指定是否允许上传时以ASCII模式传输数据</span><br><span class="line">#ascii_upload_enable=YES</span><br><span class="line">#该选项用于指定是否允许下载时以ASCII模式传输数据</span><br><span class="line">#ascii_download_enable=YES</span><br><span class="line">#</span><br><span class="line"># You may fully customise the login banner string:</span><br><span class="line"># FTP文本界面登陆欢迎词</span><br><span class="line">#ftpd_banner=Welcome to blah FTP service.</span><br><span class="line">#</span><br><span class="line"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span><br><span class="line"># useful for combatting certain DoS attacks.</span><br><span class="line"># 是否开启拒绝的Email功能</span><br><span class="line">#deny_email_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line"># 指定保存被拒接的Email地址的文件</span><br><span class="line">#banned_email_file=/etc/vsftpd/banned_emails</span><br><span class="line">#</span><br><span class="line"># You may specify an explicit list of local users to chroot() to their home</span><br><span class="line"># directory. If chroot_local_user is YES, then this list becomes a list of</span><br><span class="line"># users to NOT chroot().</span><br><span class="line"># (Warning! chroot&#x27;ing can be very dangerous. If using chroot, make sure that</span><br><span class="line"># the user does not have write access to the top level directory within the</span><br><span class="line"># chroot)</span><br><span class="line"># 是否开启对本地用户chroot的限制，YES为默认所有用户都不能切出家目录，NO代表默认用户都可以切出家目录</span><br><span class="line"># 设置方法类似于：YES拒绝所有，允许个别    NO  允许所有拒绝个别</span><br><span class="line">#chroot_local_user=YES</span><br><span class="line">#开启特例列表</span><br><span class="line">#chroot_list_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line"># 如果chroot_local_user的值是YES则该文件中的用户是可以切出家目录，如果是NO，该文件中的用户则不能切出家目录</span><br><span class="line"># 一行一个用户。</span><br><span class="line">#chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line">#</span><br><span class="line"># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</span><br><span class="line"># default to avoid remote users being able to cause excessive I/O on large</span><br><span class="line"># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</span><br><span class="line"># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</span><br><span class="line"># 是否开启ls 递归查询功能 ls -R</span><br><span class="line">#ls_recurse_enable=YES</span><br><span class="line">#</span><br><span class="line"># When &quot;listen&quot; directive is enabled, vsftpd runs in standalone mode and</span><br><span class="line"># listens on IPv4 sockets. This directive cannot be used in conjunction</span><br><span class="line"># with the listen_ipv6 directive.</span><br><span class="line"># 是否开启ftp独立模式在IPV4</span><br><span class="line">listen=NO</span><br><span class="line">#</span><br><span class="line"># This directive enables listening on IPv6 sockets. By default, listening</span><br><span class="line"># on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</span><br><span class="line"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span><br><span class="line"># sockets. If you want that (perhaps because you want to listen on specific</span><br><span class="line"># addresses) then you must run two copies of vsftpd with two configuration</span><br><span class="line"># files.</span><br><span class="line"># Make sure, that one of the listen options is commented !!</span><br><span class="line"># 是否开启ftp独立模式在ipv6</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#启用pam模块验证</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">#是否开启userlist功能.</span><br><span class="line"></span><br><span class="line">#是否启用用户列表功能</span><br><span class="line">userlist_enable=YES</span><br></pre></td></tr></table></figure>

<p>通过配置文件的分析，VSFTP不允许匿名访问，本地用户可以下载和上传。如果允许匿名用户登录的话需要将anonymous_enable&#x3D;YES，然后重新启动服务</p>
<p>我们可以通过修改配置文件的内容即可配置FTP的相关登陆情况。</p>
<h2 id="七、FTP客户端访问"><a href="#七、FTP客户端访问" class="headerlink" title="七、FTP客户端访问"></a>七、FTP客户端访问</h2><p>FTP是一个C&#x2F;S类型的软件,连接服务端需要FTP客户端才能完成，常见的FTP客户端有以下几种:</p>
<p>浏览器：可以通过浏览器中输入 <a href="ftp://ip或者ftp//%E5%9F%9F%E5%90%8D%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E8%AE%BF%E9%97%AEFTP">ftp://ip或者ftp://域名的方式来访问FTP</a></p>
<p>自带客户端:命令行下可以使用ftp命令去连接</p>
<p>三方客户端：FileZilla 8uftp 图形软件或者文本界面的lftp等</p>
<p>三种方式中，文本界面是比较麻烦的，无法鼠标流。所以我重点给大家讲解一下</p>
<h3 id="7-1）文本界面登陆"><a href="#7-1）文本界面登陆" class="headerlink" title="7.1）文本界面登陆"></a>7.1）文本界面登陆</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">文本界面匿名登陆</span><br><span class="line">[root@localhost ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.11.16:root): ftp	#用户名可以是ftp也可以是anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:							#密码为空</span><br><span class="line">230 Login successful. #显示登陆成功</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,90,35).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 0        0               6 May 14  2019 pub</span><br><span class="line">226 Directory send OK.</span><br><span class="line">通过ls可以列出当前目录下有哪些内容 看到有一个目录叫pub</span><br><span class="line">ftp&gt; pwd</span><br><span class="line">257 &quot;/&quot;   </span><br><span class="line">通过pwd命令查看当前路径  注意这里显示的是FTP的根目录</span><br><span class="line"></span><br><span class="line">ftp&gt; bye</span><br><span class="line">221 Goodbye.</span><br><span class="line">退出使用bye命令</span><br><span class="line"></span><br><span class="line">文本界面本地用户登录</span><br><span class="line">[root@localhost ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (192.168.11.16:root): hello</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,130,240).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 下载</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 公共</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 图片</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 文档</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 桌面</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 模板</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 视频</span><br><span class="line">drwxr-xr-x    2 1001     1001            6 Jan 15 08:56 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; pwd</span><br><span class="line">257 &quot;/home/hello&quot; is the current directory</span><br></pre></td></tr></table></figure>

<h3 id="7-2）FTP客户端常用命令"><a href="#7-2）FTP客户端常用命令" class="headerlink" title="7.2）FTP客户端常用命令"></a>7.2）FTP客户端常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">键入help命令可以查看所有可使用的命令</span><br><span class="line">ftp&gt; help</span><br><span class="line">Commands may be abbreviated.  Commands are:</span><br><span class="line"></span><br><span class="line">!                debug         mdir           sendport     site</span><br><span class="line">$                dir           mget           put          size</span><br><span class="line">account          disconnect    mkdir          pwd          status</span><br><span class="line">append           exit          mls            quit         struct</span><br><span class="line">ascii            form          mode           quote        system</span><br><span class="line">bell             get           modtime        recv         sunique</span><br><span class="line">binary           glob          mput           reget        tenex</span><br><span class="line">bye              hash          newer          rstatus      tick</span><br><span class="line">case             help          nmap           rhelp        trace</span><br><span class="line">cd               idle          nlist          rename       type</span><br><span class="line">cdup             image         ntrans         reset        user</span><br><span class="line">chmod            lcd           open           restart      umask</span><br><span class="line">close            ls            prompt         rmdir        verbose</span><br><span class="line">cr               macdef        passive        runique        ?</span><br><span class="line">delete           mdelete       proxy          send</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">!+linux命令   执行系统命令</span><br><span class="line">!ls /opt  显示linux系统中/opt目录下的内容</span><br><span class="line">ftp&gt; !ls /opt</span><br><span class="line">dhcp  dns  rh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lcd linux系统中的当前目录</span><br><span class="line">lcd /root  将linux系统中的当前目录切换到/root下</span><br><span class="line">ftp&gt; lcd /root</span><br><span class="line">Local directory now /root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">put 上传命令，mput批量上传命令</span><br><span class="line">上传initial-setup-ks.cfg文件到hello家目录下</span><br><span class="line">ftp&gt; put initial-setup-ks.cfg </span><br><span class="line">local: initial-setup-ks.cfg remote: initial-setup-ks.cfg</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,96,132).</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">1803 bytes sent in 0.00135 secs (1333.58 Kbytes/sec)</span><br><span class="line">可以看到上传成功了</span><br><span class="line"></span><br><span class="line">验证一下上传结果</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,173,142).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000         1803 Feb 26 07:01 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line">看见了吧</span><br><span class="line"></span><br><span class="line">切换linux当前目录到/tmp</span><br><span class="line">ftp&gt; lcd /tmp</span><br><span class="line">Local directory now /tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get下载命令，mget批量下载</span><br><span class="line">下载initial-setup-ks.cfg到linux系统当前目录/tmp</span><br><span class="line">ftp&gt; get initial-setup-ks.cfg</span><br><span class="line">local: initial-setup-ks.cfg remote: initial-setup-ks.cfg</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,229,134).</span><br><span class="line">150 Opening BINARY mode data connection for initial-setup-ks.cfg (1803 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">1803 bytes received in 2.9e-05 secs (62172.41 Kbytes/sec)</span><br><span class="line"></span><br><span class="line">列出linux目录/tmp的内容，看到了下载的文件initial-setup-ks.cfg</span><br><span class="line">ftp&gt; !ls /tmp/</span><br><span class="line">dhcp                                          tracker-extract-files.0</span><br><span class="line">initial-setup-ks.cfg                                  VMwareDnD</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-chronyd.service-sghHHs       vmware-root</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-colord.service-wK7h08      yum_save_tx.2019-02-20.16-10.Z6uXqR.yumtx</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-cups.service-cokBro          yum_save_tx.2019-02-21.09-03.08zIbU.yumtx</span><br><span class="line">systemd-private-8e7a99ea89c14ab396d66116970fe04d-rtkit-daemon.service-6wt1S0  yum_save_tx.2019-02-22.11-10.prawAT.yumtx</span><br><span class="line"></span><br><span class="line">ftp&gt; close</span><br><span class="line">221 Goodbye.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">Not connected.</span><br><span class="line">可以使用close断开连接，当连接断开希望再次连接直接使用open命令即可</span><br><span class="line">ftp&gt; open 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.11.16:root): hello</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,192,88).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1000     1000         1803 Feb 26 07:01 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete命令可以删除属于自己的文件</span><br><span class="line">删除initial-setup-ks.cfg文件</span><br><span class="line">ftp&gt; delete initial-setup-ks.cfg</span><br><span class="line">250 Delete operation successful.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,168,142).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 下载</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 公共</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 图片</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 文档</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 桌面</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 模板</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 视频</span><br><span class="line">drwxr-xr-x    2 1000     1000            6 Jan 11 01:37 音乐</span><br><span class="line">226 Directory send OK.</span><br></pre></td></tr></table></figure>

<h2 id="八、基于虚拟用户配置安全的ftp"><a href="#八、基于虚拟用户配置安全的ftp" class="headerlink" title="八、基于虚拟用户配置安全的ftp"></a>八、基于虚拟用户配置安全的ftp</h2><p>在ftp中不论是匿名用户还是实名用户都是系统中真实存在的用户，或多或少都会有一些安全方面的风险，为了避免这个风险，开发者在ftp中加入了一个虚拟用户的概念，所有虚拟用户都会被统一映射为一个系统账号，免去了管理过多账户的麻烦，那么这个虚拟用户如何实现呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">a、修改配置文件 </span><br><span class="line">[root@zutuanxue pam.d]# egrep -v &quot;^#&quot; /etc/vsftpd/vsftpd.conf </span><br><span class="line">anonymous_enable=YES</span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">local_umask=022</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">listen=NO</span><br><span class="line">listen_ipv6=YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#虚拟用户配置选项</span><br><span class="line">#pam登陆验证</span><br><span class="line">pam_service_name=vftp</span><br><span class="line">#允许虚拟用户功能</span><br><span class="line">guest_enable=YES</span><br><span class="line">#虚拟用户映射到本地用户hello</span><br><span class="line">guest_username=hello</span><br><span class="line">#这里我通过指令改变了默认设置，允许虚拟用户写</span><br><span class="line">allow_writeable_chroot=YES </span><br><span class="line"></span><br><span class="line">#本地用户的根目录</span><br><span class="line">#这里是定义虚拟用户主目录，用户和组必须指定为宿主用户hello</span><br><span class="line">local_root=/home/hello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#允许虚拟用户和本地用户权限一致</span><br><span class="line">virtual_use_local_privs=YES</span><br><span class="line"></span><br><span class="line">#如果虚拟用户和本地用户权限不同，可以通过以下的指令来设置指令，配置文件和登陆名同步即可。</span><br><span class="line">#user_config_dir=/etc/vsftpd/vconf.d/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b、生成虚拟用户账号密码文件</span><br><span class="line">奇数行数账户，偶数行是密码</span><br><span class="line">[root@zutuanxue ~]# cat /etc/vsftpd/vuser</span><br><span class="line">vuser01</span><br><span class="line">123456</span><br><span class="line">vuser02</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">使用db_load转成db格式</span><br><span class="line">[root@zutuanxue ~]# db_load -T -t hash -f /etc/vsftpd/vuser /etc/vsftpd/vuser.db</span><br><span class="line">要求权限是600</span><br><span class="line">[root@zutuanxue ~]# chmod 600 /etc/vsftpd/vuser.db</span><br><span class="line"></span><br><span class="line">c、配置pam认证，注意先后顺序</span><br><span class="line">[root@zutuanxue ~]# cat /etc/pam.d/vftp </span><br><span class="line">#虚拟用户登录</span><br><span class="line">auth       sufficient     /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">account    sufficient     /lib64/security/pam_userdb.so db=/etc/vsftpd/vuser</span><br><span class="line">#本地登陆</span><br><span class="line">session    optional     pam_keyinit.so    force revoke</span><br><span class="line">auth       required    pam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span><br><span class="line">auth       required    pam_shells.so</span><br><span class="line">auth       include    password-auth</span><br><span class="line">account    include    password-auth</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">session    include    password-auth</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d、重启服务生效</span><br><span class="line">[root@zutuanxue ~]# systemctl restart vsftpd</span><br><span class="line">[root@zutuanxue ~]# cat /etc/vsftpd/chroot_list </span><br><span class="line">vuser01</span><br><span class="line">vuser02</span><br><span class="line"></span><br><span class="line">e、验证登陆</span><br><span class="line">[root@zutuanxue ~]# ftp 192.168.11.16</span><br><span class="line">Connected to 192.168.11.16 (192.168.11.16).</span><br><span class="line">220 Welcome to ayitula FTP service.</span><br><span class="line">Name (192.168.11.16:root): vuser01</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,11,16,82,91).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">226 Transfer done (but failed to open directory).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">登陆成功了.</span><br></pre></td></tr></table></figure>

<h1 id="Linux-时间服务器"><a href="#Linux-时间服务器" class="headerlink" title="Linux 时间服务器"></a>Linux 时间服务器</h1><p> 阅读 (192071) </p>
<p> 分享</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>什么是时间服务器</strong></p>
<p>NTP：Network Time Protocol 网络时间协议，用来同步网络中各主机的时间，在linux系统中早期使用ntp来实现，后来使用chrony来实现，Chrony 应用本身已经有几年了，其是是网络时间协议的 (NTP) 的另一种实现。</p>
<p><strong>Chrony可以同时做为ntp服务的客户端和服务端</strong></p>
<p>一直以来众多发行版里标配的都是ntpd对时服务，自rhel7&#x2F;centos7 起，Chrony做为了发行版里的标配服务，不过老的ntpd服务依旧在rhel7&#x2F;centos7里可以找到 。</p>
<p><strong>核心组件：</strong></p>
<p>chronyd：是守护进程，主要用于调整内核中运行的系统时间和时间服务器同步。它确定计算机增减时间的比率，并对此进行调整补偿。</p>
<p>chronyc：提供一个用户界面，用于监控性能并进行多样化的配置。它可以在chronyd实例控制的计算机上工作，也可以在一台不同的远程计算机上工作。</p>
<p><strong>优势</strong></p>
<p>chrony用来同步时间，来代替ntp服务，优点是很精巧的时间同步工具，更快响应时钟变化，在应对延时提供更好的稳定性能，不会出现时间空白，跨越互联网同步时间只需要几毫秒。</p>
<p>它的优势主要包括</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#更快的同步：能在最大程度的减少时间和频率误差，这对于非全天运行的台式计算机或系统而言非常有用</span><br><span class="line"></span><br><span class="line">#更快的响应速度：能够更好的响应时间频率的快速变化，这对于具备不稳定时钟的虚拟机或导致时钟频率发生变化的节能技术而言更有帮助</span><br><span class="line"></span><br><span class="line">#稳定：在初始同步后，它并不会停止时钟，以防对需要系统时间的程序造成影响，以及可以更好的应对延迟</span><br></pre></td></tr></table></figure>

<p><strong>相关文件说明</strong></p>
<p>&#x2F;etc&#x2F;chrony.conf 主配置文件</p>
<p>&#x2F;usr&#x2F;bin&#x2F;chronyc 客户端程序工具</p>
<p>&#x2F;usr&#x2F;sbin&#x2F;chronyd 服务端程序</p>
<p><strong>配置文件说明</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line"># Use public servers from the pool.ntp.org project.</span><br><span class="line"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span><br><span class="line">pool 2.centos.pool.ntp.org iburst</span><br><span class="line">###指定时间服务器的地址，可以使用pool开始也可以使用server开始，iburst可以加速初始同步，perfer表示优先</span><br><span class="line"># Record the rate at which the system clock gains/losses time.</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">#用来记录时间差异，由于chrony是通过BIOS判断时间的，他会用这个时间与上层时间服务器进行对比，将差异记录下来</span><br><span class="line"># Allow the system clock to be stepped in the first three updates</span><br><span class="line"># if its offset is larger than 1 second.</span><br><span class="line">makestep 1.0 3</span><br><span class="line">#让chrony可以根据需求逐步进行时间的调整，避免在某些情况下时间差异较大，导致调整时间耗时过长，以上的设置表示在误差时间大于1.0秒的话，前三次使用update更新时间是使用step（分阶段）而不是slew(微调),如果最后一个值是负数的话，如-1则表示随时步进</span><br><span class="line"># Enable kernel synchronization of the real-time clock (RTC).</span><br><span class="line">rtcsync</span><br><span class="line">#启用内核模式，在内核模式中，系统时间每11分钟会同步到实时时钟（RTC）</span><br><span class="line"># Enable hardware timestamping on all interfaces that support it.</span><br><span class="line">#hwtimestamp *</span><br><span class="line"># 通过使用hwtimestamp指令启用硬件时间戳</span><br><span class="line"># Increase the minimum number of selectable sources required to adjust</span><br><span class="line"># the system clock.</span><br><span class="line">#minsources 2</span><br><span class="line"></span><br><span class="line"># Allow NTP client access from local network.</span><br><span class="line">#allow 192.168.0.0/16</span><br><span class="line">#允许同步的网段</span><br><span class="line"># Serve time even if not synchronized to a time source.</span><br><span class="line">#local stratum 10</span><br><span class="line">#即时自己未能通过网络时间服务器同步时间，也允许将本地时间作为标准时间同步给其他客户端</span><br><span class="line"># Specify file containing keys for NTP authentication.</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">#验证的秘钥文件</span><br><span class="line"># Get TAI-UTC offset and leap seconds from the system tz database.</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">#从system tz数据库中获取TAI(国际原子时)和UTC（协调世界时）之间的时间偏移及闰秒</span><br><span class="line"># Specify directory for log files.</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">#日志文件的位置</span><br><span class="line"># Select which information is logged.</span><br><span class="line">#log measurements statistics tracking</span><br></pre></td></tr></table></figure>

<h2 id="时间服务器实战"><a href="#时间服务器实战" class="headerlink" title="时间服务器实战"></a>时间服务器实战</h2><p>环境：两台主机，系统为CentOS8，IP地址为192.168.2.100,192.168.2.200,selinux和防火墙关闭</p>
<p>要求: 192.168.2.100为内网时间服务器，192.168.2.200为客户端，200的客户端的时间要与100的时间同步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">在192.168.2.100主机上</span><br><span class="line">step1	检查时间服务器上是否有相关软件包</span><br><span class="line">[root@zutuanxue ~]# rpm -qa | grep chrony</span><br><span class="line">chrony-3.3-3.el8.x86_64</span><br><span class="line"></span><br><span class="line">step2	检查本机的时区</span><br><span class="line">[root@zutuanxue ~]# timedatectl </span><br><span class="line">               Local time: 五 2020-01-17 17:36:14 CST</span><br><span class="line">           Universal time: 五 2020-01-17 09:36:14 UTC</span><br><span class="line">                 RTC time: 五 2020-01-17 09:36:56</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br><span class="line">注：如果不是本地时区请设置时区</span><br><span class="line">[root@zutuanxue ~]# timedatectl list-timezones | grep Shanghai</span><br><span class="line">Asia/Shanghai</span><br><span class="line">[root@zutuanxue ~]# timedatectl set-timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line">step3	修改配置文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line">server 192.168.2.100 iburst		#定义时间服务器的地址</span><br><span class="line">driftfile /var/lib/chrony/drift	</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">allow 192.168.2.0/24	#定义允许谁来同步</span><br><span class="line">local stratum 10	#允许将本地时间作为标准</span><br><span class="line">leapsectz right/UTC	</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">bindaddress 192.168.2.100	#监听的网络接口</span><br><span class="line"></span><br><span class="line">step4	启动服务&amp;查看端口</span><br><span class="line">[root@zutuanxue ~]# systemctl start chronyd</span><br><span class="line">[root@zutuanxue ~]# lsof -i :123</span><br><span class="line"></span><br><span class="line">在192.168.2.200主机上</span><br><span class="line">step5	检查软件包</span><br><span class="line">[root@slave ~]# rpm -qa | grep chrony</span><br><span class="line">chrony-3.3-3.el8.x86_64</span><br><span class="line"></span><br><span class="line">step6	检查并设置本机时区</span><br><span class="line">[root@slave ~]# timedatectl </span><br><span class="line">               Local time: 五 2020-01-17 04:19:38 EST</span><br><span class="line">           Universal time: 五 2020-01-17 09:19:38 UTC</span><br><span class="line">                 RTC time: 五 2020-01-17 16:04:57</span><br><span class="line">                Time zone: America/New_York (EST, -0500)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br><span class="line">[root@slave ~]# timedatectl list-timezones |grep Shanghai</span><br><span class="line">Asia/Shanghai</span><br><span class="line">[root@slave ~]# timedatectl set-time Asia/Shanghai</span><br><span class="line"></span><br><span class="line">step7	修改配置文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/chrony.conf</span><br><span class="line">server 192.168.2.100 iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">keyfile /etc/chrony.keys</span><br><span class="line">leapsectz right/UTC</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line">step8 启动服务&amp;检查能否连接时间服务器</span><br><span class="line">[root@slave ~]# systemctl start chronyd</span><br><span class="line">[root@slave ~]# chronyc sources -v</span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  &#x27;^&#x27; = server, &#x27;=&#x27; = peer, &#x27;#&#x27; = local clock.</span><br><span class="line"> / .- Source state &#x27;*&#x27; = current synced, &#x27;+&#x27; = combined , &#x27;-&#x27; = not combined,</span><br><span class="line">| /   &#x27;?&#x27; = unreachable, &#x27;x&#x27; = time may be in error, &#x27;~&#x27; = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 192.168.2.100                11   6   377    57    +13ms[ +278us] +/- 3718us</span><br><span class="line"></span><br><span class="line">#可以在2.100上使用date -s命令修改时间，在2.200上重启服务，看到时间同步</span><br><span class="line">chronyc命令</span><br><span class="line"></span><br><span class="line">chronyc sources -v		查看时间同步源</span><br><span class="line">chronyc sourcestats -v	查看时间同步源状态</span><br><span class="line">timedatectl set-local-rtc 1	设置硬件时间硬件时间默认为UTC</span><br><span class="line">timedatectl set-ntp yes	启用NTP时间同步：</span><br><span class="line">chronyc tracking	校准时间服务器：</span><br></pre></td></tr></table></figure>

<h1 id="Linux-双机热备"><a href="#Linux-双机热备" class="headerlink" title="Linux 双机热备"></a>Linux 双机热备</h1><p> 阅读 (255970) </p>
<p> 分享</p>
<h2 id="一-Rsync概述"><a href="#一-Rsync概述" class="headerlink" title="一 Rsync概述"></a>一 Rsync概述</h2><h3 id="1-1、什么是Rsync"><a href="#1-1、什么是Rsync" class="headerlink" title="1.1、什么是Rsync"></a>1.1、什么是Rsync</h3><p>rsync是一款开源，快速，多功能的可实现增量的本地或远程的数据镜像同步备份的优秀工具。适用于多个平台。从软件名称可以看出来是远程同步的意思（remote sync）可实现全量备份与增量备份，因此非常适合用于架构集中式备份或异地备份等应用。</p>
<p><strong>官网：</strong> <a target="_blank" rel="noopener" href="http://rsync.samba.org/">http://rsync.samba.org/</a></p>
<p><strong>端口：</strong> 873</p>
<p><strong>运行模式：</strong> C&#x2F;S B&#x2F;S</p>
<h3 id="1-2、rsync特性"><a href="#1-2、rsync特性" class="headerlink" title="1.2、rsync特性"></a>1.2、rsync特性</h3><p>1、支持拷贝特殊文件如链接文件、设备等</p>
<p>2、可以有排除指定文件或目录同步的功能，相当于tar的排除功能</p>
<p>3、可以做到保持原文件或目录的权限、时间、软硬链接、属主、组等所有属性均不改变</p>
<p>4、可以实现增量同步，即只同步发生变化的数据，因此数据传输效率很高</p>
<p>5、可以使用rcp，rsh，ssh等方式来配合传输文件（rsync本身不对数据加密）</p>
<p>6、可以通过socket（进程方式）传输文件和数据（服务端和客户端）。</p>
<p>7、支持匿名的或认证（无须系统用户）的进程模式传输，可实现方便安全的进行数据备份及镜像</p>
<h3 id="1-3、传输方式"><a href="#1-3、传输方式" class="headerlink" title="1.3、传输方式"></a>1.3、传输方式</h3><p><strong>拉复制(下载)：</strong> rsync备份服务器定期去所有主机上拉取数据</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603525992068.png" alt="image20200116202338681.png"></p>
<p><strong>推复制（上传）：</strong> 所有主服务器将本地数据推送至从服务器</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526014361.png" alt="image20200116202157436.png"></p>
<p>在日常使用中，这两种形式都是混合使用的如：</p>
<p><strong>大量数据备份</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526031950.png" alt="image20200116202528449.png"></p>
<p><strong>异地备份</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526050140.png" alt="image20200116202556118.png"></p>
<h2 id="二-rsync拉复制实战"><a href="#二-rsync拉复制实战" class="headerlink" title="二 rsync拉复制实战"></a>二 rsync拉复制实战</h2><p><strong>环境：</strong></p>
<ul>
<li>两台主机，IP地址为192.168.11.16，192.168.11.100</li>
<li>操作系统为CentOS8</li>
<li>关闭selinux和防火墙</li>
</ul>
<p><strong>需求：</strong> 希望192.168.11.100这台主机&#x2F;cache目录的数据与192.168.11.16这台主机&#x2F;cache目录中的数据保持一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">step1	在192.168.11.16这台主机上制作rsync服务</span><br><span class="line">[root@zutuanxue ~]# rpm -qa | grep rsync</span><br><span class="line">rsync-3.1.3-4.el8.x86_64</span><br><span class="line">#检查是或否安装的相关软件包</span><br><span class="line">[root@zutuanxue ~]# mkdir /etc/rsyncd</span><br><span class="line">[root@zutuanxue ~]# vim rsyncd.conf</span><br><span class="line">uid=root			#定义以哪个用户的身份启动进程	</span><br><span class="line">gid=root			#定义以哪个组的身份启动进程</span><br><span class="line">port=873			#此服务默认端口873</span><br><span class="line">max connections=0		#最大连接数（正整数），0代表不限制。</span><br><span class="line">log file=/var/log/rsyncd.log	#定义日志文件位置</span><br><span class="line">pid file=/var/run/rsyncd.pid	#定义pid文件位置</span><br><span class="line">lock file=/var/run/rsyncd.lock	#定义锁定文件位置，避免多开</span><br><span class="line">motd file=/etc/rsyncd/rsyncd.motd	#定义欢迎信息</span><br><span class="line">read only=yes		#权限为只读</span><br><span class="line">hosts allow=192.168.11.0/24		#允许的网段</span><br><span class="line">hosts deny=*						#拒绝所有，允许个别</span><br><span class="line">[www]	#定义共享名称为www</span><br><span class="line">path=/cache				#路径</span><br><span class="line">list=yes					#允许别人看到</span><br><span class="line">ignore errors			#忽略错误</span><br><span class="line">auth users=hello		#授权的账号</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.secrets	#密码文件</span><br><span class="line"></span><br><span class="line">setp2	建立欢迎信息文件，内容随意</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3	建立密码文件</span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsyncd/rsyncd.secrets</span><br><span class="line">hello：123456</span><br><span class="line">[root@zutuanxue ~]# chmod 600 rsyncd.secrets</span><br><span class="line"></span><br><span class="line">step4	建立cache目录和文件</span><br><span class="line">[root@zutuanxue ~]# mkdir /cache</span><br><span class="line">[root@zutuanxue ~]# touch /cache/file&#123;1..10&#125;</span><br><span class="line"></span><br><span class="line">step5启动服务</span><br><span class="line">[root@zutuanxue ~]# rsync	--daemon		--config=/etc/rsyncd/rsyncd.conf</span><br><span class="line">[root@zutuanxue ~]# lsof	-i	:873</span><br><span class="line"></span><br><span class="line">step6	在192.168.11.100上建立密码文件并修改权限</span><br><span class="line">[root@slave ~]# vim /etc/rsync.pw</span><br><span class="line">123456</span><br><span class="line">[root@slave ~]# chmod 600 /etc/rsync.pw</span><br><span class="line">[root@slave ~]#	mkdir /cache</span><br><span class="line">step7	同步测试</span><br><span class="line">[root@slave ~]#	rsync -avzP	--delete --password-file=/etc/rsync.pw hello@192.168.11.16::www /cache </span><br><span class="line"></span><br><span class="line">rsync参数</span><br><span class="line">-a	归档模式传输，相当于-rlptgoD一起使用</span><br><span class="line">-v	详细模式输出</span><br><span class="line">-z	传输时进行压缩以提高效率</span><br><span class="line">-r	递归传输目录及子目录，即目录下得所有目录都同样传输</span><br><span class="line">-t	保持文件时间信息</span><br><span class="line">-o	保持文件属主信息</span><br><span class="line">-p	保持文件权限</span><br><span class="line">-g	保持文件属组信息</span><br><span class="line">-l 	保留软连接</span><br><span class="line">-P	显示同步的过程及传输时的进度等信息</span><br><span class="line">-D	保持设备文件信息</span><br><span class="line">-L	保留软连接指向的目标文件</span><br><span class="line">--exclude=PATTERN	指定排除不需要传输的文件模式</span><br><span class="line">--bwlimit=1m	限速传输</span><br><span class="line">--delete	让目标目录和源目录数据保持一致</span><br><span class="line">--password-file	指定密码文件位置</span><br><span class="line"></span><br><span class="line">step8	定义计划任务</span><br><span class="line">[root@slave ~]#	crontab -e</span><br><span class="line">* * * * * rsync -avzP	--delete --password-file=/etc/rsync.pw hello@192.168.11.16::www /cache</span><br><span class="line"></span><br><span class="line">step9	将11.16主机上文件进行调整，观察是否改变</span><br></pre></td></tr></table></figure>

<h2 id="三-Rsync推复制"><a href="#三-Rsync推复制" class="headerlink" title="三 Rsync推复制"></a>三 Rsync推复制</h2><p><strong>环境：</strong></p>
<ul>
<li>两台主机，IP地址为192.168.11.16，192.168.11.100</li>
<li>操作系统为CentOS8</li>
<li>关闭selinux和防火墙</li>
</ul>
<p><strong>需求：</strong> 希望192.168.11.100这台主机&#x2F;cache目录的数据与192.168.11.16这台主机&#x2F;cache目录中的数据保持一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">注：停止192.168.11.16主机上的rsync服务</span><br><span class="line">step1	在192.168.11.100这台主机上制作rsync服务</span><br><span class="line">[root@slave ~]# rpm -qa | grep rsync</span><br><span class="line">rsync-3.1.3-4.el8.x86_64</span><br><span class="line">#检查是或否安装的相关软件包</span><br><span class="line">[root@slave ~]# mkdir /etc/rsyncd</span><br><span class="line">[root@slave ~]# vim rsyncd.conf</span><br><span class="line">uid=root			#定义以哪个用户的身份启动进程	</span><br><span class="line">gid=root			#定义以哪个组的身份启动进程</span><br><span class="line">port=873			#此服务默认端口873</span><br><span class="line">max connections=0		#最大连接数（正整数），0代表不限制。</span><br><span class="line">log file=/var/log/rsyncd.log	#定义日志文件位置</span><br><span class="line">pid file=/var/run/rsyncd.pid	#定义pid文件位置</span><br><span class="line">lock file=/var/run/rsyncd.lock	#定义锁定文件位置，避免多开</span><br><span class="line">motd file=/etc/rsyncd/rsyncd.motd	#定义欢迎信息</span><br><span class="line">read only=no		#权限为不只读（可写）</span><br><span class="line">hosts allow=192.168.11.0/24		#允许的网段</span><br><span class="line">hosts deny=*						#拒绝所有，允许个别</span><br><span class="line">[www]	#定义共享名称为www</span><br><span class="line">path=/cache				#路径</span><br><span class="line">list=yes					#允许别人看到</span><br><span class="line">ignore errors			#忽略错误</span><br><span class="line">auth users=hello		#授权的账号</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.secrets	#密码文件</span><br><span class="line"></span><br><span class="line">setp2	建立欢迎信息文件，内容随意</span><br><span class="line">[root@slave ~]# vim /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step3	建立密码文件</span><br><span class="line">[root@slave ~]# vim /etc/rsyncd/rsyncd.secrets</span><br><span class="line">hello：123456</span><br><span class="line">[root@slave ~]# chmod 600 rsyncd.secrets</span><br><span class="line"></span><br><span class="line">step4	建立cache目录</span><br><span class="line">[root@slave ~]# mkdir /cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">step5启动服务</span><br><span class="line">[root@slave ~]# rsync	--daemon		--config=/etc/rsyncd/rsyncd.conf</span><br><span class="line">[root@slave ~]# lsof	-i	:873</span><br><span class="line"></span><br><span class="line">step6	在192.168.11.16上安装监控软件</span><br><span class="line">[root@zutuanxue ~]# tar fx sersync2.5_32bit_binary_stable_final.tar.gz -C /usr/src/</span><br><span class="line">[root@zutuanxue ~]# cd /usr/src/GNU-Linux-x86/</span><br><span class="line"></span><br><span class="line">step7	配置监控软件</span><br><span class="line">[root@zutuanxue ~]# vim confxml.xml </span><br><span class="line">&lt;sersync&gt;</span><br><span class="line">        &lt;localpath watch=&quot;/cache&quot;&gt;</span><br><span class="line">            &lt;remote ip=&quot;192.168.11.100&quot; name=&quot;www&quot;/&gt;</span><br><span class="line">						.</span><br><span class="line">						.</span><br><span class="line">						.</span><br><span class="line">					&lt;rsync&gt;</span><br><span class="line">            &lt;commonParams params=&quot;-artuz&quot;/&gt;</span><br><span class="line">            &lt;auth start=&quot;true&quot; users=&quot;hello&quot; passwordfile=&quot;/etc/rsync.pw&quot;/&gt;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /etc/rsync.pw</span><br><span class="line">123456</span><br><span class="line">[root@zutuanxue ~]# chmod 600 rsync.pw </span><br><span class="line"></span><br><span class="line">step8	启动监控软件</span><br><span class="line">[root@zutuanxue ~]# ./sersync2	-r	#第一次启动加-r 可以查看到工作流程</span><br><span class="line"></span><br><span class="line">step9	重新打开一个终端，在192.168.11.16上建立、删除文件，去192.168.11.100上查看是否同步成功</span><br></pre></td></tr></table></figure>

<h1 id="部署linux网络安装服务器"><a href="#部署linux网络安装服务器" class="headerlink" title="部署linux网络安装服务器"></a>部署linux网络安装服务器</h1><p> 阅读 (3171521) </p>
<p> 分享</p>
<h2 id="一、批量部署概述"><a href="#一、批量部署概述" class="headerlink" title="一、批量部署概述"></a>一、批量部署概述</h2><p><strong>什么是PXE</strong><br>预启动执行环境（PXE）是由Intel公司开发的最新技术，工作于Client&#x2F;Server的网络模式，支持工作站通过网络从远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP（trivial file transfer protocol）或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。PXE可以引导多种操作系统，如：Windows95&#x2F;98&#x2F;2000&#x2F;windows2003&#x2F;windows2008&#x2F;winXP&#x2F;win7&#x2F;win8,linux系列系统等。</p>
<p><strong>PXE原理</strong><br>PXE是在没有软驱、硬盘、CD-ROM的情况下引导计算机的一种方式，也就是BIOS将使用PXE协议从网络引导。整个安装的过程是这样的：</p>
<p>PXE网卡启动 &#x3D;&gt; DHCP获得IP地址 &#x3D;&gt; 从TFTP上下载 pxelinux.0、vmlinuz、initr.img 等 &#x3D;&gt; 引导系统进入安装步骤 &#x3D;&gt; 通过PEX linux 下载ks.cfg文件并跟据ks.cfg自动化安装系统 &#x3D;&gt; 完成。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526488594.png" alt="image20200403143123698.png"></p>
<p><strong>TFTP服务</strong><br>TFTP是用来下载远程文件的最简单网络协议，它其于UDP协议而实现。</p>
<p><strong>什么是kickstart</strong><br>KickStart是一种无人职守安装方式。KickStart的工作原理是通过记录典型的安装过程中所需人工干预填写的各种参数，并生成一个名为ks.cfg的文件；在其后的安装过程中（不只局限于生成KickStart安装文件的机器）当出现要求填写参数的情况时，安装程序会首先去查找KickStart生成的文件，当找到合适的参数时，就采用找到的参数，当没有找到合适的参数时，才需要安装者手工干预。这样，如果KickStart文件涵盖了安装过程中出现的所有需要填写的参数时，安装者完全可以只告诉安装程序从何处取ks.cfg文件，然后去忙自己的事情。等安装完毕，安装程序会根据ks.cfg中设置的重启选项来重启系统，并结束安装。</p>
<h2 id="二、批量部署原理"><a href="#二、批量部署原理" class="headerlink" title="二、批量部署原理"></a>二、批量部署原理</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526515184.png" alt="image20200403144115628.png"></p>
<p><strong>1、PXE Client向DHCP发送请求：</strong><br>　　PXE Client从自己的PXE网卡启动，通过PXE BootROM(自启动芯片)会以UDP(简单用户数据报协议)发送一个广播请求，向本网络中的DHCP服务器索取IP。</p>
<p><strong>2、DHCP服务器提供信息：</strong><br>　　DHCP服务器收到客户端的请求，验证是否来至合法的PXE Client的请求，验证通过它将给客户端一个“提供”响应，这个“提供”响应中包含了为客户端分配的IP地址、pxelinux启动程序(TFTP)位置，以及配置文件所在位置。</p>
<p><strong>3、PXE客户端请求下载启动文件：</strong><br>　　客户端收到服务器的“回应”后，会回应一个帧，以请求传送启动所需文件。这些启动文件包括：pxelinux.0、pxelinux.cfg&#x2F;default、vmlinuz、initrd.img等文件。</p>
<p><strong>4、Boot Server响应客户端请求并传送文件：</strong><br>　　当服务器收到客户端的请求后，他们之间之后将有更多的信息在客户端与服务器之间作应答, 用以决定启动参数。BootROM由TFTP通讯协议从Boot Server下载启动安装程序所必须的文件(pxelinux.0、pxelinux.cfg&#x2F;default)。default文件下载完成后，会根据该文件中定义的引导顺序，启动Linux安装程序的引导内核。</p>
<p><strong>5、请求下载自动应答文件：</strong><br>　　客户端通过pxelinux.cfg&#x2F;default文件成功的引导Linux安装内核后，安装程序首先必须确定你通过什么安装介质来安装linux，如果是通过网络安装(NFS, FTP, HTTP)，则会在这个时候初始化网络，并定位安装源位置。接着会读取default文件中指定的自动应答文件ks.cfg所在位置，根据该位置请求下载该文件。<br>　　这里有个问题，在第2步和第5步初始化2次网络了，这是由于PXE获取的是安装用的内核以及安装程序等，而安装程序要获取的是安装系统所需的二进制包以及配置文件。因此PXE模块和安装程序是相对独立的，PXE的网络配置并不能传递给安装程序，从而进行两次获取IP地址过程，但IP地址在DHCP的租期内是一样的。</p>
<p><strong>6、客户端安装操作系统：</strong><br>　　将ks.cfg文件下载回来后，通过该文件找到OS Server，并按照该文件的配置请求下载安装过程需要的软件包。<br>　　OS Server和客户端建立连接后，将开始传输软件包，客户端将开始安装操作系统。安装完成后，将提示重新引导计算机。</p>
<h2 id="三、kickstart批量部署实战"><a href="#三、kickstart批量部署实战" class="headerlink" title="三、kickstart批量部署实战"></a>三、kickstart批量部署实战</h2><p>环境：</p>
<ul>
<li>selinux关闭，防火墙关闭</li>
<li>Server：192.168.2.100</li>
</ul>
<p><strong>Step 1 配置dnf源</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat server.repo </span><br><span class="line">[serverApp]</span><br><span class="line">name=app</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/AppStream</span><br><span class="line">[serverOS]</span><br><span class="line">name=os</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/BaseOS</span><br></pre></td></tr></table></figure>

<p><strong>Step 2 安装软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install dhcp-server tftp-server httpd syslinux -y</span><br></pre></td></tr></table></figure>

<p><strong>Step 3 搭建并启动DHCP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/dhcp/dhcpd.conf </span><br><span class="line">subnet 192.168.2.0 netmask 255.255.255.0 &#123;</span><br><span class="line">        option routers          192.168.2.100;</span><br><span class="line">        range                   192.168.2.10    192.168.2.20;</span><br><span class="line">        next-server             192.168.2.100;</span><br><span class="line">        filename                &quot;pxelinux.0&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status dhcpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlup | grep :67</span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           31465/dhcpd         </span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1345/dnsmasq        </span><br></pre></td></tr></table></figure>

<p><strong>Step 4 生成需要的文件并启动tftp服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cp /usr/share/syslinux/pxelinux.0		/var/lib/tftpboot/</span><br><span class="line">[root@zutuanxue ~]# cp /mnt/isolinux/&#123;vmlinuz,ldlinux.c32,initrd.img&#125; 		/var/lib/tftpboot/</span><br><span class="line">[root@zutuanxue ~]# mkdir /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line">[root@zutuanxue ~]# vim /var/lib/tftpboot/pxelinux.cfg/default			#生成default文件</span><br><span class="line">default linux</span><br><span class="line">timeout 3</span><br><span class="line">label linux</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img ip=dhcp method=http://192.168.2.100/RHEL ks=http://192.168.2.100/ks.cfg</span><br><span class="line">[root@zutuanxue mnt]# systemctl start tftp			#启动tftp服务</span><br><span class="line">[root@zutuanxue mnt]# systemctl status tftp</span><br><span class="line">[root@zutuanxue mnt]# netstat -antulp | grep :69</span><br><span class="line">udp6       0      0 :::69                   :::*                                1/systemd           </span><br></pre></td></tr></table></figure>

<p><strong>Step 5 搭建并启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# mkdir /var/www/html/RHEL		#建立软件包存放目录</span><br><span class="line">[root@zutuanxue ~]# mount /dev/cdrom /var/www/html/RHEL		#将光盘挂载到对应目录中</span><br></pre></td></tr></table></figure>

<p><strong>Step 6 生成ks.cfg文件</strong></p>
<p>由于CentOS8.0中没有system-config-kickstart包，所以无法通过工具生成ks文件，需要手动生成，例子中root用户和新建的hello用户的密码都为‘&#96;123qwe’</p>
<p>如果需要自己额外指定密码，请使用其它工具进行转换，例如doveadm命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">cp /root/anaconda-ks.cfg /var/www/html/ks.cfg	#生成ks.cfg文件</span><br><span class="line">[root@zutuanxue ~]# vim /var/www/html/ks.cfg</span><br><span class="line">#version=RHEL8</span><br><span class="line">ignoredisk --only-use=sda</span><br><span class="line">autopart --type=lvm</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all			#删除所有分区</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">url  --url=&quot;http://192.168.2.100/RHEL/&quot;			#指定安装URL</span><br><span class="line"># Keyboard layouts</span><br><span class="line">keyboard --vckeymap=cn --xlayouts=&#x27;cn&#x27;</span><br><span class="line"># System language</span><br><span class="line">lang zh_CN.UTF-8</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate</span><br><span class="line">network  --hostname=localhost.localdomain</span><br><span class="line">##root用户的密码&quot;111111&quot;</span><br><span class="line">rootpw --iscrypted $6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1</span><br><span class="line"># X Window System configuration information</span><br><span class="line">xconfig  --startxonboot</span><br><span class="line"># Run the Setup Agent on first boot</span><br><span class="line">#firstboot disable		#初次启动设置</span><br><span class="line">firstboot --disable</span><br><span class="line"># System services</span><br><span class="line">services --enabled=&quot;chronyd&quot;</span><br><span class="line"># System timezone</span><br><span class="line">timezone America/New_York --isUtc</span><br><span class="line">#Reboot after installation	#安装完成后自动重启</span><br><span class="line">reboot</span><br><span class="line"># License agreement		#同意授权协议</span><br><span class="line">eula --agreed</span><br><span class="line">#添加一个普通用户名字为zutuanxue密码&quot;111111&quot; 属组为 whell</span><br><span class="line">user --groups=wheel --name=zutuanxue --password=$6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1 --iscrypted --gecos=&quot;zutuanxue&quot;</span><br><span class="line">%packages</span><br><span class="line">@^graphical-server-environment</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%addon com_redhat_kdump --disable --reserve-mb=&#x27;auto&#x27;</span><br><span class="line"></span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%anaconda</span><br><span class="line">pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok</span><br><span class="line">pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<p><strong>Step 7 修改文件权限，启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chmod a+r /var/www/html/ks.cfg</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status httpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlp | grep :80</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      33976/httpd         </span><br></pre></td></tr></table></figure>

<p><strong>Step 8 测试</strong></p>
<p>选择网络启动</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526811897.png" alt="image20191202110450898.png"></p>
<p>获取IP和相关文件</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526828444.png" alt="image20191202110525859.png"></p>
<p>开启安装进程</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526884300.png" alt="install6.png"></p>
<p>安装完成后自动重启</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603526915193.png" alt="install7.png"></p>
<h2 id="四、kickstart-uefi批量部署"><a href="#四、kickstart-uefi批量部署" class="headerlink" title="四、kickstart+uefi批量部署"></a>四、kickstart+uefi批量部署</h2><p><strong>环境：</strong></p>
<ul>
<li>selinux关闭，防火墙关闭</li>
<li>Server：192.168.2.100</li>
</ul>
<p><strong>Step 1 配置dnf源</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cat server.repo </span><br><span class="line">[serverApp]</span><br><span class="line">name=app</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/AppStream</span><br><span class="line">[serverOS]</span><br><span class="line">name=os</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">baseurl=file:///mnt/BaseOS</span><br></pre></td></tr></table></figure>

<p><strong>Step 2 安装软件包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# dnf install dhcp-server tftp-server httpd -y</span><br></pre></td></tr></table></figure>

<p><strong>Step 3 搭建并启动DHCP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# vim /etc/dhcp/dhcpd.conf </span><br><span class="line">subnet 192.168.2.0 netmask 255.255.255.0 &#123;</span><br><span class="line">        option routers          192.168.2.100;</span><br><span class="line">        range                   192.168.2.10    192.168.2.20;</span><br><span class="line">        next-server             192.168.2.100;</span><br><span class="line">        filename                &quot;BOOTX64.EFI&quot;;#注意差异，使用的不是pxelinux.0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# systemctl start dhcpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status dhcpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlup | grep :67</span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           31465/dhcpd         </span><br><span class="line">udp        0      0 0.0.0.0:67              0.0.0.0:*                           1345/dnsmasq        </span><br></pre></td></tr></table></figure>

<p><strong>Step 4 生成需要的文件并启动tftp服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# cd /mnt/EFI/BOOT/</span><br><span class="line">[root@zutuanxue BOOT]# cp BOOTX64.EFI grub.cfg grubx64.efi /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# cp /mnt/isolinux/&#123;vmlinuz,initrd.img&#125; 		/var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line">[root@zutuanxue ~]# vim /var/lib/tftpboot/grub.cfg</span><br><span class="line">set default=&quot;0&quot;</span><br><span class="line">set timeout=3</span><br><span class="line">menuentry &#x27;Install CentOS Linux 8.0.1905&#x27;  &#123;</span><br><span class="line">        linuxefi /vmlinuz ip=dhcp ks=http://192.168.2.100/ks.cfg</span><br><span class="line">        initrdefi /initrd.img</span><br><span class="line">&#125;</span><br><span class="line">[root@zutuanxue mnt]# systemctl start tftp			#启动tftp服务</span><br><span class="line">[root@zutuanxue mnt]# systemctl status tftp</span><br><span class="line">[root@zutuanxue mnt]# netstat -antulp | grep :69</span><br><span class="line">udp6       0      0 :::69                   :::*                                1/systemd           </span><br></pre></td></tr></table></figure>

<p><strong>Step 5 搭建并启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# mkdir /var/www/html/RHEL		#建立软件包存放目录</span><br><span class="line">[root@zutuanxue ~]# mount /dev/cdrom /var/www/html/RHEL		#将光盘挂载到对应目录中</span><br></pre></td></tr></table></figure>

<p><strong>Step 6 生成ks.cfg文件</strong></p>
<p>由于CentOS8.0中没有system-config-kickstart包，所以无法通过工具生成ks文件，需要手动生成，例子中root用户和新建的hello用户的密码都为‘&#96;123qwe’</p>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/labs/kickstartconfig/">https://access.redhat.com/labs/kickstartconfig/</a></p>
<p>如果需要自己额外指定密码，请使用其它工具进行转换，例如doveadm命令，但是系统没有这个工具，所以推荐使用python来实现</p>
<p>注意：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# python3 -c &#x27;import crypt,getpass;pw=&quot;zutuanxue&quot;;print(crypt.crypt(pw))&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>生成ks.cfg文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">cp /root/anaconda-ks.cfg /var/www/html/ks.cfg	#生成ks.cfg文件</span><br><span class="line">[root@zutuanxue ~]# vim /var/www/html/ks.cfg</span><br><span class="line">#version=RHEL8</span><br><span class="line">ignoredisk --only-use=nvme0n1    ###注意这是与BIOS方式差异的位置，注意设备类型，可在BIOS中查看到</span><br><span class="line">autopart --type=lvm</span><br><span class="line"># Partition clearing information</span><br><span class="line">clearpart --all			#删除所有分区</span><br><span class="line"># Use graphical install</span><br><span class="line">graphical</span><br><span class="line">url     --url=&quot;http://192.168.2.100/RHEL/&quot;			#指定安装URL</span><br><span class="line"># Keyboard layouts</span><br><span class="line">keyboard --vckeymap=cn --xlayouts=&#x27;cn&#x27;</span><br><span class="line"># System language</span><br><span class="line">lang zh_CN.UTF-8</span><br><span class="line"># Network information</span><br><span class="line">network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate</span><br><span class="line">network  --hostname=localhost.localdomain</span><br><span class="line"># Root password	“`123qwe”			##root用户的密码&quot;111111&quot;</span><br><span class="line">rootpw --iscrypted $6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1</span><br><span class="line"># X Window System configuration information</span><br><span class="line">xconfig  --startxonboot</span><br><span class="line"># Run the Setup Agent on first boot</span><br><span class="line">#firstboot disable		#初次启动设置</span><br><span class="line">firstboot --disable</span><br><span class="line"># System services</span><br><span class="line">services --enabled=&quot;chronyd&quot;</span><br><span class="line"># System timezone</span><br><span class="line">timezone America/New_York --isUtc</span><br><span class="line">#Reboot after installation	#安装完成后自动重启</span><br><span class="line">reboot</span><br><span class="line"># License agreement		#同意授权协议</span><br><span class="line">eula --agreed</span><br><span class="line">#添加一个普通用户名字为zutuanxue密码&quot;111111&quot; 属组为 whell</span><br><span class="line">user --groups=wheel --name=zutuanxue --password=$6$kdHt1qIdgNPlHUD1$zibMjh/AQGZQjIJe8Q4HYiin.IKaV7MHWciueiwbLD/03giuSqzU5ynSu/giDAjMLpJFj/CpNgT7TKSm5XyxV1 --iscrypted --gecos=&quot;zutuanxue&quot;</span><br><span class="line">%packages</span><br><span class="line">@^graphical-server-environment</span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%addon com_redhat_kdump --disable --reserve-mb=&#x27;auto&#x27;</span><br><span class="line"></span><br><span class="line">%end</span><br><span class="line"></span><br><span class="line">%anaconda</span><br><span class="line">pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok</span><br><span class="line">pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<p><strong>Step 7 修改文件权限，启动http服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zutuanxue ~]# chmod a+r /var/www/html/ks.cfg</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl start httpd</span><br><span class="line">[root@zutuanxue ~]# systemctl status httpd</span><br><span class="line">[root@zutuanxue ~]# netstat -antlp | grep :80</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      33976/httpd         </span><br></pre></td></tr></table></figure>

<p><strong>Step 8 测试</strong></p>
<p>新建虚拟机的是要选择自定义使用UEFI</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/15/zutuanxue-Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8/" rel="prev" title="zutuanxue-Linux系统管理宝典">
      <i class="fa fa-chevron-left"></i> zutuanxue-Linux系统管理宝典
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/15/zutuanxue-Web%E6%9C%8D%E5%8A%A1%E5%99%A8-Apache/" rel="next" title="zutuanxue-Web服务器-Apache">
      zutuanxue-Web服务器-Apache <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#DHCP%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.</span> <span class="nav-text">DHCP服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81DHCP%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">一、DHCP介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81DHCP%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.</span> <span class="nav-text">二、DHCP应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.3.</span> <span class="nav-text">三、DHCP工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%EF%BC%89%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1）工作方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%EF%BC%89%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2）工作原理解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%8E%B7%E5%BE%97IP%E7%9A%84%E6%97%B6%E9%97%B4%E7%82%B9"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3)计算机获得IP的时间点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4%EF%BC%89%E7%A7%9F%E7%BA%A6%E6%9B%B4%E6%96%B0%E9%98%B6%E6%AE%B5"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4）租约更新阶段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">1.4.</span> <span class="nav-text">四、DHCP服务器部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%EF%BC%89DHCP%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1）DHCP安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%EF%BC%89DHCP%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2）DHCP配置文件详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%EF%BC%89DHCP%E5%90%AF%E5%8A%A8"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3）DHCP启动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81DHCP%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.5.</span> <span class="nav-text">五、DHCP作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-DHCP%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1)DHCP服务配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%EF%BC%89%E9%87%8D%E5%90%AFDHCP%E6%9C%8D%E5%8A%A1%EF%BC%8C%E7%94%9F%E6%95%88%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2）重启DHCP服务，生效配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3%EF%BC%89%E6%B5%8B%E8%AF%95IP%E5%88%86%E5%8F%91"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3）测试IP分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4%EF%BC%89%E9%80%9A%E8%BF%87DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A7%9F%E7%BA%A6%E6%96%87%E4%BB%B6%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E7%A7%9F%E7%BA%A6"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.4）通过DHCP服务器租约文件查看具体租约</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5%EF%BC%89%E4%BF%9D%E7%95%99IP"><span class="nav-number">1.5.5.</span> <span class="nav-text">5.5）保留IP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81DHCP%E8%B6%85%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">1.6.</span> <span class="nav-text">六、DHCP超级作用域</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E8%A1%A5%E5%85%85"><span class="nav-number">1.7.</span> <span class="nav-text">七、补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%A6%82%E6%9E%9C%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%8E%B7%E5%BE%97%E4%B8%8D%E5%88%B0-IP%E4%BC%9A%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.1) 如果客户端获得不到 IP会怎么办</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2%EF%BC%89DHCP%E4%BC%9A%E9%9D%A2%E4%B8%B4%E5%8D%95%E6%9C%BA%E6%95%85%E9%9A%9C%EF%BC%8C%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.2）DHCP会面临单机故障，如何解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3%EF%BC%89%E6%8A%93%E5%8C%85%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.3）抓包验证方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4%EF%BC%89%E5%A6%82%E4%BD%95%E5%8F%91%E6%94%BE%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%8D%E7%A7%B0"><span class="nav-number">1.7.4.</span> <span class="nav-text">7.4）如何发放计算机名称</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DNS%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.</span> <span class="nav-text">DNS服务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81DNS%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.</span> <span class="nav-text">一、DNS介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81DNS%E7%9A%84%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">二、DNS的解析原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81DNS%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.3.</span> <span class="nav-text">三、DNS查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="nav-number">2.4.</span> <span class="nav-text">四、DNS服务器部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%EF%BC%89DNS%E5%AE%89%E8%A3%85"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1）DNS安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%EF%BC%89DNS%E5%90%AF%E5%8A%A8"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2）DNS启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3%EF%BC%89DNS%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.4.3.</span> <span class="nav-text">4.3）DNS配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-number">2.5.</span> <span class="nav-text">五、部署一个正向解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1%EF%BC%89%E6%95%99%E5%AD%A6%E6%A1%88%E4%BE%8B"><span class="nav-number">2.5.1.</span> <span class="nav-text">5.1）教学案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%EF%BC%89%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95"><span class="nav-number">2.5.2.</span> <span class="nav-text">5.2）测试方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-number">2.6.</span> <span class="nav-text">六、部署一个反向解析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%97%E4%BD%99"><span class="nav-number">2.7.</span> <span class="nav-text">七、DNS服务器冗余</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E6%99%BA%E8%83%BDDNS"><span class="nav-number">2.8.</span> <span class="nav-text">八、智能DNS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#FTP%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">FTP文件服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81FTP%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.</span> <span class="nav-text">一、FTP介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.2.</span> <span class="nav-text">二、应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81FTP%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-number">3.3.</span> <span class="nav-text">三、FTP的权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81FTP%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.</span> <span class="nav-text">四、FTP的工作模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81FTP%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="nav-number">3.5.</span> <span class="nav-text">五、FTP安装部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81FTP%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.6.</span> <span class="nav-text">六、FTP配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1%EF%BC%89%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="nav-number">3.6.1.</span> <span class="nav-text">6.1）相关文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2%EF%BC%89%E4%B8%BB%E9%85%8D%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.6.2.</span> <span class="nav-text">6.2）主配文件详解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81FTP%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE"><span class="nav-number">3.7.</span> <span class="nav-text">七、FTP客户端访问</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1%EF%BC%89%E6%96%87%E6%9C%AC%E7%95%8C%E9%9D%A2%E7%99%BB%E9%99%86"><span class="nav-number">3.7.1.</span> <span class="nav-text">7.1）文本界面登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2%EF%BC%89FTP%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">3.7.2.</span> <span class="nav-text">7.2）FTP客户端常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%9F%BA%E4%BA%8E%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8%E7%9A%84ftp"><span class="nav-number">3.8.</span> <span class="nav-text">八、基于虚拟用户配置安全的ftp</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">Linux 时间服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">4.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E6%88%98"><span class="nav-number">4.2.</span> <span class="nav-text">时间服务器实战</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87"><span class="nav-number">5.</span> <span class="nav-text">Linux 双机热备</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-Rsync%E6%A6%82%E8%BF%B0"><span class="nav-number">5.1.</span> <span class="nav-text">一 Rsync概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFRsync"><span class="nav-number">5.1.1.</span> <span class="nav-text">1.1、什么是Rsync</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E3%80%81rsync%E7%89%B9%E6%80%A7"><span class="nav-number">5.1.2.</span> <span class="nav-text">1.2、rsync特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3%E3%80%81%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="nav-number">5.1.3.</span> <span class="nav-text">1.3、传输方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-rsync%E6%8B%89%E5%A4%8D%E5%88%B6%E5%AE%9E%E6%88%98"><span class="nav-number">5.2.</span> <span class="nav-text">二 rsync拉复制实战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-Rsync%E6%8E%A8%E5%A4%8D%E5%88%B6"><span class="nav-number">5.3.</span> <span class="nav-text">三 Rsync推复制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2linux%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">6.</span> <span class="nav-text">部署linux网络安装服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2%E6%A6%82%E8%BF%B0"><span class="nav-number">6.1.</span> <span class="nav-text">一、批量部署概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2%E5%8E%9F%E7%90%86"><span class="nav-number">6.2.</span> <span class="nav-text">二、批量部署原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81kickstart%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%88%98"><span class="nav-number">6.3.</span> <span class="nav-text">三、kickstart批量部署实战</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81kickstart-uefi%E6%89%B9%E9%87%8F%E9%83%A8%E7%BD%B2"><span class="nav-number">6.4.</span> <span class="nav-text">四、kickstart+uefi批量部署</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2653</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
