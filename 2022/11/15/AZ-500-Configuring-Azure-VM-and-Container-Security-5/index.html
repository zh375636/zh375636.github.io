<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionHi there. Welcome to Configuring Azure VM and Container Security. My name is Thomas Mitchell and I’ll be leading you through this course. I’m an Azure instructor at Cloud Academy and I hav">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-500-Configuring-Azure-VM-and-Container-Security-5">
<meta property="og:url" content="https://example.com/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionHi there. Welcome to Configuring Azure VM and Container Security. My name is Thomas Mitchell and I’ll be leading you through this course. I’m an Azure instructor at Cloud Academy and I hav">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-15T14:11:25.000Z">
<meta property="article:modified_time" content="2022-11-19T15:31:44.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-500-Configuring-Azure-VM-and-Container-Security-5 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-500-Configuring-Azure-VM-and-Container-Security-5
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-15 10:11:25" itemprop="dateCreated datePublished" datetime="2022-11-15T10:11:25-04:00">2022-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-19 11:31:44" itemprop="dateModified" datetime="2022-11-19T11:31:44-04:00">2022-11-19</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/15/AZ-500-Configuring-Azure-VM-and-Container-Security-5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hi there. Welcome to Configuring Azure VM and Container Security. My name is Thomas Mitchell and I’ll be leading you through this course.</p>
<p>I’m an Azure instructor at Cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions, feel free to connect with me on LinkedIn or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for people who want to become Microsoft-certified Azure security engineers or those who are simply tasked with implementing security controls, maintaining the security posture of an Azure environment, or protecting data, applications, and networks. To get the most from this course, you should have a moderate understanding of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Microsoft Azure</a> and of basic security principles.</p>
<p>To kick things off, we’re going to start with host security. We’re going to dive into <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-endpoint-security-within-vms/">configuring endpoint security</a> within VMs and how to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/hardening-virtual-machines/">harden VMs in Microsoft Azure</a>. We’ll also get into configuring system updates for VMs in Azure, as well as baseline configuration.</p>
<p>Next, we’ll get into configuring container security. You’ll learn how to configure networks, authentication, and container isolation. You’ll also learn how to configure AKS security and how to configure container registry.</p>
<p>Lastly, you’ll learn about vulnerability management tools and strategies.</p>
<p>By the time you finish this course, you should have a full understanding of how to configure Azure VM and container security.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished.</p>
<p>If you’re ready to learn how to configure Azure VM and container security, let’s get started.</p>
<h3 id="Lectures"><a href="#Lectures" class="headerlink" title="Lectures"></a>Lectures</h3><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-endpoint-security-within-vms/">Configuring Endpoint Security within VMs</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-and-monitoring-antimalmare-vms/">Configuring and Monitoring Antimalmare for VMs</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-virtual-machine-security/">Configuring Virtual Machine Security</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/hardening-virtual-machines/">Hardening Virtual Machines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-system-updates-for-virtual-machines/">Configuring System Updates for Virtual Machines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/starting-runbook-azure-portal/">Starting a Runbook from the Azure Portal</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-baselines/">Configuring Baselines</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/azure-networking/">Azure Networking</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/configuring-authentication/">Configuring Authentication</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/container-isolation/">Container Isolation</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/aks-security/">AKS Security</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/azure-container-registry/">Azure Container Registry</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/creating-container-registry/">Creating a Container Registry</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/implementing-vulnerability-management/">Implementing Vulnerability Management</a> - <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/configuring-azure-vm-and-container-security/conclusion/">Conclusion</a></p>
<h1 id="Configuring-Endpoint-Security-within-VMs"><a href="#Configuring-Endpoint-Security-within-VMs" class="headerlink" title="Configuring Endpoint Security within VMs"></a>Configuring Endpoint Security within VMs</h1><p>Hi there, welcome to Configuring Endpoint Security within VMs. The term endpoint system refers to a computer system that interacts directly with an end user. So this means that devices like desktop computers, laptops, tablets and smartphones are all considered endpoint systems. That being the case, they need to be secured. Failing to properly secure these endpoint systems opens them up to becoming launchpads for security attacks on other networked systems.</p>
<p>Because securing infrastructure-as-a-service offerings requires more customer responsibility than platform-as-a-service and software-as-a-service did, Microsoft has made available the Azure Security Center. The Azure Security Center provides you with the tools that are necessary for hardening your network and securing your services.</p>
<p>The first step to protecting your virtual machines is to protect them from malware. To do this, you need to install anti-malware on them. This helps you identify and remove viruses, spyware, and many other kinds of malicious software. There are two ways you can go about this. You can either install Microsoft Antimalware, or you can install a third-party endpoint protection solution.</p>
<p>Once you have your anti-malware solution installed on your virtual machines, you’ll want to integrate that solution with Azure Security Center so you can monitor the status of your anti-malware protection on those VMs.</p>
<p>Azure Security Center allows you to view reports on the Endpoint protection issues blade. What it does is highlight detected threats and insufficient protection, which obviously make your VMs vulnerable to malware threats. By deploying anti-malware on your machines and then integrating it with Azure Security Center, you’ll have the information necessary to create plans for addressing potential threats.</p>
<p>In the upcoming demonstration, I’ll show you how to configure and monitor anti-malware on virtual machines.</p>
<h1 id="Configuring-and-Monitoring-Antimalmare-for-VMs"><a href="#Configuring-and-Monitoring-Antimalmare-for-VMs" class="headerlink" title="Configuring and Monitoring Antimalmare for VMs"></a>Configuring and Monitoring Antimalmare for VMs</h1><p>In this demonstration, I’m going to show you how to enable and configure Microsoft Antimalware while provisioning a new VM in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal.</p>
<p>On the screen here, you can see I’m in the Azure portal. So what I’m going to do is deploy a new VM. Now, we’re not gonna do step by step on VM deployment because I’m going to assume you know how to do that already. I just want to show you where you’d go to deploy the Microsoft Antimalware during this process.</p>
<p>So what we’re going to do is select virtual machines here. And then we’re going to click add to deploy a new VM. And what we’ll do here is we’ll just select one of my test resource groups here. And we’ll give our new VM a name, not doing anything specific here. And we’ll leave our region and information here at their defaults. We will select our Windows Server OS image here, since we are installing the Microsoft Antimalware. And we’ll specify a username here. Okay, and we’ll leave everything else here at its default.</p>
<p>We’ll move on to disks. Again, we’ll leave everything at its default. What we’re going to do is get over here into advanced. So we’ll click through networking. We’ll leave our default network interface information set here. We’ll go into management. Again, we’ll leave everything at the default here. I’m not trying to show you how to configure management of a VM. And then we’ll go into advanced. Now, under advanced here, under extensions, what we do is click the select an extension to install link. And what this is going to do is allow us to select an extension we want to install. And over here on the right, we can see Microsoft Antimalware as an option. We’ll select that, and then we’ll click create.</p>
<p>Now, in the installation configuration screen here, we can exclude certain files and locations. We can exclude different extensions and even processes for Antimalware. And then we can enable or disable real-time protection, or we can configure it to run a scheduled scan. The scan type here allows us to specify whether we want to do a quick scan or a full scan. And then, of course, we can specify the day and the scan time. I’ll leave these options at their defaults. We’ll click OK. And then from here, what we would do is go back down to the bottom of the page for our VM creation. We would review and create. And then what we would do is create the VM. When this VM is deployed, it’s going to be deployed with Microsoft Antimalware installed. And that’s pretty much it. It’s not real difficult to get Microsoft Antimalware installed, but I wanted to show you that process and where you needed to go to install that extension.</p>
<h1 id="Configuring-Virtual-Machine-Security"><a href="#Configuring-Virtual-Machine-Security" class="headerlink" title="Configuring Virtual Machine Security"></a>Configuring Virtual Machine Security</h1><p>Hi there, welcome to Configuring VM Security. Before we get into VM policies and templates, I should probably make sure that you first understand the key features of Azure Resource Manager, since it serves as the deployment and management service for Azure subscriptions.</p>
<p>The main function of Azure Resource Manager is to provide a consistent management layer for creating, updating, and removing resources. The Resource Manager is also used to manage access control, auditing, and tagging. This, in turn, helps you secure and organize <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> resources after they’ve been deployed.</p>
<p>Any time you perform an action via one of the management tools, like the portal, or Azure PowerShell, the Azure CLI, or one of the other available management tools, it’s actually the Resource Manager API that handles the request. This produces consistent results and capabilities across all the different management tools.</p>
<p>Whenever you deploy a resource in Azure, the request is handled by the Resource Manager API. Successful requests result in the creation of the resource and the assignment of it to a resource group. Whenever you need to deploy resources that are related to each other, you should use Resource Manager to deploy them into the same resource group. This allows you to deploy, update, manage, and monitor them as a group.</p>
<p>So, now that we’ve given Resource Manager a good once-over, let’s take a look at some key terms that you should be familiar with when working with Resource Manager.</p>
<p>The term Resource Provider refers to a service that supplies Azure resources. One of the more common resource providers in Azure is Microsoft.Compute. The Microsoft.Compute resource provider, as you may have guessed, supplies VM resources. I’ll let you guess what the Microsoft.Storage resource provider supplies.</p>
<p>A Resource Manager Template is a JSON file. The JSON file defines one or more resources that you wish to deploy into a resource group or subscription. Using Resource Manager Templates allow you to consistently and repeatedly deploy resources over and over again, without the need to manually configure them each time.</p>
<p>Declarative Syntax is a syntax that you use to create resources without having to write out the sequence of programming commands that are necessary to create them. A prime example of Declarative Syntax is actually the Resource Manager template, because within the JSON file, you define the properties for the infrastructure to deploy to in Azure.</p>
<p>When you use a Resource Manager template to define your virtual machines, you can easily deploy and redeploy them later on, if necessary. As a matter of fact, Microsoft actually recommends periodically redeploying your virtual machines, why? Because it forces the deployment of a freshly updated and security-enhanced virtual machine OS. That said, it’s likely difficult to do in practice, due to business SLAs, approvals, and the coordination involved. But that still doesn’t mean it’s a bad idea.</p>
<p>It’s important to understand that Resource Manager processes templates like any other request. What it does is parse the template and then convert the syntax into REST API operations.</p>
<p>Now, because this course isn’t about building templates, I’m not going to get into the weeds on template building. However, if you want to learn about building them, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">URL</a> that you see on your screen (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax</a>).</p>
<p>I should also point out, that, because RBAC, or role-based access control, is integrated into the management platform, you can apply access controls to all services in your resource group.</p>
<p>At this point, I want to talk a little bit about the four levels of scope, in the context of Azure management. They include management groups, subscriptions, resource groups, and resources.</p>
<p>The image that you see on your screen now shows how these scopes are related. So, what’s the significance of scope? Well, what you can do is apply management settings at any one of these levels. Obviously, the level you apply your settings to will dictate how widely your settings are applied. Lower scope levels will generally inherit settings that are applied at the higher scope levels.</p>
<p>For example, if you apply a policy to a resource group, that policy will apply to not only the resource group itself, but it will filter down and apply to the resources within the resource group.</p>
<p>It’s also important to understand that you can deploy templates to management groups, subscriptions, and resource groups.</p>
<p>Speaking of resource groups, let’s talk a little bit about them now. Although they are quite possibly the simplest resources that you can deploy, there are some things to consider when defining a resource group.</p>
<p>First and foremost, when planning your resource group deployments, it’s important to understand that all resources within a resource group should share the same lifecycle. You should be deploying, updating, and deleting such resource all together. An example of this would be an internet-facing web app that communicates with a backend database. Generally speaking, in such a scenario, you’d have a web server, an app server, and a database server, that all exist solely to support the app. In such a case, they would all go in one resource group. However, if one of those resources, say the database server, for example, exists on a different deployment cycle because it supports other apps, that database server should be deployed in another resource group.</p>
<p>While we’re on the subject of which resource groups should house which resources, I should also point out that each resource can only exist in one resource group. You can’t add a resource to two different resource groups. That said, you can add and remove resources to and from a resource group at any time. You can even move resources from one resource group to another.</p>
<p>I should also note that a resource group, despite being located in one region, can contain resources that are located in different regions. For example, a resource group in East US can host resources that are deployed in West US. And, of course, resources in one resource group have no problem interacting with resources in another resource group. Essentially, resource groups serve as LOGICAL groupings.</p>
<p>You can also use a resource group to scope access control for administrative actions.</p>
<p>When you create a resource group, you are prompted to provide a location for that resource group. The location you choose is important because it tells Azure where to store metadata about the resources within that resource group. This has potential compliance ramifications, especially if you need to ensure that your data is stored in a particular region.</p>
<p>In the next lesson, we’ll get into VM hardening.</p>
<h1 id="Hardening-Virtual-Machines"><a href="#Hardening-Virtual-Machines" class="headerlink" title="Hardening Virtual Machines"></a>Hardening Virtual Machines</h1><p>Hi there, welcome to Hardening Virtual Machines. In this lecture, we’re going to look at some of the steps that you can take to harden your Azure VMs, using Azure Security Center.</p>
<p>As I mentioned earlier in this course, Azure Security Center is a service offering that you can use to prevent, detect and respond to threats. It also provides increased visibility into your Azure resources as well as added control over them. Using Security Center, you can safeguard virtual machine data in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> because of this improved visibility.</p>
<p>When you use Security Center to help protect your virtual machines, several capabilities become available to you. For example, you can configure OS security settings by leveraging recommended configuration rules. You can also manage system security updates and see which critical updates are missing. Security Center also provides endpoint protection recommendations and disk encryption validation.</p>
<p>Other capabilities that become available to you include threat detection and the ability to perform vulnerability assessments and remediations.</p>
<p>Before Azure Security Center can collect the information necessary to make recommendations and to generate alerts, you need to enable data collection. On the screen you can see that data collection has been enabled in this example.</p>
<p>Once you’ve begun collecting data, you can begin configuring security policies. A security policy defines a set of controls that are recommended for resources within the subscription or resource group.</p>
<p>Security Center analyzes the security state of your resources in Azure, and when it identifies potential security vulnerabilities, it creates recommendations, which are based on your security policies. The recommendations will even walk you through the process of configuring the necessary controls.</p>
<p>The recommendations that security policy makes are presented in a table format. Each line in the table represents one recommendation. When you select a recommendation in the table, Security Center presents you with information that can assist you with the implementation of that recommendation.</p>
<p>You can also use Security Center to monitor and analyze your enabled security policies in order to identify possible vulnerabilities. You can check on the security state of resources from the resource security health blade.</p>
<p>The way threat detection works in Security Center is pretty straightforward. Essentially what happens is that Security Center collects security information from your Azure resources, the network itself, and other connected partner solutions. It then analyzes the collected information. It will then correlate information from multiple sources to identify threats.</p>
<p>Azure Security Center uses advanced security analytics and leverages big data and machine learning to evaluate events across the entire cloud. Using these technologies, Security Center can detect threats that would otherwise be impossible to identify via manual methods.</p>
<p>The Advanced Security analytics that Security Center relies on include things like integrated threat intelligence, behavioral analytics and anomaly detection.</p>
<p>These types of analytics allow Security Center to effectively disrupt the kill chain because they result in detection at different phases of it. The image that you see on your screen highlights a few common alerts for each phase.</p>
<h1 id="Configuring-System-Updates-for-Virtual-Machines"><a href="#Configuring-System-Updates-for-Virtual-Machines" class="headerlink" title="Configuring System Updates for Virtual Machines"></a>Configuring System Updates for Virtual Machines</h1><p>Hi there! Welcome to Configuring System Updates for Virtual Machines. Azure Update Management is a service that’s included with each Azure subscription. This service allows you to assess your update status across your entire environment and to manage updates for both on-prem and Azure-hosted Windows servers and Linux servers from a single location.</p>
<p>The Azure Update Management service is a free offering. The only costs that you incur are for the log data that Azure Log Analytics stores. To use Azure Update Management, all you need to do is browse to the VM tab in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>, and then enable Update Management for one or more virtual machines. Update Management can also be enabled from your Azure Automation account.</p>
<p>Computers that are managed by the Azure Update Management service use the services and features that you see on your screen to perform assessments and to update deployments. They include:</p>
<ul>
<li>Microsoft Monitoring Agent for Windows or Linux </li>
<li>Desired State Configuration in Windows PowerShell for Linux </li>
<li>Hybrid Runbook Worker in Azure Automation </li>
<li>Microsoft Update for Windows computers</li>
<li>Windows Server Update Services for Windows computers</li>
</ul>
<p>Azure Automation uses Runbooks to install updates. Essentially, what happens, is when an update deployment is created, a schedule is also created. That schedule starts a master update runbook at the specified time for the included computers. The master runbook, in turn, starts a child runbook on each agent. This child runbook on each agent installs the required updates.</p>
<p>The diagram that you see on your screen depicts the flow and how the solution assesses and applies security updates.</p>
<p>In the upcoming demonstration, I’ll show you how to start a runbook from the Azure portal.</p>
<p>Welcome back. In this quick demonstration, I’m going to show you how to start a runbook from the Azure portal. On the screen here, you can see I’m logged in to my Azure portal as my administrator.</p>
<p>To start my runbook, what I’m going to do here is go into Automation, and we’ll select myautomationaccount. Now, from myautomationaccount, I simply select Runbooks under Process Automation and then, I can either create a new runbook or I can run an existing runbook simply by selecting the runbook and then clicking Start. Go ahead and click Yes to start the runbook. And then from the job page here, I can view the status of my runbook job. I can view any input, any output, errors, warnings, any kind of logs and any exceptions. And that’s all it really takes to manually run a runbook from the Azure portal.</p>
<h1 id="Starting-a-Runbook-from-the-Azure-Portal"><a href="#Starting-a-Runbook-from-the-Azure-Portal" class="headerlink" title="Starting a Runbook from the Azure Portal"></a>Starting a Runbook from the Azure Portal</h1><p>Welcome back. In this quick demonstration, I’m going to show you how to start a runbook from the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. On the screen here, you can see I’m logged in to my Azure portal as my administrator. To start my runbook, what I’m going to do here, is go into Automation. And we’ll select Myautomationaccount. Now from my automation account, I simply select Runbooks under process automation, and then I can either create a new runbook or I can run an existing runbook, simply by selecting the runbook and then clicking Start. Go ahead and click Yes to start the runbook. And then from the job page here, I can view the status of my runbook job. I can view any input, any output, errors, warnings, any kind of logs, and any exceptions. And that’s all it really takes to manually run a runbook from the Azure portal.</p>
<h1 id="Configuring-Baselines"><a href="#Configuring-Baselines" class="headerlink" title="Configuring Baselines"></a>Configuring Baselines</h1><p>Hi there. Welcome to Configuring Baselines. Before we get started, I want to mention that this section alone could probably be its own entire course if we wanted to go down the rabbit hole of every type of baseline. However, what we’re going to do instead is touch on each of the types of baselines that are available so you know where to go when you need to configure a specific baseline.</p>
<p>Before we do that, let’s talk a little bit about the best practices that Microsoft’s cybersecurity group and the Center for Internet Security or CIS have developed.</p>
<p>Microsoft initially partnered with the Center for Internet Security to develop an off-the-shelf-hardened Azure VM. This soon turned into an initiative to use CIS benchmarks, along with Azure security services and tools to provide security and compliance for applications that run on <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>.</p>
<p>The CIS Microsoft Azure Foundations Security Benchmark guide provides organizations with guidelines for establishing a secure baseline configuration for Azure. Throughout the rest of this lecture, we’re going to look at the recommended technology groupings that can help you create secure cloud-enabled workloads.</p>
<p>There are two different implementation levels that CIS bases their recommendations on. There are also several different categories of recommendations that are made. The two levels are called Level 1 and Level 2. I know, very original.</p>
<p>Level 1 recommendations are the minimum recommended security settings that should be configured on all systems. Level 1 recommendations typically cause little or no interruption of services, nor do they usually result in reduced functionality. Level 2 recommendations are designed for highly secure environments. That being the case, they can sometimes result in reduced functionality of the systems they’re implemented on.</p>
<p>On the screen is a table that shows you each technology group that we’re going to touch on, along with an overall description of the recommendations for each group. Also included in this table are the total number of recommendations for each technology group. As you can see, there are lots, which is why we’re not going to get down into the weeds on these.</p>
<p>Let’s start by taking a quick look at identity and access management. Identity management is critical to the security of corporate assets. To ensure security and control of your assets, you need to manage identity and access for the Azure administrators in your organization, the application developers in your organization and for the application users as well. An identity and access management baseline is a big part of this.</p>
<p>Some of the key recommendations when configuring an identity and access management baseline include: Level 1 actions like restricting access to the Azure AD administration portal, ensuring that no unnecessary guest users exist, notifying users on password resets and requiring two methods to reset passwords.</p>
<p>Some key Level 2 actions that you should be taking include things like: enabling Azure MFA, blocking the ability to remember MFA on trusted devices, notifying all admins when other admins reset passwords and establishing an interval for reconfirming user authentication methods.</p>
<p>Some other recommended Level 2 actions include: not allowing members and guests to invite external users, not allowing users to create and manage security groups, disabling self-service group management and disabling the ability for users to register apps.</p>
<p>The Azure Security Center offering provides security management and threat protection for on-prem workloads, Azure workloads and workloads in other clouds.</p>
<p>The Security Center recommendations that you see on your screen will set various security policies on your Azure subscription. By implementing these recommendations on your own Azure subscription, you can further secure your environment.</p>
<p>These recommendations include: enabling the standard pricing tier, enabling the automatic provisioning of a monitoring agent and enabling system updates. Other key recommendations include: enabling security configurations enabling endpoint protection and enabling disk encryption.</p>
<ul>
<li>Enabling Network Security Groups (Level 1)</li>
<li>Enabling Web Application Firewall (Level 1)</li>
<li>Enabling Vulnerability Assessment (Level 1)</li>
<li>Enabling Storage Encryption (Level 1)</li>
<li>Enabling JIT Network Access (Level 1)</li>
<li>Enabling Adaptive Application Controls (Level 1)</li>
<li>Enabling SQL Auditing &amp; Threat Detection (Level 1)</li>
<li>Enabling SQL Encryption (Level 1)</li>
<li>Setting a Security Contact Email and Phone Number (Level 1)</li>
<li>Enabling the Send me emails about alerts option (Level 1)</li>
<li>Enabling the Send email also to subscription owners option (Level 1)</li>
</ul>
<p>As you can see on your screen, there are also several other recommendations to follow when creating an Azure Security Center baseline. </p>
<p>Azure storage accounts provide namespaces that you can use to store and access Azure Storage data objects. The seven key recommendations that you see on your screen are those that you should implement to validate your storage security.</p>
<p>They include:</p>
<ul>
<li>Requiring security-enhanced transfers (Level 1)</li>
<li>Enabling blob encryption (Level 1)</li>
<li>Periodically regenerating access keys (Level 1)</li>
<li>Requiring Shared Access Signature (SAS) tokens to expire within an hour (Level 1)</li>
<li>Requiring SAS tokens to be shared only via HTTPS (Level 1)</li>
<li>Enabling Azure Files encryption (Level 1)</li>
<li>Requiring only private access to blob containers (Level 1)</li>
</ul>
<p>By implementing these recommendations as part of a storage account baseline, you can vastly improve your security position.</p>
<p>Azure SQL Server is Microsoft’s cloud-based relational database server offering. It supports many of the same features as the on-prem version of Microsoft SQL Server and it’s a good way to transition from an on-prem database into a cloud-based database.</p>
<p>The security recommendations that you see on your screen are those that you should implement when creating an Azure SQL Database security baseline. They include:</p>
<ul>
<li>Enabling auditing (Level 1)</li>
<li>Enabling a threat detection service (Level 1)</li>
<li>Enabling all threat detection types (Level 1)</li>
<li>Enabling the option to send security alerts (Level 1)</li>
<li>Enabling the email service and co-administrators (Level 1)</li>
<li>Configuring audit retention for more than 90 days (Level 1)</li>
<li>Configuring threat detection retention for more than 90 days (Level 1)</li>
</ul>
<p>Implementing these recommendations improves the security posture of your Azure SQL Server environment.</p>
<p>When it comes time to identify and mitigate security threats, if you aren’t performing any sort of logging and monitoring, you’re going to be in for a world of hurt. Properly configured logging policies will not only help you determine when a security violation has occurred, but it will also help identify the culprit responsible as your activity logs can provide information about external access to resources and it can also provide diagnostic logs that provide information about the operation of those resources.</p>
<p>Follow these Level 1 recommendations that you see on your screen to set logging and monitoring policies on your Azure subscriptions:</p>
<ul>
<li>Ensure that a log profile exists </li>
<li>Ensure that activity log retention is set to 365 days or more </li>
<li>Create an activity log alert for “Creating a policy assignment” </li>
<li>Create an activity log alert for “Creating, updating, or deleting a Network Security Group” </li>
<li>Create an activity log alert for “Creating or updating an SQL Server firewall rule”</li>
</ul>
<p>Azure networking service are designed to maximize flexibility, availability and security. These services provide connectivity between resources in Azure, on-prem resources and the Internet. The key security recommendations you see on your screen can be used to set Azure networking policies in your Azure subscriptions. These recommendations include:</p>
<ul>
<li>Restricting RDP and SSH access from the Internet (Level 1) </li>
<li>Restricting SQL Server access from the Internet (Level 1)</li>
<li>Configuring the NSG flow log retention period for more than 90 days (Level 2)</li>
<li>Enabling Network Watcher (Level 1)</li>
</ul>
<p>Aside from configuring the NSG flow log retention period, which is a Level 2 recommendation, all listed recommendations are Level 1 recommendations.</p>
<p>When it comes to security recommendations for virtual machines, the ones you see on your screen should be followed to set virtual machine policies on your Azure subscription. These recommendations include: </p>
<ul>
<li>Installing a VM agent on all VMs and enabling the agents for data collection for Azure Security Center (Level 1) </li>
<li>Ensuring that OS disks are encrypted (Level 1)</li>
<li>Ensuring only approved extensions are installed (Level 1)</li>
<li>Ensuring that the OS patches for the VMs are applied (Level 1)</li>
<li>Ensuring that VMs have an installed and running endpoint protection solution (Level 1)</li>
</ul>
<p>Performing these steps will allow you to validate the security for VMs in your environment. In addition to the recommendations we’ve already introduced, there are some other security recommendations that should be followed.</p>
<p>These additional recommendations include:</p>
<ul>
<li>Setting an expiration date on all keys in Azure Key Vault (Level 1) </li>
<li>Setting an expiration date on all secrets in Azure Key Vault (Level 1) </li>
<li>Setting resource locks for mission-critical Azure resources (Level 2)</li>
</ul>
<p>These additional recommendations that you see on your screen can be followed to set general security and operational controls on an Azure subscription.</p>
<p>To download the complete CIS Microsoft Azure Foundations Security Benchmark document, which includes over 200 pages of baseline and benchmark information, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/security/benchmark/azure/v2-cis-benchmark">URL</a> that you see on your screen.</p>
<h1 id="Azure-Networking"><a href="#Azure-Networking" class="headerlink" title="Azure Networking"></a>Azure Networking</h1><p>Hi there, welcome to Azure Networking. In this lecture, we’re going to take a quick look at several key networking components that you need to be familiar with before attempting to configure networking and <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. We’re not going to get into too much detail, because I’m going to assume that if you’re preparing for the Microsoft Azure Security Technologies exam, you already have at least a basic knowledge of these concepts already. So for most of you, this should be more like a refresher than anything.</p>
<p>Let’s start with virtual networks. Virtual networks are used to connect resources. Whether those resources reside in Azure or on-prem. You use Azure virtual networks to enable secure communication between all kinds of Azure resources between Azure resources and on-prem environments and between Azure resources and the internet. It’s important to note that each virtual network which consists of one or more subnets is scoped to a single Azure region.</p>
<p>While you can deploy multiple virtual networks within each Azure subscription and within each Azure region, it’s important to understand that each virtual network is isolated from other virtual networks.</p>
<p>When you deploy a virtual network, you can specify a custom private IP address space that consists of public or private addresses. When you connect resources to a virtual network, Azure assigns a private IP address to that resource. The address that it assigns comes from the address space that you assign.</p>
<p>For name resolution, you can use either Azure provided name resolution, or you can provide your own custom DNS server. Resources on the virtual network you are configuring will use this DNS for name resolution. </p>
<p>In much the same way as physical on-prem machines do, Azure resources like VMs, load balancers, and application gateways require unique IP addresses to function. Virtual networks use two types of IP addresses. They include private IPs and public IPs.</p>
<p>Private IP addresses can be allocated to resources dynamically or statically. Resources use these addresses to communicate with other Azure resources or on-prem devices.</p>
<p>Public IP addresses allow Azure resources to communicate with external clients. This kind of address is assigned directly to the virtual network adapter of a virtual machine or to the load balancer. Public IP addresses can also be added to Azure only virtual networks. With that being said, in an Azure only virtual network, all IPs are routable only within the customer’s network. Meaning that they won’t be reachable from outside. </p>
<p>Subnets in Azure, in the same way as physical subnets on-prem, allow you to subdivide your virtual network. This helps attain logical and security related isolation of Azure resources. A subnets range of addresses must fall within the defined address space of the parent virtual network. What subnetting does is hide the details of the organization of the internal network from external routers. It also segments the hosts within the network. This makes it easier to apply network security at the interconnections between subnets.</p>
<p>Virtual network adapters are used by virtual machines to communicate with other virtual machines as well as with other resources. When you deploy a virtual machine, you configure the virtual machine’s virtual network adapter with a private IP address and optionally, a public IP address. It’s also important to note that a virtual machine can have more than one virtual network adapter attached to it.</p>
<p>DNS or the Domain Name System allows clients to resolve fully qualified domain names to IP addresses. Although Azure does provide a built-in DNS that supports most name resolution scenarios, there will be times when you need to configure custom external DNS in order to provide the necessary name resolution services. A typical use-case for custom DNS is a scenario where you want to extend an on-prem Active Directory into Azure by deploying a VM in Azure that will function as a domain controller for the on-prem AD.</p>
<p>In situations where you wish to increase scalability or availability of an application that’s hosted on a VM, what you can do is create two or more VMs and publish the same application on them. You can then use an Azure load balancer to distribute traffic among the VMs that host the application. In such a configuration, all of the VMs share the same endpoint. That being the case, you can spread the traffic load across multiple servers.</p>
<p>You have two types of load balancers at your disposal; a public load balancer and an internal load balancer.</p>
<p>A public load balancer is used to map the public IP address and port number of incoming traffic to the private IP address and port number of your VMs. And of course, vice versa for the response traffic from your VMs.</p>
<p>You use an internal load balancer to direct traffic to resources that exist inside a virtual network, or to resources that use a VPN to access the Azure infrastructure. This is what differentiates internal load balancers from public load balancers.</p>
<p>I should also note that Azure restricts access to the load-balanced front-end IP address of a virtual network. In other words, the front-end IP addresses and virtual networks are never directly exposed to the internet. </p>
<p>The application gateway is another service that you can use to deploy load balanced solutions. However, unlike load balancers, application gateways are designed strictly for HTTP traffic. That being the case, they use routing rules as application-level policies that can offload SSL processing from load-balanced VMs. I should also mention that you can use application gateways when cookie-based session affinity is required.</p>
<p>Azure Traffic Manager is yet another Azure-based load balancing solution. You typically use traffic manager to balance loads across endpoints in different Azure regions, across hosted providers or across different on-prem data centers. The endpoints of Traffic Manager can be Azure VMs or Azure websites. Generally speaking, you use the Traffic Manager load balancing service to ensure that end users connect to an endpoint that is located closest to their physical location. This typically results in faster response times.</p>
<p>It’s important to note that Traffic Manager works at the DNS level. In other words, it uses DNS to direct users to specific service endpoints based on a combination of the traffic routing method you choose, and the current endpoint health. This doesn’t mean that Traffic Manager is a proxy, it’s not. Once clients are directed to the appropriate endpoint, they directly connect to that endpoint. Traffic Manager doesn’t see the traffic passing between the client and the service being load balanced.</p>
<p>At this point, we just have a few more networking concepts to review. Let’s take a quick moment to touch on network security groups. Network security groups are used to provide network isolation for Azure resources. This is accomplished by defining security rules that either allow or deny specific traffic to specific VMs or subnets.</p>
<p>A common use case for network security groups is a scenario where you want to isolate traffic between multi-tier applications. For example, if you have a three-tier web app that consists of a web front-end VM, a VM hosting the app and a back-end SQL server that the app VM talks to, you might leverage network security groups to ensure that only the app VM can communicate with the SQL VM over Port 1433. Since there’s no need for the front-end web VM to be communicating directly with the back-end SQL VM.</p>
<p>Lastly, let’s take a look at cross-prem network connectivity. Using Azure virtual networks and VPNs, you can extend your on-prem network to Microsoft Azure. You can create connectivity between an on-prem network and an Azure virtual network by deploying a site to site VPN that traverses the public internet. However, if you’re looking for more security and reliability you can use ExpressRoute to create a connection that doesn’t cross the internet. Using either of these two methods allows you to provide on-prem users access to Azure resources as if they were physically located on-prem in your own data center.</p>
<p>A point to site VPN can be used to allow individual users or computers to connect to Azure, just like you might leverage Cisco AnyConnect or any other VPN service to allow users to connect to your on-prem network from home.</p>
<p>With that said, we’ll wrap up this lecture. Like I said at the outset, this lecture was probably just a refresher for most of you. But I had to mention these concepts because you may run into them while sitting the exam. I’d rather run through that and have you not see them on the exam, that not go through them and then have you getting hit with questions about them when you sit the exam.</p>
<h1 id="Configuring-Authentication"><a href="#Configuring-Authentication" class="headerlink" title="Configuring Authentication"></a>Configuring Authentication</h1><p>Hi there, welcome to configuring authentication. In this lecture, we’re going to take a look at how to create and use service principals for AKS clusters.</p>
<p>So before an AKS cluster can interact with Azure APIs, it needs an Azure AD service principal. This is required to dynamically create and manage other <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> resources, like Azure load balancer or container registry. </p>
<p>Over the next few minutes here, I’m going to explain how to create a service principal for an AKS cluster.</p>
<p>Before we dive in, I need to point out that in order to create an Azure AD service principal, you need permissions to register an application with the Azure AD tenant. You also need permissions to assign the app to a role in the subscription.</p>
<p>To create a service principle for an AKS cluster using Azure CLI, you’ll need to use Azure CLI version 2.0.59 or later installed and configured.</p>
<p>When you create an AKS cluster, be it in the Azure portal or by using the az aks create command in Azure CLI, Azure can automatically create a service principal for you.</p>
<p>Using the Azure CLI command that you see on your screen (shown below) does not specify a service principal, so what happens in this case is Azure CLI automatically creates a service principal for the cluster.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks create --name MyCoolAKSCluster --resource-group myRG</span><br></pre></td></tr></table></figure>

<p>Now, if you want to manually create a service principal using the Azure CLI, you can use this next command that you see on your screen:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ad sp create-for-rbac --skip-assignment --name myAKSClusterSP</span><br></pre></td></tr></table></figure>

<p>In this example, we’re using the <code>az ad sp create-for-rbac</code> command. The <code>--skip-assignment</code> parameter in this example command prevents any additional default assignments from being assigned.</p>
<p>After running the command you see here, what you need to do is take a look at your output, which should look something like what you see on your screen, and you’ll need to make a note of the appID and password because you’ll use these when you create your AKS cluster. Once you’ve created your service principal, you can use it when you create the AKS cluster.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JSONCopy</span><br><span class="line">&#123;</span><br><span class="line">  &quot;appId&quot;: &quot;559513bd-0c19-4c1a-87cd-851a26afd5fc&quot;,</span><br><span class="line">  &quot;displayName&quot;: &quot;myAKSClusterSP&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;http://myAKSClusterSP&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;e765722a-5eee-40e8-a466-dc87d980f315&quot;,</span><br><span class="line">  &quot;tenant&quot;: &quot;72f985bf-86f1-41af-92ab-2d7ce011db48&quot;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To specify this existing service principal while you create the AKS cluster, you can use the <code>az aks create</code> command, along with the <code>--service-principal</code> and <code>--client-secret</code> parameters. Using these parameters allows you to specify the appID and password that you noted.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az aks create --resource-group myResourceGroup --name myCoolAKSCluster --service-principal &lt;appId&gt; --client-secret &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>Now, if you’re doing things the easier way and deploying your AKS cluster via the Azure portal, what you can do is, once you get to the Authentication page of the Create Kubernetes cluster dialog, you can choose the option to Use Existing when prompted to Configure service principal. What you would do in this case is provide your appID in the Service principal client ID field and your password in the Service principal client secret field.</p>
<p>Before we wrap up this lecture, I do want to point out a couple things to keep in mind when using AKS and Azure AD service principals.</p>
<p>First and foremost, while the service principal for Kubernetes is a part of the cluster configuration, it should not be used to deploy the cluster. Secondly, by default, service principal credentials are only valid for one year. That being the case, you’ll need to either update or rotate the service principal credentials on a regular basis.</p>
<p>Speaking of service principals, every service principal is associated with an Azure AD application. In the case of a Kubernetes cluster, the service principal for it can be associated with any valid Azure AD application name. However, the application URL doesn’t have to be a real endpoint. This sometimes trips people up.</p>
<p>I should also point out that the service principal credentials are stored in a file called &#x2F;etc&#x2F;kubernetes&#x2F;azure.json on the agent node VMs within the Kubernetes cluster.</p>
<p>Lastly, even if you delete an AKS cluster that was created via the <code>az aks create</code> command, the service principal that was automatically created is not deleted. This is another point that sometimes trips people up.</p>
<h1 id="Container-Isolation"><a href="#Container-Isolation" class="headerlink" title="Container Isolation"></a>Container Isolation</h1><p>Hi, everyone, welcome to container isolation. Azure Container Instances, also known as ACI, provide the easiest way to deploy containers in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> without worrying about any higher level service overhead. This is because you can deploy independent containers without the need to manage any backend virtual machines.</p>
<p>Container instances are, inherently, deployed securely. This ensures that a deployed application runs in isolation, much like it would if it was run on an Azure virtual machine.</p>
<p>Because the Azure Container Instances service is a deep security model, each individual container that’s deployed is isolated at the hypervisor level. This offers a much stronger security boundary for multi-tenant scenarios. The ability to enable this type of isolation without the need for a separate hosting cluster makes Azure Container Instances a true cloud-native model.</p>
<h1 id="AKS-Security"><a href="#AKS-Security" class="headerlink" title="AKS Security"></a>AKS Security</h1><p>Hi there, welcome to AKS security. In this lecture, we’re going to take a look at various concepts that you need to be familiar with in order to configure AKS security. We’ll look at master components security, node security, network security, and Kubernetes secrets.</p>
<p>In AKS, Kubernetes master components are provided by Microsoft as part of the managed service. That being the case, each AKS cluster has its own single-tenanted, dedicated Kubernetes master. This dedicated Kubernetes master, which is managed and maintained by Microsoft, provides the API server, scheduler, and other functionality.</p>
<p>The Kubernetes API server uses a public IP address and is accessible via a fully qualified domain name. Access to the API server can be controlled via Kubernetes RBAC controls and Azure AD.</p>
<p>We already know that AKS nodes are actually Azure VMs that we need to manage and maintain. Linux nodes run Ubuntu using the Moby container runtime. Windows Server nodes run Windows Server 2019. They, too, use the Moby container runtime. Whenever a new AKS cluster is created or when an existing cluster is scaled up, the nodes of that cluster are automatically deployed with the latest OS security updates and configurations.</p>
<p>Then, in the case of Linux nodes, <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> automatically applies the latest OS security patches on a nightly basis. However, it’s important to note that if a particular Linux OS update requires a host reboot, that reboot is not automatically performed. Instead, you can manually reboot the node when it’s convenient. You can also use Kured, which is an open-source reboot daemon for Kubernetes.</p>
<p>Windows Server nodes are updated via Windows Update. However, Windows Update does not automatically run nor apply the latest updates. Instead, what you should do on a regular basis is perform an upgrade on your Windows Server node pool, or pools, in your AKS cluster. What this upgrade process does is create nodes that run the latest Windows Server image and patches. Once you have the new nodes created, you can remove the older ones.</p>
<p>I should point out that, when nodes are deployed, they’re deployed into a private virtual network subnet. There are no public IP addresses assigned. That being the case, SSH is enabled by default. You can use this SSH access, using the internal IP address, to manage your nodes.</p>
<p>AKS nodes use Azure Managed Disks for storage. The data that gets stored on these managed disks is automatically encrypted at rest by Azure.</p>
<p>It’s important to understand that Kubernetes environments, in general, aren’t considered to be completely safe for hostile multi-tenant usage. While security features like Pod Security Policies and role-based access controls make exploits a little more difficult, the best way to achieve true security when running hostile multi-tenant workloads is to leverage a hypervisor.</p>
<p>For more information on cluster isolation in AKS, visit the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation">URL</a> that you see on your screen (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation">https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation</a>)</p>
<p>To facilitate security and connectivity with on-prem networks, AKS clusters can be deployed into existing Azure virtual networks that have Azure Site-to-Site VPN connections or Express Route connections back to your on-prem network. You can define Kubernetes ingress controllers with private IP addresses, so those services are only accessible via an internal network connection.</p>
<p>I should mention here that as you create services with load balancers, port mappings, or ingress routes, the Azure Kubernetes Service will automatically modify the applicable network security groups to ensure traffic flows as necessary.</p>
<p>The last security component that I want to touch on is the concept of Kubernetes secrets. So what is a Kubernetes secret and what does it do? Well, a Kubernetes secret injects sensitive data, like access credentials or keys, into pods. After you’ve created a secret using the Kubernetes API, you can request that secret when you define your pod or deployment.</p>
<p>A Kubernetes Secret is only supplied to a node that contains a scheduled pod that requires it, and instead of being written to disk, the secret is stored in tmpfs.</p>
<p>It’s important to note that when the last pod on a node that requires a secret is deleted, the secret itself is also deleted from that node’s tmpfs. I should also point out that secrets are stored within a specific namespace. That being the case, they can only be accessed by pods within that namespace.</p>
<p>Using secrets reduces the amount of sensitive information that needs to be defined in YAML manifest for pods and services. Instead of defining sensitive data in the manifest, what you do is you request the secret that’s stored in Kubernetes API Server. Taking this approach, you only provide the specific pod with access to the secret.</p>
<h1 id="Azure-Container-Registry"><a href="#Azure-Container-Registry" class="headerlink" title="Azure Container Registry"></a>Azure Container Registry</h1><p>Welcome to Container Registry. This is going to be a rather brief lecture because all I want to do here is introduce you to Container Registry.</p>
<p>So what is an Azure Container Registry? Well, an Azure container registry is really just a managed, private Docker registry in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. It’s based on the open-source Docker Registry 2.0. You use Azure container registries to store and manage private Docker container images along with related artifacts.</p>
<p>You can use Azure container registries with existing container development and deployment pipelines, or you can use Azure Container Registry Tasks to build container images in Azure.</p>
<p>You can pull images from an Azure container registry to various deployment targets, including orchestration systems like Kubernetes and Docker Swarm, and you can also pull images from the container registry to Azure services that help you build and run apps at scale. These services include Azure Kubernetes Service, App Service, Service Fabric, and several others.</p>
<p>In the upcoming demonstration, we’ll create a container registry with the Azure portal.</p>
<h1 id="Creating-a-Container-Registry"><a href="#Creating-a-Container-Registry" class="headerlink" title="Creating a Container Registry"></a>Creating a Container Registry</h1><p>Welcome back. In this demonstration, I’m going to quickly show you how to create a container registry using the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. On the screen here you can see I’m logged in to my portal and I’m logged in as an Administrator. To create my container registry, what I’m going to do is click on Create a Resource here and then I’m going to browse to Containers here within the Azure marketplace.</p>
<p>Now within Containers here, I can select Container Registry. To create my Container Registry, I need to provide a unique registry name and when I say unique, I mean it needs to be unique across Azure because it’s going to get an FQDN with the domain name here of Azure CR.IO. So what I’ll do here is I’ll call it my 9878 registry. This name that I give it can contain anywhere between five and 50 alphanumeric characters. And then what I do here is select the subscription I’m going to deploy to and then a resource group.</p>
<p>So I’ll select one of my resource groups here and then of course as with any other Azure resource, I need to select the location. I’ll leave it in East U.S. Now if we hover over the icon next to Admin User, we can see that if we enable this option, we can use the registry name as username and Admin User Access Key as the password to dock or log in for the container registry. I’m going to leave this disabled here and go with the standard SCU. We’ll go ahead and click Create and what this will do is create my new container registry.</p>
<p>Now that my registry had been created, what I’ll do here is browse out to the resource group that contains it and we’ll open up our registry.</p>
<h1 id="Implementing-Vulnerability-Management"><a href="#Implementing-Vulnerability-Management" class="headerlink" title="Implementing Vulnerability Management"></a>Implementing Vulnerability Management</h1><p>Hi there. Welcome to “Implementing Vulnerability Management.” In this lecture, I want to talk a little bit about security measures that you can take to manage vulnerabilities.</p>
<p>To ensure effective vulnerability management, you need to secure and protect your container ecosystem, from build to run. You need to protect against vulnerabilities throughout the entire container lifecycle, from development to production deployment. You also need to ensure that you protect all container orchestrators, hosts, and platforms.</p>
<p>An effective vulnerability management plan that’s implemented throughout the entire container development lifecycle makes it more likely that you’ll be able to identify and resolve security concerns before they become a serious problem.</p>
<p>There are several steps you should take when implementing vulnerability management. These include scanning for vulnerabilities, mapping image vulnerabilities to running containers, and ensuring that only approved images are used in the environment. You also want to allow only approved registries and ensure the integrity of your images throughout the lifecycle.</p>
<p>Other steps that you can take to manage vulnerabilities include the enforcement of least privileges in runtime and the removal of unneeded privileges, which reduces the container attack surface. You can also whitelist files and executables that each container is allowed to access or run.</p>
<p>Some other best practices for managing vulnerabilities include network segmentation of running containers, monitoring container activity user access, and container resource activity. Logging container administrative access for auditing purposes is also, of course, a best practice.</p>
<p>Because new vulnerabilities are constantly discovered, scanning for them and identifying related vulnerabilities needs to be performed on a continuous basis. That being the case, you really need to incorporate vulnerability scanning that is threaded throughout the entire container lifecycle.</p>
<p>To ensure security issues can be more easily mitigated, you need to ensure that you’re mapping vulnerabilities that are identified in container images to running containers.</p>
<p>Speaking of images, you need to ensure that you only allow approved container images. You need to have tools and processes in place that you can rely on to monitor for, and prevent, the use of unapproved container images. You can leverage image signing or fingerprinting to create a chain of custody that you can rely on to verify the integrity of your containers.</p>
<p>In addition to only allowing approved images, you should also ensure that you use only approved container registries. This is important because requiring the use of approved container registries only reduces exposure to risks by limiting the possibility of introducing unknown vulnerabilities or security issues.</p>
<p>Managing vulnerabilities throughout the container lifecycle requires you to ensure the integrity of your container images in the registry and whenever those images are altered or deployed.</p>
<p>The best way to do this is to periodically audit any images deployed in production to identify images that are out of date.</p>
<p>The concept of least privileges is a widely-accepted security best practice that applies to all sorts of resources. It also applies to containers. Generally speaking, whenever a vulnerability is exploited, the attacker often assumes access and privileges that are equal to that of the compromised application or process. By locking things down with least privileges, your containers will operate with the lowest privileges and access required to get the job done. This obviously limits exposure.</p>
<p>Removing unused and unneeded processes or privileges from the container runtime reduces the container attack surface.</p>
<p>To maintain a stable environment, you should ensure that your containers can access or run only pre-approved or whitelisted files and executables. Not only does this help you maintain a stable container environment, but it also limits your exposure to risk.</p>
<p>Enforcing network segmentation helps protect containers in one subnet from any potential security risks in another subnet.</p>
<p>I should also mention that, as is the case with any other IT environment, you always need to be consistently monitoring activity and user access to your container ecosystem. This allows you to quickly identify suspicious activity. You can use Azure Monitor for Containers and the Azure Container Monitoring Solution, both of which are <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> solutions, to perform this monitoring.</p>
<p>Monitoring resource activity and consumption helps you not only manage performance but it also serves as a helpful security measure. You can use Azure Monitor’s activity log to see what new resources are created or modified.</p>
<p>Maintaining an accurate audit trail of administrative access to your container ecosystem is critical. It’s most useful when you need to dig up forensic evidence after a security incident. The Azure Container Monitoring Solution can be used to perform this auditing.</p>
<p>As you can see, there are quite a few pieces to a solid vulnerability management implementation, but by leveraging them all you can ensure a secure environment.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations! You’ve reached the end of Configuring Azure VM and Container Security. Let’s review what you’ve learned. We kicked things off with host security. Throughout the early part of this course, you learned about configuring endpoint security within VMs and how to harden VMs in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. You also learned how to configure system updates for VMs in Azure as well as how to configure baselines. As we moved through this course, you learned about container security. You learned how to configure networks, authentication and container isolation. You also learned how to configure AKS security and how to configure container registry. Rounding things out, you learned about vulnerability management tools and strategies.</p>
<p>So now that you’ve been through this course, you should have a full understanding of how to configure Azure VM and container security. We’d love to get your feedback on this course, so please give it a rating. As always, thanks for watching and happy learning.</p>
<h1 id="4Configuring-Virtual-Machine-Security"><a href="#4Configuring-Virtual-Machine-Security" class="headerlink" title="4Configuring Virtual Machine Security"></a>4<strong>Configuring Virtual Machine Security</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/azure-resource-manager/templates/template-syntax">Building Templates</a></p>
<h1 id="12AKS-Security"><a href="#12AKS-Security" class="headerlink" title="12AKS Security"></a>12<strong>AKS Security</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-gb/azure/aks/operator-best-practices-cluster-isolation%C2%A7">Cluster Isolation in AKS</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/15/AZ-500-Lab-Managing-Access-in-Azure-Using-Privileged-Identity-Management-4/" rel="prev" title="AZ-500-Lab-Managing-Access-in-Azure-Using-Privileged-Identity-Management-4">
      <i class="fa fa-chevron-left"></i> AZ-500-Lab-Managing-Access-in-Azure-Using-Privileged-Identity-Management-4
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/15/AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6/" rel="next" title="AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6">
      AZ-500-Managing-Azure-Subscriptions-and-Resource-Groups-6 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Lectures"><span class="nav-number">1.0.1.</span> <span class="nav-text">Lectures</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Endpoint-Security-within-VMs"><span class="nav-number">2.</span> <span class="nav-text">Configuring Endpoint Security within VMs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-and-Monitoring-Antimalmare-for-VMs"><span class="nav-number">3.</span> <span class="nav-text">Configuring and Monitoring Antimalmare for VMs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Virtual-Machine-Security"><span class="nav-number">4.</span> <span class="nav-text">Configuring Virtual Machine Security</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hardening-Virtual-Machines"><span class="nav-number">5.</span> <span class="nav-text">Hardening Virtual Machines</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-System-Updates-for-Virtual-Machines"><span class="nav-number">6.</span> <span class="nav-text">Configuring System Updates for Virtual Machines</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Starting-a-Runbook-from-the-Azure-Portal"><span class="nav-number">7.</span> <span class="nav-text">Starting a Runbook from the Azure Portal</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Baselines"><span class="nav-number">8.</span> <span class="nav-text">Configuring Baselines</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Networking"><span class="nav-number">9.</span> <span class="nav-text">Azure Networking</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Authentication"><span class="nav-number">10.</span> <span class="nav-text">Configuring Authentication</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Container-Isolation"><span class="nav-number">11.</span> <span class="nav-text">Container Isolation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AKS-Security"><span class="nav-number">12.</span> <span class="nav-text">AKS Security</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Container-Registry"><span class="nav-number">13.</span> <span class="nav-text">Azure Container Registry</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Container-Registry"><span class="nav-number">14.</span> <span class="nav-text">Creating a Container Registry</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementing-Vulnerability-Management"><span class="nav-number">15.</span> <span class="nav-text">Implementing Vulnerability Management</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">16.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4Configuring-Virtual-Machine-Security"><span class="nav-number">17.</span> <span class="nav-text">4Configuring Virtual Machine Security</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12AKS-Security"><span class="nav-number">18.</span> <span class="nav-text">12AKS Security</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2653</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
