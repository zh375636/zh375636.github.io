<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Security (SAA-C03) IntroductionHello, and welcome to this course on AWS security services, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS-Solution-Architect-Associate-Security-SAA-C03-38">
<meta property="og:url" content="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Security-SAA-C03-38/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="Security (SAA-C03) IntroductionHello, and welcome to this course on AWS security services, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T02:13:54.000Z">
<meta property="article:modified_time" content="2022-11-27T23:59:00.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Security-SAA-C03-38/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AWS-Solution-Architect-Associate-Security-SAA-C03-38 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Security-SAA-C03-38/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AWS-Solution-Architect-Associate-Security-SAA-C03-38
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 22:13:54" itemprop="dateCreated datePublished" datetime="2022-11-18T22:13:54-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-27 19:59:00" itemprop="dateModified" datetime="2022-11-27T19:59:00-04:00">2022-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS-Solution-Architect-Associate/" itemprop="url" rel="index"><span itemprop="name">AWS-Solution-Architect-Associate</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AWS-Solution-Architect-Associate-Security-SAA-C03-38/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AWS-Solution-Architect-Associate-Security-SAA-C03-38/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Security-SAA-C03-Introduction"><a href="#Security-SAA-C03-Introduction" class="headerlink" title="Security (SAA-C03) Introduction"></a>Security (SAA-C03) Introduction</h1><p>Hello, and welcome to this course on AWS security services, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate certification. Before we get started, I’d like to introduce myself. My name is Danny Jessee, and I am one of the trainers here at Cloud Academy, specializing in AWS – Amazon Web Services – and AWS certifications.</p>
<p>In this course, the AWS team will be presenting a series of lectures that introduce the various security services currently available in AWS that may be covered on the exam. Feel free to contact me with any questions using the details shown on the screen, or you can always get in touch with us here at Cloud Academy by sending an email to <a href="mailto:&#115;&#x75;&#x70;&#x70;&#x6f;&#x72;&#116;&#64;&#99;&#x6c;&#x6f;&#x75;&#x64;&#97;&#x63;&#97;&#x64;&#101;&#x6d;&#x79;&#x2e;&#99;&#x6f;&#109;">&#115;&#x75;&#x70;&#x70;&#x6f;&#x72;&#116;&#64;&#99;&#x6c;&#x6f;&#x75;&#x64;&#97;&#x63;&#97;&#x64;&#101;&#x6d;&#x79;&#x2e;&#99;&#x6f;&#109;</a>, where one of our Cloud experts will reply to your question.</p>
<p>This course has been specifically curated to help you pass the AWS Certified Solutions Architect - Associate exam and is ideal for anyone who is looking to learn more about the various security services in AWS in preparation for the exam. The objective of this course is to provide an introduction to the various security services in AWS and to introduce important security concepts, including how to manage users, groups, and roles with AWS Identity and Access Management, known as IAM.</p>
<p>We’ll also introduce the AWS Web Application Firewall, or WAF, which, along with other services such as the AWS Firewall Manager and AWS Shield, can help you create a comprehensive security solution for your web applications.</p>
<p>You’ll learn about the AWS Security Hub as well as many other AWS security services and their features, including Amazon Inspector, Amazon GuardDuty, and Amazon Macie. Finally, you’ll learn about Amazon Cognito, including Cognito User Pools and Identity Pools. And we’ll wrap up the course with an introduction to AWS Identity Federation and how it can be used to simplify access at scale.</p>
<p>Together with the other courses in this learning path, we’ll cover all of the key tools, technologies, and concepts from the AWS Certified Solutions Architect - Associate exam guide and ensure that you are fully prepared to sit this exam.</p>
<p>The AWS Certified Solutions Architect - Associate certification has been designed for anyone who has experience designing cloud solutions that use AWS services to meet current and future business requirements, as well as architectures that are secure, resilient, high-performing, and cost-optimized in accordance with the AWS Well-Architected Framework. All of the AWS Cloud concepts introduced in this course will be explained and reinforced from the ground up.</p>
<p>Here at Cloud Academy, we strive to keep our content current to provide the best training available. If you have any feedback, positive or negative, or if you notice anything that needs to be updated or corrected for the next release cycle, please reach out to us at <a href="mailto:&#115;&#x75;&#112;&#x70;&#111;&#x72;&#x74;&#64;&#x63;&#108;&#x6f;&#x75;&#100;&#x61;&#x63;&#x61;&#x64;&#101;&#109;&#121;&#46;&#99;&#111;&#x6d;">&#115;&#x75;&#112;&#x70;&#111;&#x72;&#x74;&#64;&#x63;&#108;&#x6f;&#x75;&#100;&#x61;&#x63;&#x61;&#x64;&#101;&#109;&#121;&#46;&#99;&#111;&#x6d;</a>. Thank you!</p>
<h1 id="What-is-Identity-and-Access-Management"><a href="#What-is-Identity-and-Access-Management" class="headerlink" title="What is Identity and Access Management?"></a>What is Identity and Access Management?</h1><p>Hello and welcome to this lecture where I shall provide an overview of what the Identity &amp; Access Management service is, and what IAM actually means.</p>
<p>Firstly I want to define what is meant by Identity &amp; Access Management and I shall break this down into two parts, starting with Identity Management. </p>
<p>Identities, such as AWS usernames are required to authenticate you to your AWS account, and this authentication process is managed in 2 stages.</p>
<ol>
<li>The first part of this process is to define who you are, effectively presenting your identity, so for example your AWS username. This identification is a unique value within IAM for your account, so this means IAM would prevent you from having 2 identical user accounts with the same name within the same AWS account.</li>
<li>The second part of the authentication process is to verify that you are who you say you are. This is achieved by supplying additional data, and when using our AWS usernames we can verify this by supplying a password</li>
</ol>
<p>Now, Access Management relates to authorization and access control. Authorization determines what an identity can access within your AWS account once it’s been authenticated to it. An example of this authorization would be the user’s list of permissions to access specific AWS resources, for example, they might have Full Access to EC2 or Read Only to RDS.</p>
<p>Access Control can be classed as the mechanism of accessing a secured resource. For example, using the following:</p>
<ul>
<li>Username and password (Authentication and Verification)</li>
<li>Multi-Factor Authentication (MFA, used as an additional verification step following a valid password)</li>
<li>Or Federated Access, which allows users external to AWS to access resources securely without having to supply AWS user credentials from a valid IAM user account. Instead, these credentials are supplied from identity providers. For more information on Identity Federation, please see our existing course here: <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/using-aws-identity-federation-simplify-access-scale-1549/">https://cloudacademy.com/course/using-aws-identity-federation-simplify-access-scale-1549/</a></li>
</ul>
<p>So essentially IAM can be defined by its ability to manage, control, and govern authentication, authorization, and access control mechanisms of identities to your resources within your AWS Account.</p>
<p>Having an understanding of the different security controls from an authentication and authorization perspective can help you design the correct level of security for your infrastructure.</p>
<h1 id="IAM-Features"><a href="#IAM-Features" class="headerlink" title="IAM Features"></a>IAM Features</h1><p>It’s critical to understand how IAM works and what can be achieved via the service, but it’s even more important to know how to implement its features. Without IAM, there would be no way of maintaining security or control of who or what could access your resources and what they could do with them, both internally and externally. IAM provides the components to maintain this management of access, but it is only as strong and secure as you configure it. </p>
<p>The responsibility of implementing secure, robust, and tight security within your AWS account using IAM is yours, you are the owner of the AWS account. You must define how secure your access control procedures must be, how much you want to restrict users from accessing certain resources, how complex a password policy must be, and if users should be using Multi-factor authentication. All of this is and much more is down to you to architect and implement, and much of it will likely depend on your own security standards and policies within your Information Security Management System (ISMS).</p>
<p>In this lecture, I want to talk about some of the different features and components that AWS IAM uses to centrally manage and control security permissions for any identity requiring access to your AWS Account and its resources. </p>
<p>From with the AWS Management Console, the IAM service can be found under the ‘Security, Identity &amp; Compliance’ category, and when accessed it will take you to the IAM Dashboard. </p>
<p>The initial dashboard of the IAM Console will display the following information.</p>
<p>This is a URL link that you can send to users who you will need to gain access to your AWS Management Console. This sign-in link can be customized by clicking on the ‘customize’ button to make it easier to remember and read. If you have multiple AWS accounts, this customization would help to distinguish between your accounts</p>
<p>IAM Resources. This section provides a summary overview of your IAM resources using a simple count of the number of users, user groups, roles, customer-managed policies, and identity providers you have configured within IAM. </p>
<p>Best Practices. This is populated with a list of IAM security best practices that AWS recommends you implement with links on how to implement them. I strongly recommend you try to adopt these best practices at your earliest opportunity. Maintaining tight security is paramount with working within a cloud environment.</p>
<p>In addition to this dashboard, you will also see 2 categories on the left menu, Access Management and Access Reports each listing a number of components underneath. I want to start by reviewing each of these components under Access Management to give you an insight into what each are used for, starting with Users.</p>
<p>User objects are created to represent an identity, this could be a real person within your organization who requires access to operate and maintain your AWS environment, or it could be an identity that is used by an application to interact with your AWS resources programmatically.  Users are simply objects representing an identity which are used in the authentication process to your AWS account. Being unique values, every user has an Amazon Resource Name, an ARN which it can be referenced by. An example of a user’s ARN could be as shown.</p>
<p>When configuring your Users you can set them up for Multi-Factor Authentication. Configuring MFA allows for an additional level of verification to be applied, the user will have to enter a random 6 digit number from a linked MFA device after their usual password. MFA should be used for the AWS Account owner and any other users who have elevated privileges. </p>
<p>IAM USer Groups are objects much like user objects, however, they are not used in any authentication process, instead, they are used to authorize members of the group access to AWS resources.</p>
<p>So, the IAM USer Groups contain IAM Users, and these groups have IAM policies associated that will either allow or explicitly deny access to AWS resources. These policies are either pre-existing AWS Managed policies, customer-managed policies that are created by you, the customer, or in-line policies which are embedded explicitly to the group itself.</p>
<p>IAM Roles allow Users, other AWS services, and applications to adopt a set of temporary IAM permissions to access AWS resources. Roles essentially operate the same as User objects do in that it’s an identity with associated permissions to allow it access to different resources. The difference being however is that roles don’t define a single person, they are designed to be assumed by any identity or service that needs to temporarily acquire a set of permissions. Additionally, roles don’t have passwords associated with their identities, instead, like I just mentioned, roles are assumed as long as you have the correct permissions to assume it.</p>
<p>Policies used within IAM are written as JSON documents and these define what can and can’t be accessed. These policies can be attached to Users, User Groups, or Roles. </p>
<p>When working with policies, you can use Managed policies or In-line policies. Managed policies are viewed as a library of usable policies and come in 2 different flavors which can be applied to multiple Users, User Groups, and Roles:</p>
<ol>
<li>AWS Managed Policies: These are a list of predefined policies granting varied access to different AWS services</li>
<li>Customer Managed Policies: These are policies created and written by you as the customer</li>
</ol>
<p>Unlike Managed policies, Inline policies are not stored in a library, instead, they have to be written and explicitly embedded within a User, User Group, or Role, as a result, the same policy can’t easily be applied to another identity like Managed policies can.</p>
<p>If you are looking to provide federated access to your AWS resources, then you must add an identity provider. </p>
<p>Federated Access allows credentials external to AWS to be used as a means of authentication to your AWS resources. For example, you could establish a trust between your Active Directory Federation server on premises and your AWS account. Or, you could establish a trust between your AWS account and Google account. Either way, in these instances your ADFS server or Google account could be configured as Identity Providers allowing those authenticated by Active Directory or Google to access your resources in your AWS account. This prevents you from having to create individual IAM user accounts.</p>
<p>Under Account Settings, you can enforce a password policy, and it’s always best practice to do so. The Password policy should be used to enforce the minimum security requirements that need to be met for any password standards that your organization might have to adhere to. The password policy applies to all IAM users within your account, and as you can see here, you can be very specific by enabling&#x2F;disabling and configuring different controls.</p>
<p>The STS service is used to allow you to request temporary, limited-privilege credentials for both IAM users and federated users. The STS endpoints provide a list of Regions that are either activated or deactivated for STS. By default, all Regions are activated, however, it is recommended you deactivate the regions you do not intend to use. </p>
<p>By default STS uses the global endpoint of  <a target="_blank" rel="noopener" href="https://sts.amazonaws.com/">https://sts.amazonaws.com</a>, however, when using regional endpoints it can help to reduce latency.</p>
<p>So that has given a quick overview of the component covered by Access Management, I now want to look at the features that come under the category of Access Reports, starting with Access Analyzer</p>
<p>Access Analyzer. This is used to generate findings when a policy on a resource within your zone of trust allows access from outside your zone of trust. So this could be from a number of different sources, such as an IAM role allowing cross-account access, or a Bucket that allows a different account to upload objects into the bucket, basically any resource that allows external access to your resources will be flagged and highlighted to ensure you are aware of the access. This is a great tool to help reduce security risks and threats as you or your team may have unintentionally allowed access to a resource you shouldn’t have. Any issues are recorded by Access Analyzer as a finding allowing you to review the access </p>
<p>The credential report is a great tool that allows you to generate and download a *.csv file containing a list of all of your IAM users and their credentials. This provides a quick and easy way to review your accounts and the last time they were used, in addition to identifying when a user’s password was last changed and if they have Multi-Factor Authentication enabled.</p>
<p>If using AWS Organizations, it allows you to Select an organizational unit (OU) or account to view its service activity over the previous 365 days. By drilling down into the accounts in this section you can see which users have had activity, in addition to which AWS services they have accessed over a given time frame. </p>
<p>Service Control Policies. This links in with the previous component, ‘Organization Activity’, and lists any Service Control Policies that are applicable to the account and the number of identities affected. Service Control Policies, or SCPs, are different from identity-based policies which grant permissions to users, user groups, and roles as SCPs do not actually grant permission themselves. Instead, SCPs are used with AWS Organizations to implement and set a boundary of permissions for AWS accounts. </p>
<p>For example, let’s say a user within an AWS account had full access to S3, RDS, and EC2 via an identity-based policy in IAM. If the SCP associated with that AWS account denied access to the S3 service, then that user would only be able to access RDS and EC2, despite having full access to S3. The SCP would prevent that service from being used within the AWS account and so have the overriding precedence and determine the maximum level of permissions allowed.</p>
<h1 id="Overview-of-the-User-Dashboard"><a href="#Overview-of-the-User-Dashboard" class="headerlink" title="Overview of the User Dashboard"></a>Overview of the User Dashboard</h1><p>Hello and welcome to this lecture where I’m going to review the dashboard of the user Console. In IAM, we can create user objects to represent an identity with long-term credentials, this could be a real person within your organization who requires access to operate and maintain your AWS environment, or it could be an account to be used by an application that may require permissions to access your AWS resources programmatically. Users are simply objects representing an identity which are used to authenticate to your AWS account with an associated set of permissions.</p>
<p>When you open the AWS IAM dashboard and select users, you will be presented with a screen similar to the following. This screen provides a summary of the key points of interest relating to your IAM users and it can quickly help you identify any potential security risks that you might encounter. As we can see, we have a number of different warnings on this screen in different colors. We have a green tick which symbolizes activity was measured within the last 90 days An amber exclamation mark showing activity was last measured between 91 and 365 days ago. And a red exclamation mark, which highlight anything older than 365 days ago. Anything either amber or red should be looked at and addressed as a priority to reduce potential security issues.</p>
<p>Let’s take a closer look at this table and its columns to understand exactly what it’s trying to show you. The complete list of field names are shown here, and you can toggle them on an off as you need. Let me go through each of them one-by-one to explain what they represent. So username. This column is self-explanatory, it provides the username of that user.</p>
<p>Path. If you create your users using the IAM API or the AWS Command Line Interface, the CLI, then you can specify a path structure for your users. This is useful when you have a large organization and you want to define a management structure to help you organize your users more effectively.</p>
<p>For example, you could add a path for a user Stuart of &#x2F;ContentTeam&#x2F;AWS&#x2F;UK&#x2F;Stuart. This would help to define where your users might be in accordance with your organization structure. In addition to this, you can also reference paths in your access policies, so for example you could allow all users in the &#x2F;ContentTeam&#x2F;AWS&#x2F;UK&#x2F; path to have full access to S3 with a simple policy like this.</p>
<p>Groups. This shows the different groups that the user belongs to. In the screenshot, you can see that the user Stuart belongs to the Admin group. Last activity. This column is really useful to show the last time your users logged into the AWS Management Console or if they accessed any of your AWS resources programmatically using their access keys. As we can see from my example, the user Alice hasn’t accessed anything for 467 days, as a result I can say with some confidence that this user can be removed and deleted from IAM. So it’s a great way to ensure that you don’t have any unused user accounts, and deleting unused accounts is an IAM best practice.</p>
<p>MFA. MFA stands for Multi-Factor Authentication, and so this will highlight any users that have been configured with MFA which adds an additional level of verification, enhancing security. The users in my example that show virtual mean that these users are using MFA on a virtual device, and in this example it’s the Google Authenticator app on a mobile phone. For those unfamiliar with MFA, let me give a brief explanation of what it is. Typically, when a user logs into the AWS Management Console, they will authenticate to your AWS account by providing their identification, typically their username, and then verify this identification, usually with a password. These two elements, the identification and verification, allow the user to authenticate. For many cases, the verification, the password, is sufficient enough to confirm the identity, the username. However, for users who have an elevated level of privileges, for example the users may have full access to a large number of AWS services, then you may want to, or be required to due to governance controls, implement an additional verification step within the authentication process. This adds another layer of security attached to the identity, and this is where Multi-Factor Authentication comes in, MFA. The name explains itself, it’s used to create an additional factor for authentication in addition to your existing methods, such as a password. Therefore creating a multi-factor level of authentication. So what is this additional level of security that MFA brings with AWS? MFA utilizes a random six-digit number that is only available for a very short time period before the number changes again which is generated by an MFA device. There is no additional charge for this level of authentication, however, you will need your own MFA device, which can be a physical token or a virtual device. AWS provides a summary of all supported devices here. Personally, I use Google Authenticator on my phone because it is simple and easy to set up and configure. Password age. This shows how long ago it was until the password of the user was changed. As a security best practice, your passwords should be changed regularly.</p>
<p>Console last sign-in. This column simply shows the last time a user signed in to the management console.</p>
<p>Access key ID. The access key ID will identify if it’s active or inactive and will display the key in use. Before I continue, let me just quickly explain a little more about Access Keys. Access Keys are used for programmatic access to your AWS resources, and they are comprised of two elements. An access key ID and a Secret Access Key ID The Access Key ID is made up of 20 random uppercase alphanumeric characters, such as the one shown here. The Secret Access Key ID is made up of 40 random upper and lowercase alphanumeric and non-alphanumeric characters, such as the one displayed on the screen. During the creation of a user who requires programmatic access, you are prompted to download and save these details and it’ll only be displayed once, and if you lose it, then you will have to delete the associated Access Key ID and recreate new keys for the user. It’s not possible to retrieve lost Secret Access Key IDs as AWS does not retain copies. These access keys must then be applied and associated with the application that you are using that requires the relevant access. For example, if you were using the AWS CLI to access AWS resources, you would first have to instruct the AWS CLI to use these Access Keys to authenticate you providing authorization. The method of performing this association varies based on the application and system that you are using. However, once this association has taken place it ensures that all API requests made to AWS are signed with this digital signature.</p>
<p>Active key age. The active key age refers to the age of the access keys that are associated with the user which, as I explained, are required for programmatic access. Access key last used. This column just shows the last time that the user used their Access Keys within your AWS account. As a security best practice, it’s a good idea to remove any access keys that haven’t been used for quite some time. This removes possible entry points for malicious users to gain access to your environment.</p>
<p>The ARN. The ARN, or Amazon Resource Name provides the unique identifier for referencing that particular user. For example, the one showne here for the user Stuart. Creation time. This is a simple time metric to show you how long ago the user was created Console access. The console access helps you to determine which users have access to the Management console. When creating a new user, you have the option to configure their access type as seen here. Each user can be configured to have Programmatic Access, or AWS Management Console Access, or both. If they have access to the Console, then this column will show as Enabled for the user and Disabled if the user does not have console access.</p>
<p>Signing certs. Finally, the last column of signing certs will show if the user has a Signing Certificate or X.509 Certificate associated with them for secure access to certain AWS product interfaces. For example, EC2 uses a Signing Certificate for access to its SOAP, Simple Object Access Protocol, and command line utilities. Finally, before we finish this lecture, you can also create and delete users as required, and search for any of your users via their username or access key from within the user dashboard.</p>
<h1 id="Creating-IAM-Users"><a href="#Creating-IAM-Users" class="headerlink" title="Creating IAM Users"></a>Creating IAM Users</h1><p>When creating a new user, you have the option to create it via the AWS Management Console or programmatically via the AWS CLI, Tools for Windows PowerShell, or using the IAM HTTP API. For this lecture, I should be using the AWS Management Console to demonstrate how to configure Users. User object creation is a simple process. Firstly, you will set the user details by creating a username, which can be up to 64 characters in length. Next you’ll select the AWS access type, either AWS Management Console access or programmatic access.</p>
<p>For programmatic access, an access key ID and secret access key ID will be issued to be used with the AWS CLI, SDKs or other development tools. If console access is required, you will need to define a console password for the user. Permission assignment through the use of policies can be attached to the user or inherited from a group that the user can be assigned to. And permission boundaries can also be applied to the user, controlling their maximum permission level. You can assign any tags to the user as you would with any other AWS resource. And then you must review and confirm the information that has been submitted before you create the user.</p>
<p>Once the user is created, you can download the security credentials via a CSV file. And that will contain the username, access keys required for programmatic access and the console login link. So let me now jump into the console to demonstrate how to create a new user. Okay, so I’ve just logged into my AWS Management Console. And the first thing I want to do is to go to IAM. And that can be found under the Security, Identity and Compliance category.</p>
<p>So if we select IAM, and that will take us straight to the IAM dashboard. And this is where we can start creating our users and groups and roles, et cetera, and anything else that we need to manage within IAM. So to create a new user, I need to go across to Users on the left here. And then from here, I can select Add users.</p>
<p>Now the first thing I need to do is to create the username of the user. So I’m going to call this user Patricia. And then we can select the access types. So we have the programmatic access here, all the AWS Management Console access here. So for this user, let me add both. So I want them to have programmatic access and also AWS Management Console access. So I’m going to select both. So for the AWS Management Console access, we need to enable a password so we can either have IAM auto-generated password or I can select my own. And for this demonstration, I’m going to add in my own password.</p>
<p>Now if you tick this option here, when the user signs in, they will be asked to generate their own password once they’ve used your initial password to login. And that’s a great idea, just to enhance security there. So if we click on Next, then we can assign permissions. And here we have a couple of options so we can add the user to an existing group. We can copy permissions from another user or attach existing policies directly to the user. So for best practice, I’m just going to add this user to a couple of different groups. So I’m gonna add them to the CloudAcademy group, and also to the RDSFullAccess.</p>
<p>So once you’ve selected the groups that you want the user to have, you can click on Next to go to tags. And this is an optional step. You can add any key value tags here for that user if you want to. Just gonna leave that blank for this demonstration. Then if we go to Next to Review, then we can review all the options that we’ve set. So we’ve given the username. We specify the access types. So you’ve got programmatic and AWS Management Console access. We’ve not set any permission boundaries. We’ve added the groups that we want the user to belong to and we haven’t applied any tags.</p>
<p>So now, we can go to Create User. Now we’ve successfully created the IAM user, but because we specified that we wanted programmatic access, we need to copy the access key ID and also the secret access key ID as well. If we download the CSV file of that user and take a look at that, we can see here that this CSV file shows the access key ID and also the secret access key ID, and also the console link as well to allow that user to login. So if we go back to the AWS Console, we can also email those login instructions to the user as well if we need to. Once you’ve taken a copy of the access key ID and the secret access key, then you can close this window. Remember, you will only be given one opportunity to take these details and download the CSV that contains that information, so make sure you do that. Then click on Close. And we can now see that that user, Patricia, has been set up as a user with the CloudAcademy and RDSFullAccess groups. So it’s very simple. It’s very quick. It’s very easy to set up a new user within IAM.</p>
<h1 id="Managing-IAM-Users"><a href="#Managing-IAM-Users" class="headerlink" title="Managing IAM Users"></a>Managing IAM Users</h1><p>Once you have created IAM users, you can view their details to configure additional security options or review permissions and change access. In this lecture, I want to cover these additional features. This will be easiest to explain via a demonstration, and I can explain each point as we go through, so let’s take a look. So in this demonstration, I just want to select a user and just to show you some of the different elements that you can change of that user once it has been created, so let’s take a look.</p>
<p>So I’m in the Identity and Access Management Dashboard at the moment and you can see I’m in the Users section. So let’s take a look at this user, Patricia. So if I select the user and we can have a look at some of the options that we can see about this user and some of the things that we can change, et cetera. So this is a summary screen of the user. We have the users ARN at the top here, and we can also see the creation time of that user. And then we have a number of different tabs.</p>
<p>So start with the permissions tab. We can see that this user is getting permissions from two policies at the moment here, the Amazon S3 Full Access policy, and also the Amazon RDS Full Access. And if we wanted to, we can just take a quick look at these groups. We can have a look at the policy summary, or we can take a look at the JSON as well. So that’s the policy and the JSON format. And then if we look at the policy summary, we can see here that this allows full access to S3 and S3 Object Lambda. Here we can set her permissions boundary. Currently there’s not one set, but if we wanted to, we can set one to control the maximum permissions that this user can have. And also there’s a feature here to generate policy based on CloudTrail events.</p>
<p>So what this will do, it will generate a policy looking at the user’s activity. And then based on what the user has been accessing, it can generate a policy based on what services this user has been accessing. Also at the top here, we can add an inline policy for this user. So if we’d done that, then that will be a policy that is embedded within the user object itself. So it’s not taken from a role, it’s not taken from a group. The policy is attached within the user.</p>
<p>Okay, if we take a look at the groups, we can just see a quick breakdown of any groups that the user belongs to, and the policies that are attached to them, which we covered just a moment ago in the summary. The tags is what you’d expect. If there’s any tags here for the user, then they would be listed, or if you wanted to add any tags, then you can do so here. So for example, we can add a key of location and say, UK, Save Changes. And then we can see this tag for this user. Under security credentials, we could see console link that this user can use and we can manage the user’s password. And if we want to change the password, we can simply click on manage, and we can either disable the console access or generate a new password, or ask the user to create a new password at the next sign-in. We also have here, the assigned MFA device, the multifactor authentication.</p>
<p>At the moment, it’s not assigned, but we can go ahead and set up MFA for this user. So let’s go ahead and do that quickly. So if we click on manage, we have a couple of options here, virtual MFA device, U2F security key, or another hardware MFA device. For this, I’m just going to use a virtual MFA device and I’ll use the Google Authenticator app on my phone to do this. If I click on continue. So, first of all, you need to make sure you have an app on your mobile phone or your computer. Like I say, I’m going to use the Google Authenticator app on my phone.</p>
<p>So what I need to do is to show the QR code, and now on my phone, I’m going to add this as a new entry in my Google Authenticator app, so I’m going to click on Scan QR code. And then we can see at the bottom there is added the user, Patricia. And then we add in that code, so 074720. And then what we need to do is to add the second code that comes in when it appears on the Google Authenticator app. So we’re just waiting for that to come around and then I can add in the second code and then it’ll be synchronized and configured. So, we can see it’s about to change, and now I can add in the next code 185887, and then I click on Assign MFA. And that’s it, so you have successfully assigned a virtual MFA device to that user. Click on Close, and there we can see here that there’s an assigned MFI device. We can see that this user also had programmatic access ‘cause there’s access keys that have been generated.</p>
<p>Now, if we wanted to, we can make this access key ID inactive. So if wanted to do that, simply click on Make inactive. And it’ll explained that once you’ve done this, you can’t then use these keys to form any programmatic access. Click on deactivate. And you can see here, the status is now inactive. So any access keys that were used before for this user will no longer be allowed to make any kind of requests. If we wanted to generate new access keys, simply click on Create access key. And again, you’ll have a new access key ID and a new secret access key. And if you wanted to, you can download the CSV file, so you don’t forget those keys. Click on Close.</p>
<p>Now, if we go back up to the top to Access Advisor, I just wanted to show you this quickly. So what this does, it will basically show you which services that this user can access based on their current permissions, and also the last time that these services were accessed. So if you scroll down here, we can see that this user has access to a whole different range of services. And it’ll show you which policies are actually granting these permissions.</p>
<p>So this access to EC2 in IAM is being granted through the RDS Full Access policy, and access to S3 is being granted through the Amazon S3 Full Access. So this is great to review to identify if there’s any users there that do have access to services that they probably shouldn’t do. So you can then modify the policies accordingly just to make sure that the users are only accessing what they are supposed to access. So that was a very quick demonstration of some of the key points that you can change within a user’s properties once you have created an IAM user.</p>
<h1 id="Managing-Multiple-Users-with-IAM-User-Groups"><a href="#Managing-Multiple-Users-with-IAM-User-Groups" class="headerlink" title="Managing Multiple Users with IAM User Groups"></a>Managing Multiple Users with IAM User Groups</h1><p>In this lecture, I want to talk about how IAM User Groups can be used to manage multiple users. IAM User Groups do not signify a single user and they can’t be referenced as a principal in any AWS access policy like a User or a Role can. However, they are used to authorize access for members of the group to AWS resources through the use of AWS Policies attached to the User Groups. So User Groups are objects that contain IAM Users, and these User Groups will have IAM policies associated that will allow or explicitly deny access to AWS resources.</p>
<p>These policies can be AWS Managed policies that can be selected from within IAM, customer-managed policies that are created by you, or in-line policies, which are written and embedded directly into the group. User Groups are a great user management feature and they are normally created to directly relate to a specific requirement or job role. For example, you could have a group called Developers, and then attach policies to that group that allow access to AWS resources required by your development team.</p>
<p>Any users that are then a member of that group will automatically inherit the permissions applied to the group. By applying permissions to a group instead of individual users, it makes it easy to modify permissions for multiple users at once, simplifying access management at scale. It’s a security best practice to apply permissions to User Groups and then associate users to that group than to associate policies to individual Users. This prevents you having to update permissions for each and every user.</p>
<p>For example, if you needed to change access for all the individual developers that had policies assigned to them directly, and this can be very time intensive and prone to human error, especially in an enterprise environment. If using groups and additional access is required for your Developer User Group, all you would need to do is to modify the permissions of the Developer Group and all your associated developers would inherit the new access.</p>
<p>Creating a group is very simple and is essentially a three-step process. You must give your group a meaningful name, add users to the group, attach permissions via the policies. Once you have created a user group, you can then review its configuration, edit the permissions and see other details such as the ARN of the user group. Let me show you via a quick demonstration on how to create an IAM group and then how to modify the permissions of the group once it’s been created.</p>
<p>Okay, so I’ve logged into my AWS Management Console and I’ve gone to the IAM dashboard. Now, from here, to access and create groups, under access management on the left, you can see user groups. So if you select that, and then will show you any groups that you currently have. And I only have one group, which is Admin. So to create a new group, you’ve gotta cross to the right-hand side here, click on create group. And the first thing you need to do is to give the group a name. So I’m going to call this MyS3andEC2Group. And then after that, you need to select the users that you want to be a part of the group.</p>
<p>So if you already have the IAM users there, you can add them at this stage. So let’s just go ahead and add in Stuart. And then at the bottom, you can then attach any policies that you want to be associated with the group. So if I type in S3, and it’ll pick up any policies that we have associated with S3. And I’m going to select this one here, this AmazonS3andEC2FullAccess policy. And if I click on the little plus sign here, it’ll give you a JSON view of the actual policy itself. So you can see exactly what’s happening.</p>
<p>So now I’ve selected that policy. If we just go down to create group at the bottom, and it’s as simple as that. So it’s very easy to create a group. You simple give it a name, specify the users if you need to at that stage and also add any permissions if you want to at that stage as well.</p>
<p>Now, once we’ve created our group, if we select it, we can see the user list here. Now, if you need to add any additional users, simply click on add users, select the users that you’d like and click on add users. And then they’ll be immediately added to the group. You can also look at the permissions. So here’s the policy that we added. Now, we can if we want to, add additional permissions by clicking on this button here. And you can either attach an existing policy or create an inline policy that’s directly embedded into the group.</p>
<p>So for example, if we go to attach policies, and we want RDS access as well for the people in this group, have a quick search and we’ll select this AWS managed policy for RDSFullAccess. Click on add permissions. And we can now see that this group has two permissions policies. And again, we can view the JSON details of those policies if we want to. And then we have the Amazon RDS policy here. So it’s very easy to set up groups and only literally takes just a few clicks.</p>
<p>So that’s how you create a new group, add users and also change the permissions as well. And also, just before we finish, if you want to delete the group, you can click on delete here. And we just need to type in the name of the group to confirm the deletion. So I’ll just go ahead and do that. Then click on delete. And that deletes the group. Finally, from a limitation perspective, your AWS account has a default maximum limit of 300 groups. To increase this you’ll need to contact AWS using the appropriate limit increase forms. Also, a user can only be associated with 10 groups, so bear this in mind when assigning permissions and each group can contain 10 different policies attached at once. Limitations on AWS services is fluctuating all of the time, so for the latest information on Group limitations, please see the following URL here.</p>
<h1 id="IAM-Roles"><a href="#IAM-Roles" class="headerlink" title="IAM Roles"></a>IAM Roles</h1><p>IAM Roles allow trusted Users, AWS services and applications to adopt a set of temporary IAM credentials to access your AWS resources. Roles act as identities, much like Users do, and have permissions assigned to them defining what resources the Roles can and can’t access. Unlike Users though, which represent a single identity, IAM Roles are designed to be assumed by multiple different entities as and when required. Like I say, Roles are used for temporary access to gain access to resources, and each time the role is assumed by a User, an AWS service or an application, a new set of credentials is dynamically created for the duration of that session. As a result, Roles do not have any long term credentials associated, so there is no password for console access, nor are there any access keys for programmatic access that are explicitly associated with the Role.</p>
<p>For every role there will be associated policies controlling access as to what can and can’t be accessed when the role is assumed. There will also be a Trust Relationship, and this Trust Relationship defined who or what can assume the role, for example a User, an AWS account, or an AWS Service. IAM Roles are generally used: if you need to grant temporary access for Users to AWS resources that they don’t normally require access to or you can use a Role to grant access for an IAM user in one account to access resources in another AWS account or perhaps an AWS service needs to access resources on your behalf or if an application requires access to resources you can use a Role instead of embedding credentials into the software itself. Or you might have federated users who require access to specific resources, perhaps those authenticated via Active Directory So, as a result, Roles can be assumed by the following: A user that’s in the same AWS account as the where the role has been created, a user that’s in a different AWS account than where the the role has been created, an AWS service, such as EC2, or an external federated users to your AWS account</p>
<h1 id="Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf"><a href="#Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf" class="headerlink" title="Using AWS Service Roles to Access AWS Resources on Your Behalf"></a>Using AWS Service Roles to Access AWS Resources on Your Behalf</h1><p>An AWS Service Role allows an AWS service to assume a role to access other AWS resources within your own account on your behalf. This is commonly used for EC2 instances, whereby you could create a role for an EC2 instance to assume to gain access to AWS resources on your behalf. Let’s look at an example of when you might use this.</p>
<p>Consider the following scenario. You have an EC2 instance running an application that requires access to Amazon S3 to Put and Get objects using the relevant API calls. To allow access to S3, a set of credentials could be stored on the EC2 instance within the application code allowing it to use those credentials to gain access to the relevant S3 Bucket for any Put or Get API requests. However, in this scenario, you would need to manage these credentials manually including the rotation of access keys, which is obviously an administrative burden and open to the possibility of being compromised by a malicious attacker.</p>
<p>To alleviate this issue, the EC2 instance could be assigned an IAM Role, which in turn would have the relevant permissions associated granting the EC2 instance and its application to access S3 to perform the Put and Get API calls using existing AWS managed or customer manager policies. EC2 instances can be assigned a role during its creation, or to a running instance. You can also replace a role that is already associated with an EC2 instance with a new role. From a security best practice perspective you should always associate a Role to an EC2 instance for accessing AWS resources instead of storing local credentials on the instance itself.</p>
<p>There is also another great advantage of using Service Roles. Let’s now imagine we have a fleet of EC2 instances all using the same application and performing the same task using the same role, but now consider that your existing application, which was used to perform Put and Get requests is now only required to perform Put requests only, and Get requests must be denied.</p>
<p>To make the change, all you’d to do is to alter the permissions assigned to the IAM Role and all EC2 instances associated with that Role would now have the correct permissions. If this same scenario happened by embedding credentials locally on the EC2 instance, then it would take a long time to replicate the change on every instance accurately.</p>
<p>When creating a Service Role, there’s a number of AWS Services that integrate with IAM that support roles. This is a screenshot at the time of writing this course showing the supported AWS services, but for the latest information, you should always check the AWS documentation found here. Before we move on from AWS Service Roles, I want to mention service-linked roles.</p>
<p>A number of different AWS services require roles to perform functions requiring very specific permissions, and in these instances AWS allows you to create service-linked Roles. These are often created the first time that you use a service. Service-linked Roles come pre-configured with the relevant AWS Managed policies, trusts and permissions allowing only that Service to carry out the required operations with other AWS resources that it needs to interact with. Some examples of these roles include AWS ServiceRoleForAmazonSSM.</p>
<p>So AWS Systems Manager uses this IAM service role to manage AWS resources on your behalf. AWS ServiceRoleForCloudTrail. So this service linked role is used for supporting the organization trail feature with AWS CloudTrail. And AWS ServiceRoleForCloudWatchEvents. CloudWatch uses this service-linked role to perform Amazon EC2 alarm actions.</p>
<p>So if we look closer at the AWSServiceRoleForAmazonSSM in IAM, we will find that the trusted identity to use this role is ssm.amazonaws.com, AWS Systems Manager. and with it having an AWS Managed policy already configured, we’re unable to edit and update this policy. This policy is specifically designed to provide access to AWS Resources managed or used by Amazon SSM, and this role is created when you configure SSM. So the difference between AWS Service and AWS Service-Linked Roles is that AWS Service roles allow you to apply your own customer managed or AWS Managed policies, whereas service-linked roles come pre-configured with a specific set of read-only AWS managed policies that can only be used by that particular service.</p>
<h1 id="Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users"><a href="#Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users" class="headerlink" title="Using IAM User Roles to Grant Temporary Access for Users"></a>Using IAM User Roles to Grant Temporary Access for Users</h1><p>There might be circumstances where you will need to grant temporary access to AWS resources for a particular user and the best way to do this would be to allow the user to assume a role with these new permissions. The alternative would be to either add a policy associated with the user and then remember to remove the policy again afterwards, which would likely lead to a security risk, and as we know, attaching policies to a specific user isn’t considered a security best practice, we should use user groups instead. However, if we added these permissions to a user group that the user belonged to, then all users that are a part of that same user group would receive those permissions, so that’s definitely a security risk.</p>
<p>So in this instance, creating a new role with the relevant permissions and allowing only specific users to assume that role, is the best approach to the problem. When a user assumes a role, it replaces all other permissions that the user has. You might think that the user keeps their current permissions and just inherits the additional permissions set out by the role, but that’s not the case. When you assume a role, your existing permissions are temporarily replaced.</p>
<p>I mentioned previously that every role has a trust relationship and so as a user, you can only assume roles where they have been added as a trusted entity. However, in addition to being trusted, the user also has to have the relevant permissions to assume the role as well and this is done via an access policy.</p>
<p>So let’s assume we have a role called RoleS3FullAccess with a permission policy attached as shown which grants full access to Amazon S3. And the trusted entity of this role was defined as the user specified in this ARN. So this means this role trusts the user, Stuart, to assume the role to gain full access to S3. However, Stuart’s permissions do not currently allow him to assume this role. For Stuart to be able to assume the RoleS3FullAcess role, Stuart will need to have the following policy associated with his user, where the text in red is the ARN of the role. When this policy is associated with Stuart, he then has permission to assume the role which is trusted to him as defined in the trusted entity section of the role allowing him to have full access to S3.</p>
<p>Let me now provide a demonstration on how you could create this example that we just ran through. Okay, so I’m in my AWS Management Console and I’m at the IAM dashboard. So in this demonstration, we’re going to create a role with a policy attached and then add an inline policy to the user, Stuart, to ensure that Stuart can assume the role.</p>
<p>So firstly, let’s create our role. So on the left here, we have roles and then over in the top right, we have Create Role. So because we want this role to assumed by a user, we have to pick the correct type of trusted entity. So it’s not going to be assumed by an AWS Service and it’s not to with Federation either, so the option we need here, is this one relating to an AWS account. Now although says another AWS account, this option is used to creating cross-account access, but you can also create roles to be assumed by users within your own account as well. And to do that, all we need to do in the account ID, is to enter our our account ID, so if I just add that in there, and you can also add a couple of additional options, such as requiring multifactor authentication, et cetera.</p>
<p>So once we’ve put in the account ID of where the users are that we want to assume this role, we can then click on next, permissions. And I want the policy that’s attached to this role to have full S3 access, so let’s have a quick search. And here we have it here, Amazon S3 full access, which is an AWS managed policy. Then click on next for tags. Add any tags in that you’d like for the role as an optional step. I’m just gonna leave it blank for this demonstration. And this is where we can give the role a name, so I’m going to call this RoleS3FullAccess. Give it a description if you need to and here we have the trusted entity, which is my own account and then all we need to do from there, is click on Create Role.</p>
<p>Okay, so if we search for that. RoleS3, here we have our role here. So if we go into the role, we can have a look at our trust relationships, so this is essentially saying that anyone within this account is trusted to assume this role and we can also edit this trust relationship as well. So this shows the policy that relates to that trust relationship. So this essentially allows anyone in this account, access to the role, as long as they have that assume role permissions that we’ll be looking at in just a moment. But I want to make this a bit more secure, so I’m going to change it from root to user, Stuart.</p>
<p>So now the trusted relationship for this role will only allow the user, Stuart, within this account to assume the role, given the correct permissions. So I’m gonna update that trust policy and now we can see the trusted entity has been changed. And if we take a look at the permissions, we can see that it has the policy attached there as well. So now we’ve got roles set up with the correct permissions, we now need to edit the user, Stuart with an inline policy to allow that user to assume the role. So I’ve just gone with IAM user of Stuart. If we click on add inline policy and go across to JSON.</p>
<p>Now, here I’m just going to paste in a policy that I’ve already created. So will allow the user, Stuart to use the secure token service AssumeRole action against the role that we just created and that’s the ARN in the role. So now Stuart will have access to assume that role. Let’s go to review policy. Give this a name. I’m just going to call this, AssumeRoleS3. Create policy. And there we have the inline policy that we just created, attached to the user, Stuart.</p>
<p>So now what I want to do, is to log in as the user, Stuart and show you how I can switch to this role. Okay, so I’ve now signed in as the user, Stuart and to switch roles, all I need to do, is to select on the top right up there, select Switch Role. And again, Switch Role. Type in the account. So I’ll just paste that in quickly and then type the role name, which we called RoleS3FullAccess and then click on Switch Role. And that’s it, we’ve now switched roles and if you look in the top right, we can see that it says, RoleS3FullAccess at this account number and that signifies that you swapped your permissions for that role that the user, Stuart has just assumed.</p>
<p>Once you finish what you need to do with the permissions given by the role, you can simply select the top right area again and say Switch Back. And that will revert you back to your original user with your original permissions. IAM user roles are often used to create a cross-account access role, allowing users in one AWS account to access resources in a different AWS account. For a full explanation on how to create cross-account roles, please see our existing course found here.</p>
<h1 id="Using-Roles-for-Federated-Access"><a href="#Using-Roles-for-Federated-Access" class="headerlink" title="Using Roles for Federated Access"></a>Using Roles for Federated Access</h1><p>In this lecture, I want to discuss how users who have been federated can access your resources using roles. When doing so you have two options. Firstly, Web Identity, this allows users federated by a specified external web identity or OpenID Connect provider, to assume this Role to perform actions in your account. And secondly, SAML 2.0 federation, this allows users that are federated with SAML 2.0, to assume this Role to perform actions in your account.</p>
<p>So let’s first look at Web Identity and a scenario where you might need to create a Role. You’ve just created a new mobile application that requires access to Amazon S3 to store media such as photos and videos from users worldwide. As a part of the operations of your application, it will require permissions to S3, to upload and download this media from tens of thousands of users. Embedding long-term credentials into your application code to do this goes against all security best practices. And so instead, you should design your application to request temporary credentials from authenticated users through web identity federation. </p>
<p>Before I go any further, let me explain what identity federation is. It’s basically a method of authentication where two different providers can establish a level of trust, allowing users to authenticate from one, which authorizes them to access resources in the other. During the federation process, one party would act as an Identity Provider, known as an IdP, and the other would be the service provider, an SP. The identity provider authenticates the user and the service provider controls access to their service or resources based on the IdP’s authentication.</p>
<p>You’ve probably all been to websites where it presents you with a login page, where you can either login using existing credentials, native that service, or you might have an option to authenticate using credentials from a third party provider, such as Facebook, Google, Twitter, or LinkedIn, et cetera. So going back to our example, our application run on AWS would be the service provider, and the Web Identity provider could be Google or Facebook, for example.</p>
<p>So when users authenticate to your app via web identity federation, they will receive an authentication token. This token is then exchanged for temporary security credentials in AWS, which can be mapped to your IAM Role, using the AssumeRoleWithWebIdentity API. This then allows the relevant access to Amazon S3 provided by the role, to carry out the operations needed by the application.</p>
<p>Generally, when working with mobile applications, the preferred and recommended method for managing access, would be via Amazon Cognito, to manage his federation process. For more information related to Amazon Cognito, please see our existing course here.</p>
<p>Let’s now take a look at SAML 2.0 federation. Whereas web identity federation is generally used for large, wide scale of access from unknown users, SAML 2.0 is generally used to authenticate your employees using existing directory services that you might already be using. SAML, which stands for Security Assertion Markup Language, is a standard that’s used to exchange authentication and authorization identities between different security domains, which uses security tokens containing assertions to pass information about a user between a SAML Identity Provider and a SAML consumer.</p>
<p>For example, you might already to be using Microsoft Active Directory to authenticate your employees to your internal network. And so you might not want to or need to create lots of users in IAM with their own set of credentials. Instead, it would be easier to allow them to federate their access through via SAML, integrating with your ADFS server. The benefits of this are twofold. It minimizes the amount of administration required within IAM and it allows for a single sign on solution.</p>
<p>As the vast majority of organizations today are using Microsoft Active Directory, using MSAD is an effective way of granting access to your AWS resources without going through the additional burden of creating potentially hundreds of IAM user accounts. Let’s take a high-level look at how active directory authentication mechanism is established. This example will assume the user within an organization requires API access to S3, EC2, and RDS. This scenario will also include the use of an AWS service called Security Token Service, STS. The Security Token Service allows you to gain temporary security credentials for federated users via IAM, associated with IAM roles and policies. Let’s look at this in more detail via a diagram.</p>
<p>A user within an internal organization initiates a request to authenticate against the Active Directory Federated Service, an ADFS server, via a web browser using a single sign on URL. If their authentication is successful by using their Active Directory credentials, SAML will then issue a successful authentication assertion back to the user’s client, requesting federated access. The SAML assertion is then sent to the AWS Security Token Service, to assume a role within IAM using the AssumeRoleWithSAML API. STS then responds to the user requesting federated access with temporary security credentials, with an assumed role and associated permissions, allowing S3, EC2, and RDS access as per our example, the user then has federated access to the necessary AWS services as per the role’s permissions.</p>
<p>This is a very simple overview of how federation is instigated from the user for API access to specific AWS services. Corporate identity federation is always authenticated internally first by Active Directory before AWS, when creating your role for users federating via SAML, you can specify if you want to provide programmatic access only, or programmatic and AWS management Console access, in addition to specific permissions to access other AWS resources.</p>
<h1 id="IAM-AWS-Policy-Types"><a href="#IAM-AWS-Policy-Types" class="headerlink" title="IAM AWS Policy Types"></a>IAM AWS Policy Types</h1><p>Hello and welcome to this lecture where I want to talk about four different policy types that you can expect to see when working with <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/introduction-81/">AWS IAM</a>. Identity-based policies. These policies can be attached to users, user groups or roles within IAM. Essentially, any entity that depicts an identity. Resource-based policies. Instead of being associated with an identity, these policies are attached in line to resources themselves. An example of a resource-based policy in IAM will be that of a role trust policy where the policy defines the principle that can assume the role.</p>
<p>Permission boundaries. These policies can be associated with a role or user, but they don’t actually grant permissions themselves, instead they define the maximum level of permissions that can be granted to an entity. Organization service control policies, SCPs. These are very similar to permission boundaries in the fact that they do not grant permissions. They define a boundary of maximum permissions. However, these service control policies are associated with an AWS account or organizational unit, an OU, when working with AWS organizations and govern the maximum permissions to the members of those accounts.</p>
<p>With all of these policy types, it’s easy to see why some people can get confused as to which type of policy is being used or should be used. So let me run through each of these policies in greater detail, starting with the identity-based policies.</p>
<p>As already highlighted, these policies can be attached to users, user groups, or roles and they control what permissions each of those entities have. Identity-based policies can either be managed or inline policies, but what does this mean? Well, managed policies are saved within the IAM library of policies and can be attached to any user, user group or role as and when required, and the same policy can be attached to multiple entities.</p>
<p>Managed policies also come in two different flavors, AWS managed policies and customer managed policies. AWS managed policies are policies that have been pre-configured by AWS and made available to you to help you manage some of the most common permissions that you may wish to assign. Some examples of AWS managed policies can be seen here. From the policy name, you can usually tell what access is being given, although you can expand upon each policy to see the JSON document that is associated.</p>
<p>Customer managed policies are those that you have created yourself, which can then be associated with a user, user group or role. You might want to create customer managed policies when the AWS managed policies do not meet your security requirements. For example, you might want to add additional granularity to the policy to restrict access at a specific API call level.</p>
<p>Let me now explain how inline policies contrast against managed policies. So inline policies are embedded directly into the entity, either the user, user group or role. The policy is not saved and stored in the IAM library policy, its only existence is within the associated entity. As a result, it can’t easily be replicated to other entities, it’s specific to that one user, user group or role, creating a one-to-one relationship. It’s not always best practice to use inline policies as they take a lot of administration to keep on top of and should only be used if absolutely necessary. For example, you might have some elevated permissions that you don’t want to have mistakenly given to someone else that they weren’t intended for.</p>
<p>Okay, let me now move onto resource-based policies. So resource-based policies are effectively inline policies that are associated with a resource instead of an identity. If you have been using <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-to-amazon-s3/introduction/">Amazon S3</a> for any extended period of time, then you may have come across S3 bucket policies, which is a common resource-based policy where permissions to the bucket are defined at the resource level and defined which principle or principles can access the bucket based upon different actions.</p>
<p>When using roles within IAM, the role has a trust relationship policy, which is a resource-based policy. As a result, the permissions of the trust are embedded inline within the role itself. So in this instance, the resource is the role and the resource-based policy is the trust relationship. This example shows the resource-based policy of the trust relationship of one of my roles. In this policy, the user, Stuart is the principle and has the ability to assume the role. It is this parameter of principle which signifies the difference between an identity-based policy and a resource-based policy.</p>
<p>Identity-based policies don’t have that principle parameter as the policy is already associated within the identity. Resource-based policies must have the principle parameter to determine which identity that the policy permissions relate to. Next up, we have permission boundaries. So permission boundaries can only be associated with a user or role. It’s not possible to add a boundary to a group. They differ from both identity-based and resource-based policies in the fact that permission boundaries don’t grant permissions themselves. They act as a guide rail to limit the maximum level of permissions that the user or role can be given. The policy configured for the boundary can be an AWS managed or customer managed policy.</p>
<p>So let’s assume for example, that our user, Stuart has an identity-based policy associated with him that allows full access to S3 and full access to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-elastic-compute-cloud-ec2/amazon-ec2/">EC2</a> using the following AWS managed policies. However, if a permission boundary was also configured for Stuart using the following AWS managed policies, which only grants read only access to S3, but still full access to EC2, then the resulting access for the user, Stuart would be full access to EC2, but only read only to Amazon S3 as the maximum permission defining by the permissions boundary was limited to read only despite the user having an identity-based policy associated granting full S3 access.</p>
<p>So the last policy I want to reference are the SCPs, the service control policies. So service control policies are used by AWS organizations and attached to AWS accounts or organizational units, OUs, to define the maximum permissions allowed for the members of the associated account or OU. So in a way they act in a similar fashion to that of permission boundaries, but at the account level and affect all members of those accounts.</p>
<p>For example, let’s say a user within an AWS account had full access to S3, RDS and EC2 via an identity-based policy. If the SCP associated with that AWS account denied access to the S3 service, then that user would only be able to access RDS and EC2 despite having full access to S3. The SCP would serve to prevent service from being used within the AWS account and so have the overriding precedence and determine the maximum level of permissions allowed.</p>
<p>So to be clear, an SCP does not grant access, they add a guide route to define what is allowed. You’ll still need to configure your identity-based or resource-based policies to identities, granting permission to carry out actions within your accounts. If you want to use service control policies to help you manage your security at an account level, then you need to ensure that you deploy AWS organizations using the enable all feature setting.</p>
<p>Within IAM, you have the ability to view any SCPs that are applicable to your AWS account, the policy statement itself, it’s ARN, the number of entities it affects and you can also review access activity to learn when a principal within the organization last accessed a service. However, if you wanted to update or edit the SCP, then you’d have to do that from within the AWS organization service itself. The SCP can’t be edited from within IAM. For more information relating to how to implement, manage and secure AWS organizations using SCPs, then please see our existing course here.</p>
<h1 id="Examining-the-JSON-Policy-Structure"><a href="#Examining-the-JSON-Policy-Structure" class="headerlink" title="Examining the JSON Policy Structure"></a>Examining the JSON Policy Structure</h1><p>In this lecture, I will be taking a deep look at the syntax and structure of IAM policies. For both identity-based and resource-based policies, the syntax is the same, but you might use slightly different parameters. If you’ve worked with IAM at all before, then I am sure you have come across an IAM policy. After all, it is the component that defines what an identity can or can’t access. But what do these policies actually look like? IAM policies are formatted as JSON documents, JavaScript Object Notation, and each policy will have at least one statement where the structure may look like this example.</p>
<p>Let me break the structure of this policy down to allow you to understand each element. Version. This specifies the policy language version and specifies the language syntax used, and at the time of writing this course, the current policy version is 2012-10-17. Statement. This defines the main element of the policy, which will includes other sub-elements, including the Sid, Effect, Action, Resource, and Condition. These elements will identify the level of access granted or denied and to which resource. A policy must contain at least one statement, but it can also contain an array of statements. For each statement block, it must be enclosed within curly braces, but if you use an array of statements, then you must enclose the entire array within square brackets. And we shall look at an example of this during this lecture.</p>
<p>Sid. This is the statement ID, and it’s an optional parameter that allows you to set a unique identifier within the statement. As you add more arrays within your policy, it can be a good idea to include a Sid for each one, allowing you to name them appropriately, making them more easily identifiable. For example, AllowGetObjectForS3. Without reading the rest of the statement, you can get a good idea of what the permissions in this statement allows.</p>
<p>Effect. This element can be set to either Allow or Deny, which either grant or restrict access for the actions defined in the statement. By default, all access to your resources are denied and so, therefore, if this is set to Allow, it replaces the default denied access. Similarly, if this was set to Deny, it would override any previous Allow. An explicit Deny in a policy will always take precedence over any Allow.</p>
<p>Principal. This parameter defines which principal the policy relates to. The Principal is only used for resource-based policies, for example, those policies attached to S3 Buckets. When using identity-based policies, this parameter is not required within the policy as the policy itself is associated with the principal and not a resource. As an alternative to the Principal parameter, this could be replaced with the NotPrincipal parameter, which would specify the user, role, or AWS account that is not allowed or denied access to the associated resource.</p>
<p>Action. This is the action that will either be allowed or denied, depending on the value entered for the Effect parameter. Actions are effectively API calls for different services. As a result, different actions are used for each service. For example the DeleteBucket action is available for S3 but not EC2, and likewise, the CreateKeyPair action is available for EC2 but not S3. The action is prefixed with the associated AWS service. This example defines two actions, CreateTrail and DeleteTrail, for the CloudTrail service. As another example, you can see this one here with the asterisk, and this acts as a wildcard which represents all actions for the CloudTrail service, essentially granting full access to the service.</p>
<p>Similarly, as we had with the Principal parameter, we could replace the Action parameter with the NotAction instead, and this could help you optimize your policy by creating a shorter version, listing just a limited set of actions that should not match instead of creating a longer policy listing all that actions that should. An example of using the NotAction is shown here. This policy essentially allows all actions for CloudTrail apart from the DeleteTrail API, and this is because the NotAction parameter is being used.</p>
<p>Resource. This element specifies the actual resource you wish the Action and Effect to be applied to. AWS uses identifiers known as ARNs, Amazon Resource Names, to specify specific resources. Typically, ARNs follow a syntax of, arn, partition, service, region, account-id, and then resource. So the Partition element, this relates to the partition that the resource is found in. For standard AWS regions, this would be AWS. Service. This reflects the specific AWS service, for example, S3 or EC2.</p>
<p>Region. This is the region where the resource is located. Some services do not need a region specified, so this can sometimes be left blank. Account-ID. This is your AWS Account ID, without hyphens. Again, some services do not need this information and so can be left blank. Resource. The value of this field will depend on the AWS service you are using. For example, if I were using the action, Action:s3:PutObject, then I could use the bucket name that I wanted those permissions to apply to. Again, we also have a NotResource parameter that can be used to explicitly match all other resources except those specified. For example, this policy will allow access to all S3 buckets other than those specified by the NotResource parameter.</p>
<p>Condition. This is an optional element that allows you to control when the permissions will be effective based upon set criteria. The element itself is made up of a condition and a key value pair and all elements of the condition must be met for the permissions to be active. Let’s take a look at an example condition. In the example, the IP address is the condition itself, which the key value pair will be effective against. The aws:SourceIp is the Key and the 10.10.0.0&#x2F;16 is the value element of the key. So effectively, what this is saying is, if the Source IP address of the user who is requesting access via the policy is within the 10.10.0.0&#x2F;16 network range, then implement the permissions in the policy statement.</p>
<p>Now that I’ve gone through the core parameters of an IAM policy, let’s take a look at a couple of examples to ensure we can understand the permissions that are being presented within the policy. As I mentioned previously, you can have multiple Sids within a statement, each granting a different level of access. The example below demonstrates this, and I have highlighted each a different color to show the separation.</p>
<p>So looking at this example policy, let’s determine what access is being granted. So in StatementBlock1, this allows any resource full access to CloudTrail on the condition that their source IP address is within the 10.10.0.0&#x2F;16 network range. StatementBlock2. This allows full access to all RDS databases using all API calls except for that of the rds:DeleteDBInstance due to the NotAction parameter being used instead of the Action being used. And in StatementBlock3, this allows the creation and deletion of S3 Buckets within the cloudacademy bucket on S3.</p>
<p>Let’s take a look at another example policy, this time, a resource-based policy, and in this instance, it’s from an S3 bucket. So in this policy, it allows the user, Stuart, as highlighted by the Principal parameter, to create and delete buckets in addition to deleting the bucket policy. Stuart can also delete and put objects within the bucket, and the bucket that this policy refers to is the bucket named ca-bucket-uk, as defined by the Resource parameter. However, there is a condition bound to this policy that states that Stuart can only do this if he was authenticated via Multi-Factor Authentication, MFA. That should now give you more of an understanding of how JSON IAM policies work and what they look like.</p>
<h1 id="Creating-an-AWS-IAM-Policy"><a href="#Creating-an-AWS-IAM-Policy" class="headerlink" title="Creating an AWS IAM Policy"></a>Creating an AWS IAM Policy</h1><p>Hello and welcome to this lecture where I will show you how to create your IAM policies. Let’s start by creating an identity-based, customer managed policy, and there are a number of ways to create a customer managed policy, these being, copy an existing AWS Managed Policy. So we can copy an existing policy and then edit that policy to ensure it meets the requirements we need, and this can save us some time.</p>
<p>We can use the Policy Generator, and this allows you to create a customer managed policy by selecting options from a series of dropdown boxes. And we can also create our own policy. So if you’re proficient in JSON and the syntax of IAM policy writing, then you can write your own policies from scratch or paste in a JSON policy from another source. So I now want to give you a quick demonstration on how to create a policy in each of these three ways. And the demonstration will include, how to create a customer managed policy by editing an existing AWS managed policy, how to create a customer managed policy using the Policy Generator, and how to create a customer managed policy from scratch. So let’s take a look.</p>
<p>Okay, so I’ve logged into my AWS Management Console, and I’m at the IAM dashboard, and I’ve gone into Policies. So from here, we can create a number of different IAM policies. And the first method I’m going to show you is how to copy and import an existing AWS managed policy to create your own, if you need to make a few changes to it. So let’s go ahead and do that now. So from here, we need to go across to Create Policy.</p>
<p>Now, from here, we have an option on the top right here called Import Managed Policy, and that’s what we want to do. I want to import an AWS managed policy and then make a couple of small changes to it. So if I select Import Managed Policy and then find the policy that I want to find. So let’s, for example, look at AmazonS3FullAccess, import that, and we can see here that it’s imported the data. And if we look at the JSON tab, we can actually see the JSON format of that policy, and from here, we can directly make changes.</p>
<p>So for this quick demonstration, I want to copy this existing policy, but instead of allowing any resource, I want to specify my own resource for this, which will mean instead of this policy being, allow full access to Amazon S3, it allow full access to a specific bucket on Amazon S3. So let me go ahead and make those changes now. So I’m gonna change the asterisks from Resource and put in my own specific ARN of a bucket. So now, I’ve changed the resource to my own ARN.</p>
<p>So now, all I need to do is click on Next, go to Tags, and I can add any optional tags if I want. I’m just gonna leave that blank for this demonstration. Go across to Review, and here I can give this new policy a name. So I can call it S3FullAccessToMyBucket. And description, this allows full S3 access to ca-bucket-uk. And it gives you a summary of the policy here. So we can see the service that it’s using, the access level, and also the resource. Once we’re happy with that, we can simply click on Create Policy. And we can see that that policy has now been created.</p>
<p>Now, if we have a look at that policy, just by clicking on it there, it’ll take us straight to it, and we can see the JSON version of the policy. So that’s a very quick and easy way if you want to save yourself some time by copying existing S3 managed policies that are already there. Now, I chose a fairly simple policy just for demonstration, but there are some quite complex policies that AWS already have that you might need to just tweak a few changes to so you can simply import those existing managed policies, make your changes, and then save it as a new customer managed policy.</p>
<p>Okay, so that’s the first method covered. Now, next, I want to show you how to create a policy using something called the AWS Policy Generator. Now, if you simply go to Google and type in the AWS Policy Generator, then it’ll come up straight away, and you’ll be brought to a page like this. Now, the actual URL of this Policy Generator, if you’d prefer to type it in, is awspolicygen.s3.amazonasw.com&#x2F;policygen.html. So this is a Policy Generator, and it allows you to easily create different types of AWS policies.</p>
<p>So if we look at this drop down list here, we can create an SQS policy, an S3 bucket policy, which, as we know, is a resource-based policy, a VPC endpoint policy, an IAM policy, and an SNS topic policy. We’re interested in the IAM policy. So if we select that, now, in step two, we can add our statements. Now, here, we have our effect, which can be allow or deny. So let’s say allow for this example. And then, we can select the service that we’re interested in. Let’s select Amazon S3 to keep it nice and simple. And now, we can select our actions.</p>
<p>Now, we can select individual actions here just through these tick boxes for any actions that we’re interested in. So I’ll just select a number of different ones there. And you can see here that it’s selected five actions. If you wanted all actions, you would simply tick this box. And then, you’d put in the ARN of the bucket. So let’s just put in that same bucket that we used in the previous example. And then, here, we can also add in any conditions that we’d like. So just through a series of dropdown boxes, you can specify any conditions that you’d like in there as well. And then, once you’re happy with your policy, simply select Add Statement. And here, it breaks down a summary as well. So it shows the effect, the action, the actions that we selected, the resource, and if there’s any conditions, which we didn’t specify any.</p>
<p>Now, if you wanted to, we can now add an additional statement. So for example, if we wanted to add some RDS elements in here as well, we can select AWS Service, select a load of actions, put in the ARN of your RDS database, and also add that statement to the same policy. Then, once you’re happy with your policy and the number of statements that you’ve added, simply click Generate Policy. And here, it shows you the JSON view of the policy that you would need based on your dropdown selection. So what you can do now is simply copy that, go back to IAM, go to your policies, Create Policy, go to the JSON tab, and simply paste it in. So it’s a very quick way of creating a policy through a series of dropdown boxes. And again, you can just progress through, adding any tags that you need to do, give this a name, ThisIsMyPolicy, and then click Create Policy. And again, you can see that this has been created. You can select that. And again, we can see the JSON statement there.</p>
<p>So now, we’ve looked at how to create a policy by copying an existing AWS managed policy. We’ve looked at how to use the AWS Policy Generator. Now, let’s just quickly review how to create a policy from scratch. So again, go back to Policies and then Create Policy. Now, you can either use this visual editor or go straight to JSON, and you can start typing out your policy in here as and how you need it, or you can use the visual editor, which is very similar to the Policy Generator we just looked at, where, again, you can choose a service, then the specific actions, say all S3 actions, then you can specify the resources, whether you want this, again, as an access point, a bucket, a job, an object. So you can say any object. Then, you can specify any conditions, if you need MFA or specific source IP, for example. And again, you can also add additional permissions here.</p>
<p>So almost like another statement. It’s very similar to the Policy Generator. But for me, personally, I think the Policy Generator is slightly easier to understand. And then, once you have your settings as you want them, and this has all been pre-filled from the options from the visual editor, and, again, click Tags, then Review, and then give this a name, MyPolicy, and then go to Create Policy. And if we take a look at the policy, we can just see its details again. And again, this shows the JSON view, et cetera. And if we wanted to edit the policy directly here, then we can. Click on Edit. Then, we can either edit through the visual editor, or we can directly edit the JSON view as well. So that’s just a couple of ways of creating your IAM policies in a few very simple steps.</p>
<h1 id="Policy-Evaluation-Logic"><a href="#Policy-Evaluation-Logic" class="headerlink" title="Policy Evaluation Logic"></a>Policy Evaluation Logic</h1><p>Every time someone tries to access a resource within AWS, the request is processed through a series of steps. One of which involves evaluating the level of permissions based upon the policies that are used. So let’s take a look at the whole process to understand how access is either granted or denied. And we can start with a simple four step process. So firstly authentication. We must first ensure that the principle sending the request is authenticated as a valid user.</p>
<p>Next, the context. Once authentication of the principle has been established, AWS then needs to determine the context of the request that is being asked, for example, what service or action is being requested. And this ensures that the relevant policies can be highlighted based on the request. We then have policy evaluation, and this is the part that we are interested in. Based on the request, there may be multiple policy types that need to be reviewed to determine the level of access, and I shall cover this in greater detail as we go through this lecture. And then finally, the result. AWS will determine if access is allowed or denied based upon the evaluation of all policies used.</p>
<p>So for this lecture, I want to focus purely on the third point, the policy evaluation and how that process is carried out. The rules for reviewing permissions across multiple policies in a single account is actually quite simple and can be summarized like this: by default, all access to a resource is denied. Access will only be allowed if an Allow has been specified within a policy associated with the principle. If a single Deny exists within any policy associated with the same principle against the same resource then that Deny will overrule any previous Allow that might exist for the same resource and action. So to reiterate, an explicit Deny will always take precedence over an Allow.</p>
<p>Now, there is an order in which policies are evaluated, and the following list of policies are shown in the order of evaluation. So firstly, we have any Organizational Service Control Policies. Then any Resource-based policies, then IAM permission boundaries, and then finally Identity-based policies. So let’s look at an example scenario. Let’s assume that the user, Stuart, is requesting to upload an object to the s3 bucket of ca-bucket-uk using the s3:PutObject API.</p>
<p>With this in mind, let’s assume we have the following policies in place to see what happens at each step of the evaluation. So firstly, the evaluation will review any organization SCPs in place, and here is our example SCP. So this SCP will simply deny all access to RDS. So there is no Deny in place that affects the s3:PutObject requested by Stuart so the evaluation continues. Next, the evaluation will identify any resource-based policies, and here we have a Bucket Policy associated with the ca-bucket-uk as shown.</p>
<p>Again, there is no Deny here for the request in question, so the evaluation continues. Next, we have IAM Permission Boundaries. And this IAM Permission Boundary Policy is set on the user, Stuart. So this policy sets out a maximum permission boundary of full access to s3. Remember, permission boundaries do not actually grant permissions, they set the maximum privilege level, as full access to s3 allowed, the evaluation continues.</p>
<p>Finally, we have the evaluation of any Identity-based Policies, and this policy is associated to the group that the user, Stuart, belongs to. So as we can see, this policy allows any s3 action to the ca-bucket-uk. As a result, this permits Stuart to upload an object using s3:PutObject to the s3 bucket of ca-bucket-uk. So the final decision upon the policy evaluation is to allow the request.</p>
<h1 id="Implementing-Cross-Account-Access-Using-IAM"><a href="#Implementing-Cross-Account-Access-Using-IAM" class="headerlink" title="Implementing Cross-Account Access Using IAM"></a>Implementing Cross-Account Access Using IAM</h1><p>Welcome to this lecture covering the principles of cross-account access. Firstly, let me quickly define what cross-account access is. Put simply, it allows IAM users from one AWS account to access services within a different AWS account through the use of IAM roles. Now, IAM roles allow users and other AWS services and applications to adopt a set of temporary IAM permissions to access AWS resources.</p>
<p>But why would you want to implement cross-account access in the first place? Well, essentially it comes down to architecture and security best practices. For example, most organizations using AWS will probably have a production and a dev or test environment. For ease of management and isolation, it’s likely that each of these environments will be in separate AWS accounts. With this in mind, your development team who primarily work in the dev account may occasionally require access to resources in the production account. Instead of creating additional user accounts in the production environment, which would only be required on a rare occasion, roles could be used with the required permissions instead. The development team could then be granted permission to assume this role to then access the resources in the production environment. This helps to adhere to the principle of least privilege.</p>
<p>As this access is not always required, the developer must consciously switch to and assume the role to access the other resources. For additional security, you could also add multi-factor authentication to the role before it can be assumed, adding another verification step.</p>
<p>Let me now look at the key steps required to implement cross-account access. To understand this process, you need to be aware of two key terms that I will be using. These being the <em>trusted</em> account, and the <em>trusting</em> account. Using our previous example of production and dev, the production account will be the trusting account and the development account would be the trusted account, as the development users will be trusted to access the resources in the production account, which is trusting those users.</p>
<p>Let me break the process down. Firstly, you must create a role from within the trusting account, which in our example, would be the production account. This is to establish a trust between the two accounts. This role will define the development account as a trusted entity. Next, you must specify the permissions attached to this newly created role which the users in the development account would assume to carry out their required actions and tasks. Next, you must switch to the trusted account, in this scenario the development account, to grant permissions to your developers to allow them to assume the newly created role in the trusted account. Finally, you can test the configuration by switching to the role.</p>
<p>Now we know the fundamentals of this process, let me provide a demonstration on how to configure this using the AWS Management Console. Okay, so I’m logged into my AWS account, as you can see I’m on the AWS Console, and this is going to be my trusting account. So from here, I need to select IAM to allow me to create the role. So under Security, Identity, &amp; Compliance, we can see the IAM service, so if we select that. Go across to the left-hand side and select roles. And at the top you can see a blue button called Create role, so let’s click on that. And here I need to select the type of trusted entity. Now, because I want this role to be assumed by another account, I’ll select this option here, the second option where it says Another AWS account. And underneath here you have a couple of options, and here we need to enter to account ID and this is the account ID of the trusted account. So let me just go ahead and enter the account number of what will be the trusted account. And if you wanted to add multi-factor authentication then you can select this tick box here. For the sake of this demonstration, I’m just going to leave that unticked. Once we have the trusted account ID entered then we click on next for permissions. And here we specify what permissions we want assigned to this role to allow the users in the trusted account to assume. So let’s just enter EC2 and we’ll give them EC2FullAccess. Once you’ve assigned your permissions, select Next. </p>
<p>If you want to add any tags for this role then you can enter that here. For this demonstration, I’m just going to click on Next. And finally, we get to give our role a name, so I’m just going to call this CrossAccountDemo. We can add a description if we want to. And we can see here that the trusted entities is the account ID that I entered. So this is a different account from the one I’m in at the moment. And also you can see the policy that I assigned here. </p>
<p>Okay, let’s create this role. And there you see it, the role CrossAccountDemo has now been created. So now we’ve set up the role and we’ve added the trusted account as the entity of this role, let’s now swap over to that account to allow the users in that account to assume this role within this account. So let me just flip over to that account now.</p>
<p>Okay, so I’m now in the other account, as you can see up here it’s a different account number. And this is the account number that I added as the trusted entity on the role. So if we go down to the IAM service from here. And I want to assign some permissions to one of my groups, and I’m going to assign it to the developer group. So if I select this group here, we can already see that this developer group has a number of policies that allow specific access within this account, but I want all users in this group, and if we just click on the Users tab, we can see that there’s two users here, and one of those users is the account that I’m logged in as at the moment.</p>
<p>So, I want all users of this group to be able to assume that role that we created in the trusting account. So I’m going to create an inline policy. So if I click on Inline Policies, it says there are no inline policies to show, to create one click here. I’m going to create a Custom Policy, click on Select. Give the policy a name and I’ll call this CrossAccountAccess. And I’ve already created a policy for this, so let me just paste this in and I’ll just run through it. So, what this policy does, it allows the AssumeRole action for the role that I created in the other account, and as we can see, that is the account number of the trusting account where the role exists, and that’s the role name. So when you’re setting this up on yours, just make sure you have the account number of the trusting account and also the correct role name that you configured for your own.</p>
<p>So, once that policy’s created, if we just click on Validate Policy, we can see that the policy is valid, and then click Apply Policy. And if we have a look, we can now see the policy under Inline Policies. So again, just to reiterate, now any user within this group is able to assume the following role, and that’s the role that we created in the trusting account.</p>
<p>So now that permission is set, let me see if I can switch roles. Now, to do that, if you go to the top of the screen here where it shows who you’re logged in as under what account and click on the dropdown list, and then at the bottom we can see Switch Role. So if I click on Switch Role. So if I enter the account number of the trusting account, and then the role name, which was CrossAccountDemo, and then select Switch Role, we can see at the top here that we’re now logged in under the CrossAccountDemo at the trusting account.</p>
<p>Now, when you assume a role, the permissions you already had are replaced with temporary permissions of this role. As a result, I can see a lot of errors within IAM here, because I don’t have access to IAM. If you remember, the only permissions we allowed on this role on the CrossAccountDemo role, was full access to EC2. So that’s why I’m getting all these errors on IAM. However, if I go across to EC2, we should have permissions to launch an EC2 instance. So if I go down to launch instance, and go through the process, we can see that it’s allowing us to go through. Now, on this page, you’ll notice that there’s an error here as well; it says I do not have permissions to list instance profiles, and this is because this element here is related to IAM and I don’t have access to IAM with the CrossAccountDem role - I only have access to EC2.</p>
<p>So I’m not allowed to select any IAM roles for this EC2 instance. However, I can continue to go through and accept all the defaults and launch an instance. And as you can see, that instance has now been launched. So I’ve got access as per the permissions of the role. And remember, this instance is actually running in the trusting account because that’s the role that I assumed.</p>
<p>So if I logged back into the other account now, we should see this same instance running. And let’s just give this a name: Cross Account Instance. So if I go back to my original account which is CloudAcademy, we’ll see that this EC2 instance isn’t running because it’s in the wrong account. So let’s take a look. And now I’ve come out of assuming that role, we can see that in the trusted account there isn’t actually any EC2 instances launched because it was in the trusting account. So let me now log back into the trusting account and we should see that EC2 instance that we launched when we assumed the role. So let me flip over to that now. So I’m now back in the trusting account and here we can see that the instance is here that we created when was in the other account and assumed the role. So that’s how you create and configure cross-account access.</p>
<h1 id="An-Overview-of-AWS-WAF"><a href="#An-Overview-of-AWS-WAF" class="headerlink" title="An Overview of AWS WAF"></a>An Overview of AWS WAF</h1><p>Hello, and welcome to this lecture where I shall give an introduction to the AWS WAF service. If you are delivering any kind of web content, either through CloudFront Distributions, Amazon API Gateway REST APIs, Application Load Balancers, or via AWS AppSync GraphQL APIs, then I would recommend you implement the AWS Web Application Firewall service as an additional layer of security.</p>
<p>Without using a web application firewall you could be exposing your websites and web apps to potentially harmful and malicious traffic, which could lead to security risks within your environment. This could have a significant detrimental impact on your business from both a financial and reputation perspective. The AWS Web Application Firewall is a service that helps to prevent websites or web applications from being maliciously attacked by common web attack patterns. Many of which are outlined in the OWASP top 10 list, such as SQL injection and cross-site scripting.</p>
<p>In addition to your own custom criteria, such as perhaps filtering request based on source IP address or country of origin. OWASP, the Open Web Application Security Project is a not-for-profit organization that is dedicated to helping others improve security and software. They provide a top 10 list of the most critical security vulnerabilities and risks surrounding application architecture. For the <a target="_blank" rel="noopener" href="https://owasp.org/www-project-top-ten/">latest OWASP top 10 list</a>, please visit the following <a target="_blank" rel="noopener" href="https://owasp.org/www-project-top-ten/">link</a>.</p>
<p>If you can implement a WAF within your architecture to mitigate against some of these vulnerabilities, then that’s a huge asset to your web application architecture and a great relief to the security officers within your organization. If you then compare the implementation and administration time needed to deploy AWS WAF to a standard WAF solution, then it’s by far quicker. Further, AWS WAF is far simpler and easy to manage as well. And there are currently two versions of AWS WAF. AWS WAF classic, and AWS WAF, sometimes referred to as new AWS WAF.</p>
<p>Now you should only use AWS WAF classic if you created AWS WAF resources prior to November, 2019. So in this course, I shall be focusing on new AWS WAF. The AWS WAF service interacts with Amazon API Gateway, Amazon CloudFront for its distributions, Application Load Balances, and AWS AppSync, ensuring only filtered web requests that meet specific conditions are forwarded to be processed by these services. WAF works with these other services to filter both HTTP and HTTPS requests by distinguishing between legitimate and harmful inbound requests that will then either be allowed or blocked.</p>
<p>Let’s take a closer look at what the WAF service is composed of to allow you to understand how it works. So there are a number of essential components relating to WAF. These being Web ACLs, Rules and Rule Groups. Let me explain each of these individually to see what part they play within the service, starting with the main building block of the configuration, the Web ACL. So Web Access Control lists, or web ACL, are the main building block of the WAF service. And it’s used as the component that is associated with one of the supported resources to determine which web requests are considered safe and which ones are not.</p>
<p>At the time of writing this course, the supported resources include Amazon CloudFront Distributions, Amazon API Gateway REST APIs, Application Load Balances, and AWS AppSync GraphQL APIs. The Web ACL contains rules, which contains specific controls and criteria checks that assess each web request to determine whether it should be allowed or blocked. Also for each Web ACL, there is a default action that traffic should take if the criteria set out in the rules are not met by the incoming request, and the options for this are either allow or block.</p>
<p>Rules. Each rule contains statements and actions, which focus on specific criteria that the web request will be inspected against. If the inspected request matches the criteria set out in the statement, then that is considered a match. The result of this match can then follow an action of allow, block, or count. Allow means the request is forwarded onto the resource. Block means the request is dropped and a response is sent back to the requester, informing them that the request was denied, and count simply counts the number of matching requests.</p>
<p>Rule Groups. A Rule Group is essentially a collection of rules that you can apply to different Web ACLs as you need to. AWS WAF also comes pre-configured with a number of AWS manageable groups that have been built and designed to protect your resources against some common attack patterns. In addition to this, you can also get access to other Rule Groups created and sold by other vendors on the AWS marketplace. So from a logical architecture perspective, let’s assume that WAF has been associated with a CloudFront Distribution with its origin pointing to S3. The network diagram would look as follows at a high level.</p>
<p>So firstly, a user would initiate a request to the web content being served by the CloudFront Distribution. Next, although logically AWS WAF sits in front of CloudFront, the request will be received by the CloudFront Distribution first. Then it’s immediately forwarded to your associated WAF Web ACL. The AWS WAF Web ACL associated with the distribution would filter the incoming web traffic using the Rules or Rule Groups. So before it’s even traversed your CloudFront environment and network, you have the ability to detect, analyze, and either allow or block the incoming request.</p>
<p>If the criteria highlighted by the Rules deemed that the request should be blocked, then the traffic would be stopped and prevented from progressing further. The requester would then be informed the request was denied. If the traffic met the criteria, allowing the traffic to pass, then the request would be forwarded to CloudFront. CloudFront would then serve the content as required. You might already have other security detection mechanisms within your organization that operate deeper within your infrastructure, perhaps at the web server layer, to mitigate against some of the same risks that WAF does.</p>
<p>And so you may be thinking, why should I implement WAF if I have this existing solution, which is working okay? If you have existing detection systems within your infrastructure, then that’s great. However, the closer they are logically implemented to your web application, then the greater the risk of additional vulnerabilities occurring towards the edge of your infrastructure. It’s best to mitigate vulnerability risks as close to the perimeter of your network environment as possible. By doing so, reduces the chances of other infrastructure and systems being compromised.</p>
<h1 id="Understanding-Rules-and-Rule-Groups"><a href="#Understanding-Rules-and-Rule-Groups" class="headerlink" title="Understanding Rules and Rule Groups"></a>Understanding Rules and Rule Groups</h1><p>In this lecture, I shall be discussing rules and rule groups within your AWS WAF web ACLs. These rules are used to define inspection criteria that will determine if the web traffic will be allowed or blocked. As a result, they play a fundamental role in making sure your web ACLs are secure and effective. So it’s important that you understand them in detail. When you come to build your web ACLs and you have defined the resource that you want it to be associated with, you’ll be asked to add a rule or rule group to the web ACL.</p>
<p>As you can see in this screenshot, there were two options. Add manageable groups and add my own rules and rule groups. Let me take a look at each of these in more detail, starting with managed rule groups. So manage role groups are essentially a set of predefined rules that have already been created by AWS and other AWS marketplace sellers for you to use.</p>
<p>At the time of writing this course, I have the following manageable group vendors that appear in the AWS Managed Console. AWS, Cyber Security Cloud, f5, FORTINET, GEOGUARD, imperva and ThreatSTOP. This list will be constantly changing with new vendors. So please review the available manageable groups as and when you need to apply them.</p>
<p>These screenshots here show you a couple of examples from FORTINET and GEOGUARD. As you can see, they provide a set of defined rules that are already configured to monitor and detect anomalies in your web requests against specific vulnerabilities. The example from FORTINET allows you to use a rule group to protect against the OWASP Top 10 vulnerabilities. Whereas the GEOGUARD rule groups contain criteria to help you detect IP fraud using geolocation.</p>
<p>Now, the benefit of using these rule groups is that they have been tried and tested and have been designed to help protect against a specific type of vulnerability or risk. And this can save you a lot of time and effort in trying to recreate the same with your own rules. You may also notice that each rule group also contains a description of the rule group, in addition to the link to subscribe to the rule group, which contains the pricing, reviews and more detailed information.</p>
<p>You may also notice that there is a capacity rating. For FORTINET, the rating is 1,000 and for GEOGUARD, the capacity rating is 100, but what does this mean? Well, for each web ACL, there is a limit of 1,500 capacity units known as WCUs. And these can be used by rules and rule groups. These WCUs are used to control the amount of operating resources that are needed by AWS WAF to run your rules and the inspection criteria set out by those rules.</p>
<p>Now, depending on the rule and its complexity of statements, it will directly relate to and determine how many WCUs will be consumed by that particular rule. So effectively the more intricate the rule is from an inspection perspective, the more WCUs will be consumed. When creating a rule group, you must stipulate an immutable capacity at the time of its creation. This will then set the maximum WCUs that the rules within the group can reach. This is because when you alter the rules within a rule group, it ensures that it doesn’t exceed the maximum WCUs of 1500, set out within any web ACLs that are sharing that rule group.</p>
<p>Consider the following scenario. There are two web ACLs, each with a WCU limit of 1500, both sharing a manageable group. Let’s call this rule group one. Our web ACLs are configured as shown. If the rule groups did not have an immutable limit and rule group one had its rules changed, which meant the WCU rating changes from 1,000 to 1200 due to additional complexity, then web ACL1 would continue to operate as the total would be 1300 WCUs. However, web ACL2 would fail as the total would change to 1600 WCUs, which exceeds the maximum limit of 1500 for the web ACL. Therefore by ensuring that rule groups have an immutable WCU unit limit set, it would prevent your web ACLs from failing if the rules within the rule group were modified. Any changes to the rule group would have to ensure that the combined rule WCU remained at or below the immutable limit set.</p>
<p>Okay, so now we know what a manageable group is and the benefits that they bring, but let’s now go back to looking at creating our own rules and our own rule groups. So custom rules. Let’s assume we didn’t choose to use manageable groups and instead we wanted to add our own rules. The first thing I need to select is a rule type. So I need to select either IP set, rule builder, or rule group.</p>
<p>The IP set. By selecting IP set, it allows you to configure the rule criteria based upon either the source IP address or the IP address in header. However, before you can select an IP set, you must first create it from outside of the web ACL. To do this, you must select IP sets from the AWS WAF dashboard. From here, you can create an IP set by providing an IP set name, an optional description, a region in which the IP set should exist, or you can split the Global CloudFront Region, the IP version of addresses to be added to the IP set, which can be IPv4 or IPv6, the IP addresses to be attached to the IP set list, And you must add these addresses in a sider format with each entry on a different line. And this allows you to add individual IP addresses or a network range. For example, if using IPv4, then you could add 17.6.7.8&#x2F;32 to identify a single host address, or something like 107.11.0.0&#x2F;16 to identify a network range.</p>
<p>Once you have created an IP set, it can then be added within your web ACLs. So jumping back to configuring IP sets in your web ACL. After giving your rule name and selecting your IP set from the dropdown menu, you need to decide if you want to use the source IP address or the IP address in header from the request in your rule. If you decide to configure the IP set on source IP address, then all that remains for you to define is if you want the action of the web ACL that matches the IP source to allow, block or count the request.</p>
<p>When a request is allowed, it is forwarded onto the relevant associated resource, for example, a CloudFront distribution. When a request is blocked, the request is terminated there and no for the processing of that request is taken. A count action will do exactly that. It will count the number of requests that meet the conditions within that rule. So this is a good option to select when testing your rules to ensure that the rule is picking up the requests as expected before setting it to either allow or block.</p>
<p>If an incoming request does not meet any rule within that web ACL, then the request takes the action associated with the default option specified, which can either be, allow or block. If you select the option of the IP address to be based upon the IP address in header, then you must also specify the header field name and how you want to treat missing IP addresses in the header. And then finally, the action required for a match of the rule. Whichever option you choose, source IP address, or IP address in header, then you can enable a custom response to be sent to the requester if the action of block is used. The rule builder.</p>
<p>Let’s now take a look at the rule builder option. Here you can create your rules using the rule visual editor, allowing you to create your rule from a series of dropdown menus and options, or you can create your rule statements using the rule JSON builder. If you are experienced with WAF and JSON and are looking to create more complex nested statements within your rule, then the JSON editor is probably the easiest way to do this. By nesting statements, you can implement logic within your rules that allow you to use arguments such as, and, or, and not between the nested statements within your rule.</p>
<p>Okay, let’s turn back to the rule visual editor for those who are less familiar with JSON. When building a rule, you first need to give it a name. Next, you need to define the rule type, which can either be regular or rate-based. The only difference between rate-based rules and regular rules is that rate-based rules count the number of requests that are being received based on the source IP address, or the IP address in the header over a time period of five minutes.</p>
<p>When you select a rate-based rule option, and as you can see from the image, you are asked to enter the maximum number of requests from a single IP within a five minute timeframe. When the count limit is reached, the action of the rule is triggered until the request rate falls back below the rate limit specified. This can be used as a temporary block of request from a specific source if they are sending an excessive amount of requests within a short period of time.</p>
<p>It’s worth pointing out that the only actions allowed on rate-based rules are either block or count. If you’re not looking to monitor the amount of requests from a single source, then simply select a regular rule type. Regular rules are effectively if&#x2F;then statements. So as you can see, if you need to define a value from the dropdown menu of if a request, then your options, are matches the statement, matches all the statements, matches at least one of the statements, or doesn’t match the statement. And these options allow you to implement and build and, or and not statements within your rules.</p>
<p>Depending on the option from this menu will dictate the rest of the options you have within your statement. For example, if you select the matches all the statement, then you will be able to add additional statements to build your rule with a logical and between each statement. When you have finished creating your rule using a single statement or using the logical arguments, then you must define the then part of the rule, which as you are probably familiar with now, are allow, block or count. So here we are allowed to specify an allow action, whereas when we use the rate-based rule, the allow action was not an option. Once your rule has been created, you can see the amount of WCUs that has been assigned to your statement.</p>
<p>Okay, so now we have looked at IP sets, the rule builder. So the last point to look at is adding a rule group to the web ACL. So rule groups. Your rule groups need to be built outside of your web ACL creation. You can’t build them on the fly like you can with adding new rules. They are created from the main dashboard menu in your WAF management console. So from here, you can then create your rule groups and each rule group you create can exist in a particular region or the Global CloudFront Region. So bare this in mind when creating your rule groups, that you set the correct location dependent on your use case.</p>
<p>When creating your rule group, you will need to give it a name in addition to a CloudWatch metric name. Now this metric will be created within CloudWatch and allow you to monitor activity relating to the rule group that you’ve created. It’s helpful from a management perspective to keep your CloudWatch metric name the same name as the rule group. You can then create and add your rules as you normally would, and as I previous explained in this lecture, based upon the rule that you create within your rule group, you will be told how many WC Units the rule group currently has.</p>
<p>However, you must also consider future plans for the rule group if you anticipate that you’ll add more rules to it going forward. So as a result, you must specify the maximum capacity WCUs for the rule group, as once this option is set, it can’t be changed. Once your rule group has been created, this can then be selected from within your web ACL during it’s configuration. So rule priority.</p>
<p>I now want to talk to you about rule priority, and this comes up when creating rules within your web ACL and also, when creating your rule groups. During both of their configurations, the web ACL or rule group, you’ll be asked to verify the rule priorities of the rules that have been added. And this is an important point as rules are executed in the order that they are listed. So be careful to architect this order correctly for your rule base. Typically, these are ordered as shown.</p>
<p>Firstly, your Whitelisted IPs are allowed, you then have your Blacklisted IPs, which are blocked, and then any Bag signatures, which are also blocked. So Whitelisted IP addresses are a list of IP addresses that are allowed to access the resource. If you’re finding that a known customer is getting blocked within your rule base that shouldn’t be, then you could simply add their IP address to the Whitelist and they would then gain access.</p>
<p>Blacklisted IP addresses are a list of IP addresses that are explicity blocked for known reasons and Bad signatures would be rules that relate to attack patterns, such as SQL Injections and Cross-Site Scripting vulnerabilities. When an incoming request comes into WAF, it will be matched against the associated rule groups and rules within the web ACL in the order they appear. As soon as the request matches all of your criteria within a rule, the associated action will be carried out for that rule, regardless if there is another rule further down that would also be a match.</p>
<h1 id="Creating-a-Web-ACL-Demo"><a href="#Creating-a-Web-ACL-Demo" class="headerlink" title="Creating a Web ACL Demo"></a>Creating a Web ACL Demo</h1><p>In this lecture, I want to provide a demonstration showing you how to create the following: an IP set, a rule group and its associated rules, and a web ACL that is associated with a CloudFront distribution. Okay, so I’m in my AWS console and we can find AWS WAF under the Security and Identity and Compliance category here.</p>
<p>So once we get to the WAF dashboard, what I want to do first is to create an IP set, and we can see the IP sets on the left here. So I’m going to create an IP set, and I’m also going to create a rule group. And then I’m going to create my web ACL using the IP set that I’m going to create now within a rule. And then I’m gonna add that rule into the rule groups, and then attach that to the web ACL to a CloudFront distribution. So if we select IP Sets, we can see here that we have no IP sets found. So I haven’t got any created at the moment.</p>
<p>What I need to do is click on Create IP set. And I can give my IP set a name. So I’m just gonna call this MyIPSet. Add an optional description, and also the region in which you want to create this IP set in. I’m just gonna put it in the global CloudFront region, because that’s what I’m going to be associating the web ACL to. Now you can select here IPv4, IPv6. And this is where you enter your IP addresses that you want to be a part of your IP set. So I’m just going to copy in a couple of IP addresses I’ve got here.</p>
<p>So the first one I’ve copied here is a single IP address, and we know that because it has a mask of 32. So that’s just a single IP. But you can also add network ranges as well. So for example, this one underneath is a network range with a subnet mask of &#x2F;24. And for each IP address or network address that you want to add in, you have to add it on a separate line. So once you’ve created your IP set, simply click on Create IP set. Okay, that’s now created in the global CloudFront region. So if we change the location there, we’ll be able to see the IP set in the list. So there it is, MyIPSet.</p>
<p>Now what I want to do is to create a rule group. So if I go across the rule groups, and we can see here that there are currently no rule groups found. So if I click on Create rule group, give this rule group a name. I’m gonna call this MyRuleGroup. Again, an optional description. And it also adds its own CloudWatch metric name as well, which matches the name of the rule group. The region, I’m going to keep it in the global CloudFront region. Click on Next. And this is where we can start adding our rules to the rule group.</p>
<p>So let me add my first rule. So let me call this MyFirstRule. And we have our different types of rules, the regular rule or the rate-based rule. I’m gonna stick with the regular rule. So let’s start building the rule. So if a request matches a statement, or we can have an and statement here, where it matches all the statements, or an or statement, or a not. Let’s go for an or. So for the first statement, I’m going to say if a request originates from a country in the United States or the United Kingdom, you can see this added them in here, using the source IP address to determine the country of origin, or, and this is where the second statement comes in, we can inspect the originating IP address, and this is where we can select our IP set that we created just now.</p>
<p>Again, using the source IP address as the originating address. Then as an action, I want to block that. So let’s take a look at this rule. So we have a regular rule where if a request matches at least one of the statements, so either that the source IP address originates from the UK or the US or the IP address matches one of those in the IP set that we created, then block the traffic. So let’s add that rule. Okay, so we can see it there, MyFirstRule.</p>
<p>Let’s add another rule. Let’s call this MySecondRule. Again, I’m gonna add a regular rule. This time if a request matches the statement, so I’m not gonna use an and or or. And for the inspection type, I’m going to say HTTP method. And match type, if it contains a SQL injection attack. So if the request matches a SQL injection attack, then I also want to block that traffic. So Add rule. So now I have two rules here, NyFirstRule and MySecondRule.</p>
<p>The first rule relates to the country of origin and my IP set, and the second rule relates to any SQL injection attacks. And we can see here that the capacity has been identified as two for the first rule and 20 for the second rule. So the minimum required capacity is 22, but I can enter the maximum capacity up to 1500 for this rule group. So if you envisage you’re going to add more rules to this at a later stage, then you should increase this capacity. So I’m just gonna change that to 500. And this would give me plenty of allowance to add additional rules or modify the rules that might increase the capacity limit of this rule group.</p>
<p>Click on Next. And here you can change the rule priority. So you can move it up or down depending on how many rules you have. I’m just gonna leave it as what we had. Click on Next. And then here is a quick review of our rule group. So we have the rule group name, and we also have the rules that we created and the actions. So Create rule group. And there we have it. We can see MyRuleGroup. So now we’ve created the IP set. We’ve created a rule group, which contains two rules, and one of those rules contains the IP set that we created.</p>
<p>Now we need to attach this rule group to a web ACL. So if we go across to Web ACLs, again, we don’t have any created at the moment, say Create web ICL. Give this a name. I’m gonna call it MyWebACL, add an optional description. Again, CloudWatch will create an automatic metric for this web ACL. And then we can select our resource type if we want it associated with the CloudFront distribution or an application load balancer, APIGateway, or AppSync, et cetera. But I’m gonna associate this to a CloudFront distribution in the global CloudFront region.</p>
<p>So down here, where it says Associated AWS resources, I’m gonna add a resource. I’m gonna select my CloudFront distribution. So this web ACL will now be associated with this CloudFront distribution. Click on Next. Now here we can add any rules, so we can just add a rule from here, or we can add managed rule groups or add my own rules and rule groups. So as we created our rule group earlier, I want to add that in here. So if we go across to Rule group. We’ll give this rule a name within the web ACL, MyRules, select the rule group, and we have the MyRuleGroup option that we had here, and then click on Add rule.</p>
<p>So we’ve just added a rule within this web ACL, which is associated to the rule group. Now here we can see it’s picked up the maximum capacity of that rule group of 500. So it will take up 500 WCUs of the maximum 1500 allowed for the web ACL. Even though it’s only using 22, it will take the maximum. So just be aware of that when creating your rule groups. And then we also have a default web ACL action for requests that don’t match any rules.</p>
<p>So in this demonstration, I’m just going to allow everything through that isn’t picked up by any of my rules. So effectively what I’m saying there is, is that if any traffic comes from any other country other than the UK or the US, or sits outside of the IP address ranges that I specified in my IP set, and isn’t a SQL injection attack, then I’m happy for that traffic to come through. Click on Next. Again, we can set the rule priority. </p>
<p>Click on Next. You can change the CloudWatch metric name of the rule that you just added if you want to. And you also have the option of running some sample options here as well on your web ACL. I’m just going to leave it as default. Click on Next. And this is where we can review the details from the web ACL that we’ve just created. So it shows the name, the scope, which is CloudFront, the region, and the CloudWatch metrics, the WCU capacity of your rules in your web ACL, and the default action as well.</p>
<p>So once you are happy with everything, just click on Create web ACL. And there we have it. So that’s a very quick demonstration on how to create an IP set, how to create a rule within a rule group, using the IP sets as well. And then also how to create a web ACL associated to a CloudFront distribution using your own rule groups.</p>
<h1 id="AWS-Firewall-Manager-and-Prerequisites"><a href="#AWS-Firewall-Manager-and-Prerequisites" class="headerlink" title="AWS Firewall Manager and Prerequisites"></a>AWS Firewall Manager and Prerequisites</h1><p>Hello, and welcome to this lecture, where I should provide an overview of AWS Firewall Manager, so, you can understand what the service is used for. The core function of AWS Firewall Manager is to help you simplify the management of being able to provide security protection to a range of different resources, between multiple AWS accounts. It’s the fact that it works across multiple account infrastructure, that gives this service a lot of power from a security perspective. So, it’s a great tool to become familiar with, if you are responsible for security across more than one AWS account.</p>
<p>Once your configured security policies to govern the protections that you require for your resources, AWS Firewall Manager, will then automatically apply this protection in addition to managing this protection for any newly creative resources, that match your configuration across any of your accounts that it has responsibility for. So, once it’s set up, the management and protection efforts are simplified dramatically, across your entire organization.</p>
<p>The current AWS services and resources that Firewall Manager provides protection for and integrate with, include the following; <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/protecting-web-apps-aws-waf-shield-firewall-manager/introduction/">AWS WAF, AWS Shield Advanced, AWS Network Firewall</a>, VPC Security Groups and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-dns-content-delivery-aws/amazon-route-53/">Amazon Route 53</a> Resolver DNS Firewall. In addition to these resources that are protected, Firewall Manager is also closely integrated with AWS Organizations. In fact, running AWS Organizations is a prerequisite of using Firewall Manager. For those I’m familiar with AWS Organizations, it’s a service which provides a means of centrally managing and categorizing multiple AWS accounts that you own, bringing them together into a single organization.</p>
<p>Let’s look at the prerequisites of Firewall Manager in a little more detail, to allow you to begin using the service. So, the first step is to decide which AWS account will be used as your Firewall Manager Administrator account. And this account will be used to essentially manage your security policies. Next, you must ensure that this account is a part of an AWS Organization. However, the that it joins must be configured with all features enabled, and not just consolidated billing.</p>
<p>When your account has successfully joined an AWS Organization, you must then configure AWS Firewall Manager within that account, as the Firewall Manager Administrator Account. And this administrator account is used to create a manager security policies. To delegate your account as the administrator, open the Firewall Manager Console, select, get started and enter the account number of your AWS account. Once you’ve added your AWS account to an AWS Organization and designated the Firewall Manager administrative account, you’ll see confirmation ticked on the Firewall Manager dashboard as seen to reflect that you have met these prerequisites.</p>
<p>Next, you must enable AWS config for your account, and for any other account in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/securing-aws-organizations-with-service-control-policies-scps/introduction/">AWS Organization</a> that you want to manage resource security for. And it must be enabled for each region in that account, in which the resources reside. If you don’t want to enable AWS conflict for all resources in each of your accounts, then you must ensure that you enable the following depending on which resources you want Firewall Manager to secure. The next step is optional, depending on if you are looking to apply security policies for all Network Firewalls and DNS Firewalls.</p>
<p>Then you must enable sharing with AWS Organizations in AWS Resource Access Manager. By doing so, it allows you to deploy security policies to these resource types, using Firewall Manager across your accounts in your organization. To complete this configuration, you must open the settings page in the AWS Resource Access Manager Console, and then from here, select, enable sharing with AWS Organizations, and then select, safe settings.</p>
<p>The final step allows Firewall Manager to manage resources in regions, that might be disabled by default. So, you must enable these regions before you can create and managed resources within them. These regions must being enabled in the AWS management account, for your AWS Organization, in addition to the AWS account designated as your Firewall Administrator account. Enabling a region is a simple process. From within the AWS Management Console, navigate to the top right corner and select your account, and then select my account, scroll down to regions section and select, enable in the action column, for the regions that you would like to enable. Once you’ve completed these initial steps you are ready to begin configuring AWS Firewall Manager and its policies.</p>
<h1 id="Policies"><a href="#Policies" class="headerlink" title="Policies"></a>Policies</h1><p>In this lecture I want to dive into the configuration of AWS Firewall Manager so you can see how to create policies that are used to manage and secure your resources across multiple accounts. Before we look at some of this configurations in detail, let me talk a little more about these policies. For each type of resource that you want to protect, there is a different policy, each with a slightly different configuration. Also, note that you can create more than one policy for the same resource type which might be useful depending on your use case.</p>
<p>At the time of writing this course, Firewall Manager allows you to create policies protecting the following resources. An AWS WAF Policy, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/protecting-web-apps-common-exploits-using-aws-waf-1883/an-overview-of-aws-waf/">AWS WAF</a> is a service that helps to prevent websites or web applications from being maliciously attacked by common web attack patterns, and it uses Web ACL’s as the main building block of the service to determine which web requests are considered safe and which ones are not. So by using this WAF policy you can create a set of Firewall Manager Rule Groups to run at the beginning and the end of your Web ACLs that you have configured.</p>
<p>The rules or rule groups that run in between these two can be configured as required from within WAF itself. Shield Advanced Policy, the AWS Shield services is designed to help protect your infrastructure against distributed denial of service attacks, commonly known as DDoS. This policy allows you to apply Shield advanced protection across your accounts and resources. Network Firewall Policy, AWS Network Firewalls allow you to protect your VPCs from common network threats by implementing fine-grained firewall rules enabling you to control which traffic is permitted and which should be blocked. Using this policy allows you to manage these firewall rules across your VPCs running in multiple AWS accounts.</p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-vpc-networking/vpc-what-vpc/">Amazon VPC</a> Security Group Policy, security groups are used to control traffic at the instance level based upon port and protocol types. By using this policy, it allows you to manage all of your security groups across your entire AWS organization, giving you centralized control. An Amazon Route 53 Resolver DNS Firewall Policy. This resolver DNS Firewall is a managed firewall that allows you to block DNS queries made against known malicious domains, in addition to allowing queries for your trusted domains. As a result, this Policy enables you to control these Route 53 resolver DNS Firewall protections across all the VPCs in your AWS organization.</p>
<p>So now we have more of an understanding on what each of the policies are being used for, let’s examine some of them in a bit more detail as to their configuration. The creation of each policy type is generally a five step process, apart from the Network Firewall Policy which contains an extra step.</p>
<p>So step one, you must choose your policy and region. In this step you must select which policy you’d like in addition to the region. Step two, describe Policy. So here you need to define the details of the policy, which is dependent on which policy you selected. Step three, define the policy scope. So this step defines which resources and accounts are covered by the policy that you’re creating. Step four, configure policy tags. This is an optional step allowing you to associate a resource tag to the policy. Step five, review and create policy. So this is the final step allowing you to review the configuration you made in the previous four steps before creating the policy. However, do bear in mind that generally the costs of Firewall Manager policies are charged at $100 per policy for each region. For the latest information on Firewall Manager pricing, please see the AWS documentation here to avoid any unexpected costs.</p>
<p>Also, another point when it comes to charges for Firewall Manager policies is that, for each policy you create it will also create <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-to-aws-config/what-is-aws-config/">AWS Config</a> rules, and in turn these rules will also incur additional charges. For more information on AWS Config pricing, please see the following URL. Okay, so let’s quickly review a couple of these policies to see how they differ, starting with the AWS WAF Policy. So to create a policy from within the AWS Management Console you need to select “Security policies” from the AWS Firewall Manager dashboard and then choose “Create Policy”.</p>
<p>So step one, this is where you choose policy and region. From here you must select which policy you’d like in addition to the region. For this walkthrough, I’m going to select AWS WAF and the Global region. When you have selected the options you require, click next. So step two, describe the policy. In this step we need to define the policy name, policy rules and policy action. But firstly we need to name our policy something appropriate for the use case.</p>
<p>Next we need to configure the Rule Groups of the Web ACL that will be associated with all resources defined in the policy scope. So effectively, at this stage, the Web ACL that you create in this policy will contain a list of Rule groups that will appear at the beginning, in addition to a list of Rule groups that will appear at the end. This Web ACL will then be replicated to all accounts and resources in scope. And the administrator of each of those accounts can then add their own rules and rule groups between the start and end rule groups already defined by this policy. Also as a part of configuring the policy rules, we must select the default action of the Web ACL, either Allow or Block, and if we want to enable the capture of logging information to Kinesis Firehose.</p>
<p>Lastly, we need to indicate a policy action. So we can either use the policy to detect resources that don’t comply with the policy rules without any remediation, or use the policy to automatically remediate any noncompliant resources. Step three, define the policy scope. As we move into the 3rd step, we are able to drill down into the scope, defining which resources and accounts are covered by the policy. At the account level we can apply the policy to all accounts in the AWS organization. We can include selected accounts and organization units or we can exclude selected accounts and organization units, including all others.</p>
<p>From a resource perspective, in the WAF policy you can select a CloudFront Distribution as the resource and you can choose if you want the policy to include all resources that match the resource type, and in this instance that will be CloudFront Distributions. Include only resources that have a specific tag assigned to them. Or exclude resources that have a specific tag, and include all others. Additionally when defining the policy scope, we can choose if we want Firewall Manager to clean up resources by removing protections from resources if they leave the scope of the policy.</p>
<p>For example, you might have selected to include resources that have a resource tag of TeamA, if that resource then had it’s tag changed from TeamA to TeamB, then Firewall Manager could remove the protection offered on that resource automatically as it no longer aligned with the required resource tags. Step four, configure policy tags. This step simply allows you to assign a resource tag to the policy itself using a key value pair and this is an optional step. And then step five, review and create policy.</p>
<p>This final step allows you to review all of your options from steps one to four, before confirming you want to create the policy. However, do bear in mind the associated cost before creating your policy, which I will reiterate are generally charged at $100 per policy for each region. Now before we look at the other policies, step one, step four and step five are generally all the same for every policy. So for the remaining policies, I shall just be looking at step two and three.</p>
<p>So let’s jump straight to step two for the AWS Shield advanced policy, which allows you to manage Distributed Denial of Service, DDoS protections for your applications. So step two for describing the policy. When compared to the AWS WAF policy that we just looked at, there aren’t really many options here for AWS Shield. All we need to do here is to give the policy a name and then define a policy action. Either use the policy to detect resources that don’t comply with the policy rules without any remediation, or use the policy to automatically remediate any noncompliant resources.</p>
<p>And then step three, defining the policy scope. This step is exactly the same as what we covered previously when we looked at AWS WAF. We configure which accounts and resources that this policy applies to by selecting the appropriate options. Again, this relates to CloudFront distributions as Firewall Manager doesn’t currently support Amazon Route 53 or the AWS Global Accelerator. So if you want to protect either of resources with this service, then you will need to manage this directly from within AWS Shield.</p>
<p>Okay, let’s take a look at one more policy before we move on, so the next policy I want to show is the Security Group Policy. Now interestingly, this option has an additional step of configuration options during step one. In addition to selecting the policy detail of Security Group and the Region, you will also be asked to specify the Security Group Policy Type. As you can see, there are three options for this. Common security groups, auditing and enforcement of security group rules. And auditing and clean up unused and redundant security groups.</p>
<p>So your selection will depend on the use case in which you would like Firewall Manager to manage your security groups. If you want to add new security groups to your Organization, select common security groups. If you want to enforce specific rules in existing security groups, choose the 2nd option and lastly, if you want to remove redundant security groups then select the last option. So let’s look at the configuration of adding new Security Groups to your organization. So with that in mind, let’s move onto step two.</p>
<p>Now in this step there are three elements we need to configure. Policy name, policy rules and policy action. As with any policy, we need to issue the policy with a relevant name. When it comes to configuring the Policy Rules, you will need to ensure that you have already created a security group within your VPC. Once you have created the security group that you want to apply across your organization, you can then add it to the policy rule. In this example, you can see that I have created a security group called, MyFirewallSG, which I have now added to this policy.</p>
<p>Finally, select your option for the Policy Action. Again, this is where we can define the scope of which accounts and resources this policy is associated. The main difference on this screen from previous policies we’ve looked at is the Resource Type. Here you can specify which type of resource, whether that be an EC2 instance, an ENI, an ALB or a Classic load balancer, all of which can be associated with a security group. So again, it depends on what you are using your Security Groups for and for which resource you want to protect.</p>
<p>Also, at the bottom of this screen shot, you can also see that by enabling the checkbox, you can apply the policy to resources against shared VPCs too. So compared with the WAF and Shield policies, there is a wider variety of options when it comes to resource type, and its simply because security groups have the capability of being associated with a variety of different resources within your organization. So we’ve looked at some of the policies that Firewall Manager can create for you, allowing you to govern and manage access for a number of different resources across your organization.</p>
<p>It really helps if you have a working knowledge of these resources and services before you begin trying to create policies to offer protection for them. As we’ve seen, in some circumstances you need to have created certain resources and elements prior to creating a firewall manager policy. Once you have created the policies that you need, AWS Firewall Manager will deploy these within the accounts and against the scope of resources we have identified.</p>
<p>Any new resources that are created from this point will automatically fall under the protection of these same policies as long as they fit within the scope outlined of the policy. This automatic protection reduces the amount of administration required in configuring and setting up protection on an individual basis.</p>
<h1 id="What-is-AWS-Shield"><a href="#What-is-AWS-Shield" class="headerlink" title="What is AWS Shield?"></a>What is AWS Shield?</h1><p>Hello and welcome to this section of the course focusing on the third and final service, <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/amazon-web-services/">AWS</a> Shield. AWS Shield is closely related to both AWS WAF and also the AWS Firewall Manager. So what is it used for? Well, AWS Shield has been designed to help protect your infrastructure against distributed denial of service attacks, commonly known as DDoS. These attacks are very common, and the attack itself targets a host which might be running a website or web application, and it receives a huge number of requests simultaneously sent maliciously by an attacker from multiple distributed sources. This increase and flood of traffic aims to prevent legitimate requests getting through to host and being processed, while at the same time severely hindering the performance of the application or website. So much so in fact, that users often think the site is down. </p>
<p>There are a number of different types of DDoS takes that can take place, for example, a SYN Flood. In a Syn Flood attack, a large number of connections are made to the host under attack. The host will then respond accordingly with an SYN&#x2F;ACK packet, at which point the client sending the original connection request would normally respond with another SYN, completing the three-way handshake to allow communications to begin. However, this final SYN packet is not sent to the host, and this leaves a huge number of open connections on the host, resulting in diminished resources available to process legitimate requests. DNS Query Flood. By using multiple DNS queries an attacker can drain the resources against a DNS server, such as Route 53 in AWS. HTTP flood and cache-busting attacks. These attacks operate at layer seven, the application layer. And during an HTTP flood attack an attacker sends a large amount of HTTP requests, which may include POST and GET requests to a host, consuming the resources available. Cache-busting attacks are similar to HTTP floods, however, by using the HTTP request query string they are able to force content to be retrieved from the originating server, rather than from an edge location, which impacts the performance of the source servers available resources unnecessarily. AWS Shield itself is available at two different levels of features, AWS Shield Standard and AWS Shield Advanced, and AWS shield advanced has a lot more power and protection on offer than standard. AWS Shield Standard is free to everyone, well, at least anyone who has an AWS account, and it offers DDoS protection against some of the more common layer three, the network layer, and layer four, transport layer, DDoS attacks. This protection is integrated with both CloudFront and Route 53. </p>
<p>AWS Shield advanced offers a greater level of protection for DDoS attacks across a wider scope of AWS services for an additional cost. This advanced level offers protection against your web applications running on EC2, CloudFront, ELB and also Route 53. In addition to these additional resource types being protected, there are enhanced levels of DDoS protection offered compared to that of Standard. And you will also have access to a 24-by-seven specialized DDoS response team at AWS, known as DRT. With these additional features, the advanced level also provides an enhanced monitoring capability allowing you to view real-time metrics of any attacks against your resources. Whereas the Standard version of Shield offered protection against layer three and layer four, Advanced also offers protection against layer seven, application, attacks. Another great advantage is the fact that you also get cost protection as a part of the plan, whereby your resources may scale suddenly and unexpectedly to cope with the rise in traffic. From a cost perspective, if your decide to go with AWS Shield Advanced then you also get AWS WAF included in the same price, and this price is currently $3,000 a month, plus data transfer fees. As you can see from this image, there are a significant amount of advantages with the Advanced version of AWS Shield over Standard. That now brings me to the end of this lecture.</p>
<h1 id="Configuring-Shield"><a href="#Configuring-Shield" class="headerlink" title="Configuring Shield"></a>Configuring Shield</h1><p>Hello and welcome to this lecture where I want to cover how to configure and set up AWS Shield Advanced. There are a number of different steps involved if you want to make use of the benefits and features discussed in the previous lecture. Let’s take a look at them. Firstly, we need to activate AWS Shield advanced, which can be done via the Management Console using the WAF and Shield Service. When you go into the service, you are presented with the dashboard, you can simply select Summary from the AWS Shield menu on the left-hand side of the dashboard. This will then present you with a screen which we also saw in the previous lecture as shown. At the bottom of the screen, you can see in blue, a button that says Activate AWS Shield Advanced. It’s worth noting that AWS Shield is AWS account specific, so you will need to perform this step on each AWS account that you want to use it within. You must then accept a number of terms and conditions before you commit to activating the service. Once you have activated AWS Shield with your AWS account, you are then ready to define which resources you want to protect with the service. This is a manual process and is not done automatically. You may think Shield self-discovers resources, however, you need to manually select the resources needing protection. You can select the resources using ARNs providing the resource is within the same account, so simply select all supported resources from a dropdown list. If one of your resource is an EC2 instance, then you must first associate an EIP, an Elastic IP Address, to that instance for it to be protected as AWS Shield protects whatever resource is associated to that EIP. Once your resources are defined and selected, you must then add rate-based rules. Having these configured, it can be a primary indicator that a DDoS attack is in progress. </p>
<p>You may remember from a previous lecture in this course that a rate-based rule counts the number of requests that are being received from a particular IP address over a time period of five minutes. If there is a surge in requests from a particular IP address out of the ordinary, then these rate-based rules can alert you of this behavior. These rate-based rules are only associated with CloudFront distributions and application load balancers and so are not required or available for other resource types, such as EC2 instances. For each supported resource in the list, it is recommend you associate a Web ACL with a rate-based rule. If you have any resources already in the list being protected by a Web ACL, then you can’t change that Web ACL for that resource. If you want it, you must first remove it from the Web ACL within WAF before associating it to a new one. Following your rate-based rule configuration of your resources you then have the opportunity to pre-authorize the AWS DDoS Response team, the DRT, to have the ability to review, update and modify your Web ACLs and Shield configurations during an attack to help you resolve your issues quickly and effectively. If you are not happy to authorize the DRT team to access your resources, then you can select the option of Do not grant the DRT access to my account. If you decide you do want the assistance of the DRT team, you must be subscribed to either the business or enterprise support plans. The authorization process is governed by an IAM role where you can either create a new or select an existing role. </p>
<p>Creating a new role will set up all the relevant permissions automatically. If you wish to select an existing role, you must ensure that it has the AWSShieldDRTAccessPolicy managed policy attached and that you trust the service principal of drt.shield.amazonaws.com to use that role. If you need more information relating to IAM policies and permissions, please see our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/introduction-81/">here</a>. It’s also possible to allow the DRT team to access flow log information stored in an S3 bucket, you just need to supply the name of the bucket and the DRT team will be given permissions of GetBucketLocation, GetObject, and ListBucket to review the flow log information. Following this step, it’s recommended that you set up some CloudWatch alarms and use the SNS service to notify you about your resources. AWS Shield will configure the SNS topic for each region specified and it will also configure CloudWatch metrics to notify you of any potential DDoS activity. It’s also possible to configure a CloudWatch Dashboard of the data collected by Shield Advanced. To learn more about CloudWatch and Dashboards, please see our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-cloudwatch/introduction-39/">here</a>. Once this is done, then your configuration of AWS Shield Advanced is then complete. However, it’s also worth noting and viewing the Global Threat Environment Dashboard which can help provide an overview of the top attacks, and the number of attacks across the AWS landscape.</p>
<h1 id="AWS-Security-Hub-Features"><a href="#AWS-Security-Hub-Features" class="headerlink" title="AWS Security Hub Features"></a>AWS Security Hub Features</h1><p>AWS Security Hub allows you to start consolidating security findings and alerts across accounts and provider products and display results into a single dashboard. It gives you a way to centrally view and manage security alerts and automate security checks to quickly understand the situation and respond to security issues as they take place. AWS Security Hub integrates with multiple AWS services like Amazon GuardDuty, Amazon Inspector and Amazon Macie.</p>
<p>There are more services that integrate with Security Hub including third party products. The following services are able to send findings to Security Hub, and they are: AWS Firewall Manager, Amazon GuardDuty, Identity and Access Management Access Analyzer, Amazon Inspector, Amazon Macie, AWS Systems Manager Patch Manager, AWS Systems Manager Explorer and OpsCenter, and Amazon Detective.</p>
<p>The Amazon Detective integration allows you to switch back and forth from Security Hub to Detective and investigate a security finding. Security Hub is also able to integrate with security solutions by members of the AWS Partner Network. You will want to visit the integrations section in the Security Hub service documentation. As of this recording, there are over 60 integrations available for the Security Hub service from vendors like Symantec, Sumo Logic, Splunk, Atlassian, Slack, ServiceNow, RackSpace, Palo Alto Networks, PagerDuty, CloudStrike and many more. Security Hub runs continuous, account-level configuration and security checks based on AWS best practices and industry standards. It provides the result of these checks as a readiness score, and identifies specific accounts and resources that require attention. The result is reduced effort to collect, prioritize and remediate security findings.</p>
<h1 id="AWS-Security-Hub-Standards-Implemented"><a href="#AWS-Security-Hub-Standards-Implemented" class="headerlink" title="AWS Security Hub Standards Implemented"></a>AWS Security Hub Standards Implemented</h1><p>AWS Security Hub automatically implements three fundamental standards as defined by the Center for Internet Security, or CIS. CIS is helping make the connected world a safer place by publishing guidelines to safeguard public and private organizations against cyber threats. This includes benchmarks for AWS implementations. The reference URL for the Center for Internet Security is <a target="_blank" rel="noopener" href="http://www.cisecurity.org/">www.cisecurity.org</a> Once enabled, Security Hub begins to monitor CIS benchmarks in order to provide you visibility as to what you’re doing right and what needs remediation.</p>
<p>The first standard supported by Security Hub is called the AWS Foundational Security Best Practices Version 1.0. This is a standard defined and curated by AWS security experts and represents the most basic actions you need to take on a new account in order to make sure everything else you build is secure. Details as simple as enabling multifactor authentication for all account users, defining a robust password policy, the use of groups for applying permissions to users and making sure you never have publicly accessible Amazon S3 buckets will ensure a high score on this fundamental benchmark. We will discuss how to get a good score on this set of best practices in the next section.</p>
<p>The second standard supported by AWS Security Hub is the CIS AWS Foundations Benchmark Version 1.2. This is a set of best practices for AWS configuration in terms of security. It includes details related to monitoring and logging, which are essential to identify security issues. AWS Security Hub automatically checks for your compliance with these benchmarks once you enable it.</p>
<p>The third standard supported by Security Hub is the PCI DSS Version 3.2.1. This stands for Payment Card Industry Data Security Standards and it applies to the storing and processing of credit card information in your AWS implementation. AWS Security Hub is your central point of access to verify AWS security and take appropriate action when needed.</p>
<p>AWS Security is to be taken seriously and best practices need to be defined by your organization, implemented and reviewed regularly as the security landscape continues to evolve. The importance of security in your AWS infrastructure cannot be overstated. A fundamental error in your security implementation can potentially compromise and cost your business significant losses in time, effort, and money. Cloud security is complicated to implement. AWS Security Hub helps you manage the complexity of collecting and remediating security issues in your AWS infrastructure.</p>
<h1 id="AWS-Security-Hub-Operation"><a href="#AWS-Security-Hub-Operation" class="headerlink" title="AWS Security Hub Operation"></a>AWS Security Hub Operation</h1><p>In addition to best practices, the information generated by security services is significant in terms of volume and categories. Gathering security findings in a single place is difficult and the information requires close attention and analysis in order to guarantee a secure and compliant environment at all times. This is where AWS Security Hub becomes essential by providing a single point of access to your security implementation and automatically verifying you are applying best practices as defined by AWS security experts. Let’s discuss some of these foundational best practices for new AWS accounts. </p>
<p>Whether you’re just getting started or have some experience already with AWS, there’s no doubt you have to interact with the AWS Identity and Access Management service. This is the service to provision users, define access controls for those users including passwords and access keys. Identity and Access Management is one of the many security services provided by AWS in order to assist you in the provisioning of a secure and compliant implementation.</p>
<p>This diagram represents three best practices regarding AWS Identity and Access Management. As you can see, it seems a little complicated. Let’s break it down step by step into some of the foundational best practices that Security Hub verifies.</p>
<p>Number one, the Root User is the owner of AWS account, and it has access to everything including the credit card used to pay for services. As a best practice, always assign a multifactor authentication to the root user. That way, the root account is protected at all times. After that, create a group and apply administrator permissions to it. Then create a user, also assign an MFA to that user and provision keys if needed. Finally, add the user to the group, sign off the root account, and try never to use it again unless strictly necessary.</p>
<p>Your implementation will begin by leveraging the administrator user that you just created. Groups are an efficiency mechanism to apply permissions. It is easier to define a group, apply permissions, and then add or remove users as needed. You should rarely have to apply permissions to a user directly. If required, you can also provision keys to a user. Finally, also if required, you can allow the user to assume roles. For item number three, roles represent a way to gain permissions on a temporary basis.</p>
<p>The primary use of roles is to allow services to interact with each other. Users can also assume a role if needed. The permissions attributed to a role should be what is needed and nothing in addition to that. This is called the principle of least privilege, sometimes also called the principle of maximum security. Roles are commonly associated with EC2 instances and services. As a general security best practice, never store access keys in your code on EC2 instances or Amazon S3 buckets.</p>
<p>Fortunately for us, AWS offers a variety of tools for automating provisioning, monitoring, and auditing, many of them using machine learning in order to help us get our Cloud Security compliant with best practices. We just implemented some of the foundational security best practices checked by AWS Security Hub. We’re gonna see the results later on.</p>
<h1 id="AWS-Security-Hub-Integrations"><a href="#AWS-Security-Hub-Integrations" class="headerlink" title="AWS Security Hub Integrations"></a>AWS Security Hub Integrations</h1><p>With AWS Security Hub enabled, Amazon GuardDuty, Amazon Inspector and Amazon Macie findings are automatically sent to Security Hub as the single point of access and remediation for security issues. On the first item, we notice that Security Hub uses AWS Config rules to perform most of its security checks for controls. On the second item, we notice AWS Security Hub automatically runs continuous, account-level configuration and security checks based on AWS best practices and industry standards.</p>
<p>On the third item we note, AWS Security Hub supports integration with Amazon EventBridge to automatically send notifications and remediation details of security findings. You can use custom actions to send results to a ticketing system or to an automated remediation service.</p>
<p>Now in this next diagram, things are a little more advanced. It’s important to note that AWS Security Hub findings can display results from AWS services that include GuardDuty, Inspector, Macie, AWS Firewall, AWS Systems Manager Patch Manager and AWS Identity and Access Management Access Analyzer among many others. There’s a total of over a dozen services that AWS Security Hub is able to integrate into a single point of viewing for security findings. I have no doubt, the list will continue to grow as time goes by.</p>
<p>For now, it’s important, especially for beginners, to have a sense of the benefit delivered by the individual services that AWS Security Hub aggregates. Let’s briefly discuss the first three services that integrated with security hub. They are Amazon Inspector, Amazon GuardDuty and Amazon Macie. We’re going to keep things simple, so please don’t worry. We’ll discuss the main benefits and take a look at some sample findings from screens for each of them. We’ll return to our discussion of AWS Security Hub shortly after.</p>
<h1 id="Amazon-Inspector-Basic-Features"><a href="#Amazon-Inspector-Basic-Features" class="headerlink" title="Amazon Inspector Basic Features"></a>Amazon Inspector Basic Features</h1><p>You need to be responsible for the security of applications, processes, and tools that run on EC2 instances. Amazon Inspector lets you analyze your deployed EC2 instances and helps you identify potential security issues. Some of the basic features include a knowledge base with hundreds of rules that are mapped to common security compliance standards and vulnerability definitions. These rules are regularly updated by AWS security experts. You can install an agent in the operating system of an Amazon EC2 instance to monitor behavior like network, file system, and process activity.</p>
<p>You can also automate vulnerability assessments to make security testing of EC2 instances a regular part of your cloud operations. As a result, Amazon Inspector gives you a prioritized list of findings. A sample list of findings is shown. Amazon inspector is all about protecting the security of your EC2 instances.</p>
<h1 id="Amazon-Guard-Duty-Basic-Features"><a href="#Amazon-Guard-Duty-Basic-Features" class="headerlink" title="Amazon Guard Duty Basic Features"></a>Amazon Guard Duty Basic Features</h1><p>Amazon GuardDuty is an intelligent threat detection service that provides you with an accurate way to consistently monitor and protect your AWS accounts and workloads for suspicious activity. We’re talking about intelligent threat identification for your accounts, data, and workflows. It uses trained machine learning models to identify suspicious user and resource behaviors. It also learns from your environment to eliminate false positive identifications.</p>
<p>Amazon GuardDuty is able to analyze CloudTrail logs, VPC flow logs, and DNS query logs to identify issues worth looking into. An interesting item about GuardDuty is that sample findings help you analyze the type of results that GuardDuty delivers. When you generate sample findings, GuardDuty populates your current findings list with one sample finding of each type.</p>
<p>Don’t forget, GuardDuty is able to display its results to AWS Security Hub. Generating sample findings will allow you to verify AWS Security Hub’s functionality sooner more than later. Let’s take a look at some sample results from the GuardDuty screens. As a result, Amazon GuardDuty gives you a listing of findings classified under three categories, low, medium, and high severity.</p>
<p>In this screen of the AWS console, low severity findings are marked in blue with a small circle next to the finding. Medium severity findings are marked by GuardDuty in orange with a small square next to the finding. High severity findings are marked by GuardDuty in red with a small triangle next to the finding. Also notice how, on the top right, you have a findings summary showing the total for each of the severity categories.</p>
<h1 id="Amazon-Macie-Basic-Features"><a href="#Amazon-Macie-Basic-Features" class="headerlink" title="Amazon Macie Basic Features"></a>Amazon Macie Basic Features</h1><p>Amazon Macie uses machine learning to do its work and helps you discover and analyze sensitive data stored in Amazon S3 buckets, including personal identifiable information, or PII, such as names, addresses, credit card numbers, API Keys, and access credentials among many others. Macie scans S3 buckets and recognizes critical private information. It also automatically tracks changes to buckets and only evaluates new or modified objects in future scans. That way, it doesn’t have to review objects that have not changed and makes the discovery job significantly more efficient and scalable. You can run one-time or automated data discovery and display the results to AWS Security Hub.</p>
<p>Amazon Macie provides a list of findings where the severity and finding type are clearly displayed. In this case, we created a bucket called academy-ca-macie and uploaded a file with disabled user keys, an RDS SQL Query, a credit card list in CSV format, and a few other files. Notice the severity as medium or high. Also, notice the finding type for the S3 objects include Personal, Financial, and Credentials. It also points to the resource that is affected. Finally, it shows when the object was last scanned. In the future, unless there is a change, these objects will not be re-evaluated.</p>
<h1 id="Overview-of-Amazon-Cognito"><a href="#Overview-of-Amazon-Cognito" class="headerlink" title="Overview of Amazon Cognito"></a>Overview of Amazon Cognito</h1><p>Amazon Cognito, one of the most annoying parts of building and creating applications, either mobile or web, is dealing with user authentication. Being able to determine who is and who is not allowed to operate specific services or aspects in application is extremely important. However, it can be a tedious and time consuming operation to set up.</p>
<p>In the past, all of that important user information would have been stored in a garden variety user database. This database might’ve been hosted onsite or even in the cloud. Either way, it was probably a relational database holding tables of usernames with associated permissions.</p>
<p>When working in AWS land, this means the database would either be hosted on RDS, the Relational Database Service, or by running your own database on EC2 instances. The trouble with using either of these methods is it requires a lot of work to get everything set up and maintain the system. We also have the familiar scenario of people working in the corporate environment.</p>
<p>All of their information is already stored in a directory service like Microsoft Active Directory and we don’t want them to have to create yet another login and password for our new custom application. We would prefer that they could sign in with their day-to-day corporate username and password. Well, all these pain points can be resolved by using Amazon Cognito, a fairly small service that can do quite a lot of heavy lifting.</p>
<h1 id="The-Basics-of-Cognito"><a href="#The-Basics-of-Cognito" class="headerlink" title="The Basics of Cognito"></a>The Basics of Cognito</h1><p>The Basics, at its core, Amazon Cognito is an authentication and user management service. It has a strong integration with third-party identity providers such as Apple, Facebook, Google, and Amazon. It also allows you to federate identities from your own active directory services so that your AD users can have access to your own external web and mobile applications. Amazon Cognito’s features can easily be broken down into two different topics, Amazon Cognito User Pools and Amazon Cognito Identity Pools. Everything else that you can do with the service is derived from these two things. So let’s take a look at Amazon Cognito User Pools first and then we can take a look at Identity Pools after.</p>
<h1 id="User-Pools"><a href="#User-Pools" class="headerlink" title="User Pools"></a>User Pools</h1><p>The primary concern of Cognito User Pools is to create and maintain a directory of your users for your mobile or web applications. This means dealing with both signing up, and signing in, your new and returning users. </p>
<p>When signing up new users, Cognito lets you customize what is important for you and your application. And there is a lot of information you can have your perspective users submit when they are signing up.</p>
<p>If you want all of your new user to submit their emails, addresses, pictures, what have you - you can set that all up while creating your user pool. </p>
<p>You also can create custom attributes if you need something specific from your users. A custom attribute can be a string or a number and allows you to set minimum and maximum values you will accept.</p>
<p>This information is all stored within the Cognito User pool and can be accessed by your application when you need it.</p>
<p>You can also specify how stringent you want to be with your passwords that users can create. </p>
<p>Cognito gives you all the normal password functionality like min length, requiring numbers, special characters, upper and lowercase. Yadda yadda.</p>
<p>Amazon Cognito also has the functionality to require multi-factor authentication(MFA), which I would recommend for any financial services, or high-value information like medical, credit card, or anything really with in-app purchases that a user might have invested a significant amount of money towards.</p>
<p>The service even includes account recovery features that can be quite annoying to set up on your own, and would normally require another backend service to handle for you: Including email and phone.</p>
<p>Additionally, if you don’t want your users to have to go through all that hassle, Cognito User Pools gives you the ability to have social sign-in. This means your users can also sign in for your application by using third-party ID providers.</p>
<p>This path does require you (the application developer) to first set up a developer account with those external third-party providers and set up your application with them. It’s not a particularly difficult task, but it can be time-consuming.</p>
<p>Take a look over here for a step by step walkthrough of the process: <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-social-idp.html">https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-social-idp.html</a></p>
<p>Finally, You can also sign in with any SAML (Security Assertion Markup Language) identity provider. In case you are unaware of SAML, It is a XML-based markup language for security assertions. It is an important tool for single sign-on through the web. For example, your SAML ID provider might be an active directory federation service. This provider could be your on-premises AD or one you are even hosting on an EC2 server.</p>
<p>Please be aware that if you do use this route you will need a domain name that you own.</p>
<p>The service also provides a way to create your own customizable web UI to handle the Sign in and sign up services. Using this customizable UI provides you with an OAuth 2.0 compliant authorization server. OAuth is an open-standard authorization protocol that helps regulate how servers or services can safely allow authenticated access to each other, without sharing SSO credentials.</p>
<p>The user experience of the provided web UI is customizable and allows you to add your own brand logos and to change the look and feel of the webpage.</p>
<p>You don’t have to use this of course and can create your own UI. You would just in charge of calling the appropriate API calls for the service yourself, and running your own OAuth server - which can be difficult for some people, and might be out of scope for what you are trying to achieve.</p>
<p>User pools also have integrations with AWS lambda and gives you the option to trigger functions based on user flow.</p>
<p>For example, if you wanted a lambda function to trigger right after a user has successfully signed up - maybe to send an email, or to create some backend functionality for that user, you have that ability. Or whenever someone successfully signs in, you could have lambda check some backend information about that user, and prepare their environment based on that.</p>
<p>As a final note: you can also add an entire listing of users and accounts via CSV file if you already have that information available.</p>
<p>I think the big thing to notice about this service in general, is that it is just trying to remove all of the extra obstacles out of the way and let you just get into developing your application.</p>
<p>There are plenty of steps required to make even simple sign and authentication work with modern applications, so to have all of these extraneous things dealt with for you is super powerful.</p>
<h1 id="User-Pools-Authentication-Flow"><a href="#User-Pools-Authentication-Flow" class="headerlink" title="User Pools Authentication Flow"></a>User Pools Authentication Flow</h1><p>Now that we know a little bit more about User pools, let’s quickly examine how the authentication flow is handled by your application and the service.</p>
<p>Your user will be presented with a login screen or terminal of some sort from within your application. They will submit their credentials, either from having created an account directly or by logging into a third-party provider. </p>
<p>The application will call the <strong>InitiateAuth</strong> operation with those credentials. This API call kicks off the authentication flow. It directly indicates to amazon Cognito that you want to authenticate. </p>
<p>If the call is successful - Cognito will respond either with a token or with a challenge.</p>
<p>A challenge can include CAPTCHAs or Dynamic challenge questions. These are normally used to help screen for bots. You can insert your own custom challenges if you wish. This will be sent back to the client and it now becomes <em>Their problem</em>.</p>
<p>When the client is ready to respond back to the server(cognito), they can reply with <strong>RespondToAuthChallenge</strong> and provide whatever information the challenge requires back. If the user fails the challenge, you can have Cognito set up to resend a new one. This can include multiple rounds until the user is successful or fails out.</p>
<p>If successful Cognito will shoot back some tokens for the client to use - Hurray authentication!</p>
<p>For a deeper dive into the process please take a look over <a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/mobile/customizing-your-user-pool-authentication-flow/">here</a>.</p>
<h1 id="Identity-Pools"><a href="#Identity-Pools" class="headerlink" title="Identity Pools"></a>Identity Pools</h1><p>The Amazon Cognito Identity pools - also known as Federated Identities, Helps to provide temporary access AWS Credentials for your users or guests that need access to AWS services.</p>
<p>Identity pools can work in tandem with Amazon Cognito user pools, allowing your users to operate and access whatever specific feature they need from AWS. </p>
<p>Additionally, just like with User pools, you can federate with public providers such as Amazon, Facebook, and Google.</p>
<p>The Identity pools help to define two types of identities - Authenticated identities and unauthenticated identities.</p>
<p>Each identity within your identity pool has to be in one of these two states. </p>
<p>To gain the authenticated state, a user must be authenticated by a public login provider. This can be your Amazon Cognito user pool from early, or can also be any of those other public ID providers like Amazon, Apple, Facebook, Google, SAML, and even an Open ID connect provider.</p>
<p>You can also have Unauthenticated identities. This can be useful for a number of reasons, but the primary ones might be for allowing users to see various AWS resources before they are completely logged in. Giving them some visibility into dashboards for example - so they could at a glance see if something was wrong.</p>
<p>You can also use Unauthenticated identities to act as a sort of guest pass for when you want people to have some access to basic services and later prompting them to sign in or sign up.</p>
<p>Each type of identity has a role that goes along with it. Roles have policies attached to them, that set the permissions for what that user is allowed to do within AWS. Roles help to define boundaries and allow you to explicitly state what an authenticated or unauthorized user can, and can not, modify or even see.</p>
<p>If you need a refresher on roles beyond what I’ve just described, please take a look over here for an in-depth look at this feature: </p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/users-groups-and-roles/">https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/users-groups-and-roles/</a></p>
<p>The big thing I want you to think about when differentiating between Identity pools and User pools is that Identity pools are used for authentication and access control ( specifically for AWS services). While user pools are designed for sign-up and sign-in type operations.</p>
<h1 id="Identity-Pools-Authentication-Flow"><a href="#Identity-Pools-Authentication-Flow" class="headerlink" title="Identity Pools Authentication Flow"></a>Identity Pools Authentication Flow</h1><p>Alrighty, now let’s take a look at how authentication works with Identity pools.</p>
<p>The first part we should already be familiar with. Your application needs to have the user sign in with Cognito user pools and that can take place using either the user pool itself, a social sign-in, your SAML-backed authentication service or something of that ilk.</p>
<p>At this stage, an Identity Token is sent by the IDP back to the Cognito user Pool. Now Cognito does not store the credentials by the IDP or forward this to your mobile app, instead, the IDP token will be normalized into a standard token, called a Cognito User Pool Token, or CUP token and this will be used and stored by Cognito. This essentially means that it doesn’t matter if the user authenticated via an account in the User Pool, or federated access, all tokens will be standardized that are sent back to your app.</p>
<p>The actions carried out by the user on your app might also need to access back-end services or APIs that you have created, for example, you might be using API Gateway or Lambda - which accepts these CUP tokens, so Cognito will use the same CUP token to authenticate and authorize you to use those APIs with API Gateway, etc.</p>
<p>Now some services do not allow you to use the CUP tokens for authentication. If your mobile app requires access to services such as S3 or DynamoDB on the user’s behalf, then you will need to use the Identity Pool to authenticate. </p>
<p>The CUP Token can be sent to the Identity Pool, where an STS Token (Security Token Service) will be created based off of your CUP token, and this will be sent back to your application. </p>
<p>With these AWS credentials, your application will now be allowed to call upon those other AWS services.</p>
<p>These credentials will be linked to an AWS role you have associated with your users within the identity pool.</p>
<h1 id="Using-AWS-Identity-Federation-to-Simplify-Access-at-Scale"><a href="#Using-AWS-Identity-Federation-to-Simplify-Access-at-Scale" class="headerlink" title="Using AWS Identity Federation to Simplify Access at Scale"></a>Using AWS Identity Federation to Simplify Access at Scale</h1><p>Hello, my name is Stuart Scott and today I want to speak to you about AWS Identity Federation. I want to explain what it is, some of the AWS services that can be involved in federation and also highlight some scenarios where you might want to implement it.</p>
<p>If you have any feedback on this course, positive or negative, it would be greatly appreciated if you can contact <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>So, firstly, what is Identity Federation? </p>
<p>It’s basically a method where two different providers can establish a level of trust allowing users to authenticate from one, which authorizes them to access resources in the other. During the federation process, one party would act as an Identity Provider, known as an IdP, and the other would be the Service Provider, an SP.  The identity provider authenticates the user, and the service provider controls access to their service or resources based on IdPs authentication.</p>
<p>You’ve probably all been to websites where it presents you with a log in page, where you can either log in using existing credentials native for that service, or you might have an option to authenticate using credentials from a 3rd party provider, such as Facebook, Google, Twitter or LinkedIn etc. </p>
<p>On the screen here you can see the login page for medium.com you can use existing credentials from identity providers including Google, Facebook, Apple, Twitter and Gmail to create a new Medium account, or log back in to Medium if you’ve already created an account. In this scenario, Medium would be the Service Provider.</p>
<p>So if you didn’t have an account with Medium already, you could select one of these providers to create one. So as an example if you already had a Google account and were signed in with it, and selected ‘Sign in with Google’ you’d be presented with the following screen</p>
<p>Now here Medium has detected that I didn’t have a Medium account associated with my current Google Account, you can see it says “Sorry, we didn’t recognize that account’, and so you are asked if you would like to create one. By selecting Sign up with Google, Medium authenticates my access via my Google credentials, and so trusting the Google IdP, and this enables me to create a new Medium account based off of that authentication. </p>
<p>So in this example, Google was used as the Identity Provider to authenticate you to Medium with a new account. The next time I then need to log in to Medium, all I would have to do is select ‘Sign in with Google’ and as long as I were logged in to my Google account already, I would be logged straight into Medium with 1-click, and this directly correlates to the term ‘Single-Sign on’, or SSO. SSO relates to the method of signing in to one system, which can then be used to authenticate you into another without having to resupply additional credentials. </p>
<p>Now, the process behind this is fairly simple, when the identity provider has been selected, and the user is authenticated by that provider, an assertion is sent back to the service provider, in this case Medium. And this assertion is a message that contains metadata and attributes about the user such as their username. This assertion allows the service provider to authorize access to their services.**<br>**</p>
<p>So identity federation provides a great way to easily set up access control systems with flexibility and ease for the users and service providers. </p>
<p>So using this same principle AWS has a variety of services and methods that allows you to access your AWS services via federated access, meaning you don’t need to have a specific identity &amp; access Management user configured in AWS if you already have a user directory that is managed elsewhere that could be used as an Identity Provider. </p>
<p>Using many different identity standards, including OAuth 2.0, OIDC, which is OpenID Connect, and SAML 2.0, (Security Assertion Markup Language), AWS enables you to easily configure access for contractors and other 3rd parties, in addition to allowing scalable access to authenticate to your mobile and web applications.</p>
<p>Let’s take a quick look at the definitions of these standards according to Wikipedia:</p>
<p><strong>“OAuth</strong> <em>is an open standard for access delegation, commonly used as a way for Internet users to grant websites or applications access to their information on other websites but without giving them the passwords”</em> - Wikipedia</p>
<p><strong>“OpenID Connect</strong> <em>is a simple identity layer on top of the OAuth 2.0 protocol, which allows computing clients to verify the identity of an end-user based on the authentication performed by an authorization server, as well as to obtain basic profile information about the end-user.”</em> - Wikipedia</p>
<p><em>“</em><strong>Security Assertion Markup Language 2.0</strong> <em>(<em><strong>SAML 2.0</strong></em>) is a standard for exchanging authentication and authorization identities between security domains. SAML 2.0 is an XML-based protocol that uses security tokens containing assertions to pass information about a principal (usually an end user) between a SAML authority, named an Identity Provider, and a SAML consumer, named a Service Provider.” -</em> Wikipedia</p>
<p>Now we have more of an understanding of federation, I want to take a high level look at some of the services offered by AWS and how they fit into AWS Identity Federation, including</p>
<ul>
<li>AWS Single Sign-On, known as SSO</li>
<li>AWS Identity &amp; Access Management (IAM)</li>
<li>And Amazon Cognito</li>
</ul>
<p>Now, by the name alone we can safely assume that this has something to do with federated access. </p>
<p>This service has primarily been designed for users to easily access multiple accounts within their AWS Organization enabling a single sign-on approach negating the need to provide credentials for each account. For those unfamiliar with AWS Organizations, they provide a means of centrally managing and categorizing multiple AWS accounts that you own, bringing them together into a single organization, helping to maintain your AWS environment from a security, compliance, and account management perspective.</p>
<p>You can either use the AWS SSO own built in user directory which allows you to create unique users based on e-mail addresses, or alternatively connect AWS SSO to one of the supporting identity providers, such as your own corporate MS Active Directory if you are using one. </p>
<p>Either way, AWS SSO enables you to create different groups while leveraging the power of IAM roles and permissions allowing you to control what access users or groups have in specific AWS Accounts within your organization. </p>
<p>When Users have been configured, they can connect via their own portal which will list all AWS accounts they have access to, along with roles they have access to adopt, and if they would like to access the Management console or use temporary credentials for AWS CLI access.</p>
<p>AWS SSO can also be used to manage access to cloud-based apps using SAML 2.0 such as Office 365 and Salesforce. </p>
<p>As I mentioned previously, Identity federation allows you to access and manage AWS resources even if you don’t have a user account within IAM. </p>
<p>Whereas AWS SSO allows you to create a single sign-on approach to multiple accounts in your AWS organization using the in-built user directory or MS-AD, AWS IAM allows you to configure federated access to your AWS accounts and resources using different identity providers for each AWS account. Examples include both SAML 2.0 for enterprise federation using MS-AD, and OpenID Connect, classed as web identity federation, such as Google, PayPal and Amazon. As a result you could allow access to your environment using these Identity Providers instead of setting up users with a new identity within AWS IAM.</p>
<p>The benefits of this is twofold. It minimizes the amount of administration required within IAM and it allows for a single sign-on solution. </p>
<p>As a part of the configuration process to implement federated authentication, a trust relationship between the identity provider and your AWS account is established. AWS supports two types of identity providers, OpenID Connect, also often referred to as web identity federation, and SAML 2.0.</p>
<p>Amazon Cognito has been built purely to enable the simplification of enabling secure authentication and access control for new and existing users accessing your web or mobile applications, rather than your AWS account. It not only integrates well with SAML 2.0 but also web identity federation as well. One of the biggest features of Amazon Cognito is that it has the capability to scale to millions of new users which is great when working with mobile applications.</p>
<p>Cognito also allows you to use a custom portal allowing you to add a personalized sign-in page with branding and your own logo.</p>
<p>There are 2 main components of Amazon Cognito, these being ‘User Pools’ and ‘Identity Pools’ and they perform different actions.</p>
<p>User Pools are essentially a scalable user directory that allows new users to sign up, or existing users to log in to your mobile application using their native credentials from the user pool, or they can alternatively federate their access via a web or enterprise IdP. </p>
<p>Identity Pools are different to user pools in that they actually provide you with the ability of accessing AWS resources called upon by your web or mobile app by using temporary credentials and the Security token service.</p>
<p>So let me summarize the key difference between these 3 AWS options to implement federated access to AWS.</p>
<ul>
<li>AWS SSO allows you to create a Single sign-on approach to access multiple AWS accounts within an AWS Organization using a single identity provider for all.</li>
<li>AWS IAM allows you to configure different OpenID or SAML identity providers for each of your AWS accounts.</li>
<li>Amazon Cognito enables secure authentication to your web or mobile applications using both SAML 2.0 and web identity federation.</li>
</ul>
<p>That brings me to the end of this introductory course covering AWS identity Federation. You should now have a greater understanding of what it is and some of the services that can be used to implement different kinds of federated Access.</p>
<p>If you have any feedback on this course, positive or negative, please send an e-mail to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>, your feedback is greatly appreciated. Thank you for your time and good luck with your continued learning of cloud computing. Thank you.</p>
<h1 id="Using-AWS-SSO-to-Simplify-Access-Across-Your-AWS-Organization"><a href="#Using-AWS-SSO-to-Simplify-Access-Across-Your-AWS-Organization" class="headerlink" title="Using AWS SSO to Simplify Access Across Your AWS Organization"></a>Using AWS SSO to Simplify Access Across Your AWS Organization</h1><p>Hello, my name is Stuart Scott and today I want to introduce you to AWS SSO and perform a demonstration on how to create and configure a single sign-on portal for users to access multiple AWS accounts within a single AWS Organization without the users having an IAM account. By the end of this course, you will have a greater understanding of the benefits of AWS SSO and how it can be used to simplify user access at scale.</p>
<p>To get the most from this course, it would be beneficial if you have a basic understanding of AWS Organizations as this tightly integrates with the AWS SSO service. If you have any feedback on this course, positive or negative, it would be greatly appreciated if you can contact support at cloudacademy.com.</p>
<p>So what is SSO? For those unfamiliar with the AWS SSO service, let me briefly explain what the service is used for and some of its key features. AWS SSO, which stands for Single Sign-On, is used to help you implement a federated access control system providing a portal to your users allowing them to access multiple accounts within your AWS Organization without having to supply IAM credentials for each one. It can also be used to federated access to cloud applications, such as Microsoft Office 365 and Salesforce.</p>
<p>For those unfamiliar with AWS Organizations, it provides a means of centrally managing and categorizing multiple AWS accounts that you own, bringing them together into a single organization, helping to maintain your AWS environment from a security, compliance, and account management perspective. For more information on this service, please see our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/securing-aws-organizations-with-service-control-policies-scps/introduction/">here</a>.</p>
<p>So some key features of AWS SSO include the following: It’s a highly available managed AWS service. It has personalized portals for your end-users to centrally gain access to your AWS accounts and cloud applications. It comes with full integration with AWS CloudTrail for auditing SSO activity between your accounts. As already highlighted, it integrated with AWS Organizations enabling SSO for multiple accounts. It also has support for Azure Active Directory and Okta Universal Directory. It also supports multi-factor authentication for additional security protection, and it has the ability to use IAM fine-grained controls to manage access to resources.</p>
<p>So as you can see from these features alone it has some great advantages to help you manage and implement a single-sign on approach in your organization. Now there are a number of prerequisites that you must meet before you configure and enable AWS SSO within your accounts. The first of which requires you to configure AWS Organizations for your accounts using the ‘All features’ option rather than just ‘Consolidated billing features’.</p>
<p>You must also use the Management AWS account of your AWS Organization to enable and configure AWS SSO. The configuration and implementation can’t be done using one of your member accounts. And then once you have performed these two simple steps, you then have the decision of deciding which identity pool you want to have AWS SSO use as your source of users.</p>
<p>You can either use an external identity pool supported by AWS SSO with SAML two, such as Azure Active Directory or Okta Universal Directory, or you can choose to manage your users with the default identity user store that comes natively with AWS SSO, and it’s this option that I am going to focusing on today in our demonstration.</p>
<p>Before I start the demonstration, I just want to highlight what I shall be doing. So the aim of this demonstration is to show you how to configure AWS SSO enabling full S3 and RDS access for a user in two different AWS accounts using a customized user portal. The steps required to achieve this will include: Selecting my identity source, and this is where I can select to use the native AWS SSO user directory, or Active Directory, or another supported SAML 2.0 based identity provider. And I shall be using the AWS SSO user directory.</p>
<p>I shall customize the URL of the portal that I want users of AWS SSO to use to gain access to my AWS Accounts I will then add a new user to the AWS SSO directory using an e-mail address to uniquely identify them as a user. I shall create a new group and add the user to that group, and I must also create a permission set defining full S3 and RDS access for the user to inherit. I will then associate this permission set to the new group which will be applied to specific AWS accounts in my Organization. And I will then test access by signing in to the AWS SSO user portal</p>
<p>Okay, so now we have a basic understanding of what we are going to do. Let’s go ahead and try it out!</p>
<p>Okay, so I’m in the AWS management console. So the first thing I need to do is find AWS SSI and that can be found under the security identity and compliance category. So here we have AWS single sign-on. So if I select that, and this will take me to the dashboard.</p>
<p>Now the thing I want to do is to select an identity source. So if I go into the identity source and here we can see that currently the identity source is configured as AWS SSI. Now, if I didn’t want to use the inbuilt identity directory offered by SSI, then I could go in here and change it and select active directory or an external identity provider. But for this demonstration, I’m just going to use the AWS SSO directory itself.</p>
<p>Okay, then further down we can configure the user portal. So this will be the link that everyone will receive, who’s set up on AWS SSO to access the AWS account. And you can customize this to whatever you’d like it to. So let me just click on customize and I’ll just enter my name Stuart Scott and then save. And now my link is customized, making it much more user friendly.</p>
<p>Okay, so I’ve now selected my identity source and also customize my user portal URL. Let’s now go and create a user. So on the left-hand side here, you can select users. At the moment you can see I don’t have any users configure at all. If I click on add user, now I can set up a user name. I’ll just call this Stuart Scott. And for password, I can select to send an email to the user with a password to set them instructions or generate a one-time password that I can then share with the user. I’m just gonna leave it as a default send an email to a user. I’ll put in an email address, then just confirm those details, add in the extra details and that’s it. And then further down this optional other metadata and attributes that you can add if needed, but for now I’m just going to leave it as there, the setup of the user itself.</p>
<p>If I click on next groups, now here, I can create a group for easier management of the older different users that you have. So let’s go ahead and do that. And this helps with permission access as well as we’ll see as we go through the demonstration. So if I select create group and I’ll just call this S3 and RDS access, ‘cause this is what I want the group permissions to have.</p>
<p>So let’s make it nice and easy. If I select create and I can select that group to make sure the user is a part of that group and then say, add user. So that user is now added to our group and we have the user Stuart Scott added to this AWS SSO directory. Now, what I need to do is create permissions for that user. So if we go over to our AWS accounts on the left here, and I can see the different accounts that I have in my AWS organization.</p>
<p>So, like I said, as a prerequisite, when you use AWS SSO, you need to make sure that you have AWS organizations already set up. And these are my two accounts that I have in my organization. Now at the top here, you can see two different tabs, your AWS organization, and also permission sets. So if I select permission sets, at the moment I don’t have any permission sets. So if I create one, and I can use an existing job function policy or create a custom permission set.</p>
<p>For this demonstration, I want to create a custom permission set. Click on next. And I’ll just call this S3 and RDS access again. And you can configure session durations, which will define the length of time a user can be logged on before the console logs him out of this session. So you have a number of different options here. I’m just gonna leave it as a default one hour. And I want to attach AWS managed policies. So let me just type in S3, ‘cause I want full S3 access and also full RDS access. So here we have the AWS managed policy of S3 and I also want RDS as well. And here we have Amazon RDS full access.</p>
<p>So if I then click on next, we can add any tags if you want to. I’m just gonna leave that blank for now. Then in the final review screen, we can see the policies that I’ve attached, the S3 Full Access and RDS Full Access, and also the name of this permission set. And then click on create.</p>
<p>Now the next thing I want to do is associate this permission set with the group and assign that group to the AWS accounts in my organization. So I go across to AWS organization here, and if I select the two accounts that I want to add the users to, then I can click on assign users. Now I can either split the use individually or the group, and the best practice would be to use the group for easier managements. I’m going to select the S3 and RDS access because we know that the user is already a part of this group.</p>
<p>Now, from here, we can click on next to assign the permission sets. And here we have our permission set that we would like. So this will associate that permission set with the group on those two AWS accounts. Now we can see here that this is now successfully configured for my AWS accounts and our users can use these accounts with the permissions that we assigned. So if we click on proceed to AWS accounts and it takes us back to this screen here.</p>
<p>Now let’s look at from the user perspective. So now in my inbox of that user that was created. So this is the automatic email that is sent out to say that we’ve been invited to use the AWS SSO user portal and we can see the URL here, and we need to accept the invitation first. So let’s go ahead and do that.</p>
<p>Now I’m prompted to enter a new password, so let me just go ahead and do that. Making sure it meets all the recommendations, set new password. And then once that’s done, we can then click on our user portal here. So let’s go ahead and try that. So we have our username of Stuart Scott. If I enter my password, and I’m taken to this user portal here and we can see here that it’s got that URL that we initially set up.</p>
<p>Now, what we have here is our AWS accounts. Now, if I select this account, it shows the two accounts that this user has access to. And if I select one of those accounts, it then shows the permissions and roles that I effectively set up, the S3 and RDS access. And from here, I can either select the management console to gain access to the management console or use the CLI to gain programmatic access.</p>
<p>So let’s just go ahead and click on the management console. And that takes me straight into that specific account. So from here, this user can now administer S3 and RDS as well. And I can go back to the portal and also select the secondary account and do exactly the same thing.</p>
<p>So that’s how you can easily use AWS SSO to set up single sign on access to multiple AWS accounts when you’re running AWS organizations. That brings me to the end of this course which demonstrated how the AWS SSO service can be configured and implemented to help you manage a single sign-on portal to access multiple AWS accounts with a single AWS organization using the default user directory provided.</p>
<p>If you have any feedback on this course, positive or negative, please send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. Your feedback is greatly appreciated. Thank you for your time and good luck with your continued learning of cloud computing. Thank you.</p>
<h1 id="Security-Summary"><a href="#Security-Summary" class="headerlink" title="Security Summary"></a>Security Summary</h1><p>So you’ve now completed the theory stage of probably my favorite topic of AWS, that being security. As you’ve probably realized by now, security is interwoven in so many parts of AWS and its services. For example, we touched on Compute Security with key pairs. We mentioned security during our storage section referencing encryption of data. We even touched on encryption during networking with network ACLs and security groups. So security is everywhere. </p>
<p>So it’s no surprise that AWS has a focus on specific security services, but the ones that will primarily show up in the exam are AWS IAM, WAF, Shield, and Cognito. So in this summary, I want to rinse and repeat some of the key elements that are essential in helping you prepare to answer questions that come up relating to these services. Okay, so let’s get started. First off, AWS Identity and Access Management, also known as IAM. So first and foremost, you’re going to need to know the difference between users, groups, and roles, and the best practices when configuring each of them. For example, generally, you should add users to groups and then apply permissions to those groups. </p>
<p>Another example would be to ensure you configure multi-factor authentication to any users that have enhanced and privileged permissions to reduce the blast radius should the credentials become compromised. Let me quickly mention a few points over each that you definitely should know about before sitting the exam. So from a user perspective, this is where you can configure and assign multi-factor authentication settings, also known as MFA. Also, this is where you can configure a user for programmatic access, as well as access to the management console. Can you remember what a user needs if they want programmatic access to your resources? Well, they need their access key ID and secret access key which are associated with their user and applied to the configuration of the AWS CLI.</p>
<p>So next we have IAM groups, and these are simply objects that your users can be a part of and any users in that group inherit permissions associated with that group. Now, when it comes to permissions, and I can’t emphasize this enough, it’s imperative that you have a basic awareness and understanding of IAM policies. You need to be able to look at a policy to determine what access it is allowing or denying. And this will help you breeze through a couple of questions on the exam, at least. Now, remember when it comes to permissions, a deny always overwrite any allow.</p>
<p>So I mentioned roles just a moment ago. So roles and policy permissions is always a hot topic in the AWS Solutions Architect Associate. So let me just run through a few points in relation to these. So roles allow users and other AWS services to adopt a set of temporary IAM permissions to access AWS resources. And the keyword here is temporary. Remember that for any questions that come up relating to temporary access, if you see temporary then look out for roles, but to adopt a role, you must have the right permissions to do so. Now much like groups, roles have associated permission sets and any user adopting the role will receive those permissions. And roles can also be used by EC2 instances, allowing that instance to access resources on your behalf, which is a great way to allow instances to access other resources, rather than embedding credentials on the EC2 instance itself, which you should never do. </p>
<p>Now you should also be aware of the different types of roles that are available, which includes service roles, service linked roles, roles for cross-account access. And actually on this point, I recommend that you learn and understand the steps involved in creating cross-account access, as there is usually at least one question on this. And then finally, roles for identity provider access which relates to federated access. But what is federated access, I hear you ask? Well, federated access is when you provide authentication to your applications in AWS Services via an external identity provider, such as your own Microsoft Active Directory or social identity, such as Facebook, Amazon, or Google. Now a great service to help you manage this for your web and mobile applications is Amazon Cognito. And I’ll come on to this later.</p>
<p>Now, earlier I mentioned how important it is to understand how to read IAM policies, which are written in a JSON format. Now the main elements of a policy you need to know are the action, and this is the action of the permissions being requested. For example, being able to delete objects in S3 or to create instances for EC2. Also, we have the effect, and this element can either be set to allow or deny the actions that are stipulated. Then we have the resource, and the defines the resource you wish the action and effect to be applied to. For example, the ARN of a specific S3 bucket. And also we have the principal element as well. And this specifies the identity that the permissions apply to. And this is usually used in a resource-based policy instead of an identity-based policy. And then finally, the condition. This is an optional element that allows you to control when the permissions will be effective, based upon set criteria. For example, you could ensure that the permissions are only applied if the user has a specific source IP address.</p>
<p>Okay, so moving on from IAM, which is quite a big topic in itself, I now want to mention a few points relating to the AWS Web Application Firewall Service, Firewall Manager, and Shield. Okay, so firstly, what is WAF? While the main function of the AWS WAF service is to provide protection of your web applications from malicious attacks from a wide variety of attack patterns. It’s worth noting as well that it’s also used in conjunction with Amazon CloudFront distributions, the Application Load Balancer and the API gateway to analyze requests over HTTP or HTTPS, to help distinguish between harmful and legitimate requests to your applications and site. So AWS WAF will block and restrict access that is detected as forbidden. Now it will help you to understand how WAF fits together and some of its components. Ensure you know the differences between conditions, rules, and Web Access Control List for the exam.</p>
<p>So to use WAF, you need to create a Web Access Control List and this will be associated to a resource, for example, a CloudFront distribution. And in this Web ACL, you will include both conditions and rules. Now the primary function of the condition is to specify what element of the incoming request should be analyzed by WAF, and examples of these include cross-site scripting, geo-match or IP address, et cetera. So it’s a condition as to which the incoming request will be assessed upon. Now rules contain the conditions that you want to use to filter the incoming web requests. So using both the rules and conditions, you can specify an action, which will either be allow, block, or count. </p>
<p>And this will depend on the condition configuration. And these rules are then added to the Web Access Control List. Now it’s worth pointing out that WAF rules are executed in the order that they appear within a Web ACL. And as soon as the match is found, no other rules are checked for that request. So ensure you set these rules in the correct order to filter your request properly. So that’s an overview of WAF. Now let’s see how Firewall Manager fits in. So Firewall Manager closely relates to WAF, but Firewall Manager has been designed to help you manage WAF in a multi-account environment with simplicity and control, with the help of AWS Organizations. So just remember, when it comes to WAF and multi-accounts, you should be using Firewall Manager. </p>
<p>Now, before you use Firewall Manager, you must ensure that your AWS Account is a part of an AWS Organization with all features enabled. You must also define which AWS Account should act as a Firewall Manager Admin account. And lastly, ensure that you have AWS Config enabled. So that’s just some prerequisites of using Firewall Manager to be aware of. Now, Firewall Manager uses rule groups to group together one or more WAF rules that you have, and these will all have the same action applied when the conditions are met within a rule. Now also remember that Firewall Manager policies contain rule groups that you want to assign to your AWS resources. Now, the final service I want to talk about that relates to WAF as well is AWS Shield.</p>
<p>So AWS Shield is designed to help to protect your infrastructure against distributed denial of service attacks, commonly known as DDoS, and these attacks target hosts which might be running a website or web application, and the increase and flood of traffic from a DDoS attack aims to prevent legitimate requests getting through to the host and being processed, and so it hinders the whole performance of the application or website. So if you get any questions relating to DoS attacks or DDoS attacks, then you want to be looking for AWS Shield within your answers. So AWS Shield itself is available at two different levels. We have AWS Shield Standard, which is free and available to everyone, whereas AWS Shield Advanced has a lot more power and protection to offer than Standard. For example, with Advanced you get access to a 24 by 7 specialized DDoS response team at AWS, known as DRT. Now also remember that the protection that Shield offers is integrated both with CloudFront and also Route 53 as well.</p>
<p>Okay, let’s move on to Amazon Cognito. And this is the last security service I want to mention. So let’s put together some of our key highlights here. So Amazon Cognito is an authentication and user management service, which works great with web and mobile applications. So it integrates with third party identity providers, such as Apple, Facebook, Google, and Amazon, in addition to being able to federate identities from your own Active Directory service. Now I recommend you become familiar with the differences between Amazon Cognito User Pools and Identity Pools. Now these are the two main points of this service. So as long as you understand those, then it should put you in good stead to answer any questions that come up about managing authentication and verification at scale to your web applications or your mobile applications. </p>
<p>Now just remember that User Pools are used to create and maintain a directory of your users for your mobile or web applications. Now this means dealing with both signing up and signing into your new and returning users. Now you can also offer sign-in for your application by using third party identity providers, such as Facebook, Amazon, et cetera, or by using SAML, for example, using your own Active Directory. Now Cognito Identity Pools help to provide temporary access AWS credentials for your authenticated users or unauthenticated guests that need access to AWS services. Now they can work in tandem with Amazon Cognito User Pools, allowing your users to operate and access whatever specific feature they need from AWS. </p>
<p>Now, additionally, just like with User Pools, you can federate with public providers, such as Amazon, Facebook and Google as well. So the main difference between User Pools and Identity Pools is that User Pools provide a method of authentication through identity verification, allowing them to sign into your web or mobile applications using an identity provider or Cognito’s local directory, whereas Identity Pools are typically used to help control access using temporary credentials to access AWS services on your application’s behalf.</p>
<p>Okay, so that brings us to the end of the security summary. Now there’s a lot to take in. However, you are going to need to know about IAM, the difference between users, groups, and roles. So have a play with them using our labs, and it will really help you. Also spend some time looking at IAM policies to ensure you understand their layout and what they tell you. Now if you get any questions relating to protecting your web apps or CloudFront distributions from common attack patterns, then think of WAF. If you get any questions about managing WAF between multiple accounts using AWS Organizations, then think Firewall Manager. And if you get anything asking how to protect against DoS or DDoS, then AWS Shield is your go-to answer. Okay, it’s time to take a break, rest up, retain what we’ve covered, and then move on to the next section.</p>
<h1 id="2What-is-Identity-and-Access-Management"><a href="#2What-is-Identity-and-Access-Management" class="headerlink" title="2What is Identity and Access Management?"></a>2<strong>What is Identity and Access Management?</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/using-aws-identity-federation-simplify-access-scale-1549/">Identity Federation course</a></p>
<h1 id="3IAM-Features"><a href="#3IAM-Features" class="headerlink" title="3IAM Features"></a>3<strong>IAM Features</strong></h1><p><a target="_blank" rel="noopener" href="https://sts.amazonaws.com/">STS Global Endpoint</a></p>
<h1 id="7Managing-Multiple-Users-with-IAM-User-Groups"><a href="#7Managing-Multiple-Users-with-IAM-User-Groups" class="headerlink" title="7Managing Multiple Users with IAM User Groups"></a>7<strong>Managing Multiple Users with IAM User Groups</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html">Group limitations</a></p>
<h1 id="9Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf"><a href="#9Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf" class="headerlink" title="9Using AWS Service Roles to Access AWS Resources on Your Behalf"></a>9<strong>Using AWS Service Roles to Access AWS Resources on Your Behalf</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_aws-services-that-work-with-iam.html">AWS services that work with IAM</a></p>
<h1 id="10Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users"><a href="#10Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users" class="headerlink" title="10Using IAM User Roles to Grant Temporary Access for Users"></a>10<strong>Using IAM User Roles to Grant Temporary Access for Users</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-cross-account-access-using-iam/">Implementing cross-account roles using IAM</a></p>
<h1 id="11Using-Roles-for-Federated-Access"><a href="#11Using-Roles-for-Federated-Access" class="headerlink" title="11Using Roles for Federated Access"></a>11<strong>Using Roles for Federated Access</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/using-amazon-cognito-manage-authentication-authorization-mobile-web-apps-1560/">Using Amazon Cognito to Manage Authentication &amp; Authorization to your Mobile and Web Apps</a></p>
<h1 id="17An-Overview-of-AWS-WAF"><a href="#17An-Overview-of-AWS-WAF" class="headerlink" title="17An Overview of AWS WAF"></a>17<strong>An Overview of AWS WAF</strong></h1><p><a target="_blank" rel="noopener" href="https://owasp.org/www-project-top-ten/">OWASP Top Ten List</a></p>
<h1 id="21Policies"><a href="#21Policies" class="headerlink" title="21Policies"></a>21<strong>Policies</strong></h1><p><a target="_blank" rel="noopener" href="https://aws.amazon.com/firewall-manager/pricing/">Firewall Manager pricing</a></p>
<p><a target="_blank" rel="noopener" href="https://aws.amazon.com/config/pricing/">AWS Config pricing</a></p>
<h1 id="23Configuring-Shield"><a href="#23Configuring-Shield" class="headerlink" title="23Configuring Shield"></a>23<strong>Configuring Shield</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/introduction-81/">Course: AWS: Overview of AWS Identity &amp; Access Management (IAM)</a></p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-cloudwatch/introduction-39/">Course: Amazon Web Services CloudWatch</a></p>
<h1 id="25AWS-Security-Hub-Standards-Implemented"><a href="#25AWS-Security-Hub-Standards-Implemented" class="headerlink" title="25AWS Security Hub Standards Implemented"></a>25<strong>AWS Security Hub Standards Implemented</strong></h1><p><a target="_blank" rel="noopener" href="https://www.cisecurity.org/">Center for Internet Security</a></p>
<h1 id="34User-Pools-Authentication-Flow"><a href="#34User-Pools-Authentication-Flow" class="headerlink" title="34User Pools Authentication Flow"></a>34<strong>User Pools Authentication Flow</strong></h1><p><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/mobile/customizing-your-user-pool-authentication-flow/">Customizing Amazon Cognito User Pool Authentication Flow</a></p>
<h1 id="35Identity-Pools"><a href="#35Identity-Pools" class="headerlink" title="35Identity Pools"></a>35<strong>Identity Pools</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/users-groups-and-roles/">Course: AWS: Overview of AWS Identity &amp; Access Management (IAM)</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AWS-Solution-Architect-Associate-Knowledge-Check-Architecture-SAA-C03-2-of-2-37/" rel="prev" title="AWS-Solution-Architect-Associate-Knowledge-Check-Architecture-SAA-C03-2-of-2-37">
      <i class="fa fa-chevron-left"></i> AWS-Solution-Architect-Associate-Knowledge-Check-Architecture-SAA-C03-2-of-2-37
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AWS-Solution-Architect-Associate-Introduction-to-IAM-39/" rel="next" title="AWS-Solution-Architect-Associate-Introduction-to-IAM-39">
      AWS-Solution-Architect-Associate-Introduction-to-IAM-39 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Security-SAA-C03-Introduction"><span class="nav-number">1.</span> <span class="nav-text">Security (SAA-C03) Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-Identity-and-Access-Management"><span class="nav-number">2.</span> <span class="nav-text">What is Identity and Access Management?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IAM-Features"><span class="nav-number">3.</span> <span class="nav-text">IAM Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview-of-the-User-Dashboard"><span class="nav-number">4.</span> <span class="nav-text">Overview of the User Dashboard</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-IAM-Users"><span class="nav-number">5.</span> <span class="nav-text">Creating IAM Users</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Managing-IAM-Users"><span class="nav-number">6.</span> <span class="nav-text">Managing IAM Users</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Managing-Multiple-Users-with-IAM-User-Groups"><span class="nav-number">7.</span> <span class="nav-text">Managing Multiple Users with IAM User Groups</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IAM-Roles"><span class="nav-number">8.</span> <span class="nav-text">IAM Roles</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf"><span class="nav-number">9.</span> <span class="nav-text">Using AWS Service Roles to Access AWS Resources on Your Behalf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users"><span class="nav-number">10.</span> <span class="nav-text">Using IAM User Roles to Grant Temporary Access for Users</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-Roles-for-Federated-Access"><span class="nav-number">11.</span> <span class="nav-text">Using Roles for Federated Access</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IAM-AWS-Policy-Types"><span class="nav-number">12.</span> <span class="nav-text">IAM AWS Policy Types</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Examining-the-JSON-Policy-Structure"><span class="nav-number">13.</span> <span class="nav-text">Examining the JSON Policy Structure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-an-AWS-IAM-Policy"><span class="nav-number">14.</span> <span class="nav-text">Creating an AWS IAM Policy</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Policy-Evaluation-Logic"><span class="nav-number">15.</span> <span class="nav-text">Policy Evaluation Logic</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementing-Cross-Account-Access-Using-IAM"><span class="nav-number">16.</span> <span class="nav-text">Implementing Cross-Account Access Using IAM</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#An-Overview-of-AWS-WAF"><span class="nav-number">17.</span> <span class="nav-text">An Overview of AWS WAF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Understanding-Rules-and-Rule-Groups"><span class="nav-number">18.</span> <span class="nav-text">Understanding Rules and Rule Groups</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Web-ACL-Demo"><span class="nav-number">19.</span> <span class="nav-text">Creating a Web ACL Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWS-Firewall-Manager-and-Prerequisites"><span class="nav-number">20.</span> <span class="nav-text">AWS Firewall Manager and Prerequisites</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Policies"><span class="nav-number">21.</span> <span class="nav-text">Policies</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-AWS-Shield"><span class="nav-number">22.</span> <span class="nav-text">What is AWS Shield?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Shield"><span class="nav-number">23.</span> <span class="nav-text">Configuring Shield</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWS-Security-Hub-Features"><span class="nav-number">24.</span> <span class="nav-text">AWS Security Hub Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWS-Security-Hub-Standards-Implemented"><span class="nav-number">25.</span> <span class="nav-text">AWS Security Hub Standards Implemented</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWS-Security-Hub-Operation"><span class="nav-number">26.</span> <span class="nav-text">AWS Security Hub Operation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AWS-Security-Hub-Integrations"><span class="nav-number">27.</span> <span class="nav-text">AWS Security Hub Integrations</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Amazon-Inspector-Basic-Features"><span class="nav-number">28.</span> <span class="nav-text">Amazon Inspector Basic Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Amazon-Guard-Duty-Basic-Features"><span class="nav-number">29.</span> <span class="nav-text">Amazon Guard Duty Basic Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Amazon-Macie-Basic-Features"><span class="nav-number">30.</span> <span class="nav-text">Amazon Macie Basic Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview-of-Amazon-Cognito"><span class="nav-number">31.</span> <span class="nav-text">Overview of Amazon Cognito</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#The-Basics-of-Cognito"><span class="nav-number">32.</span> <span class="nav-text">The Basics of Cognito</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#User-Pools"><span class="nav-number">33.</span> <span class="nav-text">User Pools</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#User-Pools-Authentication-Flow"><span class="nav-number">34.</span> <span class="nav-text">User Pools Authentication Flow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Identity-Pools"><span class="nav-number">35.</span> <span class="nav-text">Identity Pools</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Identity-Pools-Authentication-Flow"><span class="nav-number">36.</span> <span class="nav-text">Identity Pools Authentication Flow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-AWS-Identity-Federation-to-Simplify-Access-at-Scale"><span class="nav-number">37.</span> <span class="nav-text">Using AWS Identity Federation to Simplify Access at Scale</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-AWS-SSO-to-Simplify-Access-Across-Your-AWS-Organization"><span class="nav-number">38.</span> <span class="nav-text">Using AWS SSO to Simplify Access Across Your AWS Organization</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Security-Summary"><span class="nav-number">39.</span> <span class="nav-text">Security Summary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2What-is-Identity-and-Access-Management"><span class="nav-number">40.</span> <span class="nav-text">2What is Identity and Access Management?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3IAM-Features"><span class="nav-number">41.</span> <span class="nav-text">3IAM Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7Managing-Multiple-Users-with-IAM-User-Groups"><span class="nav-number">42.</span> <span class="nav-text">7Managing Multiple Users with IAM User Groups</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9Using-AWS-Service-Roles-to-Access-AWS-Resources-on-Your-Behalf"><span class="nav-number">43.</span> <span class="nav-text">9Using AWS Service Roles to Access AWS Resources on Your Behalf</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10Using-IAM-User-Roles-to-Grant-Temporary-Access-for-Users"><span class="nav-number">44.</span> <span class="nav-text">10Using IAM User Roles to Grant Temporary Access for Users</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11Using-Roles-for-Federated-Access"><span class="nav-number">45.</span> <span class="nav-text">11Using Roles for Federated Access</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#17An-Overview-of-AWS-WAF"><span class="nav-number">46.</span> <span class="nav-text">17An Overview of AWS WAF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#21Policies"><span class="nav-number">47.</span> <span class="nav-text">21Policies</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#23Configuring-Shield"><span class="nav-number">48.</span> <span class="nav-text">23Configuring Shield</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#25AWS-Security-Hub-Standards-Implemented"><span class="nav-number">49.</span> <span class="nav-text">25AWS Security Hub Standards Implemented</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#34User-Pools-Authentication-Flow"><span class="nav-number">50.</span> <span class="nav-text">34User Pools Authentication Flow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#35Identity-Pools"><span class="nav-number">51.</span> <span class="nav-text">35Identity Pools</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
