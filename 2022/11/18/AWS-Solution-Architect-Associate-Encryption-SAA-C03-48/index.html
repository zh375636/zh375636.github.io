<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Encryption (SAA-C03) IntroductionHello, and welcome to this course on encryption with AWS, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS-Solution-Architect-Associate-Encryption-SAA-C03-48">
<meta property="og:url" content="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Encryption-SAA-C03-48/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="Encryption (SAA-C03) IntroductionHello, and welcome to this course on encryption with AWS, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T02:14:09.000Z">
<meta property="article:modified_time" content="2022-11-28T15:06:18.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Encryption-SAA-C03-48/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AWS-Solution-Architect-Associate-Encryption-SAA-C03-48 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AWS-Solution-Architect-Associate-Encryption-SAA-C03-48/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AWS-Solution-Architect-Associate-Encryption-SAA-C03-48
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 22:14:09" itemprop="dateCreated datePublished" datetime="2022-11-18T22:14:09-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 11:06:18" itemprop="dateModified" datetime="2022-11-28T11:06:18-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS-Solution-Architect-Associate/" itemprop="url" rel="index"><span itemprop="name">AWS-Solution-Architect-Associate</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AWS-Solution-Architect-Associate-Encryption-SAA-C03-48/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AWS-Solution-Architect-Associate-Encryption-SAA-C03-48/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Encryption-SAA-C03-Introduction"><a href="#Encryption-SAA-C03-Introduction" class="headerlink" title="Encryption (SAA-C03) Introduction"></a>Encryption (SAA-C03) Introduction</h1><p>Hello, and welcome to this course on encryption with AWS, where we’re here to help you on your journey to prepare for the AWS Certified Solutions Architect - Associate certification. Before we get started, I’d like to introduce myself. My name is Danny Jessee, and I am one of the trainers here at Cloud Academy, specializing in AWS – Amazon Web Services – and AWS certifications.</p>
<p>In this course, the AWS team will be presenting a series of lectures that introduce the various encryption services currently available in AWS that may be covered on the exam.</p>
<p>Feel free to contact me with any questions using the details shown on the screen, or you can always get in touch with us here at Cloud Academy by sending an email to <a href="mailto:&#115;&#117;&#x70;&#x70;&#111;&#x72;&#x74;&#x40;&#99;&#x6c;&#x6f;&#x75;&#100;&#97;&#99;&#97;&#100;&#101;&#x6d;&#x79;&#46;&#99;&#111;&#109;">&#115;&#117;&#x70;&#x70;&#111;&#x72;&#x74;&#x40;&#99;&#x6c;&#x6f;&#x75;&#100;&#97;&#99;&#97;&#100;&#101;&#x6d;&#x79;&#46;&#99;&#111;&#109;</a>, where one of our Cloud experts will reply to your question.</p>
<p>This course has been specifically curated to help you pass the AWS Certified Solutions Architect - Associate exam and is ideal for anyone who is looking to learn more about the various encryption services in AWS in preparation for the exam. The objective of this course is to provide a high-level introduction to the various encryption services in AWS that can assist with securing your sensitive data and secrets, including:</p>
<ul>
<li>The AWS Key Management Service, known as KMS;</li>
<li>CloudHSM, a cloud-based hardware security module that allows you to generate your own encryption keys;</li>
<li>Different encryption mechanisms in S3, including various options for both server-side and client-side encryption; and</li>
<li>How to use AWS Secrets Manager to manage, rotate, and retrieve secrets used within your applications.</li>
</ul>
<p>Together with the other courses in this learning path, we’ll cover all of the key tools, technologies, and concepts from the AWS Certified Solutions Architect - Associate exam guide and ensure that you are fully prepared to sit this exam.</p>
<p>The AWS Certified Solutions Architect - Associate certification has been designed for anyone who has experience designing cloud solutions that use AWS services to meet current and future business requirements, as well as architectures that are secure, resilient, high-performing, and cost-optimized in accordance with the AWS Well-Architected Framework. All of the AWS Cloud concepts introduced in this course will be explained and reinforced from the ground up.</p>
<p>Here at Cloud Academy, we strive to keep our content current to provide the best training available. If you have any feedback, positive or negative, or if you notice anything that needs to be updated or corrected for the next release cycle, please reach out to us at <a href="mailto:&#115;&#117;&#112;&#112;&#x6f;&#x72;&#x74;&#64;&#x63;&#108;&#111;&#x75;&#x64;&#x61;&#99;&#x61;&#x64;&#x65;&#109;&#x79;&#46;&#x63;&#111;&#x6d;">&#115;&#117;&#112;&#112;&#x6f;&#x72;&#x74;&#64;&#x63;&#108;&#111;&#x75;&#x64;&#x61;&#99;&#x61;&#x64;&#x65;&#109;&#x79;&#46;&#x63;&#111;&#x6d;</a>. Thank you!</p>
<h1 id="What-is-KMS"><a href="#What-is-KMS" class="headerlink" title="What is KMS?"></a>What is KMS?</h1><p>Hello and welcome to this lecture where I shall explain what the KMS service is and the function that it provides to enhance your data security. </p>
<p>Before we dive into KMS itself, I want to first provide a high-level overview of encryption to help you understand which cryptography method AWS KMS uses. Unencrypted data can be read and seen by anyone who has access to it and data stored at rest or sent between two locations in transit is known as plain text or clear text data. The data is plain to see and could be seen and understood by any recipient. There is no problem with this as long as the data is not sensitive in any way and doesn’t need to be restricted. However, on the other hand, if you have data that is sensitive and you need to ensure that the contents of that data is only viewable by a particular recipient or recipients, then you need to add a level of encryption to that data. But what is data encryption? </p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">Data encryption</a> is the mechanism in which information is altered, rendering the plain text data unreadable through the use of mathematical algorithms and encryption keys. When encrypted, the original plain text is now known as cipher text which is unreadable. To decrypt the data, an encryption key is required to revert the cipher text back into a readable format of plain text. A key is simply a string of characters used in conjunction with the encryption algorithm and the longer the key the more robust the encryption. This encryption involving keys can be categorized by either being symmetric cryptography or asymmetric cryptography. </p>
<p>AWS KMS only uses symmetric cryptography so let’s take a look at what this is and what this means. With symmetric encryption, a single key is used to both encrypt and also decrypt the data. So for example if someone was using a symmetric encryption method, they would encrypt the data with a key and then when that same person needed to access that data, they would use the same key that they used to encrypt the data to decrypt the data. However, if the encrypted data was being read by a different person, that person would need to be issued the same key. Remember, the same key is needed to decrypt the data that was used to encrypt it. As a result, this key must be sent securely between the two parties and here it exposes a weakness in this method. If the key is intercepted by anyone during that transmission, then that third party could easily decrypt any data associated with that key. </p>
<p>AWS KMS resolves this issue by acting as a central repository, governing and storing the keys required and only issues the decryption keys to those who have <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/understanding-permissions-key-policies/">sufficient permissions</a> to do so. Some common symmetric cryptography algorithms that are used are AES which is Advanced Encryption Standard, DES, Digital Encryption Standard, Triple DES and Blowfish. </p>
<p>Now let’s compare this to asymmetric encryption which involves two separate keys. One is used to encrypt the data and a separate key is used to decrypt the data. These keys are created both at the same time and are linked through a mathematical algorithm. One key is considered the private key and should be kept by a single party and should never be shared with anyone else. The other key is considered the public key and this key can be given and shared with anyone. Unlike with the symmetric encryption, this public key does not have to be sent over secure transmission. It doesn’t matter who has access to this public key as without the private key, any data encrypted with it cannot be accessed. Both the private and public key is required to decrypt the data when asymmetric encryption is being used. So how does it work? </p>
<p>If another party wanted to send you an encrypted message or data, they would encrypt the message using your own public key which can be made freely available to them or anyone. It’s public for a reason. The message is then sent to you where you will use your own private key which has that mathematical relationship with your public key to decrypt the data. This allows you to send encrypted data to anyone without the risk of exposing your private key, resolving the issue highlighted with symmetric encryption. </p>
<p>The advantage that symmetric has over asymmetric is the speed of encryption and decryption. Symmetric is a lot faster from a performance perspective. However, it does carry an additional risk as highlighted. Some common examples of asymmetric cryptography algorithms are RSA, Diffie-Hellman, and Digital Signature Algorithm. So now we know that AWS KSM uses symmetric cryptography for its encryption. Let me explain a little more about the service itself. </p>
<p>The Key Management Service is a managed service used to store and generate encryption keys that can be used by other AWS services and applications to encrypt your data. For example, S3 may use the KMS service to enable S3 to offer and perform server-side encryption using KMS generated keys known as SSE-KMS. There are different types of keys used within KMS which perform different roles and functions. I will go into detail on these key types in the next lecture.</p>
<p>Due to the nature of this service, the contents contain highly sensitive data, the key is to decrypt your private data. As a result, administrators at AWS do not have access to your keys within KMS and they cannot recover your keys for you should you delete them. AWS simply administers the underlying operating system and application. All administrative actions performed by Amazon on the underlying system require dual authentication by two Amazon administrators to make sure the action is correct and will not cause any issues with the service. As AWS has no access to your keys, it’s our responsibility as the customer and users of the KMS service to administer our own encryption keys and administer and restrict how those keys are deployed and used within our own environment against the data that we want to protect. It is important to understand that the KMS service is for encryption at rest only which can include for example S3 Object Storage, RDS, EMR and EBS Encryption to name a few. KMS does not perform encryption for data in transit or in motion. If you want to encrypt data while in transit, then you would need to use a different method such as SSL. However, if your data was encrypted at rest using KMS, then when it was sent from one source to another, that data would be a cipher text which could only be converted to plain text with the corresponding key. </p>
<p>Another important aspect of encryption at rest is whether it is done server-side by the server or client-side by the end user. Examples of server-side encryption are back end servers that encrypt the data as it arrives transparent to the end user such as the example I gave earlier with SSE-KMS. The overhead of performing the encryption and managing the keys is handled by the server, in this case S3, not by the client-side application or the end user. Client-side encryption is quite different. Client-side encryption requires the user to interact with the data to make the data encrypted and the overhead of encryption process is on the client rather than the server. </p>
<p>When working with encrypted data, compliance and regulations are often tightly integrated. As a result, KMS works seamlessly with AWS CloudTrail to audit and track how your encryption keys are being used and by whom in addition to other metadata captured by the APIs used such as the source IP address, et cetera. The CloudTrail logs that are stored in S3 record KMS API calls such as Decrypt, Encrypt, GenerateDataKey and GetKeyPolicy among others as shown on the screen. </p>
<p>When architecting your environment with regards to data encryption, you need to be aware that AWS KMS is not a multi-region service like IAM is for example. It is region specific. Therefore, if you are working in a multi-region system with multi-region failover, you need to establish a Key Management Service in each region that you want to encrypt data. </p>
<p>Now we have a base understanding that KMS generates and provides a secure central repository of encryption keys to allow you to encrypt your data at rest or integrating with numerous AWS services. In the next lecture, I want to expand the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/components-kms/">components that makeup the service</a>.</p>
<h1 id="Components-of-KMS"><a href="#Components-of-KMS" class="headerlink" title="Components of KMS"></a>Components of KMS</h1><p>Hello, and welcome to this lecture where I’m going to drill down into the different elements and components that make up the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">KMS service</a> to allow you to understand how it operates and functions. This section will consist of customer master keys, data keys, or data encryption keys, key policies and grants. </p>
<p>Let me start off by explaining the CMK, the customer master key. This is the main key type within KMS. This key can encrypt data up to 4 kilobytes in size, however it is typically used in relation to your data encryption keys, DEKs. The CMK can generate, encrypt and decrypt these DEKs, which are then used outside of the KMS service by other AWS services to perform encryption against your data.</p>
<p>It’s important to understand that there are two types of customer master keys. Firstly, those which are managed and created by you and I, as customers of AWS, which can either be created by using KMS or by importing key material from existing <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/key-management/">key management applications</a> into a new CMK. And secondly, those that are managed and created by AWS themselves. The CMKs which are managed by AWS, are used by other AWS services that have the ability to interact with KMS directly to perform encryption against data. For example, Amazon S3, in particular, SSE KMS, these AWS managed keys can only be used by the corresponding AWS service that created them within a particular region. As remember, AWS KMS is a regional service. </p>
<p>These CMKs that are used by the services, are generally created the first time you implement encryption using that particular service. CMKs that are generated and created by us, rather than AWS, provide the ability to implement greater flexibility, such as being able to manage the key, including rotation, governing access and key policy configuration, along with being able to both enable and disable the key when it is no longer required. Now there is a big difference between disabling a CMK and deleting a CMK, which can have significant effect on being able to access your data, governed by the CMK that encrypts it. I shall discuss more on these differences in an upcoming lecture, where I’ll talk about key management. </p>
<p>Like the AWS managed CMKs, AWS services can be configured to use your own customer CMKs, too. Depending on the service and your own internal security policies, the choice is yours as to which CMK the supported services uses to encrypt your data. Any CMKs created within KMS are protected by FIPS, validated cryptography modules. As I mentioned in the previous few slides, data encryption keys, or data keys, are created by the CMK and are used to encrypt your data of any size. When a request to generate a key is issued, the CMK specified in the request will create a plain text data encryption key and an encrypted version of the same data encryption key. Both of these keys are then used to complete the encryption process. As a part of this process, your plain text data is encrypted with the plain text data key using an encryption algorithm. Once encrypted, the plain text data is deleted from memory and the encrypted data key is stored alongside the encrypted data. If anyone gains access to the encrypted data, they will not be able to decrypt it, even if they have access to the encrypted key, as this key was encrypted by the CMK, which remains within the KMS service. This process of having one key encrypted by another key is known as envelope encryption. The only way you would be able to decrypt the object is if you have the relevant decrypt permission for that CMK that the data keys are associated to. </p>
<p>Let me explain the process of how these data keys are used with the CMK outside of KMS, such as S3. And I shall stick with the example of SSE KMS, server side encryption, using KMS keys.</p>
<h3 id="Start-of-SSE-KMS-Sketch-Demonstration"><a href="#Start-of-SSE-KMS-Sketch-Demonstration" class="headerlink" title="Start of SSE-KMS Sketch Demonstration"></a><em><strong>Start of SSE-KMS Sketch Demonstration</strong></em></h3><p>Hello, and welcome to this Cloud Academy sketch video. I’m going to be talking about S3, and in particular, server side encryption with KMS, which is the key management service. So I’m going to show you how the process works from both an encryption point of view and also decryption. Let’s start by creating our user over here. And let’s call our user Bob, keep it nice and simple. </p>
<p>Now, Bob has a document that contains sensitive information. So when he stores it on his S3 bucket, he wants to make sure it’s encrypted, and he’s going to select server side encryption using KMS. So S3 will handle the encryption process for him using keys that are generated by the KMS service. So when he uploads it to his S3 bucket, he specifies that he wants to use SSE KMS. At this point S3 realizes that it needs to invoke services from the KMS service. So it calls upon KMS to generate some data keys for us. So it then sends a request over to KMS. At this point, KMS uses the customer master key, the CMK, to generate two keys. Now the first key is just a plain text data key, and the second key that’s generated is the same key but an encrypted version of that key. </p>
<p>Now both of these keys are then sent back to S3. So S3 receives both those keys, both the plain text key and the encrypted data key. Now S3 has all the keys it needs to perform the encryption process. So S3 will take the object uploaded by Bob, which is his document. It will then combine this with the plain text data key, and it will perform an encryption algorithm, and then that will generate an encrypted version of Bob’s document. So now his document is encrypted. And S3 will store and associate the encrypted data key alongside this object. So these two objects are then stored on S3. Meanwhile, the plain text data key is then deleted from memory. So that’s how encryption works using SSE KMS. </p>
<p>So just to recap. The end user or client will upload the object to S3, specifying that SSE KMS should be used. S3 will then contact KMS, and using the specified CMK, it will generate two data keys, a plain text data key and an encrypted version of that data key. Both of these keys are then sent back to S3, at which point S3 can then encrypt the object that was uploaded, using the plain text data key, to generate an encrypted version of your object. And then S3 will associate and store the encrypted data key alongside your encrypted object. </p>
<p>Okay, so let’s now look at how the decryption process works. So if we just get rid of some of this detail. So Bob will request the object from S3. At this point, S3 knows that the object is encrypted and it has the associated encrypted data key. So what it does, it sends that associated encrypted data key over to KMS, and it asks KMS to generate a plain text data key. So what it’ll do, it’ll use the same CMK plus the encrypted data key. And this will generate a plain text version of that data key. Now just this single plain text data key is then returned to S3. At this point, S3 can then access the encrypted object and use the plain text data key that it just got back from KMS, perform an encryption algorithm again to decrypt the object. And this will generate a plain text version of the object, at which point this can then be returned to Bob. </p>
<p>So just to recap. The user will request access to the encrypted object. S3 will then send the associated encrypted data key to KMS, to generate a plain text version of that encrypted data key, using the associated CMK. This plain text data key is then sent back to S3. The plain text data key is then used to decrypt the encrypted object, generating a plain text version of the object, which can then be returned to the user. So that’s how the encryption process works for S3, SSE KMS. Thank you.</p>
<h3 id="End-of-SSE-KMS-Sketch-Demonstration"><a href="#End-of-SSE-KMS-Sketch-Demonstration" class="headerlink" title="End of SSE-KMS Sketch Demonstration"></a><em><strong>End of SSE-KMS Sketch Demonstration</strong></em></h3><p>The key policy is a security feature within KMS that allows you to define who can use and access a particular key within KMS. These policies are tied to the CMKs, making these resource-based policies, and different key policies can be created for different CMKs. These permissions are defined within this key policy document, which is JSON-based, much like IAM policies are. I will cover key policies in far greater depth in the next lecture, when <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/understanding-permissions-key-policies/">I discuss permissions </a>and access control. </p>
<p>Grants are another method of controlling access and use of the CMKs held within KMS. Again, they are a resource-based policy, but they allow you to delegate a subset of your own access to a CMK for principals, such as another AWS service within your AWS account. The benefit of this is that there is less risk of someone altering the access control permissions for that CMK. If anyone has the KMS put key policy permission, then they could simply replace the key policy with a different one. Using grants eliminates this possibility, as a grant is created and applied to the CMK for each principle requiring access. Again, coming up in the following lecture, I shall dive deeper into grants and how they work. </p>
<p>That now brings me to the end of this lecture, which leads me nicely onto permissions and access control within KMS. And I shall look at key policies and grants in greater detail.</p>
<h1 id="Understanding-Permissions-amp-Key-Policies"><a href="#Understanding-Permissions-amp-Key-Policies" class="headerlink" title="Understanding Permissions &amp; Key Policies"></a>Understanding Permissions &amp; Key Policies</h1><p>Hello and welcome to this lecture where I will be diving deeper on how to secure access to your KMS keys and associated levels of permission. </p>
<p>With many services that you use within AWS, you can control access using IAM policies whether that is against a user, group, role or even a federated user. The point is access control for most services can be completely controlled and governed by using IAM alone. For KMS however, this is not the case. In all cases, to manage access to your CMKs, you must use a key policy. Without a key policy associated to your CMK, users will not be able to use it. </p>
<p>Permissions to allow you to access and use your CMK can’t be given and generated using IAM alone. As a result, there are a number of different ways in which you can control access to your keys in KMS, just by using key policies, using key policies with IAM, and using key policies with grants. Let me run through each of these options starting with key policies. </p>
<p>As I briefly mentioned <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/components-kms/">in the previous lecture</a>, key policies are resource based policies which are tied to your CMK. And if you want a principal to be able to access your CMK, then a key policy must be in place to do so. The key policy document itself is JSON based much like IAM policies are and the document syntax is much like other IAM policies. They contain elements such as resource, action, effect, principal and optionally conditions. As a result, they typically look like the following. </p>
<p>During the creation of a CMK, whether you create it programmatically or if you create it through the AWS Management Console, either way KMS will create a default key policy for you to allow principals to use the CMK in question as remember a key policy is required for all CMKs. Within both of these default key policies, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">KMS</a> will configure the root of the AWS account full access to the CMK, by doing so ensures that the CMK will never become unusable as it’s not possible to delete the root account. If full access of the CMK was given to another user and then that user was deleted from IAM, it would not be possible to manage the CMK unless you contacted AWS support to regain the control required. Also, by allowing the root account full access to the CMK performs another important and useful function. It allows access to be given to the CMK by normal IAM policies for users and roles, etc. That’s why it’s not possible to allow users access to a CMK without a key policy. Without the root account having full access in the key policy, IAM can’t be used to manage access for other users. </p>
<p>Within the key policy, this section would look as follows. The resource section shows an asterisk which essentially means this CMK that the key policy is being applied to. When you create your CMK through the Management Console, then you have the chance to configure different permission sets. These include key administrators of the CMK and users which are allowed access to the CMK. </p>
<p>You’ll be asked to firstly define the key administrators. These can either be users or roles that you have setup and configured within IAM. These principals can only administer the CMK and not use it to perform any encryption function that may be needed within the CMK. The administrative actions that are allowed by the key admins are shown on screen. During the selection of key admins, you can also specify if you would like them to be able to delete the key via a checkpoint option. An important point to bear in mind is that although these key administrators do not have access to use the CMK, they do have access to update the associated key policy. As a result, if they wanted to, they could give themselves access to use the CMK. </p>
<p>Next you’ll be asked which users you want to allow to use the CMK. And by use, it’s essentially asking which users should be allowed to perform any encryption using the CMK. In addition to these permissions, the users associated will also be able to use grants to delegate a subset of their own permissions to another service which integrates with KMS. For example, if you are attaching an encrypted EBS volume to an EC2 instance, then through the use of grants, you as the key user of the CMK which encrypted the EBS volume implicitly give permission to EC2 to be able to attach that encrypted EBS volume. Within the key policy, the grant permissions look as follows. For every user or role selected as a user of the key will be displayed within the principal section. As you can see from this example, the only user currently selected for this key is Cloud Academy. The permissions given to use the key for any user selected are as follows. </p>
<p>As the key policy uses the same syntax as IAM policies, you can also restrict access to the CMK in the same way that you can restrict access to resources via the Effect element. Instead of using the Effect Allow, you can instead restrict and deny a particular user access to a CMK by specifying the Effect as deny. As mentioned, we can also use key policies in conjunction with IAM policies, but only if you have the following entry within the key policy allowing the root full KMS access to the CMK, by doing so enables you to centralize your permissions administration from within IAM as you would likely be doing for many other AWS services. This would mean you can configure your IAM policies to allow users, groups and roles to perform the encryption and decryption process, for example using the KMS Encrypt and KMS Decrypt permissions. </p>
<p>Using the resource component within the policy, you can also specify which CMKs the user, group or role can use to perform the encryption and decryption process. In this example, we can see that the policy will allow the identity associated with the policy to use two different CMKs to encrypt and decrypt data. The first CMK is within the US-East-1 region and the second CMK is within the EU-West-2 region. </p>
<p>Finally, you can assign permissions using grants alongside key policies. I’ve mentioned grants a couple of times already, but in essence, they allow you to delegate your permissions to another AWS principal within your AWS account. Much like the key policy, grants are another resource based method of access control to the CMKs. The grants themselves need to be created using the AWS KMS APIs. It’s not possible to create them using the AWS Management Console and these grants are then attached to the CMK, much like key policies are. Within the key policy of the CMK, you will see the Sid which allows the users of the CMK to also perform three grant actions, kms:CreateGrant, kms:ListGrants and kms:RevokeGrant. </p>
<p>When issuing the CreateGrant API, a number of different parameters are also issued such as the CMK identifier. The grantee principal to gain the permissions and the required level of operations that the grantee can perform include the following on screen. Once the grant is active, the principal or grantee can then adopt the permissions programmatically based on the level of access provided within the grant. Also, after the grant has been created, a GrantToken and a GrantID is issued. When a grant is created, there may be a delay in being able to use the permissions and this is due to the fact that eventual consistency has to take place. To get around this, you can use the GrantToken with some APIs which would allow the grantee to perform the operation specified within the grant with immediate effect without having to wait for eventual consistency to complete.</p>
<p>I gave an example earlier relating to EC2 and EBS whereby another AWS service can use grants to gain access to and use a CMK. I will now provide a demonstration of how the grantee of a grant can be an IAM user to show how grant permissions work. </p>
<h3 id="Start-of-demonstration-1"><a href="#Start-of-demonstration-1" class="headerlink" title="Start of demonstration 1"></a>Start of demonstration 1</h3><p>Okay so for this demonstration, we’re going to use two different users, one user that has access to user CMK and create grants and another user that has no IAM policies at all and isn’t explicitly allowed access within the CMK policy either. So let’s go ahead and take a look at the CMK we’re going to be using first. Go down to encryption keys and we’re going to be using this demo key. If we have a look at the policy of this CMK, scroll down and take a look, then we can see that the users within this policy are listed here and we have a user called Alice and Alice can also create grants as well as we can see down here and here’s the permission CreateGrant. So we’re going to be using the user Alice. </p>
<p>So let’s now create an entirely new user with no permissions at all. We’ll call this user Bob. We’ll give them programmatic access because we’ll be using the AWS CLI for this demonstration. We won’t create any permissions or attach them to any groups. And as we could see here, the user has no permissions. Create user and we have their access key here and their secret access key. </p>
<p>So what I’m going to do now I’m going to swap across to my terminal and I’m going to set them up a profile on my AWS CLI. Okay so what I need to do is type in aws configure –profile of Bob and this will ask us for the access key ID so we can copy and paste that in and the same for the secret access key ID. It will then ask us for the default region name. Our CMK is in us-east-1 so it’ll accept that as the default and also the default output format. So now we have two users, Alice and Bob, and Alice is already setup as a profile on the CLI and we’ve just setup Bob as well. As we know, Bob doesn’t have any permissions within the key policy of the CMK and he doesn’t have any permissions within IAM either. </p>
<p>So let’s just do a quick test with Bob. We’ll try and encrypt something using the CMK ID and it will fail so let’s just take a look at that. So if I type in aws kms encrypt using plaintext and we’ll encrypt CloudAcademy using the key-id alias of DemoKey which is the name of my CMK using the profile of Bob and there we can see an error has occurred access denied. That’s because Bob doesn’t have any encrypt permissions. So if we do the same but this time with Alice, so if we change the profile to Alice, then we can see that it has encrypted the file using this CiphertextBlob here. So that file is now encrypted and Alice can do it because she is listed as a user within the key policy for that CMK. </p>
<p>Okay, let me just clear the screen. So now what I want to do is use grants to allow Bob access to encrypt and decrypt data and this would be issued by the user Alice. So the command to do this is as follows so it’s aws kms create-grant using the key-id and we need the ARN of our key here so if we just go across, select our CMK, we have our ARN here so paste that in. We’ll then need to add the grantee-principal and this will be the person who is actually going to gain this access and again we need the ARN of the user. I’ll go ahead and find Bob, copy his ARN, paste that in. Then we need to specify the operations which is the actual access that’s going to be given so we’re want to grant encrypt and decrypt access and this is going to be issued by the profile of Alice. So Alice is using grants to allow Bob to give access of encrypt and decrypt which is access that Alice has. And we could see that that now works. </p>
<p>We now have a GrantToken and also a GrantId as well. And we can use this information to then perform encryption and decryption straight away using the user Bob. So let me now show you how that works. So now we have the GrantToken and the GrantId. What we can do is encrypt or decrypt data. So let’s go ahead and try and encrypt a new file with Bob’s profile. So to do this we type in aws kms encrypt –plaintext and “Friday”. We add the key-id. We have the key-id up here so I’ll just copy and paste that. And then we need to issue the grant-tokens and here I need to add in the GrantToken that was generated which is this block of text so I’ll paste that in. And then finally because we want to encrypt with Bob, we’ll need to add Bob’s profile at the end. As we can see, we have successfully encrypted that file of Friday. So whereas before Bob was unable to encrypt, we have now used the GrantToken which was generated by Alice to allow Bob access to encrypt data. </p>
<p>So just to run through what we’ve done in this demonstration, we had Alice who is a user within the key policy of a CMK. We then created a new user Bob who had no IAM policies attached and he wasn’t listed within the key policy. We then tested that Bob wasn’t able to encrypt anything. We then confirmed that Alice could. We then created a grant using Alice’s profile allowing access to Bob for encrypt and decrypt and there are other permissions there as well such as generate data keys, etc. We just allowed encrypt and decrypt. We then used the GrantToken that was generated from the create-grant to allow Bob to encrypt a file using the new permissions that he gained through the grant. So once you understand the methodology of how you can grant these additional permissions, it’s a fairly simple process to go ahead and allow other principals to use the CMK based on the permissions that you have. </p>
<h3 id="End-of-demonstration-1"><a href="#End-of-demonstration-1" class="headerlink" title="End of demonstration 1"></a>End of demonstration 1</h3><p>I now want to show you how to create a CMK using the Management Console from scratch and what the final key policy looks like and how key administrators, users and grants all fit in. </p>
<h3 id="Start-of-demonstration-2"><a href="#Start-of-demonstration-2" class="headerlink" title="Start of demonstration 2"></a>Start of demonstration 2</h3><p>Okay so I’ve just logged in to my AWS account and first of all I’ll need to go to Identity and Access Management which is where KMS can be found. And if we go down the left-hand side on the menus down to encryption keys and this is essentially KMS. This is the KMS function within IAM. Now to create a new CMK, we go up to the blue button here that says create key and we need to add an alias and a description so I’m just going to call this DemoKey and description This is a demo. If we click on advanced options, here we can see different key material origins and I’ll talk more about the difference between KMS and external origins in the following lecture. So for this demonstration, I’m just going to select the key material origin of KMS and this will allow KMS to generate the key material. If we click on next step, here we can add tags. For this demonstration, I’m just going to leave them as blank. </p>
<p>And now it’s asking us to define the key admins, so essentially who should be the administrators of these keys. And remember as I explained earlier, the key administrators aren’t actually able to use the CMK to encrypt and decrypt data. So let me just pick a couple of users here, go down to the next step, and now it’ll ask me to define the users of the CMK. So these are the identities that can actually perform encryption and decryption using this CMK. So again I’ll just pick a couple of users, click on next step, and now we can look at the key policy that’s being created based on the parameters that I have selected. </p>
<p>So if we look at the different sections here, firstly this Sid Enable IAM User Permissions so what we have here is an Allow for the root account or KMS access to this particular CMK. So as I discussed earlier, this entry within the policy ensures that you can use IAM policies to govern access to this CMK. If we scroll down, the next section shows the key administrators for this CMK and here are the two identities that I selected. And if we look at the actions, we can see a number of different KMS actions, but there is no kms:Encrypt and no kms:Decrypt because the key administrators aren’t actually able to use the key for encryption. We scroll down to the next section of the policy and this section defines the actual users of the policy so whoever is listed here under the principal section can actually use this CMK to encrypt data and decrypt data. And if we look at the actions, we can see here kms:Encrypt and kms:Decrypt and GenerateDataKeys, etc. Whereas you’ll find that these permissions aren’t actually within the administrator list. As you can see, there’s no kms:Encrypt. So that’s the users of the CMK. And finally, this section relates to grants. So this also allows whoever has been added to the user section above, which are these two accounts here, it allows them to create grants and generate grants for the CMK. And then if we click on finish, that’s it. </p>
<p>The CMK is created and we can see here that the status is enabled. And if we click on the DemoKey, it would just bring up some different information. So we have the ARN of the key itself. We can see that the status is enabled. And if we scroll down, we can see the key administrators. And there’s a checkbox here that allows the key administrators to delete this key. If you don’t want a key deleted, then you can simply uncheck that box. Scroll down further, we can see the users of the key as well. Any tags that you added would also be there. And that’s it, it’s as simple as that. So it’s a very simple method to create your CMK, give it a name, add any tags that you need, add the key administrators, add the users, and then select finish, and then you will have your CMK. </p>
<h3 id="End-of-demonstration-2"><a href="#End-of-demonstration-2" class="headerlink" title="End of demonstration 2"></a>End of demonstration 2</h3><p>The overall access of understanding who has access to a CMK in KMS can be a little confusing as there are three potential ways of gaining access and using a CMK, through the key policy, with IAM policies and also Grants. And determining the correct level of access means you need to understand how they all work together. So let’s look at a simple example to ensure we understand some key points. In this scenario, we have three CMKs and four users. </p>
<ul>
<li>CMK-A key policy provides access to the root account which as we know also enables IAM policies to be used in conjunction with the key policy. </li>
<li>CMK-B key policy allows access to Bob and Charlie. </li>
<li>CMK-C key policy provides access to the root account. Access is explicitly denied for Bob, Charlie and David, but full access is given to Alice. </li>
<li>Alice’s IAM policy allows all KMS actions to CMK-A and CMK-B. </li>
<li>Bob has no IAM policy</li>
<li>Charlie’s IAM policy allows KMS encrypt access to CMK-A </li>
<li>and David’s IAM policy allows all KMS actions to CMK-B and CMK-C.</li>
</ul>
<p>So let’s now look at each of these user’s access and what they have access to, starting with Alice. </p>
<p>Alice’s access to CMK-A is successful as her IAM policy allows all KMS actions against CMK-A and CMK-A allows for IAM policies to be used. Her access to CMK-B provides no access as the key policy for this CMK does not allow for IAM policies to be used. And her access to CMK-C is successful as the key policy allows her access despite her having no IAM policy relating to permissions. </p>
<p>Now let’s take a look at Bob. His access to CMK is denied as there are no explicit entries in the key policy for Bob’s access and he has no IAM policy. His access to CMK-B is successful as the key policy allows him access despite him having no IAM policy relating to permissions and access is denied to CMK-C due to explicit deny actions within the key policy and an explicit deny will always overrule any other allow. </p>
<p>Now let’s look at Charlie’s access. For CMK-A, he has encrypt access only which is given through his IAM policy and IAM policy permissions are allowed. For CMK-B, access is also successful as the key policy allows him access. His IAM policy permissions are irrelevant as the CMK does not allow for IAM policies to be used. And his access to CMK-C is denied due to the explicit deny actions within the key policy and an explicit deny will overrule any other allow. </p>
<p>And finally David’s access. He has no access to CMK-A as neither the key policy or his IAM policy provides permissions. He has no access to CMK-B as the key policy for this CMK does not allow for IAM policies to be used and access is also denied to CMK-C due to explicit deny actions within the key policy. </p>
<p>That now brings me to the end of this lecture covering access control permissions for KMS. Coming up next, I shall be looking at <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/key-management/">key management within KMS</a>.</p>
<h1 id="Key-Management"><a href="#Key-Management" class="headerlink" title="Key Management"></a>Key Management</h1><p>Hello and welcome to this lecture where I shall be explaining how to manage your keys within KMS. I will look at rotation of CMKs, How to import key material from an existing key management system outside of AWS, and the deletion of CMKs. So let me start off by looking at how rotation works within your CMKs. </p>
<p>Firstly, why do we need to rotate keys? The simple answer is for security best practice reasons. Largely, the longer the same key is left in place, the more data is encrypted with that key, and if that key is breached, then the wider the blast area of data is at risk. In addition to this, the longer the key is active, the probability of it being breached increases. </p>
<p>The simplest method of rotating keys is to use automatic key rotation, whereby KMS will automatically rotate your keys every 365 days. But what does that mean, exactly? When automatic key rotation is enabled, many of the details of the CMK remain the same, such as the CMK-ID and the ARN, along with any <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/understanding-permissions-key-policies/">associated permissions and policies</a>. The only thing that changes is the backing key of the CMK. This backing key is the fundamental cryptographic element that is used when the encryption process is taking place. During the rotation, older backing keys are retained to decrypt data that was encrypted prior to this rotation. </p>
<p>One important point to bear in mind is that should a breach of the CMK occur, rotating the key would not remove the threat of that breach. Consider the following scenario. You have encrypted 100 objects which are stored on S3, using SSE-KMS with a customer-managed CMK. It has been made apparent that a breach of your cryptographic material, of your CMK, has occurred, and you decide to rotate the key. As we now know, rotating the key simply creates a new backing key, and retains the older key to allow you to continue to decrypt existing data, encrypted by the original backing key. So by rotating the key, doesn’t prevent the malicious user from decrypting the 100 objects. However, by rotating the key, it does stop them from decrypting any future encryptions of objects, as it now has a new cryptographic material of the backing key. </p>
<p>There are a couple of points to bear in mind when it comes to automatic key rotation. Firstly, Automatic key rotation is not possible with imported key material, and secondly, the key rotation happens every 365 days and there is no way to alter that time frame. If these two points are an issue, then the only solution is to perform a manual key rotation, which would give you greater flexibility and control of how and when you perform rotations of your keys. If your CMK is the state of disabled or pending deletion, then KMS will not perform a key rotation. If the key is re-enabled, or if the deletion process is canceled, then KMS will assess the age of the backing key, and if that key is older than 365 days, the automatic key rotation process will rotate the key immediately. </p>
<p>One final point on automatic key rotation is that it’s not possible to manage the key rotation for any AWS managed CMKs. These are by default rotated every 1095 days, which is essentially three years. Let me now look at manual key rotation, and how this differs from automatic key rotation.</p>
<p>The process of manual key rotation requires a new CMK to be created, which is different from the automatic process. By doing so, a new CMK-ID is created along with a backing key. As a result, if you have any applications that reference the CMK-ID of the old key, you will need to update them and point them to the new CMK-ID. To make things easier in this process, you could use alias names for your keys, and then simply update your alias target to point to the new CMK-ID. To do this, you can use the update alias API, as shown here. </p>
<p>Once you have performed a manual key rotation, you should keep any CMKs that were used to encrypt data before it, as KMS will use the same CMK that it did to encrypt it. So, for example, let’s say you had a document A encrypted with CMK-A, using the backing key of that CMK to perform the cryptographic mechanism. You then performed a manual key rotation to comply with your own internal security policies. In doing so, a new CMK was created, CMK-B, and this CMK then encrypted document B. You then deleted or disabled CMK-A. When Alice tries to retrieve document A in plain text format, the operation fails. This is because <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">KMS</a> knows which CMK was used to encrypt the object, and it must use the same CMK to decrypt it. However, if it is disabled or deleted, then this is not possible. To resolve this issue, the older CMKs must remain active. </p>
<p>When I was just talking about key rotation, I mentioned that it’s not possible to perform automatic key rotation of imported key material, but what is this key material? Key material is essentially the backing key, the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/components-kms/">component</a> that completes and implements the encryption and decryption process on behalf of the CMK itself. When customer-managed CMKs are generated and created within KMS, the key material is automatically created for the CMK. However, it is possible to create CMKs without any key material at all. This is done by selecting the External option for the Key Material Origin, under the Advanced Options of the Create Alias and Description page of the CMK creation within the management console. By doing so, you can still create a CMK which will have its own ARN and CMK-ID. However the actual key material for the CMK can then be imported from your own key infrastructure that you may be using with your own on-premise material that you have already been using. When using your own key material, it becomes tied to that CMK, and no other key material can be used for that CMK. This is why it’s not possible to enable automatic key rotation, as only this single backing key or key material can ever be used for that CMK. </p>
<p>The process for importing your own material follows four key points. The first is, as I have already mentioned, creating your CMK with no key material generated by KMS by selecting External for your key origin. Following this, you will then be asked to download a wrapping key, which is also referred to as a public key, and an import token. This wrapping key is to allow you to upload your key material in an encrypted form. When you import your key material, you do not want this to be in plain text format, So AWS KMS provides a means of encrypting it with this public&#x2F;wrapping key. During this step, you will be asked to select an encryption algorithm. The options for this are as shown. AWS recommends that you select option A that’s shown if possible. If not, then to use option B, and lastly, C. The wrapping key then uses this method of encryption to encrypt your key material before it’s uploaded. The import token that is downloaded is used as a part of the import process when uploading your encrypted key material, to ensure that the process completes correctly. Both the wrapping key and the import token is only active for 24 hours once you have downloaded it, so you need to ensure that you complete the process within this timeframe, otherwise you will need to complete this step again, and download a new key and import token. </p>
<p>Once you have downloaded the wrapping key and import token, you are then ready to encrypt your key material that you’ve extracted from your own key management system or hardware security module. One point regarding this step is that the key material must be in a binary format to allow you to use the wrapping key. For detailed information on the commands to carry out this step, you can visit the following <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/kms/latest/developerguide/importing-keys-encrypt-key-material.html">link</a>. The final step is to actually import your key material that is now encrypted into KMS and to associate it with your currently empty CMK. This step can be performed programmatically, or from within the AWS Management Console, whereby you need to select your CMK, and select to import the key material. At this point, you would then be prompted for the location of the key material, along with the location of the import token. Optionally, you also have the option of setting an expiration of the key material being imported. If you do set an expiry, CMK would cease to operate when this expires. To activate the CMK again, you would need to re-upload the key material, following steps two to four. </p>
<p>There are some considerations of using your own key material that differ from key material generated by KMS, which is largely down to durability and availability. The key material created by KMS for customer-managed CMKs receives a far higher durability and availability than that of your own key material that has been imported. For example, it’s not possible to set an expiration time with key material generated by KMS, but you can for your own imported material. When this expires, the key material is deleted, but the CMK and metadata of that CMK is retained. Also, if a region-wide failure occurred where your keys were being used and stored, you would need to ensure that you had the key material to import back into the CMK, as KMS would not be able to retain this information. </p>
<p>I now want to talk about the process involved with deleting CMKs. When you no longer have a need or requirement for a particular CMK, you may want to delete it for security best practices and general housekeeping of your key infrastructure. Deleting a key, of course, can have significant impact against your operations and data if there are services that are still using it without your knowledge. To help in this scenario, KMS enforces a scheduled deletion process, which can range from seven to 30 days. When a key is scheduled for deletion, the CMK is taken out of action and put in a state of Pending deletion. When a key is in this state, it can’t be used to perform any encryption or decryption actions, neither can the backing keys for the CMK be rotated. You could also analyze AWS CloudTrail event logs to look for events relating to the use of your CMK, such as an encrypt action against the CMK-ID. </p>
<p>AWS also recommends that you set up a Cloudwatch alarm to identify if anyone tries to use this key to perform an encryption or decryption request. This will help you identify if it is, in fact, still in use, allowing you to cancel the deletion. Details on how to configure this can be found using the <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/kms/latest/developerguide/deleting-keys-creating-cloudwatch-alarm.html">link</a> on screen. If you are not confident that your CMK is no longer in use, or that it should be deleted, then you can simply disable the CMK. Again, this will change the key to a state of disabled and prevent it from being used, and, again, prevent the backing key from being rotated. If you are using a CMK which has your own key material imported, then you can delete just the key material from the CMK, as well as having the option of deleting the entire CMK. </p>
<p>I’m now going to perform a quick demonstration to show you how to schedule a deletion of a CMK, and how you can disable and re-enable CMKs via the AWS Management Console. </p>
<h3 id="Start-of-demonstration"><a href="#Start-of-demonstration" class="headerlink" title="Start of demonstration"></a>Start of demonstration</h3><p>Okay, so for this demonstration, I’m going to show you how to schedule a deletion of a CMK, and then also how to disable and re-enable a CMK. So, again, if we go to IAM. Go down to Encryption keys, which is essentially where KMS lives, and as you remember from the demonstration earlier, where we created the DemoKey, so now I’m going to schedule a deletion for this key. </p>
<p>So if I select the key, and go across to Key actions, and then down to Schedule key deletion, now here you can enter a waiting period between seven and 30 days, so the minimum is seven and the maximum is 30 days. So this will give you a buffer to ensure that you do actually want to delete this key, and give you enough time to ascertain and see if it’s still in use. So, let’s just put in seven days there, go down to Schedule deletion. And we can see here, that the Status is now changed to Pending Deletion. So it won’t be possible to use this CMK anymore, and it won’t be rotated either. </p>
<p>If you change your mind, and you don’t want this CMK deleted, you can just select it again, go to Key actions, and Cancel key deletion. You’ll see at this stage that it puts the key in this state of Disabled, so what you need to do, again, is to select the key, go to Key actions, and simply Enable the key and then it will be fully operational again, and you can use that CMK to encrypt and decrypt data. </p>
<p>You may have noticed in the Key actions there, let me just select the key once more, to Disable the key, there’s an option there, so we can just go ahead and Disable that, and you can see that the Status has changed, and, again, if you need to re-enable it, just simply click on Enable. So to disable and enable the key is very simple, simply selecting the CMK and then just selecting the appropriate option from the Key actions box. And that’s it, so that’s how you can schedule a deletion for your CMK and also disable and enable the key as required.</p>
<h3 id="End-of-demonstration"><a href="#End-of-demonstration" class="headerlink" title="End of demonstration"></a>End of demonstration</h3><h1 id="Sharing-CMKs-Across-Multiple-AWS-Accounts"><a href="#Sharing-CMKs-Across-Multiple-AWS-Accounts" class="headerlink" title="Sharing CMKs Across Multiple AWS Accounts"></a>Sharing CMKs Across Multiple AWS Accounts</h1><p>Hello and welcome to this lecture, focusing on KMS permissions and key policies. Before I begin, I just want to highlight a couple of key components within KMS. Firstly, the Customer Master Key is known as the CMK. The CMK is the main key type within KMS and can generate, encrypt and decrypt data encryption keys known as the DEKs, which are used outside of the KMS service by other AWS services to perform encryption against your data. </p>
<p>CMKs can either be managed by AWS or by you and me as customers of AWS. CMKs managed by AWS are used by other AWS services that have the ability to interact with KMS directly to perform encryption against data. For example, Amazon S3, in particular, SSE-KMS, which is server-side encryption using the Key Management Service. CMKs that are created and generated by you and I rather than AWS provide the ability to implement greater flexibility, such as being able to manage the key including rotation, governing access and key policy configuration, along with being able to both enable and disable the key when it is no longer required.</p>
<p>With many services that you use within AWS, you can control access using identity-based access IAM policies. However, KMS also uses resource-based policies when it comes to CMK access. If you want to allow other IAM users or roles in a different AWS account in which a CMK was created, then you must understand how KMS permissions work. In all cases, to manage access to your CMKs, you must use a key policy. Without a key policy associated to your CMK, users will not be able to use it. Permissions to allow you to access and use a CMK from a different AWS account can’t be given and generated using IAM alone. As a result, you have to use and edit a resource-based key policy in the AWS account where the CMK resides, in addition to an IAM identity-based policy in the AWS account that wants to access the CMK. One point to remember is that you can only edit key policies for keys that you have created. So you can’t share AWS managed CMKs between accounts.</p>
<p>Key policies are resource-based policies that are tied to your CMK. And the key policy document itself is JSON-based, much like IAM policies. As a result, they typically look like the following. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">  &quot;Statement&quot;: [&#123;</span><br><span class="line">    &quot;Sid&quot;: &quot;statement identifier&quot;,</span><br><span class="line">    &quot;Effect&quot;: &quot;effect&quot;,</span><br><span class="line">    &quot;Principal&quot;: &quot;principal&quot;,</span><br><span class="line">    &quot;Action&quot;: &quot;action&quot;,</span><br><span class="line">    &quot;Resource&quot;: &quot;resource&quot;,</span><br><span class="line">    &quot;Condition&quot;: &#123;&quot;condition operator&quot;: &#123;&quot;condition context key&quot;: &quot;context key value&quot;&#125;&#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>During the creation of a CMK, whether you create it programmatically or if you’ve created it through the AWS Management Console, KMS will create a default key policy for you to allow principles to use the CMK in question. By default, KMS will configure the root user of the AWS account in which the key was created full access to the CMK within the key policy. </p>
<p>When you create a CMK through the Management Console, then you can configure different permissions sets. These include key administrators and users. Key administrators can only administer the CMK, but not use it to perform any encryption functions. Whereas users have the ability to access the CMK to perform encryption of data. The permissions that can be given to use the key for any user selected, are as follows. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kms:Encrypt</span><br><span class="line">kms:Decrypt</span><br><span class="line">kms:ReEncrypt*</span><br><span class="line">kms:GenerateDataKey* </span><br><span class="line">kms:DescribeKey</span><br></pre></td></tr></table></figure>

<p>So the first step in allowing the sharing of your CMK across AWS accounts is to add the principles from the external account into the key policy of the CMK. To do so, you will need to add a statement as shown where the text embed should be replaced with the external AWS account number.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;Sid&quot;: &quot;Allow another AWS Account to use this CMK&quot;,</span><br><span class="line">    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">    &quot;Principal&quot;: &#123;</span><br><span class="line">        &quot;AWS&quot;: [</span><br><span class="line">            &quot;arn:aws:iam::123456789012:root&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Action&quot;: [</span><br><span class="line">        &quot;kms:Encrypt&quot;,</span><br><span class="line">        &quot;kms:Decrypt&quot;,</span><br><span class="line">        &quot;kms:ReEncrypt*&quot;,</span><br><span class="line">        &quot;kms:GenerateDataKey*&quot;,</span><br><span class="line">        &quot;kms:DescribeKey&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;Resource&quot;: &quot;*&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You could create this key policy statement with even more granularity by limiting the specific actions required, or by specifying individual users or roles. For example, instead of using the root of the external account and the principal parameter, you could add an IAM user named Bob. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;Principal&quot;: &#123;</span><br><span class="line">   &quot;AWS&quot;: [</span><br><span class="line">     &quot;arn:aws:iam::123456789012:user/Bob&quot;</span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<p>Once this statement is added to the key policy, the users within the account would still not be able to use the CMK until IAM permissions in the external account have been added to specific users or roles. And once the key policy has been edited to allow either the external account or specific users or roles from the external account access to a CMK, identity-based policies need to be associated with those users or roles who intend to use the CMK.</p>
<p>Let’s assume that in the key policy, we set the principal component of the root of the external account. This would mean I can set the IAM permissions on any user or role in the external account to allow access to the CMK. The permissions required would need to include a statement as shown for the user or role.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line"> &quot;Statement&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">   &quot;Sid&quot;: &quot;Allow the use of a CMK In Account 1234567889012&quot;,</span><br><span class="line">   &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">   &quot;Action&quot;: [</span><br><span class="line">    &quot;kms:Encrypt&quot;,</span><br><span class="line">    &quot;kms:Decrypt&quot;,</span><br><span class="line">    &quot;kms:ReEncrypt*&quot;,</span><br><span class="line">    &quot;kms:GenerateDataKey*&quot;,</span><br><span class="line">    &quot;kms:DescribeKey&quot;</span><br><span class="line">   ],</span><br><span class="line">   &quot;Resource&quot;: &quot;arn:aws:kms:us-east-2:123456789012:key/5e698272-88c6-4f6b-970e-1d1dbd0c6412</span><br><span class="line">&quot;</span><br><span class="line">  &#125;</span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this policy, you’ll notice that we have an additional parameter of resource, which details which CMK the action should take effect on. And in this instance, is the Amazon resource name of the CMK in which we updated the key policy for. One other point that’s important is that if for example, your key policy only allowed the <code>kms:Decrypt</code> action, but your IAM policy allowed both the <code>kms:Decrypt</code> and <code>kms:encrypt</code> actions, then only the <code>kms:Decrypt</code> action would be allowed, as that is all that is allowed in the key policy, which takes precedence.</p>
<p>Once the policy is associated with the user or role, you will now be able to use the CMK to perform encryption functions. However, please do be aware that even though you have access to the CMK from a different account, the CMK will not be shown in the AWS Management Console for integrated services. Instead, you must use the ARN of the CMK.</p>
<p>I will now perform a demonstration that shows the following steps. I’ll show you how to update the key policy of an existing customer-managed CMK allowing access to an external account to use the CMK. I’ll show you how to apply the required IAM permissions to a user in the external account to allow them to use the CMK. And then I’ll test the access of the CMK across accounts by uploading a file within S3 using the shared CMK.</p>
<p>So I’ve logged-in to my AWS Management Console of the AWS account, where I have the CMK. So let’s go to the KMS service because the first thing we need to do is to edit the key policy of my CMK. Over here we have our AWS managed keys, and also our customer-managed keys. And remember, we can only share customer-managed keys between AWS accounts, we can’t share AWS managed keys. So I’ve got two keys here, one of them is pending deletion at the moment, and we have an active key here. So the demo key is the key that I’m going to use. So to edit the key policy, what we need to do is first select the key, and this brings up all the configuration and details about the CMK. And if we scroll down here, we can see the key policy. And over on the right-hand side, we can switch to the policy view and this will show us the JSON view of the policy itself. So as we scroll down here, we can see different statement IDs, for example, this one will allow access for key administrators. So this will show who the key administrator is, and the actions that they can perform. And further down here, we have another statement, which is, “Allow the use of the key”. And this is the statement that we’re interested in because what we want to do is, add another principle in here, that points to the root account of the secondary AWS account that we want to allow access.</p>
<p>So let’s go ahead and click on this Edit button. And I’m going to scroll down to that statement ID again, and I’m going to add in another principle. So if I just copy and paste this for ease, but I want to change the AWS account that I’m interested in. So let me put in the details of the secondary AWS account and it’s going to be the root account. So what this section of the policy is saying, is allowing all the principles listed here, the ability to use this key and perform these KMS actions such as encrypt, decrypt, etc. So let’s go now and save those changes. </p>
<p>Okay, so now what we want to do is to swap over to our secondary account where I now need to apply identity-based policies to allow a user or multiple users within that account to have access to this CMK. But before I do that, I need to make a note of the ARN of this key, which is found here at the top because you’re gonna need to add this ARN in as the resource within the identity-based policies. So make sure you take a copy of the key’s ARN. </p>
<p>Also, as I mentioned earlier in the course, that KMS is regional. So whatever encryption you’re going to be performing from the other account, it needs to be in the same region. And as we can see up here, currently, I’m in the Ireland region. So that’s just something to remember as well.</p>
<p>Okay, so let me now cross over to the other account. Okay, so now I’m logged-in to my secondary account. So the first thing I need to do, is to go to IAM. And from here, I’m going to select the user that I want to have access to the CMK that I just edited the key policy for. So I’m going to select Stuart, and I’m going to attach an inline policy. So this policy will be directly attached to this identity. So if I go across to Add inline policy, and go to JSON, and to make things a lot easier for this demonstration, I created a policy before, so I’m just going to paste that in. So let me just run through that quickly, it’s a very simple policy. So we have the effect of Allow and these are the actions which are the KMS actions, which is effectively the same as what we had in the key policy. But in this policy, we also have the resource parameter. And this is the ARN of the key that we edited the key policy for. So once you’ve added the policy in, click on Review policy, and then we need to give it a name. I’ll just call this Key Demo, and then down to Create policy. Now if we look at the inline policies, we can now see that we have the Key Demo policy attached to this identity.</p>
<p>So let’s now go ahead and test this encryption to see if the user Stuart within this account can actually encrypt using the CMK in the primary account. Now as we can see at the top here, we’re currently logged in as Stuart, so let’s go ahead and try some encryption. Let me just flip over to S3 to try and encrypt using the CMK from the primary account. Now I have a number of buckets here, we can see that I have two buckets here, in the Ireland region. Because remember, the key was created in the Ireland region of the primary account, so I need to make sure that I’m encrypting within the same region. So if I go into this bucket here, and if I upload an object, just add in an image file, just a JPEG. Click on Next, now we have a number of different options here for S3, just gonna leave all those as default for this demonstration. Now the part that I’m interested in is on this property page. So if I scroll down, we have the encryption option here. So I want to use the AWS KMS master-key to encrypt this file. If I select on this box here, I can select a custom KMS ARN so that the key won’t actually be listed in this drop down list because it doesn’t exist within this account. So we have to use the full ARN of the CMK from the primary account. So if I select the custom KMS ARN, and then paste in the ARN of the key from the primary account. We can see here that this is a different account ID to the current account ID that I’m using showing that this is the key from the primary account. And then I can simply click on Upload. And there we have it, the file is uploaded.</p>
<p>Now if I select this file, we can see here down under encryption, we have server-side encryption enabled, and here we have the KMS ID. And this is the ARN of the key from the primary account. And we know that, because we have the primary account ID here, so that’s worked. So just to quickly run through what we’ve done again, from the primary account where the Customer Master Key existed, we edited the key policy and added the secondary account root user as a user of that key. We then went into the secondary account, and we added an inline policy for a user that we wanted to be able to use that key from the primary account, and we referenced the resource as the ARN of that CMK from the primary account. And then we went into S3 and uploaded an object using a custom KMS ARN, and again, put in the ARN of the primary key. And it’s as simple as that.</p>
<p>That brings me to the end of <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/how-to-share-cmks-across-multiple-accounts-using-kms/sharing-cmks-across-multiple-aws-accounts/">this course</a> which explained how to share a CMK across multiple different accounts through the use of resource-based key policies and identity-based policies. If you’d like additional information on both IAM and the Key Management Service, then please take a look at the resources below.</p>
<p>Overview of AWS Identity &amp; Access Management (IAM): <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/">https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/</a></p>
<p>How to use KMS Key Encryption to Protect your Data: <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/">https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/</a></p>
<p>Feedback on our courses here at Cloud Academy is valuable to both us as trainers and any students looking to take the same course in the future. If you have any feedback, positive or negative, it would be greatly appreciated if you can contact <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. Thank you for your time and good luck with your continued learning of cloud computing. Thank you.</p>
<h1 id="What-is-CloudHSM"><a href="#What-is-CloudHSM" class="headerlink" title="What is CloudHSM?"></a>What is CloudHSM?</h1><p>Hello and welcome to this lecture where I shall provide you with a foundational view of the AWS CloudHSM service.</p>
<p>Firstly, what does the HSM stand for? Well HSM stands for Hardware Security Module, but what is a hardware security module? It’s a physical tamper-resistant hardware appliance that is used to protect and safeguard cryptographic material and encryption keys.</p>
<p>The AWS CloudHSM service provides HSMs that are validated to Federal Information Processing Standards (FIPS) 140-2 Level 3, which is often required if you are going to be using your CloudHSM for document signing or if you intend to operate a public certificate authority for SSL certificates.</p>
<p>As I mentioned, CloudHSM is a physical device, and it’s important to note that this device is not shared with any other customer, so it’s NOT a multi-tenant device. It is a dedicated single-tenant appliance exclusively made available to you, for your own workloads. The fact that the HSM is based upon single tenancy should not be surprising bearing in mind how sensitive the information is that it contains.</p>
<p>CloudHSM is an enterprise-class service used for secure encryption key management and storage which can be used as a root of trust for an enterprise when it comes to data protection allowing you to deploy secure and compliant workloads within AWS.</p>
<p>There are a number of different operations that CloudHSM can help you provide, these include:</p>
<ul>
<li>The creation, storage and management of cryptographic keys, allowing you to import and export both asymmetric and symmetric keys.</li>
<li>The ability to use cryptographic hash functions to enable you to compute message digests and hash-based message authentication codes, otherwise known as HMACs.</li>
<li>Cryptographic data signing and signature verification.</li>
<li>Using both asymmetric and symmetric encryption algorithms.</li>
<li>And the ability to generate cryptographically secure random data.</li>
</ul>
<p>I just mentioned both symmetric and asymmetric encryption keys, and I feel like I should quickly explain the difference between the two.</p>
<p>Asymmetric encryption involves two separate keys. One is used to encrypt the data and a separate key is used to decrypt the data. These keys are created both at the same time and are linked through a mathematical algorithm. One key is considered the private key and should be kept by a single party and should never be shared with anyone else. The other key is considered the public key and this key can be given and shared with anyone. It doesn’t matter who has access to this public key as without the private key, any data encrypted with it cannot be accessed. </p>
<p>Both the private and public keys are required to decrypt the data when asymmetric encryption is being used. So how does it work? </p>
<p>If another party wanted to send you an encrypted message or data, they would encrypt the message using your own public key which can be made freely available to them or anyone. The message is then sent to you where you will use your own private key which has that mathematical relationship with your public key to decrypt the data. This allows you to send encrypted data to anyone without the risk of exposing your private key.</p>
<p>Some common examples of asymmetric cryptography algorithms are RSA, Diffie-Hellman, and Digital Signature Algorithm. </p>
<p>With symmetric encryption, a single key is used to both encrypt and also decrypt the data. So for example if someone was using a symmetric encryption method, they would encrypt the data with a key and then when that same person needed to access that data, they would use the same key that they used to encrypt the data to decrypt the data. As a result, this key must be sent securely between the two parties and here it exposes a weakness in this method. If the key is intercepted by anyone during that transmission, then that third party could easily decrypt any data associated with that key. </p>
<p>Some common symmetric cryptography algorithms that are used are AES which is Advanced Encryption Standard, DES, Digital Encryption Standard, Triple DES and Blowfish. </p>
<p>AWS CloudHSM is not the only encryption service available with AWS, you may have also heard of the Key Management Service, known as KMS. KMS is a managed service used to store and generate encryption keys that can be used by other AWS services and applications to encrypt your data. Much like CloudHSM, KMS uses HSMs, but with KMS, these are managed by AWS, as a result you have less management control of the keys and key material. Later in this course, I shall explain the integrations that exist between the 2 services.</p>
<p>For more information on KMS, please see our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">here</a>.</p>
<h1 id="Understanding-AWS-CloudHSM-Architecture-amp-Implementation"><a href="#Understanding-AWS-CloudHSM-Architecture-amp-Implementation" class="headerlink" title="Understanding AWS CloudHSM Architecture &amp; Implementation"></a>Understanding AWS CloudHSM Architecture &amp; Implementation</h1><p>Hello and welcome to this lecture where I want to provide an overview of the architecture of CloudHSM and the general steps of implementation to help you understand its deployment. </p>
<p>Let me start with the CloudHSM Cluster. When you implement CloudHSM, you will begin by creating a cluster. This cluster is simply a grouping of different HSMs which will act as a single unit when configured and deployed. Having multiple HSMs provides an element of high availability as you are able to select multiple different subnets, one from each availability zone that your VPC operates in, to deploy an HSM into. Any requests to your CloudHSM cluster are then automatically load-balanced between the HSMs in the cluster, and if one HSM fails, AWS will automatically deploy another one within your cluster. As a result, running a VPC is a prerequisite of implementing your cluster.</p>
<p>During the deployment of your HSMs, it’s actually an Elastic Network Interface (ENI) that is placed within the subnet that you select of your VPC. The HSM itself actually resides in a different AWS-owned VPC, and located in the same AZ as you select during its deployment. So it’s the ENI that is deployed in your VPC which acts as an interface between your network and the HSM residing in an AWS-owned VPC.</p>
<p>When you create the cluster, CloudHSM will do 2 things. Firstly, a new service-linked role will be created ‘AWSServiceRoleForCloudHSM’ which gives CloudHSM the permission to send log data to CloudWatch Logs log groups and log streams on your behalf. For those familiar with IAM policies, the policy looks as shown.</p>
<p>Secondly, CloudHSM will also create a new security group for the cluster (cloudhsm-cluster-clusterID-sg). This is an important security group as it controls which resources can communicate with the HSMs. The security group itself will allow both inbound and outbound connectivity over TCP ports 2223-2225, which enables each of your HSMs within your cluster to communicate with each other. When this security group is created by CloudHSM, no other resources are associated with it. </p>
<p>Once your cluster has been defined and created in the different subnets and availability zones that you have selected, it will have been provisioned in an ‘uninitialized state’. From this point, you can create your HSMs in each availability zone that you selected and ‘initialize’ the cluster. As this is a beginner course, I will not dive into this initialization process, however, if you would like a detailed technical understanding of how to perform this step, please refer to the AWS documentation <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cloudhsm/latest/userguide/initialize-cluster.html">here</a>.</p>
<p>When your cluster is initialized you can then connect to your cluster HSM network interfaces, and one of the easiest ways to do this is via an EC2 instance provisioned in the same VPC. There are 2 steps which must be carried out for your EC2 instances to interact with the HSMs. Firstly, you must configure a security group. And secondly, you need to install the AWS CloudHSM client software on your instance.</p>
<p>So, firstly, the security group. You must add your instance to the cloudhsm-cluster-clusterID-sg security group. As we already know, this security group allows your HSMs to communicate with each other, but this same security group is also used to define which EC2 instances can communicate with your CloudHSMs, which must be manually added to the security group. If you want to connect to your CloudHSM using a Windows EC2 instance then you must add a rule to this SG using RDP with port 3389, if using a Linux instance then you must select SSH using port 22.</p>
<p>Next, you must install the client and command-line tools. To do this, connect to your instance that you added to the security group as I just mentioned. </p>
<p>If using a Linux instance, then you need to run a command, and this command will be different depending on the OS you are running. For a list of commands relating to the following OS’s please refer to <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cloudhsm/latest/userguide/install-and-configure-client-linux.html">this AWS resource</a>.</p>
<p>Once you have installed the client and tools, you need to modify the client configuration to enable you to connect to your cluster. Firstly you need to copy your issuing certificate (created when you initialize your cluster) to &#x2F;opt&#x2F;cloudhsm&#x2F;etc&#x2F;customerCA.crt</p>
<p>You must also run the following command, replacing the red text with your HSMs IP address </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /opt/cloudhsm/bin/configure -a &lt;IP address&gt;</span><br></pre></td></tr></table></figure>

<p>If you are using a Windows instance, then you will need to download the installation from here.</p>
<p>After running the MSI file, you will need to copy the self-signed issuing certificate to the following.</p>
<p>And then finally, you need to run the following command to configure the client software replacing the text in red with your own HSM details.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Amazon\CloudHSM\configure.exe -a &lt;HSM IP address&gt;</span><br></pre></td></tr></table></figure>

<p>So let’s take a quick logical look at how the infrastructure would look like at this stage.</p>
<p>So as you can see, we have the customer VPC split across 3 different availability zones and subnets, each with an EC2 client containing the HSM client software and an HSM ENI. Each EC2 client can communicate with ANY of the HSM ENI across the different subnets within the cluster using the cloudhsm-cluster security group. These ENIs then communicate with the HSMs located in an AWS-owned VPC.</p>
<p>We also have the IAM role that has been created allowing HSM to send log data to CloudWatch Logs log groups and log streams on your behalf. </p>
<p>Once your infrastructure is in place and you have configured your CloudHSM connectivity, you simply need to activate your HSM cluster before use.</p>
<h1 id="Using-CloudHSM-as-a-Custom-Key-Store-in-KMS"><a href="#Using-CloudHSM-as-a-Custom-Key-Store-in-KMS" class="headerlink" title="Using CloudHSM as a Custom Key Store in KMS"></a>Using CloudHSM as a Custom Key Store in KMS</h1><p>Hello and welcome to this lecture where I want to explain the interaction between the two AWS encryption services, AWS Key Management Service and AWS CloudHSM.</p>
<p>When working with AWS KMS, you are able to create custom key stores. A key store is effectively a storage location which can store and protect your cryptographic keys used to encrypt and decrypt your data in AWS. When working with AWS KMS, the default key stores are managed by KMS and are stored on HSMs managed by AWS, and so as a user of KMS you have no control over these HSMs which underpin the cryptographic storage of KMS.</p>
<p>However, if you have specific compliance controls that you need to adhere to, where you might require a greater level of control of your key stores. By creating a custom key store you can leverage the power of your CloudHSM cluster which you have full management of, as explained in the previous lecture. </p>
<p>A benefit of AWS KMS is that it has a wide range of integrations with other AWS services, allowing you to perform server-side encryption often at the click of a button with minimal configuration required. This makes it a great choice when protecting your data. </p>
<p>KMS creates and stores Customer Master Keys (CMKs) which is the main key type in KMS and there are two types of customer master keys. Firstly, those which are managed and created by you and I, as customers of AWS, which can be created by using KMS and then those that are managed and created by AWS themselves. </p>
<p>CMKs that are generated and created by us as customers, rather than AWS, provide the ability to implement greater flexibility, such as being able to manage the key, including rotation, governing access and key policy configuration, along with being able to both enable and disable the key when it is no longer required. </p>
<p>So, if within your organisation you want to use the seamless integration of KMS with many AWS services, but require the security and compliance of maintaining your own key material outside of KMS then you can create a custom key store backed by your CloudHSM cluster.</p>
<p>The custom key store is a resource managed from within KMS, but allows you to store your key material within your managed HSMs of your CloudHSM cluster. This allows you to use the key material located within your HSM cluster to create the CMKs that KMS uses to implement encryption across different AWS services. CMKs created from your custom key store are 256-bit, non-exportable AES symmetric keys that never leave the HSM unencrypted. All cryptographic operations made with the CMK happens within the HSM cluster</p>
<p>So as you can see from this diagram, AWS services use CMKs managed by KMS using existing integration, but your CMKs can either come from the default key store created and stored by HSMs managed by AWS, or by using the custom key store which are managed by you allowing you to control access to your key material used within the CMKs.</p>
<p>Bear in mind that each HSM Cluster can only be associated with one custom key store for KMS, and both the cluster and the KMS creation of the custom key store must be within the same region. KMS is a regional service, and keys can’t be used between multiple regions. If you want to create CMKs within your custom key store, then your cluster must have at least 2 HSMs activated in different availability zones. </p>
<p>As a part of the process to create your custom key store you must upload the trust anchor certificate for the cluster to KMS, and this certificate is generated when the cluster is first initialized. Also, you must create a dedicated Crypto User called kmsuser (without 2 factor authentication) and generate a password, which you then provide to KMS. Going forward KMS will use this kmsuser CU to perform its operations in addition to rotating the password every time the user is authenticated.</p>
<h1 id="Overview-of-Encryption-Mechanisms"><a href="#Overview-of-Encryption-Mechanisms" class="headerlink" title="Overview of Encryption Mechanisms"></a>Overview of Encryption Mechanisms</h1><p>Depending on your requirements, one method of encryption may be more appropriate than another. To help you decide, here is a quick overview of each. </p>
<p>Server-side encryption with S3 managed keys, SSE-S3. This option requires minimal configuration and all management of encryption keys used are managed by AWS. All you need to do is to upload your data and S3 will handle all other aspects. </p>
<p>Server-side encryption with KMS managed keys, SSE-KMS. This method allows S3 to use the key management service to generate your data encryption keys. KMS gives you a far greater flexibility of how your keys are managed. For example, you are able to disable, rotate, and apply access controls to the CMK, and audit it against their usage using AWS CloudTrail. </p>
<p>Server-side encryption with customer provided keys, SSE-C. This option gives you the opportunity to provide your own master key that you may already be using outside of AWS. Your customer-provided key would then be sent with your data to S3, where S3 would then perform the encryption for you. </p>
<p>Client-side encryption with KMS, CSE-KMS. Similarly to SSE-KMS, this also uses the key management service to generate your data encryption keys. However, this time KMS is called upon via the client not S3. The encryption then takes place client-side and the encrypted data is then sent to S3 to be stored. </p>
<p>Client-side encryption with customer provided keys, CSE-C. Using this mechanism, you are able to utilize your own provided keys and use an AWS-SDK client to encrypt your data before sending it to S3 for storage. </p>
<p>Okay, that has given us a very high-level overview of the five different methods. Via a series of diagrams, I will now explain how the encryption and decryption process works for each.</p>
<h1 id="Server-Side-Encryption-with-S3-Managed-Keys-SSE-S3"><a href="#Server-Side-Encryption-with-S3-Managed-Keys-SSE-S3" class="headerlink" title="Server-Side Encryption with S3 Managed Keys (SSE-S3)"></a>Server-Side Encryption with S3 Managed Keys (SSE-S3)</h1><p>Server-Side Encryption with S3 Managed Keys, SSE-S3. The encryption process is as follows. Firstly, a client uploads Object Data to S3. S3 then takes this Object Data and encrypts it with an S3 Plaintext Data Key. This creates an encrypted version of the Object Data, which is then saved and stored on S3. Next, the S3 Plaintext Data Key is encrypted with an S3 Master Key. Which creates an encrypted S3 Data Key. This encrypted Data Key is then also stored on S3 and the Plaintext Data Key is removed from memory. The decryption process is as follows. A request is made by the client to S3 to retrieve the Object Data. S3 takes the associated encrypted S3 Data Key off the Object Data and decrypts it with the S3 Master Key. The S3 Plaintext Data Key is then used to decrypt the object data. This object data is then sent back to the client.</p>
<h1 id="Server-Side-Encryption-with-KMS-Managed-Keys-SSE-KMS"><a href="#Server-Side-Encryption-with-KMS-Managed-Keys-SSE-KMS" class="headerlink" title="Server-Side Encryption with KMS Managed Keys (SSE-KMS)"></a>Server-Side Encryption with KMS Managed Keys (SSE-KMS)</h1><p>Server-Side Encryption with KMS managed keys, SSE-KMS. The encryption process is as follows. Firstly, a client uploads object data to S3. S3 then requests data keys from a KMS-CMK. Using the specified CMK, KMS generates two data keys, a plain text data key and an encrypted version of the same data key. These two keys are then sent back to S3. S3 then combines the object data and the plain text data key to perform the encryption. This creates an encrypted version of the object data which is then stored on S3 along with the encrypted data key. The plain text data key is then removed from memory. The decryption process is as follows. A request is made by the client to S3 to retrieve the object data. S3 sends the associated encrypted data key of the object data to KMS. KMS then uses the correct CMK with the encrypted data key to decrypt it and create a plain text data key. This plain text data key is then sent back to S3. The plain text data key is then combined with the encrypted object data to decrypt it. This decrypted object data is then sent back to the client.</p>
<h1 id="Server-Side-Encryption-with-Customer-Provided-keys-SSE-C"><a href="#Server-Side-Encryption-with-Customer-Provided-keys-SSE-C" class="headerlink" title="Server-Side Encryption with Customer Provided keys (SSE-C)"></a>Server-Side Encryption with Customer Provided keys (SSE-C)</h1><p>Server-Side Encryption with Customer Provided Keys, SSE-C. The encryption process is as follows. Firstly, a client uploads Object Data and the Customer-provided Key to S3 for a HTTPS. It will only work with the HTTPS connection. Otherwise, S3 will reject it. S3 will then use the Customer-provided Key to encrypt the Object Data. S3 will also create a sorted HMAC value of the Customer-provided Key for future validation requests. The encrypted Object Data, along with the HMAC value of the Customer Key is then saved and stored on S3. The Customer-provided Key is then removed from memory. The decryption process is as follows. A request is made by the client via HTTPS connection to S3 to retrieve the Object Data. At the same time, the Customer-provided Key is also sent with the request. S3 uses the HMAC value of the same key to confirm it’s validity of the requested object. The Customer-provided Key is then used to decrypt the encrypted Object Data. The Object Data is then sent back to the client.</p>
<h1 id="Client-Side-Encryption-with-KMS-Managed-Keys-CSE-KMS"><a href="#Client-Side-Encryption-with-KMS-Managed-Keys-CSE-KMS" class="headerlink" title="Client-Side Encryption with KMS Managed Keys (CSE-KMS)"></a>Client-Side Encryption with KMS Managed Keys (CSE-KMS)</h1><p>Client-Side Encryption with KMS Managed Keys, CSE-KMS. The encryption process is as follows. Using an AWS SDK, such as the Java client, a request is made to KMS for Data Keys that are generated from a specific CMK. This CMK is defined by providing the CMK-ID in the request. KMS will then generate two Data Keys from the specified CMK. One key will be a Plaintext Data Key. The second will be a Cipher blob of the same Data Key. Both keys are then sent back to the client. The client will then combine the Object Data with the Plaintext Data Key to create an encrypted version of the Object Data. The client then uploads both the encrypted Object Data and the Cipher blob version of the Data Key to S3. S3 will then store the encrypted Object Data and associate the Cipher blob Data Key as Metadata of the encrypted Object Data. The decryption process is as follows. A request is made by the client to S3 to retrieve the Object Data. S3 sends both the encrypted Object Data and the Cipher blob back to the client. Using an AWS SDK, such as the Java client, the Cipher blob Data Key is sent to KMS. KMS combines the Cipher blob Data Key with the corresponding CMK to produce the Plaintext Data Key. This Plaintext Data Key is then sent back to the client and the Plaintext Data Key is then used to decrypt the encrypted Object Data.</p>
<h1 id="Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C"><a href="#Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C" class="headerlink" title="Client-Side Encryption with Customer Provided Keys (CSE-C)"></a>Client-Side Encryption with Customer Provided Keys (CSE-C)</h1><p>Client-Side Encryption with Customer Provided Keys, CSEC. The encryption process is as follows. Using an AWS SDK, such as the Java client, it will randomly generate a plain text data key which is used to encrypt the object data. The customer provided CMK is then used to encrypt this client-generated data key. The encrypted object data and encrypted data key are then sent to S3. S3 will then store the encrypted object data and associate the encrypted data key as metadata of the encrypted object data. The decryption process is as follows. A request is made by the client to S3 to retrieve the object data. S3 sends both the encrypted object data and the encrypted data key back to the client. The customer-provided CMK is then used to decrypt the encrypted data key. The plain text data key is then used to decrypt the object data. You should now have a deeper understanding of the process of encryption and decryption for each of the encryption methods that S3 offers. </p>
<p>It is a simple process to apply encryption, but understanding what’s happening behind the scenes, is essential from a security standpoint. Especially when you are responsible for maintaining the integrity of the data stored in S3. Many of us have seen and heard the news whereby large, international organizations have failed to apply either correct level of permissions, or, indeed, an encryption mechanism to customer data which has been accidentally exposed. Causing a detrimental effect to all organizations involved. </p>
<p>To accompany this course, I’ve also created an infographic which shows all five encryption options and this can be found using the <a target="_blank" rel="noopener" href="https://awsinfographics.s3.amazonaws.com/S3_Encryption_Infographic.png">link</a> on screen. I have also added this URL within the transcript of this lecture. </p>
<p>If you have any feedback on this course, positive or negative, please do get in touch with us here at Cloud Academy by sending an email to <a href="mailto:&#115;&#x75;&#112;&#x70;&#111;&#114;&#x74;&#64;&#x63;&#x6c;&#111;&#117;&#x64;&#x61;&#x63;&#x61;&#x64;&#x65;&#x6d;&#121;&#x2e;&#99;&#x6f;&#109;">&#115;&#x75;&#112;&#x70;&#111;&#114;&#x74;&#64;&#x63;&#x6c;&#111;&#117;&#x64;&#x61;&#x63;&#x61;&#x64;&#x65;&#x6d;&#121;&#x2e;&#99;&#x6f;&#109;</a>.</p>
<p>Thank you for your time, and good luck with your continued learning of cloud computing. Thank you.</p>
<h1 id="Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets"><a href="#Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets" class="headerlink" title="Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets"></a>Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets</h1><p>Hello, my name is Stuart Scott. And today I should be looking at AWS Secrets Manager to understand how it can be used to help you implement security best practices by protecting your secrets such as database credentials, API keys, and plaintext. By the end of this course, you will understand when and why you might want to use AWS Secrets Manager and how it can be used to effectively enhance your security posture when working with different secrets within your AWS environment.</p>
<p>During this course, I mention the AWS Key Management Service, known as KMS, which is used for the encryption and decryption of data. If you’d like to learn more about the service, then please see our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/">here</a>. It would also be beneficial to have an understanding of IAM policies, but this is not essential. If you have any feedback on this course, positive or negative, it would be greatly appreciated if you can contact <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>Okay, so let’s get into it. And I’ll start by telling you a little bit about AWS Secrets Manager. Historically when developers were building custom applications to access your databases, they would need to directly embed credentials into the applications, allowing them to authenticate to the database. And this allowed the application to access the database as required. However, when it came to rotating the password, like best practices require, it would also mean you would have to update your custom application with the new credentials. And this is both time consuming and prone to errors, not to mention the security risk. You should always avoid embedding and hard-coding credentials in an application. This problem is alleviated with the introduction of AWS Secrets Manager, a service which allows you to store the secret such as database credentials in a secure store.</p>
<p>Now, when your application needed to access the database, it would simply make an API request to retrieve the required credentials from AWS Secrets Manager, which would then be passed back to your application over a secure channel using HTTPS with TLS, allowing it to authenticate with your database. The benefit is that it removes the need to hard-code credentials into the application, in addition to having AWS Secrets Manager being able to automatically rotate your credentials without having to update your application code with those new credentials.</p>
<p>So we have spoken about using database passwords as a secret. And in fact, AWS Secrets Manager supports RDS, DocumentDB, Redshift and rotates these secrets automatically with backend support from built-in Lambda functions. However, AWS Secrets Manager also supports other types of secrets such as helping you protect API keys and other plaintext data as key&#x2F;value pairs. When using this option, you can define key-value strings which form the secret itself. When using these types of secrets with rotation enabled, then you’ll need to ensure you associate your own custom Lambda function to perform that rotation. The secrets themselves are protected and encrypted using the Key Management Service, KMS. And you can select either the DefaultEncryptionKey, which is an AWS owned CMK, the AWS managed CMK listed as aws&#x2F;secretsmanager, or your own customer managed CMK.</p>
<p>With this integration of KMS, the encryption backing your secrets are managed by hardware security modules, HSMs, that are validated under FIPS 140-2. Due to the sensitive nature of your secrets, the encryption aspect is crucial, but you can also control access to each individual secret using both fine-grained IAM identity-based policies in addition to resource-based policies. By default, access to secrets are denied until explicitly granted through a policy. Identity-based policies can be attached to users and other identities to govern their permissions to the secret.</p>
<p>Here’s an example of an IAM policy allowing an action to be carried out on a secret called cloudacademy_secret in the eu-west-1 region of an AWS account. Resource-based policies are attached directly to the secrets themselves and define which principals can perform which actions against that secret. This can be done using the Management Console or the AWS CLI. This example of a resource-based policy allows the user, Stuart, full access to the secret in which the policy is attached to.</p>
<p>If this policy was created on the AWS CLI and saved as a file called resource.json, then I could use the following command to attach it to a secret called cloudacademy_secret. Another great feature of AWS Secrets Manager is the ability to share secrets between multiple accounts. You might want to do this to have a centralized and managed store of your secrets instead of having multiple stores between different accounts. You can then share your secrets to AWS accounts as and when needed in a secure manner using different policies. To understand how to do this, take a look at our existing course <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-secrets-manager/">here</a>.</p>
<p>I now want to show you a quick demonstration of how simple it is to create a secret in AWS Secrets Manager. I will create a new secret for an RDS Database with automatic rotation enabled. So let’s jump straight into it.</p>
<p>Okay, so as you can see, I’m in my AWS Management Console and the first area I need to go to is to Secrets Manager, which is under the Security Identity &amp; Compliance category here. So if I go to Secrets Manager, and this will open up the Secrets Manager dashboard. At the moment, I don’t have any secrets created here.</p>
<p>So the first thing we want to do is to store a new secret. And this takes us to the first step of four in creating our secret. So like I said, I want to create a new secret for my RDS database. And this will be the log on credentials. So we have lots of different options here. So we can use RDS, DocumentDB, Redshift, another type of database or another type of secret. So I’m gonna select RDS.</p>
<p>Now, the username will be Admin, and I’m just going to set a password of My Password. Now here, we can select the encryption key that we want to encrypt the secret with because as we know, by default, all secrets have to be encrypted. So we can use the DefaultEncryptionKey or the AWS managed key here, the aws&#x2F;secretsmanager. I’ll just leave it as a DefaultEncryptionKey for this demonstration.</p>
<p>Now down here, we can select which database that this secret will access. So I’m going to select this one here just called Stuarts database, and click on next. Now we can give the secret name. I’m going to call this My_Secret. And you can add a description if you want to there. Add any optional tags that you’d like to for this particular secret. This element here allows you to add some resource permissions to allow secrets to have cross account access. So this is only optional. We don’t really need to do this. And here we can also replicate our secret as well to another region.</p>
<p>So here it says, if you enable secret replication, read replicas of your secret will be created in the specified regions with the same secret name. So if I wanted to replicate my secret to a different region as well, then I can select the relevant region and select an encryption key to go with that and it will, sequence manager when replicate this secret to that other region. But for this demonstration, I don’t want to replicate any secrets to other regions. So I’ll just de-select that. And then click on next.</p>
<p>Now, here we can decide if we want to configure automatic rotation. By default, it’s disabled. But for this demonstration, I’m just going to enable it just to show you how easy it is to set up. Now we can select the number of days when we want the rotation to happen. There’s some defaults here, we can customize it. I’ll just leave it as 30 days. And the value can be anywhere between one and 365 days.</p>
<p>Now you can let Secrets Manager create a new Lambda function for you to enable this rotation, or you can use an existing Lambda function. So I’m just going to allow it to create a new Lambda function on my behalf to enable that. And if we give the Lambda function and name, let’s call it MySecretRDS, and then down here you can just select which secret will be used to perform the rotation. So I’m just gonna leave it as the secret I’m creating now. Then click on next.</p>
<p>So this is just a review screen. We can see the secret type, the RDS database. Using the DefaultEncryptionKey. The name of the secret. We’ve enabled automatic rotation, one of 30-day interval, and we’ve disabled the secret replication. Now at the bottom here, we can just see some sample code that illustrates how to retrieve the secret in your application. And then there’s lots of different examples of different code there as well. But for now, it just want to store the secret. So just click on store. And we can see here that the secret has now been stored. And when you first store your secret, it performs a rotation immediately. So that’s what’s happening at the top here. So it’s very quick and easy to create a new secrets within Secret Manager that is associated with an existing RDS database.</p>
<p>Obviously, retrieving a secret is just as important as storing it. And there are a number of different ways you can do this. You can programmatically retrieve it via any of your own customer applications using the available AWS SDKs, or you can also retrieve it using the AWS Management Console or the AWS CLI. So let’s jump straight back into another demonstration to show you how you can use a couple of these methods. </p>
<p>Okay, so can the AWS Management Console and at the dashboard of AWS Secrets Manager. And here we can see the secret that we just created. So I just wanted to show you how you can easily retrieve the values of the secret from both within the AWS Management Console and from the AWS CLI. So if I select the secret, we can scroll down to this section here, the secret value, and all we need to do is simply say, retrieve secret value. And as long as you have access to access the secret, then you will get access to view the values within that secret.</p>
<p>So here we can see the username of Admin that we entered and also the password of MyPassword, and also the database host that it relates to as well. So using the Secret Manager Console, it’s very easy. So let’s now flip over to the AWS CLI to show you how you can retrieve the same value that way as well. So the command we need to type in is AWS Secrets Manager, and then it’s get-secret-value using the secret ID. And you can just use the name of the secret that you created So mine was My_Secret, and then just press return. And again, as long as you have access to the secret, then you will get the values.</p>
<p>So here we can see the secret string and we have the username of Admin and the password of MyPassword. And again, we can see the host information database details there as well. Now, before I finish this demonstration, I just want to show you the simple access policy I granted myself to be able to retrieve these values. So if I flick over to identity and access manager, and if I look at my users, I set myself up an inline policy called My_Secret_Access. So let’s just take a quick look at that policy.</p>
<p>So it’s very simple. It’s simply an allow action. So any action lightened as secretsmanager, and then just the ARN of my secret. And obviously, if you’re setting up your own security controls, you won’t be as open as this, but this is just the quick policy I added just to show you how I’ve granted myself access to retrieve the value of that secret. And then finally, one last point. If you go back to My_Secret within Secrets Manager. And if you scroll down to the very bottom, it gives you lots of different sample card that shows you how to retrieve the secret from using your own application, whether you’re using Java, JavaScript, C#, et cetera, et cetera. So it provides a very quick way just to take some sample code, put it in your own application and quickly retrieve those secrets.</p>
<p>That brings me to the end of this course, which explained how AWS Secrets Manager can be used as a secure method to essentially store your secrets with enhanced security protection features backed by KMS and both identity-based and resource-based policies allowing them to be used within your own account and for cross account access. Management benefits such as automatic rotation also region replication make this a powerful tool to enhance your security posture.</p>
<p>If you’d like to learn more about some of the topics I have mentioned today, such as Identity and Access Management, and the Key Management Service, then please search our library for these services and you will find both courses and labs on these topics to help dive deeper into the understanding. If you have any feedback on this course, positive or negative, then please send an email to <a href="mailto:&#115;&#117;&#112;&#112;&#x6f;&#114;&#116;&#x40;&#x63;&#108;&#x6f;&#117;&#x64;&#x61;&#x63;&#97;&#100;&#x65;&#109;&#x79;&#x2e;&#99;&#x6f;&#x6d;">&#115;&#117;&#112;&#112;&#x6f;&#114;&#116;&#x40;&#x63;&#108;&#x6f;&#117;&#x64;&#x61;&#x63;&#97;&#100;&#x65;&#109;&#x79;&#x2e;&#99;&#x6f;&#x6d;</a>. Your feedback is greatly appreciated. Thank you for your time and good luck with your continued learning of cloud computing. Thank you.</p>
<h1 id="Digital-Certificates-and-AWS-Certificate-Manager"><a href="#Digital-Certificates-and-AWS-Certificate-Manager" class="headerlink" title="Digital Certificates and AWS Certificate Manager"></a>Digital Certificates and AWS Certificate Manager</h1><p>In this lesson, we will discuss the importance of digital certificates and key features of AWS Certificate Manager. We’ve all been using digital certificates for decades and most of us probably use digital certificates every day. Whenever we go to a website that uses HTTPS, we’re using digital certificates. Digital certificates are also used during the authentication of endpoints taking part in site-to-site <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/getting-started-with-azure-virtual-networks-1207/vpn-gateways/">VPNs</a> so that a VPN tunnel can be established, during the validation of digital signatures used as part of integrity checks of data at rest and in transit, as part of multi-factor authentication and more. </p>
<p>Fundamentally, digital certificates allow us to trust that the website, service, or user we are communicating with is valid. If we trust that the entity we are communicating with is valid, we can then do things like configure authentication, configure non-repudiation, configure integrity checks, and configure encryption. Digital certificates come embedded with a public key. The certificate is validating the public key, meaning that we can trust the public key and use it to perform tasks such as configuring secure communications with web servers and validating digital certificates. Digital certificates themselves need to be trusted.</p>
<p>If we can’t trust digital certificates, then we can’t trust the public keys embedded with them and therefore we cannot use those public keys to secure our connections. In order to obtain digital certificates that we can trust, we request digital certificates from trusted certificate authorities. Certificate authorities can be either public or private. Public certificate authorities are already trusted by most operating systems. Public certificate authorities issue certificates to businesses with embedded public keys that can be trusted. Certificates issued by public certificate authorities are generally used on public-facing services such as websites. When requesting a certificate from a public certificate authority, you usually generate a key pair on-prem. You keep your private key secret and then generate a certificate signing request, a CSR. The CSR contains your public key, the DNS names you wish to secure, and your digital signature.</p>
<p>You submit your CSR to your chosen certificate authority and after you validate that you own the domain names in the CSR, a digital certificate will be issued. Public certificate authorities will charge a fee for their services. Private certificate authorities are not automatically trusted by our browsers and operating systems. We configure our browsers and operating systems to trust certificates issued by private certificate authorities by importing the certificate authority’s root certificate into the trusted root certificate store of our operating systems. Once we have completed this import, certificates issued by the private certificate authority would be trusted and we can use them to secure connections. We request certificates from private CAs in the same way we do from public CAs by submitting a CSR.</p>
<p>One big difference between public CAs and private CAs is that for private CAs, we deploy the certificate authority infrastructure. We are responsible for securing, backing up, high availability, and day-to-day management of the certificate authority, which might mean managing multiple certificate servers. As you are on the infrastructure, certificates issued by private CAs are free. Certificates issued by private CAs are used internally only, as they will not be trusted by your customers or other services on the Internet. There are lots of challenges when working with digital certificates as well as the challenge of managing your own infrastructure for private CAs. Additional certificate challenges include: Managing certificate requests, renewing and replacing digital certificates that are due to expire, the cost of certificates from public CAs, securing the certificate authority infrastructure, and managing certificate revocation lists (CRLs) for your private CAs.</p>
<p>CRLs are lists of certificates that have been issued by a CA that should no longer be trusted. Each CA is responsible for publishing a list of revoked certificates to a CRL that their customers can access, so that if they come across a certificate on the list, they know not to trust it. AWS Certificate Manager allows us to request SSL&#x2F;TLS certificates for free from a trusted public certificate authority. These certificates can be used to secure connections with AWS services such as Elastic Load Balancers, Amazon CloudFront, and API Gateway. Certificates issued by AWS Certificate Manager public certificate authorities can only be used with AWS services. Using Certificate Manager, you could also set up a private certificate authority. Once set up, you can use your private certificate authority to issue certificates to secure communications with your applications running on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/compute-fundamentals-for-aws/ec2-elastic-compute-cloud/">EC2</a> and your applications running on-premise.</p>
<p>Benefits of AWS Certificate Manager include: Publicly trusted certificates are available for free, there’s no need to generate key pairs or issue a CSR, these will be created automatically for you during your certificate request, there’s no need to configure certificate authority infrastructure. Even when you create a private CA, it is managed by AWS Certificate Manager. So, AWS are responsible for the high availability, backup and day-to-day management of the servers hosting your CA. One of the best features of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/amazon-web-services/">AWS</a> Certificate Manager is its ability to alter the new certificates. I have seen many services go down because the certificates they have been using have expired. Using AWS Certificate Manager, that shouldn’t happen as it will automatically generate new certificate requests to replace eligible certificates that are expiring and then replace the expiring certificates in the configuration of the services that they are protecting.</p>
<h1 id="Working-with-AWS-Certificate-Manager-Public-Certificates"><a href="#Working-with-AWS-Certificate-Manager-Public-Certificates" class="headerlink" title="Working with AWS Certificate Manager Public Certificates"></a>Working with AWS Certificate Manager Public Certificates</h1><p>In this lesson, we will discuss the process of requesting a public certificate from AWS Certificate Manager. AWS Certificate Manager is a regional service. This means that if you want to request a public certificate for use with an ELB in the EU West 2, then you must use AWS Certificate Manager in EU West 2. Interestingly, if you need a digital certificate for use with CloudFront, you need to use <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/amazon-web-services/">AWS</a> Certificate Manager in North Virginia, US East 1. Here you can see the AWS Certificate Manager console in the Ireland region. </p>
<p>To start your certificate request, you select request certificate. If you choose request certificate, you’ll be asked if you want to request a public certificate or a private certificate. Notice here that the request private certificate option is grayed out. That is because a private certificate authority has not been created yet. When you request a public certificate from AWS Certificate Manager, you need to provide the following information. The fully qualified domain name or names for the sites you wish to protect with your digital certificate, for example, <a target="_blank" rel="noopener" href="http://www.acme.com/">www.acme.com</a> and the validation method, either DNS validation or email validation.</p>
<p>Before AWS Certificate Manager can issue a public certificate, you must prove that you own or control all the domain names that you’ve listed in your request. When using DNS validation, a CNAME record needs to be added to each domain listed in your certificate request. By adding the appropriate CNAME record, you are proving you have control of the DNS domain. If you are using Route53 and have the appropriate permissions, then AWS Certificate Manager can add the appropriate CNAME records for you. </p>
<p>If you are using a third-party <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/explainables/dhcp-and-dns/">DNS</a> service, you must add the CNAME record yourself. If you choose email validation, emails will be sent to the registered contacts on the who is database. This will include the domain registrant, the technical contact, and the administrative contact. The information about these contacts would have been provided when the domain was purchased. Multiple emails will be sent. In order to validate the domain, you must respond to one of these emails within 72 hours.</p>
<p>Once validated, the new public certificate will be issued and you can then use it to secure your AWS services. In this demonstration, we will request a public certificate from AWS Certificate Manager and use it to add a secure listener to an application load balancer. I’m here in the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/compute-fundamentals-for-aws/ec2-elastic-compute-cloud/">EC2</a> dashboard. I’ve installed and selected an application load balancer. If I select the listeners’ tab, we can see this load balancer has a single listener listening out on HTTP port 80. I want this load balancer to use a secure listener and that means request a digital certificate from AWS Certificate Manager. So, let’s switch to the AWS Certificate Manager dashboard. I’m in the AWS Certificate Manager dashboard for the Ireland region. Remember, Certificate Manager is a regional service. Let’s select ‘Request a certificate’. Notice here, my only option is to request a public certificate; that’s because I’ve yet to install a private certificate authority.</p>
<p>So, we request public certificate selected, I click ‘Next’. I then provide the fully qualified domain names that I wish to include in my certificate request and I’m going to use this certificate to secure. We then choose a validation method, either email validation or DNS validation. I will leave DNS validation selected, and select request. We can see that the certificate has been successfully requested and is pending validation. If I select the certificate, here we can see the CNAME information that we would add to our DNS zone in order to validate the certificate. </p>
<p>Notice that if this domain is hosted in Route53, we can select create records in Route53 and as long as the user account we’re logged in with has the appropriate permissions, the CNAME records will be automatically created for us. Back in the Certificate Manager dashboard, now that our DNS entries have been added and the certificate has been validated, we see the status is set to issued. Now let’s go back to our load balancer and use this certificate to create a secure listener.</p>
<p>With the load balancer selected, I select the listener’s tab and then select add listener. We choose the appropriate protocol and port combination and then select the add action dropdown. In this example, I want all https port 44 free traffic to be forwarded to a target group. So, I select forward and then from the target group dropdown, I select my target group. If I then scroll down a little bit, we can see the certificate section. And in the select the certificate dropdown, I can choose my certificate. All we have to do now is select add and then view listeners. So, here we can see we have now both HTTP and HTTPS listener. If required, you can remove the HTTP listener to enforce the use of HTTPS.</p>
<h1 id="Working-with-AWS-Certificate-Manager-Private-Certificate-Authorities"><a href="#Working-with-AWS-Certificate-Manager-Private-Certificate-Authorities" class="headerlink" title="Working with AWS Certificate Manager Private Certificate Authorities"></a>Working with AWS Certificate Manager Private Certificate Authorities</h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/library/amazon-web-services/">AWS</a> Certificate Manager is ready and able to issue public certificates without any additional configuration. If you want AWS Certificate Manager to issue private certificates, then you must first create a Private Certificate Authority. AWS Certificate Manager Private Certificate Authority is a managed service. AWS will take on the day-to-day responsibility for the certificate authority infrastructure, its high availability, and its backups. </p>
<p>To use AWS Certificate Manager Private Certificate Authority, you must create a certificate <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-to-machine-learning/02-introduction-to-ai-and-ml-hierarchy/">hierarchy</a>, you must configure a root certificate authority, and a subordinate certificate authority. A root certificate authority is the start of the chain of trust. When you create a root certificate authority, a self-signed certificate is created. This self-signed certificate can be imported to a device’s root certificate store so that the device trusts any certificates issued by a certificate authority that is digitally signed by the root authority’s self-signed certificate.</p>
<p>Root certificate authorities don’t issue certificates to devices or services. Instead, certificates are issued from subordinate certificate authorities. Subordinate certificate authorities have a certificate digitally signed by the root certificate authority’s private key. They in turn sign any certificates they issue with their private key. By verifying the signatures of the subordinate CA and the root CA, you can be confident that the certificates issued by the subordinate CA can be trusted and used to establish a secure connection. So, why do we need AWS Certificate Manager Private Certificate Authorities?</p>
<p>Well, if you have internal applications hosted in AWS or on-premise that require SSL or TLS certificates, then you will need digital certificates issued by a CA. These certificates might be for internal domains and name spaces that we can’t or do not want to validate when requested a public certificate. And we probably want to simplify certificate for a management, giving day-to-day responsibility of running the certificate for AWS. AWS Certificate Manager Private Certificate Authority is a paid-for service. You pay monthly fees for each certificate authority you create and you pay one-off fees for each private certificate that is issued by your Private Certificate Authority.</p>
<h1 id="Encryption-Summary"><a href="#Encryption-Summary" class="headerlink" title="Encryption Summary"></a>Encryption Summary</h1><p>We’ve now gone through the key encryption services that could make an appearance on the exam. So now I just want to take a look at some of the differences between these services and features to make sure you can comfortably answer any questions that appear relating to this topic. Now, encryption isn’t always the favorite topic in the exam for people, but once you have grasped the essentials, you will find that the rest will soon fall into place.</p>
<p>So let’s focus on the KMS service first, which is by far the most common encryption service that’s mentioned. And you’ll see more questions on KMS than CloudHSM that’s for sure. So starting with KMS, the Key Management Service. From the name alone, it should be clear that this is used for some sort of encryption. Now, the Key Management Service is a managed service used to store and generate encryption keys that can be used by other AWS services and applications to encrypt your data.</p>
<p>Now, you’ve probably heard me mention a number of times through this entire learning path, about how KMS is integrated in one way or another for offering a way to encrypt data or logs. For example, KMS can be used with EBS for encrypting its volumes, or it can be used with RDS databases for encryption, or it can be used in conjunction with CloudTrail to encrypt log files. And again, where it’s used a lot is with S3. And you’ll probably see something about S3 and encryption on the exam.</p>
<p>Now, it’s important to understand that the KMS service is for encryption at rest. So if a question relates to encryption in-transit, then you’ll need to use a supporting service that uses SSL or similar to perform that in-transit encryption. Now the main key type in KMS is the CMK, the Customer Master Key. Now the CMK can either be AWS managed or customer managed, either way, it remains in the KMS service at all times, but it can be used to generate data encryption keys and these data encryption keys can leave the KMS service to help you encrypt other data. So key policies are used to define who can use and access a particular key within KMS, and every key must have a key policy. Now, the policies themselves define which users can administer the key and which can use the key for encryption.</p>
<p>Now, quickly I just want to highlight the other encryption option service that we covered, and that was the CloudHSM service. So this encryption service offers a physical single tenant, tamper-resistant hardware appliance that is used to protect and safeguard cryptographic material and encryption keys. Now, sometimes this is required to meet certain stringent compliance requirements as it gives you more control around your keys and the key data than that of KMS. You can also combine KMS and CloudHSM by creating a custom key store in KMS and this is then backed by CloudHSM. So if you need to use KMS, but require the security and compliance of maintaining your own key material outside of KMS, then you can create a custom key store, which would be backed by your CloudHSM cluster.</p>
<p>Okay, the last part of the encryption summary I want to talk about is S3 encryption. This will more than likely come up in the exam, so it’s a good idea to understand what options are available. Be sure to understand that S3 offers both server-side and client-side encryption options. So server-side encryption options include the default encryption with S3, which is SSE-S3, whereby S3 manages the encryption keys for you. You simply just need to tell S3 you want your object encrypted and S3 will handle everything else. However, if you want to encrypt your data with a specific CMK, you can use SSE-KMS. And as we know, this is the Key Management Service. So you can create your own CMK in KMS and then use this key to encrypt your object data.</p>
<p>Now, the last service-side encryption option allows you to supply your own encryption key that sits outside of KMS using the SSE-C option. So the client-side encryption options include CSE-KMS. Here you can use an AWS SDK to request data encryption keys from KMS to allow the end client to perform the encryption before the object is uploaded to S3 and you also have a client-side encryption option using customer managed keys too, with CSE-C. Now, the main encryption options that you’re most likely to see in the exam, include SSE-S3 and SSE-KMS.</p>
<p>Okay, you’ve made it through the last part of this section. Congratulations, that’s another one down. So just remember that KMS is integrated into many different AWS services to provide a secure method of creating and managing encryption keys to protect your data, whereas CloudHSM enables you to easily generate and use your own encryption keys with greater control over the underlying key material. And S3 encryption options to focus on include, SSE-S3 and SSE-KMS, but it would serve you well to have an understanding of all the options available to you.</p>
<p>Okay, when you’re ready, on to the next section.</p>
<h1 id="3Components-of-KMS"><a href="#3Components-of-KMS" class="headerlink" title="3Components of KMS"></a>3<strong>Components of KMS</strong></h1><p><a target="_blank" rel="noopener" href="https://csrc.nist.gov/projects/cryptographic-module-validation-program/Certificate/3139">FIPS 140-2 Validated Cryptographic Modules</a></p>
<h1 id="5Key-Management"><a href="#5Key-Management" class="headerlink" title="5Key Management"></a>5<strong>Key Management</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/kms/latest/developerguide/importing-keys-encrypt-key-material.html">Encrypting Imported Key Material</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/kms/latest/developerguide/deleting-keys-creating-cloudwatch-alarm.html">Creating an Amazon CloudWatch Alarm to Detect Usage of a Customer Master Key that is Pending Deletion</a></p>
<h1 id="6Sharing-CMKs-Across-Multiple-AWS-Accounts"><a href="#6Sharing-CMKs-Across-Multiple-AWS-Accounts" class="headerlink" title="6Sharing CMKs Across Multiple AWS Accounts"></a>6<strong>Sharing CMKs Across Multiple AWS Accounts</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/overview-of-aws-identity-and-access-management-iam/">Course: Overview of AWS Identity &amp; Access Management (IAM)</a></p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/">Course: How to use KMS Key Encryption to Protect your Data</a></p>
<h1 id="7What-is-CloudHSM"><a href="#7What-is-CloudHSM" class="headerlink" title="7What is CloudHSM?"></a>7<strong>What is CloudHSM?</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">Course: How to Use KMS Key Encryption to Protect Your Data</a></p>
<h1 id="8Understanding-AWS-CloudHSM-Architecture-amp-Implementation"><a href="#8Understanding-AWS-CloudHSM-Architecture-amp-Implementation" class="headerlink" title="8Understanding AWS CloudHSM Architecture &amp; Implementation"></a>8<strong>Understanding AWS CloudHSM Architecture &amp; Implementation</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cloudhsm/latest/userguide/initialize-cluster.html">AWS Documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cloudhsm/latest/userguide/install-and-configure-client-linux.html">Full list of commands</a></p>
<h1 id="15Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C"><a href="#15Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C" class="headerlink" title="15Client-Side Encryption with Customer Provided Keys (CSE-C)"></a>15<strong>Client-Side Encryption with Customer Provided Keys (CSE-C)</strong></h1><p><a target="_blank" rel="noopener" href="https://awsinfographics.s3.amazonaws.com/S3_Encryption_Infographic.png">S3 Encryption Infographic</a></p>
<h1 id="16Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets"><a href="#16Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets" class="headerlink" title="16Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets"></a>16<strong>Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets</strong></h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/amazon-web-services-key-management-service-kms/kms-encryption-introduction/">Course: How to Use KMS Key Encryption to Protect Your Data</a></p>
<p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-secrets-manager/introduction/">Course: Sharing Secrets Between Multiple Accounts Using AWS Secrets Manager</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AWS-Solution-Architect-Associate-Knowledge-Check-Management-SAA-C03-2-of-2-47/" rel="prev" title="AWS-Solution-Architect-Associate-Knowledge-Check-Management-SAA-C03-2-of-2-47">
      <i class="fa fa-chevron-left"></i> AWS-Solution-Architect-Associate-Knowledge-Check-Management-SAA-C03-2-of-2-47
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AWS-Solution-Architect-Associate-Encrypting-S3-Objects-Using-SSE-KMS-49/" rel="next" title="AWS-Solution-Architect-Associate-Encrypting-S3-Objects-Using-SSE-KMS-49">
      AWS-Solution-Architect-Associate-Encrypting-S3-Objects-Using-SSE-KMS-49 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Encryption-SAA-C03-Introduction"><span class="nav-number">1.</span> <span class="nav-text">Encryption (SAA-C03) Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-KMS"><span class="nav-number">2.</span> <span class="nav-text">What is KMS?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Components-of-KMS"><span class="nav-number">3.</span> <span class="nav-text">Components of KMS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Start-of-SSE-KMS-Sketch-Demonstration"><span class="nav-number">3.0.1.</span> <span class="nav-text">Start of SSE-KMS Sketch Demonstration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#End-of-SSE-KMS-Sketch-Demonstration"><span class="nav-number">3.0.2.</span> <span class="nav-text">End of SSE-KMS Sketch Demonstration</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Understanding-Permissions-amp-Key-Policies"><span class="nav-number">4.</span> <span class="nav-text">Understanding Permissions &amp; Key Policies</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Start-of-demonstration-1"><span class="nav-number">4.0.1.</span> <span class="nav-text">Start of demonstration 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#End-of-demonstration-1"><span class="nav-number">4.0.2.</span> <span class="nav-text">End of demonstration 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Start-of-demonstration-2"><span class="nav-number">4.0.3.</span> <span class="nav-text">Start of demonstration 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#End-of-demonstration-2"><span class="nav-number">4.0.4.</span> <span class="nav-text">End of demonstration 2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Key-Management"><span class="nav-number">5.</span> <span class="nav-text">Key Management</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Start-of-demonstration"><span class="nav-number">5.0.1.</span> <span class="nav-text">Start of demonstration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#End-of-demonstration"><span class="nav-number">5.0.2.</span> <span class="nav-text">End of demonstration</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sharing-CMKs-Across-Multiple-AWS-Accounts"><span class="nav-number">6.</span> <span class="nav-text">Sharing CMKs Across Multiple AWS Accounts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-CloudHSM"><span class="nav-number">7.</span> <span class="nav-text">What is CloudHSM?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Understanding-AWS-CloudHSM-Architecture-amp-Implementation"><span class="nav-number">8.</span> <span class="nav-text">Understanding AWS CloudHSM Architecture &amp; Implementation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-CloudHSM-as-a-Custom-Key-Store-in-KMS"><span class="nav-number">9.</span> <span class="nav-text">Using CloudHSM as a Custom Key Store in KMS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview-of-Encryption-Mechanisms"><span class="nav-number">10.</span> <span class="nav-text">Overview of Encryption Mechanisms</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Server-Side-Encryption-with-S3-Managed-Keys-SSE-S3"><span class="nav-number">11.</span> <span class="nav-text">Server-Side Encryption with S3 Managed Keys (SSE-S3)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Server-Side-Encryption-with-KMS-Managed-Keys-SSE-KMS"><span class="nav-number">12.</span> <span class="nav-text">Server-Side Encryption with KMS Managed Keys (SSE-KMS)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Server-Side-Encryption-with-Customer-Provided-keys-SSE-C"><span class="nav-number">13.</span> <span class="nav-text">Server-Side Encryption with Customer Provided keys (SSE-C)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Client-Side-Encryption-with-KMS-Managed-Keys-CSE-KMS"><span class="nav-number">14.</span> <span class="nav-text">Client-Side Encryption with KMS Managed Keys (CSE-KMS)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C"><span class="nav-number">15.</span> <span class="nav-text">Client-Side Encryption with Customer Provided Keys (CSE-C)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets"><span class="nav-number">16.</span> <span class="nav-text">Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Digital-Certificates-and-AWS-Certificate-Manager"><span class="nav-number">17.</span> <span class="nav-text">Digital Certificates and AWS Certificate Manager</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Working-with-AWS-Certificate-Manager-Public-Certificates"><span class="nav-number">18.</span> <span class="nav-text">Working with AWS Certificate Manager Public Certificates</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Working-with-AWS-Certificate-Manager-Private-Certificate-Authorities"><span class="nav-number">19.</span> <span class="nav-text">Working with AWS Certificate Manager Private Certificate Authorities</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Encryption-Summary"><span class="nav-number">20.</span> <span class="nav-text">Encryption Summary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3Components-of-KMS"><span class="nav-number">21.</span> <span class="nav-text">3Components of KMS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5Key-Management"><span class="nav-number">22.</span> <span class="nav-text">5Key Management</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6Sharing-CMKs-Across-Multiple-AWS-Accounts"><span class="nav-number">23.</span> <span class="nav-text">6Sharing CMKs Across Multiple AWS Accounts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7What-is-CloudHSM"><span class="nav-number">24.</span> <span class="nav-text">7What is CloudHSM?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8Understanding-AWS-CloudHSM-Architecture-amp-Implementation"><span class="nav-number">25.</span> <span class="nav-text">8Understanding AWS CloudHSM Architecture &amp; Implementation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15Client-Side-Encryption-with-Customer-Provided-Keys-CSE-C"><span class="nav-number">26.</span> <span class="nav-text">15Client-Side Encryption with Customer Provided Keys (CSE-C)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#16Using-AWS-Secrets-Manager-to-Manage-Rotate-and-Retrieve-Secrets"><span class="nav-number">27.</span> <span class="nav-text">16Using AWS Secrets Manager to Manage, Rotate, and Retrieve Secrets</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
