<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionHello and welcome to the course on configuring Azure Web Application Firewall. My name is Travis Roberts, I’m an Azure Solutions Architect Expert, Microsoft Certified Trainer, and Microsof">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-700-Configuring-Azure-Web-Application-Firewall-19">
<meta property="og:url" content="https://example.com/2022/11/18/AZ-700-Configuring-Azure-Web-Application-Firewall-19/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionHello and welcome to the course on configuring Azure Web Application Firewall. My name is Travis Roberts, I’m an Azure Solutions Architect Expert, Microsoft Certified Trainer, and Microsof">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T00:10:59.000Z">
<meta property="article:modified_time" content="2022-11-23T03:32:32.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AZ-700-Configuring-Azure-Web-Application-Firewall-19/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-700-Configuring-Azure-Web-Application-Firewall-19 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Configuring-Azure-Web-Application-Firewall-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-700-Configuring-Azure-Web-Application-Firewall-19
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:59" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:59-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 23:32:32" itemprop="dateModified" datetime="2022-11-22T23:32:32-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Configuring-Azure-Web-Application-Firewall-19/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Configuring-Azure-Web-Application-Firewall-19/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hello and welcome to the course on configuring Azure Web Application Firewall. My name is Travis Roberts, I’m an Azure Solutions Architect Expert, Microsoft Certified Trainer, and Microsoft MVP with over 20 years of experience with Microsoft Infrastructure. I’m excited to get started on this journey to learn about the Web Application Firewall.</p>
<p>In this course, you’ll learn to implement and associate rule sets for the Application Gateway, including Microsoft managed and user-defined rules. Implement and associate rule sets for Azure Front Door, including Microsoft managed and user-defined rules. Configure detection or prevention mode. And configure logging for the Web Application Firewall. Coming up, we’ll get started with an overview of what the Web Application Firewall is and how it fits with the Azure Application Gateway, Azure Front Door, and Azure Content Delivery Network. After that, we’ll review and walk through implementing a Web Application Firewall policy for an application gateway, then configure the rule sets with custom rules.</p>
<p>Next, we’ll implement and configure a Web Application Firewall policy for Azure Front Door. Finally, we’ll review logging options then walk through enabling the Web Application Firewall diagnostic logs. Thank you for taking this course, please don’t forget to rate this course when you’re finished. Your feedback is greatly appreciated. I look forward to seeing you in the next lecture to get started.</p>
<h1 id="Introduction-to-Web-Application-Firewall"><a href="#Introduction-to-Web-Application-Firewall" class="headerlink" title="Introduction to Web Application Firewall"></a>Introduction to Web Application Firewall</h1><p>Welcome to our first lecture. A good place to start is at the beginning, so let’s get started with what exactly is a Web Application Firewall? Let’s start with what a firewall is first. Although there are many variations of firewall solutions available, in it’s simplest form, a firewall is a device, physical or virtual, that separates a trusted network from an untrusted network.</p>
<p>Commonly, an internal private network and a public network, such as the internet. Rules are created on the device that deny or allows access between the two networks. Without a firewall, our private internal resources would be exposed to the internet. The traditional firewall model does not offer much protection for web applications. Web applications need to be available to the public network to be useful. Because of that, web applications are exposed to common malicious attacks and vulnerabilities.</p>
<p>A Web Application Firewall protects web applications from these common exploits. To better understand what makes a Web Application Firewall different from a traditional firewall, let’s compare the two. A traditional firewall will allow or deny traffic based on source and destination traffic, including IP addresses and ports.</p>
<p>For a public web application to work, common web ports 80 and 443 need to be open from the public internet to the internal network. This offers some protection to the internal private network but not much protection for the web applications. There are common web exploits and vulnerabilities that simple port blocking won’t stop. For example, SQL injection, where an input such as a username is formatted with a SQL statement that returns information not intended to be public; or cross-site scripting that injects malicious scripts into trusted websites that’s executed on visitor’s web browser. </p>
<p>There are also malicious bots or web-based automation processes that search for sites with vulnerabilities and known exploits. There are many other exploits cataloged as Common Vulnerabilities and Exposures or CVEs. A CVE is a method of publishing and sharing information on newly-discovered vulnerabilities. The list goes on. There are a lot of attack vectors for web-based applications. Command injections, HTTP Request Smuggling, remote file inclusions, PHP and Java attacks, just to name a few. It would be impossible for most organizations to monitor and manage all these attack vectors. </p>
<p>Let’s look at how Azure Web Application Firewall can help. A Web Application Firewall goes beyond simple source and destination port and IP address information, and inspects the traffic passed between the client and web service. It checks for these known exploits and blocks malicious traffic before it gets to the service hosting the application. The Web Application Firewall uses a collection of rules and policies to protect web-based services and applications.</p>
<p>There are two types of rules available with the Web Application Firewall. The first is a custom rule. As the name implies, custom rules are ones we create and manage. These are helpful in some situations but with all the current and emerging threats, creating and managing all the security rules would be problematic. These custom rules are processed before the second type: managed rules. A managed rule is a collection of Azure-managed pre-configured rules. These rules include Core Rule Sets or CRS 3.1, 3.0, and 2.2.9 as well as bot mitigation and other Azure-specific rules. We’ll cover core rules and bot mitigation further in this course.</p>
<p>These options allow us to benefit from Microsoft’s threat intelligent investment. Microsoft runs one of the largest networks in the world and respond to new threats on a daily basis. Once rules are created, we have two options or modes for these rules. We can enable detection mode. Detection mode monitors and logs threats. This is a good option for initial deployment to monitor what may be blocked without stopping traffic. It can also be helpful for advanced threat detection and investigation. Prevention mode blocks attacks the rule detects. When a rule is blocked, the user will get a 403 unauthorized access error and the attempt is logged. The Web Application Firewall supports three services: Azure Application Gateway, Azure Front Door, and Azure Content Delivery Network or CDN. Each has a features and options specific to the service. Let’s take a look at each next.</p>
<h1 id="Web-Application-Firewall-with-Azure-Application-Gateway"><a href="#Web-Application-Firewall-with-Azure-Application-Gateway" class="headerlink" title="Web Application Firewall with Azure Application Gateway"></a>Web Application Firewall with Azure Application Gateway</h1><p>The Web Application Firewall works with multiple Azure services including the Azure Application Gateway. An application gateway is a web traffic load balancer. Unlike traditional load balancers that work on layer 4 of the network stack, leveraging the source and destination port and IP address for load balancing decisions, an Application Gateway makes load balancing decisions at layer 7 based on HTTP requests.</p>
<p>The Application Gateway provides advanced features such as SSL or TLS termination. With this option traffic between the application gateway and the backend servers is passed over a secure network unencrypted so the backend servers don’t have the overhead of encrypting and decrypting traffic. This is optional, the Application Gateway also supports end-to-end encryption. It supports autoscaling to scale up or down based on traffic load, URL-based routing, directing web requests to specific backend pools based on the URL, connection draining to gracefully remove users from a backend pool, custom Error Pages, and it can rewrite HTTP headers and URLs to pass additional information with a web request.</p>
<p>These are just a few of the features available with the Azure Application Gateway. But how does this fit with the Web Application Firewall? Let’s review the SKUs available for the Application Gateway. A SKU refers to the different sizes and versions available for a product. An Application Gateway has three sizes: Small, Medium, and Large. There are two types of gateways available, a basic application gateway and a Web Application Firewall Application Gateway. When we deploy an application gateway, we have the option to deploy it with or without a Web Application Firewall.</p>
<p>Notice that the firewall is only available with a Medium and Large option. There is also a Version 2 Application Gateway that’s sized and priced slightly differently but still has an option with or without the Web Application Firewall. Pricing will depend on the region and the currency used, but as you may expect, the option with the Web Application Firewall costs more than without.</p>
<p>The steps for deploying an application gateway with a Web Application Firewall include first configuring the application gateway, then creating and applying the Web Application Firewall rules. These rules can be centrally managed and applied to one or more application gateway providing uniform management across multiple application gateways. We’ll walk through deploying an application gateway with a Web Application Firewall in an upcoming demo. Let’s review the Web Application Firewall options next.</p>
<h1 id="Web-Application-Firewall-with-Azure-Front-Door"><a href="#Web-Application-Firewall-with-Azure-Front-Door" class="headerlink" title="Web Application Firewall with Azure Front Door"></a>Web Application Firewall with Azure Front Door</h1><p>Microsoft offers many solutions to create and support web-based applications. In this section, we review one of those solutions, Azure Front Door, and how it integrates with the Web Application Firewall. Azure Front Door is a globally scalable entry point for web applications hosted in Usher. It uses the Microsoft global edge network to create secure, fast, and scalable web applications.</p>
<p>With Azure Front Door, we can leverage Microsoft’s global network to deploy services close to users, and direct those users to best performing instance of the web application. Front Door provides access to the Microsoft network at the edge, improving performance and reliability. Clients get the most direct path to the best instance of the application. Some of the features available with Azure Front Door include increased performance with Anycast, allowing requests to reach the closest edge location with the fewest hops, and Split TCP, terminating the client connection at the front door edge and establishing a separate TCP connection with a higher latency to the backend for the client.</p>
<p>Intelligent health probes that monitor the backend resource, URL path-based routing, cookie-based session affinity, SSL offloading and certificate management, and custom domains are also included with the Front Door service. At the time of this recording, there are three versions of Azure Front Door available. The first is Azure Front Door. The Web Application Firewall can be associated with this version of Front Door.</p>
<p>Pricing is based on a fixed charge for the Web Application Firewall and additional charges for custom and managed rules. There is also an Azure Front Door Standard and Premium currently in public preview. Public Preview offers a limited service-level agreement, or SLA. That should be considered before using it for production workloads. Standard only supports Web application Firewall custom rules, while premium fully supports the Web Application Firewall. Pricing for Standard and Premium is based on a set monthly fee with additional data transfer charges.</p>
<h1 id="Web-Application-Firewall-with-Azure-Content-Delivery-Network"><a href="#Web-Application-Firewall-with-Azure-Content-Delivery-Network" class="headerlink" title="Web Application Firewall with Azure Content Delivery Network"></a>Web Application Firewall with Azure Content Delivery Network</h1><p>The third service with support for Web Application Firewall is the Azure Content Delivery Network. Latency, the time it takes for packets to transverse a network can be a performance killer for web applications. Content such as images and video take time to flow across the internet from the source server to the client. High latency can make an application feel slow and problematic.</p>
<p>A Content Delivery Network or CDN addresses latency issues by placing content closer to the users, thereby reducing latency. A CDN is a distributed network of servers that caches content closer to users. A CDN improves performance by reducing latency and limits the web server’s burden of serving content by making the content available from the CDN. Without a CDN, when a user request web content, it’s served directly from the web application servers.</p>
<p>Latency is introduced for any users not physically close to the application servers. With a CDN, the content is cached at edge servers when first accessed. When additional users form the same region access the content, it’s delivered from the CDN endpoint instead of from the application servers, reducing latency and the workload on the application servers and improving the end user’s experience.</p>
<p>The Web Application Firewall works with the CDN by applying policies to the CDN endpoints. This provides the CDN with protection from web-based vulnerabilities and exploits. At the time of this recording, the Web Application Firewall with the Azure CDN is in public preview. There is a limited Service Level Agreement while in public preview. Take that into consideration before using it for production workloads.</p>
<p>The Azure CDN supports dynamic site acceleration to improve performance for dynamic websites, sites that don’t rely on static content. The CDN also supports caching rules that define how content is cached, such as the length of time the content is held in cache before it expires. The Azure CDN supports HTTPS custom domains, so content is delivered over an HTTPS connection. It also supports file compression, an option to compress files on the CDN, Geo filtering, a way to allow or block the CDN based on countries or regions, and Azure diagnostic logs for troubleshooting.</p>
<p>The Web Application Firewall with CDN is billed at a fixed rate per policy along with additional charges for the number of rules used and requests processed.</p>
<h1 id="Implementing-a-WAF-Policy-for-Application-Gateway"><a href="#Implementing-a-WAF-Policy-for-Application-Gateway" class="headerlink" title="Implementing a WAF Policy for Application Gateway"></a>Implementing a WAF Policy for Application Gateway</h1><p>Now that we understand the web Application Firewall with the Azure Application Gateway, let’s move on to deploying and managing the solution. Before we implement and associate a web Application Firewall policy, we need to create an environment to apply the policy to. This section starts with an overview of the Application Gateway solution, then we’ll move on to a demo on setting it up.</p>
<p>First, we’ll create an Application Gateway, this will have a public front-end IP. Next, we’ll create a backend pool that consists of two Windows servers running IIS, Microsoft’s web server service. This is a simple solution to demonstrate the Web Application Firewall and would work the same on other Application Gateway backends. After that, we’ll implement and associate the Web Application Policy with the web Application Gateway and test the solution to verify functionality. Access to an Azure subscription with rights to add resources is required for the upcoming demonstration. Also, two Windows server 2019 servers need to be provisioned for the backend pool. These are deployed to the backend pool VNet configured with the Application Gateway.</p>
<p>We also need to define settings for the deployment coming up. We need the Application Gateway, VNet, frontend, and backend settings, as well as routing, listener, and HTTPS settings names. A full list of values for the Application Gateway is on the screen. We need settings for the backend pool, including pool name, resource group, location, and virtual machine settings. We review options for deploying IIS in the demonstration. Finally, once we have the Application Gateway and backend pool in place, we can implement the policy with the settings on the screen, then associate the Web Application Firewall Policy to the Application Gateway. Please join me in the Azure portal to get started with deploying the Application Gateway.</p>
<h1 id="DEMO-Implementing-a-WAF-Policy-for-Application-Gateway"><a href="#DEMO-Implementing-a-WAF-Policy-for-Application-Gateway" class="headerlink" title="DEMO: Implementing a WAF Policy for Application Gateway"></a>DEMO: Implementing a WAF Policy for Application Gateway</h1><p>Here we are in the Azure Portal. Let’s start by adding a new resource. We’ll search for Application Gateway, select Application Gateway, and Create. We’ll fill in the details we defined in the settings table earlier. We’ll create a new resource group, give the Application Gateway instance a name, change the region Central US for this example. Next is where we define the tiers. There’s a Standard and a Standard V2 and a web application firewall and Web Application Firewall V2. This example uses the Web Application Firewall V2. We can leave the rest as is and scroll to the bottom. We could use an existing virtual network.</p>
<p>For this example, we’ll create a new virtual network. Give the virtual network a name, let’s update the address space. This defines all the IP address blocks in the VNet. We’ll get rid of the default and add the range we defined earlier. We’ll create two subnets, one for the gateway and one for the backend pool, once added, click OK and we’ll move on to Frontends. Be sure public is selected for Frontend IP address type and we’ll create a new Public IP. Give it a name and click OK. Now we can move to Backends. Add a Backend pool, select the option to add a backend pool without targets. We’ll add them shortly. Click Add and go to Configuration.</p>
<p>From here we go to Routing Rules, add routing rule give the routing rule a name and update the listener name. The frontend is public and set the protocol to HTTP and Port 80. Leave the rest as is and go to Backend targets, under Backend target select the Backend pool, under HTTP settings I Add New, this sets the behavior of the routing rule. Give the HTTP settings a name. We can leave the rest as default, click Add, and add the routing rule. Next, go to Tags, add tags as needed and go to Review and Create. Once validation passes click Create. We’ll pause here and come back once it’s finished. </p>
<p>The Application Gateway deployment is finished. Next, let’s go to the Virtual Machines used for the backend pool. We could add IIS manually, optionally, we can configure it through Azure using PowerShell and the set az vm extension command. We’ll do this by first opening the cloud shell and we’ll run the command set az vm extension. This command specifies the resource group name, extension name, VM, publisher, extension type, type handler version, setting string that will update IIS with a custom webpage that displays the computer name and location. This command will deploy IIS to newly created windows server and Virtual Machines. This command will take a minute to finish. We’ll pause here and come back once it’s done.</p>
<p>That finished, let’s run it again this time for the second VM. And again we’ll pause here and come back once it’s done. The second VM completed successfully, once finished we can is the cloud shell. Now that the VMs are configured and the Application Gateway is finished, let’s add the backend servers to the pool. Here we are in the Application Gateway we just created, go to Backend pools, select the Backend pool we created earlier, set the target type to Virtual Machine, associate the target with the first VM we created. Repeat the steps for the second Virtual Machine. Once finished, click Save. That is how we configure the Azure Application Gateway and Backend pool.</p>
<p>Next, we implement an associate, a Web Application Firewall Policy to our Application Gateway. From the Portal, create a new resource and search for Web Application Firewall. Select Web Application Firewall and Create. Set the policy for Application Gateway. Notice that the other two services that support the Web Application Firewall Azure Front Door and Azure CDN are listed. Set the subscription and provide a resource group. Provide a name and go to Association Add an association and select Application Gateway. Check the box to apply the Web Application Firewall Policy even if it’s different from the current config. This will override the existing configuration. Click Add, next go to Review and Create, once validation passes, click Create. Let’s pause here until it finishes.</p>
<p>That finished, let’s test the Application Gateway next. Go to the Application Gateway, once in the Application Gateway, copy the Public IP address from the overview page. Open a web browser and go to the IP. We’ll get a webpage with a name of one of the two servers in return. This indicates the Application Gateway is working correctly. That is how to create an Application Gateway and Backend pool and implement an associate, a Web Application Firewall Policy.</p>
<h1 id="Configuring-Rule-Sets-for-Application-Gateway"><a href="#Configuring-Rule-Sets-for-Application-Gateway" class="headerlink" title="Configuring Rule Sets for Application Gateway"></a>Configuring Rule Sets for Application Gateway</h1><p>Now that we have a Web Application Firewall policy applied to our Application Gateway, let’s review how we can modify and customize the rule set. As we explore the different rule options for the Web Application Firewall, keep in mind that a single rule may not be enough for an Application Gateway. An Application Gateway can have multiple sites and paths behind it. Each may have a specific policy requirement different from the others. There’s no limit to the number of Web Application Firewall policies we can create, and we can apply the policies globally to the Application Gateway at the site hosted by the Application Gateway or apply to specific paths in a site.</p>
<p>For example, say there are two sites behind an Application Gateway, we could create a global policy with a basic set of rules and apply that to the gateway. This policy would apply to all sites hosted by the Application Gateway. Then other policies can be applied to each site with more specific settings related to that site. These are associated with the HTTP listener for the site. We can get even more specific down to the URI of the site with a Per-URI policy applied to the route path. Policies can also be applied to multiple targets. So for example, we can apply the global application gateway policy to each application gateways in the environment. </p>
<p>Multiple policies and targets are helpful for creating granular security rule settings in an environment, but care should be taken when using multiple policies as they can make the rule sets difficult to read and troubleshoot. There are two types of rules available in a web application policy: managed rules and custom rules. Let’s take a look at managed rules next.</p>
<p>As we review managed rules, it’s helpful to know the origins of the Core Rule Set, or CRS. The Core Rule Set are rules based on the Open Web Application Security Project, or OWASP. OWASP is a nonprofit foundation with a goal of improving software security. OWASP is a community-driven organization with tens of thousands of members and chapters worldwide. OWASP offers tools and resources, community and networking events, and education and training. OWASP publishes a set of attack definition rules for compatible web application firewalls to protect web-based applications from a wide variety of attacks.</p>
<p>The Core Rule Set is designed to stop web-based attacks while minimizing false positive alerts. The CRS provides protection from many common attack vectors including SQL Injection, Cross Site Scripting, Local File Inclusion, Remote File Inclusion, PHP Code Injection, Java Code Injection, HTTPoxy, Shellshock, Unix and Windows Shell Injection, Session Fixation, Scripting Scanning Bot Detection, and metadata or error leakage. The Azure Web Application Firewall supports CRS 2.29, 3.0, 3.1, and 3.2. CRS 3.1 is the default and supports reduced false positives compared to 3.0 and 2.2.9. CRS 3.2 is currently in preview and has a new engine and rules to defend against Java infections. Managed Core Rule Sets can be modified, allowing for switching between rule sets and disabling specific rules as needed.</p>
<p>There’s another managed rule type to be aware of. Microsoft Bot Manager Rule Set or Bot Protection. A bot is an automated process that scans for vulnerabilities in a website. Microsoft estimates that 20% of all internet traffic comes from bad bots. Network bandwidth is not free, and reducing bandwidth by 20% by blocking bad bots is a good investment for Microsoft. Microsoft runs one of the largest networks in the world, and can identify these malicious bots with Microsoft Threat Intelligence.</p>
<p>By enabling Bot Protection, we can block or log requests from IP addresses identified as malicious by the Microsoft Threat Intelligence feed. Enabling Bot Protection secures the site by blocking traffic from malicious bots, it also prevents your application from wasting cycles, responding to invalid requests from these bots.</p>
<p>The second rule type is custom rules. Custom rules, as the name implies, provides the ability to create our own rules that evaluate requests as they pass through the Web Application Firewall. Custom rules have a higher priority over managed rules. A custom rule supports multiple conditions and compounding logic with an and or or statement.</p>
<p>So we can create three conditions, for example, and set the rule to match condition one and two or condition three. If a condition is met, we can set the action to allow or block the request. A custom rule has several required and optional fields. These include a name, that’s what appears in the log. A priority, this is a value from one to 100 processed from low to high, this has to be unique across all custom rules, we can’t have two rules with the same priority. There’s a list of variables to match the rule to. This includes items such as remote address, request method, query string, header and body information, and other variables.</p>
<p>Optionally, we can also include a selector that specifies a field of a match variable. There are several operators we can provide to the rule including IP match, contains, less than, greater than, and others. We can also negate the condition and transform strings before the match attempt with the transform option. The rule requests a list of matched values, a list of values to match against. Each value represents an or condition.</p>
<p>Once the rule condition is met, we can set the rule to allow, block, or log. Allow authorizes the transaction and skips all other rules. Allowed rules aren’t evaluated for other custom or managed rules. Block stops the transaction with no further processing of custom or managed rules. The log action writes the transaction to the log file and continues processing other custom and managed rules.</p>
<p>Finally, the last type of custom rule we can configure is a geomatch rule. A geomatch rule is used to allow or deny access based on the source country or region of the transaction request.</p>
<p>Coming up next, we’ll walk through linking the Web Application Gateway policy to a second application gateway, configure managed rules, and create custom rules in the policy. To follow along, you will need the Web Application Gateway policy and Application Gateway from the previous demo. A second Web Application Gateway configured similar to the one we previously created. The second Web Application Gateway will not need the servers used as the backend host pool. Also, a computer deployed to a different country or region to test the custom rules. Let’s log into the portal and review configuring rule sets for the application gateway.</p>
<h1 id="DEMO-Configuring-Rule-Sets-for-Application-Gateway"><a href="#DEMO-Configuring-Rule-Sets-for-Application-Gateway" class="headerlink" title="DEMO: Configuring Rule Sets for Application Gateway"></a>DEMO: Configuring Rule Sets for Application Gateway</h1><p>Here we are in the portal in the Web Application Firewall policy created previously. Let’s start by associating the policy with another application gateway. Go to Associated Application Gateways. Here you can see our existing application gateway, add an association. Notice we have the option to add an association to the application gateway, HTTP listener and specific path. For example, if we select listener, we can select a second gateway and a listener. Let’s cancel out of this and add an application gateway. Select the gateway to associate with and select the box to apply the configuration, click add and Save. This will associate the second application gateway to the Web Application Firewall policy. If you deploy a second application gateway but don’t see it, be sure it has the proper SKU. Now we have both application gateways associated with the policy. Any changes in the policy will update on both application gateways.</p>
<p>Let’s review Managed Rules next. Go to Manage Rules; under Manage Rule Set, we have the option to select the CRS version we want the policy to use. 3.1 is the default. The option to set it to 3.2, 3.0 or 2.29 is available. Notice we can’t select multiple CRS versions. Bot protection is off by default. Let’s enable it by selecting the Microsoft Bot Manager Rule Set. Let’s scroll down. We have a series of dropdowns for different rules in the rule set. We can see each by clicking expand all. This shows an extensive list of rules in the rules set. We can select any of these rules that gives us the option to disable the rule or enable the rule if it’s disabled.</p>
<p>Let’s collapse the OWASP rule, and we’ll expand the Microsoft Bot Mitigation Rule. This only shows one rule, The Microsoft Manage Known bad Bot Rule. The Microsoft Bot Manager Rule Set is off by default. Now, that we have it selected, let’s click Save to apply the configuration. Once the change is complete, let’s move on to custom rules. There are no custom rules set. Next, We’ll create a geomatch rule that will block all connections from outside the United States.</p>
<p>Let’s switch to another Azure VM that was deployed outside the US. Using iplocation.com, we can see that the computers IP is located in Ireland. Let’s open up the application gateway page and verify we can access the gateway, that works. Let’s create a blocking rule next. Next, we’ll go back to the portal, add a custom rule, give it a name BlockOutsideUS for this example; give it a priority, We’ll use 10 for this example. Under match type, we’ll select Geo location. Change the Match Variable to RemoteAddress. Changing the operation to, is not. Set the country or region to United States.</p>
<p>Notice that we can add multiple countries or regions. Leave the action to deny traffic and click Add. Once complete, Save the changes. Once saved, let’s go back to the VM located outside of the United States. And from here, we’ll try to access the application gateway again and it still works. Why is that? Let’s go back to the web Web Application Firewall policy. Go to overview, notice at the top it indicates the option to switch to prevention mode. When we deployed this policy, we deployed it in detection mode. This will monitor and log the policy, but does not block transactions.</p>
<p>Detection mode is recommended for newly implemented policies to verify actions before blocking transactions. Change the policy to Prevention Mode to enforce the policy action. Once complete, let’s go back to the computer outside of the US and try again. Now we get a 403 forbidden message. The connection was blocked. Let’s go back to a computer deployed in the US and try connecting to the application gateway, that works. Our custom policy is now blocking connections from outside of the US.</p>
<p>Let’s go back to the portal and add a second rule. We’re back on a computer located in the United States. This rule will apply specifically to this computer’s public IP address and block the connection, if the web browser is anything other than Chrome. We to get the computer’s public IP address. There are several ways to do this. We can open up another and go to iplocations.com. If the computer is an Azure VM, you can also find the public IP address in the portal. Save the IP address, we’ll need that shortly. Back at the new rule, Let’s give it a name, ChromeOnly for this example. Give it a priority of 15. This rule is processed after the previous one we created. Set the match type to IP address, does contain, and add the IP address for the computer we’re testing. Scroll down and add a new condition, set the Match type to String. Change the Match variable to Request Headers. Set the header name to User-Agent. This specifies the request header field. We have the option to add another match variable if needed. Change the operation to, is not. Set the transformation to lower case, and set the Match value to Chrome. With this rule, if a request comes from the computer’s IP address and the request header does not equal Chrome, traffic is denied.</p>
<p>Let’s Add the rule and Save. The rule finished saving. Let’s try to open the website from the computer with a public IP address we specified in the rule using Internet Explorer. Here we are an Internet Explorer and it’s letting us know that we should use Edge, but we’ll use Internet Explorer for this example. In here, we get the 403 forbidden. Next, let’s go to Chrome or Edge, since the new Edge browser uses the Chrome engine, we’ll go to our gateway IP, and that works successfully. That is how to configure manage rules, and two examples of creating customers in the Web Application Firewall policy.</p>
<h1 id="Configuring-Rule-Sets-for-Azure-Front-Door"><a href="#Configuring-Rule-Sets-for-Azure-Front-Door" class="headerlink" title="Configuring Rule Sets for Azure Front Door"></a>Configuring Rule Sets for Azure Front Door</h1><p>Welcome, in this lecture, we configure a Web Application Firewall policy for Azure Front Door. Just like with the Application Gateway, the Web Application Firewall policy with Azure Front Door protects against common exploits and vulnerabilities. There are a lot of similarities between the Web Application Firewall policy for Application Gateway and Azure Front Door. There are also some differences.</p>
<p>For starters, Azure Front Door works at the Microsoft Network Edge, and with the Web Application Firewall, malicious activity is blocked close to the attack source before it enters the Microsoft network. There are two types of rules for a Front Door Web Application Firewall policy. Custom rules authored by the end user at a set of preconfigured Azure managed rules.</p>
<p>Additionally, there are four rule actions available with custom and managed rules. Allow passes the request through with no further processing, Block stops the request, sends the response to the client, and stops processing the request. We can also log the request and continue evaluating the lower priority rules.</p>
<p>With Azure Front Door, we can also redirect the connection to a different URL allowing us to direct a request that matches a rule to a different URL. Just like the Application Gateway, we can deploy a policy in two modes. Detection mode doesn’t take any actions other than monitoring and logging requests that match rules and the policy.</p>
<p>Prevention mode takes the action specified when the rule is matched. Managed rules with a Front Door policy are applied with a default rule set or DRS. These rules are based on the OWASP categories and managed and updated by Azure to protect against new and emerging attack signatures. Each rule in the rule set can be enabled or disabled and the default action of block can be modified to allow log or redirect.</p>
<p>One of the available rule sets is written in partnership with a Microsoft Threat Intelligence team to provide increased patches for specific vulnerabilities with a lower false positive rate. There’s also a bot protection rule set in preview with three different categories of bots, bad bots that have been identified as malicious, good bots such as search engine crawlers, and unknown bots. Unknown are self-identified as market analyzers and other data collection bots.</p>
<p>The Azure Managed rule set includes rules to protect from cross-site scripting, Java attacks, local file inclusion, PHP injection attacks, remote command execution, remote file inclusion, session fixation, SQL injection protection, and protocol attacks. There are also custom rules available in a Web Application Firewall policy with Azure Front Door. Custom rules are processed managed rules.</p>
<p>Custom rules can be created to block or allow based on IPv4 and IPv6 addresses or the geography of the client IP. Rules can be created based on the HTTP and HTTPS request parameters and request methods. There is an option to crate rules based on size constraints, or the lengths of specific parts of a request and rate-limiting rules to prevent abnormally high traffic from a client IP address.</p>
<p>Coming up next, we are going to walk through a demonstration of implementing and assigning a Web Application Firewall policy to Azure Front Door. We create a custom response code that users will see when they are denied access, we’ll review and modify managed rules and add a bot protection rule. Finally, we’ll add a custom rule to the Web Application Firewall policy.</p>
<h1 id="DEMO-Configuring-Rule-Sets-for-Azure-Front-Door"><a href="#DEMO-Configuring-Rule-Sets-for-Azure-Front-Door" class="headerlink" title="DEMO: Configuring Rule Sets for Azure Front Door"></a>DEMO: Configuring Rule Sets for Azure Front Door</h1><p>Here we are in the portal. Let’s start by implementing a Web Application Firewall policy for Azure Front Door. From create a resource, search for WAF. Go to Web Application Firewall. And create. This policy is for global WAF Front Door. Set the Front Door SKU to match the version that was implemented. Front Door for this example. Verify the subscription and create a new resource group. This example will use DemoFrontDoorRG. Give the policy a name. This example uses DemoFrontDoor. Set the location, Central US for this example. Leave the policy state as enabled and change the policy mode to prevention. This will enforce the policy.</p>
<p>Setting a new policy to prevention is fine for a demo but you may wanna leave it set to detection and monitor it first when deploying a new policy in production. Let’s go to association next. We’ll associate this policy to the Front Door instance when we deploy it. Select your Front Door instance and host. And click Add. Go to review + create. Create the policy once it’s validated. This will take a minute to finish. I’ll pause here and come back once it’s done. That finished, let’s go to the resource. Next, let’s create a custom response code. This will replace the default 403 message users get when traffic is blocked. Go to policy settings in the policy. In the block response body, add the following HTML code. This will display a message that the user is blocked. The code azure-ref surrounded by double curly brackets will return a unique reference string in the response that matches the tracking references in the logs. Once that’s entered, click save. We’ll verify functionality shortly.</p>
<p>Before that, let’s go to managed rules. Here we are in managed rules. We can select any of the rules and once selected, we get the option to enable or disable. Notice, this rule is set to the action block. If we go to change action, we can change it to allow, log or redirect. If we click redirect, it gives us a field for the redirect URL. Let’s cancel. Next, go to assign. This is where we assign or change the default rule set. DefaultRuleSet_1.0 is selected. We can change that by selecting the dropdown. We have the option for the Microsoft_DefaultRuleSet and a preview rule set. Let’s select the Microsoft rule set. By default, the new policy doesn’t have bot protection enabled. To add it, select a bot protection option under additional rule sets. We’ll select Microsoft_BotManagerRuleSet for this example. When selected, click Save. Now we have Microsoft_BotManagerRuleSet and Microsoft_DefaultRuleSet enabled.</p>
<p>Let’s go to custom rules next. Before we create a custom rule, let’s verify Front Door works from this computer by going to the Front Door URL. It shows the default website for our web app. That shows the website is running. Let’s go back to the portal and from custom rules, we’ll add a custom rule. Notice, this is a similar layout to the custom rules for an Application Gateway Web Application Firewall. To test our custom response, we’ll create a rule that blocks traffic from the US. Give it a name, BlockUS, for this example, set the priority. 10 will work for this example. Set the match type to geolocation and leave the operation set to is. Select US from the country or region. Click add to add the rule. And click save to apply the rule. That applied. Let’s see if that took effect.</p>
<p>Open up the Front Door URL. It may take a couple minutes for the change to replicate. Once replicated, you’ll see the block message along with a reference ID. Good, the error message works. In production, that ID could be used to identify what rule is blocking the connection. Let’s go back to custom rules. Let’s modify this rule. There’s no site hosted on this instance of Front Door yet. Maybe instead of a block message, we could send them to a more useful site. Let’s change the rule name to RedirectUS. Leave the rest as is and go down to action. Instead of deny traffic, select redirect traffic. We’ll use a much more helpful link for this example. Let’s add the URL for cloudacademy.com. Update the rule and save the changes. That updated.</p>
<p>Let’s try the Front Door URL again. Remember, it could take a couple minutes for the change to replicate. Now instead of an error message, US-based users are redirected to a different website. That is how to implement and associate a policy, create a custom response code and configure managed and custom rules in a Web Application Firewall policy for Azure Front Door.</p>
<h1 id="Enabling-Web-Application-Firewall-Diagnostic-Logs"><a href="#Enabling-Web-Application-Firewall-Diagnostic-Logs" class="headerlink" title="Enabling Web Application Firewall Diagnostic Logs"></a>Enabling Web Application Firewall Diagnostic Logs</h1><p>Logs are an indispensable tool for troubleshooting issues with a firewall. In this lecture, we review options for logging with the web application firewall. There are four types of logs available for collecting data from the application gateway. Activity Log is a collection of management operations submitted to the application gateway. There’s an access resource log. This is a collection of application gateway access information such as client IP, request URL, return code, and bytes in and out. There’s a performance resource log with performance information about the application gateway. This includes information such as request service, throughput, failed request count, and backend pool status.</p>
<p>There’s also a Firewall Resource Log that tracks requests coming through the firewall policy while in detection or prevention mode. The Azure Front Door service has three options available for logging, like the application gateway, there’s an activity log that collects management actions on the Front Door service, the Front Door access log logs all requests made through Front Door. The last option, the Front Door Web Application Firewall Log logs requests that match a web application firewall policy rule.</p>
<p>There are four logging options available for Azure Front Door and the application gateway. Data can be logged to a storage account. The storage account is useful for long-term data retention, log files can be streamed to an Event Hub. Event Hub can then be used to link logs to a third-party security information and event management tool. We can log directly to Log Analytics, Azure’s logging platform that’s part of Azure Monitor. The data can then be monitored and reviewed from Azure Monitor. There are also a number of partner solutions we can send data to. These are non-Microsoft managed logging solutions, including Apache Kafka for Confluent Cloud, Datadog, Elastic and logz.io.</p>
<p>Coming up next, we’ll demonstrate how to configure logging to a storage account with Azure Gateway. Then review the log for block connection attempts. To follow along, you will need access to an Azure subscription with rights to add resources, as well as a web application policy configured and associated with an Application Gateway, similar to the configuration in the previous demonstration. Also required is a storage account to send the log files to. Please join me in the Azure Portal to get started.</p>
<h1 id="DEMO-Enabling-Web-Application-Firewall-Diagnostic-Logs"><a href="#DEMO-Enabling-Web-Application-Firewall-Diagnostic-Logs" class="headerlink" title="DEMO: Enabling Web Application Firewall Diagnostic Logs"></a>DEMO: Enabling Web Application Firewall Diagnostic Logs</h1><p>Logs are an indispensable tool for troubleshooting issues with a firewall. In this lecture, we review options for logging with the web application firewall. There are four types of logs available for collecting data from the application gateway. Activity Log is a collection of management operations submitted to the application gateway. There’s an access resource log. This is a collection of application gateway access information such as client IP, request URL, return code, and bytes in and out.</p>
<p>There’s a performance resource log with performance information about the application gateway. This includes information such as request service, throughput, failed request count, and backend pool status. There’s also a Firewall Resource Log that tracks requests coming through the firewall policy while in detection or prevention mode. The Azure Front Door service has three options available for logging, like the application gateway, there’s an activity log that collects management actions on the Front Door service, the Front Door access log logs all requests made through Front Door.</p>
<p>The last option, the Front Door Web Application Firewall Log logs requests that match a web application firewall policy rule. There are four logging options available for Azure Front Door and the application gateway. Data can be logged to a storage account. The storage account is useful for long-term data retention, log files can be streamed to an Event Hub. Event Hub can then be used to link logs to a third-party security information and event management tool.</p>
<p>We can log directly to Log Analytics, Azures logging platform that’s part of Azure Monitor. The data can then be monitored and reviewed from Azure Monitor. There are also a number of partner solutions we can send data to. These are non-Microsoft managed logging solutions, including Apache Kafka for Confluent Cloud, Datadog, Elastic and logz.io. Coming up next, we’ll demonstrate how to configure logging to a storage account with Azure Gateway. Then review the log for block connection attempts.</p>
<p>To follow along, you will need access to an Azure subscription with rights to add resources, as well as a web application policy configured and associated with an Application Gateway, similar to the configuration in the previous demonstration. Also required is a storage account to send the log files to. Please join me in the Azure Portal to get started.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations on finishing the course, Configuring Azure Web Application Firewall. We covered a lot in this course. We started out with an overview of what the Web Application Firewall is, and how it fits with an application gateway, Azure front door, and the Azure Content delivery network.</p>
<p>Next, we implemented and applied a Web Application Firewall policy to an Application Gateway then to an instance of Azure Front Door.</p>
<p>Finally, we configured diagnostic logging for the web application firewall policy. I thank you for spending your time on this course and please don’t forget to review the course now that you’ve finished. Your feedback is greatly appreciated.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-700-Managing-Connectivity-with-Azure-Network-Watcher-18/" rel="prev" title="AZ-700-Managing-Connectivity-with-Azure-Network-Watcher-18">
      <i class="fa fa-chevron-left"></i> AZ-700-Managing-Connectivity-with-Azure-Network-Watcher-18
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-700-Implementing-Azure-Private-Link-and-Azure-Private-Endpoints-20/" rel="next" title="AZ-700-Implementing-Azure-Private-Link-and-Azure-Private-Endpoints-20">
      AZ-700-Implementing-Azure-Private-Link-and-Azure-Private-Endpoints-20 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction-to-Web-Application-Firewall"><span class="nav-number">2.</span> <span class="nav-text">Introduction to Web Application Firewall</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-Application-Firewall-with-Azure-Application-Gateway"><span class="nav-number">3.</span> <span class="nav-text">Web Application Firewall with Azure Application Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-Application-Firewall-with-Azure-Front-Door"><span class="nav-number">4.</span> <span class="nav-text">Web Application Firewall with Azure Front Door</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web-Application-Firewall-with-Azure-Content-Delivery-Network"><span class="nav-number">5.</span> <span class="nav-text">Web Application Firewall with Azure Content Delivery Network</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Implementing-a-WAF-Policy-for-Application-Gateway"><span class="nav-number">6.</span> <span class="nav-text">Implementing a WAF Policy for Application Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Implementing-a-WAF-Policy-for-Application-Gateway"><span class="nav-number">7.</span> <span class="nav-text">DEMO: Implementing a WAF Policy for Application Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Rule-Sets-for-Application-Gateway"><span class="nav-number">8.</span> <span class="nav-text">Configuring Rule Sets for Application Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Configuring-Rule-Sets-for-Application-Gateway"><span class="nav-number">9.</span> <span class="nav-text">DEMO: Configuring Rule Sets for Application Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Rule-Sets-for-Azure-Front-Door"><span class="nav-number">10.</span> <span class="nav-text">Configuring Rule Sets for Azure Front Door</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Configuring-Rule-Sets-for-Azure-Front-Door"><span class="nav-number">11.</span> <span class="nav-text">DEMO: Configuring Rule Sets for Azure Front Door</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enabling-Web-Application-Firewall-Diagnostic-Logs"><span class="nav-number">12.</span> <span class="nav-text">Enabling Web Application Firewall Diagnostic Logs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Enabling-Web-Application-Firewall-Diagnostic-Logs"><span class="nav-number">13.</span> <span class="nav-text">DEMO: Enabling Web Application Firewall Diagnostic Logs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">14.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
