<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionHi there, and welcome to Getting Started with Azure Virtual Networks. My name is Thomas Mitchell and I’ll be taking you through this course. I’m an Azure instructor at cloud Academy and I">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-104-Getting-Started-with-Azure-Virtual-Networks-26">
<meta property="og:url" content="https://example.com/2022/11/18/AZ-104-Getting-Started-with-Azure-Virtual-Networks-26/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionHi there, and welcome to Getting Started with Azure Virtual Networks. My name is Thomas Mitchell and I’ll be taking you through this course. I’m an Azure instructor at cloud Academy and I">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T00:22:20.000Z">
<meta property="article:modified_time" content="2022-11-22T15:40:20.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AZ-104-Getting-Started-with-Azure-Virtual-Networks-26/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-104-Getting-Started-with-Azure-Virtual-Networks-26 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Getting-Started-with-Azure-Virtual-Networks-26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-104-Getting-Started-with-Azure-Virtual-Networks-26
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:20" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:20-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:40:20" itemprop="dateModified" datetime="2022-11-22T11:40:20-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Getting-Started-with-Azure-Virtual-Networks-26/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Getting-Started-with-Azure-Virtual-Networks-26/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hi there, and welcome to Getting Started with Azure Virtual Networks. My name is Thomas Mitchell and I’ll be taking you through this course.</p>
<p>I’m an Azure instructor at cloud Academy and I have over 25 years of IT experience, several of those with cloud technologies. If you have any questions about this course, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>.</p>
<p>This course is intended for those who wish to learn about Azure virtual networks, how to create them, and how to connect them.</p>
<p>We’re going to start things off with a vNet overview. You’ll learn about basic Azure virtual network concepts and about some key best practices. We’ll cover communications topics, filtering, routing, and integration, before working through a demo that shows you how to deploy a virtual network in Microsoft Azure.</p>
<p>After covering the basics of azure virtual networks in the first half of this course, we’ll use the second half to dive into VPNs, where you’ll learn about site-to-site VPNs, point-to-site VPNs, ExpressRoute, and vNet peering. You’ll even get to see a demo that shows you how to peer two vNets in Azure. </p>
<p>After finishing this course, you’ll come away with a foundational understanding of what Azure virtual networks are, how to deploy them, and how to connect them.</p>
<p>We’d love to get your feedback on this course, so please give it a rating when you’re finished. If you’re ready to learn about Azure virtual networks, let’s get started!</p>
<h1 id="Concepts-and-Best-Practices"><a href="#Concepts-and-Best-Practices" class="headerlink" title="Concepts and Best Practices"></a>Concepts and Best Practices</h1><p>Hello and welcome to concepts and best practices. In this lesson, we are going to take a look at some key vNet concepts and best practices that you should follow when deploying vNets.</p>
<p>Azure virtual networks are the foundation upon which many or most other Azure resources are built. They allow resources like virtual machines to securely communicate with each other, with resources deployed to on-prem networks, and with the Internet. While a virtual network in Azure is quite similar to a physical network that you would see in on-prem data center, the virtual network offers additional benefits, including improved availability, scalability, and isolation.</p>
<p>There are four key terms or concepts that you must be familiar with before deploying an Azure virtual network. They include the address space, subnets, regions, and subscriptions.</p>
<p>Whenever you deploy a virtual network in Azure, you’ll be prompted to define an address space. The address space that you define must consist of public or private addresses that conform to RFC 1918. When you deploy resources and attach them to a virtual network in Azure, the private IP addresses that are assigned to them are pulled from the address space that you define. For example, if you were to provision a virtual network with an address space of 192.168.0.0&#x2F;16, any resources that are connected to that virtual network would be assigned addresses from that range. Those devices would get addresses like 192.168.0.4, 192.168.0.5, and so on and so forth.</p>
<p>Just as they do in a physical network, subnets allow you to segment a specific virtual network into one or more different subnetworks, hence the name subnets. When you do this, what you are really doing is carving out a portion of the virtual network’s address space and assigning it to each subnet that you create. Azure resources can then be deployed to each subnet as necessary. Segmenting a virtual network address space into different subnets allows you to more efficiently leverage your addressing in a way that matches your organization’s requirements. Subnets also allow you to better secure resources through the use of network security groups.</p>
<p>When you deploy a virtual network in Microsoft Azure, it is scoped to a single region or location. That being said, if you need to enable connectivity across different regions, you can connect multiple virtual networks from multiple different regions through virtual network peering, which we will talk about in more detail later on.</p>
<p>In addition to being scoped to a single region or location, each virtual network that you deploy is scoped to a specific subscription.</p>
<p>there are several best practices that you should keep in mind as you build out your virtual networks in Microsoft Azure.</p>
<p>First and foremost, when deploying a virtual network, you need to ensure that the address space that you define for that virtual network does not overlap with any other network ranges that your organization uses. A real-world example of this best practice would be a situation where you plan to deploy a virtual network that will be connected to your physical on-prem network over a site to site VPN. If your on-prem network consists of a 192.168.0.0&#x2F;16 address space or subnet, you wouldn’t want your Azure virtual network to overlap that specific address space or subnet because such an overlap could cause routing issues.</p>
<p>Speaking of subnets, you should never create a subnet that encompasses the entire address space of the virtual network. In other words, if you deploy a virtual network with an address space of 192.168.0.0&#x2F;16, you really should not be creating a subnet for that virtual network with an address range of 192.168.0.0&#x2F;16. Instead, you should be planning ahead and leaving some of the address space available for future use. This means any subnets that are defined on that virtual network should only use a portion of the complete virtual network address space.</p>
<p>It’s also recommended that instead of defining numerous smaller virtual networks, you should define fewer larger virtual networks. By leveraging fewer large virtual networks rather than a bunch of little virtual networks, you can prevent or minimize management overhead.</p>
<p>And last but not least, you should be securing all virtual networks that you create with network security groups. By assigning network security groups to the subnets that have been defined for a virtual network, you can retain control over what traffic passes between those subnets.</p>
<p>For those who may not be familiar with network security groups, a network security group is an Azure resource that you use to filter network traffic to and from Azure resources that are attached to a virtual network. When you create a network security group, that security group contains security rules that you can define. These security rules are used to allow and deny inbound and outbound network traffic to and from your subnets and the resources that are attached to them.</p>
<p>For more information on network security groups, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">https://docs.microsoft.com/en-us/azure/virtual-network/security-overview</a></p>
<h1 id="Communications"><a href="#Communications" class="headerlink" title="Communications"></a>Communications</h1><p>Welcome to Communications! In this lesson, we are going to take a look at the different ways that Azure virtual networks facilitate communication.</p>
<p>The purpose of virtual networks in Azure is to allow Azure resources to securely communicate with one another, with the internet, and with on-prem networks.</p>
<p>By default, all resources that are connected to a virtual network can communicate outbound to the internet. To enable inbound communication from the internet to an Azure resource, you can either assign a public IP address to that resource OR you can by provisioning a public load balancer.</p>
<p>Communication between Azure resources can be achieved in a few different ways. For example, virtual machines and other types of Azure resources like Scale sets and App Service Environments can be deployed to a virtual network, which, in turn, allows for secure communications among those resources. </p>
<p>Virtual network service endpoints can also be used to facilitate communications. What a virtual network service endpoint does is allow you to extend a virtual network’s private address space and identity to certain Azure resources, like Azure Storage accounts and Azure SQL databases, over a direct connection. Service endpoints allow you to secure such Azure resources to only a virtual network.</p>
<p>vNet peering is another way that you can facilitate communication between Azure resources. When you peer a virtual network with another virtual network, what you are doing is connecting the two virtual networks together. When you do this, you allow azure resources on one virtual network to talk to the other virtual network that you are peered with.</p>
<p>When you need to connect your Azure virtual network to an on-prem network, you can use a point-to-site VPN, a site-to-site VPN, or ExpressRoute.</p>
<p>A point-to-site VPN allows you to establish a connection between a single computer in your on-prem network and your virtual network. When you use point-to-site connections to facilitate communication, you need to setup a separate point-to-site connection for each on-prem computer that needs to connect to the Azure virtual network. These types of connections are often used to allow remote workers to connect into your Azure virtual network so they can access Azure resources. This type of connection allows communication between the individual computer and your virtual network through an encrypted tunnel over the internet.</p>
<p>When you want to connect an entire on-prem network to an Azure virtual network, you can use a site-to-site VPN. This type of VPN establishes a secure, encrypted connection over the internet between an Azure VPN Gateway that’s deployed in the virtual network and the on-prem VPN device. </p>
<p>If a more robust connection is needed between Azure and your on-prem network, you can deploy an Azure ExpressRoute connection. An Azure ExpressRoute connection is a private connection between your on-prem network and your Azure environment. The traffic does not flow over the internet. This type of connection is established through an ExpressRoute partner.</p>
<p>So, before we dive into the next lesson, let’s just recap. </p>
<p>Virtual networks are used to facilitate communication with the internet, communication between Azure resources, and communication with an on-prem environment. Outbound communication to the internet is available by default, while inbound communications from the internet are achieved via a public load balancer or public IP address.</p>
<p>Communications between azure resources is achieved through a virtual network, a virtual network service endpoint, or through vNet peering.</p>
<p>To establish communications between an Azure environment and an on-prem environment, you can deploy a point-to-site VPN, and site-to-site VPN, or an Azure ExpressRoute connection.</p>
<p>Join me in the next lesson, where we will look at filtering, routing, and integration.</p>
<h1 id="Filtering-Routing-and-Integration"><a href="#Filtering-Routing-and-Integration" class="headerlink" title="Filtering, Routing, and Integration"></a>Filtering, Routing, and Integration</h1><p>Hello and welcome to Filtering, Routing, and Integration. In this lesson, we’ll take a look at ways you can filter network traffic in Azure and at ways you can route network traffic in Azure. We will also touch on ways you can integrate Azure services in a virtual network.</p>
<p>In a production environment, you’ll often find that you need to filter traffic between subnets. You’ll need to allow certain traffic while blocking other traffic. There are two key ways to accomplish this type of filtering. You can use security groups, or you can use network virtual appliances.</p>
<p>Security groups fall into two types: network security groups and application security groups. A network security group, when you create it in Azure, can be assigned to a specific NIC or to an entire subnet. Any rules that are defined within the network security group are then applied to that NIC or to all NICs and virtual machines on the subnet when the security group is applied to the entire subnet. This works for many, even most scenarios. However, if you need more flexibility, you can leverage an application security group.</p>
<p>When you deploy an application security group, you can logically group the NICs of several different virtual machines on the same virtual network and then apply a network security group rule to only those grouped NICs. This allows you to create different traffic rules for different groups of NICs on the same network without needing to assign the different rules on a one-off basis. You could essentially have a group of SQL VMs connected to the same vNet as your group of application VMs. Using a separate application security group for each group of VMs allows you to manage the network security rules for each different group of VMs – even though they all reside on the same network.</p>
<p>While security groups provide a great way to filter network traffic, you can also use network virtual appliances. A network virtual appliance (or NVA) is really just a virtual machine that is used to perform a specific network task. For example, you can deploy an NVA that acts as a firewall or one that provides WAN optimization.</p>
<p>Some available NVAs include the “Barracuda CloudGen WAF for Azure” and the “Citrix SD-WAN Center”.</p>
<p>While Azure automatically handles routing of network traffic between subnets, vNets, on-prem networks, and the internet by default, if you need to create your own routes, you can leverage route tables and BGP routes.</p>
<p>Route tables are custom tables that allow you to define custom routes that control how traffic is routed for each of your subnets. BGP routes, or border gateway protocol routes, are typically used when you connect an Azure virtual network to an on-prem network via an ExpressRoute connection or via an Azure VPN Gateway. In these scenarios, you use BGP routes to propagate your existing on-prem BGP routes to your virtual networks in Azure.</p>
<p>The details of how BGP works are out of scope for this getting started course but if you want to learn more about BGP, you can visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json</a></p>
<p>Before we wrap this lesson up, let’s talk a little bit about virtual network integration. When you integrate an Azure service to an Azure virtual network, what you are really doing is enabling private access to whatever service you are integrating from VMs or other compute resources that reside on the virtual network.</p>
<p>You can create these integrations in a few different ways. For example, you can deploy a dedicated HDInsight instance and directly transfer data between it and SQL server that’s running on a VM on the virtual network, via a private IP address.</p>
<p>For more technical details on this option, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services</a></p>
<p>Another way to achieve vNet integration is to use private links. A private link can be used to privately access a specific service instance from your virtual network or from your on-prem network.</p>
<p>To learn more about Private Link, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/private-link/private-link-overview">https://docs.microsoft.com/en-us/azure/private-link/private-link-overview</a></p>
<p>Lastly, you can use service endpoints to extend a virtual network to a specific Azure service. When you configure service endpoints to access an Azure service, you can secure that service to the virtual network. In other words, you can use service endpoints to create secure and direct connectivity to Azure resources over an optimized route across the Azure backbone network.</p>
<p>To learn more about service endpoints, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview</a></p>
<h1 id="DEMO-Provisioning-a-Virtual-Network"><a href="#DEMO-Provisioning-a-Virtual-Network" class="headerlink" title="DEMO: Provisioning a Virtual Network"></a>DEMO: Provisioning a Virtual Network</h1><p>Hello, and welcome back. What we’re going to do here in this brief demonstration is work through the process of creating a basic vanilla virtual network in the Microsoft Azure portal. On the screen here, you can see I’m actually showing my vNetDemos Resource Group here, which is where I’m going to deploy my virtual network. I currently have nothing deployed in this resource group.</p>
<p>So, this virtual network that we deploy is going to be the first resource that we put in here. To create my virtual network, what I’m going to do is click the hamburger up here in the left-hand corner. And then I’m going to click Create a resource here.</p>
<p>Now from the Marketplace here, I have two options. I can either browse to the virtual network from the Networking category under Azure Marketplace. Or what I can do is search for virtual network. So what we’ll do is we’ll create our virtual network, and then you’ll see here, we have a couple of different tabs we can work through. We have a Basics tab, an IP Addresses tab, a Security tab, Tags, and then Review and create.</p>
<p>In this Basics tab here, we need to provide some basic information about the virtual network we’re going to deploy. We need to tell Azure what subscription we want to deploy to, which resource group will host our new virtual network, and then information about the virtual network itself, which includes the name of the network and the region we want to deploy to. We’re going to deploy into our lab subscription here, and in the dropdown I’m going to select the vNetDemos Resource Group I already have.</p>
<p>Now, I could also create a new resource group here, but we’ll go ahead and select vNetDemos. And then what we’ll do is we’ll give our virtual network a name and we’ll just call it MyVnet. And we’ll deploy into Central US. This drop-down allows us to select any of the existing regions that are available. We’ll just leave it at Central US.</p>
<p>Now, if I click Review and create here, what Azure is going to do is it’s going to create the virtual network without giving me any kind of ability to specify the address space for that network. I don’t wanna do that here, so what we’ll do is we’ll click Next for IP Addresses.</p>
<p>Now, in the IP Addresses tab here, we see we already have a default subnet that Azure is going to give us, and it’s giving us a default address space for the virtual network. Now, what I could do is click next here for security to move on. But what we’ll do here is we’ll edit this address space. And instead of using 10.1.00&#x2F;16, we’ll go with 192.168.00&#x2F;16. The green check mark tells me it’s a valid address space, but now what Azure is telling me here is we don’t have any subnets to find. So we need to have a subnet.</p>
<p>So we’ll go ahead and click Add a subnet. And over here we need to name our, what is called really the default subnet, but we’ll just call this MySubnet. Now, the address range for the subnets, or not only this subnet, but any subnet that we define within this virtual network, the address range needs to fall within the address space that’s been defined for the virtual network itself. So I can’t give the subnet here an address range of 10.000, when the address space for the entire virtual network is 192.168.</p>
<p>So consider the address space of the virtual network as the umbrella, and any address range for any subnet within that virtual network needs to fall within that umbrella. So what we’ll do here is we’ll give my subnet an address range of 192.168.1.0&#x2F;24. And then when we do that, Azure is telling me how many usable addresses I have with that range.</p>
<p>Now, this service endpoints option here allows us to define service endpoints, and what these service endpoints do is allow us to send traffic to specific Azure resources from the virtual network over whatever our defined service endpoints are. If we select the dropdown here, we can see all of the different services that are available when we wanna create service endpoints.</p>
<p>Now we’re not going to do any service endpoints here. So we’ll close outta that and we’ll add our subnet. So now we have the address space of the virtual network as 192.168.00&#x2F;16. And then we have the subnet, which is a piece of that complete address space configured at 192.168.1.0&#x2F;24. So we’ll go ahead and click Next for Security.</p>
<p>Now in this Security tab, we have some security options that we can configure here. We can configure Bastion Host, DDoS protection, and Azure Firewall. Now, if we hover over the icon next to Bastion Host here, we can see that the Azure Bastion service is a fully platform-managed platform as a service service that you can provision inside the virtual network. You can use the Bastion Host service to essentially connect to your virtual machines in the Azure portal over SSL.</p>
<p>Now, you can connect to them via RDP in the case of Windows machines and via SSH for your Linux machines. The purpose of this Bastion Host service is to allow you to remote to your virtual machines over the internet, without needing to give them public IP addresses, because that’s always been a big no-no when you deploy a VM. You put a VM out on the public internet with a public IP, the only thing you have protecting your VM from the bad guys is a username and password, which can be brute-forced.</p>
<p>So, Bastion Host allows you to access those VMs without giving them public IP addresses. We’re not going to do anything with Bastion Host here, but I do wanna hover over here for DDoS protection. And this DDoS protection comes in two flavors, Basic and Standard. The Basic protection is built into the Azure platform by default, and incurs no costs. However, the Standard flavor of Azure DDoS protection is a premium service and it can get quite expensive quickly. And that’s because it offers lots of enhanced mitigation capabilities.</p>
<p>As you see here in this pop-up, you’ve got adaptive tuning, attack notification, and all kinds of telemetry to protect against different DDoS attacks. For this demonstration, we’ll just leave this at its Basic option. And then if we hover over Firewall here, we can see that Azure Firewall is really a managed Cloud-based network security service that you use to protect virtual network resources.</p>
<p>Now, if I click Enabled here for Firewall, we can see, I can give my firewall a name, and then I can specify the subnet address space for the firewall, which is separate from the actual virtual network we’re creating. And then of course, I need to give my firewall a public IP address. For this demonstration, we are not going to enable firewall. So we’ll disable this, we’ll click Next for Tags. And here is where we can provide tags for our resources that we’re deploying here. We’re not going to do any tagging here, so we can go ahead and click Review and create.</p>
<p>Now, what this does is provide us with the information that we’ve provided for our setup here. And what we can do here is validate that everything looks like it should. What Azure does here is validate that all of my options are valid. So we’re going to create my VNet with an address space of 192.168.00&#x2F;16, and then we have our subnet here.</p>
<p>Bastion Host is disabled. The DDoS protection plan was left at Basic, and we did not enable firewall. So we’ll go ahead and create the new virtual network. The creation of a virtual network takes just a few moments and we can see it’s already been completed. So we’ll go ahead and click Go to resource here. And we’re now in MyVNet.</p>
<p>If we click on Address space under Settings here, we can see we have the address space defined. Connected devices tells us what devices are connected. We haven’t deployed anything, so we don’t have anything connected. And then we can see what subnets are defined here. And then we could even add another subnet.</p>
<p>This option here for Gateway subnet we’ll get to later. This is used when you’re creating a VPN connection, and I’ll show you what this does later on. And of course, we have the DDoS protection, Firewall and Security, DNS servers that are assigned to this. By default new virtual networks get the Azure provided DNS servers assigned to them. And then we can look at any service endpoints, peerings, properties. And of course, you got the Monitoring options down here.</p>
<p>So with that, you now know how to deploy a pretty basic virtual network in Microsoft Azure.</p>
<h1 id="VPN-Gateways"><a href="#VPN-Gateways" class="headerlink" title="VPN Gateways"></a>VPN Gateways</h1><p>Welcome to VPN Gateways. Over the next few lessons and demos, we are going to dive into different types of VPNs that you can deploy in Azure. A key component of VPNs in Azure is the VPN Gateway, so let’s talk a little bit about what the VPN Gateway is and what it does.</p>
<p>Before you deploy a VPN connection in Azure, you need to deploy a VPN gateway. This VPN Gateway is a special kind of virtual network gateway. It’s typically used to send encrypted network traffic between an Azure virtual network and an on-prem network over the public internet. However, you can also use a VPN Gateway to send encrypted traffic between different Azure virtual networks over the Microsoft network if you wish.</p>
<p>You can only define one VPN gateway per virtual network. However, each VPN Gateway supports multiple connections to it. This allows you to connect multiple networks to the same gateway.</p>
<p>When you deploy a virtual network gateway, quite a few things happen under the hood. The process begins with Azure deploying at least two hidden VMs that you can’t see. These VMs are deployed to a gateway subnet that you specify during the gateway deployment, and they contain routing tables and the gateway services. Since they are hidden and used only by Azure, you cannot configure the VMs at all.</p>
<p>When you deploy a virtual network gateway, you need to tell Azure what type of gateway it should be. Specifying a type of “VPN” tells Azure that the gateway will be used to build a typical VPN connection. If you specify “ExpressRoute” as the type, the gateway will be configured for an ExpressRoute connection.</p>
<p>When you deploy a virtual network gateway, it can take up to 45 minutes for the deployment to complete. This makes sense since so much stuff happens under the hood. Once the gateway is deployed, you can create an IPSec or IKE VPN tunnel between the newly deployed virtual network gateway and any one of a number of other gateways. For example, you can create a vNet-to-vNet connection to another VPN gateway in Azure, or you can create a site-to-site connection to an on-prem VPN device. You can even create a point-to-site connection that will allow you to connect to your virtual network from a remote location.</p>
<p>To learn more about virtual network gateways, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways">https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways</a> </p>
<p>Later on, I’ll show you how to deploy a virtual network gateway and how to use it to build a site-to-site VPN connection.</p>
<h1 id="Site-to-Site-VPNs"><a href="#Site-to-Site-VPNs" class="headerlink" title="Site-to-Site VPNs"></a>Site-to-Site VPNs</h1><p>Welcome to Site-to-Site VPNs! In this lesson, we are going to look at what a site-to-site VPN is, why you would use it, and how you would deploy one.</p>
<p>In most cases, when you need to connect an on-prem network to an Azure virtual network, you’ll use a site-to-site VPN gateway. This type of connection allows you to establish an IPSec or IKE VPN tunnel between the on-prem network and the Azure vNet. To deploy this type of connection, you need to have a VPN device deployed on-prem. This on-prem VPN device needs to have a public IP address assigned to it so that the Azure-based VPN gateway can communicate with it.</p>
<p>The image that you see on your screen shows what a typical connection would look like.</p>
<p>The overall process for creating a site-to-site VPN connection is pretty straightforward. You start by creating the Azure virtual network that you’ll be connecting to the on-prem network. </p>
<p>Once you have the virtual network created, you create a gateway subnet on your virtual network, and then you create a VPN gateway. The creation of the gateway subnet takes just a few minutes to create, while the deployment of the VPN gateway can take up to 45 minutes to complete. </p>
<p>After you’ve created the VPN gateway, you can create the local network gateway. This local network gateway that you create represents the on-prem endpoint of the eventual VPN connection. </p>
<p>With both the VPN gateway and the local network gateway created, you need to configure the on-prem VPN device. This process will differ, based on the device you have. </p>
<p>Once the on-prem device is configured, you can deploy a VPN connection in Azure. This VPN connection creates the site-to-site connection between the VPN gateway, which represents the Azure side of the VPN, and the local network gateway, which represents the on-prem endpoint of the VPN connection.</p>
<p>Once the VPN connection is provisioned, you need to verify the connection.</p>
<p>Join me in the next lesson, where I’ll show you in more detail how to create a site-to-site VPN connection.</p>
<h1 id="DEMO-Building-a-Site-to-Site-VPN-Part-One"><a href="#DEMO-Building-a-Site-to-Site-VPN-Part-One" class="headerlink" title="DEMO: Building a Site-to-Site VPN - Part One"></a>DEMO: Building a Site-to-Site VPN - Part One</h1><p>Hello, and welcome back. In this demonstration here, what we’re going to do is deploy a site to site VPN. We are going to connect the MyVnet virtual network that we created earlier to an on-prem network. What we’re going to do here is deploy a virtual network gateway, a local gateway, and then we’re going to create a VPN connection that connects our virtual network gateway, which represents MyVnet, and we’re going to connect that to the local gateway, which is going to represent our VPN device on the on-prem network.</p>
<p>Now, what we need to do before we get started is deploy a gateway subnet on our MyVnet virtual network. Now, this gateway subnet is going to host the underlying VMs that Azure spins up to facilitate the VPN connection. These are VMs that we can’t see, but trust me, they’re there. To create our gateway subnet, what we do from our MyVnet virtual network here is select subnets. And then we can see, we have my subnet that was provisioned earlier. And then what we’re going to do is click on gateway subnet. And what this does is allow us to create this special subnet that the VPN will use to establish connectivity between MyVnet and the on-prem network.</p>
<p>What we need to do here is specify an address range for our gateway subnet. And if you notice, you can’t even change the name of gateway subnet. This name gateway subnet is important because Azure looks at that and says, oh, okay, this must be the subnet we need to use for this VPN gateway that we’re setting up.</p>
<p>Now, what we’re going to do here is change this CIDR block. Right now the default address range for our gateway subnet is one 192.168.00&#x2F;24. I don’t need a gateway subnet that encompasses most of my address space. So what we’ll do is we’ll make this a .2.0 and we’ll make it a &#x2F;28. So what I’ve just done here is I took a very small piece of my overall address space of 192.168.00, and carved it out for my gateway subnet.</p>
<p>Since only a few resources are deployed to this gateway subnet by Azure, we don’t need a whole lot of network addresses available. To be honest, even 11 here plus the five reserved is probably too many. We could probably even get away with a &#x2F;29 here, but we’ll go ahead and leave it at 28, just to make sure.</p>
<p>We don’t need to configure a gateway or any network security groups, routing tables… This stuff all is left at its default setting when creating a gateway subnet, so we’ll go ahead and click okay here. So we now have our gateway subnet deployed and what we’ll do now is create the virtual network gateway for our VPN. Now, this process is going to take 45 minutes to complete, so what I’m going to do is just walk you through the process of beginning the deployment, and then we’ll come back when the deployment is finished.</p>
<p>So let’s go ahead and hit the hamburger here and create a resource. And what we’ll do here is search for virtual network gateway. And we have it here and we’ll go ahead and create it. As you can see on your screen, there’s quite a bit of information we need to supply here, although a lot of these are defaults.</p>
<p>So what we’ll do here is we’ll deploy into the lab subscription. And what we’ll do here is we’ll call it my gateway. And we’ll deploy into Central US, which is where I typically install stuff. Now we have two choices of gateway here, either a VPN or ExpressRoute. We’re not deploying an ExpressRoute, so VPN is the default and we’ll leave it there. And the same thing with VPN type, we can deploy a route-based VPN or a policy-based VPN.</p>
<p>If we hover over the icon here for type, we can see that the VPN we choose is going to depend on the make and model of the VPN device we’re trying to connect to. It’s also gonna be driven by the kind of VPN connection we want to create. As you can see in this box, what we wanna do is choose the route based option if we’re going to create a point of site inter virtual network, or if we’re going to create multiple sites to site connections.</p>
<p>We can see that policy-based gateways only support IK V1. If we need IK V2, we need to go route based. For this demonstration here, we’re going to go route based. And then here we have the SKU. If we select the dropdown we can see all of the different options we have. We’re going to do basic here. But if I hover over SKU here, we can see that route-based VPNs are offered in three different SKUs, basic, standard, and high performance.</p>
<p>If we’re going to create a VPN that co-exists with ExpressRoute, we can see here that we need to choose standard or high performance. If we’re going to go active, active, we need to select high performance. This is a basic demonstration. We’re not doing anything crazy so we can get away with a basic generation one gateway.</p>
<p>If we hover over the icon here for virtual network, we can see that the virtual network that we specify in this dropdown is the virtual network that we’re going to configure so that it can send and receive traffic on this gateway. So what we’ll do here is we will select MyVnet and we can see here that it found the gateway subnet automatically.</p>
<p>Now, since the on-prem device needs to be able to communicate with this gateway over the internet, this gateway needs to have a public IP address. We can either use an existing public IP or create a new one. I don’t have an existing public IP, so we’ll let this process create a new one and we’ll call the public IP gateway IP. The public IP address SKU is going to match the SKU of the gateway we’re setting up. We can leave these last two options disabled since we’re not doing any kind of active, active stuff, and we’re not replicating using BGP.</p>
<p>Since we’re not going to tag anything, we can go ahead and review and create here. And what Azure has done is validated my configurations. So we are deploying a gateway called my gateway into the Vnet demo’s resource group within my lab subscription. We’re deploying into Central US and the SKU for this gateway is a basic generation one. This gateway is going to allow traffic to and from the MyVnet network, and the gateway subnet is the one that we defined earlier.</p>
<p>We’re deploying a route-based VPN type using a VPN type gateway. We’ve disabled the active active mode in BGP, and we’ve assigned a new IP called gateway IP to our virtual network gateway. Once this virtual network gateway creation process completes, Azure will assign a dynamic public IP address to it. And we will need that to configure our VPN device on-prem, which by the way, I am not going to cover in this demonstration. And I’m not going to cover that because every VPN device is different.</p>
<p>What I’m doing here in this demonstration is showing you all of the pieces that you need to do within the Azure portal to make Azure talk to an on-prem VPN device. The steps you need to take to configure your given VPN device in your own environment will be drastically different depending on the device itself. So let’s go ahead and create our gateway here, and we can see that the deployment is underway.</p>
<p>So this really is going to take about 40 to 45 minutes to complete, so I’m going to let this run, and then when it’s completed, we’ll come back and I’ll show you what the next steps are, and then we’ll take it from there.</p>
<h1 id="DEMO-Building-a-Site-to-Site-VPN-Part-Two"><a href="#DEMO-Building-a-Site-to-Site-VPN-Part-Two" class="headerlink" title="DEMO: Building a Site-to-Site VPN - Part Two"></a>DEMO: Building a Site-to-Site VPN - Part Two</h1><p>Okay, welcome back. So our deployment has now completed, and we have the virtual network gateway deployed, and if we click on Go to resource here, we can see MyGateway is now deployed. We can see it’s associated with the MyVNet virtual network, and we have a public IP address here of 23.99.178.64. This gateway IP here, this public IP address, is what we will need when we configure the on-prem VPN device because the on-prem VPN device needs to know what the public IP is of the Azure site so it can communicate with it.</p>
<p>So now that we have MyGateway deployed, what we’ll do here is we’ll note this IP address, and I’ll just copy this. I’m going to paste this over into Notepad here, and I’ll drag this into my second screen. So now that we have our public IP for our virtual network gateway documented, what we’ll do is we’ll create a local network gateway.</p>
<p>Now, the local network gateway is the reference to the on-prem VPN device. So essentially, what we do is we deploy the virtual network gateway, which is MyGateway, and this gateway represents the Azure endpoint of the VPN connection. The local network gateway we’re about to deploy represents the on-prem VPN device, that endpoint of the VPN connection.</p>
<p>Once we have the virtual network gateway and the local gateway configured, we then deploy a VPN connection, which connects the two, so let’s go ahead and deploy our local network gateway, and we’ll just search for it here in the marketplace. And we’ll go ahead and create. Now, there’s not as much to configure for the local network gateway. All we need to do is give the local network gateway a name, and then we need to provide the public IP address of our VPN device in the on-prem environment. We also need to add any additional address ranges that are behind that VPN device so that Azure knows that it’s going to be able to talk to those networks, and then of course, we need to decide which subscription it’s gonna go in and which resource group, along with the location.</p>
<p>So we’re going to call our local gateway just OnPrem-Local, and I’m going to copy, I have the actual public IP of my on-prem VPN device here, and the on-prem address space for the on-prem network is 10.1.0.0&#x2F;16. So what this information is doing is telling Azure that the on-prem VPN device can be reached at this public IP, and this address space is the underlying network address range that we can access through the VPN. We’re not going to do any BGP stuff, and we will deploy this into our vNetDemos resource group. We’ll leave it in Central US since that’s where everything else is, so we’ll go ahead and create this local gateway, and we’ll go back into our resource group here.</p>
<p>Now, the deployment of the local gateway takes far less time than the virtual gateway, and as you can see, it’s already been deployed, so we’ll refresh here, and we can see our OnPrem-Local. So now that I have the virtual network gateway, which represents the Azure endpoint, and the local gateway, which represents the on-prem VPN endpoint, what we can do is create the VPN connection between those two endpoints.</p>
<p>So we’ll go ahead and go back to the Hamburger, create a resource, and we’ll search for Connection. And we have Connection here, and we’ll go ahead and create the connection. We have a couple different options here for connection type. We can to a VNet-to-VNet, a Site-to-site, or an ExpressRoute. For this demonstration, we’re working through the Site-to-site process, so we’ll go ahead and click Site-to-site, and again, we’ll deploy into our vNetDemos resource group, and we’ll okay it.</p>
<p>Now, when we do that, this Settings page appears. Now, what this Settings page does is allow us to specify each of the endpoints of our virtual private network. We need to tell Azure what our virtual network gateway is and what the local network gateway is. This creates the connection between the two. So we’ll go ahead and select our virtual network gateway and our local network gateway.</p>
<p>You can see here, it fills in the connection name automatically, and we’re going to leave this connection here, although you can change this if you want to.</p>
<p>Now, we also need to specify a shared key. Now, this shared key, whatever we add here, we need to save that because we’re going to need to enter that same information into the on-prem VPN device, so that shared key matches both sides, the Azure side and the on-prem VPN device. If we hover over the icon here, we can see that this can be a mixture of numbers and letters, and it’s used to establish that encryption for the connection, so what I’ll do here is I’ll create a shared key. And remember, we’ll need this same shared key for our VPN device, and then we can select which protocol we wanna use, IKEv1 or v2.</p>
<p>IKEv2 will work for us, and since we’re not using BGP, we do not need to enable it, so we’ll go ahead and okay it. This will give me a summary, and we’ll go ahead and okay it again. We can go back into vNetDemos here, and it only takes a few moments for the connection to be created, and we can see it’s been created, and there’s our connection. Now, as we can see here, we have an unknown status, and the status is unknown because we haven’t configured the on-prem VPN device yet.</p>
<p>Now, as I mentioned earlier, configuring the VPN device, that process is going to be different, depending on the device itself, but what we can do here is we can download a configuration, and we can choose what device we’re configuring on the other side, and this gives us some information that we can use to configure that VPN device.</p>
<p>In the first drop-down, we can select the vendor. For example, if we were configuring a Cisco device, we’re configuring an ASA, and then we can select the firmware version, and then what we can do here is download that configuration. If we open this up, we can see we have all of the information we need to configure a Cisco ASA with a firmware of 9.8 or later, and then we would use this to configure the ASA, so let me close this, close this, and give me a few minutes. I will go over and configure my VPN device, and then what we’ll do is we’ll come back, and we’ll see this status change to show Connected.</p>
<p>Okay, so I’ve configured my on-prem VPN device, and we can now see we have a Not Connected status. We’ll give this a few minutes, and what should happen is this should show that we now have a status of Connected. So we’ll give it a few moments here, and then we’ll refresh. Go ahead and refresh here, and let’s give it one more refresh here, and there you have it.</p>
<p>So the process we followed was actually pretty straightforward when you think about it. You first deploy a virtual network in Microsoft Azure. You then deploy a gateway subnet that is attached to that virtual network. Once you have your gateway subnet, you go ahead and you deploy your virtual network gateway in Azure, and that virtual network gateway references the Azure endpoint of the VPN connection. Once you have your virtual network gateway deployed, you create your local gateway, which references the on-prem VPN device. Once you have the local gateway configured, you then create the connection between the virtual network gateway and the local gateway. Once you have that set up, you can go ahead and download the configuration for whatever device it is you’re using on-prem, and then you can go ahead and configure your on-prem device so that it can connect to Azure. You need to make sure that your shared key is the same in both Azure and in your on-prem VPN device. Once you configure the on-prem VPN device, you can come back and refresh, and you should see your VPN connection between your Azure virtual network, and your on-prem network shows Connected.</p>
<h1 id="Point-to-Site-VPNs"><a href="#Point-to-Site-VPNs" class="headerlink" title="Point-to-Site VPNs"></a>Point-to-Site VPNs</h1><p>Hello and welcome to Point-to-Site VPNs. In this lesson, you will be introduced to point-to-site VPNs. You’ll learn what they are and when to use them.</p>
<p>A point-to-site VPN gateway connection is a type of connection that you typically use to securely connect a single client computer to a virtual network in Azure. This is a common connection type for remote workers who need access to resources on your Azure virtual network. These types of connections are initiated from the client computer.</p>
<p>When you create a point-to-site VPN, you have a choice of protocols. You can use OpenVPN Protocol, Secure Socket Tunneling Protocol, otherwise known as SSTP, orIKEv2 VPN. </p>
<p>The OpenVPN Protocol is an SSL&#x2F;TLS-based VPN protocol that can be used through a firewall, since most firewalls allow TCP port 443 outbound. The OpenVPN Protocol is flexible because it can be used to connect from a variety of client machines, including those running Android, Windows, Linux, and Mac OSX.</p>
<p>Secure socket tunneling protocol is a proprietary VPN protocol that leverages TLS. It, too, can penetrate firewalls for the same reason OpenVPN can. However, unlike OpenVPN Protocol, SSTP only supports Windows devices.</p>
<p>IKEv2 VPN is a standards-based IPSec VPN solution. It can be used to connect from Mac OSX devices.</p>
<p>When a user initiates a point-to-site VPN connection to Azure, the user must first be authenticated before Azure accepts the connection. There are a couple different ways the user can be authenticated. These include native Azure certificate authentication, native Azure AD authentication, or a traditional Active Directory Domain Server.</p>
<p>The Azure certificate authentication option requires a client certificate to be present on the device that the user is connecting from. This certificate is validated by the VPN gateway during the connection handshake.</p>
<p>With Azure AD authentication, users can connect using their Azure AD credentials. It should be noted, however, that the native Azure AD authentication option is only supported for OpenVPN protocol. Windows 10 will also require the use of the Azure VPN Client to make this work.</p>
<p>Users in a traditional AD Domain can be authenticated using the traditional AD domain server through the use of a RADIUS server that needs to be integrated with the domain controller.</p>
<p>The table on your screen shows which Azure gateway SKUs support point-to-site VPNs.</p>
<p>For complete technical details on point-to-site VPNs, visit the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about">https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about</a></p>
<h1 id="ExpressRoute"><a href="#ExpressRoute" class="headerlink" title="ExpressRoute"></a>ExpressRoute</h1><p>Hello and welcome to ExpressRoute. In this lesson, we are going to take a look at what ExpressRoute is and what it offers.</p>
<p>ExpressRoute is an offering you can use to extend your on-prem networks into Azure. It’s essentially a private connection from your network to Azure that’s facilitated by a third-party connectivity provider.</p>
<p>You can use ExpressRoute to establish connectivity from an any-to-any network, a point-to-point Ethernet network, or from a virtual cross-connection through a connectivity provider at a co-location facility. It’s important to note that connections made with ExpressRoute do NOT traverse the public internet. Because they do not traverse the internet, ExpressRoute connections are inherently more secure, more reliable, and typically faster than site-to-site connections that traverse the internet.</p>
<p>ExpressRoute connections offer several benefits. For example, such connections allow you to establish connectivity to Microsoft cloud services across all regions within a geopolitical region. Global connectivity across all regions to Microsoft services can be achieved trough the use of the ExpressRoute premium add-on.</p>
<p>ExpressRoute connections also provide for dynamic routing between your on-prem networks and Microsoft via BGP, and the built-in redundancy that ExpressRoute offers provides higher reliability. There is even a connection uptime SLA of 99.95% for ExpressRoute dedicated circuit availability.</p>
<p>You can use ExpressRoute connections to access Microsoft Azure services and Microsoft Office 365 services. ExpressRoute circuits come in a variety of bandwidths. You can purchase a circuit with as little as 50Mbps in bandwidth, and you can purchase a circuit with as much as 10Gbps in bandwidth. There are also several options in between.</p>
<p>The table on your screen shows what’s available:</p>
<ul>
<li>50 Mbps</li>
<li>100 Mbps</li>
<li>200 Mbps</li>
<li>500 Mbps</li>
<li>1 Gbps</li>
<li>2 Gbps</li>
<li>5 Gbps</li>
<li>10 Gbps</li>
</ul>
<p>You can even increase the bandwidth of your ExpressRoute circuit without having to tear down existing connections. This is a huge plus in my book.</p>
<p>When you deploy an ExpressRoute circuit, you’ll have to decide what billing model you wish to use. The “Unlimited Data” billing model is based on a monthly fee. It offers unlimited inbound and outbound transfer for a single fee.</p>
<p>“Metered Data” billing is also based on a monthly fee. However, it’s a little different from “Unlimited Data” because, while all inbound data transfer is included free of charge, outbound data transfers are charged on a “per-GB” basis.</p>
<p>The “Express Route Premium Add-On” that I mentioned earlier is a paid add-on to the ExpressRoute circuit. This premium add-on increases the number of route limits for Azure public and private peering from 4,000 routes to 10,000 routes. It also offers global connectivity across any region except for the national clouds. The ExpressRoute Premium Add-On also increases the number of vNet links per circuit from the default of 10 to a larger limit, which is determined by the bandwidth of the circuit that you purchase.</p>
<p>Be sure to check out the ExpressRoute FAQ at the URL that you see on your screen: <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs">https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs</a></p>
<h1 id="vNet-Peering"><a href="#vNet-Peering" class="headerlink" title="vNet Peering"></a>vNet Peering</h1><p>Hello and welcome to vNet Peering. </p>
<p>If you find yourself in a spot where you need to establish connectivity between two different Azure virtual networks, you can leverage virtual network peering, or vNet Peering. What vNet Peering does is allow you to seamlessly connect different Azure virtual networks. As far as connectivity goes, both virtual networks appear as one. Any traffic that flows between peered networks will use the Microsoft backbone infrastructure. </p>
<p>There are two types of peering that Azure supports. They include Virtual Network Peering and Global Virtual Network Peering. Virtual Network Peering allows you to connect virtual networks that are located within the same Azure region as one another, while Global Virtual Network Peering allows you to connect virtual networks deployed in different Azure regions.</p>
<p>Whether its local or global peering that you leverage, both options offer low-latency, high-bandwidth connectivity between Azure resources that are connected to different virtual networks. This connectivity facilitates data transfer across different virtual networks, even when they are in different Azure subscriptions, Azure Active Directory tenants, and Azure regions.</p>
<p>Peering offers you the ability to connect virtual networks that were created through the Azure Resource Manager and it also provides you the ability to connect virtual networks that were created through Resource Manager to those that were created through the classic deployment model. </p>
<p>I should also mention that creating a peering causes no downtime to resources during the peering process nor after the peering is completed.</p>
<p>Since the traffic between peered virtual networks remains on the Microsoft backbone network, it remains private without the need for the public Internet, gateways, or even encryption.</p>
<p>Network latency between VMs on separate peered virtual networks in the same region is no different than the latency you would see between two VMs within a single virtual network. You can even apply network security groups to either virtual network in the peering if you wish to block access to other virtual networks or subnets. </p>
<p>Join me in the next lesson, where I’ll show you how to peer two existing virtual networks.</p>
<h1 id="DEMO-Peering-Two-vNets"><a href="#DEMO-Peering-Two-vNets" class="headerlink" title="DEMO: Peering Two vNets"></a>DEMO: Peering Two vNets</h1><p>Hello and welcome back. In this brief demonstration, I want to walk you through the process of using vNet peering to connect two different virtual networks in Microsoft Azure. On my screen here I’m logged in to my Azure portal as my administrator and I’m in the vNetDemos resource group where I’ve deployed a virtual network called MyVnet.</p>
<p>If I bounce out to Resource Groups here and go into my OnPrem resource group, we can see I have a second virtual network called OnPrem-vNet. So what we’re going to do here is connect these two virtual networks through what is called vNet peering. The process for creating the peering is actually pretty straightforward. What we need to do here is select one of the virtual networks, and then from the Overview page for the virtual network, under the Settings section here we have an option here for peerings.</p>
<p>We’ll select Peerings here and we can see we have no peerings currently configured. To create a peering we simply click Add and then we need to give the peering a name. Now before I give my peering a name here, I just want to point out this note here that we see. And it’s basically telling us that for peering to work we need to create a peering link from the OnPrem-vNet out to the remote virtual network that we’re going to peer with, but then we also have to create a peer that comes back from that remote virtual network to this OnPrem-vNet virtual network. So what I’ll do here is I’ll call this peering OnPremtoRemote, just keep it simple.</p>
<p>Now under Peer details here we need to specify a virtual network deployment model. We have two options, resource manager or classic. Since both of my virtual networks are resource manager, I’ll leave Resource manager selected. Now this option here for the resource ID, if we hover over this icon here we can see that we can, instead of browsing for our virtual network, what we can do is enter the resource ID of the network directly. I have access to everything I need to have access to, so what we’re going to do I choose the Lab Subscription, which is where we’re doing our work, so we’ll go ahead and select the virtual network we want to peer with.</p>
<p>Now you’ll notice under this “Cannot be peered with this virtual network” heading is the OnPrem-vNet. That’s because you can’t peer with yourself. So we’re going to peer with MyVnet here. So we’ll select it, and what we need to do in this box is provide a name of the peering from MyVnet back to OnPrem. So what I’ll do for this, I’ll just call this MyVnettoRemote.</p>
<p>Now under configuration here we have a couple different things that we can optionally configure. If we hover over the icon here for “Allow virtual network access from OnPrem-vNet to MyVnet”, what this does is allow communications between the two virtual networks. If you’re going to peer your networks it stands to reason that you’d want those networks to communicate with one another. So this option is enabled by default. And the same for this second option, which is allowing virtual network access from MyVnet to OnPrem-vNet. This, again, is enabled by default.</p>
<p>Now you could turn these off and block traffic in between them, but then what would be the sense of peering them? And in a similar fashion, we have the option to configure forwarded traffic. If we hover over the icon here for traffic forwarding from MyVnet to OnPrem, we can see that this setting allows us to forward traffic from MyVnet, which is traffic that isn’t originating from MyVnet, and then forward that into the OnPrem-vNet. These are turned off by default, which is a typical configuration.</p>
<p>And then lastly we have the gateway transit settings. If we hover over the icon here for “Allow gateway transit”, we can see that what gateway transit does is it allows one virtual network to use the VPN gateway in the peered virtual network for cross prem, or even VNet-to-VNet connectivity. We have no need for gateway transit in this configuration, so we can leave this unchecked. And at this point, once I click OK here, what’s gonna happen is this peering is going to be created going both ways. That’s why we needed to provide the name for the peering from OnPrem to MyVnet, and then from from MyVnet to OnPrem.</p>
<p>So we’ll go ahead and click OK here, and we can see the peering is actually being added twice. And we see it’s connected. Now if we go back out to our resource groups and we go into vNetDemos and we look MyVnet, if we select Peerings here we can see we now have the peering from MyVnettoRemote and it is showing a status of “Connected”.</p>
<p>So that’s pretty much it. If you’re going to connect different Azure virtual networks to one another, you don’t have to go through the whole process of doing a site-to-site VPN. You could and it’ll still work, but why? I mean, at this point, if you’re gonna connect those two Azure virtual networks, then you would do it via peering. It’s a much cleaner process and involves a lot less work. So with that let’s call it a wrap and I’ll see you in the next lesson.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations. You’ve come to the end of Getting Started with Azure Virtual Networks. Let’s review what you’ve learned.</p>
<p>We started things off with a vNet overview. You learned about basic Azure virtual network concepts and about some key best practices. We also covered communications topics, filtering, routing, and integration, before working through a demo that showed you how to deploy a virtual network in Microsoft Azure.</p>
<p>After covering the basics of azure virtual networks in the first half of this course, we used the second half to dive into VPNs, where you learned about site-to-site VPNs, point-to-site VPNs, ExpressRoute, and vNet peering. You also get to see a demo that showed you how to peer two vNets in Azure. </p>
<p>At this point, you should have a good understanding of how to deploy and connect Azure virtual networks.</p>
<p>To learn more about Azure virtual networks, you can, and should, read Microsoft’s published documentation. You should also keep an eye out for new courses on Cloud Academy because we’re always publishing new ones. Be sure to give this course a rating, and if you have any questions or comments, please let us know. Thanks for watching and happy learning!</p>
<h1 id="2Concepts-and-Best-Practices"><a href="#2Concepts-and-Best-Practices" class="headerlink" title="2Concepts and Best Practices"></a>2<strong>Concepts and Best Practices</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/security-overview">Network security groups</a></p>
<h1 id="4Filtering-Routing-and-Integration"><a href="#4Filtering-Routing-and-Integration" class="headerlink" title="4Filtering, Routing, and Integration"></a>4<strong>Filtering, Routing, and Integration</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-bgp-overview?toc=/azure/virtual-network/toc.json">BGP Overview</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-for-azure-services">Transferring Data via Private IP Address</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/private-link/private-link-overview">Private Link overview</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview">Service Endpoints</a></p>
<h1 id="6VPN-Gateways"><a href="#6VPN-Gateways" class="headerlink" title="6VPN Gateways"></a>6<strong>VPN Gateways</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways">VPN Gateways overview</a></p>
<h1 id="10Point-to-Site-VPNs"><a href="#10Point-to-Site-VPNs" class="headerlink" title="10Point-to-Site VPNs"></a>10<strong>Point-to-Site VPNs</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about">Point-to-Site VPNs overview</a></p>
<h1 id="11ExpressRoute"><a href="#11ExpressRoute" class="headerlink" title="11ExpressRoute"></a>11<strong>ExpressRoute</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/expressroute/expressroute-faqs">ExpressRoute info</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-104-Deploying-And-Monitoring-Azure-App-Service-Web-Apps-25/" rel="prev" title="AZ-104-Deploying-And-Monitoring-Azure-App-Service-Web-Apps-25">
      <i class="fa fa-chevron-left"></i> AZ-104-Deploying-And-Monitoring-Azure-App-Service-Web-Apps-25
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-104-Create-Your-First-Azure-Virtual-Network-27/" rel="next" title="AZ-104-Create-Your-First-Azure-Virtual-Network-27">
      AZ-104-Create-Your-First-Azure-Virtual-Network-27 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Concepts-and-Best-Practices"><span class="nav-number">2.</span> <span class="nav-text">Concepts and Best Practices</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Communications"><span class="nav-number">3.</span> <span class="nav-text">Communications</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Filtering-Routing-and-Integration"><span class="nav-number">4.</span> <span class="nav-text">Filtering, Routing, and Integration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Provisioning-a-Virtual-Network"><span class="nav-number">5.</span> <span class="nav-text">DEMO: Provisioning a Virtual Network</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VPN-Gateways"><span class="nav-number">6.</span> <span class="nav-text">VPN Gateways</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Site-to-Site-VPNs"><span class="nav-number">7.</span> <span class="nav-text">Site-to-Site VPNs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Building-a-Site-to-Site-VPN-Part-One"><span class="nav-number">8.</span> <span class="nav-text">DEMO: Building a Site-to-Site VPN - Part One</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Building-a-Site-to-Site-VPN-Part-Two"><span class="nav-number">9.</span> <span class="nav-text">DEMO: Building a Site-to-Site VPN - Part Two</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Point-to-Site-VPNs"><span class="nav-number">10.</span> <span class="nav-text">Point-to-Site VPNs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ExpressRoute"><span class="nav-number">11.</span> <span class="nav-text">ExpressRoute</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#vNet-Peering"><span class="nav-number">12.</span> <span class="nav-text">vNet Peering</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DEMO-Peering-Two-vNets"><span class="nav-number">13.</span> <span class="nav-text">DEMO: Peering Two vNets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">14.</span> <span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2Concepts-and-Best-Practices"><span class="nav-number">15.</span> <span class="nav-text">2Concepts and Best Practices</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4Filtering-Routing-and-Integration"><span class="nav-number">16.</span> <span class="nav-text">4Filtering, Routing, and Integration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6VPN-Gateways"><span class="nav-number">17.</span> <span class="nav-text">6VPN Gateways</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10Point-to-Site-VPNs"><span class="nav-number">18.</span> <span class="nav-text">10Point-to-Site VPNs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11ExpressRoute"><span class="nav-number">19.</span> <span class="nav-text">11ExpressRoute</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
