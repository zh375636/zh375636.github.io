<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionWelcome to the course on designing and implementing an Azure Virtual WAN. My name is Travis Roberts. I’m an Azure solutions architect expert, Microsoft certified trainer, and Microsoft MVP">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-700-Implementing-an-Azure-Virtual-WAN-15">
<meta property="og:url" content="https://example.com/2022/11/18/AZ-700-Implementing-an-Azure-Virtual-WAN-15/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionWelcome to the course on designing and implementing an Azure Virtual WAN. My name is Travis Roberts. I’m an Azure solutions architect expert, Microsoft certified trainer, and Microsoft MVP">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T00:10:53.000Z">
<meta property="article:modified_time" content="2022-11-23T02:24:44.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AZ-700-Implementing-an-Azure-Virtual-WAN-15/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-700-Implementing-an-Azure-Virtual-WAN-15 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-700-Implementing-an-Azure-Virtual-WAN-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-700-Implementing-an-Azure-Virtual-WAN-15
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:10:53" itemprop="dateCreated datePublished" datetime="2022-11-18T20:10:53-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 22:24:44" itemprop="dateModified" datetime="2022-11-22T22:24:44-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-700/" itemprop="url" rel="index"><span itemprop="name">AZ-700</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-700-Implementing-an-Azure-Virtual-WAN-15/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-700-Implementing-an-Azure-Virtual-WAN-15/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to the course on designing and implementing an Azure Virtual WAN. My name is Travis Roberts. I’m an Azure solutions architect expert, Microsoft certified trainer, and Microsoft MVP with over 20 years of experience with Microsoft infrastructure. I’m excited to get started on the journey to learn about Azure virtual WAN.</p>
<p>The objectives of this course map to the skills measured on the AZ-700 designing and implementing Microsoft Azure networking solutions exam. These skills include: design an Azure virtual WAN architect, including selecting SKUs and services, connect a VNet gateway to an Azure virtual WAN, create a hub in a virtual WAN, create a network virtual appliance or NVA in a virtual hub, configure virtual hub routing, and create a connection unit.</p>
<p>Coming up, we’ll get started with an overview of what a virtual WAN is, then move on to services and the types or SKUs of virtual WANs. After that, we’ll create a virtual WAN and connect a Vnet as well as a site-to-site VPN. Next, we’ll create an integrated appliance, called a network virtual appliance. Then examine routing tables in an Azure virtual WAN. Finally, we’ll review connection units and scale units, and how they factor into virtual WAN pricing. Please don’t forget to rate this course once you’re finished. I look forward to seeing you in the next lecture to get started.</p>
<h1 id="Azure-Virtual-WAN-Overview"><a href="#Azure-Virtual-WAN-Overview" class="headerlink" title="Azure Virtual WAN Overview"></a>Azure Virtual WAN Overview</h1><p>The best place to start any journey is at the beginning. With this course, we’ll start with what an Azure Virtual WAN or a WAN for that matter is. WAN stands for Wide Area Network. A WAN is used to connect two or more local area networks or LANs. For example, computers in an office are connected to a high-speed network, either physical or wireless. If the organization has multiple offices, they’re connected by a WAN.</p>
<p>Now, it’s expensive to run cable or fiber across long distances. Most organizations don’t have the resources to connect remote sites with their own network. There are several solutions available for WAN connectivity. First is a site-to-site VPN between the locations. Another is to purchase a service such as MPLS or Dark Fibre or a software-defined WAN, also known as an SD WAN, could be used to connect the sites. Microsoft has their own solution with Azure Virtual WAN. That’s the solution this course will focus on. Let’s consider two design options for deploying a WAN. The first is what’s called a hub and spoke network. With a hub and spoke network, all traffic is routed through a central location or hub. Each site connects to the hub and is referred to as a spoke. The remote site only requires one connection to the hub to pass traffic to the other sites.</p>
<p>This is a functional option, but has one rather significant flaw. Should the hub become unavailable, all communication between the sites would also become unavailable. The hub is a single point of failure in this model. The second option is a mesh network. With a mesh network, each node has a connection to the other nodes in the network. There is no single point of failure with a mesh network. If a node fails, the other nodes can still communicate, but there’s a problem with mesh networks.</p>
<p>In the example on the screen, we have a total of six connections to connect four sites. As the number of sites increase, the number of connections needed to connect them grow as well. Adding two more nodes increases the number of connections to 12. As sites are added, the number of point-to-point connections required to connect a mesh network becomes unmanageable. So what we need is the best of both worlds, the reliability of a mesh network and the simplicity of a hub and spoke network. That’s the value Azure Virtual WAN offers.</p>
<p>Azure Virtual WAN is a service that brings networking, security, and routing in one management plane to build a highly available hybrid network supporting cloud and on-premises services, as well as VPN clients. With Azure Virtual WAN, hubs are created in a given region. Once in place, endpoints connect to the Azure Virtual WAN. These endpoints can be site-to-site VPN, user VPN, ExpressRoute, or even VNets in Azure. Multiple connection points or hubs are created in Azure regions. This reduces latency by connecting endpoints to the Azure network in the same region. These regions are connected in a full mesh network.</p>
<p>In the end, we have multiple endpoints connecting to different hubs. Those hubs are connected to a full mesh network, providing that easy to manage highly available WAN network connecting your on-premises and remote sites to your cloud resources. Not only does this enable connectivity between cloud and on-premises resources, it also provides a global transit network architecture, allowing connectivity not just between on-premises and the Azure cloud, but also between all endpoints in the virtual WAN, leveraging Microsoft’s private high-speed network for traffic between the hubs.</p>
<p>Now that we have an understanding of what Azure Virtual WAN is and the problems it’s intended to solve, let’s take a look at the services and specific Azure SKUs supported with Azure Virtual WAN.</p>
<h1 id="Services-and-SKUs"><a href="#Services-and-SKUs" class="headerlink" title="Services and SKUs"></a>Services and SKUs</h1><p>Now that we understand what Azure virtual WAN is and the problems it solves, let’s move on to some technical terms. I know vocabulary may not sound that exciting, but it’s important to understand the components that make up Azure virtual WAN, as well as what services are included with the two available types of Azure virtual WAN. Let’s start with services and the first service is virtual WAN.</p>
<p>A virtual WAN is a collection of resources that make up a virtual WAN service. Resources in a virtual WAN can communicate with each other. There can be multiple virtual WANs in a subscription, but resources located in different virtual WANs will not communicate with each other by default. A virtual WAN is also an administrative boundary. Hubs are created within a virtual WAN. A hub is a virtual network managed by Azure. Part of the advantage of a hosted service is that we don’t have to manage all the services involved. For a virtual WAN and the hubs contained inside it, we don’t have to be concerned with all the routing, redundant connections and interconnections between regions. That’s all part of the hubs in a virtual WAN.</p>
<p>A hub connects endpoints from other networks. For example, a VPN gateway endpoint can host a connection from an on-premises VPN appliance. We can connect ExpressRoute circuits or client VPN connections to the hub as well. Hubs are at the core of a virtual WAN network in a region. We can use single or multiple hubs per region. All the hubs in a virtual WAN are connected with a hub-to-hub connection by default. A hub can connect to VNets with a hub virtual network connection or use gateways to connect different types of endpoints, site-to-site VPN for remote branches, point-to-site VPN for end users, and to ExpressRoute for connecting ExpressRoute circuits to Azure virtual WAN. There’s another option called a network virtual appliance or NVA that directly integrates into a hub and provides connectivity for software-defined WAN or SD WAN.</p>
<p>Custom routing can be added to the hub route table, providing granular control of network routing in the environment with BGP and static routes. The different connections and services Azure virtual WAN offers provides flexible options for integrating with existing networks. The exact features in an Azure virtual WAN depend on the SKU or type of virtual WAN we deploy. There are two options when deploying a virtual WAN, basic and standard. A basic virtual WAN and hub only provides site-to-site connectivity. The other type is a standard virtual WAN hub. This hub type supports ExpressRoute, user VPN, site-to-site VPN, inter-hub and VNet to VNet connectivity through the virtual hub, Azure Firewall, and a network virtual appliance in the virtual WAN. If you deploy a basic hub, it can be upgraded to a standard hub. However, you cannot downgrade a standard hub to basic. Now that we have an overview of Azure virtual WAN and an understanding of the components and services that make up the product, let’s move on to implementing Azure virtual WAN.</p>
<h1 id="Creating-a-Virtual-WAN-and-Hub"><a href="#Creating-a-Virtual-WAN-and-Hub" class="headerlink" title="Creating a Virtual WAN and Hub"></a>Creating a Virtual WAN and Hub</h1><p>In this lecture, we’ll review creating a virtual WAN and hub. Before we get to that, let’s consider options for connecting multiple locations. We’ll use North America and Europe for this example. One option is to connect the locations to a central location, East US for this example, with a site-to-site VPN. A VPN encrypts data packets at the source, sends the traffic over the public internet, then decrypts them at the destination. This works, and it’s a common way to connect sites as well as connect users to private networks. But it has some downfalls.</p>
<p>First, we are dependent on the public internet to route traffic. There is no control over how the traffic is routed between two points. The packets could be delayed due to congestion at any point, causing high latency, and there is no guarantee if the packets will get routed to the destination at all. Even if there is no issues with the connection, having all traffic in Europe go through North America would be incredibly inefficient. What if two offices in Europe had to transfer data? The speed of light is only so fast and this is an inefficient way to pass traffic. Not to mention potential data sovereignty issues with passing data through a different country. For many organizations, that level of uncertainty on the network is not acceptable.</p>
<p>Another option is a site-to-site VPN or private connection between each location. As we’ve mentioned previously, a full mesh network becomes nearly unmanageable as sites are added, and a hub and spoke introduces a single point of failure. Also, a hub and spoke does not address the high latency between points in distant offices. Traffic still passes through the hub. Let’s design a solution that leverages Azure virtual WAN. In this example, the organization has a mix of on-premises and Azure Cloud resources. There is an office in Europe and another in North America. There is also resources in the East US and West Europe Azure regions. We could, in this instance, create a virtual WAN and a single hub, in say, West Europe, and connect the physical locations with a site-to-site VPN and add the VNets from each region.</p>
<p>This would successfully route traffic between all sites. But you probably see the error with this configuration. We’re still relying on the public internet over a long distance for a portion of our traffic. Here’s the point. When we’re designing a virtual WAN, we want to keep any traffic that’s outside the Azure network to a minimum. We only need one hub to connect all the endpoints together, but by doing so, we have some long distances over a public network. This is referred to as the last mile. The last mile is the distance between the endpoint, either a site or user, and the private network. This is often a VPN connection over the internet. We want to keep the last mile as short as possible to limit the potential for congestion or latency and other network errors.</p>
<p>A better design is to use a virtual WAN hub in the regions closest to the remote endpoints. From there, the endpoints connect to the closest hub. A hub-to-hub connection is used to route traffic over the private Azure network, providing transitive routing between all endpoints connected to the hubs. This configuration minimizes the last mile, all traffic to and from the same geography stay in that geography, and we leverage the Azure global network for cross-region connectivity. The hub-to-hub connectivity is automatically established for all hubs that are part of a virtual WAN. For this example, we’ll deploy the following configuration. We have one virtual WAN located in the East US region. We have two resources to connect to the virtual WAN, a VNet located in East US and a remote site located in West Europe.</p>
<p>Now, I don’t actually have a site in West Europe. For this example, an Azure Lab located in the West Europe region will be used to simulate a physical location. We’ll create two virtual WAN hubs, one in West Europe and one in East US. We’ll connect our two locations to each of the hubs using a virtual network connection for the VNet in East US and a site-to-site VPN in West Europe. Once completed, we’ll verify connectivity between computers in the two networks.</p>
<p>Here’s the information used to configure the lab. Notice there’re no overlapping blocks of IP addresses. We have a virtual WAN in the East US region. We also have a VNet and subnet in its own resource group and a VM that we’ll test with in another resource group. There’s a virtual WAN hub in East US. This is what the North American resources will connect to. For West Europe, we have a VNet and subnet in a resource group. Although this is in Azure, we’re using this to simulate an on-premises network. We have a resource group for the VM. This will act as a gateway device and allow us to test connectivity. The Windows server has routing and remote access installed and will act as the site-to-site VPN endpoint. There’s also a West Europe hub where we’ll add a gateway that the endpoints will connect to. Let’s get started by setting up the virtual WAN in the Azure portal.</p>
<h1 id="Creating-a-Virtual-WAN-and-Hub-Demo"><a href="#Creating-a-Virtual-WAN-and-Hub-Demo" class="headerlink" title="Creating a Virtual WAN and Hub Demo"></a>Creating a Virtual WAN and Hub Demo</h1><p>This lecture will demonstrate how to create the virtual WAN and Virtual WAN Hubs in the example environment. Let’s start in the Azure portal by creating the Virtual WAN. Go to create resource and search for Virtual WAN. Select Virtual WAN and create. Create a new resource group. This example, we’ll use the name Virtual WAN RG. Set the location. This example uses East US. Give it a name. Virtual WAN for this example. This will be a standard Virtual WAN because we’ll use it for more than just site to site VPNs. Go to review and create. Once validated, click create. Deployment won’t take long to finish.</p>
<p>Once done, let’s go to the resource. Here’s our empty Virtual WAN. Next, the West Europe and East US hub need to be created. Go to hubs. And new hub. Notice that the Virtual WAN Resource Group is selected. Virtual WAN is a managed service. All the objects needed for the service are created in the resource group. Those objects could include virtual gateways for express route, site-to-site VPNs, and Azure Firewalls, for example. We don’t need to manage these ourselves. Just be aware that they’re in the resource group. Next, select the region and give it a name. West Europe and WEurope hub for this example. We need to give the hub a block of IP addresses. The recommended sub-net size is a &#x2F;23, although a&#x2F;24 to &#x2F;1 will work.</p>
<p>Previously I stated that the Virtual WAN manages services and objects such as gateways, firewalls, and virtual routers. The Virtual WAN service needs a block of private IP addresses to assign to those resources. Defining the hub address space here will prevent an overlap with other IP addresses used in the Virtual WAN and your network. This example will use 10.201.0.0&#x2F;23. There are options to create other resources in the hub, such as site to site and point to site connections, and express route. We’ll explore that later. For now, click review and create. Once verified, click create. The deployment will take a few minutes to finish. I’ll pause here and start again once it’s done.</p>
<p>For this example, the same steps were used to create a second hub in the East US region with names and IP addresses scoped to match the location. The virtual hub deployment won’t take long to finish, but if we go to the virtual WAN, go to the hub we just deployed, WEurope hub shows succeeded. The routing status shows provisioning. We have to wait for the routing status to change to succeeded before we can move forward. This can take several minutes if not longer. We’ll pause here and come back once the routing status for West Europe and East US shows provisioned.</p>
<h1 id="Creating-the-VNet-Connection"><a href="#Creating-the-VNet-Connection" class="headerlink" title="Creating the VNet Connection"></a>Creating the VNet Connection</h1><p>Now that the virtual WAN hubs are in place and there’s connectivity between them, we can connect the VNet to the hub in EastUS. The EastUSHub now shows the routing status as provisioned. Next up, we connect the EastUS VNet to the EastUSHub. Let’s go back to the virtual WAN and select virtual network connections under connectivity. Add a connection, give it a name EastUSConnect for this example, select the EastUSHub. Notice that we can select the subscription, meaning we’re not bound to the VNets only available in the current subscription. Select the resource group for the VNet we’re adding. EastUSVNetRG for this example.</p>
<p>Next, we’ll select the VNet, EastUSVNet. Leave the rest of the settings as is and click create. For this example, there is a virtual machine connected to the EastUSVNet and another in a West Europe VNet. Let’s log into the VM on the EastUSVNet and see if we can ping the other VNet. Here we are logged into the VM connected to the EastUSVNet. We’ll use ping to test connectivity and just as a reminder, by default, new Windows installations won’t respond to ping. We need to go to the firewall, go to inbound rules and enable file and print sharing echo request on the VM that we’ll ping. Let’s open a command prompt. We’ll view the private IP information. This machine has the private IP address of 10.100.1.4. We can try to ping the private IP of the VM in West Europe from the VM in EastUS. But that will fail because the West Europe computer is not connected to the virtual WAN. The next step will take care of that.</p>
<h1 id="Creating-a-Site-to-Site-VPN"><a href="#Creating-a-Site-to-Site-VPN" class="headerlink" title="Creating a Site-to-Site VPN"></a>Creating a Site-to-Site VPN</h1><p>Next, we’ll add the site-to-site VPN connection between the Virtua WAN Hub and the on-premises location in West Europe. Once that’s established, we’ll test connectivity between the computers in the West Europe and East US VNet. Let’s go to the Virtual WAN in the Azure portal to get started. The computer in West Europe represents an on-premises network. It has the Routing and Remote Access Service installed. That’s used to establish a local connection to the VPN. We’ll go to the West Europe Hub and create a VPN Site to site. Here, we have the option to create a VPN Gateway in the West European Hub. We can’t change the AS Number, set the Scale Units to 1. We’ll go over Scale Units shortly.</p>
<p>We have two options for the routing preference, over the Microsoft Network or Internet. With routing over the Microsoft network, traffic will route on the Microsoft private network until the final hop closest to the ISP. Internet routing is cost optimized by passing traffic to the internet, minimizing the amount of traffic passed over the Microsoft Network. Select Microsoft Network and click Create. Creating the gateway can take up to 30 minutes or longer. At this point, we’ll pause the video and come back once it’s finished. The gateway is finished. From the West Europe Hub, we’ll go to VPN Site to site. Create a new VPN Site. Think of this site as a representation of the on-premises location. This is where we place data about the site we’re connecting to the Virtual Hub. Select the Region, West Europe for this example. Give it a name, WEuropeRRAS. And in Device vendor, we’ll enter Windows. </p>
<p>Next, add the private IP address space of the remote site. This is how the Virtual WAN will determine where to route traffic. In this example, the IP address is 10.200.0.0&#x2F;16. If there are multiple IP blocks at this location, we could enter each in a new line. Go to Links. We can provide multiple links to customer equipment in each gateway. This will provide high availability. Enter the information that corresponds with the remote site. We’ll give it the name of WestEurope. Link speed will be 50. This number represents megabits per second. Add the carrier name. This example is in Azure, so that’s what we’ll use. Provide the IP address or fully qualified name of the remote endpoint. For this example, that’ll be the public IP address of the Routing and Remote Access Server. If there’s a BGP address and a Link ASN, add that. Otherwise, go to Review and Create. Once validated, click Create.</p>
<p>After that’s finished, we’ll go back to The Virtual WAN and we can view the site under VPN Sites. Next, we need to connect this site to the West Europe Hub. We’ll go to Hubs, and select the West Europe Hub. Go to VPN Site to site. If the Hub association filter is on, remove it. Here’s our site showing it’s not connected. Select the site and click Connect VPN site. Enter a preshared key. This is used to authenticate both ends of the VPN connection. You can enter one, or leave it blank and Azure will create one for you. Leave the rest as is and click Connect. Notice the gateway is being updated. It may take up to 30 minutes for that to complete updating. We’ll pause here and come back once it’s finished updating those changes.</p>
<p>Once finished, the provisioning status changes to Succeeded. Connectivity status shows Not connected, however. we need to download the VPN configuration next to identify the Azure VPN Gateway public IP address. This is used to configure the on-premises equipment. We’ll download the VPN config. Open the file. This is all the configuration information related to the VPN. There are two public IP addresses for Instance0 and Instance1. The two instances are for high availability. We’re not configuring high availability in this example, we just need the one IP address for Instance0. Copy that IP address, it’s needed for the next step. Let’s move on to the computer in the West Europe region to configure the remote VPN endpoint.</p>
<p>Here we are on the computer in West Europe. This represents an on-premises location that we connect with a site-to-site VPN. For this example, the Windows Routing and Remote Access Service is used as the VPN endpoint. In a production environment, this could be any number of VPN endpoints or devices. We’ll start by creating a new dial-on-demand interface. We’ll give it a name, AzureWEuropeVWAN, for this example. We’ll leave the Connection Type to a virtual private network. For the VPN Type, select IKEv2. For the Destination Address, this is where we add the IP address we got from the config file, the IP address for Instance0. Leave Protocol and Security, and go to Next.</p>
<p>For Static Routes for Remote Networks, go to Add. Here, we’ll add the IP block for the East US VNet, 10.100.0.0&#x2F;16. And &#x2F;16 equals a Network Mask of 255-255-0-0. For the metric, we’ll use 100. Click OK. Next, leave Dialog Credentials blank, Next, and Finish. Now we have the new interface. Let’s open up that interface. Go to Security, and here, select Use preshared key. Here, we add the preshared key that we used to configure the Connect VPN site in Azure. Click OK. And now, from this machine in the 10.200 network, let’s try to ping the VM at 10.100.1.4. And you can see we got a timeout, but then it completed successfully. Because it’s a demand-dial interface, we have to generate traffic before the connection is established. But now, we should be able to run it again without any timeouts. And if we go back to Routing and Remote Access Service, do a refresh, we can see the connection status is now connected.</p>
<p>Let’s go back to the Virtual network. If we go to the West Europe Hub, VPN Site to site, our Connectivity status now shows Connected. And if you happen to be following along, it can take a couple minutes before this updates to Connected. Our East US and West Europe sites are now connected. We’ve successfully created a Virtual WAN and added a virtual hub in West Europe and East US. We connected the West US Hub to a VNet and added a site-to-site VPN connection to the West Europe Hub. Thanks for joining me in this lecture, I look forward to seeing you in the next.</p>
<h1 id="Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub"><a href="#Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub" class="headerlink" title="Creating a Network Virtual Appliance (NVA) in a Virtual Hub"></a>Creating a Network Virtual Appliance (NVA) in a Virtual Hub</h1><p>Now that we have an understanding of the Virtual WANS, Virtual Hubs, and how they work together, let’s move on to how to add a Network Virtual Appliance to a Virtual Hub. We’ll start with what an SD-WAN is and how it fits with a Network Virtual Appliance. A software defined WAN or SD-WAN allows for the management of different types of WAN transports, including site to site VPNs, MPLS, cellular, and other connections. There are many different forms an SD-WAN can take. Too many to go over in this lecture, but at a high level, they all have a hardware device or Virtual Appliance deployed on premises that manages connectivity while optimizing bandwidth and costs.</p>
<p>Software manages connectivity to all the locations, hence the name software defined WAN. SD-WAN simplifies network management by automatically creating the connections between locations. They often have advanced features such as cost-based routing, compression, and WAN acceleration. So if an organization has an SD-WAN infrastructure in place, how do we connect these locations into our Virtual WAN? That is what a Network Virtual Appliance is for. A Network Virtual Appliance, or NVA, is a gateway appliance provided by an Azure networking partner to extend an SD-WAN infrastructure into Azure. It’s a virtual version of the Customer Premises Equipment, or CPE, that organizations already use for WAN connectivity.</p>
<p>With this configuration, the NVE is deployed directly into the Virtual WAN hub. At the time of this recording, there are three providers that support implementing the NVE directly into the Virtual Hub. They include Barracuda, Cisco, and VMware. These three providers offer NVAs available for Azure Virtual WAN. An NVA is a managed application provided by a third party and built for Azure Virtual WAN. The NVA is available from the Azure Marketplace. It works with unit-based capacity and billing and provides health metrics with Azure Monitor. The third party license could be billed directly to the customer such as with a licensing key or through the Azure Marketplace.</p>
<p>There’s also a cost to running the Virtual Appliance in Azure, as well as the network activity on the device. When the NVA is deployed, it creates two resource groups, a customer resource group that acts as a place holder for the managed application. Anything the NVA partner wants to expose to the customer is available in this resource group. There’s also a managed resource group. This is controlled by the publisher of the managed application and contains the NVA application itself. Let’s review the example coming up.</p>
<p>Our sites are connected by an SD-WAN solution that offers a Virtual WAN NVA. Because of that, we don’t need the site to site connections like we deployed in the previous lab. We have a Virtual WAN along with a hub to VNet connections, providing connectivity between our regions. Coming up, we’ll add an NVA to the environment. Once added, the SD-WAN service needs to be configured to connect the Virtual Appliance to the existing infrastructure. The steps to complete the connection will differ for each provider. One last item to note before we move on. You may want to leverage an NVA that’s not one of the three partners with an integrated Virtual Hub offering. Citrix, Meraki, Check Point, Riverbed, and Silver Peak are all examples of providers that offer WAN acceleration and optimization, but are not integrated with Virtual Hubs. All these, and more, have the option for connecting to Azure, just with a slightly different configuration.</p>
<p>To accomplish connectivity between On-Premises and Azure with these platforms, we use something called the indirect interconnect model. In this model, all the remote sites are connected to the enterprise SD-WAN solution with Customer Premises Equipment or CPEs. Also, all the VNets in Azure are connected to the Virtual WAN. A VNet with a virtual CPE provided by the vendor is added to Azure. The virtual CPE is then connected to the Virtual WAN with an IPSec tunnel.</p>
<p>In this configuration, we still leverage the third party SD-WAN to connect the On-Premises sites to Azure. Careful planning is required for redundancy since all the On-Premises connections go through the virtual CPE. For the example coming up next, we’ll use the Barracuda CloudGen WA Gateway with a direct connection to the Virtual Hub. The steps will be similar for the other providers. The virtual network cannot have any virtual gateways such as ExpressRoute or VPN when deploying an NVA in an Azure Virtual WAN hub. Those gateways aren’t needed because the NVA takes care of connectivity. Let’s move on to the Azure Portal for an example of how to deploy an NVA in an Azure Virtual WAN.</p>
<h1 id="Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub-Demo"><a href="#Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub-Demo" class="headerlink" title="Creating a Network Virtual Appliance (NVA) in a Virtual Hub Demo"></a>Creating a Network Virtual Appliance (NVA) in a Virtual Hub Demo</h1><p>Here we are in the Azure Virtual WAN portal. There’s a new virtual WAN called Virtual NVA WAN, used for this example. Let’s open that up. There’s also a new hub used for the network virtual appliance. Remember using an NVA such as what we’re doing in this example, will connect non Azure resources to the virtual WAN. So we need a virtual WAN without any express route or VPN gateways, such as what we set up previously. Go to search in the Azure portal and search for the NVA provider, Barracuda, for this example. Select Barracuda CloudGen WAN Gateway, and create. Make sure your subscription is selected and select the resource group, or add it to a new resource group. Select the region and give the application a name, Barracuda GW, for this example. The managed resource group is already set and can’t be changed. Go to next CloudGen WAN gateway. Select the hub that the gateway will attach to. Leave the NVA infrastructure scale unit set to two. We review scale units in an upcoming lecture. Each NVA will have a different process for onboarding their product. For Barracuda, we need a token that’s available from the CloudGen WAN portal.</p>
<p>Once that information is entered, we can go to review and create to finish the deployment. Scroll down to co admin permissions. This will give the template provider, Barracuda in this case, admin level access to the managed resource group. Read and if you agree, indicate so, and once done, click create. The deployment started. This will take a couple minutes to finish. We’ll pause here and come back once it’s finished. The deployment finished. Let’s go to the resource and view what was created. This is the new gateway. From here, we can view the configuration, modify settings, such as the scale units and open a support case. Notice also that we have the resource group for the gateway, what we’re looking at now, and a managed resource group. If we go into the managed resource group, we can see all the managed objects.</p>
<p>Next, let’s go to the virtual WAN. And from there, we’ll open the hub we added the gateway to. The network virtual appliance indicates there is one added. It did take over an hour for the NVA information to show up in the hub. If we go to the network virtual appliance, under third party providers, we have the Barracuda NVA listed. For all NVAs, there’s other configuration settings required within the SD WAN infrastructure. The configuration options will be dependent on the provider. That is how we create a direct connected NVA in a virtual hub.</p>
<h1 id="Configuring-Virtual-Hub-Routing"><a href="#Configuring-Virtual-Hub-Routing" class="headerlink" title="Configuring Virtual Hub Routing"></a>Configuring Virtual Hub Routing</h1><p>Welcome back, in this lesson, we review and configure Azure Virtual Hub Routing. Routing defines how resources on one subnet locate resources on another subnet. This could be a direct connected subnet, a resource connected through one or more subnets, or a resource on the internet where there are many subnets, or hops, between them. Before we get into that, let’s review IP addresses. There are two types of IP addresses, a public IP is what’s used to host resources on the internet. When we talk about IP addresses within a Vnet or Azure Virtual WAN, we are referring to a private IP address. Private IP addresses are specific blocks of IP addresses reserved for use within a private network. These addresses cannot route on the public internet, sometimes they’re referred to as non-routable IP addresses. Because they are private, they are available to use on our internal networks.</p>
<p>The three blocks of addresses include a class A, that starts with 10, a class B that starts with 172.16 and ends at 172.31, and a class C that starts with 192.168. As we design and deploy routing solutions in an internal network, it’s important to understand that private IP addresses are for internal use only. If a packet with a private IP tries to leave the internal network boundary it’s dropped at the first public router. Also, any public IP address should not be used for internal networks. For example, if we assigned a 172.60 subnet to an internal network, it may work for internal traffic, but if any public resource used an IP from that same 172.60 subnet, the user on the internal network would not be able to access it because they would be routed to the internal subnet instead of to the public.</p>
<p>Also, we cannot have the same subnets represented more than once on the private network. If we had two 10.20.0.0 networks, clients would have problems communicating with resources in either network. This is easy to avoid in new deployments, but as we add hybrid connectivity to our on-premises network with Azure, or add networks through mergers and acquisitions, the potential for overlapping subnets will increase. Take time to inventory and plan network additions to avoid any IP address conflicts.</p>
<p>Now that we understand what private IP addresses are, let’s talk about routing them. Routing, in its simplest form, is how IP Packets from one subnet get to another subnet. To do this, router uses a routing table. The routing table is a list of subnets the router knows about and how to access the subnets the router is aware of. There are two types of routes that can be part of a routing table. A static route, this is a manually defined route. This is the simplest to configure, but has some downsides.</p>
<p>First, any changes need to be manually configured. Also, if there is a problem with the subnet, there is no way for a static route to identify the problem and mark it as unavailable or find alternate paths. A more common option is dynamic routing. Dynamic routes learn about neighboring subnets and pass that information along, forming a dynamic routing table. Dynamic routing can assign weights, or values to each path, providing for optimal routing when there are multiple paths to the same destination. With dynamic routing, any changes in the network are automatically updated and if there’s a problem with a subnet, dynamic routing can find alternate paths to the resource through another subnet.</p>
<p>Dynamic routing is based on a routing protocol. There are several available. Routing Internet Protocol, or RIP, Open Shortest Path First, or OSPF and Border Gateway Protocol or BGP, are just a few. Azure Virtual Hubs use BGP for dynamic routing. We can also add static routes if needed. If we add static routes, those will take priority over any paths learned from BGP. Let’s talk about specific features of Azure Virtual WAN routing. A Virtual WAN uses connections for routing configuration. There are four types of connections. They include site-to-site VPN connections that connect a remote site to a VPN Gateway. An Express Route connection that connects an ExpressRoute gateway to an express route circuit A Point-to-site VPN that connects a VPN user to a Point-to-site VPN gateway. And a hub virtual network connection that connects a VNet to a virtual hub.</p>
<p>Routing is configured for each of these connections when its set up. All connections are added to the Default route table. A connection is associated to only one routing table. This populates the connection information in that routing table. Multiple connections can be associated to the same routing table, but a connection can only be associated to one routing table. Associating the connection to the routing table adds connection information to that routing table, providing a map of what interfaces to send IP traffic based off the destination subnet. The virtual WAN can propagate routing information from the virtual hub to on-premises routers with BGP. Allowing propagation provides networks connected by site-to-site VPN, Point-to-site VPN or Express Route to dynamically learn about available networks over the connection. There’s also a none route table in each virtual hub. Propagating a route to the none table will in effect prevent routes from propagating from that connection.</p>
<p>Route tables can be logically grouped together with labels. This is helpful when propagating routes from connections to multiple route tables. All hubs have a default route table with the label of default. When a connection is propagated to default, it’s automatically applied to all default route tables across every hub in the Virtual Network. Routing can be tricky, and in complicated environments, sometimes things don’t work as expected. If you run into problems, there’s a reset option available in the virtual hub portal intended to bring resources, such as routing tables, the hub router and other virtual hub resources back to it’s provisioned state. Using the hub reset is suggested prior to contacting Microsoft with connectivity issues. In the demo coming up, we’ll view routing information on a virtual WAN and how to do a hub reset.</p>
<h1 id="Configuring-Virtual-Hub-Routing-Demo"><a href="#Configuring-Virtual-Hub-Routing-Demo" class="headerlink" title="Configuring Virtual Hub Routing Demo"></a>Configuring Virtual Hub Routing Demo</h1><p>Let’s start with an overview, of the network we are reviewing. We have one virtual WAN with two virtual hubs. One in East US and one in West Europe. The hubs are connected with a hub-to-hub connection. East US has two VNets with the 10.100 and 10.110 prefix. Our West Europe site has a VNet with the prefix 10.210 and a site-to-site VPN, with the remote site at subnet 10.200. Let’s go into the Virtual WAN portal, and open the virtual WAN. Here we are in the Virtual WAN portal. First let’s look at the East US Hub. To view and modify routing information, go to Routing under Connectivity. Here are the two route tables. Default is the one in use, none will not propagate routing information, to other networks.</p>
<p>Let’s go to effective routes. Select the default route table. This could take a few seconds to open. We have a route for 10.100 and 10.110, the next hub is a virtual network connection. We also have the 10.210 network, that’s on the remote hub. Let’s look at the network diagram again. There is our 10.100 and 10.110 network, and the 10.210, but we didn’t see the 10.200, located over the site to site VPN. We should see that. Let’s look at the West Europe hub, to see what’s going on. We go back to VirtualWAN. West Europe Hub. Here we are in the West Europe Hub. The site-to-site VPN is showing as provisioning.</p>
<p>Let’s go to VPN site-to-site. And here we can see the problem. The site-to-site VPN is not connected. The virtual machine running routing and remote access, is shut down every night for this lab. Because the link was not available, the routes are not showing in the routing table. I’ll pause here and start the server so the site will connect. Okay, now it shows connected. I wouldn’t recommend shutting down servers in production, but this is a lab and it makes for a good example. Let’s go back to the East US Hub. We go to routing, effective routes and select the default route table. This looks better, now both 10.210 and 10.200 are showing, with the next hubs set to the remote hub. WEuropeHub more specifically.</p>
<p>There are two points to recognize. First the route to the remote site-to-site location, was removed and added based on the link availability. This is what dynamic routing is for. When the location is not available, it’s removed from the route table. Second, while the 10.100 and 10.110 connection, is giving a specific next hop location, East US 2 Connect and East US Connect, the 10.210 and 10.200 are simply specifying the remote hub, WEuropeHub as the next hub. Let’s go look at the WEuropeHub and compare.</p>
<p>We go back to the VirtualWAN, going to the WEuropeHub, routing, effective routes, and we’ll select the default route table. Here in the West Europe Hub, we have the 10.200 and 10.210 network, with the next hub showing the connection. But now the 10.100 and 10.110 network, are showing the remote hub as the next hub. In both cases the hub knew that, the subnets were on the other hub. It didn’t know or care to know what interface it was on, it just needs to know the next hub, where to send that traffic.</p>
<p>One last thing before we go. If we run into trouble, maybe routing isn’t behaving like it should, Microsoft recommends doing a hub reset, before contacting support. This can be done by going to the overview page in the hub, and issue a hub reset. Resetting the hub will take a few minutes to finish. That is how to view the routing configuration, on a routing table and issue a hub reset.</p>
<h1 id="Connection-Units-and-Scale-Units"><a href="#Connection-Units-and-Scale-Units" class="headerlink" title="Connection Units and Scale Units"></a>Connection Units and Scale Units</h1><p>We can’t talk about cloud services without including associated costs. Cost for Azure Virtual WAN are broken into three categories: scale units, connection units, and data transfer charges. This lecture will review scale units and connection units. A scale unit represents aggregated capacity for a site-to-site, point-to-site, or ExpressRoute connection. A scale unit is billed by the hour. The actual price will depend on the region and currency. Any pricing shown in this video is for example purposes only. A site-to-site VPN scale unit represents 500 megabits per second. So, if we had a one gigabit per second site-to-site VPN connection, that would require two scale units. A point-to-site VPN scale unit also represents 500 megabits per second per hour.</p>
<p>An ExpressRoute scale unit covers two gigabits per second per hour. Scale units relate to bandwidth. It represents how much data can pass over a given connection. A connection unit relates to an on-premises or non-Microsoft connection to an Azure Virtual WAN hub. That includes a site-to-site VPN gateway, a remote user over a point-to-site VPN, or ExpressRoute. Each connection terminating at a virtual hub is referred to as a connection unit. For example, if we have a virtual hub with two site-to-site connections from branch locations and five users connecting over a point-to-site VPN, there’s a total of seven connections. However, the site-to-site and point-to-site connections are charged different rates.</p>
<p>Let’s take a look at an example of cost for connection units and scale units. In this example, we have one standard virtual WAN hub with two site-to-site connections on that hub. There’s one scale unit for 500 megabits per second of bandwidth and two connection units for the two remote sites. We have a single ExpressRoute connection with 10 gigabits per second of bandwidth. A scale unit for ExpressRoute includes two gigabits per second, so the connection requires five scale units. It also requires one connection unit. After that, we have a point-to-site scale unit. And on average, there are five users connected to the gateway for a total of five connection units. This is the cost of the scale units, connection units, and virtual WAN hub for a 30-day&#x2F;month at Central US billing. This does not include data transfer costs. It illustrates how scale and connection units are billed in a hypothetical environment. Let’s take a look at how to view and modify scale units on an NVA and a site-to-site VPN next.</p>
<h1 id="Connection-Units-and-Scale-Units-Demo"><a href="#Connection-Units-and-Scale-Units-Demo" class="headerlink" title="Connection Units and Scale Units Demo"></a>Connection Units and Scale Units Demo</h1><p>Welcome back. In this demo, we review how to view and modify scale units on a NVA and a site-to-site VPN connection. Scale units refer to the capacity available on a gateway or NVA. We would want to increase capacity if we hit a threshold or likewise decrease the scale unit if the gateway was under-utilized. Let’s first go into the NVA. This is the Barracuda gateway set up previously. Let’s go into the managed application. From the home screen of the NVA, we can adjust the scale units available for the device. Select the new setting and then review and create to finish.</p>
<p>Next, let’s go to the virtual hub with a site-to-site connection. The WEuropeHub shows one VPN site. Let’s go to that hub. Next, go to VPN site-to-site. At the top of the screen, we can select the scale unit. Open that to view and update the scale unit. It’s worth noting that there are two gateways in this configuration for high availability. The throughput is for each interface, so one scale unit is 500 megabits per second for a total of one gigabit per second. Update, then edit to modify the settings. Be aware that it can take up to 30 minutes or longer for the change to take effect. That’s how to view and modify scale units on an NVA and a VPN gateway.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Congratulations on finishing this course, Designing and Implementing an Azure Virtual WAN Architecture. We covered a lot in this course. We started with an overview of Azure Virtual WANs and the services and SKUs or types of Virtual WANs Azure has to offer. We then went on to create a virtual WAN and HUB and connect a VNet and Site-to-Site VPN to the Virtual Hub. After that, we created an NVA and reviewed Virtual Hub Routing. Then we looked at Connection Units and Scale Units and how they work with pricing. Thank you for spending your time on this course and please don’t forget to review the course now that you’ve finished. Your feedback is appreciated.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-to-VNet-VPN-Connections-14/" rel="prev" title="AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-to-VNet-VPN-Connections-14">
      <i class="fa fa-chevron-left"></i> AZ-700-Lab-Connect-Azure-Virtual-Networks-with-VNet-to-VNet-VPN-Connections-14
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-700-Implementing-Azure-Network-Security-16/" rel="next" title="AZ-700-Implementing-Azure-Network-Security-16">
      AZ-700-Implementing-Azure-Network-Security-16 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Virtual-WAN-Overview"><span class="nav-number">2.</span> <span class="nav-text">Azure Virtual WAN Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Services-and-SKUs"><span class="nav-number">3.</span> <span class="nav-text">Services and SKUs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Virtual-WAN-and-Hub"><span class="nav-number">4.</span> <span class="nav-text">Creating a Virtual WAN and Hub</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Virtual-WAN-and-Hub-Demo"><span class="nav-number">5.</span> <span class="nav-text">Creating a Virtual WAN and Hub Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-the-VNet-Connection"><span class="nav-number">6.</span> <span class="nav-text">Creating the VNet Connection</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Site-to-Site-VPN"><span class="nav-number">7.</span> <span class="nav-text">Creating a Site-to-Site VPN</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub"><span class="nav-number">8.</span> <span class="nav-text">Creating a Network Virtual Appliance (NVA) in a Virtual Hub</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-a-Network-Virtual-Appliance-NVA-in-a-Virtual-Hub-Demo"><span class="nav-number">9.</span> <span class="nav-text">Creating a Network Virtual Appliance (NVA) in a Virtual Hub Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Virtual-Hub-Routing"><span class="nav-number">10.</span> <span class="nav-text">Configuring Virtual Hub Routing</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configuring-Virtual-Hub-Routing-Demo"><span class="nav-number">11.</span> <span class="nav-text">Configuring Virtual Hub Routing Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Connection-Units-and-Scale-Units"><span class="nav-number">12.</span> <span class="nav-text">Connection Units and Scale Units</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Connection-Units-and-Scale-Units-Demo"><span class="nav-number">13.</span> <span class="nav-text">Connection Units and Scale Units Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">14.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
