<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Course IntroductionHi, my name is Kelso Sharp, thanks for checking out my course. I’ve been writing web applications for the past 20 years. I’m also a Microsoft Certified Professional and an Azure Clo">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5">
<meta property="og:url" content="https://example.com/2022/11/18/AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="Course IntroductionHi, my name is Kelso Sharp, thanks for checking out my course. I’ve been writing web applications for the past 20 years. I’m also a Microsoft Certified Professional and an Azure Clo">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T00:37:35.000Z">
<meta property="article:modified_time" content="2022-11-27T05:25:08.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:37:35" itemprop="dateCreated datePublished" datetime="2022-11-18T20:37:35-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-27 01:25:08" itemprop="dateModified" datetime="2022-11-27T01:25:08-04:00">2022-11-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-400/" itemprop="url" rel="index"><span itemprop="name">AZ-400</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-400-Implementing-and-Managing-Azure-Build-Infrastructure-5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Course-Introduction"><a href="#Course-Introduction" class="headerlink" title="Course Introduction"></a>Course Introduction</h1><p>Hi, my name is Kelso Sharp, thanks for checking out my course. I’ve been writing web applications for the past 20 years. I’m also a Microsoft Certified Professional and an Azure Cloud Architect. I have been working with the Microsoft web development stack since 1996.</p>
<p>In this course, we’re gonna be diving into implementing and managing build infrastructure using <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines/">Azure pipelines</a>. If you run into any issues during the course please feel free to email <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a> and the team here at Cloud Academy will do our best to get your issue sorted out as quickly as possible.</p>
<p>This course is intended for IT professionals looking to become certified DevOps professionals, IT professionals from other cloud providers looking to get a better understanding of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>‘s way of doing things, and pretty much anyone that wants to get a better understanding of the Azure build infrastructure processes.</p>
<p>It’s expected that you have some understanding of the software development process, maybe you’ve played with DevOps a little bit and would like to learn more. I have the expectation that you understand what DevOps is and understand the relevant terminology. While you don’t need to have knowledge of any particular programming language I recommend that you have at least a high-level understanding of the software development process. It would also be prudent if you had knowledge of Git and some knowledge of the agile software development methodology.</p>
<p>We will be covering the course objectives with more of an eye towards the technical side so more on the practical side as opposed to theory. I will be showing you the various build options. While there will be some theory in this course, most of it will be explaining and demonstrating how to implement our build infrastructure.</p>
<p>First, we will look at what an Azure build pipeline is, and why you might wanna use it and then we’ll learn how to create a pipeline, and add tasks to it. This is gonna give us a first look at the Azure DevOps user interface. Then we will move on to build agents, what they are, what the differences between the different agents are and agent pools, that they are, what they do and why we use them. And we’ll look at third party build server integration with Jenkins, third party code repos like GitHub.</p>
<p>By the end of this course, you should be comfortable with building an Azure DevOps pipeline, adding automation tasks, using the visual designer for adding build tasks. You should be able to create a pipeline that closely matches an existing build process you work with and you should be able to determine a pipeline strategy based on the information given to you during a discovery process.</p>
<p>Alright, that’s a lot to cover, so let’s get rolling!</p>
<h1 id="Azure-Pipelines"><a href="#Azure-Pipelines" class="headerlink" title="Azure Pipelines"></a>Azure Pipelines</h1><p>In this lecture, we will be talking about Azure Pipelines. Azure Pipelines is Microsoft’s cloud service offering for creating Continuous Integration and Continuous Delivery.</p>
<p>In this section, we will be talking about what Azure Pipelines are and what they do, and then we will go through a demo of how to create an Azure Pipeline.</p>
<p>What are Azure Pipelines? Well, we cannot talk about Azure Pipelines without first having a clear understanding of what Continuous Integration and Continuous Delivery CI&#x2F;CD for short are.</p>
<p>The concept of Continuous Integration is constantly and frequently integrating code updates to a shared repository for testing and use by other developers and processes. Code committed to this shared repository is verified by an automated build process and additional tasks allowing individual pieces of code to be checked for problems that could introduce breaking changes or potential bugs into the application. Typically code that breaks the build is prevented from being committed to a shared repository.</p>
<p>The concept of Continuous Delivery is the process of handing off code to the quality assurance team for testing as part of an agile process. Testing at this stage is to detect bugs that are logical in nature and while the syntax of the code committed may not break the build, it may not execute as expected or may not meet the acceptance criteria for resolving the problem. Testing earlier in the software development process is done in hopes of detecting and fixing bugs before they make it to production. This process typically involves deploying to a staging area and generally does not add direct value to the user, but it is a necessary step in the agile software methodology.</p>
<p>As an aside, the concept of continuous deployment often gets confused with continuous delivery. In this automated process of deploying code, this code must again pass a series of automated tests and manual requirements to be accepted as production-ready and deployable. The continuous delivery and continuous deployment terms are often confused with each other. However, they are not the same thing and comprise two parts of a larger DevOps whole.</p>
<p>I find the best way to visualize a build pipeline is like an assembly line in an auto factory. The raw materials in our case code starts at the beginning of the process and at the end, you have a drivable vehicle. For us, a testable piece of code. At each station, along the way, a new piece of functionality or modification is added. For us, we call these tasks and once all the stations or tasks have done their work, we should have a testable piece of code that can be sent to the QA department.</p>
<p>Azure pipelines work with many different languages like C#, C++, Python, Go, and many more. One requirement of using Azure Pipelines or any CI&#x2F;CD automation tool is having a code base stored in a version control repository accessible by <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. You must set up both an organization and a project in Azure DevOps. Projects can either be publicly accessible or private. This has a significant impact on the pricing model used for creating and running Azure Pipelines.</p>
<p>Azure Pipelines also works with many various version control systems like Azure Repos, Team Foundation version control and GitHub, which we will be talking about later in this course. You can build and deploy almost any type of application. Some examples are .NET, Node JS, Java, even Xcode.</p>
<p>It’s also possible to deploy your code to multiple deployment targets such as virtual machines, on-premise servers or Azure-hosted environments. You can even deploy to other cloud service providers like AWS or GCP.</p>
<p>You can choose from many types of deployment packages like NuGet, npm, zip files and others. There’s an amazing amount of versatility within the Azure DevOps service offering from Microsoft and Azure Pipelines are the foundation upon which the build process automation are built.</p>
<p>As I mentioned during the intro section, your project accessibility has a large impact on the pricing model used by Azure DevOps pipelines. If you have a publicly accessible project in a public repository like GitHub, then Azure Pipelines are free. Free is a nice option, but having your code visible to the world might not work for you. If you have proprietary systems that should be protected or if youR code security is an issue for you, then this is not likely an option for you. Luckily, Microsoft provides 1800 minutes or 30 hours of build time for pipelines in private projects. This is a lot of time, but if you have exceptionally large projects that take many hours to build, then managing your build hours can be very important. Luckily, you can disable your pipeline to prevent unintentionally using build minutes. Later in this course, we’ll be talking about private hosted build agents. This is another option for reducing build hours used in Azure Pipelines.</p>
<p>So now we know what Azure Pipelines are, why do we wanna use continuous integration and continuous delivery and Azure Pipelines? Some of the major reasons for using continuous integration are increasing and maintaining code quality, catching potential errors earlier in the development process, ensuring code testing and code test coverage is maintained and maintaining consistent code style across entire applications. </p>
<p>Major reasons for using continuous delivery, reducing and removing time-consuming and error-prone manual processes, keeping your development staging and production environments up to date, ensuring that your <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/course-introduction/">infrastructure</a> is secure and properly maintained, automating integration and regression testing. These are just some of the reasons that you might wanna use CI and CD.</p>
<p>All right, now we know what Azure Pipelines are and what we use them for. Next, we’ll go through a demo and we’ll create our own <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines-demo/">Azure Pipeline</a>.</p>
<h1 id="Azure-Pipelines-Demo"><a href="#Azure-Pipelines-Demo" class="headerlink" title="Azure Pipelines Demo"></a>Azure Pipelines Demo</h1><p>In this demo, we create our first <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines/">Azure DevOps pipeline</a>. Pipelines exist inside of a project and projects are part of an organization. So we’re gonna create all three and connect our project with a code repository in GitHub. I have created a sample project you can use in GitHub, and we will discuss how you can use that in your own project in a few minutes.</p>
<p>The first thing we need to do is open our browser to dev.azure.com. Now, if you do not have an Azure DevOps account, you can click on the Start free button and create one or if you already have a GitHub account, you can click on the Start free with GitHub button and use your GitHub credentials to sign up for a DevOps account.</p>
<p>Once we have an Azure DevOps account, and we’ve signed in, we can click on the sign into Azure DevOps link, and it will take us to our organization page. You can have multiple organizations and here’s where we’re gonna create our new organization for our project.</p>
<p>We will click the new organization link here on the left-hand side, this will bring up the Getting Started with Azure DevOps dialog. At this point, Microsoft is indicating that if we continue past this point, we are accepting the terms of service for Azure DevOps. It also has a checkbox here if you want Microsoft to send you more information on <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. So let’s just go ahead and click the Continue button.</p>
<p>You will be asked to provide a name for your organization. Keep in mind here that your name must be unique across all of Azure DevOps. I’m just gonna use the one that they’ve provided for me here, this will be appended to dev.azure.com to form the access URL for your organization. We will also need to select the region where we’d like our organization to be hosted. So we will select a region and click Continue.</p>
<p>This brings us to the main page for our organization. This page has a form for creating your first project on the right-hand side. We’re just going to enter a project name for our new project. I just wanna mention here again how private and public projects differ. If you choose a private project here, your code will be kept private, and no one will be able to see or contribute to your project, unless you expressly give them permission by adding them to your organization and to the project user group. Make sure you exercise caution here, if you’re not sure, choose private, you can always make it public later. So in my case, I have a sample code repository set as public so that I can share it with you. So I’m gonna choose public.</p>
<p>At this point, let’s talk briefly about the sample project in GitHub, I’ve created a GitHub repo at the following <a target="_blank" rel="noopener" href="https://github.com/kelsosharp/Managing-and-Implementing-Build-Infrastructure">URL</a>. This is a basic .net core solution with a main project and a test project. It is a basic MVC project template and the test project just has a couple of working unit tests. The goal with this project is not to show you how to write code, but it’s just so that we have a code project for our pipeline to build. All you need to do at this point is go to the sample project at the URL I gave you and fork this project to your own GitHub account by clicking the fork button in the top right of the repository page.</p>
<p>Okay, now we have our organization, our DevOps project, and our .net core solution, we can now go ahead and create our new pipeline. On our project page, let’s click our pipeline menu option. And since we do not already have a pipeline yet in our project, a page is gonna show up with a button on it for us to click to start configuring our first pipeline.</p>
<p>It’s going to ask us where our code is, this is where we select our repository type provider. There are a few options here like the Bitbucket or Subversion. You can even select a generic git repository provider if you have your own on-premise git server. In our case, however, we’re using GitHub, so let’s just go ahead and click on the GitHub selection.</p>
<p>Now it will ask us to provide our GitHub credentials and sign in to GitHub. If you forked the sample repository to your own account, you should see your repo in this list, go ahead and click this repository.</p>
<p>Although not shown here in the demo, this action will likely bring you to a repository authorization page for your code repo. And it’s gonna ask you to give Azure DevOps access to the selected repos, you can go ahead and grant access for the Select repos and this will bring you back to the Azure DevOps page. And it will now ask us what type of pipeline we’d like to configure.</p>
<p>As you can see, there are a ton of choices here, from .net core, Node.js, you can configure for Android, you can even use XCode workspaces where you can build and test MacOS applications. There’s something here for everyone and this list will continue to grow as Microsoft adds to its service offerings for Azure DevOps.</p>
<p>Since our solution is a .net core project, we will choose the .net core for our pipeline. This will create an initial pipeline with a few initial tasks. These are tasks that are common to most .net core solutions.</p>
<p>Now that our initial pipeline is created, what you’re looking at here is YAML. It’s the configuration language that Azure DevOps uses to configure the task that you will run whenever you commit changes in your software project to your GitHub repo.</p>
<p>So we have our initial pipeline configured, let’s save and run it and see what happens. Clicking Save and run it will ask us if we wanna commit our new YAML file to the master branch, or if we’d like to create a new branch. This means that our pipeline <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines/">build</a> configuration is also stored in our code repository, and we’re able to track changes to this file, just like any other code file in our project.</p>
<p>It will just take a minute or two to create the pipelines. So I’ll speed up the time here and then we’ll click into the jobs and see it as it runs.</p>
<p>While our job is running, I’ll explain what is happening in our basic pipeline. First, it initializes the job. If we have a look at the job initialization task, we see that it’s using a hosted agent. This is a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-build-agents/">build agent</a> that is supplied by Microsoft to run our build tasks. In the module on build agents, we will look at what a build agent is in a bit more depth, and have a look at the differences between private and hosted agents like this one. Then the job is gonna download all of our tasks to the agent machine, it’s going to check out our code from our code repository. After that, it will install our NuGet package manager, then it restores all of our NuGet packages, builds our project and runs our unit tests. It then cleans up after itself by removing the repository credentials and tearing down the virtual machine that the build agent is using. This is an important step. We don’t want our code out on a shared agent machine. Finally, if we have any reporting tools configured for our tests, it will generate the tests or code coverage reports and drop them into our artifacts section.</p>
<p>Now at the time of this recording, the initial unit testing tasks that’s created on the default pipeline doesn’t actually run your unit tests. Microsoft is in the process of making updates to Azure DevOps and there’s a known issue with this particular task. This task is trying to use an older version of MSBuild, and unfortunately, it cannot actually find the test in your project. When we look at YAML in a later module, I’m gonna show you how we’re gonna change this task to use the updated .net core command line build tools to run our unit tests.</p>
<p>Okay, there you have it, we’ve built our first Azure DevOps pipeline. Now we have it, what can we do with it? Well, you’re in luck, I’m gonna show you some additional things we can do with it in the next few modules.</p>
<h1 id="Azure-Build-Agents"><a href="#Azure-Build-Agents" class="headerlink" title="Azure Build Agents"></a>Azure Build Agents</h1><p>In this lecture, we are going to talk about build agents. A build agent is a piece of software that runs a series of build tasks called a job, on a machine. In <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines-demo/">Azure pipelines</a>, there are two types of build agents, Microsoft-hosted agent, and self-hosted agents. We are gonna go through a deeper explanation of build agents in this module.</p>
<p>A Microsoft-hosted agent are agents that Microsoft provides for running your build tasks, but there is more to a Microsoft Hosted agent than just a simple piece of software. You are also getting a new virtual machine that is spun up with the latest operating system, whether it’s Windows or Linux, or macOS, it will have the latest security updates, patches and maintenance updates without you needing to do anything at all. Microsoft-hosted agents can run a job directly on a virtual machine, or in a container, but for now the easiest way to understand a container is it’s just a toolbox with a very specific set of tools that you hand pick to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/course-introduction/">build your application</a>. In many cases for simple to moderately complex applications a simple Microsoft-hosted agent is more than enough to satisfy the needs of the project. Best of all, this is a free service up to 1,800 minutes a month, with a maximum build job length of six hours, for private projects and completely free for up to 10 parallel jobs for public projects.</p>
<p>Next, we have Self-Hosted Agents. A self-hosted agent is an agent that you install on your own machine whether that is a virtual machine in the cloud managed by you or an on-premise server that you also manage yourself, you are responsible for making sure that the operating system is kept up to date with the latest security patches and maintenance updates. Not only can you use self-hosted agents in Azure pipelines, but also in Team Foundation Server if you happen to have an on-premise TFS server. This agent can be installed on any machine you have access to, however that machine will also need to be able to access <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>, either through the internet or over a private express route connection.</p>
<p>As a first step, Microsoft recommends trying the Microsoft-hosted agent first to see if it does all that you need it to do for you, if not you can check the logs that are created in the build process to see where you might need more than what the Microsoft-hosted agent can offer. There are however a few guidelines that can tell you quickly if you need to host your own agents on your own machine.</p>
<p>The simplest factor is project size, the maximum project size is 10 gigs including build output. Microsoft Hosted agents use a Standard_DS2_v2 virtual machine image. This image has two virtual CPU’s seven Gigs of Ram, 14 Gigs of temporary SSD storage. This is just an average machine in most respects. If you need more information about this image, you can find it here at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-machines/sizes-general#dsv2-series">URL</a>. If you need more powerful hardware, then self-hosted is likely the way to go.</p>
<p>Some of the other limitations of the Microsoft-hosted agents are that you cannot sign into the agent machine, you cannot drop artifacts to a UNC file share, and you cannot run XAML builds.</p>
<p>Microsoft-hosted agents also use a standardized list of operating systems and software configurations. There are eight options, four versions of Windows, two versions of Ubuntu, and two versions of macOS. You can find the list at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops">URL</a>.</p>
<p>So, if you need a version of an operating system or Visual Studio that’s not part of the standard list you will need to use a self-hosted build agent instead.</p>
<p>If only the version of the software installed on the agent machine is a concern and not the operating system itself, Microsoft-hosted agents also have the option of using either a Windows or Linux container and using your pipeline to install the version-specific software and tools you need to build your project.</p>
<p>There are however some unique requirements and limitations for each operating system. You can find the specific requirements and limitations of the container Jobs here at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops&tabs=yaml">URL</a>.</p>
<p>In this topic on build agents, I would be remiss if I did not discuss pricing and costs, since one of the main determining factors of the cost of Azure pipelines, is the length of time and concurrency of running our build jobs. As I mentioned before, pricing is affected by the visibility of your project. A free tier is limited to 1,800 minutes or 30 hours of build time per month, with a maximum job length of six hours and can only run a single job at a time. For public projects, the build minutes restriction is removed, the job length, however, is still six hours. In the free tier with a public project gives you 10 parallel jobs. Once you go above the free tier though you will need to pay for each parallel job, and buying the first parallel job for a private project does not actually allow you to run more than one job at a time, it simply removes the build minutes restriction and you will need to buy a second parallel job if you wanna run two parallel jobs at the same time.</p>
<p>This brings us to Agent pools. Instead of dealing with each agent individually, sometimes it makes more sense to manage a group of agents. Agent pools are just that, a way to manage groups of agents rather than each individual agent on its own. In Azure Pipelines the agent pools are configured in the organization and project settings depending on the user’s access permissions and these pools are accessible based on the level at which they are created. Therefore build agent machines are registered in the organization agent pool, and the organization level pool can be referenced by any project-level pool in a one to many mapping. Project pools, however, can only be referenced by one project at a time.</p>
<p>For example, let’s say we have an organization called Org1, and we create an agent pool called Org1 Agent Pool, and we add 2 build agent machines to this pool called Build Agent A and Build Agent B. Let’s assume that we have project X and Y. In project X, we create a project agent pool called Pool X, and we reference the Org Agent Pool. Project X would then be able to use both Build Agent A and Build Agent B in its build pipeline to build project X. Now let’s create an agent pool in project Y. called Pool Y at the project level. If we tried to reference another agent pool we would not be able to see the Pool X. We would only be able to see Org1 Agent Pool. If we choose not to reference an existing organization level agent pool when creating this new pool, a new pool would be created at the organization and project level named Pool Y and the new organization-level pool would not contain any build agents. With Azure DevOps Server, the new name for what was formally Team Foundation Server, agent pools are shared across the entire server so you can utilize agent pools across projects and collections.</p>
<p>The default agent pool type is for registering self-hosted agents. The Azure pipelines hosted pool can be used with any of the standard machine configurations from the Microsoft-hosted agent virtual machine images list. As with most things in Azure pipelines, agent pools can be managed in several ways, from the web UI, YAML, and from the Azure DevOps Command Line Interface.</p>
<p>In our next video, I will show you how to create a self-hosted agent, and how to create and configure an <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-build-agents-and-pools-demo/">agent pool</a> for our project.</p>
<h1 id="Azure-Build-Agents-and-Pools-Demo"><a href="#Azure-Build-Agents-and-Pools-Demo" class="headerlink" title="Azure Build Agents and Pools Demo"></a>Azure Build Agents and Pools Demo</h1><p>In this demo, I’m gonna show you how to create organization and project level agent pools, and how to install and register <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-build-agents/">build agents</a> into our organization pool and how to reference organization pools from our projects.</p>
<p>Some things to know when using self-hosted windows agents is that it must be Windows 7 or higher, if you are using a client operating system, and if you are using Windows Server, then it must be Windows Server 2008 R2 SP1 or later, and you must have PowerShell 3.0 installed. It’s also recommended that you have installed Visual Studio 2015 or later, and the .net framework 4.6.2 or later.</p>
<p>One of the main reasons for using a self-hosted agent is machine hardware. For example, the code for Azure DevOps itself uses a pipeline with a 24-core server and four self-hosted agents on a single machine.</p>
<p>To prepare for this demo, I have created an <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> virtual machine with Windows Server 2019 and Visual Studio Enterprise 2019. This is a Standard_D4_v3 image, it has four CPUs, and 16 gigs of RAM.</p>
<p>When creating agent pools, there are two levels of scope for an agent pool: One is at the organization level, and one is at that project level. When you create an agent pool at the project level, a matching agent pool is created at the organization level, so you’ll have two identical pools, one at the project level and one at the organization level. This is a one-to-one mapping.</p>
<p>The first thing we’re gonna do is sign into our organization page. Then, we’ll click the organization settings in the bottom left-hand corner. This will open our settings menu. Then, we will click on the agent pool menu option. This will open our agent pools page. This already has a pool named Azure Pipelines and one named Default. The Azure Pipelines is for Microsoft Hosted agents, and the Default is for self-hosted agents. If you do not mind the name of Default or Azure Pipelines, then you don’t need to change anything here. You can simply add Microsoft hosted agents or self-hosted agents to the various pools. We are going to add a new pool here and show how to reference the organizational level pool from the project level pools. There are two configuration options when creating an organizational level pool. The first, grant access permissions to all pipelines, if checked, will give all existing pipelines access to the newly created agent pool. The second is Auto-provision this agent pool in all projects. This option, if checked, will automatically add a matching project level pool to any new projects we create. I’m gonna leave these unchecked for now.</p>
<p>Next, we will create our project-level agent pool. We bring up our project, click on the project settings. Then we’ll click on the agent pool’s option, and that will bring up our agent pool’s page. They’re matching Azure Pipelines and Default pools on this page. This is at the project level. We’ll go ahead and click the Add button, and now we have the option for selecting a new or existing agent pool. Selecting the existing agent pool will give us a list of the organizational agent pools to choose from. We will select the existing option and select our Org1 Agent Pool. I’m gonna uncheck the Grant access to all pipelines, and click Create. This will create a project-level agent pool, that has a direct reference to our Organizational agent pool of the same name.</p>
<p>The next thing we need to do is to create a Personal Access Token, or PAT. This is how we are gonna authenticate the agent machines with our DevOps organization, and project. We will click on the person icon here in the top right, and bring up the profile menu. Then, we will select Personal Access Tokens. This will bring us to the page where we can add an additional token. Go ahead and click the New Token Button. And we’ll give our token a descriptive name. I’m gonna use Build Agent. Then, we need to set the permissions for the token here. We have the option of giving full access to the token or we can give very specific permissions. We can also set the expiration length here. It has the option to never expire. But I’m just gonna leave it for the default expiration of 30 days, and we only need to give Build, Read and Execute, and Agent Pools, Read and Manage, permissions to this token. To find Agent Pools, we’re gonna need to click the Show All Scopes. Once we have set everything set, click create, this will create a new Personal Access Token, and give us the option to copy the token. It’s very important to remember that this is the only time Azure will show you this token value. There is no way to retrieve the token value once you leave this page. You can edit the permissions later and you can regenerate the token, but you can never get this particular value back. So it’s a good idea to copy it and store it with your other secure passwords.</p>
<p>Now, we need to login to our build agent machine and open our browser to our organization DevOps page. After we sign into our organization, we click the organization settings. Then, we’ll click on the agent pools options and then we’ll click the new Org1 Agent Pool that we created and click on the Agents tab at the top. This will bring us to our Agents page with a button for adding a new agent. We will go ahead and click this button, and a dialog will pop-up with instructions on how to install an agent. It has the option to download the zip file for the agent software, or you can copy and paste a script, we are gonna download this file and run the installer. If you are comfortable with PowerShell and fully understand the script that is being run, then feel free to use that option.</p>
<p>Once we’ve downloaded the file, we will unzip it to its own directory. Once this is done, I am going to create a second build agent directory and copy all of the files to the new directory, so that I can create a second build agent on this machine. In the address bar of the Windows Explorer, we can just type CMD and that will open a Windows Command Prompt in our current directory. We will run the config.cmd file and this will ask us a series of questions about our organization and agent pools and authenticate our build machine using the Personal Access Token we created earlier. This will configure our agent, and send a list of capabilities to our organization. The first thing it needs to know is the access URL to our organization. I’m just gonna copy mine from the browser address bar. Then, it’s gonna ask us how we want to authenticate with our organization. We can choose PAT, Personal Access Token, by default by typing PAT or hitting enter. You can also use a windows username in the format of domain slash username, or <a href="mailto:&#117;&#x73;&#101;&#114;&#x6e;&#x61;&#109;&#x65;&#64;&#100;&#x6f;&#109;&#97;&#x69;&#x6e;&#46;&#x63;&#111;&#109;">&#117;&#x73;&#101;&#114;&#x6e;&#x61;&#109;&#x65;&#64;&#100;&#x6f;&#109;&#97;&#x69;&#x6e;&#46;&#x63;&#111;&#109;</a>. If you’re using this format, it will then ask you for a password for your account. We, however, will be using a Personal Access Token. Then, I will just paste my Personal Access Token here. It then authorizes the build agent machine with our organization and connects. Now, it’ll ask us which agent pool we’d like to use. You can just hit enter if you want to use the Default, a self-hosted agents pool, but in our case, we want to use the one we created, so I’ll just copy the name from our organization agent pool page.</p>
<p>Now, we enter our build agent name. Hitting enter will use the machine name of the computer. I’m gonna use Build Agent A. It then scans for all the relevant software installed on the build agent machine and adds the machine to our organizational agent pool. It’s then going to ask us for a name for our working directory. This is the directory that all our tasks and working files are saved to when building our project and using our build agent. I’m gonna hit enter and use the default entry. It’s now asking us if we want to run the agent as a service or interactively. Running interactively requires additional configuration and can involve domain policies, which are not within the scope of this course. We are gonna type Y for yes, and then it’s gonna ask us if we want to use the NT AUTHORITY\NETWORK SERVICE as the user account for the service. We’re gonna hit enter and accept the default. It will then finish setting up our build agent and let us know if it was successful or not.</p>
<p>Some of the reasons that it may fail are failure to authorize our PAT, no network connectivity to the server, or not having write permissions on the directory the build agent is installed in. We have now installed our first build agent, and I’m going to quickly install a second build agent. It’s an identical process, it lends itself well to scripted and unattended agent installations from multiple agents.</p>
<p>Now that we have our agent pools configured and our build agents installed, we can now update our pipeline to use our pool of agents to build our project. I will navigate to our project pipeline and click edit. This will bring up the YAML file. Now, I’ve already configured a pipeline to use the new project agent pool, which delegates to our matching organization pool. All that I’ve changed here was to replace the vmImage attribute with the Name attribute under the pool heading in the YAML file. I’ve also set the name attribute to our new project agent pool Org1 Agent Pool. And I’ll just click run. But wait, what happened? Remember when I unchecked the option to grant access to all pipelines? Unchecking this box means that we must give permissions to the pipeline to access our agent pool. So we can just click the Authorize Resources button to the right of this message.</p>
<p>Now if we happen to forget to create a project-level agent pool that maps to our organizational agent pool, then when we run this pipeline, we would get an error that says it cannot find the pipeline named Org1 Agent Pool. So, there must be an agent pool at the project level that references an organizational level agent pool that contains build agents in order to be able to use the agents to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/course-introduction/">build our project</a>.</p>
<p>Now, let’s try and run our pipeline a second time and see if it uses both of our build agents. This first one here, it’s using Build Agent B. Let’s check the other running job and see which build agent it’s using. And as you can see here, Build Agent A is being used. So, both the agents in our agent pool are being used.</p>
<p>So, in this demo, we created an agent pool at the organization and project level and mapped the project agent pool to the organization agent pool. We installed and configured two separate build agents on a virtual machine that has Windows Server and Visual Studio installed, and we’ve configured our pipeline to grab an available agent from the build agent pool to build our project. Before Azure pipelines came along, this process involved knowing and running complex PowerShell scripts that could be hard to understand and fix when things did not go quite as planned or unique environments came into play. But as you can see in this demo, Azure DevOps has really made an effort to simplify this process as much as they can.</p>
<p>I hope you enjoyed this demo, and I look forward to seeing you in our <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/parallel-jobs/">next module</a>!</p>
<h1 id="Parallel-Jobs"><a href="#Parallel-Jobs" class="headerlink" title="Parallel Jobs"></a>Parallel Jobs</h1><p>In this lecture, we are going to talk about concurrent or parallel jobs and some of the strategies for determining how many we need. Recommending a strategy for running <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-build-agents-and-pools-demo/">build jobs</a> in parallel or concurrently requires several considerations. Concurrent jobs or as they are now called in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> DevOps, parallel jobs. Azure DevOps provides the ability to run one parallel job for free. Now the term job has multiple meanings in Azure DevOps and the context is important.</p>
<p>A pipeline can have several jobs, which in this case is a task or series of tasks to be run in a pipeline. A parallel job is what runs a pipeline job and one parallel job is required to execute one pipeline job.</p>
<p>Azure DevOps gives one parallel job to every organization for free. Private projects have a build time limit of 1800 minutes or 30 hours, it also can only run one pipeline job at a time. Public projects, which is projects that are part of the Azure Pipelines public project, or pipelines that build the public repository from GitHub, the build time limit time is removed and you get 10 free parallel jobs.</p>
<p>There’s also a slight difference in the free tier offering when it comes to types of agents being used. With Microsoft-hosted agents, there is a maximum time limit for the job of 360 minutes or six hours. If you choose to use a self-hosted agent then there’s no time limit on the self-hosted jobs. You can also get one additional free self-hosted parallel job for every user in your organization that has an active Visual Studio Enterprise subscriber account.</p>
<p>So how do we determine if we need additional parallel jobs? According to Microsoft, the simple estimate would be to run one parallel job for every four to five users in your organization.</p>
<p>Some scenarios where you might consider additional parallel jobs are: you have multiple teams of developers working on a single application, if your continuous integration triggers multiple builds from multiple branches, it’s recommended that you have one parallel job for each branch, or if you develop multiple applications in a single DevOps Organization, the simple recommendation is one parallel job per application.</p>
<p>This can be extended as needed by your organization. Let’s consider this scenario.</p>
<p>You have a single organization, your organization has four development teams of five people on each team, working on three different applications. The first application is a website for your company, second application is an internal desktop application and the third application is a XAML application for your warehouse to provide updated inventory levels on demand. It requires two XAML build controllers. Your web application has a master, develop, test, stage and release branch, and your CI pipeline will build and deploy to a deployment pipeline in Azure if after deploying to the test server, all of the automated tests pass. Your internal application is a very small utility that takes a couple of minutes to build and deploy, it just has a master branch and when commits are made to the master branch it triggers a build and drops the output into an artifact’s directory if successful. Your XAML application has a master, develop, test and release branch. All code committed to each of the branches triggers a build job and an artifact drop, but deployments are done manually.</p>
<p>Using the guidelines provided previously, we would need four parallel jobs for the development teams, each team having four to five members each. Three for our applications, one per application. In our website pipeline, we have five branches but only two of them actively use CI triggers. So that’s only an additional two rather than five. Also, server jobs, either Azure Pipelines or TFS, and deploying to a deployment group using a release pipeline do not take up a parallel job.</p>
<p>Though there could be an argument made here for five depending on the size and build time of the application in question.</p>
<p>We’ve already counted a parallel job for our internal application, and since this is a small application, it doesn’t take very long to build and deploy an additional parallel job for the master branch is likely overkill. Our last application already has a parallel job, but this is a XAML application and it requires two build controllers. XAML build controllers require one parallel job per controller and we can count the one for the application and one additional for our second XAML build controller.</p>
<p>So, another simple way to determine how many parallel jobs you need without initially spending any money is if the number of builds queued starts to exceed the number of parallel jobs you have and the queue delays starts to take more time than is acceptable, simply add additional parallel jobs until the queue delay time is back down to an acceptable level. The exception to this rule is XMAL, XAML always requires one parallel job per build controller and must use a self-hosted agent and self-hosted parallel job.</p>
<p>An important note here, when you first decide to buy your first parallel job, that will only remove the time restriction from the free tier, if you need to actually run two jobs in parallel, you will have to purchase an additional parallel job.</p>
<p>How do I know if I have more builds queued than parallel jobs? Well, I am glad you asked. If you wanna check out your parallel job usage information, it’s good to know where to find it. Parallel job information can be found in the organizational settings by selecting Parallel Jobs from the Menu.</p>
<p>This page will show you a lot of useful information, like how many minutes of your free tier you have used, how many parallel jobs you have, and it gives a breakdown of where your parallel jobs are coming from; free tier, visual studio enterprise subscriber or paid. This is also a nice way to visualize the free tier limitations.</p>
<p>So now that we have a better understanding of parallel jobs and we have some strategies on how to determine how many parallel jobs we might need. I look forward to seeing you in our <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/service-connections-hooks-and-webhooks/">next module</a>.</p>
<h1 id="Service-Connections-Hooks-and-Webhooks"><a href="#Service-Connections-Hooks-and-Webhooks" class="headerlink" title="Service Connections, Hooks, and Webhooks"></a>Service Connections, Hooks, and Webhooks</h1><p>In this lecture, we are gonna talk about service connections, service endpoints, and webhooks. A service connection, in simple terms, is a defined connection that allows <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> DevOps to communicate with an external service. Some well-known services, like GitHub or Jenkins, already have service connections that you can configure in Azure DevOps, but what if you wanted to create your own unique service that responded to events from Azure DevOps to perform some unique action? That’s where service endpoints, extensions, and webhooks come into the picture. Service providers, or service hook publishers, create a definition for a set of events that can be subscribed to.</p>
<p>Subscriptions are a way to subscribe and listen for specific events. Subscriptions also define a set of actions that can be taken directly, or they can target external services, called consumers, that run their own action or set of actions based on an event that was raised.</p>
<p>To integrate Azure DevOps with external services, you use service connections or service hooks, and the service endpoint is the set of properties provided to a service connection or service hook. To integrate Azure DevOps with external services, you use service connection or service hooks, and the service endpoint is the set of properties provided to the service connection or service hook to give you the information needed for the connection to function.</p>
<p>Some of the properties that you’ll find in a service endpoint are Service Name, Description, Server URL, Certificates or Tokens, User names, and Passwords.</p>
<p>Publishers, consumers, and service endpoints all come together to form a service connection that can be used to create extensions or custom tasks that need to connect to external services. Extensions utilize service endpoints to gather information to be able to integrate Azure DevOps and perform their own tasks based on events they subscribe to.</p>
<p>There are many extensions available in the Visual Studio Marketplace that utilize service hooks and endpoints. They fall into several categories: Build and Release, Collaborate, Customer Support, Plan and Track, and Integrate.</p>
<p>Under the Integrate category, we find webhooks. Webhooks are a way for a server to call a client-provided endpoint to let the client know that an event has occurred on the server without the client being required to constantly poll the server for new events. You can create a service connection that uses a webhook to post to a REST endpoint in your own application, or you can use a webhook to connect to an external server that has a REST endpoint.</p>
<p>You can set up a webhook by providing a trigger definition. Some examples of this are Build Completed, Code Pushed, and Pull Request Created. You also can add a filter, so that your webhook can be limited to a single project, and a build status, like succeeded or failed. You can also send HTTP Headers, messages, and event data. Event data is sent as JSON. You can also optionally send basic authentication credentials. Once you created your webhook, you can test it by sending a message during the configuration steps to make sure that you’ve configured the webhook correctly and you’re getting a response from your endpoint.</p>
<p>So, as you can see there’s a ton of extensibility options available to you if Azure DevOps doesn’t have everything you need. We will be talking more about third-party integration in the module on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-jenkins-integration/">integrating Azure with Jenkins</a>. I’ll see you there.</p>
<h1 id="Azure-Jenkins-Integration"><a href="#Azure-Jenkins-Integration" class="headerlink" title="Azure Jenkins Integration"></a>Azure Jenkins Integration</h1><p>In this lecture, we’re gonna talk about Jenkins and it’s integration with <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-pipelines-demo/">Azure Pipeline</a>. Jenkins is a build automation server that helps you automate, build, and scale your continuous integration and delivery process. Jenkins can be hosted in Azure or on-premise. You can also use <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> to extend the capabilities of your on-premise Jenkins server by utilizing Azure in several ways.</p>
<p>There are three ways to install and host a Jenkins server in Azure. You can create a Linux virtual machine and install Jenkins manually, you can use the Jenkins solution template, and finally, you can host it on a Kubernetes cluster running in the Azure container service. Jenkins server deployments can be monitored through the Azure monitored logs and Azure Command Line Interface.</p>
<p>Azure’s integration with Jenkins supports build automation scaling for your build capacity by allowing you to add additional <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-build-agents/">build agents</a> to your Jenkins server as complexity and needs increase. You can use the Azure VM Agents plug-in to run these additional build agents.</p>
<p>Azure-integrated servers use Azure Service Principle for credentials and allow you to secure your integration with Azure storage for archiving and storing build artifacts, connecting to pipelines, and Azure Repos, all of which can be monitored using the Azure monitoring service.</p>
<p>Finally, you can use Jenkins to deploy your applications to Azure services, such as Azure App Service and Azure Kubernetes.</p>
<p>In the demo for integrating Jenkins with Azure Pipelines, we’ll <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-jenkins-integration-demo/">create a Jenkins server</a> using the Jenkins Solution template to create a VM that has Ubuntu on it and integrate with our build pipeline we created previously in the demo on creating an Azure Pipelines.</p>
<p>Let’s check it out.</p>
<h1 id="Azure-Jenkins-Integration-Demo"><a href="#Azure-Jenkins-Integration-Demo" class="headerlink" title="Azure Jenkins Integration Demo"></a>Azure Jenkins Integration Demo</h1><p>In this demo, I’m going to show you how to create a Linux VM using cloud-init to spin up the virtual machine and install Jenkins. <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/azure-jenkins-integration/">Jenkins</a> is a build automation server that you can integrate with <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> to scale out your build capacity.</p>
<p>So, the first thing we need to do is create a working directory and a new text file. We’ll call the text file cloud init Jenkins, cloud-init-jenkins.txt. And from there, we will copy the cloud-init contents from the Microsoft documentation located at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/developer/jenkins/configure-on-linux-vm">URL</a>.</p>
<p>This is the file that will be used to download and install Jenkins to the Linux virtual machine using the cloud-init process. Let me just quickly create the cloud-init file here and copy the file contents from the URL I mentioned earlier.</p>
<p>Now that the file is ready, the next thing we need to do is make sure that we have the Azure CLI, or command-line interface installed. If you do not have Azure CLI installed, you can find here at this <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows?view=azure-cli-latest">URL</a>. I already have the Azure CLI installed, so I am not going to install it. But if you are working on Windows, then you can simply download and install the MSI package and that works just fine.</p>
<p>You can check to see if you already have the Azure CLI installed by opening a command prompt and typing <code>az --version</code>. This will also tell you if Azure CLI is installed, which version of the Azure CLI it is, and if there is an update available or not.</p>
<p>The first thing that you might need to do if you do not already have a resource group is to create one, I will just quickly show you how to create a resource group for your Jenkins VM. The command is az, for the Azure CLI, group, for the resources group context, now we specify the create command and then we specify a name with the name attribute, and a location with the location attribute. That’s all there is to create a resource group using the Azure CLI.</p>
<p>The next thing we need to do is to create a virtual machine that our Jenkins server will be installed on. Since we’re using the Azure command line interface, all commands start with az, then we are working with a virtual machine context, so we type vm, now we specify the create command, and add the parameters. The first parameter is resource-group, and this tells Azure the name of the resource group we want to add the virtual machine to. The next attribute is name, this is the name you want to give your virtual machine. Then we need to specify the machine image using the image attribute, in our case, we want to use the latest version of Ubuntu, so we’re going to enter UnbuntuLTS. Now we specify the initial admin username and use the generate-ssh-keys attribute to create the public and private encryption keys for our new virtual machine.</p>
<p>Finally, we use the custom-data attribute to specify our cloud-init file that tells the template which software to install on our new machine. If the cloud-init file is not in your current working directory, you need to specify the entire path to the file.</p>
<p>It will take a few minutes to install, once it’s installed, make sure to take note of your public IP address, we’re going to need it later.</p>
<p>Now that our virtual machine is created, we need to allow incoming communications with our Jenkins server on a specific port. So we will use the open port command to update our network security group and add an entry to our inbound port rules.</p>
<p>The command is <code>az vm</code>, our resource group, our virtual machine name, what port we want to open, and what priority we want to use for the inbound port rule. We are going to use 8080 for the port and 1001 for the priority. If you are not sure what to use for the port and priority, check with your network administrator, they should be able to tell you what these values should be.</p>
<p>After we have opened the port to allow communication to our Jenkins server, we now need to remotely connect to our new VM over SSH. Once we have successfully connected, we can check to see if our Jenkins service is running by typing <code>service jenkins status</code> and we should get a message telling us that the service is loaded.</p>
<p>Now that we know the service is running, we need to get the initial password that was created when the service was installed. We can do that by printing it out to the screen using <code>sudo cat</code> command, along with the file path to the initial password file. The file is located at the following path: &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;secrets&#x2F;initialAdminPassword</p>
<p>Once we have our password, it’s time to open our browser and navigate to our Jenkins server. We can find it at the public IP address we got when we created our virtual machine, followed by a colon with the port number we opened in our firewall. If you need to find the public IP address again, you can go to the VM in Azure and it will show you the public IP address on the overview screen for the virtual machine.</p>
<p>This will bring us to a page where we can unlock our Jenkins server by using the password that we printed to the screen previously. I will just paste that here and click Continue. The next page is where we can decide if we want to just install the most common Jenkins plugins or if we want to select additional plugins to add. We need to add the GitHub plugin, so I will click on the select plugins option on the right.</p>
<p>This page shows all the plugins that will be installed, and this is where we can search for additional plugins and select them. I will search for the GitHub plugin, and check the checkbox and click Install.</p>
<p>Now Jenkins will install all the plugins that were selected. And I’ll just speed up the time. So now that that’s done, we need to create our first admin user.</p>
<p>I will just add the relevant information and create the user. Finally, the last thing we need to configure is a friendly URL for our Jenkins server. If you are going to use a DNS entry for your Jenkins server, then this is when you would add the friendly domain address. The root address is needed for almost everything that Jenkins does, so it is good to put the user-friendly address in now so that you can avoid confusion later.</p>
<p>Now our Jenkins server is installed and ready to use. I hope you enjoyed this demo, and I’ll see you in our <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/course-summary/">next module</a>.</p>
<h1 id="Course-Summary"><a href="#Course-Summary" class="headerlink" title="Course Summary"></a>Course Summary</h1><p>In this <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/course-introduction/">course</a>, we’ve talked about managing and implementing your build infrastructure with <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> DevOps. In the section on Azure Pipelines, we talked about pipelines, what they are, what they’re used for and how to use them. We talked about the difference between public and private projects. We talked about jobs and tasks, what they are. And in our pipelines demo, we went through the process of creating a build pipeline for our software development project. We had a look at the initial tasks that were created by default in a .net core project.</p>
<p>In the section on build agents, we talked about the types of build agents available to use, what each of the types of build agents are for. We talked about the restrictions and limitations of the types of build agents. We talked about organizational and project-level build pools, what they are used for, and how they relate to each other and to our pipeline. In our demo, we created both an organizational and a project-level agent pool. We installed two self-hosted agents on a virtual machine in the cloud, and we added them to our organizational pool and had our pipeline use them to build our code project.</p>
<p>In the lecture on concurrent and parallel jobs, we talked about parallel jobs being the new name for concurrent jobs. And that parallel jobs are what are utilized to run a pipeline build job. We talked about what Azure DevOps offers as part of the free tier and the limitations on time and number of parallel jobs run in the free tier.</p>
<p>In the section on service and webhooks, we talked about what a service connection is and what a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-and-managing-azure-build-infrastructure/service-connections-hooks-and-webhooks/">webhook</a> is, and what they’re used for. We talked about the service endpoints, and what they are and they can be used for.</p>
<p>In the section on Jenkins integration, we talked about integrating Jenkins with Azure DevOps and in the demo, we saw how to spin up a virtual machine and install and configure Jenkins server.</p>
<p>There are tons of options for building, configuring, customizing, extending, managing, and implementing our build infrastructure in Azure DevOps. And it will only get better with time. I truly hope that you enjoyed my course, and as always, please feel free to leave feedback and rate this course. I’m always looking for ways to improve my course, and your feedback helps me do just that.</p>
<p>Until next time, happy building.</p>
<h1 id="2Azure-Pipelines"><a href="#2Azure-Pipelines" class="headerlink" title="2Azure Pipelines"></a>2<strong>Azure Pipelines</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/devops/pipelines/get-started/key-pipelines-concepts">Key concepts for new Azure Pipelines users</a></p>
<h1 id="4Azure-Build-Agents"><a href="#4Azure-Build-Agents" class="headerlink" title="4Azure Build Agents"></a>4<strong>Azure Build Agents</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/jenkins/tutorial-jenkins-github-docker-cicd">Microsoft documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows?view=azure-cli-latest">Azure CLI</a></p>
<h1 id="9Azure-Jenkins-Integration-Demo"><a href="#9Azure-Jenkins-Integration-Demo" class="headerlink" title="9Azure Jenkins Integration Demo"></a>9<strong>Azure Jenkins Integration Demo</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-machines/sizes-general#dsv2-series">Standard_DS2_v2 virtual machine image</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops">List of Microsoft-hosted Windows agents</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/container-phases?view=azure-devops&tabs=yaml">Container jobs requirements &amp; limitations</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/developer/jenkins/configure-on-linux-vm">Get Started: Install Jenkins on an Azure Linux VM</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/developer/jenkins/pipeline-with-github-and-docker">Create a Jenkins pipeline using GitHub and Docker</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-400-Implementing-Version-Control-on-Azure-Repos-4/" rel="prev" title="AZ-400-Implementing-Version-Control-on-Azure-Repos-4">
      <i class="fa fa-chevron-left"></i> AZ-400-Implementing-Version-Control-on-Azure-Repos-4
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-400-Azure-Key-Vault-and-Disk-Encryption-6/" rel="next" title="AZ-400-Azure-Key-Vault-and-Disk-Encryption-6">
      AZ-400-Azure-Key-Vault-and-Disk-Encryption-6 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Course-Introduction"><span class="nav-number">1.</span> <span class="nav-text">Course Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Pipelines"><span class="nav-number">2.</span> <span class="nav-text">Azure Pipelines</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Pipelines-Demo"><span class="nav-number">3.</span> <span class="nav-text">Azure Pipelines Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Build-Agents"><span class="nav-number">4.</span> <span class="nav-text">Azure Build Agents</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Build-Agents-and-Pools-Demo"><span class="nav-number">5.</span> <span class="nav-text">Azure Build Agents and Pools Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Parallel-Jobs"><span class="nav-number">6.</span> <span class="nav-text">Parallel Jobs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Service-Connections-Hooks-and-Webhooks"><span class="nav-number">7.</span> <span class="nav-text">Service Connections, Hooks, and Webhooks</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Jenkins-Integration"><span class="nav-number">8.</span> <span class="nav-text">Azure Jenkins Integration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Jenkins-Integration-Demo"><span class="nav-number">9.</span> <span class="nav-text">Azure Jenkins Integration Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Course-Summary"><span class="nav-number">10.</span> <span class="nav-text">Course Summary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2Azure-Pipelines"><span class="nav-number">11.</span> <span class="nav-text">2Azure Pipelines</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4Azure-Build-Agents"><span class="nav-number">12.</span> <span class="nav-text">4Azure Build Agents</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9Azure-Jenkins-Integration-Demo"><span class="nav-number">13.</span> <span class="nav-text">9Azure Jenkins Integration Demo</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
