<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionWelcome to Analyzing Resource Utilization on Azure. My name is Matthew Quickenden, and I’m going to be guiding you through analyzing and diagnosing resource utilization and understanding c">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-104-Analyzing-Resource-Utilization-on-Azure-40">
<meta property="og:url" content="https://example.com/2022/11/18/AZ-104-Analyzing-Resource-Utilization-on-Azure-40/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionWelcome to Analyzing Resource Utilization on Azure. My name is Matthew Quickenden, and I’m going to be guiding you through analyzing and diagnosing resource utilization and understanding c">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T00:22:41.000Z">
<meta property="article:modified_time" content="2022-11-22T15:40:56.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/18/AZ-104-Analyzing-Resource-Utilization-on-Azure-40/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-104-Analyzing-Resource-Utilization-on-Azure-40 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/18/AZ-104-Analyzing-Resource-Utilization-on-Azure-40/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-104-Analyzing-Resource-Utilization-on-Azure-40
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-18 20:22:41" itemprop="dateCreated datePublished" datetime="2022-11-18T20:22:41-04:00">2022-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 11:40:56" itemprop="dateModified" datetime="2022-11-22T11:40:56-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-104/" itemprop="url" rel="index"><span itemprop="name">AZ-104</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/18/AZ-104-Analyzing-Resource-Utilization-on-Azure-40/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/18/AZ-104-Analyzing-Resource-Utilization-on-Azure-40/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Welcome to Analyzing Resource Utilization on Azure. My name is Matthew Quickenden, and I’m going to be guiding you through analyzing and diagnosing resource utilization and understanding consumption. I have over 20 years of industry experience, and I’ve recently been working with cloud and hybrid cloud technologies with a specific focus on Azure and Azure Stack. If you have any questions, feel free to connect with me on LinkedIn, or send an email to <a href="mailto:support@cloudacademy.com">support@cloudacademy.com</a>. This course is intended for people who want to become certified Azure architects or who are simply tasked with managing and supporting resources in Azure.</p>
<p>To get the most out of this course, you should have a general understanding of Microsoft Azure and how to deploy and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/azure-arm-intro/">manage resources</a>. Being familiar with <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/azure-ps-intro/course-intro-17/">PowerShell</a> is very useful but not essential. We are going to explore adding diagnostic logging to resources, collecting that data to different output locations, and creating alerts based on it. In addition, we will look into costs associated with Azure consumption and how to generate reports and track Azure spend. By the end of this course, you should be able to set up diagnostic logging to various sources, create alerts based on these logs, and understand Azure cost consumption. Your feedback on this course is important, so please give it a rating when you’re finished. Let’s get started.</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Azure is based on a consumption and usage model. As administrators, it is important to monitor utilization, and understand where and how the resources we have deployed are being used, and how much they’re costing us. To help facilitate this, we can use tools built into Azure. We are going to explore diagnostic logging, which is captured in a resource level and allows us to view detailed logs. Metric counters help us look at performance and cost in relation to metrics. Azure Advisor is built into Azure at many layers and leverages Azure’s power to analyze your usage, and provide recommendations to help reduce excessive spend.</p>
<p>We could set up alerts on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/diagnostic-logging/">logs</a> or metrics to trigger a variety of actions via action groups. Log Analytics can be leveraged to perform custom queries on log data. Azure Cost Management provides a view into resource cost allocation.</p>
<h1 id="Diagnostic-Logging"><a href="#Diagnostic-Logging" class="headerlink" title="Diagnostic Logging"></a>Diagnostic Logging</h1><p>Azure provides different logging options around resources. We are going to be taking a look at diagnostic options available to tenants. The Azure monitor helps facilitate logging and collection of these logs. There are three types of logs we need to be aware of: activity logs, diagnostic logs, and application logs, or guest OS logs. Let’s take a look at where these logs exist within an <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> subscription in relation to the resources they are monitoring. Here we have a Non-Compute Resource, which is tightly integrated and delivered through Azure providers, for example a network security group. Next to this, we have a Compute Resource.</p>
<p>This is a virtual machine with a guest OS, like Windows or Linux, and it has an application installed like IIS or Apache. Activity logs provide a record of operations from a subscription level, executed against the resource. For example, when administrative tasks are performed on the resource, like creating a resource or updating the properties of an existing resource, this will generate an event in the activity log. Diagnostic logs are collected within a subscription at an Azure resource level for services like VPN gateways or network security groups. Not all Azure services have an option for diagnostic logging, and the level of detail you can capture varies. You can view a full list of resources that support diagnostic logging from the Microsoft Azure website. Application logs are logs generated by applications or services within a guest OS. These logs are collected from within the operating system through an agent. Application logs can be collected from core services, like Windows Event logs, or from applications like IIS. Diagnostic logging can be enabled in a couple of ways: using the Azure portal, PowerShell, Azure CLI or the REST API via Azure Resource Manager. </p>
<p>When enabling diagnostic logging, you can choose where you want to export your logs to. You can export them to Log Analytics, to an event hub, or directly to a storage account. The Azure Portal allows us to easily browse through resources to enable diagnostic logging. Select the resource in question under the heading Monitoring and you should see a heading Diagnostic Settings. This will open a blade that contains diagnostic logging options for the type of resource you’re currently looking at. If it’s not already enabled, you’ll see an option to turn on diagnostics, to enable diagnostic collection. This will give you a choice of export <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/creating-locations-for-diagnostic-logging/">locations</a> we looked at earlier and the options related to them. For instance, when you select storage account, you get a choice of which storage account and retention settings. You will also notice different log events to capture, specific to the resource you’re working on. One of the first steps to take if you’re experiencing an issue is to select the resource and go to the Diagnose and Solve Problems blade. </p>
<p>This shows any general issues related to this resource’s health. With regards to virtual machines on the diagnostic settings blade, you have an option to enable guest-level monitoring. Once enabled, you’ll have more capability to collect logs from within the system without having to set up anything inside the system yourself. We will investigate more about these options in the demonstration. Log Analytics, formally known as Operations Management Suite, or OMS, is a log search analytics tool. It allows you to collect logs from different sources and correlate the data. You can write queries and create charts and graphs to help gain operational insight into your environment. You can create alerts based on metric thresholds or activity log events and consume pre-built management solutions, which includes queries and graphs. We can also send our diagnostic data to an event hub, which is a big data streaming platform. It can receive, process and transform thousands of events per second. Data can be stored or displayed as needed. Anomaly detection, live dashboards and application logging are among some of the ways we can utilize event hubs. Finally, we can send logs in their raw format to a storage account. It is important to understand the naming convention used to store it. Logs can be broken down by a subscription, resource group, provider and, finally, date and time with a JSON file called PT1H.json. An example of the file structure in the blob would look like this. The PT1H.json file contains an array of records, which we can see in the image shown. </p>
<p>To help collate different logs together to determine the correlation between events, it is important to have a common structure to the logs. Azure diagnostic logs have that. This is a top-level diagnostic schema that includes several required fields and some optional fields. Required fields include time, resource ID, tenant, and operation name. Some optional fields are duration, correlation ID, and location. Each type of service will have its own specific data fields that relate to it. For instance, auditing within Azure Active Directory includes AuditEventCategory, IdentityType, OperationType, TargetResourceType, TargetResourceName, and AdditionalTargets. Or in the case of Azure Automation accounts, the additional schema fields include RunbookName, ResultType, and ResultDescription. On a virtual machine, you can enable boot diagnostics. </p>
<p>Once you specify a storage account, you can then see the screen and view the serial log that is an output from the virtual machine. This is particularly useful for Linux machines, as they often have an output log to the console screen. You can see and download a screenshot of the current state the virtual machine is in from the screenshot tab. This is also accessible through PowerShell for automation. Using Resource Manager templates, you can automatically enable Diagnostic Settings at the time of resource creation. Using templates helps ensure consistency in how settings are configured. You may decide you always want to export diagnostic logs to specific services, like event hub or a central Log Analytics instance. Using templates can help allow for standards to be applied to resources at the time of deployment without user intervention. The resource type that supports this is providers&#x2F;diagnosticSettings. Here is an example of a diagnostic resource. If we look closely we can see the storage account ID, event hub authorization rule, event hub name, or workspace ID. Now we also have settings regarding logs and the retention period and particular metrics you want to capture and retention.</p>
<h1 id="Creating-Locations-for-Diagnostic-Logging"><a href="#Creating-Locations-for-Diagnostic-Logging" class="headerlink" title="Creating Locations for Diagnostic Logging"></a>Creating Locations for Diagnostic Logging</h1><p>For this exercise we are going to set up <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/diagnostic-logging/">diagnostic logging</a> on a network security group, exploring all three export options and the different methods to configure them. This is a prerequisites video so we are going to go through what we need to have in place and set up the destinations. Here I have a resource group called Jenkins and I’ve used an Azure Marketplace template to deploy a Jenkins instance. So we have a Linux virtual machine and a Windows 2016 server. This has deployed both a jenkins-nsg and a windemo-nsg. From here we are going to create the objects in another resource group called the AzureDiagnostic. </p>
<p>So I’ve created it already. And we’re going to add the resources we need here to do our diagnostic logging. So first things first, let’s go and create the OMS or Log Analytics workspace. Log Analytics, and we’ll click create. Not a lot of parameters here. I’ll pause the video and come back in a second. So we’ve given it a name and selected the appropriate subscription. We’ve selected the existing resource group we’ve created and the location, pricing tier free. With the OMS deployment, you cannot navigate away until this window’s finished validating. So this needs to finish its process before you can do the next thing. So we can see that validation succeeded and the deployment was successful. So if we go back to the resource group we can now see the AzureDiagnostics OMS instance. Next, we will create the event hub. So we’ve given it a name, selected a pricing tier, basic. Got the subscription and resource group and a location. We’ll click create. </p>
<p>Now this job is submitted to Azure resource manager and we can continue to do the next thing. So the last thing we need is a storage account. And create. So we’ve chosen the resource group, we’ve given the storage account a name, that’s lowercase. The account kind we need to make general purpose V1. The other options don’t matter at this stage. So we’re just going to do review and create. And create. Your deployment is underway and we can go look at the resource group. We can see that our Event Hub Namespace is there. OMS workspace is here and if we just give it a moment we can see the deploying storage account and we’ll look for that success. And here we can see the success of that account. And now we have our three prerequisites for logging: event hub, storage account, and an OMS workspace.</p>
<h1 id="Enabling-Diagnostic-Logs-Using-the-Azure-Portal"><a href="#Enabling-Diagnostic-Logs-Using-the-Azure-Portal" class="headerlink" title="Enabling Diagnostic Logs Using the Azure Portal"></a>Enabling Diagnostic Logs Using the Azure Portal</h1><p>So, in this resource group, we have our prerequisite <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/creating-locations-for-diagnostic-logging/">destinations for the Diagnostic Logs</a>. We will now return to the Jenkins resource group, and take a look at the Jenkins-NSG. This is attached to the Linux machines. If we go down here to Diagnostic Settings, we get an option to turn on to collect data. So we’re going to set up one setting per output. In this case, we’ll call this Linux NSG DiagStorage Account. So archive to a storage account. Now, we would like to configure the storage account to be AZUREDIAGDEMO. Select okay and then we want to pick these two logs and their retention setting. So this setting applies to the storage account in terms of the retention. </p>
<p>If we click save for that, and we return back a screen and refresh, we can now see we have this particular setting and the setting there for storage account, with event hub and Log Analytics not selected. So next we can add the event hub. That’s optional, and we’ll pick the default policy. Give it a name. And now we can see that one and we’ll create one more for Log Analytics, which is the easiest. Just pick the workspace, and that’s it. Give it a name: LogOMSDiag. So now we have three different policies set up for diagnostic logging for the NSG. So, the next thing we can do is if we go to the monitor, so you can find this in under services and monitor, and diagnostic settings. So, here we can see these are the different objects within that resource group that we can connect diagnostic settings to diagnostic logging, and in this case, we have it connected to one of the NSGs. </p>
<p>So if we’ve also wanted to connect the Windows NSG, click on it from there. So we got to that from monitor. Turn on diagnostic settings, and we’ll call this AllInOne. We can create one for diagnostic demo. Stream on events hubs, okay. Configure the event hub again…and Log Analytics. There we go, so now we can see we’ve enabled diagnostic logging for both NSGs. So what we saw in the NSGs were two different log options. So if we go back and look at what the different settings were within here, there’s a network security event and network security group rule counter. So, if we look at the other options we have for a different type of resource - so let’s choose the Public IP addresses that are attached to these systems. If we go in here and turn on diagnostic settings, we have a different set of logs and we also have metrics. So this wasn’t shown in the last one. The metric counters are numeric n-digit numbers that allow us to track and graph things rather than event-based. So, let’s turn on one of these so we can get some other information. Just configure all of them.</p>
<p> And if we return to the monitor, logging settings have been set up for three resources now. These are address specific resource types. So, if you want to enable guest logging for the machines this is the difference of a resource based monitoring and what we’re about to do now is guest logs. So, we’ll return to the resource group Jenkins. Type in here so we can easily find it. Then we go to the Linux Virtual Machine to start with and we scroll down to diagnostic settings. Enable guest level monitoring. So, we can now see this is a Linux Machine and we’re getting different logs which are Linux specific. And if we look at the metrics, we have processor, memory, network, file system, and disk. You can also choose to do custom. So there are additional, more specific counters, if you want to enable those. In this case, we’ll just leave it with the basic.</p>
<p> And additional SYSLOG levels so you can go to higher levels so you get less information. And then there are additional settings here for the storage account that you have chosen to log that information to. So, let’s connect the Windows server where we can go look at the information that we’re collecting. So here’s the Windows machine and diagnostic settings. Choose enable guest level monitoring. This takes a while so we’ll just pause the video and return once it’s complete. And here we can see the job completed. So, we can also go and look at custom and basic performance counters and add additional Windows counters to that list. There are additional logs so you can directly click IIS logs, if you have that installed, in different levels as well. It does understand .NET applications. One thing worth noting is if you’re having trouble with the log collection you may need to remove and reinstall the agent. So, you can do that from this screen here.</p>
<h1 id="Enabling-Diagnostic-Logs-Using-PowerShell"><a href="#Enabling-Diagnostic-Logs-Using-PowerShell" class="headerlink" title="Enabling Diagnostic Logs Using PowerShell"></a>Enabling Diagnostic Logs Using PowerShell</h1><p>So we have a brief demo here of using PowerShell to view the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/enabling-diagnostic-logs-using-azure-portal/">diagnostic settings</a> that we’ve added to the Jenkins-nsg. So we’ve got the login-AzureRm PowerShell commandlet here, which I’ve already run and logged in with my credentials. We’ve got four parameters here we’re going to set which include the target resource group name, target nsg, diagnostic resource group, and diagnostic Log Analytics instance. So we’re going to assign the nsg into this variable with the Get-AzureRmNetworkSecurityGroup and the appropriate values, run that command, and we check that value. We can see we’ve got the Jenkins-nsg. If we run this command, the Get-AzureRmOperationalInsightsWorkspace with the appropriate settings, we will see we’ve got the Log Analytics instance. So to check that we’ve got the right settings already on there, we created the AllInOne setting. So if we do the Get-AzueRmDiagnosticSettings, we can see, there it is, AllInOne, and each of the different locations for storing diagnostic data. So we’ve got the workspace, the event hub, and we’re using metrics, logs, and seven days retention. So going into the storage account, it’s also in here: StorageAccountId.</p>
<p>So this is basically the outline of what we’ve already created in the portal. You should be able to use this command, but at the moment the commandlets are broken, so this is a known issue. At the time of this video, there isn’t a workaround. You need to do it in the portal, so that’s a bit unfortunate, however you should be sending in values very similar to this. So we’re going to have a quick look at the CLI commands. So here, this is sort of what the CLI version would look like. So az, then run your login. You’ve got the diagnostic-settings create, and then again just fill out the properties for each of these different items. And in the last section of this code, how we can generate these things with code, is if you’re using Azure resource group templates, the resource here, under resources, you have diagnostic settings. So the type is provider&#x2F;diagnosticSettings and then you’d create your setting name, what resource you’re going to depend on, api version will change over time, and here we have the properties for each of the different items: eventHubAuthorizationRuleId, event hub, workspace or storage account id, and the logs or metrics you want to record. These are going to be different for different types of resources and the same thing for the log categories. So you’re going to have to tailor these for your specific purposes. That was a brief overview of how to set diagnostic settings using code.</p>
<h1 id="Viewing-and-Accessing-Diagnostic-Data"><a href="#Viewing-and-Accessing-Diagnostic-Data" class="headerlink" title="Viewing and Accessing Diagnostic Data"></a>Viewing and Accessing Diagnostic Data</h1><p>So what we’re going to focus on in this session is looking at the diagnostic data that we’ve sent to the storage account and to Log Analytics. We’re going to have a look and interrogate the data and see what’s there and run a query against it. So first thing, we’ll look at the storage account because that’s an easy step. We’ll use the Storage Explorer built into <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> now. We could also use the Storage Explorer as a simple application. We’ll expand the subscription and the storage blob where we put that data, and if we have a look here under blob containers, we can see we’ve got insight logs for the network security group event and network security group event rule counter. If we drill into one of these logs, these containers, we can see we’ve got resource ID, subscriptions, and we’ll just go down through this chain, resource groups, and Jenkins. </p>
<p>So, each one of these providers you have that goes to the storage account will have a separate folder. Then if we go up to windows, we’ve got a date, time, day, hour, minute, and at the end of that, we have a PT1H.JSON file. If we download that file we can see inside the file is a lot of information about the logging that we’ve collected. So, if we scroll across we can see we’ve got deny, direction, priority. There’s a lot of information regarding the resource type that we’ve recorded. It’s very specific information to a network security group. So these logs exist one file per folder and you’ll see the breadcrumb trail to that log here. If we go back to the tables under storage account, we can see there’s also Windows diagnostic information. So this is from the event table. Under Windows metrics, we can see we’ve got…counters. So, here’s the disk times, CPU times, mirror accounts, page faults. It’s all those standard windows counters but they’re stored in this table that we can query with many different tools. So, that’s showing us what we’ve got in the storage account. </p>
<p>Next, we’re going to go to the Log Analytics instance. Go over here and log in. So if we go to the Azure Diagnostics Log Analytics instance, Workspace Summary and click add, we’re going to jumpstart our query language here with some pre-canned Microsoft queries around network security groups. So if I scroll down we can find the Azure Network Security Group Analytics. So this gives you a preview of what there is and we’ll click create. So, that’s been created. If we go to the resource, we can see the chart here is actually displaying the data that we’ve already been collecting. Click on that summary chart and we’ll drill into the solution itself and we can see some additional queries. So what we’re really interested in here is the data that’s backing these queries. This is all the stuff that we’ve set up from the security groups and merged and we’re learning how to query it ourselves. So this is diagnostic information that we want to enrich and display through graphs, charts or PowerBI and how we need to display that information. In this case, we’ll drill into one of these existing queries and what we can see is basically the query version. There’s some information here on the side with other information you could filter by. And if we look at the options here we can export to CSV files or go to PowerBI. In our case, we really want to understand how to write our own queries because that’s where we’re going to be able to get specifically what we’re interested in seeing. So, from here we can go to the advanced analytics, and on the left, we can see the Azure Diagnostics OMS workspace and then Log Management. So, in this case, we’re just going to delete this query and start again. So if we double-click on the left, on the table, and click run (we’ll start very simple), we can see we’ve been given 10,000 items (that’s been limited). </p>
<p>If we expand this we can see more information around that specific query. So there are all the different fields in the row. If we click the direction, we ought to find the blocked traffic. Down here, you can click on this and that’ll actually put in the filter for you: where TYPE_S is equal to ALLOW. When we run this query, we can see we now have 4,564 records. We also want to summarize this now. This query window has intellisense built in. If you’ve languages like SQL, TSQL, or <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/enabling-diagnostic-logs-using-powershell/">PowerShell</a>, there are a lot of similarities. Although, this language is different. The intellisense will help us summarize and understand what we need to do. So here we can see if we click summarize, there’s some information. It explains to us how we need to do it so we can do “count by” and then the field we want. In our case, we want to summarize and count records by direction. And we can see we’ve had as many packets going in as going out. The next thing we’re really interested in doing is seeing this in time boxes. What we’re going to use is a bin. Bins allow us to aggregate this data into different categories of time. So, if we do bin, I’ll need Time Generated, and we’ll do one-hour buckets, so we just type in 1HR there. And if we run that query, we can now see the total traffic going in and out over time, and if we click chart, we can see each packet coming in and out and we’ve split that data. So, once we’ve got our specific queries we can <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/alerting/">create alert rules</a>, again for diagnostic information you’re trying to find. You can generate charts to put back on the dashboard yourself. There are a lot of other things you can do once you have this query from the diagnostic data. So, that’s a brief overview of how to view the data in the storage account and how to write queries against that data.</p>
<h1 id="Alerting"><a href="#Alerting" class="headerlink" title="Alerting"></a>Alerting</h1><p>In this section, we’re going to look at the Azure Monitor. The Azure Monitor is the central component built into the Azure fabric. The Monitor provides infrastructure-level monitoring and logging for supported services and is central to all monitoring toolsets in Azure. When you’re creating an alert, you have to understand what type of signal you’re going to monitor. There are two types: Metric Alerts and Log Alerts. You can collect Metric Alerts like CPU memory, disk usage, and network usage. In addition, there are metrics specific to Azure resources like “under DDoS Attack or not”. </p>
<p>There are also activity log alerts which look for events like create or update network security groups. So you can monitor administrative changes to your infrastructure. An alert consists of three parts: the Target which is the specific Azure resource that is being monitored, the Criteria, which is the conditional logic that will trigger the Action, and finally the Action, which is the call sent to an Action Group. An action group is a reusable collection of notifications defined by the user. These notifications can be a wide variety of actions such as voice call, SMS, email, call to a webhook, or trigger an automation runbook. In addition, you can push data into other resource tools like creating an ITSM ticket or a logic app. Alerts can be set up to trigger a specific action group, and action groups can be reused by different alerts. For this email alert, the receiver will get a confirmation email letting them know that they are in the alert action group.</p>
<h1 id="Analyzing-and-Creating-Alerts"><a href="#Analyzing-and-Creating-Alerts" class="headerlink" title="Analyzing and Creating Alerts"></a>Analyzing and Creating Alerts</h1><p>For this next example, let’s use a WordPress website running as a PaaS service to create an alert looking for page 404 HTTP responses and send ourselves an email. So, the first thing you want to do is go to the Monitor in Azure and select <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/alerting/">Alerts</a>. Again, this is a central place to record all the alerts. We can see here we’ve got a total of alert rules (14), and 8 are enabled. You’ll also notice here that there are different severities, so when you create your alert, you can choose your severity. This helps you collect all your infrastructure into a single place and gives you an idea of what’s critical and what’s not. So, we’re going to create a new rule, and here are the conditions we mentioned earlier: an alert condition, which is a target, and criteria. There’s the alert action, where you define the rules, severity, and the action group. So, the first thing we do is select a target, and select App Services, and we can see Azurefieldnotes. We’ll select that. We can now see what’s our target, and we want to add the criteria. So what we do notice here is there are 168 different signals we can alert on.</p>
<p>So as we said, there are some metrics, these come from the platform itself, and there are also activity logs. Within the activity logs, there are different categories. So here’s Administrative, Security, Recommendations, and Policy. In our case, we want to alert on Http 404. When we select the metric signal, we get a sample graph of data collected over the last 6 hours. We also see, in this case, there happen to be multiple instances because, in the App Services plan, there are three instances that run this website. So we want to select all of them, and what this allows us to see is a sum of the time of each of these. So before, when we had the aggregation, we can see that above 40 is where we want alerts.</p>
<p>So we want to ignore these bumps and just alert when we have this kind of spike. So, we’ll make it 50. We’re not going to select a specific instance, and we’re just going to say when greater than a total aggregation of 50, and select Done. Now we’re going to put in an alert name for our rule. We’ll call it Page404 Greater than 50. And we’ll set it to severity 3. Enable the rule upon creation. And now we need to create an action group. We’re going to do a new action group. We’re going to call this WebAlerts and also have a short name of WebAlerts. We need to choose a resource group to put this in. We have a default resource group here that’s already set up. Then we choose email, and we’re going to send an email to Matt. Select OK…and OK.</p>
<p>So we need to wait for that action group to get created. It’s done, so it added that for us. If we already had an action group we wanted to use, we could say “Select action group” and see our existing action groups that we’ve already created. In this case, we’re using a new one. Click “Create rule”. As we wait for that rule to be created, we should get an email that tells us we’ve been added to the action monitor group. This allows us to know that we can receive the email and that the alert is set up. If we go back to Manage alerts, we can see our “Page404 Greater than 50” response. Here’s the Target Resource, Target Resource Type, and the Signal. So that’s our alert. If we look in here, we can go and modify the conditions if we need to. Here we can see the bar where it’s going to get triggered. And that’s it for creating an alert.</p>
<h1 id="Azure-Advisor"><a href="#Azure-Advisor" class="headerlink" title="Azure Advisor"></a>Azure Advisor</h1><p>Azure has some built-in algorithms to help identify cost savings. These can vary depending on how you use the system, but it’s worth taking some time to review the suggestions and recommendations. One of the most common recommendations, if you have long-running virtual machine instances, is to purchase reserved instances. If we take a look at the screenshot, the Azure Advisor shows nine VMs it has determined to be around long enough to suggest that if we had reserved instance, and made a commitment to these resources, we could potentially save $2,700 US per year. Advisor recommendations are based on the last 14 days of usage and target low utilization systems.</p>
<p>Recommendations could include:</p>
<ul>
<li>Eliminating unprovisioned ExpressRoute circuits. It identifies ExpressRoute circuits that have been in the status of Not Provisioned for more than a month.</li>
<li>Deleting or reconfiguring idle virtual network gateways (virtual network gateways that have been idle for over 90 days). Since these gateways are built hourly, you should consider reconfiguring them or deleting them if you don’t tend to use them anymore.</li>
<li>Based on usage, recommending a more appropriate VM size. Virtual machines whose CPU utilization is 5% or less, and the network usage is 7 meg or less for four days or more, are considered low utilization virtual machines.</li>
</ul>
<h1 id="Resource-Baseline"><a href="#Resource-Baseline" class="headerlink" title="Resource Baseline"></a>Resource Baseline</h1><p>A baseline is helpful to ensure that your systems operate as expected. It’s good to be able to track what has changed since the resources were first deployed. Azure Resource Manager, or ARM, allows us to use JSON files called ARM templates to define resources in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a>. This template uses what’s described as declarative syntax rather than scripts. That allows us to repeatedly deploy resources with great consistency and allows us to determine if the resources have changed from their original state. Declarative syntax means you define what the resources look like, and their dependencies between the resources, and the Azure Resource Manager takes care of the actual deployment. With a template, you can use Desired State Configuration packages (or DSC). These packages are the same within the operating system. </p>
<p>You can define a declarative configuration, and the provider takes care of ensuring the operating system looks like what you have defined. This style of configuration is often referred to as infrastructure as code. A benefit of using this method is that the configuration code can be submitted to a version control system to ensure that the changes are tracked and approved. This is in contrast to using scripts that execute command line operations in batches. Another approach can be to use change tracking. Change tracking is a solution that can be added to Azure resources and works by using Log Analytics and Azure Automation. You can enable this on a virtual machine. Once this feature is enabled, activity logs are collected in Log Analytics and analyzed and a dashboard is created to help identify events and changes to the operating system. The screenshot here shows Windows services and software have changed on this operating system.</p>
<h1 id="Monitoring-Cost-Consumption"><a href="#Monitoring-Cost-Consumption" class="headerlink" title="Monitoring Cost Consumption"></a>Monitoring Cost Consumption</h1><p>Understanding costs is very important when operating in the cloud at any scale. Over time, it can become a difficult task to understand exactly which groups or systems are costing you a lot of money. We will cover some tools and methods that will hopefully help keep your costs under control.</p>
<p>One of the first steps is to utilize Resource Tagging. Tagging exists on every resource in <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> whether the resource is free or charged by usage. This tagging structure is completely up to you and your organization. It is department based, cost center based, or you could just put the person’s name on the resource. Here we can see we have added three tags to a resource group: Solution, Owner, and Environment. You can also include resource tags within your JSON ARM templates or through PowerShell.</p>
<p>Here’s how to view costs by resource tag. In the Azure portal, go to the ‘Cost Management and Billing’ section. In the Cost Management section, go to Cost Analysis, then select ‘Group by’ and select ‘Tag’ from the bottom of the drop-down menu. In this screenshot, we can clearly see that tagging has only been partially successful, with the largest cost under ‘Subscription’ coming from untagged resources.</p>
<h1 id="Resource-Tagging"><a href="#Resource-Tagging" class="headerlink" title="Resource Tagging"></a>Resource Tagging</h1><p>It is worth noting that you can enforce tagging through <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> policies, meaning no matter how a user or administrator tries to deploy a resource, if they don’t have appropriate tags defined, the deployment will fail. Alternatively, you can use auditing, which will allow the deployment to continue but will issue a warning. These resources will be marked as non-compliant in the Azure policy service. Let’s take a look at creating a policy to audit and enforce tags. We’re going to leverage some Azure policy samples for resource groups located here at this GitHub project. We will use PowerShell to deploy these definitions. Note that you will require subscription owner rights to execute the following commands. Here we have the “deploy audit resource tag policy” PowerShell command. We are using the New-AzureRmPolicyDefinition commandlet and referencing the GitHub project (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure</a>). </p>
<p>We’ve also filled out the description and the different parameters required to execute this command. This command here will show us how to deploy the “enforce resource tag” policy PowerShell command. In the Azure portal, under policy services and definitions, if we search for the keyword “Tag”, we’ll get these results. We can see the four built-in policies and the two custom policies we just created from the JSON template using PowerShell. If you select the assignment from the left side of the navigation bar, you’ll be able to create an assignment using this policy. Here is a screen showing the fields required to create an audit policy for the resource tag Owner. We are going to create an assignment of an audit policy for the resource tag Owner. We can see here the policy definition is what we created through PowerShell and an assignment name and description with the final text box being tag name having the resource tag you want to audit. Once the policy has been evaluated, we can see the compliant and non-compliant numbers of resources. You can also assign enforce policies to ensure that during deployment tags are assigned. If they are not, the deployment will fail. If you would like to learn more about creating policy definitions, here is a reference link (<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure</a>).</p>
<h1 id="Azure-Cost-Management"><a href="#Azure-Cost-Management" class="headerlink" title="Azure Cost Management"></a>Azure Cost Management</h1><p>Azure Cost Management. Microsoft had previously purchased and integrated Cloudyn as a separate cost management solution that was accessible through the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal. This functionality has now been fully integrated into the portal. The Azure portal now provides native tooling with Azure Cost Management. You can apply budgets to create alerts, to monitor spend, and you’re able to take proactive action before the end of a billing cycle.</p>
<p>We’re going to be looking at generating some reports for use to monitor cloud spend. There are a series of built views for accumulated cost, cost by resource, daily costs, cost by service, and invoice details. There is also the ability to slice and group data so you can track down where your Azure spend is. We will look at <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/cloudyn/">Azure Cost Management</a> in the next demo.</p>
<h1 id="Azure-Cost-Management-Demo"><a href="#Azure-Cost-Management-Demo" class="headerlink" title="Azure Cost Management Demo"></a>Azure Cost Management Demo</h1><p>Let’s start the demo. For this demo, I’d like you to note that I’m using not the portal.azure.com. I’m actually gonna be using the preview portal as this will likely be in production in the near future. So that is a slight difference between what you may see.</p>
<p>Here, we have the cost analysis. So we can get to here from the dashboard, and we go down to <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/analyzing-resource-utilization-azure/cost-management-report/">Cost Management</a> and Billing. Got a couple of subscriptions here. We’ll go onto the one that’s got some charges in it, and we can see cost by resource. So let’s jump into cost analysis, and we can see the charts have loaded. So we have the ability to choose different reports, different ways we view costs. There’s accumulated cost or amortized cost.</p>
<p>So the first thing here is amortized cost is used over a period of time. So if you have Windows licenses or one-off purchases, you can have that spread over a longer month or the one-off charge. We could also see it in US dollars if that’s helpful. We also have the ability to choose different views. So these are the accumulated costs.</p>
<p>So we could also look at the cost by resource, and we can see the individual resources and the meters that they’re spending. So here it’s a premium SSD, and that’s the meter, and it’s cost that much. And that’s over this time period. So we can also change that to be last month, last seven days, there’s a bunch of predefined ranges here, and you can also choose your own custom dates. So if we do this quarter, still very low charges here.</p>
<p>If I can also choose now the cost by service, we can see we’ve got it by months, and we have these charts here that we can help drill down into. So, for location or resource group, you can choose to group the data differently. So we could say, let’s group by resource rather than by resource group. Hence, now we have a different summary down here.</p>
<p>So we can see our most expensive resource group here is $74. And you can also click on these charts to filter down the graphs. So, when we look at this over the month, we’ll see, now there’s where our charges come, and this is basically one resource is taking up all our charge. There’s also the ability to choose the granularity. So the granularity, again, could be daily. How detailed do you want the data? Microsoft will summarize some of this data after a period of time, but the reporting still has an aggregate, which allows you to report on it.</p>
<p>So we can see here, these are obviously the end of the month where it rolls over, but we’ve now gone to daily granularity. And this is an interesting one. We can see it over time. So we can see this one stopped running and maintained its cost, this one’s run the same over the whole time, and here was a new charge that started, and it’s been running consistently since. Again, if we click on that one result, we can drill into it. So we can see this is a disc, it’s in US West, and it’s storage. We can also choose to save these views, and you can also make them private, so it’s useful for enterprise management. You can share these views with people.</p>
<p>The other option here under Settings is we can set up an export. The first thing we’re gonna need to do is actually register the resource provider for that. So I’ve got another page here, which has my subscription, and if I go into the subscription, we can see the resource providers down here, and we can see cost, management, exports. In this case, it’s already registered.</p>
<p>So if I go back to the schedule export, choose a name, sample, we’re gonna choose weekly cost for the last seven days, and the storage account’s gonna be me, cost, export. Next and Create. And that says there, your first export will be available in four hours. So there’s the export sample data. Run now. Successfully queued. So we can create different jobs to export data. We’ve also seen the different ways we can drill down into it. We’ve looked at granularity. You can also choose different visualizations to help you understand how your data is being displayed. I can also view it on a table, which you can download and export. So here, we can see download to Excel, CSV. If we download to Excel, we can see that cost file’s come down now, and our export data isn’t too different, and here’s our data.</p>
<p>So we can see the charges, the billing period, and if we chose by resource, we’d also have that sort of data inside this table. We also have the ability under the Settings tab to connect AWS. So if we click on that, we can add a connector. This will add AWS properties, and allow you to review those costs inside the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/azure/">Azure</a> portal as well. Gonna go back to the cost management, and into here again, and look at budgets as the final thing.</p>
<p>So the final thing we’re gonna do is create a budget. If we click Add, we get the choice to change the scope to a different subscription. We’re gonna add ourselves $100 budget. We can choose the expiration and start of this budget. We can see there’s a suggested amount here. Now, you have to wait for the cost data to appear, and we can see where this budget is. So previously we were spending over 120, this month was 180, and it’s dropped over since then. So I don’t wanna spend that again. Just wanna make sure that we don’t catch that cost.</p>
<p>So if we go Next, we should see the percent of budget. So I wanna know when I’m at 80%, and that’s $80, and I wanna send an email to an action group, so I’ve already created this earlier, but you can manage that through this link. And then, I also wanna know when I’m at 100% of that budget. You could send an SMS or trigger an action, different action as well. It’s saying to also make sure you add this to your spam email, just in case you miss the emails. We’re gonna click Create, and that’s our budget. Budget 100 successfully created. And we can see if we’ve got a progress through that budget at the time.</p>
<p>This brings us to the end of the demo. I hope you found this useful.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>This session covered a wide range of topics and was focused on understanding diagnostic logging and what the differences are between activity logs, resource logs, and guest OS logging. We looked at various ways to enable diagnostic logging, including through the portal, PowerShell, CLI, and through Resource Group templates. We looked at where we could send the information: into a storage account, blobs for files and tables for metrics, event hubs for streaming information, and into Log Analytics where we could run queries against the data and enable a range of out-of-the-box solutions. We also looked into creating alerts and sending them to an action group and exploring ways we could baseline deployed resources using armed templates, DSC, and change tracking. </p>
<p>In the final section, we covered material around tracking costs, including applying and enforcing resource tags, creating and running reports, and scheduling reports to be sent via email or saved to a storage account. I hope you’ve enjoyed this course and you found it useful.</p>
<h1 id="13Resource-Tagging"><a href="#13Resource-Tagging" class="headerlink" title="13Resource Tagging"></a>13<strong>Resource Tagging</strong></h1><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-nz/azure/governance/policy/concepts/definition-structure">Creating Policy Definitions</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-104-Manage-Access-to-Azure-With-Role-Based-Access-Control-39/" rel="prev" title="AZ-104-Manage-Access-to-Azure-With-Role-Based-Access-Control-39">
      <i class="fa fa-chevron-left"></i> AZ-104-Manage-Access-to-Azure-With-Role-Based-Access-Control-39
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/18/AZ-104-Monitoring-Resources-with-Azure-Monitor-41/" rel="next" title="AZ-104-Monitoring-Resources-with-Azure-Monitor-41">
      AZ-104-Monitoring-Resources-with-Azure-Monitor-41 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview"><span class="nav-number">2.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Diagnostic-Logging"><span class="nav-number">3.</span> <span class="nav-text">Diagnostic Logging</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Creating-Locations-for-Diagnostic-Logging"><span class="nav-number">4.</span> <span class="nav-text">Creating Locations for Diagnostic Logging</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enabling-Diagnostic-Logs-Using-the-Azure-Portal"><span class="nav-number">5.</span> <span class="nav-text">Enabling Diagnostic Logs Using the Azure Portal</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enabling-Diagnostic-Logs-Using-PowerShell"><span class="nav-number">6.</span> <span class="nav-text">Enabling Diagnostic Logs Using PowerShell</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Viewing-and-Accessing-Diagnostic-Data"><span class="nav-number">7.</span> <span class="nav-text">Viewing and Accessing Diagnostic Data</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Alerting"><span class="nav-number">8.</span> <span class="nav-text">Alerting</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Analyzing-and-Creating-Alerts"><span class="nav-number">9.</span> <span class="nav-text">Analyzing and Creating Alerts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Advisor"><span class="nav-number">10.</span> <span class="nav-text">Azure Advisor</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Resource-Baseline"><span class="nav-number">11.</span> <span class="nav-text">Resource Baseline</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Monitoring-Cost-Consumption"><span class="nav-number">12.</span> <span class="nav-text">Monitoring Cost Consumption</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Resource-Tagging"><span class="nav-number">13.</span> <span class="nav-text">Resource Tagging</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Cost-Management"><span class="nav-number">14.</span> <span class="nav-text">Azure Cost Management</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-Cost-Management-Demo"><span class="nav-number">15.</span> <span class="nav-text">Azure Cost Management Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">16.</span> <span class="nav-text">Summary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#13Resource-Tagging"><span class="nav-number">17.</span> <span class="nav-text">13Resource Tagging</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
