<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ansible command与shell模块两个模块都是用于执行linux命令的,这对于命令熟悉的工程师来说，用起来非常high。 shell模块与command模块差不多（command模块不能执行一些类似$HOME,&gt;,&lt;,|等符号，但shell可以) https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;modules&#x2F;command_module.h">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansible自动化运维平台">
<meta property="og:url" content="https://example.com/2022/11/12/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="ansible command与shell模块两个模块都是用于执行linux命令的,这对于命令熟悉的工程师来说，用起来非常high。 shell模块与command模块差不多（command模块不能执行一些类似$HOME,&gt;,&lt;,|等符号，但shell可以) https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;modules&#x2F;command_module.h">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601969382005.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601969569380.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601965978453.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601966026674.png">
<meta property="og:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601966060853.png">
<meta property="article:published_time" content="2022-11-13T02:54:35.000Z">
<meta property="article:modified_time" content="2022-11-28T14:17:34.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601969382005.png">

<link rel="canonical" href="https://example.com/2022/11/12/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Ansible自动化运维平台 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/12/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ansible自动化运维平台
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-12 22:54:35" itemprop="dateCreated datePublished" datetime="2022-11-12T22:54:35-04:00">2022-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-28 10:17:34" itemprop="dateModified" datetime="2022-11-28T10:17:34-04:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index"><span itemprop="name">Ansible</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/12/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/12/Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ansible-command与shell模块"><a href="#ansible-command与shell模块" class="headerlink" title="ansible command与shell模块"></a>ansible command与shell模块</h1><p>两个模块都是用于执行linux命令的,这对于命令熟悉的工程师来说，用起来非常high。</p>
<p>shell模块与command模块差不多（command模块不能执行一些类似$HOME,&gt;,&lt;,|等符号，但shell可以)</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/command_module.html">https://docs.ansible.com/ansible/latest/modules/command_module.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/shell_module.html">https://docs.ansible.com/ansible/latest/modules/shell_module.html</a></p>
<h2 id="一、shell模块"><a href="#一、shell模块" class="headerlink" title="一、shell模块"></a>一、shell模块</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m shell 192.168.98.201 -a &quot;ls /root&quot;</span><br><span class="line">192.168.98.201 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">公共</span><br><span class="line">模板</span><br><span class="line">视频</span><br><span class="line">图片</span><br><span class="line">文档</span><br><span class="line">下载</span><br><span class="line">音乐</span><br><span class="line">桌面</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">initial-setup-ks.cfg</span><br><span class="line">nginx.service</span><br><span class="line">nginx_study</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# ansible -m shell 192.168.98.201 -a &quot;echo &#x27;hello world&#x27; &gt; /tmp/baishuming&quot;</span><br><span class="line">192.168.98.201 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# ansible -m shell 192.168.98.201 -a &quot;cat /tmp/baishuming&quot;</span><br><span class="line">192.168.98.201 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意shell模块不是什么命令都能使用，比如vim这样的交互命令,不建议大家去记忆哪些命令不可以，大家只要养成任何在生产环境里的命令都要先在测试环境里测试一下的习惯就好。</span><br></pre></td></tr></table></figure>

<h2 id="二、command模块"><a href="#二、command模块" class="headerlink" title="二、command模块"></a>二、command模块</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m command 192.168.98.201 -a &quot;ls /root&quot;</span><br><span class="line">192.168.98.201 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">公共</span><br><span class="line">模板</span><br><span class="line">视频</span><br><span class="line">图片</span><br><span class="line">文档</span><br><span class="line">下载</span><br><span class="line">音乐</span><br><span class="line">桌面</span><br><span class="line">anaconda-ks.cfg</span><br><span class="line">initial-setup-ks.cfg</span><br><span class="line">nginx.service</span><br><span class="line">nginx_study</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# ansible -m command 192.168.98.201 -a &quot;echo &#x27;baism hello&#x27; &gt; /tmp/baism_123&quot;</span><br><span class="line">192.168.98.201 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">baism hello &gt; /tmp/baism_123</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# ansible -m command 192.168.98.201 -a &quot;cat /tmp/baism_123&quot;</span><br><span class="line">192.168.98.201 | FAILED | rc=1 &gt;&gt;</span><br><span class="line">cat: /tmp/baism_123: 没有那个文件或目录non-zero return code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">发现没有/tmp/baism_123 证明上一条命令未能执行成功</span><br></pre></td></tr></table></figure>

<h2 id="三、学习视频"><a href="#三、学习视频" class="headerlink" title="三、学习视频"></a>三、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=23">视频： command与shell模块</a></p>
<h1 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h1><h2 id="一、copy模块-重点"><a href="#一、copy模块-重点" class="headerlink" title="一、copy模块(重点)"></a>一、copy模块(重点)</h2><p>copy模块用于对文件的远程拷贝操作（如把本地的文件拷贝到远程的机器上)</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/copy_module.html#copy-module">https://docs.ansible.com/ansible/latest/modules/copy_module.html#copy-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>src</td>
<td>文件源路径</td>
</tr>
<tr>
<td>dest</td>
<td>目标路径</td>
</tr>
<tr>
<td>content</td>
<td>往目标文件输入内容</td>
</tr>
<tr>
<td>force</td>
<td>强制 yes or no</td>
</tr>
<tr>
<td>backup</td>
<td>是否备份有冲突的源文件[文件名相同，内容不同] yes or no</td>
</tr>
<tr>
<td>checksum</td>
<td>拷贝完整性校验，使用sha1sum生成校验码</td>
</tr>
<tr>
<td>owner</td>
<td>目标文件所有者</td>
</tr>
<tr>
<td>group</td>
<td>目标文件所属组</td>
</tr>
<tr>
<td>mode</td>
<td>目标文件权限</td>
</tr>
</tbody></table>
<p><strong>拷贝manage01机器&#x2F;root&#x2F;readme文件到group1组的机器。</strong></p>
<ol>
<li>要求校验完整性，注意[checksum 是根据sha1算法做校验的]</li>
<li>所有者、所属组都是sko</li>
<li>权限0400</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# sha1sum readme </span><br><span class="line">f8182e9ccdbe6efd13eb36a056a7db203fe66e40  readme</span><br><span class="line">[root@manage01 ~]# ansible -m copy group1 -a &quot;src=/root/readme dest=/opt checksum=f8182e9ccdbe6efd13eb36a056a7db203fe66e40 owner=sko group=sko mode=0400&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/readme&quot;,</span><br><span class="line">    &quot;gid&quot;: 1000,</span><br><span class="line">    &quot;group&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0400&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;size&quot;: 1214,</span><br><span class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1571366236.6664524-201027506158575/source&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1000</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/readme&quot;,</span><br><span class="line">    &quot;gid&quot;: 1001,</span><br><span class="line">    &quot;group&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0400&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;size&quot;: 1214,</span><br><span class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1571366236.6522918-97522631781022/source&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/readme&quot;,</span><br><span class="line">    &quot;gid&quot;: 1001,</span><br><span class="line">    &quot;group&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0400&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;size&quot;: 1214,</span><br><span class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1571366236.6274443-88161541412737/source&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>copy模块拷贝时要注意拷贝目录后面是否带”&#x2F;“符号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/yum.repos.d后面不带/符号，则表示把/etc/yum.repos.d整个目录拷贝到/tmp/目录下</span><br><span class="line">[root@manage01 ~]# ansible group1 -m copy -a &#x27;src=/etc/yum.repos.d dest=/tmp/&#x27;</span><br><span class="line">/etc/yum.repos.d/后面带/符号，则表示把/etc/yum.repos.d/目录里的所有文件拷贝到/tmp/目录下</span><br><span class="line">[root@manage01 ~]# ansible group1 -m copy -a &#x27;src=/etc/yum.repos.d/ dest=/tmp/&#x27;</span><br></pre></td></tr></table></figure>

<p>使用content参数直接往远程文件里写内容（会覆盖原内容）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file group1 -a &quot;path=/tmp/zutuanxue_333 state=touch&quot;</span><br><span class="line">[root@manage01 ~]# ansible -m copy group1 -a &quot;content=&#x27;baism\nhello world\n&#x27; dest=/tmp/zutuanxue_333&quot;</span><br><span class="line">注意:ansible中-a后面的参数里也有引号时，记得要单引双引交叉使用，如果都为双引会出现问题</span><br></pre></td></tr></table></figure>

<p>使用force参数控制是否强制覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果目标文件已经存在，则不覆盖</span><br><span class="line">[root@manage01 ~]# ansible group1 -m copy -a &quot;src=/tmp/zutuanxue_222 dest=/tmp/zutuanxue_333 force=no&quot;</span><br><span class="line">如果目标文件已经存在，则会强制覆盖</span><br><span class="line">[root@manage01 ~]# ansible group1 -m copy -a &quot;src=/tmp/zutuanxue_222 dest=/tmp/zutuanxue_333 force=yes&quot;</span><br></pre></td></tr></table></figure>

<p>使用backup参数控制是否备份文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">backup=yes表示如果拷贝的文件内容与原内容不一样，则会备份一份</span><br><span class="line"></span><br><span class="line">如果拷贝过来的文件本机存在，group1的机器上会将/tmp/333备份一份（备份文件命名加上时间），再远程拷贝新的文件为/tmp/333</span><br><span class="line">[root@manage01 ~]# ansible group1 -m copy -a &quot;src=/etc/fstab dest=/tmp/zutuanxue_333 backup=yes&quot;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频"><a href="#二、学习视频" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=14">视频：copy模块</a></p>
<h1 id="cron模块"><a href="#cron模块" class="headerlink" title="cron模块"></a>cron模块</h1><h2 id="一、cron模块"><a href="#一、cron模块" class="headerlink" title="一、cron模块"></a>一、cron模块</h2><p>cron模块用于管理周期性时间任务。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module">https://docs.ansible.com/ansible/latest/modules/cron_module.html#cron-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>计划任务的名称</td>
</tr>
<tr>
<td>user</td>
<td>执行计划任务的用户</td>
</tr>
<tr>
<td>job</td>
<td>计划任务命令</td>
</tr>
<tr>
<td>minute</td>
<td>执行计划任务的分 默认为*</td>
</tr>
<tr>
<td>hour</td>
<td>执行计划任务的时 默认为*</td>
</tr>
<tr>
<td>day</td>
<td>执行计划任务的日 默认为*</td>
</tr>
<tr>
<td>month</td>
<td>执行计划任务的月 默认为*</td>
</tr>
<tr>
<td>week</td>
<td>执行计划任务的周 默认为*</td>
</tr>
<tr>
<td>state absent</td>
<td>删除计划任务</td>
</tr>
</tbody></table>
<p>创建一个cron任务,不指定user的话,默认就是root（因为我这里是用root操作的)。<br>如果minute,hour,day,month,week不指定的话，默认都为*</p>
<p>每天14:23 执行echo “haha”&gt;&#x2F;tmp&#x2F;test</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m cron group1 -a &#x27;name=&quot;cron test&quot; user=root job=&quot;echo haha &gt; /tmp/test&quot; minute=23 hour=12&#x27;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: [</span><br><span class="line">        &quot;cron test&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: [</span><br><span class="line">        &quot;cron test&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: [</span><br><span class="line">        &quot;cron test&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除cron任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m cron group1 -a &#x27;name=&quot;cron test&quot; state=absent&#x27;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: []</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: []</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;envs&quot;: [],</span><br><span class="line">    &quot;jobs&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-1"><a href="#二、学习视频-1" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=18">视频：cron模块</a></p>
<h1 id="fetch模块"><a href="#fetch模块" class="headerlink" title="fetch模块"></a>fetch模块</h1><h2 id="一、fetch模块"><a href="#一、fetch模块" class="headerlink" title="一、fetch模块"></a>一、fetch模块</h2><p>fetch模块与copy模块类似，但作用相反。用于把远程机器的文件拷贝到本地。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/fetch_module.html#fetch-module">https://docs.ansible.com/ansible/latest/modules/fetch_module.html#fetch-module</a></p>
<p>将group1组机器的&#x2F;opt&#x2F;readme 拷贝到manage01的&#x2F;opt目录</p>
<p>注意:不管是拷贝多个机器还是一个机器的文件，在管理机本地目录都会按照</p>
<p> IP&#x2F;路径&#x2F;文件名</p>
<p>的方式命名，防止冲突</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]#  ansible -m fetch group1 -a &quot;src=/opt/readme dest=/opt&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/192.168.98.203/opt/readme&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;remote_checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/192.168.98.202/opt/readme&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;remote_checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/opt/192.168.98.201/opt/readme&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;f8c2686842f9fa79361e8928867a1983&quot;,</span><br><span class="line">    &quot;remote_checksum&quot;: &quot;f8182e9ccdbe6efd13eb36a056a7db203fe66e40&quot;,</span><br><span class="line">    &quot;remote_md5sum&quot;: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-2"><a href="#二、学习视频-2" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=15">视频：fetch模块</a></p>
<h1 id="file模块"><a href="#file模块" class="headerlink" title="file模块"></a>file模块</h1><h2 id="一、file模块-重点"><a href="#一、file模块-重点" class="headerlink" title="一、file模块(重点)"></a>一、file模块(重点)</h2><p>file模块用于对文件或文件夹相关的操作，主要用来设置文件、链接、目录的属性，或者移除文件、链接、目录，很多其他的模块也会包含这种作用，例如copy，assemble和template。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module">https://docs.ansible.com/ansible/latest/modules/file_module.html#file-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>文件绝对路径</td>
</tr>
<tr>
<td>state</td>
<td>操作(touch文件新建、absent删除、link软连接、hard硬链接、directory目录创建)</td>
</tr>
<tr>
<td>owner</td>
<td>设置所有者</td>
</tr>
<tr>
<td>group</td>
<td>设置所属的组</td>
</tr>
<tr>
<td>mode</td>
<td>权限 0000</td>
</tr>
<tr>
<td>recurse</td>
<td>递归 yes or no</td>
</tr>
</tbody></table>
<p><strong>文件的创建</strong></p>
<p>在所有的业务机器的&#x2F;tmp下创建一个文件：zutuanxue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file group1 -a &quot;path=/tmp/zutuanxue state=touch&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;size&quot;: 0,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;size&quot;: 0,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;size&quot;: 0,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文件的删除</strong></p>
<p>将node1(192.168.98.201)机器的&#x2F;tmp&#x2F;zutuanxue文件删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file 192.168.98.201 -a &quot;path=/tmp/zutuanxue state=absent&quot;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文件权限</strong></p>
<p>修改node2机器文件&#x2F;tmp&#x2F;zutuanxue:</p>
<p>所有者:sko</p>
<p>所属组:nobody</p>
<p>权限:600</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file 192.168.98.202 -a &quot;path=/tmp/zutuanxue owner=sko group=nobody mode=0600&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 65534,</span><br><span class="line">    &quot;group&quot;: &quot;nobody&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0600&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;size&quot;: 0,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">###执行前提:192.168.98.202 有sko用户</span><br></pre></td></tr></table></figure>

<p><strong>创建链接文件[软连接、硬链接]</strong></p>
<p>为node2机器的&#x2F;tmp&#x2F;zutuanxue文件创建以下链接</p>
<p>软连接 &#x2F;tmp&#x2F;zutuanxue_com</p>
<p>硬链接 &#x2F;tmp&#x2F;zutuanxue_com_cn</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#软连接</span><br><span class="line">[root@manage01 ~]# ansible -m file 192.168.98.202 -a &quot;src=/tmp/zutuanxue path=/tmp/zutuanxue_com state=link&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/zutuanxue_com&quot;,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0777&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;size&quot;: 13,</span><br><span class="line">    &quot;src&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;link&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#硬链接</span><br><span class="line">[root@manage01 ~]# ansible -m file 192.168.98.202 -a &quot;src=/tmp/zutuanxue path=/tmp/zutuanxue_com_cn state=hard&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/zutuanxue_com_cn&quot;,</span><br><span class="line">    &quot;gid&quot;: 65534,</span><br><span class="line">    &quot;group&quot;: &quot;nobody&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0600&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;size&quot;: 0,</span><br><span class="line">    &quot;src&quot;: &quot;/tmp/zutuanxue&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;hard&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>创建一个目录</strong></p>
<p>为所有的业务机器创建一个目录: &#x2F;tmp&#x2F;zutuanxue123</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file group1 -a &quot;path=/tmp/zutuanxue123 state=directory&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 6,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 6,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 6,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>修改目录及子文件权限</strong></p>
<p>设置业务机器的&#x2F;tmp&#x2F;zutuanxue123目录及子文件的权限</p>
<p>所有者设置为sko</p>
<p>权限为2775</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file group1 -a &quot;path=/tmp/zutuanxue123 owner=sko mode=2755 recurse=yes&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;02755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 19,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 1000</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;02755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 19,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;02755&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;sko&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;size&quot;: 19,</span><br><span class="line">    &quot;state&quot;: &quot;directory&quot;,</span><br><span class="line">    &quot;uid&quot;: 1001</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>删除一个目录[包括子文件全部删除]</strong></p>
<p>删除所有业务机器的&#x2F;tmp&#x2F;zutuanxue123目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m file group1 -a &quot;path=/tmp/zutuanxue123 state=absent&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;path&quot;: &quot;/tmp/zutuanxue123&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-3"><a href="#二、学习视频-3" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=13">视频：file模块</a></p>
<h1 id="group模块"><a href="#group模块" class="headerlink" title="group模块"></a>group模块</h1><h2 id="一、group模块"><a href="#一、group模块" class="headerlink" title="一、group模块"></a>一、group模块</h2><p>group模块用于管理用户组和用户组属性。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/group_module.html#group-module">https://docs.ansible.com/ansible/latest/modules/group_module.html#group-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name&#x3D;</td>
<td>组名</td>
</tr>
<tr>
<td>state&#x3D; persent|absent</td>
<td>创建|删除</td>
</tr>
<tr>
<td>system&#x3D; yes|no</td>
<td>是否为系统组</td>
</tr>
<tr>
<td>gid</td>
<td>gid</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#组创建</span><br><span class="line">[root@manage01 ~]# ansible -m group group1 -a &quot;name=admin gid=4444 state=present&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 4444,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 4444,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;gid&quot;: 4444,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#删除组</span><br><span class="line">[root@manage01 ~]# ansible -m group group1 -a &quot;name=admin state=absent&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-4"><a href="#二、学习视频-4" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=17">视频：group模块</a></p>
<h1 id="hostname模块"><a href="#hostname模块" class="headerlink" title="hostname模块"></a>hostname模块</h1><h2 id="一、hostname模块"><a href="#一、hostname模块" class="headerlink" title="一、hostname模块"></a>一、hostname模块</h2><p>hostname模块用于修改主机名（<strong>注意</strong>: 它不能修改&#x2F;etc&#x2F;hosts文件)</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/hostname_module.html#hostname-module">https://docs.ansible.com/ansible/latest/modules/hostname_module.html#hostname-module</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">将192.168.98.203机器的主机名修改为zutuanxue_node3</span><br><span class="line"></span><br><span class="line">[root@manage01 ~]# ansible -m hostname -a &quot;name=zutuanxue_node3&quot; 192.168.98.203</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_domain&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ansible_fqdn&quot;: &quot;zutuanxue_node3&quot;,</span><br><span class="line">        &quot;ansible_hostname&quot;: &quot;zutuanxue_node3&quot;,</span><br><span class="line">        &quot;ansible_nodename&quot;: &quot;zutuanxue_node3&quot;,</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;name&quot;: &quot;zutuanxue_node3&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">备注：批量修改需要使用playbook剧本</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-5"><a href="#二、学习视频-5" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=12">视频：hostname模块</a></p>
<h1 id="playbook剧本"><a href="#playbook剧本" class="headerlink" title="playbook剧本"></a>playbook剧本</h1><h2 id="一、playbook介绍"><a href="#一、playbook介绍" class="headerlink" title="一、playbook介绍"></a>一、playbook介绍</h2><p>playbook(剧本): 是ansible用于配置,部署,和管理被控节点的剧本。</p>
<p>参考:<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html</a></p>
<p>使用的格式为<strong>yaml</strong>格式（saltstack,elk,docker等也都会用到yaml格式)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">树明的理解：</span><br><span class="line">playbook：ansible格式的脚本。将所有需要执行的操作按照ansible的编程语法，放到文件中执行。</span><br><span class="line"></span><br><span class="line">playbook替代方案</span><br><span class="line">1)、完全可以用shell脚本来替代playbook</span><br><span class="line">    将所有的ansible命令放入脚本    shell脚本中写的是ansible指令</span><br><span class="line">#!/bin/bash</span><br><span class="line">for IP in  `seq 201 203`</span><br><span class="line">   do</span><br><span class="line">       ansible -m hostname 192.168.98.$IP -a &quot;name=node$&#123;IP&#125;&quot;</span><br><span class="line">done</span><br><span class="line">    </span><br><span class="line">2)、ansible+shell脚本  使用script模块</span><br><span class="line">ansible -m script group2 &#x27;/etc/ansible/srcipts/nginx_install.sh&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="1-1、YAML格式规则"><a href="#1-1、YAML格式规则" class="headerlink" title="1.1、YAML格式规则"></a>1.1、YAML格式规则</h3><ul>
<li>文件的第一行以 “—“开始，表明YMAL文件的开始.</li>
<li>以#号开头为注释</li>
<li>列表中的所有成员都开始于相同的缩进级别, 并且使用一个 <code>&quot;- &quot;</code> 作为开头(一个横杠和一个空格)</li>
<li>一个字典是由一个简单的 <code>键: 值</code> 的形式组成(这个冒号后面必须是一个空格)</li>
<li><strong>注意: 写这种文件不要使用tab键，都使用空格</strong></li>
</ul>
<p>参考: <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html#yaml-syntax">https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html#yaml-syntax</a></p>
<p>下面看一个官方的示例感受一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"># 一位职工记录</span><br><span class="line">name: Example Developer</span><br><span class="line">job: Developer</span><br><span class="line">skill: Elite</span><br><span class="line">employed: True</span><br><span class="line">foods:</span><br><span class="line">  - Apple</span><br><span class="line">  - Orange</span><br><span class="line">  - Strawberry</span><br><span class="line">  - Mango</span><br><span class="line">languages:</span><br><span class="line">    ruby: Elite</span><br><span class="line">    python: Elite</span><br><span class="line">    dotnet: Lame</span><br></pre></td></tr></table></figure>

<h3 id="playbook实例"><a href="#playbook实例" class="headerlink" title="playbook实例"></a>playbook实例</h3><p>先直接来看一个实例 apache安装及业务初始化</p>
<p><strong>第1步: 创建一个存放playbook的目录(路径自定义)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# mkdir -p /etc/ansible/playbook/web</span><br></pre></td></tr></table></figure>

<p><strong>第2步: 准备httpd配置文件,并修改成你想要的配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]#  yum install httpd -y</span><br><span class="line"></span><br><span class="line">按需要修改你想要的配置(为了测试可以随意改动标记一下)</span><br><span class="line">[root@manage01 ~]#  vim /etc/httpd/conf/httpd.conf</span><br></pre></td></tr></table></figure>

<p><strong>第3步: 写一个playbook文件(后缀为.yml或.yaml)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 web]# cat apache.yaml </span><br><span class="line">---</span><br><span class="line">- hosts: group1</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars:</span><br><span class="line">    - user: zutuanxue</span><br><span class="line">  tasks:</span><br><span class="line">    - name: create user use variable</span><br><span class="line">      user: user=zutuanxue state=present</span><br><span class="line"></span><br><span class="line">    - name: install httpd server</span><br><span class="line">      yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">      with_items:</span><br><span class="line">        - httpd</span><br><span class="line">        - httpd-devel</span><br><span class="line"></span><br><span class="line">    - name: start httpd service</span><br><span class="line">      service: name=httpd state=started enabled=yes</span><br><span class="line"></span><br><span class="line">    - name: copy httpd.conf to group1:/etc/httpd/conf/</span><br><span class="line">      copy: src=/etc/ansible/playbook/web/httpd.conf dest=/etc/httpd/conf</span><br><span class="line">      notify:</span><br><span class="line">        - restart httpd service</span><br><span class="line"></span><br><span class="line">  handlers:</span><br><span class="line">       - name: restart httpd service</span><br><span class="line">         service: name=httpd state=restarted</span><br><span class="line">         </span><br><span class="line">         </span><br><span class="line">         </span><br><span class="line">#tasks</span><br><span class="line">#1、创建apache管理用户</span><br><span class="line">#2、安装httpd</span><br><span class="line">#3、服务启动管理</span><br><span class="line">#4、拷贝配置文件，业务初始化</span><br><span class="line">   #5、触发重启服务httpd</span><br></pre></td></tr></table></figure>

<p>第4步: 执行写好的palybook</p>
<ul>
<li>会显示出执行的过程，并且执行的每一步都有ok,changed,failed等标识</li>
<li>执行如果有错误(failed)会回滚，解决问题后，直接再执行这条命令即可,并会把failed改为changed（幂等性)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 web]# ansible-playbook /etc/ansible/playbook/web/apache.yaml</span><br></pre></td></tr></table></figure>

<h3 id="1-2、Playbook常见语法"><a href="#1-2、Playbook常见语法" class="headerlink" title="1.2、Playbook常见语法"></a>1.2、Playbook常见语法</h3><p><strong>hosts:</strong> 用于指定要执行任务的主机，其可以是一个或多个由冒号分隔主机组.</p>
<p><strong>remote_user:</strong> 用于指定远程主机上的执行任务的用户.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- hosts: group1			</span><br><span class="line">  remote_user: root	</span><br></pre></td></tr></table></figure>

<p><strong>tasks:</strong> 任务列表, 按顺序执行任务.</p>
<ul>
<li>如果一个host执行task失败, 整个tasks都会回滚, 修正playbook 中的错误, 然后重新执行即可.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: create user use variable</span><br><span class="line">    user: name=&#123;&#123;user&#125;&#125; state=present</span><br><span class="line"></span><br><span class="line">  - name: install httpd server</span><br><span class="line">    yum: name=httpd state=latest name=httpd-devel state=latest</span><br><span class="line"></span><br><span class="line">  - name: start httpd service</span><br><span class="line">    service: name=httpd state=started enabled=yes</span><br><span class="line"></span><br><span class="line">  - name: copy httpd.conf to group1:/etc/httpd/conf/</span><br><span class="line">    copy: src=/opt/httpd.conf dest=/etc/httpd/conf/</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p><strong>handlers:</strong> 类似task，但需要使用notify通知调用，实现按需调用。</p>
<ul>
<li>不管有多少个通知者进行了notify，等到play中的所有task执行完成之后，handlers也只会被执行一次.</li>
<li>handlers最佳的应用场景是用来重启服务,或者触发系统重启操作.除此以外很少用到了.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  notify:</span><br><span class="line">  - restart httpd service</span><br><span class="line">  </span><br><span class="line">handlers:</span><br><span class="line">  - name: restart httpd service</span><br><span class="line">    service: name=httpd state=restarted</span><br><span class="line">    </span><br><span class="line">#注意: handlers 需要notify调用，他和tasks不同的是  tasks每次都会调用，heandlers触发才调用，比如配置文件修改了，在执行playbook的时候，就会将管理机上的新改的copy到被管理机，那么就会触发headlers重启服务，否则不会执行heanlers</span><br></pre></td></tr></table></figure>

<p><strong>练习:</strong> 修改httpd的端口为8080,再执行playbook测试</p>
<p><strong>variables:</strong> 变量</p>
<ul>
<li>定义变量可以被多次方便调用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vars:</span><br><span class="line">    - user: zutuanxue</span><br></pre></td></tr></table></figure>

<p><strong>with_items</strong>: 迭代列表</p>
<ul>
<li>其使用格式为将需要迭代的内容定义为item变量引用，并通过with_items语句指明迭代的元素列表即可。</li>
</ul>
<p>例如安装多个软件包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">with_items:</span><br><span class="line">  - httpd</span><br><span class="line">  - httpd-devel</span><br></pre></td></tr></table></figure>

<p>执行后有如下警告</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601969382005.png" alt="警告.png"></p>
<p>解决方法:</p>
<p>在&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg配置文件里的[default]配置段下面加上deprecation_warnings&#x3D;False参数即可</p>
<h2 id="二、练习案例"><a href="#二、练习案例" class="headerlink" title="二、练习案例"></a>二、练习案例</h2><p>写一个playbook实现</p>
<ol>
<li>配置yum</li>
<li>安装vsftpd包</li>
<li>修改配置文件(要求拒绝匿名用户登录)</li>
<li>启动服务并实现vsftpd服务开机自动启动</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: group1                 </span><br><span class="line">  remote_user: root                     </span><br><span class="line">  tasks:                                </span><br><span class="line">  - name: rm yum repository      </span><br><span class="line">    file: path=/etc/yum.repos.d/ state=absent</span><br><span class="line">    </span><br><span class="line">  - name: 同步master上的yum源到group1</span><br><span class="line">    copy: src=/etc/yum.repos.d dest=/etc/</span><br><span class="line">    </span><br><span class="line">  - name: ensure vsftpd is at the latest version        </span><br><span class="line">    yum: name=vsftpd state=latest</span><br><span class="line">    </span><br><span class="line">  - name: write the apache config file          </span><br><span class="line">    copy: src=/etc/vsftpd/vsftpd.conf dest=/etc/vsftpd/vsftpd.conf </span><br><span class="line">    </span><br><span class="line">    notify:                             </span><br><span class="line">    - restart vsftpd</span><br><span class="line">    </span><br><span class="line">  - name: ensure vsftpd is running (and enable it at boot)</span><br><span class="line">    service: name=vsftpd state=started enabled=yes</span><br><span class="line">    </span><br><span class="line">  handlers:                     </span><br><span class="line">    - name: restart vsftpd              </span><br><span class="line">      service: name=vsftpd state=restarted</span><br></pre></td></tr></table></figure>

<h1 id="Ansible-role"><a href="#Ansible-role" class="headerlink" title="Ansible-role"></a>Ansible-role</h1><p>假设我们要写一个playbook来安装管理lamp环境，那么这个playbook就会写很长。所以我们希望把这个很大的文件分成多个功能拆分, 分成apache管理,php管理,mysql管理，然后在需要使用的时候直接调用就可以了，以免重复写。就类似编程里的模块化的概念，以达到代码复用的效果。</p>
<h2 id="一、roles介绍"><a href="#一、roles介绍" class="headerlink" title="一、roles介绍"></a>一、roles介绍</h2><p><strong>roles：</strong> ansible模块，类似于函数，完成一个任务的指令。每一个roles都有自己特定的目录结构，就是通过分别将variables, tasks及handlers等放置于单独的目录中,并可以便捷地调用它们的一种机制。</p>
<p><strong>roles优点：</strong></p>
<p> 1）模块中指令较少，方便编写</p>
<p> 2）重复调用方便</p>
<p>3）排错方便</p>
<h2 id="二、创建roles的目录结构"><a href="#二、创建roles的目录结构" class="headerlink" title="二、创建roles的目录结构"></a>二、创建roles的目录结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">files：用来存放由copy模块或script模块调用的文件。</span><br><span class="line">tasks：至少有一个main.yml文件，定义各tasks。</span><br><span class="line">handlers:有一个main.yml文件，定义各handlers。</span><br><span class="line">templates：用来存放jinjia2模板。</span><br><span class="line">vars：有一个main.yml文件，定义变量。</span><br><span class="line">meta：有一个main.yml文件，定义此角色的特殊设定及其依赖关系。</span><br></pre></td></tr></table></figure>

<p><strong>注意:</strong> 在每个角色的目录中分别创建files, tasks,handlers,templates,vars和meta目录，用不到的目录可以创建为空目录.</p>
<h2 id="三、案例：通过roles实现lamp"><a href="#三、案例：通过roles实现lamp" class="headerlink" title="三、案例：通过roles实现lamp"></a>三、案例：通过roles实现lamp</h2><p>分析：需定制三个角色: httpd,mysql,php</p>
<h3 id="3-1）-创建roles目录及文件-并确认目录结构"><a href="#3-1）-创建roles目录及文件-并确认目录结构" class="headerlink" title="3.1） 创建roles目录及文件,并确认目录结构"></a>3.1） 创建roles目录及文件,并确认目录结构</h3><p>roles&#x2F;<br>├── httpd<br>│ ├── files<br>│ ├── handlers<br>│ │ └── main.yml<br>│ ├── meta<br>│ │ └── main.yml<br>│ ├── tasks<br>│ │ └── main.yml<br>│ ├── templates<br>│ └── vars<br>│ └── main.yml<br>├── mysql<br>│ ├── files<br>│ ├── handlers<br>│ │ └── main.yml<br>│ ├── meta<br>│ │ └── main.yml<br>│ ├── tasks<br>│ │ └── main.yml<br>│ ├── templates<br>│ └── vars<br>│ └── main.yml<br>└── php<br>├── files<br>├── handlers<br>│ └── main.yml<br>├── meta<br>│ └── main.yml<br>├── tasks<br>│ └── main.yml<br>├── templates<br>└── vars<br>└── main.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ansible]# mkdir -p roles/&#123;httpd,mysql,php&#125;/&#123;files,tasks,handlers,templates,vars,meta&#125;</span><br><span class="line">[root@manage01 ansible]# touch roles/&#123;httpd,mysql,php&#125;/&#123;tasks,handlers,vars,meta&#125;/main.yml</span><br><span class="line">[root@manage01 ansible]# tree roles/</span><br><span class="line">roles/</span><br><span class="line">├── httpd</span><br><span class="line">│   ├── files</span><br><span class="line">│   ├── handlers</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── meta</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── tasks</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── templates</span><br><span class="line">│   └── vars</span><br><span class="line">│       └── main.yml</span><br><span class="line">├── mysql</span><br><span class="line">│   ├── files</span><br><span class="line">│   ├── handlers</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── meta</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── tasks</span><br><span class="line">│   │   └── main.yml</span><br><span class="line">│   ├── templates</span><br><span class="line">│   └── vars</span><br><span class="line">│       └── main.yml</span><br><span class="line">└── php</span><br><span class="line">    ├── files</span><br><span class="line">    ├── handlers</span><br><span class="line">    │   └── main.yml</span><br><span class="line">    ├── meta</span><br><span class="line">    │   └── main.yml</span><br><span class="line">    ├── tasks</span><br><span class="line">    │   └── main.yml</span><br><span class="line">    ├── templates</span><br><span class="line">    └── vars</span><br><span class="line">        └── main.yml</span><br><span class="line"></span><br><span class="line">21 directories, 12 files</span><br></pre></td></tr></table></figure>

<h3 id="3-2）准备httpd服务器的主页文件-php测试页和配置文件等"><a href="#3-2）准备httpd服务器的主页文件-php测试页和配置文件等" class="headerlink" title="3.2）准备httpd服务器的主页文件,php测试页和配置文件等"></a>3.2）准备httpd服务器的主页文件,php测试页和配置文件等</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 files]# ls</span><br><span class="line">httpd.conf  phpinfo.php</span><br></pre></td></tr></table></figure>

<h3 id="3-3）编写httpd角色的main-yml文件"><a href="#3-3）编写httpd角色的main-yml文件" class="headerlink" title="3.3）编写httpd角色的main.yml文件"></a>3.3）编写httpd角色的main.yml文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 roles]# cat httpd/tasks/main.yml </span><br><span class="line">- name: httpd httpd-devel httpd-manual软件包安装</span><br><span class="line">  yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">  with_items:</span><br><span class="line">    - httpd</span><br><span class="line">    - httpd-devel</span><br><span class="line">    - httpd-manual</span><br><span class="line"></span><br><span class="line">- name: 创建apache管理用户 www</span><br><span class="line">  user: name=&#123;&#123;user&#125;&#125; state=present</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- name: 设置apache开机启动，并启动服务</span><br><span class="line">  service: name=httpd enabled=yes state=started</span><br><span class="line"></span><br><span class="line">- name: 拷贝配置文件，初始化业务</span><br><span class="line">  copy: src=/etc/ansible/roles/httpd/files/httpd.conf dest=/etc/httpd/conf/httpd.conf</span><br><span class="line">  #定义通知调用，当配置文件更新,需要重启服务</span><br><span class="line">  notify: </span><br><span class="line">    - restart apache</span><br><span class="line"></span><br><span class="line">- name: 拷贝php测试页面</span><br><span class="line">  copy: src=/etc/ansible/roles/httpd/files/phpinfo.php dest=/var/www/html/</span><br><span class="line"></span><br><span class="line">[root@manage01 roles]# cat httpd/vars/main.yml</span><br><span class="line">user: www</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@manage01 roles]# cat httpd/handlers/main.yml </span><br><span class="line">- name: restart apache</span><br><span class="line">  service: name=httpd state=restarted</span><br></pre></td></tr></table></figure>

<h3 id="3-4）编写mysql角色的main-yml文件"><a href="#3-4）编写mysql角色的main-yml文件" class="headerlink" title="3.4）编写mysql角色的main.yml文件"></a>3.4）编写mysql角色的main.yml文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ansible]# ls roles/php/files/</span><br><span class="line">www.conf</span><br><span class="line"></span><br><span class="line">[root@manage01 roles]# cat mysql/tasks/main.yml </span><br><span class="line">- name: mysql 用户创建</span><br><span class="line">  user: name=&#123;&#123;user&#125;&#125; state=present</span><br><span class="line"></span><br><span class="line">- name: mysql 软件安装</span><br><span class="line">  yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">  with_items:</span><br><span class="line">    - mariadb</span><br><span class="line">    - mariadb-server</span><br><span class="line"></span><br><span class="line">- name: 启动服务，并设置开机启动</span><br><span class="line">  service: name=mariadb enabled=yes state=started</span><br><span class="line"></span><br><span class="line">- name: 改变mysql文件的所有者为mysql</span><br><span class="line">  file: path=&#x27;/usr/lib/mysql&#x27; owner=&#123;&#123;user&#125;&#125; group=&#123;&#123;user&#125;&#125; recurse=yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@manage01 roles]# cat mysql/vars/main.yml </span><br><span class="line">user: mysql</span><br></pre></td></tr></table></figure>

<h3 id="3-5）-编写php角色的main-yml文件"><a href="#3-5）-编写php角色的main-yml文件" class="headerlink" title="3.5）:编写php角色的main.yml文件"></a>3.5）:编写php角色的main.yml文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ansible]# cat roles/php/tasks/main.yml </span><br><span class="line">- name: 安装php</span><br><span class="line">  yum: name=&#123;&#123;item&#125;&#125; state=latest</span><br><span class="line">  with_items:</span><br><span class="line">    - php</span><br><span class="line">    - php-mysqlnd</span><br><span class="line">    - php-gd</span><br><span class="line">    - php-ldap</span><br><span class="line">    - php-odbc</span><br><span class="line">    - php-pear</span><br><span class="line">    - php-xml</span><br><span class="line">    - php-xmlrpc</span><br><span class="line">    - php-mbstring</span><br><span class="line">    - php-snmp</span><br><span class="line">    - php-soap</span><br><span class="line">    - curl</span><br><span class="line">    - curl-devel </span><br><span class="line">    - php-bcmath</span><br><span class="line">    - php-fpm</span><br><span class="line"></span><br><span class="line">- name: copy www.conf to /etc/php-fpm.d</span><br><span class="line">  copy: src=/etc/ansible/roles/php/files/www.conf dest=/etc/php-fpm.d force=yes</span><br><span class="line">  notify:</span><br><span class="line">    - restart php-fpm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@manage01 ansible]# cat roles/php/handlers/main.yml </span><br><span class="line">- name: restart php-fpm</span><br><span class="line">  service: name=php-fpm state=restarted</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="3-6）编写lamp的playbook文件调用前面定义好的三个角色"><a href="#3-6）编写lamp的playbook文件调用前面定义好的三个角色" class="headerlink" title="3.6）编写lamp的playbook文件调用前面定义好的三个角色"></a>3.6）编写lamp的playbook文件调用前面定义好的三个角色</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 yaml]# cat lamp.yml </span><br><span class="line">---</span><br><span class="line">- hosts: group1</span><br><span class="line">  remote_user: root</span><br><span class="line">  roles:</span><br><span class="line">  - httpd</span><br><span class="line">  - mysql</span><br><span class="line">  - php</span><br></pre></td></tr></table></figure>

<h3 id="3-7）-执行lamp的playbook文件"><a href="#3-7）-执行lamp的playbook文件" class="headerlink" title="3.7） 执行lamp的playbook文件"></a>3.7） 执行lamp的playbook文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 yaml]# ansible-playbook -C lamp.yml</span><br><span class="line">[root@manage01 yaml]# ansible-playbook lamp.yml</span><br></pre></td></tr></table></figure>

<h3 id="3-8）-测试业务机器"><a href="#3-8）-测试业务机器" class="headerlink" title="3.8） 测试业务机器"></a>3.8） 测试业务机器</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601969569380.png" alt="lamp_test.png"></p>
<h1 id="Ansible-script模块"><a href="#Ansible-script模块" class="headerlink" title="Ansible-script模块"></a>Ansible-script模块</h1><h2 id="一、script模块"><a href="#一、script模块" class="headerlink" title="一、script模块"></a>一、script模块</h2><p><strong>如何通过ansible执行一个脚本：lamp安装脚本</strong></p>
<p>script模块：用于在远程机器上执行<strong>本地</strong>脚本。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/script_module.html#script-module">https://docs.ansible.com/ansible/latest/modules/script_module.html#script-module</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">在manage01上创建脚本，通过ansible将脚本分发到被管理端</span><br><span class="line">[root@manage01 ~]# cat ansible_test.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">#ansible script module test script</span><br><span class="line">mkdir /opt/log</span><br><span class="line">find / -name &quot;*.log&quot; -exec cp -rpf &#123;&#125; /opt/log \;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#脚本不用给执行权限</span><br><span class="line">[root@manage01 ~]# ansible -m script group1 -a &quot;/root/ansible_test.sh&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;stderr&quot;: &quot;Shared connection to 192.168.98.203 closed.\r\n&quot;,</span><br><span class="line">    &quot;stderr_lines&quot;: [</span><br><span class="line">        &quot;Shared connection to 192.168.98.203 closed.&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;stdout&quot;: &quot;cp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-5r3m4old.log&#x27; 与&#x27;/opt/log/ks-script-5r3m4old.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-h97m_bc_.log&#x27; 与&#x27;/opt/log/ks-script-h97m_bc_.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件\r\n&quot;,</span><br><span class="line">    &quot;stdout_lines&quot;: [</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-5r3m4old.log&#x27; 与&#x27;/opt/log/ks-script-5r3m4old.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-h97m_bc_.log&#x27; 与&#x27;/opt/log/ks-script-h97m_bc_.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;stderr&quot;: &quot;Shared connection to 192.168.98.202 closed.\r\n&quot;,</span><br><span class="line">    &quot;stderr_lines&quot;: [</span><br><span class="line">        &quot;Shared connection to 192.168.98.202 closed.&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;stdout&quot;: &quot;cp: &#x27;/opt/log/home-75a175cb.log&#x27; 与&#x27;/opt/log/home-75a175cb.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/root-648d48b0.log&#x27; 与&#x27;/opt/log/root-648d48b0.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_kcm.log&#x27; 与&#x27;/opt/log/sssd_kcm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-fx6j2w7d.log&#x27; 与&#x27;/opt/log/ks-script-fx6j2w7d.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-igqtd8i1.log&#x27; 与&#x27;/opt/log/ks-script-igqtd8i1.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/Xorg.9.log&#x27; 与&#x27;/opt/log/Xorg.9.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-vmusr.log&#x27; 与&#x27;/opt/log/vmware-vmusr.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件\r\n&quot;,</span><br><span class="line">    &quot;stdout_lines&quot;: [</span><br><span class="line">        &quot;cp: &#x27;/opt/log/home-75a175cb.log&#x27; 与&#x27;/opt/log/home-75a175cb.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/root-648d48b0.log&#x27; 与&#x27;/opt/log/root-648d48b0.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_kcm.log&#x27; 与&#x27;/opt/log/sssd_kcm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-fx6j2w7d.log&#x27; 与&#x27;/opt/log/ks-script-fx6j2w7d.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-igqtd8i1.log&#x27; 与&#x27;/opt/log/ks-script-igqtd8i1.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/Xorg.9.log&#x27; 与&#x27;/opt/log/Xorg.9.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-vmusr.log&#x27; 与&#x27;/opt/log/vmware-vmusr.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;stderr&quot;: &quot;Shared connection to 192.168.98.201 closed.\r\n&quot;,</span><br><span class="line">    &quot;stderr_lines&quot;: [</span><br><span class="line">        &quot;Shared connection to 192.168.98.201 closed.&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;stdout&quot;: &quot;cp: &#x27;/opt/log/home-2b167fc1.log&#x27; 与&#x27;/opt/log/home-2b167fc1.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/root-836d3cf3.log&#x27; 与&#x27;/opt/log/root-836d3cf3.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_kcm.log&#x27; 与&#x27;/opt/log/sssd_kcm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-ai28ecf4.log&#x27; 与&#x27;/opt/log/ks-script-ai28ecf4.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/ks-script-k4vgo8wr.log&#x27; 与&#x27;/opt/log/ks-script-k4vgo8wr.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/Xorg.9.log&#x27; 与&#x27;/opt/log/Xorg.9.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-vmusr.log&#x27; 与&#x27;/opt/log/vmware-vmusr.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.6.log&#x27; 与&#x27;/opt/log/vmware-network.6.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.5.log&#x27; 与&#x27;/opt/log/vmware-network.5.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.4.log&#x27; 与&#x27;/opt/log/vmware-network.4.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/error.log&#x27; 与&#x27;/opt/log/error.log&#x27; 为同一文件\r\ncp: &#x27;/opt/log/access.log&#x27; 与&#x27;/opt/log/access.log&#x27; 为同一文件\r\n&quot;,</span><br><span class="line">    &quot;stdout_lines&quot;: [</span><br><span class="line">        &quot;cp: &#x27;/opt/log/home-2b167fc1.log&#x27; 与&#x27;/opt/log/home-2b167fc1.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/root-836d3cf3.log&#x27; 与&#x27;/opt/log/root-836d3cf3.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/audit.log&#x27; 与&#x27;/opt/log/audit.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_implicit_files.log&#x27; 与&#x27;/opt/log/sssd_implicit_files.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_kcm.log&#x27; 与&#x27;/opt/log/sssd_kcm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd_nss.log&#x27; 与&#x27;/opt/log/sssd_nss.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/sssd.log&#x27; 与&#x27;/opt/log/sssd.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/tuned.log&#x27; 与&#x27;/opt/log/tuned.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/anaconda.log&#x27; 与&#x27;/opt/log/anaconda.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/X.log&#x27; 与&#x27;/opt/log/X.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/program.log&#x27; 与&#x27;/opt/log/program.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/packaging.log&#x27; 与&#x27;/opt/log/packaging.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/storage.log&#x27; 与&#x27;/opt/log/storage.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ifcfg.log&#x27; 与&#x27;/opt/log/ifcfg.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/lvm.log&#x27; 与&#x27;/opt/log/lvm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.librepo.log&#x27; 与&#x27;/opt/log/dnf.librepo.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/hawkey.log&#x27; 与&#x27;/opt/log/hawkey.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dbus.log&#x27; 与&#x27;/opt/log/dbus.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-ai28ecf4.log&#x27; 与&#x27;/opt/log/ks-script-ai28ecf4.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/ks-script-k4vgo8wr.log&#x27; 与&#x27;/opt/log/ks-script-k4vgo8wr.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/journal.log&#x27; 与&#x27;/opt/log/journal.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/boot.log&#x27; 与&#x27;/opt/log/boot.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-vmsvc.log&#x27; 与&#x27;/opt/log/vmware-vmsvc.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/Xorg.9.log&#x27; 与&#x27;/opt/log/Xorg.9.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-vmusr.log&#x27; 与&#x27;/opt/log/vmware-vmusr.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.log&#x27; 与&#x27;/opt/log/dnf.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/dnf.rpm.log&#x27; 与&#x27;/opt/log/dnf.rpm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.6.log&#x27; 与&#x27;/opt/log/vmware-network.6.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.5.log&#x27; 与&#x27;/opt/log/vmware-network.5.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.4.log&#x27; 与&#x27;/opt/log/vmware-network.4.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.3.log&#x27; 与&#x27;/opt/log/vmware-network.3.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.2.log&#x27; 与&#x27;/opt/log/vmware-network.2.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.1.log&#x27; 与&#x27;/opt/log/vmware-network.1.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/vmware-network.log&#x27; 与&#x27;/opt/log/vmware-network.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/rpm.log&#x27; 与&#x27;/opt/log/rpm.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/error.log&#x27; 与&#x27;/opt/log/error.log&#x27; 为同一文件&quot;,</span><br><span class="line">        &quot;cp: &#x27;/opt/log/access.log&#x27; 与&#x27;/opt/log/access.log&#x27; 为同一文件&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-6"><a href="#二、学习视频-6" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=22">视频：script模块</a></p>
<h1 id="Ansible-service模块"><a href="#Ansible-service模块" class="headerlink" title="Ansible-service模块"></a>Ansible-service模块</h1><h2 id="一、service模块"><a href="#一、service模块" class="headerlink" title="一、service模块"></a>一、service模块</h2><p>service模块：用于控制服务的启动,关闭,开机自启动等。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/service_module.html#service-module">https://docs.ansible.com/ansible/latest/modules/service_module.html#service-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>服务名称</td>
</tr>
<tr>
<td>state reloaded, restarted, started, stopped</td>
<td>服务管理</td>
</tr>
<tr>
<td>enabled yes|no</td>
<td>开启是否启动</td>
</tr>
</tbody></table>
<p>启动vsftpd服务，并设为开机自动启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m service 192.168.98.202 -a &quot;name=vsftpd state=started enabled=on&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;enabled&quot;: true,</span><br><span class="line">    &quot;name&quot;: &quot;vsftpd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;started&quot;,</span><br><span class="line">    &quot;status&quot;: &#123;</span><br><span class="line">        &quot;ActiveEnterTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ActiveExitTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ActiveState&quot;: &quot;inactive&quot;,</span><br><span class="line">        &quot;After&quot;: &quot;network.target systemd-journald.socket system.slice basic.target sysinit.target&quot;,</span><br><span class="line">        &quot;AllowIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;AmbientCapabilities&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AssertResult&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;AssertTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;Before&quot;: &quot;shutdown.target&quot;,</span><br><span class="line">        &quot;BlockIOAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;BlockIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CPUQuotaPerSecUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;CPUSchedulingPolicy&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;CPUSchedulingPriority&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;CPUSchedulingResetOnFork&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CPUShares&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUUsageNSec&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CacheDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;CanIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CanReload&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CanStart&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;CanStop&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;CapabilityBoundingSet&quot;: &quot;cap_chown cap_dac_override cap_dac_read_search cap_fowner cap_fsetid cap_kill cap_setgid cap_setuid cap_setpcap cap_linux_immutable cap_net_bind_service cap_net_broadcast cap_net_admin cap_net_raw cap_ipc_lock cap_ipc_owner cap_sys_module cap_sys_rawio cap_sys_chroot cap_sys_ptrace cap_sys_pacct cap_sys_admin cap_sys_boot cap_sys_nice cap_sys_resource cap_sys_time cap_sys_tty_config cap_mknod cap_lease cap_audit_write cap_audit_control cap_setfcap cap_mac_override cap_mac_admin cap_syslog cap_wake_alarm cap_block_suspend&quot;,</span><br><span class="line">        &quot;CollectMode&quot;: &quot;inactive&quot;,</span><br><span class="line">        &quot;ConditionResult&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ConditionTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ConfigurationDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;Conflicts&quot;: &quot;shutdown.target&quot;,</span><br><span class="line">        &quot;ControlPID&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;DefaultDependencies&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;Delegate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Description&quot;: &quot;Vsftpd ftp daemon&quot;,</span><br><span class="line">        &quot;DevicePolicy&quot;: &quot;auto&quot;,</span><br><span class="line">        &quot;DynamicUser&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ExecMainCode&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainExitTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainPID&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainStartTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainStatus&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecStart&quot;: &quot;&#123; path=/usr/sbin/vsftpd ; argv[]=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 &#125;&quot;,</span><br><span class="line">        &quot;FailureAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;FileDescriptorStoreMax&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;FragmentPath&quot;: &quot;/usr/lib/systemd/system/vsftpd.service&quot;,</span><br><span class="line">        &quot;GID&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;GuessMainPID&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;IOAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IOSchedulingClass&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;IOSchedulingPriority&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;IOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;IPAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IPEgressBytes&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPEgressPackets&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPIngressBytes&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPIngressPackets&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;vsftpd.service&quot;,</span><br><span class="line">        &quot;IgnoreOnIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IgnoreSIGPIPE&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;InactiveEnterTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;InactiveExitTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;JobRunningTimeoutUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;JobTimeoutAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;JobTimeoutUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;KeyringMode&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;KillMode&quot;: &quot;control-group&quot;,</span><br><span class="line">        &quot;KillSignal&quot;: &quot;15&quot;,</span><br><span class="line">        &quot;LimitAS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitASSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCORE&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCORESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCPU&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCPUSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitDATA&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitDATASoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitFSIZE&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitFSIZESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitLOCKS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitLOCKSSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitMEMLOCK&quot;: &quot;16777216&quot;,</span><br><span class="line">        &quot;LimitMEMLOCKSoft&quot;: &quot;16777216&quot;,</span><br><span class="line">        &quot;LimitMSGQUEUE&quot;: &quot;819200&quot;,</span><br><span class="line">        &quot;LimitMSGQUEUESoft&quot;: &quot;819200&quot;,</span><br><span class="line">        &quot;LimitNICE&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitNICESoft&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitNOFILE&quot;: &quot;4096&quot;,</span><br><span class="line">        &quot;LimitNOFILESoft&quot;: &quot;1024&quot;,</span><br><span class="line">        &quot;LimitNPROC&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitNPROCSoft&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitRSS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRSSSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRTPRIO&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitRTPRIOSoft&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitRTTIME&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRTTIMESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitSIGPENDING&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitSIGPENDINGSoft&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitSTACK&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitSTACKSoft&quot;: &quot;8388608&quot;,</span><br><span class="line">        &quot;LoadState&quot;: &quot;loaded&quot;,</span><br><span class="line">        &quot;LockPersonality&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;LogLevelMax&quot;: &quot;-1&quot;,</span><br><span class="line">        &quot;LogsDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;MainPID&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;MemoryAccounting&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;MemoryCurrent&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;MemoryDenyWriteExecute&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;MemoryHigh&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemoryLimit&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemoryLow&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;MemoryMax&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemorySwapMax&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MountAPIVFS&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;MountFlags&quot;: &quot;&quot;,</span><br><span class="line">        &quot;NFileDescriptorStore&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;NRestarts&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;Names&quot;: &quot;vsftpd.service&quot;,</span><br><span class="line">        &quot;NeedDaemonReload&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Nice&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;NoNewPrivileges&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;NonBlocking&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;NotifyAccess&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;OOMScoreAdjust&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;OnFailureJobMode&quot;: &quot;replace&quot;,</span><br><span class="line">        &quot;PermissionsStartOnly&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Perpetual&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateDevices&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateMounts&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateNetwork&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateTmp&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateUsers&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectControlGroups&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectHome&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectKernelModules&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectKernelTunables&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectSystem&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RefuseManualStart&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RefuseManualStop&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RemainAfterExit&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RemoveIPC&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Requires&quot;: &quot;sysinit.target system.slice&quot;,</span><br><span class="line">        &quot;Restart&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RestartUSec&quot;: &quot;100ms&quot;,</span><br><span class="line">        &quot;RestrictNamespaces&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RestrictRealtime&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Result&quot;: &quot;success&quot;,</span><br><span class="line">        &quot;RootDirectoryStartOnly&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RuntimeDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;RuntimeDirectoryPreserve&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RuntimeMaxUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;SameProcessGroup&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SecureBits&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;SendSIGHUP&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SendSIGKILL&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;Slice&quot;: &quot;system.slice&quot;,</span><br><span class="line">        &quot;StandardError&quot;: &quot;inherit&quot;,</span><br><span class="line">        &quot;StandardInput&quot;: &quot;null&quot;,</span><br><span class="line">        &quot;StandardInputData&quot;: &quot;&quot;,</span><br><span class="line">        &quot;StandardOutput&quot;: &quot;journal&quot;,</span><br><span class="line">        &quot;StartLimitAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;StartLimitBurst&quot;: &quot;5&quot;,</span><br><span class="line">        &quot;StartLimitIntervalUSec&quot;: &quot;10s&quot;,</span><br><span class="line">        &quot;StartupBlockIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupCPUShares&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupCPUWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StateChangeTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;StateDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;StatusErrno&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;StopWhenUnneeded&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SubState&quot;: &quot;dead&quot;,</span><br><span class="line">        &quot;SuccessAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;SyslogFacility&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;SyslogLevel&quot;: &quot;6&quot;,</span><br><span class="line">        &quot;SyslogLevelPrefix&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;SyslogPriority&quot;: &quot;30&quot;,</span><br><span class="line">        &quot;SystemCallErrorNumber&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;TTYReset&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TTYVHangup&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TTYVTDisallocate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TasksAccounting&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;TasksCurrent&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;TasksMax&quot;: &quot;12386&quot;,</span><br><span class="line">        &quot;TimeoutStartUSec&quot;: &quot;1min 30s&quot;,</span><br><span class="line">        &quot;TimeoutStopUSec&quot;: &quot;1min 30s&quot;,</span><br><span class="line">        &quot;TimerSlackNSec&quot;: &quot;50000&quot;,</span><br><span class="line">        &quot;Transient&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Type&quot;: &quot;forking&quot;,</span><br><span class="line">        &quot;UID&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;UMask&quot;: &quot;0022&quot;,</span><br><span class="line">        &quot;UnitFilePreset&quot;: &quot;disabled&quot;,</span><br><span class="line">        &quot;UnitFileState&quot;: &quot;disabled&quot;,</span><br><span class="line">        &quot;UtmpMode&quot;: &quot;init&quot;,</span><br><span class="line">        &quot;WatchdogTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;WatchdogUSec&quot;: &quot;0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关闭vsftpd服务，并设为开机不自动启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m service 192.168.98.202 -a &quot;name=vsftpd state=stopped enabled=false&quot;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;enabled&quot;: false,</span><br><span class="line">    &quot;name&quot;: &quot;vsftpd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;stopped&quot;,</span><br><span class="line">    &quot;status&quot;: &#123;</span><br><span class="line">        &quot;ActiveEnterTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;ActiveEnterTimestampMonotonic&quot;: &quot;89286681247&quot;,</span><br><span class="line">        &quot;ActiveExitTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ActiveState&quot;: &quot;active&quot;,</span><br><span class="line">        &quot;After&quot;: &quot;systemd-journald.socket sysinit.target basic.target system.slice network.target&quot;,</span><br><span class="line">        &quot;AllowIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;AmbientCapabilities&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AssertResult&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;AssertTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;AssertTimestampMonotonic&quot;: &quot;89286676375&quot;,</span><br><span class="line">        &quot;Before&quot;: &quot;multi-user.target shutdown.target&quot;,</span><br><span class="line">        &quot;BlockIOAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;BlockIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CPUQuotaPerSecUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;CPUSchedulingPolicy&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;CPUSchedulingPriority&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;CPUSchedulingResetOnFork&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CPUShares&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUUsageNSec&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CPUWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;CacheDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;CanIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CanReload&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;CanStart&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;CanStop&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;CapabilityBoundingSet&quot;: &quot;cap_chown cap_dac_override cap_dac_read_search cap_fowner cap_fsetid cap_kill cap_setgid cap_setuid cap_setpcap cap_linux_immutable cap_net_bind_service cap_net_broadcast cap_net_admin cap_net_raw cap_ipc_lock cap_ipc_owner cap_sys_module cap_sys_rawio cap_sys_chroot cap_sys_ptrace cap_sys_pacct cap_sys_admin cap_sys_boot cap_sys_nice cap_sys_resource cap_sys_time cap_sys_tty_config cap_mknod cap_lease cap_audit_write cap_audit_control cap_setfcap cap_mac_override cap_mac_admin cap_syslog cap_wake_alarm cap_block_suspend&quot;,</span><br><span class="line">        &quot;CollectMode&quot;: &quot;inactive&quot;,</span><br><span class="line">        &quot;ConditionResult&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;ConditionTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;ConditionTimestampMonotonic&quot;: &quot;89286676375&quot;,</span><br><span class="line">        &quot;ConfigurationDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;Conflicts&quot;: &quot;shutdown.target&quot;,</span><br><span class="line">        &quot;ControlGroup&quot;: &quot;/system.slice/vsftpd.service&quot;,</span><br><span class="line">        &quot;ControlPID&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;DefaultDependencies&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;Delegate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Description&quot;: &quot;Vsftpd ftp daemon&quot;,</span><br><span class="line">        &quot;DevicePolicy&quot;: &quot;auto&quot;,</span><br><span class="line">        &quot;DynamicUser&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ExecMainCode&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainExitTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecMainPID&quot;: &quot;51752&quot;,</span><br><span class="line">        &quot;ExecMainStartTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;ExecMainStartTimestampMonotonic&quot;: &quot;89286681239&quot;,</span><br><span class="line">        &quot;ExecMainStatus&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;ExecStart&quot;: &quot;&#123; path=/usr/sbin/vsftpd ; argv[]=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf ; ignore_errors=no ; start_time=[Fri 2019-10-18 04:13:19 EDT] ; stop_time=[Fri 2019-10-18 04:13:19 EDT] ; pid=51751 ; code=exited ; status=0 &#125;&quot;,</span><br><span class="line">        &quot;FailureAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;FileDescriptorStoreMax&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;FragmentPath&quot;: &quot;/usr/lib/systemd/system/vsftpd.service&quot;,</span><br><span class="line">        &quot;GID&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;GuessMainPID&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;IOAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IOSchedulingClass&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;IOSchedulingPriority&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;IOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;IPAccounting&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IPEgressBytes&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPEgressPackets&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPIngressBytes&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;IPIngressPackets&quot;: &quot;18446744073709551615&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;vsftpd.service&quot;,</span><br><span class="line">        &quot;IgnoreOnIsolate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;IgnoreSIGPIPE&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;InactiveEnterTimestampMonotonic&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;InactiveExitTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;InactiveExitTimestampMonotonic&quot;: &quot;89286677130&quot;,</span><br><span class="line">        &quot;InvocationID&quot;: &quot;e326c69c138b430880f883b0bdb05f83&quot;,</span><br><span class="line">        &quot;JobRunningTimeoutUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;JobTimeoutAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;JobTimeoutUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;KeyringMode&quot;: &quot;private&quot;,</span><br><span class="line">        &quot;KillMode&quot;: &quot;control-group&quot;,</span><br><span class="line">        &quot;KillSignal&quot;: &quot;15&quot;,</span><br><span class="line">        &quot;LimitAS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitASSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCORE&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCORESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCPU&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitCPUSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitDATA&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitDATASoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitFSIZE&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitFSIZESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitLOCKS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitLOCKSSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitMEMLOCK&quot;: &quot;16777216&quot;,</span><br><span class="line">        &quot;LimitMEMLOCKSoft&quot;: &quot;16777216&quot;,</span><br><span class="line">        &quot;LimitMSGQUEUE&quot;: &quot;819200&quot;,</span><br><span class="line">        &quot;LimitMSGQUEUESoft&quot;: &quot;819200&quot;,</span><br><span class="line">        &quot;LimitNICE&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitNICESoft&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitNOFILE&quot;: &quot;4096&quot;,</span><br><span class="line">        &quot;LimitNOFILESoft&quot;: &quot;1024&quot;,</span><br><span class="line">        &quot;LimitNPROC&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitNPROCSoft&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitRSS&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRSSSoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRTPRIO&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitRTPRIOSoft&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;LimitRTTIME&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitRTTIMESoft&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitSIGPENDING&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitSIGPENDINGSoft&quot;: &quot;7741&quot;,</span><br><span class="line">        &quot;LimitSTACK&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;LimitSTACKSoft&quot;: &quot;8388608&quot;,</span><br><span class="line">        &quot;LoadState&quot;: &quot;loaded&quot;,</span><br><span class="line">        &quot;LockPersonality&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;LogLevelMax&quot;: &quot;-1&quot;,</span><br><span class="line">        &quot;LogsDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;MainPID&quot;: &quot;51752&quot;,</span><br><span class="line">        &quot;MemoryAccounting&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;MemoryCurrent&quot;: &quot;577536&quot;,</span><br><span class="line">        &quot;MemoryDenyWriteExecute&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;MemoryHigh&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemoryLimit&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemoryLow&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;MemoryMax&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MemorySwapMax&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;MountAPIVFS&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;MountFlags&quot;: &quot;&quot;,</span><br><span class="line">        &quot;NFileDescriptorStore&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;NRestarts&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;Names&quot;: &quot;vsftpd.service&quot;,</span><br><span class="line">        &quot;NeedDaemonReload&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Nice&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;NoNewPrivileges&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;NonBlocking&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;NotifyAccess&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;OOMScoreAdjust&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;OnFailureJobMode&quot;: &quot;replace&quot;,</span><br><span class="line">        &quot;PermissionsStartOnly&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Perpetual&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateDevices&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateMounts&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateNetwork&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateTmp&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;PrivateUsers&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectControlGroups&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectHome&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectKernelModules&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectKernelTunables&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;ProtectSystem&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RefuseManualStart&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RefuseManualStop&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RemainAfterExit&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RemoveIPC&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Requires&quot;: &quot;system.slice sysinit.target&quot;,</span><br><span class="line">        &quot;Restart&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RestartUSec&quot;: &quot;100ms&quot;,</span><br><span class="line">        &quot;RestrictNamespaces&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RestrictRealtime&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Result&quot;: &quot;success&quot;,</span><br><span class="line">        &quot;RootDirectoryStartOnly&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RuntimeDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;RuntimeDirectoryPreserve&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;RuntimeMaxUSec&quot;: &quot;infinity&quot;,</span><br><span class="line">        &quot;SameProcessGroup&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SecureBits&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;SendSIGHUP&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SendSIGKILL&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;Slice&quot;: &quot;system.slice&quot;,</span><br><span class="line">        &quot;StandardError&quot;: &quot;inherit&quot;,</span><br><span class="line">        &quot;StandardInput&quot;: &quot;null&quot;,</span><br><span class="line">        &quot;StandardInputData&quot;: &quot;&quot;,</span><br><span class="line">        &quot;StandardOutput&quot;: &quot;journal&quot;,</span><br><span class="line">        &quot;StartLimitAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;StartLimitBurst&quot;: &quot;5&quot;,</span><br><span class="line">        &quot;StartLimitIntervalUSec&quot;: &quot;10s&quot;,</span><br><span class="line">        &quot;StartupBlockIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupCPUShares&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupCPUWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StartupIOWeight&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;StateChangeTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;StateChangeTimestampMonotonic&quot;: &quot;89286681247&quot;,</span><br><span class="line">        &quot;StateDirectoryMode&quot;: &quot;0755&quot;,</span><br><span class="line">        &quot;StatusErrno&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;StopWhenUnneeded&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;SubState&quot;: &quot;running&quot;,</span><br><span class="line">        &quot;SuccessAction&quot;: &quot;none&quot;,</span><br><span class="line">        &quot;SyslogFacility&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;SyslogLevel&quot;: &quot;6&quot;,</span><br><span class="line">        &quot;SyslogLevelPrefix&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;SyslogPriority&quot;: &quot;30&quot;,</span><br><span class="line">        &quot;SystemCallErrorNumber&quot;: &quot;0&quot;,</span><br><span class="line">        &quot;TTYReset&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TTYVHangup&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TTYVTDisallocate&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;TasksAccounting&quot;: &quot;yes&quot;,</span><br><span class="line">        &quot;TasksCurrent&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;TasksMax&quot;: &quot;12386&quot;,</span><br><span class="line">        &quot;TimeoutStartUSec&quot;: &quot;1min 30s&quot;,</span><br><span class="line">        &quot;TimeoutStopUSec&quot;: &quot;1min 30s&quot;,</span><br><span class="line">        &quot;TimerSlackNSec&quot;: &quot;50000&quot;,</span><br><span class="line">        &quot;Transient&quot;: &quot;no&quot;,</span><br><span class="line">        &quot;Type&quot;: &quot;forking&quot;,</span><br><span class="line">        &quot;UID&quot;: &quot;[not set]&quot;,</span><br><span class="line">        &quot;UMask&quot;: &quot;0022&quot;,</span><br><span class="line">        &quot;UnitFilePreset&quot;: &quot;disabled&quot;,</span><br><span class="line">        &quot;UnitFileState&quot;: &quot;enabled&quot;,</span><br><span class="line">        &quot;UtmpMode&quot;: &quot;init&quot;,</span><br><span class="line">        &quot;WantedBy&quot;: &quot;multi-user.target&quot;,</span><br><span class="line">        &quot;WatchdogTimestamp&quot;: &quot;Fri 2019-10-18 04:13:19 EDT&quot;,</span><br><span class="line">        &quot;WatchdogTimestampMonotonic&quot;: &quot;89286681246&quot;,</span><br><span class="line">        &quot;WatchdogUSec&quot;: &quot;0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-7"><a href="#二、学习视频-7" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=21">视频：service模块</a></p>
<h1 id="Ansible-setup模块"><a href="#Ansible-setup模块" class="headerlink" title="Ansible-setup模块"></a>Ansible-setup模块</h1><h2 id="一、setup模块"><a href="#一、setup模块" class="headerlink" title="一、setup模块"></a>一、setup模块</h2><p>setup模块用于收集远程主机的基本信息（如操作系统类型,主机名,ip,cpu信息,内存信息等）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">#打印192.168.98.201机器的所有信息</span><br><span class="line">[root@manage01 ~]# ansible -m setup 192.168.98.201</span><br><span class="line"></span><br><span class="line">#使用filter过滤输出</span><br><span class="line">#打印192.168.98.201机器的CPU信息</span><br><span class="line">[root@manage01 ~]# ansible -m setup 192.168.98.201 -a &quot;filter=&#x27;ansible_processor&#x27;&quot;</span><br><span class="line">192.168.98.201 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_processor&quot;: [</span><br><span class="line">            &quot;0&quot;,</span><br><span class="line">            &quot;GenuineIntel&quot;,</span><br><span class="line">            &quot;Intel(R) Core(TM) i7-4870HQ CPU @ 2.50GHz&quot;,</span><br><span class="line">            &quot;1&quot;,</span><br><span class="line">            &quot;GenuineIntel&quot;,</span><br><span class="line">            &quot;Intel(R) Core(TM) i7-4870HQ CPU @ 2.50GHz&quot;,</span><br><span class="line">            &quot;2&quot;,</span><br><span class="line">            &quot;GenuineIntel&quot;,</span><br><span class="line">            &quot;Intel(R) Core(TM) i7-4870HQ CPU @ 2.50GHz&quot;,</span><br><span class="line">            &quot;3&quot;,</span><br><span class="line">            &quot;GenuineIntel&quot;,</span><br><span class="line">            &quot;Intel(R) Core(TM) i7-4870HQ CPU @ 2.50GHz&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">#打印192.168.98.201机器的内核信息</span><br><span class="line">[root@manage01 ~]# ansible -m setup 192.168.98.201 -a &quot;filter=&#x27;ansible_kernel&#x27;&quot;</span><br><span class="line">192.168.98.201 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_kernel&quot;: &quot;4.18.0-80.el8.x86_64&quot;,</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">#打印192.168.98.201机器的主机名</span><br><span class="line">[root@manage01 ~]#  ansible -m setup 192.168.98.201 -a &quot;filter=&#x27;ansible_hostname&#x27;&quot;</span><br><span class="line">192.168.98.201 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_hostname&quot;: &quot;node1&quot;,</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">#打印192.168.98.201机器的网卡信息</span><br><span class="line">[root@manage01 ~]# ansible -m setup 192.168.98.201 -a &quot;filter=&#x27;ansible_ens*&#x27;&quot;</span><br><span class="line">192.168.98.201 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_ens33&quot;: &#123;</span><br><span class="line">            &quot;active&quot;: true,</span><br><span class="line">            &quot;device&quot;: &quot;ens33&quot;,</span><br><span class="line">            &quot;features&quot;: &#123;</span><br><span class="line">                &quot;esp_hw_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;esp_tx_csum_hw_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;fcoe_mtu&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;generic_receive_offload&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;generic_segmentation_offload&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;highdma&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;hw_tc_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;l2_fwd_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;large_receive_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;loopback&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;netns_local&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;ntuple_filters&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;receive_hashing&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;rx_all&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;rx_checksumming&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;rx_fcs&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;rx_gro_hw&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;rx_udp_tunnel_port_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;rx_vlan_filter&quot;: &quot;on [fixed]&quot;,</span><br><span class="line">                &quot;rx_vlan_offload&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;rx_vlan_stag_filter&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;rx_vlan_stag_hw_parse&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;scatter_gather&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tcp_segmentation_offload&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tls_hw_record&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tls_hw_tx_offload&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_checksum_fcoe_crc&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_checksum_ip_generic&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tx_checksum_ipv4&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_checksum_ipv6&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_checksum_sctp&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_checksumming&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tx_esp_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_fcoe_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_gre_csum_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_gre_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_gso_partial&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_gso_robust&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_ipxip4_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_ipxip6_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_lockless&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_nocache_copy&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;tx_scatter_gather&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tx_scatter_gather_fraglist&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_sctp_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_tcp6_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_tcp_ecn_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_tcp_mangleid_segmentation&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;tx_tcp_segmentation&quot;: &quot;on&quot;,</span><br><span class="line">                &quot;tx_udp_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_udp_tnl_csum_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_udp_tnl_segmentation&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;tx_vlan_offload&quot;: &quot;on [fixed]&quot;,</span><br><span class="line">                &quot;tx_vlan_stag_hw_insert&quot;: &quot;off [fixed]&quot;,</span><br><span class="line">                &quot;udp_fragmentation_offload&quot;: &quot;off&quot;,</span><br><span class="line">                &quot;vlan_challenged&quot;: &quot;off [fixed]&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;hw_timestamp_filters&quot;: [],</span><br><span class="line">            &quot;ipv4&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.98.201&quot;,</span><br><span class="line">                &quot;broadcast&quot;: &quot;192.168.98.255&quot;,</span><br><span class="line">                &quot;netmask&quot;: &quot;255.255.255.0&quot;,</span><br><span class="line">                &quot;network&quot;: &quot;192.168.98.0&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;ipv6&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;address&quot;: &quot;fe80::357b:9443:2232:f0c0&quot;,</span><br><span class="line">                    &quot;prefix&quot;: &quot;64&quot;,</span><br><span class="line">                    &quot;scope&quot;: &quot;link&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;macaddress&quot;: &quot;00:0c:29:b8:d0:45&quot;,</span><br><span class="line">            &quot;module&quot;: &quot;e1000&quot;,</span><br><span class="line">            &quot;mtu&quot;: 1500,</span><br><span class="line">            &quot;pciid&quot;: &quot;0000:02:01.0&quot;,</span><br><span class="line">            &quot;promisc&quot;: false,</span><br><span class="line">            &quot;speed&quot;: 1000,</span><br><span class="line">            &quot;timestamping&quot;: [</span><br><span class="line">                &quot;tx_software&quot;,</span><br><span class="line">                &quot;rx_software&quot;,</span><br><span class="line">                &quot;software&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;type&quot;: &quot;ether&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其它常见的过滤条件</span><br><span class="line">ansible_all_ipv4_addresses：显示ipv4的信息。</span><br><span class="line">ansible_devices：显示磁盘设备信息。</span><br><span class="line">ansible_distribution_major_version：显示是系统主版本。</span><br><span class="line">ansible_distribution_version：仅显示系统版本。</span><br><span class="line">ansible_machine：显示系统类型，例：32位，还是64位。</span><br><span class="line">ansible_lvm：显示lvm相关信息。</span><br><span class="line">ansible_memtotal_mb：显示系统总内存。</span><br><span class="line">ansible_memfree_mb：显示可用系统内存。</span><br><span class="line">ansible_memory_mb：详细显示内存情况。</span><br><span class="line">ansible_swaptotal_mb：显示总的swap内存。</span><br><span class="line">ansible_swapfree_mb：显示swap内存的可用内存。</span><br><span class="line">ansible_mounts：显示系统磁盘挂载情况。</span><br><span class="line">ansible_processor：显示cpu个数(具体显示每个cpu的型号)。</span><br><span class="line">ansible_processor_vcpus：显示cpu个数(只显示总的个数)。</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-8"><a href="#二、学习视频-8" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=24">视频：setup模块</a></p>
<h1 id="Ansible-stat模块"><a href="#Ansible-stat模块" class="headerlink" title="Ansible-stat模块"></a>Ansible-stat模块</h1><h2 id="一、stat模块"><a href="#一、stat模块" class="headerlink" title="一、stat模块"></a>一、stat模块</h2><p>stat模块类似linux的stat命令，用于获取文件的状态信息。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/stat_module.html#stat-module">https://docs.ansible.com/ansible/latest/modules/stat_module.html#stat-module</a></p>
<p>获取&#x2F;etc&#x2F;fstab文件的状态信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]#  ansible -m stat 192.168.98.201 -a &quot;path=/etc/fstab&quot;</span><br><span class="line">192.168.98.201 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;stat&quot;: &#123;</span><br><span class="line">        &quot;atime&quot;: 1571386074.1020715,</span><br><span class="line">        &quot;attr_flags&quot;: &quot;&quot;,</span><br><span class="line">        &quot;attributes&quot;: [],</span><br><span class="line">        &quot;block_size&quot;: 4096,</span><br><span class="line">        &quot;blocks&quot;: 8,</span><br><span class="line">        &quot;charset&quot;: &quot;us-ascii&quot;,</span><br><span class="line">        &quot;checksum&quot;: &quot;554e387b5bde93c05baa689312e9a8db5579629e&quot;,</span><br><span class="line">        &quot;ctime&quot;: 1570636725.1020045,</span><br><span class="line">        &quot;dev&quot;: 64768,</span><br><span class="line">        &quot;device_type&quot;: 0,</span><br><span class="line">        &quot;executable&quot;: false,</span><br><span class="line">        &quot;exists&quot;: true,</span><br><span class="line">        &quot;gid&quot;: 0,</span><br><span class="line">        &quot;gr_name&quot;: &quot;root&quot;,</span><br><span class="line">        &quot;inode&quot;: 16777347,</span><br><span class="line">        &quot;isblk&quot;: false,</span><br><span class="line">        &quot;ischr&quot;: false,</span><br><span class="line">        &quot;isdir&quot;: false,</span><br><span class="line">        &quot;isfifo&quot;: false,</span><br><span class="line">        &quot;isgid&quot;: false,</span><br><span class="line">        &quot;islnk&quot;: false,</span><br><span class="line">        &quot;isreg&quot;: true,</span><br><span class="line">        &quot;issock&quot;: false,</span><br><span class="line">        &quot;isuid&quot;: false,</span><br><span class="line">        &quot;mimetype&quot;: &quot;text/plain&quot;,</span><br><span class="line">        &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">        &quot;mtime&quot;: 1570636308.3990006,</span><br><span class="line">        &quot;nlink&quot;: 1,</span><br><span class="line">        &quot;path&quot;: &quot;/etc/fstab&quot;,</span><br><span class="line">        &quot;pw_name&quot;: &quot;root&quot;,</span><br><span class="line">        &quot;readable&quot;: true,</span><br><span class="line">        &quot;rgrp&quot;: true,</span><br><span class="line">        &quot;roth&quot;: true,</span><br><span class="line">        &quot;rusr&quot;: true,</span><br><span class="line">        &quot;size&quot;: 579,</span><br><span class="line">        &quot;uid&quot;: 0,</span><br><span class="line">        &quot;version&quot;: &quot;1364475400&quot;,</span><br><span class="line">        &quot;wgrp&quot;: false,</span><br><span class="line">        &quot;woth&quot;: false,</span><br><span class="line">        &quot;writeable&quot;: true,</span><br><span class="line">        &quot;wusr&quot;: true,</span><br><span class="line">        &quot;xgrp&quot;: false,</span><br><span class="line">        &quot;xoth&quot;: false,</span><br><span class="line">        &quot;xusr&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-9"><a href="#二、学习视频-9" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=25">视频：ansible常用模块知识图谱</a></p>
<h1 id="Ansible-user模块"><a href="#Ansible-user模块" class="headerlink" title="Ansible-user模块"></a>Ansible-user模块</h1><h2 id="一、user模块"><a href="#一、user模块" class="headerlink" title="一、user模块"></a>一、user模块</h2><p>user模块用于管理用户账号和用户属性</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/user_module.html#user-module">https://docs.ansible.com/ansible/latest/modules/user_module.html#user-module</a></p>
<table>
<thead>
<tr>
<th>常用参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name&#x3D;””</td>
<td>指定用户名</td>
</tr>
<tr>
<td>password&#x3D;””</td>
<td>指定密码,必须是密文</td>
</tr>
<tr>
<td>state&#x3D; absent|present</td>
<td>删除|创建</td>
</tr>
<tr>
<td>system&#x3D; yes|no</td>
<td>是否为系统用户</td>
</tr>
<tr>
<td>shell&#x3D;””</td>
<td>指定登陆shell</td>
</tr>
<tr>
<td>generate_ssh_key&#x3D; yes|no</td>
<td>是否创建秘钥对</td>
</tr>
<tr>
<td>uid&#x3D;</td>
<td>指定用户的uid</td>
</tr>
<tr>
<td>append&#x3D; yes|no</td>
<td>用户是否追加到其他组</td>
</tr>
<tr>
<td>group&#x3D;</td>
<td>用户属组</td>
</tr>
<tr>
<td>groups&#x3D;</td>
<td>将现有用户加入到某个组，空值就会把该用户从所有所属组中删除</td>
</tr>
<tr>
<td>create_home&#x3D; yes|no</td>
<td>是否建立家目录</td>
</tr>
<tr>
<td>remove&#x3D; yes|no</td>
<td>删除家目录</td>
</tr>
</tbody></table>
<p><strong>创建一个用户sky，密码是123</strong></p>
<p><strong>要求是系统用户</strong></p>
<p><strong>非交互式登陆</strong></p>
<p><strong>要求生成自己的秘钥对</strong></p>
<p><strong>不创建家目录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#密码必须是密文，所以先要把明文转换一下，生成md5密文</span><br><span class="line">[root@manage01 ~]# echo 123|openssl passwd -1 -stdin</span><br><span class="line">$1$5V.qzSEd$Yr08MU8K.vXeBZcmavypk1</span><br><span class="line">[root@manage01 ~]# ansible -m user group1 -a &#x27;name=sky password=&quot;$1$5V.qzSEd$Yr08MU8K.vXeBZcmavypk1&quot; state=present system=yes shell=/sbin/nologin generate_ssh_key=yes&#x27;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;comment&quot;: &quot;&quot;,</span><br><span class="line">    &quot;create_home&quot;: true,</span><br><span class="line">    &quot;group&quot;: 991,</span><br><span class="line">    &quot;home&quot;: &quot;/home/sky&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;sky&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;NOT_LOGGING_PASSWORD&quot;,</span><br><span class="line">    &quot;shell&quot;: &quot;/sbin/nologin&quot;,</span><br><span class="line">    &quot;ssh_fingerprint&quot;: &quot;2048 SHA256:b2umG0XfPW0cGAFBFDBNBNbtgaY+s1X4cM334JCGGOo ansible-generated on node3 (RSA)&quot;,</span><br><span class="line">    &quot;ssh_key_file&quot;: &quot;/home/sky/.ssh/id_rsa&quot;,</span><br><span class="line">    &quot;ssh_public_key&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIvVcTDxT4GotFYolpPPJUS2XYEmgaxCj/YLXfW2vllXJSfa3TwBLN6kJnPBabVFSYCiGRzci28f/rx4chm9TuVsNx6TozzUpolD+T3vzO/rcLdaIEzw+JYXGtqpaTapuuhm6pdQBx04TLmO3pVWBCdbJum0paMIXwPDcGPGz6JwGXWTdA5AXfvWmOZ5ChwwLDUau84R47FHfj9EisclYM3Yt3WfcVp+waSd23BBRj86jh+veL9BR7OnDmmj7YZkOxAqnU/TjuOW1uiGCB91Flgku7fPR3jmbXXrd+Ql9vWlGe22+xgYYjT4KVzlHAr3lE/HZQu49Vz/N78ZnJ1rX3 ansible-generated on node3&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: true,</span><br><span class="line">    &quot;uid&quot;: 994</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;comment&quot;: &quot;&quot;,</span><br><span class="line">    &quot;create_home&quot;: true,</span><br><span class="line">    &quot;group&quot;: 974,</span><br><span class="line">    &quot;home&quot;: &quot;/home/sky&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;sky&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;NOT_LOGGING_PASSWORD&quot;,</span><br><span class="line">    &quot;shell&quot;: &quot;/sbin/nologin&quot;,</span><br><span class="line">    &quot;ssh_fingerprint&quot;: &quot;2048 SHA256:D2ZhPJV9bdFMtf7EBo3Y5w023xqxDppZxqoe5Z3NVus ansible-generated on node1 (RSA)&quot;,</span><br><span class="line">    &quot;ssh_key_file&quot;: &quot;/home/sky/.ssh/id_rsa&quot;,</span><br><span class="line">    &quot;ssh_public_key&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD1swS5MAox4o2f3rxe9TPz+AFDnB5Jt+X6Yygpphfetfds37SHSP5K4QcAd1SO6OlHopB3x9FQklS3z6C4bfz5trbK/PR9RCzkkzLamC5BKhNXEV2ozj1m2J/F10umZLSvd3ElEJubkyzV383x7sVi5VtQycemoDLiJiWjHTEcKu/I0bSCliODe57nqgM9+5V+nfeih56Vs+vhTGIxqZ/6FZXKGM9iDiI8VokUlMjhOJz5MuFRr4XsgBvtGNyu/bCbjr8QPdDNX/Wl8IZDjLJNHDno8ixc7Bp6ME2hEr9pnpe+DuKJmsAwl+A52E7eAlm/0pp573mZ4ObHRTQwdgQT ansible-generated on node1&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: true,</span><br><span class="line">    &quot;uid&quot;: 976</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;comment&quot;: &quot;&quot;,</span><br><span class="line">    &quot;create_home&quot;: true,</span><br><span class="line">    &quot;group&quot;: 975,</span><br><span class="line">    &quot;home&quot;: &quot;/home/sky&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;sky&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;NOT_LOGGING_PASSWORD&quot;,</span><br><span class="line">    &quot;shell&quot;: &quot;/sbin/nologin&quot;,</span><br><span class="line">    &quot;ssh_fingerprint&quot;: &quot;2048 SHA256:/VBzZUWcHnLOpMNxq9OXIwD/5IkI9r7smp50s6lByZs ansible-generated on node2 (RSA)&quot;,</span><br><span class="line">    &quot;ssh_key_file&quot;: &quot;/home/sky/.ssh/id_rsa&quot;,</span><br><span class="line">    &quot;ssh_public_key&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDT/+8y3omHiWSOS9dX1AYcADRp7ZUszOBqZV0/77TZ7mV5X1/T+cdZrsnwAiNbXosjDQjKj0qtIJQR3rLuCv08DV6gjlP4bzDodSekfh1mbGu9EkDu0HD+qmW0/y5Mb4lJbBCMHCVJFrwBnH2+AfVezTVgcf4NHh4zJvASnSfmecmyfFEDEVZIozd0z8hw8NcgcYn8MeDrMhVN+y3xj0IXKwg6E0NindBuxkMYbwehcQo6Sscx9YdCv05SXVU+FjyPOQNzZZUQkmp+5GDy1dib1m5GJ5yIf8IzOh1FISoKz8/FqORRIEp55NRgrGw3ZU/weK0RL9SkXhUc29gcN1ON ansible-generated on node2&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;,</span><br><span class="line">    &quot;system&quot;: true,</span><br><span class="line">    &quot;uid&quot;: 977</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建用户baishuming  密码为123456</span><br><span class="line">[root@manage01 ~]# echo &quot;123456&quot;|openssl passwd -1 -stdin</span><br><span class="line">$1$BMPgiHeV$GskMFnvqBL17gTe/us5yK.</span><br><span class="line">[root@manage01 ~]# ansible -m user group1 -a &#x27;name=baishuming password=&quot;$1$BMPgiHeV$GskMFnvqBL17gTe/us5yK.&quot; uid=4423&#x27;</span><br><span class="line"></span><br><span class="line">不创建家目录</span><br><span class="line">[root@manage01 ~]# ansible -m user 192.168.98.201 -a &quot;name=baism create_home=no&quot;</span><br><span class="line"></span><br><span class="line">要求属组为root</span><br><span class="line">附加组为sko</span><br></pre></td></tr></table></figure>

<p>用户删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m user 192.168.98.201 -a &quot;name=baishuming1 state=absent remove=yes&quot;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;force&quot;: false, </span><br><span class="line">    &quot;name&quot;: &quot;baishuming1&quot;, </span><br><span class="line">    &quot;remove&quot;: true, </span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-10"><a href="#二、学习视频-10" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=16">视频：user模块</a></p>
<h1 id="Ansible-yum-repository模块"><a href="#Ansible-yum-repository模块" class="headerlink" title="Ansible-yum_repository模块"></a>Ansible-yum_repository模块</h1><h2 id="一、yum-repository模块"><a href="#一、yum-repository模块" class="headerlink" title="一、yum_repository模块"></a>一、yum_repository模块</h2><p>yum_repository模块用于配置yum仓库。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/yum_repository_module.html">https://docs.ansible.com/ansible/latest/modules/yum_repository_module.html</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>仓库名 name.repo 源的名称 [name]</td>
</tr>
<tr>
<td>description</td>
<td>描述</td>
</tr>
<tr>
<td>baseurl</td>
<td>包下载路径</td>
</tr>
<tr>
<td>gpgcheck&#x3D; 1 or 0</td>
<td>包gpg验证</td>
</tr>
<tr>
<td>enabled &#x3D; yes|no</td>
<td>是否开启本源</td>
</tr>
<tr>
<td>state&#x3D; absent</td>
<td>删除源</td>
</tr>
</tbody></table>
<p>增加一个&#x2F;etc&#x2F;yum.repos.d&#x2F;dvd.repo配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m yum_repository group1 -a &quot;name=dvd description=BaseOS baseurl=file:///mnt/BaseOS gpgcheck=0 enabled=yes&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;present&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除某个yum源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m yum_repository group1 -a &quot;name=dvd state=absent&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;repo&quot;: &quot;dvd&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;absent&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-11"><a href="#二、学习视频-11" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=19">视频：yum_repository模块</a></p>
<h1 id="Ansible-yum模块"><a href="#Ansible-yum模块" class="headerlink" title="Ansible-yum模块"></a>Ansible-yum模块</h1><h2 id="一、yum模块"><a href="#一、yum模块" class="headerlink" title="一、yum模块"></a>一、yum模块</h2><p>yum模块用于使用yum命令来实现软件包的安装与卸载。</p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/yum_module.html#yum-module">https://docs.ansible.com/ansible/latest/modules/yum_module.html#yum-module</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>需要安装软件包的名称</td>
</tr>
<tr>
<td>list&#x3D; installed, updates, available and repos</td>
<td>列出已安装 需要更新 可获得的 和 yum源</td>
</tr>
<tr>
<td>state&#x3D; absent removed installed present latest</td>
<td>删除、删除、安装确认、安装确认、安装最新版本</td>
</tr>
</tbody></table>
<p>list:列出包信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m yum group1 -a &quot;list=repos&quot;</span><br><span class="line">192.168.98.201 | FAILED! =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;msg&quot;: &quot;同步仓库 &#x27;dvd&#x27; 缓存失败&quot;,</span><br><span class="line">    &quot;rc&quot;: 1,</span><br><span class="line">    &quot;results&quot;: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">原因就是源不好用，这里是cdrom没有挂载光盘</span><br></pre></td></tr></table></figure>

<p>使用yum安装一个软件（前提:group1的机器上的yum配置都已经OK）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# ansible -m yum group1 -a &quot;name=vsftpd&quot;</span><br><span class="line">192.168.98.203 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;msg&quot;: &quot;&quot;,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Installed: vsftpd&quot;,</span><br><span class="line">        &quot;Installed: vsftpd-3.0.3-28.el8.x86_64&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.202 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;msg&quot;: &quot;&quot;,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Installed: vsftpd&quot;,</span><br><span class="line">        &quot;Installed: vsftpd-3.0.3-28.el8.x86_64&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;msg&quot;: &quot;&quot;,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Installed: vsftpd&quot;,</span><br><span class="line">        &quot;Installed: vsftpd-3.0.3-28.el8.x86_64&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除软件包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]#  ansible -m yum 192.168.98.201 -a &quot;state=absent name=vsftpd&quot;</span><br><span class="line">192.168.98.201 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/libexec/platform-python&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;msg&quot;: &quot;&quot;,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;results&quot;: [</span><br><span class="line">        &quot;Removed: vsftpd-3.0.3-28.el8.x86_64&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、学习视频-12"><a href="#二、学习视频-12" class="headerlink" title="二、学习视频"></a>二、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=20">视频：yum模块</a></p>
<h1 id="Ansible命令用法"><a href="#Ansible命令用法" class="headerlink" title="Ansible命令用法"></a>Ansible命令用法</h1><p>ansible是基于模块工作的，本身没有批量部署的能力。真正具有批量部署的是ansible所运行的模块，ansible只是提供一种框架。</p>
<p>ansible支持的模块非常的多，我们并不需要把每个模块都记住，而只需要熟悉一些常见的模块，其它的模块在需要用到时再查询即可。</p>
<h2 id="一、ansible命令用法"><a href="#一、ansible命令用法" class="headerlink" title="一、ansible命令用法"></a>一、ansible命令用法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ansible 机器  -m 模块名称 -a &#x27;模块参数&#x27;</span><br><span class="line">基本格式为: ansible 操作的机器名或组名 -m 模块名 -a &quot;参数1=值1 参数2=值2&quot;</span><br></pre></td></tr></table></figure>

<p><strong>查看所有支持的模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># ansible-doc -l		</span><br><span class="line">a10_server                                           Manage A10 Networks AX/SoftAX...</span><br><span class="line">a10_server_axapi3                                    Manage A10 Networks AX/SoftAX...</span><br><span class="line">a10_service_group                                    Manage A10 Networks AX/SoftAX...</span><br><span class="line">a10_virtual_server                                   Manage A10 Networks AX/SoftAX...</span><br><span class="line">aci_aaa_user                                         Manage AAA users (aaa:User)</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">如果要查看ping模块的用法，使用下面命令（其它模块以此类推)</span><br><span class="line"># ansible-doc ping</span><br></pre></td></tr></table></figure>

<p>官网模块文档地址: <a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html">https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html</a></p>
<h2 id="二、ansible常见模块"><a href="#二、ansible常见模块" class="headerlink" title="二、ansible常见模块"></a>二、ansible常见模块</h2><ul>
<li>hostname模块</li>
<li>file模块</li>
<li>copy模块</li>
<li>fetch模块</li>
<li>user模块</li>
<li>group模块</li>
<li>cron模块</li>
<li>yum_repository模块</li>
<li>yum模块</li>
<li>service模块</li>
<li>script模块</li>
<li>command模块</li>
<li>shell模块</li>
<li>setup模块</li>
<li>stat模块</li>
</ul>
<h2 id="三、学习视频-1"><a href="#三、学习视频-1" class="headerlink" title="三、学习视频"></a>三、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=11">视频：ansible 命令语法与常见模块介绍</a></p>
<h1 id="Ansible运维自动化平台初识"><a href="#Ansible运维自动化平台初识" class="headerlink" title="Ansible运维自动化平台初识"></a>Ansible运维自动化平台初识</h1><h2 id="一、运维自动化平台介绍"><a href="#一、运维自动化平台介绍" class="headerlink" title="一、运维自动化平台介绍"></a>一、运维自动化平台介绍</h2><h3 id="1-1、自动化运维平台介绍"><a href="#1-1、自动化运维平台介绍" class="headerlink" title="1.1、自动化运维平台介绍"></a>1.1、自动化运维平台介绍</h3><p>运维自动化平台是由管理机器[S]和业务机器[C]组成的,C&#x2F;S。</p>
<p>管理机器：任务定制及发布；</p>
<p>业务机器：接收任务并执行任务。</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601965978453.png" alt="运维自动化平台组成.png"></p>
<h3 id="1-2、运维自动化平台的优势："><a href="#1-2、运维自动化平台的优势：" class="headerlink" title="1.2、运维自动化平台的优势："></a>1.2、运维自动化平台的优势：</h3><ul>
<li>一次性任务定制：任务一次性发布给所有机器</li>
<li>节省任务执行时间：任务主机并发完成任务，节省部署时间</li>
<li>错误率低：避免重复，保证一次任务定制准确即可</li>
</ul>
<h2 id="二、常见的自动化运维工具"><a href="#二、常见的自动化运维工具" class="headerlink" title="二、常见的自动化运维工具"></a>二、常见的自动化运维工具</h2><h3 id="2-1、常见的运维自动化工具"><a href="#2-1、常见的运维自动化工具" class="headerlink" title="2.1、常见的运维自动化工具"></a>2.1、常见的运维自动化工具</h3><ul>
<li><strong>Puppet</strong></li>
<li><strong>Ansible</strong></li>
<li><strong>SaltStack</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">puppet：</span><br><span class="line">基于Ruby开发，有产品线已经在用，优点是历史悠久，比较成熟，在可远程可本地，功能强劲，批量执行需要写专门的配置文件，费力费时。而且有客户端在，和授权系统结合比较麻烦。</span><br><span class="line"></span><br><span class="line">saltstack:</span><br><span class="line">saltstack和ansible都是python流的，而且就功能上来讲，两者也极为相似，不同之处是salt stack是有客户端的，并且execution模块还用0MQ实现了pub-sub，命令和执行结果因此可以高效并行传输，不过成也萧何败也萧何，第一个sub阶段（将querystring下发到所有机器，然后收集机器响应的阶段）太依赖与客户端返回了，如果客户端未能及时返回或未响应的话，playbook执行阶段可能会直接漏掉这部分机器而没有任何提示，这对于运维来说是不可接受的。</span><br><span class="line"></span><br><span class="line">ansible:</span><br><span class="line">与前两者比起来，在特性上似乎并不抢眼，配置管理方面（playbook）绝对比不过老大哥puppet，批量执行方面也只是多线程，不像saltstack那么高大上，不过ansible搜索热度高出saltstack三倍多，显然靠的不是吹牛，至少，ansible至少不会悄悄的丢机器，这给了我们一个定心丸，而且仅依赖ssh，与登录授权管理系统天然集成，简单即有效，没有比这更美妙的事情了。</span><br></pre></td></tr></table></figure>

<h3 id="2-2、ansible介绍"><a href="#2-2、ansible介绍" class="headerlink" title="2.2、ansible介绍"></a>2.2、ansible介绍</h3><p>ansible是一种由Python开发的自动化运维工具，集合了众多运维工具（puppet、cfengine、chef、func、fabric）的优点，实现了批量系统配置、批量程序部署、批量运行命令等功能。<strong>ansible是基于模块工作的，本身没有批量部署的能力</strong>。<strong>真正具有批量部署的是ansible所运行的模块，ansible只是提供一种框架</strong>。主要包括：</p>
<ol>
<li>连接插件connection plugins：负责和被监控端实现通信；<strong>ansible管理端和客户端基于ssh协议通信</strong></li>
<li>host inventory：指定操作的主机，是一个配置文件里面定义监控的主机；<strong>提供主机管理列表，定义管理谁</strong></li>
<li>各种模块核心模块、command模块、自定义模块；<strong>提供了日常模块</strong></li>
<li>借助于插件完成记录日志邮件等功能； <strong>根据需求后续添加模块，邮件、日志模块</strong></li>
<li>playbook：剧本执行多个任务时，非必需可以让节点一次性运行多个任务。<strong>一次发布多条指令给客户端</strong></li>
</ol>
<p><strong>特性</strong></p>
<ol>
<li>no agents：不需要在被管控主机上安装任何客户端；</li>
<li>no server：无服务器端，使用时直接运行命令即可；</li>
<li>modules in any languages：基于模块工作，可使用任意语言开发模块；</li>
<li>yaml，not code：使用yaml语言定制剧本playbook；</li>
<li>ssh by default：基于SSH工作；</li>
<li>strong multi-tier solution：可实现多级指挥。</li>
</ol>
<p><strong>优点</strong></p>
<ol>
<li>轻量级，无需在客户端安装agent，更新时，只需在操作机上进行一次更新即可；</li>
<li>批量任务执行可以写成脚本，而且不用分发到远程就可以执行；</li>
<li>使用python编写，维护更简单，ruby语法过于复杂；</li>
<li>支持sudo</li>
</ol>
<p><strong>基本架构</strong></p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601966026674.png" alt="ansible3.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">· 核心引擎：即ansible</span><br><span class="line">· 核心模块（core modules）：这些都是ansible自带的模块，ansible模块资源分发到远程节点使其执行特定任务或匹配一个特定的状态。</span><br><span class="line">· 自定义模块（custom modules）：如果核心模块不足以完成某种功能，可以添加自定义模块。</span><br><span class="line">· 插件（plugins）：完成模块功能的补充，借助于插件完成记录日志、邮件等功能</span><br><span class="line">· 剧本（playbook）：定义ansible任务的配置文件，可以将多个任务定义在一个剧本中，由ansible自动执行，剧本执行支持多个任务，可以由控制主机运行多个任务，同时对多台远程主机进行管理。</span><br><span class="line">· playbook是ansible的配置、部署和编排语言，可以描述一个你想要的远程系统执行策略，或一组步骤的一般过程。如果ansible模块作为你的工作室工具，playbook就是设计方案。在基本层面上，剧本可以用于管理配置和部署远程机器。在更高级的应用中，可以序列多层应用及滚动更新，并可以把动作委托给其他主机，与监控服务器和负载平衡器交互。</span><br><span class="line">· 连接插件（connection plugins）：ansible基于连接插件连接到各个主机上，负责和被管理节点实现通信。虽然ansible是使用ssh连接到各被管理节点，但它还支持其他的连接方法，所以需要有连接插件。</span><br><span class="line">· 主机清单（host inventory）：定义ansible管理的主机策略，默认是在ansible的hosts配置文件中定义被管节点，同时也支持自定义动态主机清单和指定配置文件路径。</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>ansible采用paramiko协议库（Fabric也使用这个，基于python开发，支持SSHV2），通过ssh或者ZeroMQ等连接主机。ansible在控制主机主机将ansible模块通过ssh协议（或者Kerberos、LDAP）推送到被管节点执行，执行完之后自动删除。控制主机与被管理节点之间支持local、SSH、ZeroMQ三种连接方式，默认使用基于SSH的连接。在规模较大的情况下使用ZeroMQ连接方式会明显改善执行速度。</p>
<h2 id="三、ansible运行原理"><a href="#三、ansible运行原理" class="headerlink" title="三、ansible运行原理"></a>三、ansible运行原理</h2><p>ansible是如何工作的呢？我们通过一个图片来说明一下</p>
<p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/6/1601966060853.png" alt="ansible工作原理1132928.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">工作原理：</span><br><span class="line">1、用户登录管理机器：通过ansible剧本或者单行命令针对业务机器组或者单个机器部署任务</span><br><span class="line"></span><br><span class="line">2、管理机器读取用户的部署任务：根据自己hosts文件中定义的业务机器组查找对应的机器地址(ip或者域名)</span><br><span class="line"></span><br><span class="line">3、管理机下发任务：管理机通过ssh免密连接业务机器，下发任务给业务机器</span><br><span class="line"></span><br><span class="line">4、业务机器执行任务</span><br><span class="line"></span><br><span class="line">5、业务机器将执行结果发送给ansible管理机器</span><br><span class="line">	反馈字体颜色</span><br><span class="line">	绿色  未发生变化</span><br><span class="line">	黄色  更改生效</span><br><span class="line">	红色  执行错误</span><br></pre></td></tr></table></figure>

<h2 id="四、学习视频"><a href="#四、学习视频" class="headerlink" title="四、学习视频"></a>四、学习视频</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM/">视频：ansible课程介绍</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=2">视频：自动化运维平台课程介绍</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=3">视频：自动化运维平台介绍</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=4">视频：ansible介绍</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19J41167sM?p=5">视频：ansible工作原理</a></p>
<h1 id="Ansible自动化运维平台部署"><a href="#Ansible自动化运维平台部署" class="headerlink" title="Ansible自动化运维平台部署"></a>Ansible自动化运维平台部署</h1><h2 id="一、部署前准备"><a href="#一、部署前准备" class="headerlink" title="一、部署前准备"></a>一、部署前准备</h2><ul>
<li>部署机器准备</li>
<li>计算机名解析</li>
<li>关闭防火墙、selinux</li>
<li>时间同步</li>
<li>软件包获得</li>
<li>ssh免密登陆</li>
</ul>
<p><strong>约定事项：</strong></p>
<ol>
<li><p>所有服务器全部采用静态ip</p>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>manage01</td>
<td>192.168.98.200&#x2F;24</td>
</tr>
<tr>
<td>node1</td>
<td>192.168.98.201&#x2F;24</td>
</tr>
<tr>
<td>node2</td>
<td>192.168.98.202&#x2F;24</td>
</tr>
<tr>
<td>node3</td>
<td>192.168.98.203&#x2F;24</td>
</tr>
</tbody></table>
</li>
<li><p>主机名及主机名互相绑定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost</span><br><span class="line">::1         localhost </span><br><span class="line">192.168.98.200	manage01</span><br><span class="line">192.168.98.201	node1</span><br><span class="line">192.168.98.202	node2</span><br><span class="line">192.168.98.203	node3</span><br><span class="line"></span><br><span class="line">其他机器同理</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭防火墙, selinux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# systemctl disable firewalld</span><br><span class="line">[root@manage01 ~]# sed -i -r &#x27;/SELINUX=/c\SELINUX=disabled&#x27; /etc/selinux/config</span><br><span class="line">[root@manage01 ~]# reboot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其他机器同理</span><br></pre></td></tr></table></figure>
</li>
<li><p>采用时间服务器，时间同步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1、修改配置文件，配置时间服务器为阿里云的时间服务器</span><br><span class="line">[root@manage01 ~]# egrep &quot;^server&quot; /etc/chrony.conf </span><br><span class="line">server ntp1.aliyun.com</span><br><span class="line">server ntp2.aliyun.com</span><br><span class="line">server ntp3.aliyun.com</span><br><span class="line">server ntp4.aliyun.com</span><br><span class="line"></span><br><span class="line">#注释</span><br><span class="line"># pool 2.centos.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line">2、重启服务chronyd</span><br><span class="line">[root@manage01 ~]# systemctl restart chronyd.service </span><br><span class="line"></span><br><span class="line">3、查看源信息</span><br><span class="line">#chronyc chrony的命令行客户端</span><br><span class="line">[root@manage01 ~]# chronyc sources -v</span><br><span class="line">210 Number of sources = 2</span><br><span class="line"></span><br><span class="line">  .-- Source mode  &#x27;^&#x27; = server, &#x27;=&#x27; = peer, &#x27;#&#x27; = local clock.</span><br><span class="line"> / .- Source state &#x27;*&#x27; = current synced, &#x27;+&#x27; = combined , &#x27;-&#x27; = not combined,</span><br><span class="line">| /   &#x27;?&#x27; = unreachable, &#x27;x&#x27; = time may be in error, &#x27;~&#x27; = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^? 120.25.115.20                 2   6     1     3   +663us[ +663us] +/-   23ms</span><br><span class="line">^? 203.107.6.88                  2   6     1     2  -1326us[-1326us] +/-   17ms</span><br></pre></td></tr></table></figure>
</li>
<li><p>确认和配置yum源(需要epel源)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@manage01 ~]# yum -y install epel-*</span><br></pre></td></tr></table></figure>

<p>6.ssh远程连接</p>
<p>管理端和被管理端连接时基于ssh的，所以有两种连接方式</p>
<p>1）基于ssh口令</p>
<p>2）基于ssh证书（重点讲解）</p>
<p>如果想不需要运维人员干预，被管理端必须允许管理端证书免密登陆。</p>
</li>
<li><p>&#96;&#96;&#96;<br>#管理端manage01生成ssh公私钥<br>[root@manage01 ~]# ssh-keygen<br>Generating public&#x2F;private rsa key pair.<br>Enter file in which to save the key (&#x2F;root&#x2F;.ssh&#x2F;id_rsa):<br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa.<br>Your public key has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub.<br>The key fingerprint is:<br>SHA256:aufJno2QjPK&#x2F;V63&#x2F;PVW13h5oWlKu0jk7HesXYTho0gM root@manage01<br>The key’s randomart image is:<br>+—[RSA 2048]—-+<br>|                 |<br>|         E      .|<br>|          o . . o|<br>|         . &#x3D; + +.|<br>|        S o.+ &#x3D; +|<br>|     o o  …* +o|<br>|  . . * ….O o.+|<br>|   o . &#x3D;.<em>.B o +.|<br>|    ..o+B oo</em>oo o|<br>+—-[SHA256]—–+</p>
<p>#将公钥传给node1<br>[root@manage01 ~]# ssh-copy-id -i .ssh&#x2F;id_rsa.pub <a href="mailto:&#x72;&#111;&#x6f;&#116;&#64;&#x31;&#57;&#x32;&#46;&#x31;&#x36;&#56;&#46;&#57;&#56;&#x2e;&#x32;&#x30;&#x31;">&#x72;&#111;&#x6f;&#116;&#64;&#x31;&#57;&#x32;&#46;&#x31;&#x36;&#56;&#46;&#57;&#56;&#x2e;&#x32;&#x30;&#x31;</a><br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: Source of key(s) to be installed: “.ssh&#x2F;id_rsa.pub”<br>The authenticity of host ‘192.168.98.201 (192.168.98.201)’ can’t be established.<br>ECDSA key fingerprint is SHA256:u+yOQz+E+eF7Oixdz&#x2F;vClLXlAEu&#x2F;7K8jy783gzk20dQ.<br>ECDSA key fingerprint is MD5:c0:80:1b:ae:93:32:c2:66:f5:da:2f:1c:26:1e:7e:f8.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br><a href="mailto:&#x72;&#x6f;&#x6f;&#116;&#x40;&#49;&#57;&#x32;&#46;&#x31;&#54;&#56;&#46;&#57;&#56;&#46;&#x32;&#x30;&#x31;">&#x72;&#x6f;&#x6f;&#116;&#x40;&#49;&#57;&#x32;&#46;&#x31;&#54;&#56;&#46;&#57;&#56;&#46;&#x32;&#x30;&#x31;</a>‘s password: </p>
<p>Number of key(s) added: 1</p>
<p>Now try logging into the machine, with:   “ssh ‘<a href="mailto:&#114;&#111;&#111;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#x38;&#46;&#57;&#x38;&#x2e;&#x32;&#48;&#x31;">&#114;&#111;&#111;&#x74;&#64;&#49;&#x39;&#50;&#x2e;&#49;&#54;&#x38;&#46;&#57;&#x38;&#x2e;&#x32;&#48;&#x31;</a>‘“<br>and check to make sure that only the key(s) you wanted were added.</p>
<p>#将公钥传给node2<br>[root@manage01 ~]# ssh-copy-id -i .ssh&#x2F;id_rsa.pub <a href="mailto:&#114;&#111;&#111;&#116;&#x40;&#49;&#x39;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#57;&#x38;&#x2e;&#50;&#48;&#x32;">&#114;&#111;&#111;&#116;&#x40;&#49;&#x39;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#57;&#x38;&#x2e;&#50;&#48;&#x32;</a><br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: Source of key(s) to be installed: “.ssh&#x2F;id_rsa.pub”<br>The authenticity of host ‘192.168.98.202 (192.168.98.202)’ can’t be established.<br>ECDSA key fingerprint is SHA256:X4JeiiFuwV0cja81veAyGCosriEfZm&#x2F;zv34cfYkuxmU.<br>ECDSA key fingerprint is MD5:7d:17:0f:80:d5:2b:30:ec:2c:62:f9:79:6b:fb:5f:bc.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br><a href="mailto:&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#x2e;&#57;&#56;&#46;&#50;&#48;&#50;">&#114;&#111;&#x6f;&#116;&#64;&#x31;&#x39;&#50;&#46;&#x31;&#x36;&#x38;&#x2e;&#57;&#56;&#46;&#50;&#48;&#50;</a>‘s password: </p>
<p>Number of key(s) added: 1</p>
<p>Now try logging into the machine, with:   “ssh ‘<a href="mailto:&#114;&#111;&#111;&#x74;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#x36;&#56;&#x2e;&#57;&#x38;&#x2e;&#x32;&#48;&#50;">&#114;&#111;&#111;&#x74;&#x40;&#x31;&#x39;&#x32;&#46;&#x31;&#x36;&#56;&#x2e;&#57;&#x38;&#x2e;&#x32;&#48;&#50;</a>‘“<br>and check to make sure that only the key(s) you wanted were added.</p>
<p>#将公钥传给node3<br>[root@manage01 ~]# ssh-copy-id -i .ssh&#x2F;id_rsa.pub <a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#x32;&#46;&#49;&#x36;&#56;&#x2e;&#x39;&#56;&#46;&#x32;&#x30;&#x33;">&#114;&#x6f;&#x6f;&#116;&#x40;&#49;&#x39;&#x32;&#46;&#49;&#x36;&#56;&#x2e;&#x39;&#56;&#46;&#x32;&#x30;&#x33;</a><br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: Source of key(s) to be installed: “.ssh&#x2F;id_rsa.pub”<br>The authenticity of host ‘192.168.98.203 (192.168.98.203)’ can’t be established.<br>ECDSA key fingerprint is SHA256:PtpsYBjaXkE+o3j8QYU5Ju8uPgcW2lVW8wsx4X1PV&#x2F;c.<br>ECDSA key fingerprint is MD5:50:a1:63:a0:ef:e7:61:26:11:25:ae:06:ec:93:cb:18.<br>Are you sure you want to continue connecting (yes&#x2F;no)? yes<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>&#x2F;usr&#x2F;bin&#x2F;ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br><a href="mailto:&#114;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#x31;&#x36;&#56;&#46;&#x39;&#x38;&#x2e;&#50;&#48;&#51;">&#114;&#x6f;&#111;&#116;&#64;&#x31;&#57;&#50;&#46;&#x31;&#x36;&#56;&#46;&#x39;&#x38;&#x2e;&#50;&#48;&#51;</a>‘s password: </p>
<p>Number of key(s) added: 1</p>
<p>Now try logging into the machine, with:   “ssh ‘<a href="mailto:&#x72;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#x32;&#46;&#x31;&#54;&#56;&#46;&#57;&#56;&#46;&#x32;&#x30;&#51;">&#x72;&#x6f;&#x6f;&#116;&#x40;&#x31;&#57;&#x32;&#46;&#x31;&#54;&#56;&#46;&#57;&#56;&#46;&#x32;&#x30;&#51;</a>‘“<br>and check to make sure that only the key(s) you wanted were added.</p>
<p>小窍门<br>免交互创建公私钥<br>[root@manage01 ansible]# ssh-keygen -f &#x2F;root&#x2F;.ssh&#x2F;id_rsa -N “”<br>-f 指定密钥存放路径<br>-N “”  新密码设置问空<br>-P “”  老密码是什么</p>
<p>如何可以非交互式传公钥呢<br>[root@manage01 ansible]# yum -y install sshpass<br>[root@manage01 ansible]# sshpass -p111111 ssh-copy-id -o StrictHostKeyChecking&#x3D;no -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub <a href="mailto:&#x72;&#111;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#x39;&#x38;&#46;&#50;&#x30;&#50;">&#x72;&#111;&#x6f;&#116;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#x39;&#x38;&#46;&#50;&#x30;&#50;</a> </p>
<p>StrictHostKeyChecking   严厉的主机监测&#x3D;no  就不会问你yes|no了<br>sshpass 非交互式传密码</p>
<p>测试证书是否生效<br>[root@manage01 ~]# for i in <code>seq 201 203</code>;do</p>
<blockquote>
<p>ssh <a href="mailto:&#114;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#57;&#56;">&#114;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#46;&#49;&#54;&#x38;&#x2e;&#57;&#56;</a>.$i “hostname”<br>done<br>node1<br>node2<br>node3</p>
</blockquote>
<p>看到返回客户端的计算机名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 二、ansible管理端部署</span><br><span class="line"></span><br><span class="line">### 2.1）管理端安装ansible</span><br><span class="line"></span><br><span class="line">安装方式:</span><br><span class="line"></span><br><span class="line">1）yum</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<p>[root@manage01 ~]# yum -y install ansible<br>[root@manage01 ~]# ansible –version<br>ansible 2.8.5<br>  config file &#x3D; &#x2F;etc&#x2F;ansible&#x2F;ansible.cfg<br>  configured module search path &#x3D; [‘&#x2F;root&#x2F;.ansible&#x2F;plugins&#x2F;modules’, ‘&#x2F;usr&#x2F;share&#x2F;ansible&#x2F;plugins&#x2F;modules’]<br>  ansible python module location &#x3D; &#x2F;usr&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;ansible<br>  executable location &#x3D; &#x2F;usr&#x2F;bin&#x2F;ansible<br>  python version &#x3D; 3.6.8 (default, May 21 2019, 23:51:36) [GCC 8.2.1 20180905 (Red Hat 8.2.1-3)]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2） 源码</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1、官网下载地址：<a target="_blank" rel="noopener" href="https://releases.ansible.com/ansible">https://releases.ansible.com/ansible</a><br>[root@manage01 ~]# wget <a target="_blank" rel="noopener" href="https://releases.ansible.com/ansible/ansible-2.9.3.tar.gz">https://releases.ansible.com/ansible/ansible-2.9.3.tar.gz</a><br>2、安装ansible<br>[root@manage01 ~]# tar xf ansible-2.9.3.tar.gz<br>[root@manage01 ~]# mv ansible-2.9.3 &#x2F;opt&#x2F;ansible<br>[root@manage01 ~]# cd &#x2F;opt&#x2F;ansible-2.9.3<br>#python软件包安装–1、安装依赖<br>[root@manage01 ansible-2.9.0rc3]# pip3 install -r requirements.txt -i <a target="_blank" rel="noopener" href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a><br>[root@manage01 ansible]# ln -s &#x2F;usr&#x2F;bin&#x2F;pip3 &#x2F;usr&#x2F;bin&#x2F;pip<br>#python软件包安装–2、安装软件<br>[root@manage01 ansible-2.9.0rc3]# pip install –user ansible -i <a target="_blank" rel="noopener" href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a></p>
<p>#安装后设置<br>[root@manage01 ~]# ln -s &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;python<br>[root@manage01 ~]# ln -s &#x2F;opt&#x2F;ansible&#x2F;bin&#x2F;* &#x2F;usr&#x2F;bin&#x2F;<br>[root@manage01 ~]# cp &#x2F;opt&#x2F;ansible&#x2F;examples&#x2F;ansible.cfg &#x2F;etc&#x2F;ansible&#x2F;<br>[root@manage01 ~]# cp &#x2F;opt&#x2F;ansible&#x2F;examples&#x2F;hosts &#x2F;etc&#x2F;ansible&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**FAQ1**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@manage01 ansible-2.9.0rc3]# .&#x2F;bin&#x2F;ansible -m ping 192.168.98.201<br> [WARNING]: No inventory was parsed, only implicit localhost is available</p>
<p> [WARNING]: provided hosts list is empty, only localhost is available. Note that<br>the implicit localhost does not match ‘all’</p>
<p> [WARNING]: Could not match supplied host pattern, ignoring: 192.168.98.201</p>
<p> 触发原因<br> 执行ansible的时候回去读取客户端文件hosts，如果没有把客户端加入到hosts文件，就说明无法ansible无法管理。</p>
<p> 解决方案<br> [root@manage01 ansible]# mkdir &#x2F;etc&#x2F;ansible<br> [root@manage01 ansible]# cp examples&#x2F;hosts &#x2F;etc&#x2F;ansible&#x2F;<br> #将需要管理的客户端IP地址写入hosts文件,可以分组或者直接写<br> [root@manage01 ~]# cat &#x2F;etc&#x2F;ansible&#x2F;hosts<br> 192.168.98.[201:203]</p>
<p> 分组<br> [group1]<br>192.168.98.[201:203]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.2）ansible管理服务器部署</span><br><span class="line"></span><br><span class="line">管理端ansible目录：/etc/ansible</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@manage01 ansible]# tree<br>.<br>├── ansible.cfg           #ansible配置文件,不需要配置<br>├── hosts									#主机列表<br>└── roles                 #角色列表</p>
<p>1 directory, 2 files</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.3）部署主机列表，定义被监控机</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>[root@manage01 ansible]# egrep -v “(^#|^$)” &#x2F;etc&#x2F;ansible&#x2F;hosts<br>[group1]					#名字可以随便起  后面跟上业务机器的IP地址或者域名<br>192.168.98.201<br>192.168.98.202<br>192.168.98.203</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**关于业务机器分组**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分组中使用范围<br>[nginx]					组名<br>apache[1:10].aaa.com	表示apache1.aaa.com到apache10.aaa.com这10台机器<br>nginx[a:z].aaa.com		表示nginxa.aaa.com到nginxz.aaa.com共26台机器<br>10.1.1.[11:15]			表示10.1.1.11到10.1.1.15这5台机器</p>
<p>如果业务机器的SSH端口不是22<br>10.1.1.13:2222			表示10.1.1.13这台，但ssh端口为2222</p>
<p>指定业务机器别名，未做免密登陆的机器可以通过下面的机器设置账号密码<br>nginx1  ansible_ssh_host&#x3D;10.1.1.13 ansible_ssh_port&#x3D;2222 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;”123456”</p>
<p>ansible_ssh_host  指定业务机器的IP或域名<br>ansible_ssh_port  指定业务机器的ssh端口<br>ansible_ssh_user  指定业务机器的ssh用户名<br>ansible_ssh_pass  指定业务机器的ssh用户名密码</p>
<p>利用机器别名分组<br>nginx1  ansible_ssh_host&#x3D;10.1.1.13 ansible_ssh_port&#x3D;2222 ansible_ssh_user&#x3D;root ansible_ssh_pass&#x3D;”123456”<br>nginx2  ansible_ssh_host&#x3D;10.1.1.12</p>
<p>[nginx]<br>nginx1    #写服务器别名<br>nginx2</p>
<p>[root@manage01 ansible]# egrep -v “(^#|^$)” &#x2F;etc&#x2F;ansible&#x2F;hosts<br>#别名定义<br>web1 ansible_ssh_host&#x3D;192.168.98.203 ansible_ssh_port&#x3D;12121</p>
<p>#分组<br>[group1]<br>192.168.98.201<br>#未做免密登陆机器<br>192.168.98.202:12121 ansible_ssh_user&#x3D;sko ansible_ssh_pass&#x3D;’123’<br>#别名机器<br>web1 ansible_ssh_user&#x3D;sko ansible_ssh_pass&#x3D;’123’</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.4）测试管理机和业务机器的联通性</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们可以使用ansible通过调用ping模块来测试分组机器或某个机器<br>-m 指定使用的模块   group1  业务机器分组<br>#测试单个机器<br>#测试主机列表中的机器</p>
<p>#测试单个机器方法<br>[root@manage01 ~]# ansible -m ping 192.168.98.201<br>192.168.98.201 | SUCCESS &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;libexec&#x2F;platform-python”<br>    },<br>    “changed”: false,<br>    “ping”: “pong”<br>}</p>
<p>#测试主机列表中的机器方法<br>[root@manage01 ~]# ansible -m ping group1<br>192.168.98.201 | SUCCESS &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;libexec&#x2F;platform-python”<br>    },<br>    “changed”: false,<br>    “ping”: “pong”<br>}<br>192.168.98.203 | SUCCESS &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;libexec&#x2F;platform-python”<br>    },<br>    “changed”: false,<br>    “ping”: “pong”<br>}<br>192.168.98.202 | SUCCESS &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;libexec&#x2F;platform-python”<br>    },<br>    “changed”: false,<br>    “ping”: “pong”<br>}</p>
<pre><code>
## 三、学习视频

[视频：部署前准备](https://www.bilibili.com/video/BV19J41167sM?p=6)
[视频：ssh证书互信设置](https://www.bilibili.com/video/BV19J41167sM?p=7)
[视频：ansible平台部署](https://www.bilibili.com/video/BV19J41167sM?p=8)
[视频：主机列表文件hosts文件](https://www.bilibili.com/video/BV19J41167sM?p=9)
[视频：ansible自动化平台部署知识图谱](https://www.bilibili.com/video/BV19J41167sM?p=10)
</code></pre>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/09/gcp-cdl-2-Cloud-Platform-Services/" rel="prev" title="gcp-cdl-2.Cloud-Platform-Services">
      <i class="fa fa-chevron-left"></i> gcp-cdl-2.Cloud-Platform-Services
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/12/CI%E5%92%8CCD%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0/" rel="next" title="CI和CD代码管理平台">
      CI和CD代码管理平台 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ansible-command%E4%B8%8Eshell%E6%A8%A1%E5%9D%97"><span class="nav-number">1.</span> <span class="nav-text">ansible command与shell模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81shell%E6%A8%A1%E5%9D%97"><span class="nav-number">1.1.</span> <span class="nav-text">一、shell模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81command%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.</span> <span class="nav-text">二、command模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91"><span class="nav-number">1.3.</span> <span class="nav-text">三、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#copy%E6%A8%A1%E5%9D%97"><span class="nav-number">2.</span> <span class="nav-text">copy模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81copy%E6%A8%A1%E5%9D%97-%E9%87%8D%E7%82%B9"><span class="nav-number">2.1.</span> <span class="nav-text">一、copy模块(重点)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91"><span class="nav-number">2.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#cron%E6%A8%A1%E5%9D%97"><span class="nav-number">3.</span> <span class="nav-text">cron模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81cron%E6%A8%A1%E5%9D%97"><span class="nav-number">3.1.</span> <span class="nav-text">一、cron模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-1"><span class="nav-number">3.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fetch%E6%A8%A1%E5%9D%97"><span class="nav-number">4.</span> <span class="nav-text">fetch模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81fetch%E6%A8%A1%E5%9D%97"><span class="nav-number">4.1.</span> <span class="nav-text">一、fetch模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-2"><span class="nav-number">4.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#file%E6%A8%A1%E5%9D%97"><span class="nav-number">5.</span> <span class="nav-text">file模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81file%E6%A8%A1%E5%9D%97-%E9%87%8D%E7%82%B9"><span class="nav-number">5.1.</span> <span class="nav-text">一、file模块(重点)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-3"><span class="nav-number">5.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#group%E6%A8%A1%E5%9D%97"><span class="nav-number">6.</span> <span class="nav-text">group模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81group%E6%A8%A1%E5%9D%97"><span class="nav-number">6.1.</span> <span class="nav-text">一、group模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-4"><span class="nav-number">6.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hostname%E6%A8%A1%E5%9D%97"><span class="nav-number">7.</span> <span class="nav-text">hostname模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81hostname%E6%A8%A1%E5%9D%97"><span class="nav-number">7.1.</span> <span class="nav-text">一、hostname模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-5"><span class="nav-number">7.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#playbook%E5%89%A7%E6%9C%AC"><span class="nav-number">8.</span> <span class="nav-text">playbook剧本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81playbook%E4%BB%8B%E7%BB%8D"><span class="nav-number">8.1.</span> <span class="nav-text">一、playbook介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E3%80%81YAML%E6%A0%BC%E5%BC%8F%E8%A7%84%E5%88%99"><span class="nav-number">8.1.1.</span> <span class="nav-text">1.1、YAML格式规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#playbook%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.1.2.</span> <span class="nav-text">playbook实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E3%80%81Playbook%E5%B8%B8%E8%A7%81%E8%AF%AD%E6%B3%95"><span class="nav-number">8.1.3.</span> <span class="nav-text">1.2、Playbook常见语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%BB%83%E4%B9%A0%E6%A1%88%E4%BE%8B"><span class="nav-number">8.2.</span> <span class="nav-text">二、练习案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-role"><span class="nav-number">9.</span> <span class="nav-text">Ansible-role</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81roles%E4%BB%8B%E7%BB%8D"><span class="nav-number">9.1.</span> <span class="nav-text">一、roles介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAroles%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">9.2.</span> <span class="nav-text">二、创建roles的目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%A1%88%E4%BE%8B%EF%BC%9A%E9%80%9A%E8%BF%87roles%E5%AE%9E%E7%8E%B0lamp"><span class="nav-number">9.3.</span> <span class="nav-text">三、案例：通过roles实现lamp</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%EF%BC%89-%E5%88%9B%E5%BB%BAroles%E7%9B%AE%E5%BD%95%E5%8F%8A%E6%96%87%E4%BB%B6-%E5%B9%B6%E7%A1%AE%E8%AE%A4%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-number">9.3.1.</span> <span class="nav-text">3.1） 创建roles目录及文件,并确认目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%EF%BC%89%E5%87%86%E5%A4%87httpd%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%B8%BB%E9%A1%B5%E6%96%87%E4%BB%B6-php%E6%B5%8B%E8%AF%95%E9%A1%B5%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%AD%89"><span class="nav-number">9.3.2.</span> <span class="nav-text">3.2）准备httpd服务器的主页文件,php测试页和配置文件等</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%EF%BC%89%E7%BC%96%E5%86%99httpd%E8%A7%92%E8%89%B2%E7%9A%84main-yml%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.3.</span> <span class="nav-text">3.3）编写httpd角色的main.yml文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4%EF%BC%89%E7%BC%96%E5%86%99mysql%E8%A7%92%E8%89%B2%E7%9A%84main-yml%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.4.</span> <span class="nav-text">3.4）编写mysql角色的main.yml文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5%EF%BC%89-%E7%BC%96%E5%86%99php%E8%A7%92%E8%89%B2%E7%9A%84main-yml%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.5.</span> <span class="nav-text">3.5）:编写php角色的main.yml文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6%EF%BC%89%E7%BC%96%E5%86%99lamp%E7%9A%84playbook%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8%E5%89%8D%E9%9D%A2%E5%AE%9A%E4%B9%89%E5%A5%BD%E7%9A%84%E4%B8%89%E4%B8%AA%E8%A7%92%E8%89%B2"><span class="nav-number">9.3.6.</span> <span class="nav-text">3.6）编写lamp的playbook文件调用前面定义好的三个角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7%EF%BC%89-%E6%89%A7%E8%A1%8Clamp%E7%9A%84playbook%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.7.</span> <span class="nav-text">3.7） 执行lamp的playbook文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8%EF%BC%89-%E6%B5%8B%E8%AF%95%E4%B8%9A%E5%8A%A1%E6%9C%BA%E5%99%A8"><span class="nav-number">9.3.8.</span> <span class="nav-text">3.8） 测试业务机器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-script%E6%A8%A1%E5%9D%97"><span class="nav-number">10.</span> <span class="nav-text">Ansible-script模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81script%E6%A8%A1%E5%9D%97"><span class="nav-number">10.1.</span> <span class="nav-text">一、script模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-6"><span class="nav-number">10.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-service%E6%A8%A1%E5%9D%97"><span class="nav-number">11.</span> <span class="nav-text">Ansible-service模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81service%E6%A8%A1%E5%9D%97"><span class="nav-number">11.1.</span> <span class="nav-text">一、service模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-7"><span class="nav-number">11.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-setup%E6%A8%A1%E5%9D%97"><span class="nav-number">12.</span> <span class="nav-text">Ansible-setup模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81setup%E6%A8%A1%E5%9D%97"><span class="nav-number">12.1.</span> <span class="nav-text">一、setup模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-8"><span class="nav-number">12.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-stat%E6%A8%A1%E5%9D%97"><span class="nav-number">13.</span> <span class="nav-text">Ansible-stat模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81stat%E6%A8%A1%E5%9D%97"><span class="nav-number">13.1.</span> <span class="nav-text">一、stat模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-9"><span class="nav-number">13.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-user%E6%A8%A1%E5%9D%97"><span class="nav-number">14.</span> <span class="nav-text">Ansible-user模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81user%E6%A8%A1%E5%9D%97"><span class="nav-number">14.1.</span> <span class="nav-text">一、user模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-10"><span class="nav-number">14.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-yum-repository%E6%A8%A1%E5%9D%97"><span class="nav-number">15.</span> <span class="nav-text">Ansible-yum_repository模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81yum-repository%E6%A8%A1%E5%9D%97"><span class="nav-number">15.1.</span> <span class="nav-text">一、yum_repository模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-11"><span class="nav-number">15.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible-yum%E6%A8%A1%E5%9D%97"><span class="nav-number">16.</span> <span class="nav-text">Ansible-yum模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81yum%E6%A8%A1%E5%9D%97"><span class="nav-number">16.1.</span> <span class="nav-text">一、yum模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-12"><span class="nav-number">16.2.</span> <span class="nav-text">二、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95"><span class="nav-number">17.</span> <span class="nav-text">Ansible命令用法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81ansible%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95"><span class="nav-number">17.1.</span> <span class="nav-text">一、ansible命令用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81ansible%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9D%97"><span class="nav-number">17.2.</span> <span class="nav-text">二、ansible常见模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91-1"><span class="nav-number">17.3.</span> <span class="nav-text">三、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B9%B3%E5%8F%B0%E5%88%9D%E8%AF%86"><span class="nav-number">18.</span> <span class="nav-text">Ansible运维自动化平台初识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B9%B3%E5%8F%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">18.1.</span> <span class="nav-text">一、运维自动化平台介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E3%80%81%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">18.1.1.</span> <span class="nav-text">1.1、自动化运维平台介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2%E3%80%81%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B9%B3%E5%8F%B0%E7%9A%84%E4%BC%98%E5%8A%BF%EF%BC%9A"><span class="nav-number">18.1.2.</span> <span class="nav-text">1.2、运维自动化平台的优势：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7"><span class="nav-number">18.2.</span> <span class="nav-text">二、常见的自动化运维工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="nav-number">18.2.1.</span> <span class="nav-text">2.1、常见的运维自动化工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E3%80%81ansible%E4%BB%8B%E7%BB%8D"><span class="nav-number">18.2.2.</span> <span class="nav-text">2.2、ansible介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81ansible%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="nav-number">18.3.</span> <span class="nav-text">三、ansible运行原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%AD%A6%E4%B9%A0%E8%A7%86%E9%A2%91"><span class="nav-number">18.4.</span> <span class="nav-text">四、学习视频</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2"><span class="nav-number">19.</span> <span class="nav-text">Ansible自动化运维平台部署</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%83%A8%E7%BD%B2%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">19.1.</span> <span class="nav-text">一、部署前准备</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">133</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
