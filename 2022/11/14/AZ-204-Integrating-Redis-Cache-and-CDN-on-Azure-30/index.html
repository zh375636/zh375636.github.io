<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Introduction- [Thomas] Welcome to Integrating Redis Cache and CDN on Azure. My name is Thomas Mitchell and I’ll be taking you through this course on key caching and content delivery concepts. I’m an">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30">
<meta property="og:url" content="https://example.com/2022/11/14/AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="Introduction- [Thomas] Welcome to Integrating Redis Cache and CDN on Azure. My name is Thomas Mitchell and I’ll be taking you through this course on key caching and content delivery concepts. I’m an">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-14T15:49:44.000Z">
<meta property="article:modified_time" content="2022-11-20T23:27:50.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/14/AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/14/AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-14 11:49:44" itemprop="dateCreated datePublished" datetime="2022-11-14T11:49:44-04:00">2022-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:27:50" itemprop="dateModified" datetime="2022-11-20T19:27:50-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-204/" itemprop="url" rel="index"><span itemprop="name">AZ-204</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/14/AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/14/AZ-204-Integrating-Redis-Cache-and-CDN-on-Azure-30/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>- [Thomas] Welcome to Integrating Redis Cache and CDN on Azure. My name is Thomas Mitchell and I’ll be taking you through this course on key caching and content delivery concepts. I’m an Azure content author at Cloud Academy and I have over 25 years of deep IT experience, several of those with cloud technologies. If you have any questions, feel free to connect with me on LinkedIn or send an email to <a href="mailto:&#115;&#117;&#112;&#112;&#111;&#x72;&#x74;&#x40;&#x63;&#x6c;&#111;&#x75;&#100;&#x61;&#99;&#97;&#100;&#x65;&#x6d;&#121;&#46;&#x63;&#111;&#x6d;">&#115;&#117;&#112;&#112;&#111;&#x72;&#x74;&#x40;&#x63;&#x6c;&#111;&#x75;&#100;&#x61;&#99;&#97;&#100;&#x65;&#x6d;&#121;&#46;&#x63;&#111;&#x6d;</a>. </p>
<p>This course is intended for IT professionals who are interested in earning Azure certification and those who need to incorporate Redis Cache or CDN with their solutions. To get the most from this course, you should have at least a moderate understanding of what caching is and why it’s used. We’ll kick off the course with an overview Redis Cache, and then we’ll create a Redis Cache instance in Azure. With Redis Cache deployed in Azure, we’ll then connect an application to the cache. Next, we’ll walk through the process of storing and retrieving data in Redis Cache. After covering Redis Cache, we’ll walk through an overview of what CDN is and what it’s used for. We’ll then develop some code for leveraging CDN. As we wrap up the course, we’ll cover the process for invalidating date in both Redis Cache and in a CDN. </p>
<p>By the end of this course, you should have a good understanding of what Redis Cache and what CDN are and what purposes they serve. You’ll also know how to connect to each from applications and how to purge or invalidate data in both. We’d love to get your feedback on this course, so please give it a rating when you’re finished. </p>
<p>If you’re ready to start learning about integrating Redis Cache and CDN on Azure, let’s get started!</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>- [Instructor] Azure Cache for Redis is usually used to improve performance and scalability of systems and applications that rely on back end data-stores. Leveraging Redis cache improves performance by temporarily copying frequently accessed data to fast storage that’s located close to the application that’s being run. Azure Cache for Redis provides the storage and memory instead of loading data from disc via a database. </p>
<p>In addition to providing caching services, Azure Cache for Redis can also be used for other purposes. For example, it can be used as an in-memory data structure store or even a distributed non-relational database. By taking advantage of the Redis engines high throughput and low latency, application performance is improved. </p>
<p>Leveraging Azure Cache for Redis provides organizations with access to a cache that’s managed by Microsoft. Because it’s hosted in Azure, Azure Cache for Redis is accessible to all applications, whether they reside within Azure or outside of it. </p>
<p>There are several typical patterns where Azure Cache for Redis comes in handy for supporting application architecture or to improve application performance. </p>
<p>Common patterns include things such as cache-aside, content caching, user session caching, job and message queuing and distributed transactions. </p>
<p>Because databases can be quite large, they should never be loaded in their entirety into a cache. That said, a common strategy would be to use the cache-aside pattern to load data items into the cache only as needed. When the back end data is updated by the system, the cache can also be updated. Such updates are then distributed with other clients. Through expiration settings or by using an eviction policy, the system can cause data updates to be reloaded into the cache. </p>
<p>Because most web pages are generated from templates that contain static headers, footers, toolbars, et cetera, they don’t change all that often, as such, generating them dynamically isn’t recommended. By using an in-memory cache like Azure Cache for Redis, you can speed up access to web content by providing your web servers with quicker access to this type of static content when compared to back end data-stores. The content caching pattern reduces processing time and server load that would otherwise be necessary to generate content dynamically. What this does, is allow web servers to be more responsive. As such, this results in the ability to actually reduce the number of servers that are needed to handle similar loads. Azure Cache for Redis provides the Redis output cache provider to help support this pattern with asp.net. </p>
<p>User session caching is typically used with shopping carts. It’s also used in other applications that deal with user-history types of information that make use of cookies. Because storing too much in a cookie can negatively affect performance, you can instead use the cookie as a key to query the data that’s stored in a back end database. Using Azure Cache for Redis to associate information with a user is far faster than interacting with a full relational database. </p>
<p>Any time an application receives a request, there’s a chance that the operations that are associated with that request, might take additional time to execute. A common way to deal with these types of longer running operations is to add them to a queue, which is then processed later and maybe even by a different server altogether. This type of deferment strategy is called task queuing and Azure Cache for Redis serves this purpose well by acting as a distributed queue. </p>
<p>An application will often need to be able to execute multiple commands against a back end data-store in a single operation. If all commands don’t succeed, then they must all be rolled back to the initial state. </p>
<p>Azure Cache for Redis provides support for executing a batch of commands in a single operation. It does so in the form of transactions. Azure Cache for Redis is available in three different tiers. These tiers include basic, standard and premium. The basic tier offers a single node cache. It supports multiple memory sizes from 250 megabytes all the way up to 53 gigabytes. </p>
<p>The basic tier is a good fit for development environments, testing and non-critical workloads. It’s important to note that the basic tier offers no service-level agreement. The standard tier offers a replicated cache in a two-node, or primary, secondary configuration that’s managed by Microsoft. </p>
<p>The standard tier offers a high-availability SLA of 99.99% or four nines. </p>
<p>The premium tier is enterprise ready. Caches in the premium tier offer more features, higher throughputs, and lower latencies than standard or basic. Premier tier caches are deployed on more powerful hardware than the other tiers, which in turn obviously offers better performance than basic or standard. </p>
<p>It’s important to note that a cache can be scaled to a higher tier after it’s already been created, but it can’t be scaled down to a lower tier. So with that in mind, when you’re deploying a cache make sure that you don’t over-provision, because if you do, you may find yourself in a spot where you can’t go backwards. It’s always better to slightly under-provision and then scale higher if necessary.</p>
<h1 id="Create-a-Redis-Cache-Instance"><a href="#Create-a-Redis-Cache-Instance" class="headerlink" title="Create a Redis Cache Instance"></a>Create a Redis Cache Instance</h1><p>- [Instructor] In this demonstration, we’re going to create an Azure Cache for Redis on Azure. To do so, I’ve logged in to my Azure portal, as you can see on your screen. </p>
<p>To create our Azure Cache for Redis, I browse over to the left pane and click Create a resource. From here, I can browse to Databases, and then, in the list of featured services, I can scroll down to Redis Cache and select it. I need to provide a globally unique name for my Redis Cache. Now, basically, what that means is the name that I give my cache needs to be unique across the entire Azure landscape. So, I’ll call it myredis9878. The green check box tells me that my name is valid. Then, of course, I need to select a subscription, so I’ll select the Microsoft Azure Sponsorship subscription that I have, and then, I need to specify a resource group. </p>
<p>I don’t have an existing resource group, so I’ll create a new one. And I’ll just call it Redis and okay it. I typically deploy my resources in the east region, so I’ll go East US, and for this demonstration, I’m going to select the basic pricing tier. </p>
<p>Now, if I click on View full pricing details, I can see all of the different options that are available to me for my Redis Cache pricing. If we scroll back up here, we can see Premium. We scroll down, we see the standard. And then, at the bottom, we can see our basic tiers. I’m using the C0 Basic tier. You can see further down here that some features or options, I should say, are not available because I’m not using a premium tier. </p>
<p>So, now, what I’ll do is I’ll create my cache, and this can sometimes take a few minutes to complete. We can see up here we get the Deployment in progress status. And what I’ll do is I’ll switch over to my resource group here, and if I select my cache here, we can see that the status is creating. This status will change to running once it’s completed. </p>
<p>We’ll refresh it here. And we can see it’s still creating. And while we’re waiting for this to create, what I’m going to do is switch over to my dashboard and create a new one for my Redis Cache lab here. And then, I’ll switch back to my resource group, and then, I’ll pin my Redis to my dashboard here. And if we select my cache, we can see it’s still creating. And let’s give it one more refresh. </p>
<p>So, we can see now that our cache is in the running state. So, in the next demonstration, we’re going to retrieve our access keys and connect a Python app to our cache.</p>
<h1 id="Installing-Redis-PY"><a href="#Installing-Redis-PY" class="headerlink" title="Installing Redis PY"></a>Installing Redis PY</h1><p>- [Narrator] In this lesson, we’re going to create a Python application and connect it to our Redis cache. However, before doing so we need to install redis-py, which is a Python interface to the Azure cache for Redis. I’m goin to install redis-py through Microsoft Visual Studio, which you see on your screen. To perform the installation I simply click on tools and then Python. From here I go to Python Environments. In my packages search I can search for Redis. In my list of commands that are returned I can see install redis here installs redis-py. So we’ll go ahead and click this command, and we need to run it in an elevated prompt, so we’ll go ahead and elevate it, and you can see on the bottom here that it was successfully installed. In the next demonstration we will test the read and write access to our cache from Python.</p>
<h1 id="Test-Read-and-Write"><a href="#Test-Read-and-Write" class="headerlink" title="Test Read and Write"></a>Test Read and Write</h1><p>- [Instructor] What we are going to do in this demonstration is connect to our Redis cache via Python through an interactive window in Microsoft Visual Studio. Once we connect to our cache, we are going to use the set command to store some data in the cache and then use the get command to pull that data out and display it. It’s a basic demonstration, but it shows how to connect to the ready cache and how to store and retrieve data. </p>
<p>Before connection to our cache, we need to import the readis-py package. And what I am going to do is copy and paste some of these commands and explain them as we go. </p>
<p>So on the screen we have my Python interactive window open and what I am going to do is paste in this import command and essentially what this does is pull in that ready cache package, so we can use it to connect to our ready cache. We’ll hit enter here, doesn’t give us any feed back, but it doesn’t give us an error either. So we know we are good. </p>
<p>And what we are going to do here is connect to our cache. So this is the connection string we are going to use to connect to our cache. We are storing this in a variable. You can see here that we have to specify the complete host name for our cache. And this is our host name that we give it when we deployed it earlier on. We need to specify the port we are going to connect over. And sixty-three eighty, by the way, is the default port number. The Db equals zero command here tells us that we are connecting to the zero data base. Remember, there are sixteen databases that comprise the data cache. So we are just specifying which database we are working with. The password here that we are specifying is actually the access key that we copy from our cache after we deployed it in Azure. And then lastly, we are just telling the command that we are going to use SSL to connect. </p>
<p>So with this command we hit enter and again there is no real feedback to tell us anything. What we are going to do now is perform a set command to store some data in the cache. So essentially performing this set against our variable. And we are put in some data in our cache and we can hit enter. So finally, we get some feedback true tell us that our storage set was successful. So now, what I am going to do here is to perform a get against our variable to pull the data back out. And on the screen here we can see that the get was successful. </p>
<p>What we will do on our next demonstration is create an actual Python script that goes out and communicates with our ready cache.</p>
<h1 id="Test-Read-and-Write-Access-to-Cache"><a href="#Test-Read-and-Write-Access-to-Cache" class="headerlink" title="Test Read and Write Access to Cache"></a>Test Read and Write Access to Cache</h1><p>- What we’re going to do here is create a basic Python script or application in Visual Studio. What this script is going to do is connect to the cache, set a message into the cache, and then retrieve it and display it. </p>
<p>To create our new project in Visual Studio, you can go up here and click file and then new project. We’re going to select a Python application and we’ll call it my Python app. We’ll leave it in the default location and what this does is open an editor window. Now what I’m going to do is I’m going to copy some of the lines for this code into the window rather than just type everything out. Essentially what we’re going to do is import the redis and then we’re going to set two variables. The redis host name and the access key. The host name is the FQDN of the cache that we configured in Azure and the access key is the access key to access it. </p>
<p>What we’ll do is we’ll open a connection to the cache we’ll ping it to confirm it’s accessible and then we’ll set a message, confirm that the message was set and then we’ll access and display that message. I’m going to start here by importing redis and then I’m going to pull in my two variables the redis host name is the FQDN of my cache and the access key is the key to access that cache. What I’m going to do now is open up the connection to the cache on port 6380 and then what I’m going to here is ping the cache we’ll do the ping store it in result and then print the result so we can see it. What we’ll then do is set a message in our cache we’re essentially setting a string here in a message that says hi Tom. </p>
<p>Python can access the cache and then what we’re going to do is we’ll print that result out and then what we’ll do here I have one more command or two more commands I wanna paste in here and after we’ve set that message, what we’re going to do is retrieve that message and display it. </p>
<p>So what this simple little Python script does is verify that we can connect to the cache that we can ping the cache, that we can set data to the cache, and that we can retrieve data from the cache. So to run our little test Python application here, we can simply click debug and then start without debugging. And the basic feedback we get is that the ping returns a true statement so we were in fact able to ping the cache. We were able to set the message in the cache which means we can store data in it, and then we were able to retrieve that data which is represented by the message that’s returned, Hi Tom, Python can access the cache. So we’ll hit enter to continue and exit back out. </p>
<p>So what we’ve done with 10 lines of code is confirm that we can connect to our cache and at the same time we’ve also demonstrated that we can store data in that cache as well as retrieve that data.</p>
<h1 id="Flushing-Redis-Cache"><a href="#Flushing-Redis-Cache" class="headerlink" title="Flushing Redis Cache"></a>Flushing Redis Cache</h1><p>- [Instructor] You will sometimes find yourself in a spot where you need to invalidate the data in your Redis cache. Doing so is pretty straightforward right from the Azure Portal. So, what I wanted to do in this really, really brief demonstration is show you how to open the console for the Redis cache in Azure Portal and issue a flushall command to empty out the Redis cache. On the screen here, you see that I’m in my Redis resource group and I have my Redis cache here. What I’m going to do is open my Redis cache and then click on Console. From here, I can simply flush my cache by issuing a flushall command. And that’s it. It’s a rather straightforward process that you can do right from the Azure Portal.</p>
<h1 id="Azure-CDN-Overview"><a href="#Azure-CDN-Overview" class="headerlink" title="Azure CDN Overview"></a>Azure CDN Overview</h1><p>- [Narrator] A content delivery network, which is also known as a CDN, is a network of distributed servers that’s used to more efficiently deliver content to end users. What CDNs do is store cached content on what are called edge servers that are located in specific point-of-presence locations that are near the end users who are consuming the content. What this does is minimize latency. </p>
<p>The Azure Content Delivery Network provides a global solution for organizations and developers that need to deliver high-bandwidth content to end users by caching that content on strategically-placed nodes all over the world. While a CDN is useful for delivering static content, Azure CDN can even accelerate delivery of non-cacheable, dynamic content by leveraging many different network optimizations using CDN POPs, or points of presence. </p>
<p>Using Azure CDN to deliver web content offers better performance and an improved end user experience for those who are consuming the content. This is especially true when the end users are using applications that require multiple round-trips to load that content. </p>
<p>Azure CDN also offers large scaling. What this does is allow it to better handle high loads, which is something that you would expect to see maybe during a product launch. </p>
<p>By distributing user requests and serving content directly from the edge servers, Azure CDN ensures that less traffic is actually sent to the origin server, which further improves performance and responsiveness of the origin server.</p>
<h1 id="How-Azure-CDN-Works"><a href="#How-Azure-CDN-Works" class="headerlink" title="How Azure CDN Works"></a>How Azure CDN Works</h1><p>- [Narrator] On the screen here, you can see a diagram of exactly how CDN works. Let’s put a little context behind it. In step one, User A requests a file or an asset via a URL with a special domain name. Such a domain name might be mydomain.azureedge.net. The domain name can actually be an endpoint hostname or even a custom domain. DNS then routes that request to the best performing point-of-presence, or PoP, which is often the point-of-presence that is geographically closest to the user requesting the content. </p>
<p>Now, if there are no edge servers in the point-of-presence that have the requested file in their cache, the POP, or point-of-presence, requests the file from the originating server. The originating server could be an Azure Web App, an Azure Cloud Service, an Azure Storage Account, or essentially any other publicly accessible web server. Next, the originating server returns the requested file to one of the edge servers in the PoP. The edge server in the PoP then caches the file and returns it to the original requester, which is User A in this case. The file will then remain cached on that edge server in the PoP until the time to live, or TTL, that’s specified by its HTTP headers, expires. The default TTL is seven days, unless the origin server provides a specific TTL. Other users can then request the same file by using the same URL that User A used, and can also be directed to the same PoP. If the TTL for the file hasn’t expired, the PoP edge server returns the file directly from the cache instead of going back to the originating server. What this does is result in a far faster, more responsive end user experience.</p>
<h1 id="Adding-Azure-CDN-to-an-Azure-Web-App"><a href="#Adding-Azure-CDN-to-an-Azure-Web-App" class="headerlink" title="Adding Azure CDN to an Azure Web App"></a>Adding Azure CDN to an Azure Web App</h1><p>- [Instructor] In this demonstration, we’re going to add an Azure CDN to an existing Azure web app. What we’re going to do is deploy a CDN profile in Azure, along with an endpoint for our web app. The web app that we’re going to use is a basic static HTML page that we’re going to use to demonstrate the functionality of the CDN and how to purge CDN content. </p>
<p>On the screen, you can see my dashboard for my CDNLab. We already have a basic web app deployed. It’s a static HTML page, and it’s essentially a picture of a cat, because I like cats, and a little bit of text at the bottom. The website in its starting form displays a sentence called “This is a cat!!” in red text. We’re going to use the color of this text to demonstrate how a CDN caches content from a web application. So let’s bounce back over into my dashboard here. </p>
<p>The first thing I need to do is create a CDN profile and an endpoint. So let’s go ahead and click Create a resource here, and search for CDN. We’ll deploy a CDN, and create it. And we’ll call it mycdnlabdemo. And we’ll put this in our CDNLab Resource group. And for the Pricing tier, we’re going to use the Standard Akamai. This is because we need to be able to configure custom rules later on. </p>
<p>Now to create our CDN endpoint, which points to our application, we’ll click the checkbox, and then give our CDN endpoint a name. This needs to be unique across the entire Azure landscape. So I’ll just call it mycatendpoint.azureedge.net. And what we’re going to do is specify an Origin type of Web App, since it’s a web app we’re pointing to. And we’ll browse to the Origin hostname, which is themywebapp1973, which you saw up here. So we’ll go ahead and create that CDN profile and endpoint. </p>
<p>So now that we have our CDN profile created, what we can do is browse to our CDN and see that our endpoint is running. If we click on our endpoint here, we can get the hostname. So we’ll copy this and paste it into a new tab. Now the name of our file here, our HTML page, is CDNDemo.htm. So we’ll append that to our cache. So as you can see, our CDN cache is the same as our application, our web app. So now that we’ve confirmed that our cache and our live site both match, what we’re going to do is make a change to the website itself. So to do this, I’m going to drop down into my FTP client here, which is already connected to my web app. If I open up my CDNDemo page on my live site, I can see that I’m specifying a red color for the text. We’re going to go ahead and change this to blue, and we’ll save it. </p>
<p>Now if I bounce back up to my web app itself, which is denoted by mywebapp1973.azurewebsites.net, if I refresh my page here, I now have blue text. However, if I go to my endpoint in my CDN, which is denoted by my endpoint name with an azureedge.net attached to it, and refresh, the text is still red. This is because the cache content hasn’t been updated yet. Now the CDN, in and of itself, will periodically refresh its content from the origin webpage. This is based on the TTL configuration. That being said, the default TTL is seven days. </p>
<p>So there will be times when content is updated on a website that we may wish to purge the cached content from our CDN. This is one of those cases. So what we’re going to do is purge the content from our CDN by browsing over, back into our Azure portal, and into our endpoint here. If we roll back out into our demo here, we can see our endpoint listed. What we can do is click Purge at the top here. And I’m going to purge the CDNDemo. And we’ll purge it. Now this takes a minute or so to do, but once this happens, we’ll go back up and refresh our endpoint here to see if it’s updated. So let’s bounce back up into our endpoint here and do a refresh. </p>
<p>And there you have it. So by purging the CDN cache, we’ve allowed it to recache the new content from the source website. So now you know a little bit about how to deploy your CDN profile, how to create that endpoint that references the production website, and how to purge your CDN content to ensure it pulls down the latest version of the content so that it can serve it up properly.</p>
<h1 id="Using-Query-Strings-to-Version-Content"><a href="#Using-Query-Strings-to-Version-Content" class="headerlink" title="Using Query Strings to Version Content"></a>Using Query Strings to Version Content</h1><p>- [Instructor] In this demonstration we’re going to see how the cache in an Azure CDN can be manipulated using query strings. On your screen you can see I’m in here with my CDN in Azure. On your screen here you can see I’m in my CDN. If I click on my end point that we created in our previous demonstration, I can browse over to caching rules to see what rules are set up for this end point. We can see that we have global caching rules and custom rules. What we’re going to do here in this demonstration is change the query string caching behavior. If I select this drop-down you can see there’s three options. We have ignore query strings, bypass caching for query strings and cache every unique URL. What we’re going to do here is change the default caching behavior to cache every unique URL. And then we’ll save it. While this is saving, we’ll go out to our web app and we’ll refresh here and see that our text is blue. If we go into our cache, we can also see that our text is blue. Now what I’m going to do here is copy my end point URL and open a new tab. I’ll paste this URL in, but I’ll specify a query string. So we can see here even with a query string of one we still have blue text, which makes sense, we haven’t made any changes yet. And I’ll just refresh this to make sure it gets committed to cache. And now what I’m going to do is go down into my ftp client and I’m going to edit my web app and I’ll change the color to green. So on my production web app this text is now green. So what I’ll do next is open up my end point again this time with a query of two. We can see my query two shows green text, my query one shows blue. If I refresh, I still have blue text. So what this demonstrates is how each query string is treated differently based on the fact that I have the query string caching behavior set to cache every unique URL. If we bounce back down to my editor here, and change it to black, I can then open another tab, so another query and now I get black text. So as you can see, you can control what content is cached and how, based on how you configure your caching rules, and how you access the content itself.</p>
<h1 id="Invalidating-CDN-Cache-With-a-Custom-Rule"><a href="#Invalidating-CDN-Cache-With-a-Custom-Rule" class="headerlink" title="Invalidating CDN Cache With a Custom Rule"></a>Invalidating CDN Cache With a Custom Rule</h1><p>- While we’re in here looking at caching rules for our CDN cache, let’s take a look at a custom caching rule. What we’re going to do in this demonstration is define a custom caching rule that invalidates our CDN cache after a specified amount of time. What we’re going to do in this demonstration is use a custom caching rule to set a cache duration of one second on our cdndemo.htm file. What this will do is override any cache control or expires http headers that are sent by the originating server. </p>
<p>So to create our custom caching rule, we’ll browse down here, down to the custom caching rule section. So to define our custom caching rule, we’ll go down to the bottom here where it says custom caching rules. So to create our custom caching rule, what we’re going to do is go down to the bottom here where it says custom caching rules. What we’re going to do for the match condition field is set it to path. The value we’re going to match on is our cdndemo.htm file. The caching behavior we’re going to set is override and we’re going to tell it that we want a cache duration of one second. We can go ahead and save our new rule. </p>
<p>With our new rule in place, what we’ll do is go up to our web app and we’ll refresh it. And we can see we have black text. If we switch over to our end point, we can refresh and we see we have black text. Now what I’m going to do is go into my FTP client again and I’m going to edit the text color back to red. Now if I go back up to my application and refresh, we can see I get red text. Now what I would expect in my end point is that a refresh also displays red text. This is because the custom rule down here should override the default cache expiration of seven days because I’m focused on the cdndemo.htm match. So let’s go up here and do a refresh and as you can see here, the text is in fact red. So what this demonstrates is that I can control individual caching with custom caching rules. Our custom rule here that matches on the cdndemo.htm file overrides the default caching expiration duration of seven days. And if you read closely under the custom caching rule section, Microsoft will tell you that these rules override the default settings above and that they’re evaluated from top to bottom. That being said, rules that are lower in this list can override rules that are further above it. So keep that in mind when you start creating custom caching rules.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>- [Instructor] I hope you’ve enjoyed learning about integrating Redis Cache and CDN on Azure. Let’s review what you’ve learned. </p>
<p>Early on in this course, you learned about Azure Cache for Redis and what it offers. You learned about several patterns where Azule Cache for Redis comes in handy and about different service tiers. After learning what Azure Cache for Redis is, you learned how to create a cache instance in Azure and how to access it. You then learned how to test, read, and write access to the cache and how to access the cache with a Python application via Visual Studio. We then moved on to the Azure Content Delivery Network or Azure CDN where you learned what it is, what it offers, and how it works. Later in the course, you learned how to add an Azure CDN to an Azure App Service web app and how to invalidate CDN content as well as Redis Cache content. </p>
<p>To learn more about integrating Redis Cache and CDN on Azure, you can and should read Microsoft’s published documentation. Be sure to also watch for new Microsoft Azure courses on Cloud Academy because we’re always publishing new ones. Please give this course a rating and if you have any questions or comments, please let us know. As always, thanks for watching and happy learning.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-204-Lab-Azure-Key-Vault-and-Disk-Encryption-29/" rel="prev" title="AZ-204-Lab-Azure-Key-Vault-and-Disk-Encryption-29">
      <i class="fa fa-chevron-left"></i> AZ-204-Lab-Azure-Key-Vault-and-Disk-Encryption-29
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-204-Designing-for-Azure-Operations-31/" rel="next" title="AZ-204-Designing-for-Azure-Operations-31">
      AZ-204-Designing-for-Azure-Operations-31 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview"><span class="nav-number">2.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Create-a-Redis-Cache-Instance"><span class="nav-number">3.</span> <span class="nav-text">Create a Redis Cache Instance</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Installing-Redis-PY"><span class="nav-number">4.</span> <span class="nav-text">Installing Redis PY</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Test-Read-and-Write"><span class="nav-number">5.</span> <span class="nav-text">Test Read and Write</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Test-Read-and-Write-Access-to-Cache"><span class="nav-number">6.</span> <span class="nav-text">Test Read and Write Access to Cache</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flushing-Redis-Cache"><span class="nav-number">7.</span> <span class="nav-text">Flushing Redis Cache</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Azure-CDN-Overview"><span class="nav-number">8.</span> <span class="nav-text">Azure CDN Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#How-Azure-CDN-Works"><span class="nav-number">9.</span> <span class="nav-text">How Azure CDN Works</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Adding-Azure-CDN-to-an-Azure-Web-App"><span class="nav-number">10.</span> <span class="nav-text">Adding Azure CDN to an Azure Web App</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Using-Query-Strings-to-Version-Content"><span class="nav-number">11.</span> <span class="nav-text">Using Query Strings to Version Content</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Invalidating-CDN-Cache-With-a-Custom-Rule"><span class="nav-number">12.</span> <span class="nav-text">Invalidating CDN Cache With a Custom Rule</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">13.</span> <span class="nav-text">Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
