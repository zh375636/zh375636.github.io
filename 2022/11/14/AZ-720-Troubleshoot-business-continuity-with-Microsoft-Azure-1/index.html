<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionCompleted100 XP  3 minutes  As an Azure network support engineer, you understand that business data is valuable, and needs to be protected from internal and external risks. When you encoun">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1">
<meta property="og:url" content="https://example.com/2022/11/14/AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionCompleted100 XP  3 minutes  As an Azure network support engineer, you understand that business data is valuable, and needs to be protected from internal and external risks. When you encoun">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-reports.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-center.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-steps-backup-recovery.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-backup-center-data-change.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-disk-information.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-data-change-rate.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-azure-backup-welcome.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-machine-backup-screen.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-backup-instances.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-single-backup.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-multiple-backups.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-backup-screen.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-crash-instance-restore-point.png">
<meta property="article:published_time" content="2022-11-14T17:02:09.000Z">
<meta property="article:modified_time" content="2022-11-14T20:25:16.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-reports.png">

<link rel="canonical" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-11-14 13:02:09 / Modified: 16:25:16" itemprop="dateCreated datePublished" datetime="2022-11-14T13:02:09-04:00">2022-11-14</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/14/AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/14/AZ-720-Troubleshoot-business-continuity-with-Microsoft-Azure-1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>As an Azure network support engineer, you understand that business data is valuable, and needs to be protected from internal and external risks. When you encounter problems with backing up or recovery, you need to know how to approach the problem. In this module, you will learn how to monitor the status of backups, review logs, and troubleshoot common issues that occur when backing up and recovering data.</p>
<h2 id="Learning-objectives"><a href="#Learning-objectives" class="headerlink" title="Learning objectives"></a>Learning objectives</h2><p>By the end of this module, you will be able to:</p>
<ul>
<li>Review the status of a backup job, manage alerts, and review logs.</li>
<li>Troubleshoot backing and restoring a virtual machine (VM).</li>
<li>Troubleshoot Microsoft Azure Recovery Services backups.</li>
<li>Troubleshoot backing up and restoring servers.</li>
<li>Troubleshoot Azure to Azure Site Recovery.</li>
<li>Troubleshoot site recovery with Hyper-V, VMM, and VMware.</li>
</ul>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><ul>
<li>Demonstrate an understanding of the OSI model</li>
<li>Demonstrate an understanding of Azure CLI</li>
<li>Demonstrate an understanding of PowerShell</li>
<li>Know how to run Cloud Shell to run commands</li>
</ul>
<h1 id="Troubleshoot-backup-issues-with-Microsoft-Azure"><a href="#Troubleshoot-backup-issues-with-Microsoft-Azure" class="headerlink" title="Troubleshoot backup issues with Microsoft Azure"></a>Troubleshoot backup issues with Microsoft Azure</h1><p>Completed100 XP</p>
<ul>
<li>8 minutes</li>
</ul>
<h2 id="Review-backup-status-in-the-Azure-portal"><a href="#Review-backup-status-in-the-Azure-portal" class="headerlink" title="Review backup status in the Azure portal"></a>Review backup status in the Azure portal</h2><p>The Azure Backup Center is a one-stop location to manage Azure backups including:</p>
<ul>
<li>Azure VM backup</li>
<li>SQL in Azure VM backup</li>
<li>SAP HANA in Azure VM backup</li>
<li>Azure Files backup</li>
<li>Azure Blobs backup</li>
<li>Azure Managed Disks backup</li>
<li>Azure Database for PostgreSQL Server backup</li>
</ul>
<p>For information about supported scenarios, see the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-center-support-matrix">Support matrix for Backup center</a>.</p>
<p>In the Azure portal, search for Backup center in the Search bar. You can then pin the Backup center to your dashboard. Use the filter options to view the specific jobs you are interested in. You can filter on the following parameters:</p>
<ul>
<li>Datasource subscription, resource group, location, tag, or type</li>
<li>Vault</li>
<li>Protection status</li>
</ul>
<p>Use the Backup jobs menu to review the job status. You can review the time the backup started, the duration, the job operation, and its status. You can also display the backup instance associated with the job, the subscription, resource group, and location.</p>
<p>Select an item in the grid to get more details. Right-click an item to go to the resource and take any necessary actions.</p>
<h3 id="Review-and-respond-to-backup-alerts"><a href="#Review-and-respond-to-backup-alerts" class="headerlink" title="Review and respond to backup alerts"></a>Review and respond to backup alerts</h3><p>From the Backup center left menu, under Monitoring + reporting, select Alerts (preview).</p>
<p>By default, the summary displays open alerts in the last 24 hours. You can also filter by a range of parameters:</p>
<ul>
<li><p>Datasource subscription</p>
</li>
<li><p>Datasource resource group</p>
</li>
<li><p>Datasource location</p>
</li>
<li><p>Datasource type</p>
</li>
<li><p>Vault</p>
</li>
<li><p>Severity (0 &#x3D; critical, 1 &#x3D; error, 2 &#x3D; warning, 3 &#x3D; informational, and 4 &#x3D; verbose)</p>
</li>
<li><p>State (New, acknowledged, closed)</p>
</li>
<li><p>Type (Security alert, configured alert)</p>
</li>
<li><p>Signal type (metric or log)</p>
</li>
<li><p>Time range (24 hours, week, two weeks, 30 days, or custom)</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-reports.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-reports.png" alt="Screenshot that shows Backup Report."></a></p>
</li>
</ul>
<h3 id="Alerts-by-email-notification"><a href="#Alerts-by-email-notification" class="headerlink" title="Alerts by email notification"></a>Alerts by email notification</h3><p>You can get email notifications when alerts are triggered by creating an alert processing rule.</p>
<ul>
<li>From the Azure portal, go to the Backup center.</li>
<li>From the left menu, select Alerts (Preview).</li>
<li>From the top menu, select Alert processing rule (preview).</li>
<li>From the top menu, select Create.</li>
<li>In the Scope section, select Select scope to display the Select Scope pane.</li>
<li>Select the resource you want the alert processing rule applied to by either selecting from the drop-down list, or by typing to filter the resources. The matching resources are then displayed. Use the check boxes to select the resources you want the alert processing rule to apply to.</li>
<li>Alternatively, you can apply the rule for all resources within a subscription. When the Select Scope pane is displayed, select the check box next to the correct subscription.</li>
<li>In the Filter section, you can apply one or more filters. For example, select Severity to generate notifications for alerts of a certain severity.</li>
<li>Under Rule Settings, create an action group (or use an existing one). An action group is the destination to which the alert notification should be sent, such as an email address.</li>
<li>On the Basics tab, select the name of the action group, the subscription, and resource group under which it should be created.</li>
<li>On the Notifications tab, select Email&#x2F;SMS message&#x2F;Push&#x2F;Voice and enter the recipient’s details.</li>
<li>Test the action group. A test email is sent to the specified email addresses.</li>
<li>Select Review + Create, and then Create to save the action group.</li>
<li>Select Create to save the action rule.</li>
</ul>
<h3 id="Review-and-interpret-backup-logs"><a href="#Review-and-interpret-backup-logs" class="headerlink" title="Review and interpret backup logs"></a>Review and interpret backup logs</h3><p>To review and interpret backup logs, select the Backup Reports menu in the Backup center. When configured, Azure Backup Reports allow you to audit your backups and restores, analyze trends, and track and forecast usage.</p>
<p>Configure diagnostics settings for a Recovery Services vault by going to the vault and selecting Diagnostics settings. Select + Add Diagnostic Setting for the metrics you want to collect. Under Destination details, select the destinations that you want to stream them to. This includes Log Analytics workspace as an option.</p>
<p>The following views are available from the tabs:</p>
<ul>
<li><p>Overview – select specific subscriptions and workspaces, and links to more information.</p>
</li>
<li><p>Summary – a high-level overview of your backup estate.</p>
</li>
<li><p>Backup Items – cloud storage consumed at a backup item level.</p>
</li>
<li><p>Usage – key billing parameters for your backups.</p>
</li>
<li><p>Jobs – view long-running trends on jobs, such as the number of failed jobs per day, and the top causes of job failure.</p>
</li>
<li><p>Policies – information on active policies, such as the number of associated items, and the total cloud storage consumed by items backed up under a given policy.</p>
</li>
<li><p>Optimize – potential cost optimization opportunities for your backups.</p>
</li>
<li><p>Policy adherence – success of backups per day for every backup instance.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/2-backup-center.png" alt="Screenshot of Backup Center."></p>
</li>
</ul>
<h2 id="Troubleshooting-backups-with-Microsoft-Azure-Recovery-Services-MARS"><a href="#Troubleshooting-backups-with-Microsoft-Azure-Recovery-Services-MARS" class="headerlink" title="Troubleshooting backups with Microsoft Azure Recovery Services (MARS)"></a>Troubleshooting backups with Microsoft Azure Recovery Services (MARS)</h2><p> Note</p>
<p>Microsoft documentation refers to both the backup agent and MARS interchangeably: both refer to the same service name (cbengine). In this module, it is referred to as Microsoft Azure Recovery Services (MARS).</p>
<p>Microsoft Azure Recovery Services is also known as the backup agent. This is the Azure service that is used to back up data. The MARS agent can run on:</p>
<ul>
<li>On-premises Windows machines.</li>
<li>Azure VMs running Windows. The MARS agent runs side by side with the Azure VM backup extension. The agent backs up specific files and folders on the VM.</li>
<li>A Microsoft Azure Backup Server (MABS) or a System Center Data Protection Manager (DPM) server.</li>
</ul>
<p>Use the MARS agent to back up files, folders, and Windows machines either on-premises or in the cloud. Data is backed up to an Azure Recovery Services Vault.</p>
<p>To troubleshoot with the MARS agent, first check basic issues, and then more advanced issues.</p>
<h3 id="Step-1-Basic-troubleshooting"><a href="#Step-1-Basic-troubleshooting" class="headerlink" title="Step 1: Basic troubleshooting"></a>Step 1: Basic troubleshooting</h3><p>Check that:</p>
<ul>
<li>You have network connectivity between the MARS backup agent and Azure.</li>
<li>The MARS agent is running. You might need to restart it and ensure the MARS agent is ready.</li>
<li>There is 5%-10% free space in the scratch folder.</li>
<li>Antivirus software or any other process is not interfering with the backup.</li>
<li>Any warning messages have been reviewed.</li>
</ul>
<h3 id="Step-2-Troubleshoot-versions-and-other-steps"><a href="#Step-2-Troubleshoot-versions-and-other-steps" class="headerlink" title="Step 2: Troubleshoot versions and other steps"></a>Step 2: Troubleshoot versions and other steps</h3><ul>
<li>For offline backups, ensure Azure PowerShell 3.7.0 is installed on both computers.</li>
<li>The operating system and MARS agent are up-to-date.</li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-support-matrix-mars-agent">Unsupported drives, and files with unsupported attributes, are excluded from backup</a>.</li>
<li>Are manual backups working, but scheduled backups are not?</li>
<li>Are all relevant clocks set to the correct time zone?</li>
</ul>
<h2 id="Troubleshoot-backing-up-Azure-VMs"><a href="#Troubleshoot-backing-up-Azure-VMs" class="headerlink" title="Troubleshoot backing up Azure VMs"></a>Troubleshoot backing up Azure VMs</h2><p>When configuring backups for an Azure VM, follow best practice guidelines. If you encounter problems with backing up an Azure VM, try the following:</p>
<h3 id="Step-1-Basic-troubleshooting-1"><a href="#Step-1-Basic-troubleshooting-1" class="headerlink" title="Step 1: Basic troubleshooting"></a>Step 1: Basic troubleshooting</h3><ul>
<li>Is the Azure VM provisioning state ‘Running’? The backup will not run if it is in a Stopped&#x2F;Deallocated&#x2F;Updating state. You might see the error message: VM is not in a state that allows backups.</li>
<li>Are there any pending operating system updates or does the VM need to reboot? Install system updates and reboot before retrying the backup.</li>
<li>Does the Azure VM have internet connectivity?</li>
<li>Is another backup service running? Two backup services cannot run at the same time. If you suspect another backup has not left a snapshot extension, <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout">uninstall extensions</a> to force a reload, then try the backup again.</li>
<li>Is antivirus software preventing the backup from running? If so, you might see the error message: antivirus configured in the VM is restricting the execution of backup extension. To resolve this issue, in the antivirus configuration, exclude the directories below:</li>
</ul>
<p>C:\Packages\Plugins\Microsoft.Azure.RecoveryServices.VMSnapshot</p>
<p>C:\WindowsAzure\Logs\Plugins\Microsoft.Azure.RecoveryServices.VMSnapshot</p>
<h3 id="Step-2-Check-the-Azure-VM-Guest-Agent"><a href="#Step-2-Check-the-Azure-VM-Guest-Agent" class="headerlink" title="Step 2: Check the Azure VM Guest Agent"></a>Step 2: Check the Azure VM Guest Agent</h3><ul>
<li>Is the Azure VM Guest Agent service installed and started? Go to services.msc to check it is running then try rebooting the VM.</li>
<li>Is the Microsoft Azure VM Guest Agent the latest version?</li>
</ul>
<h3 id="Step-3-Check-Azure-VM-extension-health"><a href="#Step-3-Check-Azure-VM-extension-health" class="headerlink" title="Step 3: Check Azure VM extension health"></a>Step 3: Check Azure VM extension health</h3><ul>
<li>Are all Azure VM extensions in the ‘provisioning succeeded’ state? From the Azure portal, go to the VM, then Settings. From the Extensions menu, select Extensions status.</li>
<li>Have all <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/extensions/overview">extension issues</a> been resolved?</li>
</ul>
<h3 id="Step-4-Check-the-Azure-backup-agent"><a href="#Step-4-Check-the-Azure-backup-agent" class="headerlink" title="Step 4: Check the Azure backup agent"></a>Step 4: Check the Azure backup agent</h3><ul>
<li>Is the Windows or Linux VM operating system supported? Refer to the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-support-matrix-iaas">IaaS VM Backup Support Matrix</a> for supported versions.</li>
<li>Is the VM agent up-to-date? Azure VMs are backed up by installing a backup agent. Check that the backup agent is installed and it’s a recent version.</li>
<li>Is the Azure Backup option grayed out? Hover over the grayed-out option to find out the reason.</li>
<li>Is antivirus software blocking the extension? If there are log entries in Event Viewer Application logs with the faulting application name IaaSBcdrExtension.exe then it could be the antivirus software.</li>
<li>Are there entries in the Event Log? The Event Log may show backup failures from products other than Azure Backup. If Azure Backup is failing, find the corresponding error code in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout">Common Issues</a> to discover the solution.</li>
</ul>
<p>For an up-to-date list of common error messages, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vms-troubleshoot">Troubleshoot backup errors with Azure VMs - Azure Backup | Microsoft Docs</a>.</p>
<h2 id="Troubleshoot-Azure-Backup-Server-issues"><a href="#Troubleshoot-Azure-Backup-Server-issues" class="headerlink" title="Troubleshoot Azure Backup Server issues"></a>Troubleshoot Azure Backup Server issues</h2><p>Microsoft Azure Backup Server (MABS), also known as Azure Backup Server, is the software used to back up a range of servers and workloads. For a complete list of what can be protected with MABS, see:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-mabs-protection-matrix">MABS (Azure Backup Server) V3 UR1 (and later) protection matrix</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/microsoft-azure-backup-server-protection-v3">Azure Backup Server V3 RTM protection matrix</a></li>
</ul>
<p>MABS must be installed on a dedicated, single-purpose server. The computer cannot be a domain controller, a node of a cluster, have Exchange Server running, have System Center Operations Manager running, or have the Application Server role installed. It must be a dedicated backup server.</p>
<p>Microsoft Azure Backup Server isn’t supported on Windows Server Core or Microsoft Hyper-V Server.</p>
<p>Microsoft Azure Backup Server must be part of a domain. You cannot move an existing MABS machine to a new domain after deployment.</p>
<p>Microsoft Azure Backup Server must be registered with a Recovery Services vault, whether backup data is stored locally or in Azure.</p>
<p>Run through the following questions to troubleshoot Azure Backup Server issues:</p>
<ul>
<li>Is there network connectivity between the MARS agent and the Azure server?</li>
<li>Is the MARS service running? In the Service console, start or restart the service and try the backup again.</li>
<li>Is the SQL Agent service running and set to automatic in the MABS server?</li>
<li>Is the MARS agent up-to-date?</li>
<li>Ensure no other process or antivirus software is interfering with Azure backup.</li>
<li>If Push install fails, check if DPM agent is already present. If yes, then uninstall the agent and install it again.</li>
<li>Ensure .NET Framework 4.5.2 or later is installed on the server.</li>
<li>Ensure the server on which you’re trying to install Azure Backup Server isn’t already registered with another vault.</li>
<li>Configure antivirus software for MABS server.</li>
<li>Check where MABs is installed, and what else is installed on that server.</li>
<li>Check the backup vault credentials.</li>
</ul>
<h2 id="Troubleshoot-scheduled-backups"><a href="#Troubleshoot-scheduled-backups" class="headerlink" title="Troubleshoot scheduled backups"></a>Troubleshoot scheduled backups</h2><p>There are two types of policies for scheduled backups:</p>
<ul>
<li>Default backup policy – the default policy backs up the VM once a day, retaining the backups for 30 days.</li>
<li>Custom policy – you define whether backups run daily or weekly, and specify how long to retain the backup.</li>
</ul>
<p>If you have problems with scheduled backups, try the following:</p>
<ul>
<li>The VMs must be in the same region and subscription as the recovery vault.</li>
<li>If you get a message saying the recovery point is crash-consistent, check whether the VM is switched on. If the VM is not on, it will be backed up as an offline VM and the recovery point will be crash-consistent. This means that Azure gives no guarantee about the consistency of the data on the storage medium.</li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/troubleshoot/system-center/dpm/troubleshoot-scheduled-backup-job-failures">Troubleshoot scheduled backup job failures - Data Protection Manager | Microsoft Docs</a></li>
</ul>
<h1 id="Troubleshoot-recovery-issues-with-Microsoft-Azure"><a href="#Troubleshoot-recovery-issues-with-Microsoft-Azure" class="headerlink" title="Troubleshoot recovery issues with Microsoft Azure"></a>Troubleshoot recovery issues with Microsoft Azure</h1><p>Completed100 XP</p>
<ul>
<li>9 minutes</li>
</ul>
<p>When you have created a backup, you may need to recover the data as part of a planned migration, or in case of data loss. In this unit, you will learn how to troubleshoot data recovery for different scenarios.</p>
<h2 id="Troubleshoot-file-recovery-for-an-Azure-VM-backup"><a href="#Troubleshoot-file-recovery-for-an-Azure-VM-backup" class="headerlink" title="Troubleshoot file recovery for an Azure VM backup"></a>Troubleshoot file recovery for an Azure VM backup</h2><p>When you recover data from an Azure VM backup you have three options to restore the data:</p>
<ul>
<li>File Recovery</li>
<li>Restore VM</li>
<li>Disk restore. Only the disks are restored, which can then be used to create a new VM or replace a disk on an existing VM.</li>
</ul>
<p>To recover files, select the <strong>File Recovery</strong> option. It is then a three-step process to recover the files:</p>
<ol>
<li>Select a recovery point. This is the date when your files were available.</li>
<li>Download a script. The script will mount the drives storing your files. The drives will remain mounted for 12 hours for you to restore the files you need.</li>
<li>Unmount the drives and close the connection.</li>
</ol>
<p>The following sections provide troubleshooting information when common error messages appear:</p>
<h3 id="Error-message-Exception-caught-while-connecting-to-target"><a href="#Error-message-Exception-caught-while-connecting-to-target" class="headerlink" title="Error message: Exception caught while connecting to target"></a>Error message: Exception caught while connecting to target</h3><p>This may appear if the script is unable to access the recovery point. To resolve this issue:</p>
<ol>
<li>Check that the machine running the script has access to the recovery vault.</li>
<li>Verify the connection to the Azure target IP addresses. To check, run the following from an elevated command prompt: nslookup download.microsoft.com or ping download.microsoft.com</li>
<li>Ensure access to iSCSI outbound port 3260.</li>
<li>Check for a firewall or NSG blocking traffic to Azure target IPs or recovery service URLs.</li>
<li>Check that antivirus software isn’t preventing the script from running.</li>
</ol>
<p>Also check the following common error messages:</p>
<h3 id="Error-message-The-target-has-already-been-logged-in-via-an-iSCSI-session"><a href="#Error-message-The-target-has-already-been-logged-in-via-an-iSCSI-session" class="headerlink" title="Error message: The target has already been logged in via an iSCSI session"></a>Error message: The target has already been logged in via an iSCSI session</h3><p>This might be caused by the script already running on the same machine, and the drives are already attached. Browse the available volumes using File Explorer to find the mounted drives.</p>
<h3 id="Error-message-This-script-is-invalid-because-the-disks-have-been-dismounted-via-portal-x2F-exceeded-the-12-hr-limit-Download-a-new-script-from-the-portal"><a href="#Error-message-This-script-is-invalid-because-the-disks-have-been-dismounted-via-portal-x2F-exceeded-the-12-hr-limit-Download-a-new-script-from-the-portal" class="headerlink" title="Error message: This script is invalid because the disks have been dismounted via portal&#x2F;exceeded the 12-hr limit. Download a new script from the portal"></a>Error message: This script is invalid because the disks have been dismounted via portal&#x2F;exceeded the 12-hr limit. Download a new script from the portal</h3><p>This message appears if you attempt to run the script more than 12 hours after you downloaded it. You need to download another script from the portal.</p>
<h3 id="Error-message-ExtensionSnapshotFailedCOM"><a href="#Error-message-ExtensionSnapshotFailedCOM" class="headerlink" title="Error message: ExtensionSnapshotFailedCOM"></a>Error message: ExtensionSnapshotFailedCOM</h3><p>The backup operation failed due to an issue with the Windows service COM+ System application. To resolve this issue, follow these steps:</p>
<ol>
<li>Try starting&#x2F;restarting Windows service COM+ System Application (from an elevated command prompt – net start COMSysApp).</li>
<li>Ensure Distributed Transaction Coordinator service is running as Network Service account. If not, change it to run as Network Service account and restart COM+ System Application.</li>
<li>If unable to restart the service, then reinstall Distributed Transaction Coordinator service by following the steps below:</li>
<li>Stop the MSDTC service</li>
<li>Open a command prompt (cmd)</li>
<li>Run the command msdtc -uninstall</li>
<li>Run the command msdtc -install</li>
<li>Start the MSDTC service</li>
<li>Start the Windows service COM+ System Application. After the COM+ System Application starts, trigger a backup job from the Azure portal.</li>
</ol>
<p>For an up-to-date list of common error messages and recommended action, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vm-file-recovery-troubleshoot">Troubleshoot Azure VM file recovery - Azure Backup | Microsoft Docs</a>.</p>
<h2 id="Troubleshoot-restoring-using-Microsoft-Azure-Recovery-Services-MARS-backup-agent"><a href="#Troubleshoot-restoring-using-Microsoft-Azure-Recovery-Services-MARS-backup-agent" class="headerlink" title="Troubleshoot restoring using Microsoft Azure Recovery Services (MARS) backup agent"></a>Troubleshoot restoring using Microsoft Azure Recovery Services (MARS) backup agent</h2><p>To restore data that has been backed up using Microsoft Azure Recovery Services (MARS):</p>
<ol>
<li>From the MARS agent home screen, select Recover Data. The Recover Data Wizard is displayed.</li>
<li>Specify where you want to restore the data.</li>
<li>Select the data to restore, and the date and time it was backed up. These selections determine the data recovery point.</li>
<li>Select Mount to mount the disk containing the recovery point then select the location where you want to recover the data.</li>
<li>Confirm your selections before starting the data recovery.</li>
</ol>
<p>When you installed the MARS agent, an encryption passphrase was generated. This is stored in a text file and should be kept somewhere safe. If the passphrase is lost, you cannot recover any data backed up by the MARS backup agent.</p>
<p>When the MARS agent is configured, you specify how long the backup data should be retained. Data will not be kept after this period of time.</p>
<h2 id="Troubleshoot-restore-issues-when-using-Azure-backup-agent"><a href="#Troubleshoot-restore-issues-when-using-Azure-backup-agent" class="headerlink" title="Troubleshoot restore issues when using Azure backup agent"></a>Troubleshoot restore issues when using Azure backup agent</h2><p>When you recover an Azure Virtual Machine from a backup, a process server is used to handle the data. If you encounter problems with restoring data, use a step-by-step methodology:</p>
<h3 id="Step-1-Monitor-process-server-health"><a href="#Step-1-Monitor-process-server-health" class="headerlink" title="Step 1: Monitor process server health"></a>Step 1: Monitor process server health</h3><p>It is good practice to proactively monitor the process server when restoring data. This allows you to monitor alerts, and handle issues as they occur.</p>
<p>The following graphic summarizes the steps to troubleshoot a backup recovery:</p>
<ol>
<li>Are all services running?</li>
<li>Is the CPU state OK?</li>
<li>Is the memory state OK?</li>
<li>Is cache free space OK?</li>
<li>Does the process server have a heartbeat?</li>
<li>Troubleshoot connection&#x2F;replication issues.</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-steps-backup-recovery.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-steps-backup-recovery.png" alt="Screenshot of steps to troubleshoot a backup recovery."></a></p>
<h2 id="Troubleshoot-restore-issues-from-Microsoft-Azure-Backup-Server-MABS"><a href="#Troubleshoot-restore-issues-from-Microsoft-Azure-Backup-Server-MABS" class="headerlink" title="Troubleshoot restore issues from Microsoft Azure Backup Server (MABS)"></a>Troubleshoot restore issues from Microsoft Azure Backup Server (MABS)</h2><p>Azure Backup Server is designed to back up and restore workloads such as Hyper-V VMs, Microsoft SQL Server, SharePoint Server, Microsoft Exchange, and Windows clients.</p>
<p>If you have problems restoring from MABS, try the following troubleshooting checklist:</p>
<h3 id="Check-the-installation-folder"><a href="#Check-the-installation-folder" class="headerlink" title="Check the installation folder"></a>Check the installation folder</h3><p>The default installation folders for DPM are as follows:</p>
<p>C:\Program Files\Microsoft Azure Backup Server\DPM\DPM</p>
<p>You can also run the following command to find the install folder path:</p>
<p>Reg query “HKLM\SOFTWARE\Microsoft\Microsoft Data Protection Manager\Setup”</p>
<h3 id="Invalid-vault-credentials"><a href="#Invalid-vault-credentials" class="headerlink" title="Invalid vault credentials"></a>Invalid vault credentials</h3><p>When you register to a vault, if you get an error message saying invalid vault credentials have been provided, either you have a corrupt file, or you provided incorrect credentials. Try the following:</p>
<ol>
<li>Download the latest credentials file from the vault and try again.</li>
<li>Try downloading the credentials to a different local directory or create a new vault.</li>
<li>Try updating the date and time settings as described in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-mars-troubleshoot">this article</a>.</li>
<li>Check to see if c:\windows\temp has more than 65000 files. Move stale files to another location or delete the items in the Temp folder.</li>
<li>Check the status of certificates.</li>
<li>In Control Panel, open <strong>Manage Computer Certificates</strong>.</li>
<li>Expand the <strong>Personal</strong> node and its child node <strong>Certificates</strong>.</li>
<li>Remove the certificate <strong>Windows Azure Tools</strong>.</li>
<li>Retry the registration in the Azure Backup client.</li>
<li>Check to see if a group policy is in place.</li>
</ol>
<h3 id="Replica-is-inconsistent"><a href="#Replica-is-inconsistent" class="headerlink" title="Replica is inconsistent"></a>Replica is inconsistent</h3><p>In the Protection Group Wizard, verify that the automatic consistency check option is turned on.</p>
<p>In the case of System State&#x2F;BMR backup, verify that Windows Server Backup is installed on the protected server.</p>
<ul>
<li>Check for space-related issues in the DPM storage pool on the DPM&#x2F;Microsoft Azure Backup Server and allocate storage as required.</li>
<li>Check the state of the Volume Shadow Copy Service on the protected server. If it’s in a disabled state, set it to start manually. Start the service on the server then go back to the DPM&#x2F;Microsoft Azure Backup Server console, and start the sync with the consistency check job.</li>
</ul>
<h3 id="Online-recovery-point-creation-failed"><a href="#Online-recovery-point-creation-failed" class="headerlink" title="Online recovery point creation failed"></a>Online recovery point creation failed</h3><p>If you get an error message saying “the Windows Azure Backup Agent was unable to create a snapshot of the selected volume”, try increasing the available space in the recovery point volume.</p>
<p>If you get an error message saying “the Windows Azure Backup Agent cannot connect to the OBEngine service”, try verifying that the OBEngine exists in the list of running services on the computer. If the OBEngine service is not running, use the “net start OBEngine” command to start it.</p>
<p>If you get an error message saying that “the encryption passphrase for this server is not set. Please configure an encryption passphrase”, try configuring an encryption passphrase. If that fails, take the following steps:</p>
<ol>
<li>Verify that the scratch location exists. This is the location that’s mentioned in the registry <strong>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows Azure Backup\Config</strong>, where the name <strong>ScratchLocation</strong> should exist.</li>
<li>If the scratch location exists, try re-registering by using the old passphrase.</li>
</ol>
<p> Note</p>
<p>When you configure an encryption passphrase, always save it in a secure location.</p>
<h2 id="Troubleshoot-hybrid-scenarios"><a href="#Troubleshoot-hybrid-scenarios" class="headerlink" title="Troubleshoot hybrid scenarios"></a>Troubleshoot hybrid scenarios</h2><h3 id="Troubleshoot-site-recovery-with-Hyper-V"><a href="#Troubleshoot-site-recovery-with-Hyper-V" class="headerlink" title="Troubleshoot site recovery with Hyper-V"></a>Troubleshoot site recovery with Hyper-V</h3><p>When recovering an on-premises Hyper-V VM to Azure, use Azure Site Recovery. If you experience issues, use the following checklist to troubleshoot the problem:</p>
<ul>
<li>Do all your Hyper-V hosts and VMs meet the requirements and prerequisites for recovery?</li>
<li>Check the “Support for disaster recovery of on-premises Hyper-V VMs to Azure” link at the end of this module.</li>
<li>If Hyper-V hosts are managed by Virtual Machine Manager (VMM), the VMM server must have at least one cloud and one or more host groups. The Hyper-V hosts running the VMs should be in the cloud with network mapping between on-premises VMM VM networks, and Azure virtual networks. See links in the Summary of this module.</li>
<li>Check the log located in <strong>Applications and Services Logs</strong> &gt; <strong>Microsoft</strong> &gt; <strong>Windows</strong>.</li>
<li>On the guest VM, verify that WMI is enabled and accessible.<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/wmisdk/wmi-troubleshooting">Troubleshoot</a> WMI.</li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/previous-versions/tn-archive/ff406382(v=msdn.10)">Troubleshoot</a> problems with WMI scripts and services.</li>
</ul>
</li>
<li>On the guest VM, ensure that you have the latest version of Integration Services and it is running. Microsoft recommends keeping integration services up-to-date.</li>
</ul>
<p>Also, check common error messages:</p>
<h3 id="Cannot-enable-protection-as-the-virtual-machine-is-not-highly-available"><a href="#Cannot-enable-protection-as-the-virtual-machine-is-not-highly-available" class="headerlink" title="Cannot enable protection as the virtual machine is not highly available"></a>Cannot enable protection as the virtual machine is not highly available</h3><p>Try restarting the VMM service on the VMM machine. If that doesn’t work, try removing the virtual machine from the cluster and adding it again.</p>
<h3 id="The-VSS-writer-NTDS-failed-with-status-11-and-writer-specific-failure-code-0x800423F4"><a href="#The-VSS-writer-NTDS-failed-with-status-11-and-writer-specific-failure-code-0x800423F4" class="headerlink" title="The VSS writer NTDS failed with status 11 and writer specific failure code 0x800423F4"></a>The VSS writer NTDS failed with status 11 and writer specific failure code 0x800423F4</h3><p>To resolve this issue, upgrade to Windows Server R2 with 4072650 applied. Also, check that the Hyper-V host has Windows 2016 or later installed.</p>
<h3 id="Troubleshoot-site-recovery-with-VMware"><a href="#Troubleshoot-site-recovery-with-VMware" class="headerlink" title="Troubleshoot site recovery with VMware"></a>Troubleshoot site recovery with VMware</h3><p>Before you restore a VMware VM, ensure it meets <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/vmware-physical-azure-support-matrix">Azure requirements</a>.</p>
<p>Verify properties as follows:</p>
<ol>
<li>In <strong>Protected Items</strong>, select <strong>Replicated Items</strong>, and then select the VM you want to verify.</li>
<li>In the <strong>Replicated item</strong> pane, there’s a summary of VM information, health status, and the latest available recovery points. Select <strong>Properties</strong>.</li>
<li>In <strong>Compute and Network</strong>, you can modify these properties as needed:<ul>
<li>Azure name</li>
<li>Resource group</li>
<li>Target size</li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-availability-sets">Availability set</a></li>
<li>Managed disk settings</li>
</ul>
</li>
<li>You can view and modify network settings, including:<ul>
<li>The network and subnet in which the Azure VM will be located after failover.</li>
<li>The IP address that will be assigned to it.</li>
</ul>
</li>
<li>In <strong>Disks</strong>, review operating system information, and data disks on the VM.</li>
</ol>
<p>To run a failover to Azure, in <strong>Settings</strong>, select <strong>Replicated items</strong>, select the VM to fail over, and then select <strong>Failover</strong>.</p>
<p>In <strong>Failover</strong>, select a <strong>Recovery Point</strong> to fail over to. You can use one of the following options:</p>
<ul>
<li><strong>Latest</strong>: This option first processes all the data sent to Site Recovery. It provides the lowest Recovery Point Objective (RPO) because the Azure VM that’s created after failover has all the data that was replicated to Site Recovery when the failover was triggered.</li>
<li><strong>Latest processed</strong>: This option fails the VM over to the latest recovery point processed by Site Recovery. This option provides a low RTO (Recovery Time Objective) because no time is spent processing unprocessed data.</li>
<li><strong>Latest app-consistent</strong>: This option fails the VM over to the latest app-consistent recovery point processed by Site Recovery.</li>
<li><strong>Custom</strong>: This option lets you specify a recovery point.</li>
</ul>
<p>You then select <strong>Shut down machine before beginning failover</strong> to attempt to shut down source VMs before triggering the failover. Failover continues even if the shutdown fails. You can follow the failover progress on the Jobs page.</p>
<p>In some scenarios, failover requires additional processing that takes around 8 to 10 minutes to complete. You might notice longer test failover times for:</p>
<ul>
<li>VMware VMs running a Mobility service version older than 9.8.</li>
<li>Physical servers.</li>
<li>VMware Linux VMs.</li>
<li>Hyper-V VMs protected as physical servers.</li>
<li>VMware VMs that don’t have the DHCP service enabled.</li>
<li>VMware VMs that don’t have the following boot drivers: storvsc, vmbus, storflt, intelide, atapi.</li>
</ul>
<p> Note</p>
<p>Don’t cancel a failover in progress. If you cancel a failover in progress, the VM won’t replicate again.</p>
<p>If you have problems, try the following troubleshooting steps:</p>
<ol>
<li>Monitor process server health. In the Azure portal, monitor the process servers to verify they are connected and working.</li>
<li>Check connectivity between the source server and the process server, and between the process server and Azure.</li>
<li>Check that the source machine is available for replication, specifically:<ul>
<li>Check that two VMs don’t have the same UUID. Refer to <a target="_blank" rel="noopener" href="https://social.technet.microsoft.com/wiki/contents/articles/32026.asr-vmware-to-azure-how-to-cleanup-duplicatestale-entries.aspx">Azure Site Recovery VMware-to-Azure: How to clean up duplicate or stale entries</a>.</li>
</ul>
</li>
<li>Ensure the <strong>vCenter credentials</strong> are correct when you set up the configuration server, by using the OVF template or unified setup. To verify the credentials, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/vmware-azure-manage-configuration-server#modify-credentials-for-automatic-discovery">Modify credentials for automatic discovery</a>.</li>
<li>If insufficient permissions are provided to access vCenter, failure to discover virtual machines might occur. Ensure that the permissions described in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/vmware-azure-tutorial-prepare-on-premises">Prepare an account for automatic discovery</a> are added to the vCenter user account.</li>
<li>Management servers cannot be replicated. If the VM is used as one or more of the following roles—Configuration server &#x2F; scale-out process server &#x2F; Master target server—then you will not be able to choose the virtual machine from the portal.</li>
<li>If the virtual machine is already protected or failed over through Site Recovery, it will not be available to select for protection in the portal. Ensure that the virtual machine isn’t already protected by any other user, or under a different subscription.</li>
<li>Check if vCenter is in connected state. To verify, go to <strong>Recovery Services vault</strong> &gt; <strong>Site Recovery Infrastructure</strong> &gt; <strong>Configuration Servers</strong> &gt; <strong>Click on respective configuration server</strong>. A pane opens on the right with details of associ&#x2F;rvers. Check if vCenter is connected. If it’s in a “Not Connected” state, resolve the issue and then refresh the configuration server on the portal. After this, virtual machine will be listed on the portal.</li>
<li>If the ESXi host under which the VM resides is in powered off state, then virtual machine will not be listed or will not be selectable on the Azure portal. Power on the ESXi host, and refresh the configuration server on the portal. After this, virtual machine will be listed on the portal.</li>
<li>If there is a pending reboot, you will not be able to select the VM on the Azure portal. Complete the pending reboot and refresh the configuration server. They should then be listed on the portal.</li>
<li>If the virtual machine doesn’t have a valid IP address associated with it, you will not be able to select the machine on the Azure portal. Assign a valid IP address to the virtual machine, and refresh the configuration server. This could also be caused by the machine not having a valid IP address associated with one of its NICs. Either assign a valid IP address to all NICs or remove the NIC that’s missing the IP.</li>
</ol>
<h3 id="Troubleshoot-site-recovery-with-SCCM"><a href="#Troubleshoot-site-recovery-with-SCCM" class="headerlink" title="Troubleshoot site recovery with SCCM"></a>Troubleshoot site recovery with SCCM</h3><p>A System Center Configuration Manager (SCCM) site recovery is needed if a site fails, or you lose data in the site database. Site recovery includes repairing and resynchronizing the data.</p>
<p>If you experience problems, try the following troubleshooting issues:</p>
<ol>
<li>Check that previous configurations are not on the site server, as this can cause conflicts. Remove previous configurations before restoring Configuration Manager by using one of the following methods:<ul>
<li>Restoring to a new server.</li>
<li>Formatting the disks and reinstalling the operating system.</li>
<li>Cleaning an existing server, including deleting registry entries starting with SMS from HKLM\System\CurrentControlSet\Services.</li>
</ul>
</li>
<li>For site database recovery only before restoring Configuration Manager:<ul>
<li>Back up the site database, including supporting databases such as WSUS.</li>
<li>Note the SQL Server name and instance name.</li>
<li>Delete the site database from the SQL Server.</li>
<li>Restart the SQL Server.</li>
</ul>
</li>
<li>Clean an existing server for full recovery before restoring Configuration Manager:<ul>
<li>Back up the site database, including supporting databases such as WSUS.</li>
<li>Make a copy of the content library.</li>
<li>Uninstall the Configuration Manager site.</li>
<li>Manually delete the site database from the SQL Server.</li>
<li>Manually delete the Configuration Manager installation folder, and any other Configuration Manager folders.</li>
<li>Restart the server.</li>
<li>Restore the content library and other databases like WSUS.</li>
</ul>
</li>
<li>Use a supported version and the same edition of SQL Server:<ul>
<li>Check that the version of SQL Server is both supported, and the same edition as the original. Restoring to a newer version of SQL Server is supported, providing you don’t change the edition—you can restore Standard to Standard and Enterprise to Enterprise.</li>
<li>Ensure SQL Server is not set to <strong>single-user mode</strong>.</li>
<li>Make sure the MDF and LDF files are valid. When you recover a site, there’s no check for the state of the files.</li>
</ul>
</li>
<li>SQL Server Always On availability groups:&#x2F;<ul>
<li>If you use SQL Server Always On availability groups to host the site database, modify your recovery plans as described in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/mem/configmgr/core/servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database">Prepare to use SQL Server Always On</a>.</li>
</ul>
</li>
<li>Database replicas:<ul>
<li>After you restore a site database that you configured for database replicas, reconfigure each replica. Before you can use the database replicas, recreate both the publications and subscriptions.</li>
</ul>
</li>
</ol>
<h2 id="Troubleshoot-site-to-site-recovery"><a href="#Troubleshoot-site-to-site-recovery" class="headerlink" title="Troubleshoot site-to-site recovery"></a>Troubleshoot site-to-site recovery</h2><p>Azure to Azure Site Recovery allows you to replicate Azure virtual machines (VMs) from one region to another. In case of problems, check the following:</p>
<h3 id="High-data-change-rate-on-the-source-virtual-machine"><a href="#High-data-change-rate-on-the-source-virtual-machine" class="headerlink" title="High data change rate on the source virtual machine"></a>High data change rate on the source virtual machine</h3><p>Azure Site Recovery creates an event if the data change rate on the source virtual machine is higher than the supported limits. Go to <strong>Replicated items</strong> &gt; <strong>VM</strong> &gt; <strong>Events</strong> - <strong>last 72 hours</strong>. You should see the event <strong>Data change rate beyond supported limits</strong>:</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-backup-center-data-change.png" alt="Screenshot that shows Data change rate beyond supported limits."></p>
<p>Select the event to display disk information:</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-disk-information.png" alt="Screenshot that shows disk information."></p>
<h3 id="Azure-Site-Recovery-limits"><a href="#Azure-Site-Recovery-limits" class="headerlink" title="Azure Site Recovery limits"></a>Azure Site Recovery limits</h3><p>Azure Site Recovery limits are data churn per disk and data churn per virtual machine. The actual limits vary according to specific configurations. For example, a single VM Site Recovery can handle 5MB&#x2F;s of churn per disk and a maximum of five disks. Site Recovery has a limit of 54MB&#x2F;s of total churn per VM.</p>
<p>To find out whether this is a recurring problem, check the data change rate of the relevant virtual machine under <strong>Monitoring</strong>. You will need to add the metrics shown in the following screenshot:</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/3-data-change-rate.png" alt="Screenshot that shows O S Disk Writes Bytes per Sec."></p>
<h3 id="Network-connectivity-problems"><a href="#Network-connectivity-problems" class="headerlink" title="Network connectivity problems"></a>Network connectivity problems</h3><p>Site Recovery sends replicated data to the cache storage account. You might experience network errors if uploading the data from a virtual machine to the cache storage account is slower than 4MB in three seconds.</p>
<p>To check for latency problems, use the command-line utility <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10">AzCopy</a>. This uploads data from the virtual machine to the cache storage account. If the latency is high, check whether you’re using a network virtual appliance (NVA) to control outbound network traffic from VMs. The appliance might get throttled if all the replication traffic passes through the NVA.</p>
<p>Microsoft recommends creating a network service endpoint in your virtual network for “Storage” so that the replication traffic doesn’t go to the NVA.</p>
<h3 id="Network-connectivity"><a href="#Network-connectivity" class="headerlink" title="Network connectivity"></a>Network connectivity</h3><p>Site Recovery needs the VM to provide outbound connectivity to specific URLs or IP ranges. You might have your VM behind a firewall or use network security group (NSG) rules to&#x2F;l outbound connectivity. If so, you might experience issues. Make sure all the URLs are connected. For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking">Outbound connectivity for URLs</a>.</p>
<p>For an up-to-date list of common issues, see: <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-troubleshoot-replication">Troubleshoot replication of Azure VMs with Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a>.</p>
<h1 id="Exercise-Troubleshoot-business-continuity-issues"><a href="#Exercise-Troubleshoot-business-continuity-issues" class="headerlink" title="Exercise: Troubleshoot business continuity issues"></a>Exercise: Troubleshoot business continuity issues</h1><p>Completed100 XP</p>
<ul>
<li>7 minutes</li>
</ul>
<p>You’ve been asked to make a backup of a virtual machine. The backup must be application consistent.</p>
<p> Important</p>
<p>You need your own <a target="_blank" rel="noopener" href="https://azure.microsoft.com/free/">Azure subscription</a> to complete the exercises in this module. If you don’t have an Azure subscription, you can still view the demonstration video at the bottom of this page.</p>
<h2 id="Create-the-exercise-environment"><a href="#Create-the-exercise-environment" class="headerlink" title="Create the exercise environment"></a>Create the exercise environment</h2><p>Using the Cloud Shell on the right, run these commands to create the example topology. The environment will take approximately 5 minutes to build.</p>
<ol>
<li><p>Clone the setup script from GitHub.</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/MicrosoftDocs/mslearn<span class="literal">-business-continuity</span> networking</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run the setup script.</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">networking/setup.ps1</span><br></pre></td></tr></table></figure>
</li>
<li><p>The script will create all the resources. Wait until it completes, you should see a <strong>Lab Environment Created</strong> message.</p>
</li>
</ol>
<h2 id="Create-a-backup"><a href="#Create-a-backup" class="headerlink" title="Create a backup"></a>Create a backup</h2><ol>
<li><p>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> using your own subscription.</p>
</li>
<li><p>Select the portal menu on the top left, select <strong>Virtual machines</strong>, and then select <strong>labvm</strong>.</p>
</li>
<li><p>If the VM is running, select <strong>Stop</strong>, and wait for the <strong>Status</strong> to show <strong>Stopped (deallocated)</strong>.</p>
</li>
<li><p>In the left navigation pane, under <strong>Operations</strong>, select <strong>Backup</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-azure-backup-welcome.png" alt="Screenshot showing the back up welcome screen."></p>
</li>
<li><p>Enter the following settings, and then select <strong>Enable Backup</strong>.</p>
<ul>
<li>Recovery Services vault: <strong>Create new</strong></li>
<li>Backup vault: <strong>labdemo</strong></li>
<li>Choose backup policy: <strong>DefaultPolicy-labdemo</strong></li>
</ul>
</li>
<li><p>This takes you back to the <strong>Virtual machines</strong> page, select <strong>labvm</strong>.</p>
</li>
<li><p>In the left navigation pane, under <strong>Operations</strong>, select <strong>Backup</strong>.</p>
</li>
<li><p>Select <strong>Backup now</strong>, and then select <strong>OK</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-machine-backup-screen.png" alt="Screenshot showing the backup screen."></p>
</li>
<li><p>The backup starts, and runs in two phases.</p>
<ul>
<li>In the first phase, it takes a snapshot of the VM. This takes about 10 minutes.</li>
<li>In the second phase, it moves the data into the recovery services vault. This takes about 50 minutes.</li>
</ul>
</li>
</ol>
<h2 id="Monitor-progress-of-the-first-phase"><a href="#Monitor-progress-of-the-first-phase" class="headerlink" title="Monitor progress of the first phase"></a>Monitor progress of the first phase</h2><p>You won’t see anything in the Backup page of the VM until the backup has completed. However, you can monitor it in the Backup center.</p>
<ol>
<li><p>In the Azure portal, search for <strong>backup center</strong>, and then under <strong>Services</strong>, select <strong>Backup center</strong>.</p>
</li>
<li><p>In the left navigation pane, under <strong>Monitoring + reporting</strong>, select <strong>Backup jobs</strong>. You should see your job running.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-backup-instances.png" alt="Screenshot showing the backup job running."></p>
</li>
<li><p>Select the backup job to see more info. You can see in the screen picture that the first phase has completed.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-single-backup.png" alt="Screenshot showing a single backup instance."></p>
</li>
</ol>
<h2 id="View-results-of-first-phase"><a href="#View-results-of-first-phase" class="headerlink" title="View results of first phase"></a>View results of first phase</h2><p>When the first phase has completed, you can see that it is <strong>Crash Consistent</strong>.</p>
<ol>
<li><p>In the breadcrumb trail, select <strong>Backup center</strong>.</p>
</li>
<li><p>In the left navigation pane, under <strong>Manage</strong>, select <strong>Backup instances</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-multiple-backups.png" alt="Screenshot showing multiple backup instances."></p>
</li>
<li><p>Scroll down until you see <strong>labvm</strong> and select <strong>labvm</strong>. This shows that the backup is <strong>Crash Consistent</strong>. This is incorrect, the backup should be <strong>Application Consistent</strong>. You need to find out why and fix the problem.</p>
<p> Note</p>
<p>Only the first phase has completed, and the data will now be transferring to the vault. You can continue with the lab; you don’t have to wait for this to complete.</p>
</li>
</ol>
<h2 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h2><p>The VM was in a <strong>Stopped</strong> state. You need to start the VM and wait for it to be in a running state before making another backup.</p>
<ol>
<li><p>Select the portal menu on the top left, select <strong>Virtual machines</strong>, and then select <strong>labvm</strong>.</p>
</li>
<li><p>Select <strong>Start</strong>, and wait for the <strong>Status</strong> to show <strong>Running</strong>.</p>
</li>
<li><p>In the left navigation pane, under <strong>Operations</strong>, select <strong>Backup</strong>.</p>
</li>
<li><p>On the <strong>labvm</strong> page, you should see that there is one <strong>Crash Consistent</strong> restore point.</p>
</li>
<li><p>Select <strong>Backup now</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-backup-screen.png" alt="Screenshot of the backup screen."></p>
</li>
<li><p>On the <strong>Backup now</strong> page, select <strong>OK</strong>. The second backup will be an incremental backup and should take less time than the first backup.</p>
</li>
<li><p>You can monitor progress in the <strong>Backup center</strong>.</p>
</li>
<li><p>When the first phase is complete, navigate to the <strong>Backup</strong> page of the VM. The send backup is <strong>Application Consistent</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/business-continuity/media/4-crash-instance-restore-point.png" alt="Screenshot showing the crash consistent restore point."></p>
</li>
</ol>
<p>In this demonstration you will see how to proactively troubleshoot Conditional Access policies using the What if tool in the Azure portal:</p>
<iframe src="https://www.microsoft.com/en-us/videoplayer/embed/RE4Ubfe?postJsllMsg=true" frameborder="0" allowfullscreen="true" data-linktype="external" title="Video Player" style="box-sizing: inherit; outline-color: inherit; margin: 0px; padding: 0px; border: 0px; width: 640px; height: 360px; position: absolute; inset: 0px;"></iframe>



















<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>In this module, you have learned how to troubleshoot common backup and restore issues when working in Azure.</p>
<p>Now that you have completed this module, you’ll be able to:</p>
<ul>
<li>Review the status of a backup job, manage alerts, and review logs.</li>
<li>Troubleshoot backing up and restoring a virtual machine (VM).</li>
<li>Troubleshoot Microsoft Azure Recovery Services backups.</li>
<li>Troubleshoot backing up and restoring servers.</li>
<li>Troubleshoot Azure to Azure Site Recovery.</li>
<li>Troubleshoot site recovery with Hyper-V, SCCM, and VMware.</li>
</ul>
<h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><p>Use these resources to discover more.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-center-support-matrix">Support matrix for Backup center</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-center-monitor-operate">Monitor and operate backups using Backup Center - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/monitoring-and-alerts-overview">Monitoring and reporting solutions for Azure Backup - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-monitoring-use-azuremonitor">Monitor Azure Backup with Azure Monitor - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-monitoring-built-in-monitor">Monitor Azure Backup protected workloads - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/azure-policy-configure-diagnostics">Configure Vault Diagnostics settings at scale - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-monitoring-built-in-monitor">Monitoring Azure Backup workloads</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-action-rules?tabs=portal">Alert processing rules for Azure Monitor alerts - Azure Monitor | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-mabs-troubleshoot">Troubleshoot Azure Backup Server - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-vm-backup-fails-snapshot-timeout">Troubleshoot Agent and extension issues - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-mars-troubleshoot">Troubleshoot the Azure Backup agent - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/hyper-v-azure-troubleshoot">Troubleshoot Hyper-V disaster recovery with Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-troubleshoot-replication">Troubleshoot replication of Azure VMs with Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/vmware-azure-troubleshoot-replication">Troubleshoot replication issues for disaster recovery of VMware VMs and physical servers to Azure by using Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vm-file-recovery-troubleshoot">Troubleshoot Azure VM file recovery - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vms-troubleshoot">Troubleshoot backup errors with Azure VMs - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-troubleshoot-slow-backup-performance-issue">Troubleshoot slow backup of files and folders - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/mem/configmgr/core/servers/manage/recover-sites">Site recovery - Configuration Manager | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/mem/configmgr/core/servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database">Prepare to use an availability group - Configuration Manager | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-support-matrix-iaas">Support matrix for Azure VM backup - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/microsoft-azure-backup-server-protection-v3">Azure Backup Server V3 RTM protection matrix</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-mabs-protection-matrix">MABS (Azure Backup Server) V3 UR1 (and later) protection matrix</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/site-recovery-overview">About Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction">About Azure VM backup - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-file-folder-backup-faq">Microsoft Azure Recovery Services (MARS) Agent – FAQ - Azure Backup | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/vmware-azure-tutorial">Set up VMware VM disaster recovery to Azure with Azure Site Recovery - Classic - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/hyper-v-azure-support-matrix">Support for disaster recovery of Hyper-V VMs to Azure with Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/hyper-v-prepare-on-premises-tutorial">Prepare for disaster recovery of Hyper-V VMs to Azure with Azure Site Recovery - Azure Site Recovery | Microsoft Docs</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking">Network virtual appliance configuration</a>.</li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-arm-vms-prepare">Back up Azure VMs in a Recovery Services vault - Azure Backup | Microsoft Docs</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/14/gcp-digital-leader-exam-Cert-Prep-Google-Cloud-Digital-Leader-14/" rel="prev" title="gcp-digital-leader-exam-Cert-Prep-Google-Cloud-Digital-Leader-14">
      <i class="fa fa-chevron-left"></i> gcp-digital-leader-exam-Cert-Prep-Google-Cloud-Digital-Leader-14
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-720-Troubleshoot-name-resolution-issues-in-Microsoft-Azure-2/" rel="next" title="AZ-720-Troubleshoot-name-resolution-issues-in-Microsoft-Azure-2">
      AZ-720-Troubleshoot-name-resolution-issues-in-Microsoft-Azure-2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Learning-objectives"><span class="nav-number">1.1.</span> <span class="nav-text">Learning objectives</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prerequisites"><span class="nav-number">1.2.</span> <span class="nav-text">Prerequisites</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-backup-issues-with-Microsoft-Azure"><span class="nav-number">2.</span> <span class="nav-text">Troubleshoot backup issues with Microsoft Azure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Review-backup-status-in-the-Azure-portal"><span class="nav-number">2.1.</span> <span class="nav-text">Review backup status in the Azure portal</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Review-and-respond-to-backup-alerts"><span class="nav-number">2.1.1.</span> <span class="nav-text">Review and respond to backup alerts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Alerts-by-email-notification"><span class="nav-number">2.1.2.</span> <span class="nav-text">Alerts by email notification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Review-and-interpret-backup-logs"><span class="nav-number">2.1.3.</span> <span class="nav-text">Review and interpret backup logs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting-backups-with-Microsoft-Azure-Recovery-Services-MARS"><span class="nav-number">2.2.</span> <span class="nav-text">Troubleshooting backups with Microsoft Azure Recovery Services (MARS)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-Basic-troubleshooting"><span class="nav-number">2.2.1.</span> <span class="nav-text">Step 1: Basic troubleshooting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-Troubleshoot-versions-and-other-steps"><span class="nav-number">2.2.2.</span> <span class="nav-text">Step 2: Troubleshoot versions and other steps</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-backing-up-Azure-VMs"><span class="nav-number">2.3.</span> <span class="nav-text">Troubleshoot backing up Azure VMs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-Basic-troubleshooting-1"><span class="nav-number">2.3.1.</span> <span class="nav-text">Step 1: Basic troubleshooting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-Check-the-Azure-VM-Guest-Agent"><span class="nav-number">2.3.2.</span> <span class="nav-text">Step 2: Check the Azure VM Guest Agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-Check-Azure-VM-extension-health"><span class="nav-number">2.3.3.</span> <span class="nav-text">Step 3: Check Azure VM extension health</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-Check-the-Azure-backup-agent"><span class="nav-number">2.3.4.</span> <span class="nav-text">Step 4: Check the Azure backup agent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Azure-Backup-Server-issues"><span class="nav-number">2.4.</span> <span class="nav-text">Troubleshoot Azure Backup Server issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-scheduled-backups"><span class="nav-number">2.5.</span> <span class="nav-text">Troubleshoot scheduled backups</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-recovery-issues-with-Microsoft-Azure"><span class="nav-number">3.</span> <span class="nav-text">Troubleshoot recovery issues with Microsoft Azure</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-file-recovery-for-an-Azure-VM-backup"><span class="nav-number">3.1.</span> <span class="nav-text">Troubleshoot file recovery for an Azure VM backup</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-message-Exception-caught-while-connecting-to-target"><span class="nav-number">3.1.1.</span> <span class="nav-text">Error message: Exception caught while connecting to target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-message-The-target-has-already-been-logged-in-via-an-iSCSI-session"><span class="nav-number">3.1.2.</span> <span class="nav-text">Error message: The target has already been logged in via an iSCSI session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-message-This-script-is-invalid-because-the-disks-have-been-dismounted-via-portal-x2F-exceeded-the-12-hr-limit-Download-a-new-script-from-the-portal"><span class="nav-number">3.1.3.</span> <span class="nav-text">Error message: This script is invalid because the disks have been dismounted via portal&#x2F;exceeded the 12-hr limit. Download a new script from the portal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-message-ExtensionSnapshotFailedCOM"><span class="nav-number">3.1.4.</span> <span class="nav-text">Error message: ExtensionSnapshotFailedCOM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-restoring-using-Microsoft-Azure-Recovery-Services-MARS-backup-agent"><span class="nav-number">3.2.</span> <span class="nav-text">Troubleshoot restoring using Microsoft Azure Recovery Services (MARS) backup agent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-restore-issues-when-using-Azure-backup-agent"><span class="nav-number">3.3.</span> <span class="nav-text">Troubleshoot restore issues when using Azure backup agent</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-Monitor-process-server-health"><span class="nav-number">3.3.1.</span> <span class="nav-text">Step 1: Monitor process server health</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-restore-issues-from-Microsoft-Azure-Backup-Server-MABS"><span class="nav-number">3.4.</span> <span class="nav-text">Troubleshoot restore issues from Microsoft Azure Backup Server (MABS)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Check-the-installation-folder"><span class="nav-number">3.4.1.</span> <span class="nav-text">Check the installation folder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Invalid-vault-credentials"><span class="nav-number">3.4.2.</span> <span class="nav-text">Invalid vault credentials</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Replica-is-inconsistent"><span class="nav-number">3.4.3.</span> <span class="nav-text">Replica is inconsistent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Online-recovery-point-creation-failed"><span class="nav-number">3.4.4.</span> <span class="nav-text">Online recovery point creation failed</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-hybrid-scenarios"><span class="nav-number">3.5.</span> <span class="nav-text">Troubleshoot hybrid scenarios</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Troubleshoot-site-recovery-with-Hyper-V"><span class="nav-number">3.5.1.</span> <span class="nav-text">Troubleshoot site recovery with Hyper-V</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cannot-enable-protection-as-the-virtual-machine-is-not-highly-available"><span class="nav-number">3.5.2.</span> <span class="nav-text">Cannot enable protection as the virtual machine is not highly available</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-VSS-writer-NTDS-failed-with-status-11-and-writer-specific-failure-code-0x800423F4"><span class="nav-number">3.5.3.</span> <span class="nav-text">The VSS writer NTDS failed with status 11 and writer specific failure code 0x800423F4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Troubleshoot-site-recovery-with-VMware"><span class="nav-number">3.5.4.</span> <span class="nav-text">Troubleshoot site recovery with VMware</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Troubleshoot-site-recovery-with-SCCM"><span class="nav-number">3.5.5.</span> <span class="nav-text">Troubleshoot site recovery with SCCM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-site-to-site-recovery"><span class="nav-number">3.6.</span> <span class="nav-text">Troubleshoot site-to-site recovery</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#High-data-change-rate-on-the-source-virtual-machine"><span class="nav-number">3.6.1.</span> <span class="nav-text">High data change rate on the source virtual machine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Azure-Site-Recovery-limits"><span class="nav-number">3.6.2.</span> <span class="nav-text">Azure Site Recovery limits</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-connectivity-problems"><span class="nav-number">3.6.3.</span> <span class="nav-text">Network connectivity problems</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-connectivity"><span class="nav-number">3.6.4.</span> <span class="nav-text">Network connectivity</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-Troubleshoot-business-continuity-issues"><span class="nav-number">4.</span> <span class="nav-text">Exercise: Troubleshoot business continuity issues</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-the-exercise-environment"><span class="nav-number">4.1.</span> <span class="nav-text">Create the exercise environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-a-backup"><span class="nav-number">4.2.</span> <span class="nav-text">Create a backup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Monitor-progress-of-the-first-phase"><span class="nav-number">4.3.</span> <span class="nav-text">Monitor progress of the first phase</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#View-results-of-first-phase"><span class="nav-number">4.4.</span> <span class="nav-text">View results of first phase</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Resolution"><span class="nav-number">4.5.</span> <span class="nav-text">Resolution</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">5.</span> <span class="nav-text">Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Resources"><span class="nav-number">5.1.</span> <span class="nav-text">Resources</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
