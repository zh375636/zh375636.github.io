<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionHello, and welcome to this advanced course covering AWS subnets and routing within a VPC, a virtual private cloud. Throughout this course, I shall deep dive on both topics, looking at ho">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS-Security-Specialty-AWS-Virtual-Private-Cloud:-Subnets-and-Routing-38">
<meta property="og:url" content="https://example.com/2022/11/14/AWS-Security-Specialty-AWS-Virtual-Private-Cloud-Subnets-and-Routing-38/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionHello, and welcome to this advanced course covering AWS subnets and routing within a VPC, a virtual private cloud. Throughout this course, I shall deep dive on both topics, looking at ho">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-14T17:52:45.000Z">
<meta property="article:modified_time" content="2022-11-20T02:52:32.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/14/AWS-Security-Specialty-AWS-Virtual-Private-Cloud-Subnets-and-Routing-38/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AWS-Security-Specialty-AWS-Virtual-Private-Cloud:-Subnets-and-Routing-38 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/14/AWS-Security-Specialty-AWS-Virtual-Private-Cloud-Subnets-and-Routing-38/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AWS-Security-Specialty-AWS-Virtual-Private-Cloud:-Subnets-and-Routing-38
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-14 13:52:45" itemprop="dateCreated datePublished" datetime="2022-11-14T13:52:45-04:00">2022-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-19 22:52:32" itemprop="dateModified" datetime="2022-11-19T22:52:32-04:00">2022-11-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AWS-Security-Specialty/" itemprop="url" rel="index"><span itemprop="name">AWS-Security-Specialty</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/14/AWS-Security-Specialty-AWS-Virtual-Private-Cloud-Subnets-and-Routing-38/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/14/AWS-Security-Specialty-AWS-Virtual-Private-Cloud-Subnets-and-Routing-38/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <span id="more"></span>

<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hello, and welcome to this advanced course covering AWS subnets and routing within a VPC, a virtual private cloud. Throughout this course, I shall deep dive on both topics, looking at how each are used within a single and multiple VPC configuration, and also in conjunction with on-premise connectivity across a VPN.</p>
<p>Before we start, I would like to introduce myself. My name is Stuart Scott. I’m one of the trainers here at Cloud Academy, specializing in AWS, Amazon Web Services. Feel free to connect with me with any questions using the details shown on screen. Alternatively, you can always get in touch with us here at Cloud Academy using the community forum, where one of our cloud experts will reply to your question.</p>
<p>This course has been designed for engineers who are responsible for designing, configuring, and implementing AWS virtual private clouds, also for any one performing network configuration within AWS and on-premise solutions, also if you are connecting and configuring a hybrid cloud solution using AWS.</p>
<p>And it’s also for those who are network administrators and network architects, and those wishing to take the Certified Advanced Networking Specialty Certification. Throughout this course, I shall be focusing on VPC subnets and routing, and breaking each of these components down into the following lectures, starting with VPC CIDR blocks.This lecture focuses on the effects of subnetting your VPC CIDR block.</p>
<p>Then I’ll look at why you should subnet your VPC. Here we’ll look at some of the reasons that you might want to do this by looking at the advantages and benefits.</p>
<p>Then we’ll look at VPC subnets, and this lecture dives into what a VPC subnet looks like within the management console, and its associated components, such as network access controllers.</p>
<p>Next we’ll look at VPC peering and its subnet considerations. This lecture focuses on some of the considerations when architecting your subnets in different VPC peering configurations.</p>
<p>Following this, we’ll look at flow logs, and here we’ll take a look at how to monitor the ingress and egress network traffic of each of your VPC subnets using flow logs.</p>
<p>And to wrap up the subnet section, I’ll create a VPC and a number of subnets via a demonstration.</p>
<p>Following those lectures covering subnets, I will then look into AWS routing, and here I’ll cover routing fundamentals and route tables, and this lecture introduces AWS routing and its routing tables by breaking down all the components within it.</p>
<p>Next we’ll look at routing priorities, and here I will explain how the routing priorities are defined for overlapping routes within the same route table.</p>
<p>Next we’ll look at a number of routing configurations, starting with VPC peering, and this lecture looks at the different routing configs for multiple VPC peering scenarios.</p>
<p>And then we’ll do the same for VPN connectivity via a virtual private gateway.</p>
<p>And then following this, we’ll look at some more routing configurations that are used by internet gateways and NAT gateways, and the different dependencies involved here.</p>
<p>And then, lastly with regards to routing configurations, we’ll look at VPC endpoints, and this lecture looks at the automatic route configuration when creating a VPC endpoint.</p>
<p>Once you have completed this course, you will be able to design and implement an effective subnet structure within your VPCs, ensuring they meet specific requirements for your solutions. You’ll understand the differences between public and private subnets. And you will have the ability to architect successful routing configurations for your different VPC designs for both internal and external connectivity options. And you will have an awareness of different VPC gateways for external connectivity.</p>
<p>There are a number of pre-requisites for this course, and as this course is not a beginner’s course to AWS, it’s assumed you have a basic understanding of some of the AWS services specifically to do with a VPC. You should also have a basic understanding of network infrastructure and AWS connectivity, including a basic-level understanding of IPv4 and VPNs. You should also have a basic awareness of common protocols and IP addressing, and a basic awareness of VPC peering and VPC endpoints.</p>
<p>Feedback on our courses here at Cloud Academy are valuable to both us as trainers and any students looking to take the same course in the future. If you have any feedback, positive or negative, it would be greatly appreciated if you could use the comment section found in the landing page of this course.</p>
<p>That brings us to the end of this lecture. Coming up next, we start off by looking at VPC CIDR block ranges.</p>
<h1 id="VPC-CIDR-Blocks"><a href="#VPC-CIDR-Blocks" class="headerlink" title="VPC CIDR Blocks"></a>VPC CIDR Blocks</h1><p>Hello and welcome to this lecture. We’ll actually be talking about subnetting and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">VPC subnets</a> in detail.</p>
<p>Let me start by quickly talking about what is meant by subnetting. Subnetting is the process of splitting a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR block</a> into smaller CIDR blocks within the same range by using different subnet masks.</p>
<p>There are many reasons why you would want to do this and I’ll come on to these later in this lecture. Subnetting enables you to create smaller networks using a smaller CIDR range from your larger network IP address space. For example let’s say you had a CIDR block range of 10.0.0.0&#x2F;16. Which as itself gives you the following network details.</p>
<p>This is a large IP range to have as a single network as it allows for up to 65,534 hosts. To make better use of this range and to create smaller networks allowing segmentation within your network you could subnet the CIDR block into smaller CIDR ranges using a different subnet mask, such as &#x2F;17 for each subnet.</p>
<p>This would provide you with two different subnets with CIDR block ranges of 10.0.0.0&#x2F;17 and black 10.0.128.0&#x2F;17 providing the same range of host addresses minus the network and broadcast addresses for each subnet of course. You can see this by comparing the HostMin and HostMax entries between the three CIDR blocks.</p>
<p>Should you require more than just the two subnets which is likely than you can obviously split the original CIDR block further giving you more than just the two subnets I listed. For example, if I wanted 16 different subnets than I could subnet the CIDR block 10.0.0.0&#x2F;16 by using a subnet mask of &#x2F;20 for each subnet which would provide me with the following subnets.</p>
<p>Again this will provide the same range of host addresses minus the network and broadcast addresses for each subnet. Let’s now look at how the subnetting relates to your AWS VPC. When you create a VPC you are required to enter your VPC CIDR block range. This CIDR block range will encompass the entire IP address space that you can use within that VPC.</p>
<p>So you need to be sure that you set the correct mask allowing you to subnet the RP space into different networks should it be required. Whilst at the same time ensuring there are enough host IP addresses for your instances available within each subnet. As a result consideration must be put to your VPC CIDR block.</p>
<p>At this point it’s important to point out that the maximum and minimum masks for your VPC CIDR block are &#x2F;16 to &#x2F;28. A &#x2F;16 can provide you with 65,531 usable host addresses as one single subnet. A &#x2F;28 will provide you with just 11 host addresses as one single subnet. In addition to the network and broadcast address of the subnet which can’t be used for host addresses AWS reserves the first three host IP addresses of each subnet for internal AWS usage.</p>
<p>The first host address used is for the VPC router. The second address is reserved for AWS DNS and the third address is reserved for future use. Let’s look at this as an example. Sticking with the AWS VPC CIDR block of 10.0.0.0&#x2F;16 let’s imagine we want to create 16 subnets. We would use a &#x2F;20 mask for each subnet as previously mentioned.</p>
<p>In this scenario one of the 16 subnets would be detailed as follows. For this subnet the AWS reservations would be reserved as 10.0.32.1. And this would be for the VPC router as this is the first host address available in the subnet. 10.0.32.2 would be for the AWS DNS being the second available address. And thirdly 10.0.32.3 which would be reserved for any future use service or feature that may be used by AWS.</p>
<p>Which means your available host addresses for any instances would be from 10.0.32.4 through to 10.0.47.254 giving you a total of 4,091 usable host addresses. When allocating your VPC CIDR block range for your VPC it is mandatory to specify an IPv4 range, but you also choose to associate an IPv6 range to your VPC as well.</p>
<p>However when selecting an IPv6 you are not able to specify the range yourself but AWS will provide a &#x2F;56 IPv6 CIDR block for you from their pool of IPv6 addresses. Once you have allocated a CIDR block range for your VPC you are then ready to begin creating different subnets within your VPC. If you need help with your IP addressing and subnet calculations there are a number of free IP and subnet calculators available on the internet that will quickly help you define your requirements.</p>
<p>We have now come to the end of this lecture. Next I will focus on why we should consider adding subnets to a VPC.</p>
<h1 id="Why-Subnet-your-VPC"><a href="#Why-Subnet-your-VPC" class="headerlink" title="Why Subnet your VPC?"></a>Why Subnet your VPC?</h1><p>Hello and welcome to this lecture, where I try to answer the question of why we may want to Subnet our VPCs and what the benefits are by doing so.</p>
<p>Starting with logical network division. Creating multiple Subnets allows you to create logical network divisions between your resources. By doing so, you could have a Subnet for database instances, another for application servers, and another for web infrastructure.</p>
<p>By splitting up your Subnets this way, helps to enforce a greater level of security. Logical grouping of similar resources also helps you to maintain an ease of management across your infrastructure.</p>
<p>On this point, I remember being in a meeting with a network engineer many years ago. And someone around the table asked, “Why do we need to Subnet?” He responded with a question. “Does your house have more than one room? “ He then continued by saying, “It’s a similar thought process, your house has more than one room, as each room serves a different purpose, A kitchen, a lounge, a dining room, etc. Think of these as Subnets. The space in your house, your <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR block</a>, has been divided into smaller more manageable purpose specific rooms rather than one large room in which you can cook, clean and sleep in, which would soon become very disjointed.”</p>
<p>Security. By having multiple Subnets with similar resources grouped together, as per the previous point, it allows for greater security management. By implementing network level virtual firewalls, called network access control lists, or NACLs, it’s possible to filter traffic on specific ports from both an ingress and egress point at the Subnet level.</p>
<p>For example, if you had a Subnet that only held my SQL RTS databases within it, you could allow communication between your application service Subnet to talk to your database Subnet on port 1443 for my SQL. And then block and drop all other packets that do not meet this criteria. If you had web servers and application servers within the same Subnet as your RTS instances, you would have to open up a lot of other ports, reducing the level of security within that Subnet.</p>
<p>Having multiple Subnets allows you to create both private and public Subnets. Public Subnets allows the resources within it to access and connect to the internet, and the outside world to connect to those resources, depending on certain security controls. Private Subnets are not directly accessible from the internet. And so <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private Subnets</a> are protected from the outside world, providing a greater level of security by its very nature.</p>
<p>You may want some of your Subnets to route out to the internet, some to remain private, and some to communicate back to your corporate on premise network over a VPN link. Through the use of routing tables associated to each specific Subnet, you can route traffic as required to cater for these communication paths.</p>
<p>A Subnet can only belong to one route table at any time. Therefore, by creating multiple Subnets, you can restrict some resources in those Subnets to specific routes. If your solution requires a level of high availability, and it most likely will, then it’s best practice to deploy services across multiple availability zones within a region.</p>
<p>Here becomes a restriction of VPC Subnets in that a single Subnet cannot span across two availability zones. As a result, this best practice forces you to create an additional Subnet in the second availability zone. So if you want high availability within your environment, you’ll need Subnets in at least two availability zones in any region.</p>
<p>As we go through this course, you’ll see the benefits that this provides. As you can see, there are many advantages over creating multiple Subnets within your VPC. And as you design, architect and secure your infrastructure, you will quickly see how multiple Subnets enables ease of network management, rooting and security.</p>
<p>In the next lecture, I want to look at what a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">VPC Subnet</a> actually looks like and what its configurable components are.</p>
<h1 id="VPC-Subnets"><a href="#VPC-Subnets" class="headerlink" title="VPC Subnets"></a>VPC Subnets</h1><p>Hello, and welcome to this lecture covering AWS VPC Subnets.</p>
<p>So what does a subnet look like with an AWS, and what information does it contain? Well when the subnet is configured and created within the management console, it contains the data around the following components. Summary, Route Table, Network ACL, Flow Logs, and Tags.</p>
<p>Let’s look at the summary. The summary is just that, a summary of all the elements and metadata associated with the subnet. The Subnet-ID shows the automatically generated ID of the subnet along with its tag name. The Subnet-ID is a unique identifier for that subnet. You can use this value when configuring AWS through a command line interface, such as the AWS CLI.</p>
<p>For example, you could issue a following command to run an EC2 instance in this particular subnet. The IPv4 CIDR section shows the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR Block</a> associated to that subnet using IPv4. And the same applies for the IPv6 CIDR Block section too. The state of the subnet will either show as pending or available.</p>
<p>The VPC section shows the VPC that the subnet belongs to using its VPC ID, which again, is a unique identifier of the VPC, similar to that of the Subnet-ID. The available IPs list how many IP available addresses you have for your resources left within that subnet. If you try to launch an EC2 instance in your subnet, and it does not have enough free addresses, then you’ll get the following error.</p>
<p>Remember, in addition to the network and broadcast address of the subnet, three other IP addresses are reserved within the subnet for AWS purposes. The Availability Zone shows which AZ the subnet belongs in. And again, subnets cannot span more than one Availability Zone. The Route Table shows which Route Table the subnet is using and is shown by its Route Table ID and Tag name. More on AWS routing will be covered in an upcoming lecture.</p>
<p>The Network ACL, or NACLs, as I refer to, shows the subnet’s associated NACL. And again, by using its NACL ID. During the creation of a new VPC, the default Route Table and the default NACL are also created. These defaults are then associated to any subnet that did not have a custom Route Table or NACL associated.</p>
<p>The Default Subnet section identifies if the subnet was created by default from the default VPC that comes with your AWS account. The Auto-assign Public IP value can either be set to as yes or no, but I’ll talk more about this setting later in this lecture. And finally, the Auto-assign-IPv6 addresses again can be either set to yes or no.</p>
<p>The Route Table tab shows the Route Table that the subnet is using along with the route’s destinations and targets for that route. Further details on configuration of routes will be provided in an upcoming lecture so I won’t go into detail on this section right now.</p>
<p>The Network ACL, or NACL, shows the current NACL associated to the subnet and it will display both inbound and outbound rule sets.</p>
<p>If you haven’t created a custom NACL, then your subnet will automatically be associated with your VPC’s default NACL, which allows all traffic to flow in and out which, by default, provides no level of security, and so I highly recommend you either modify your default NACL or even better, create a custom NACL for each subnet.</p>
<p>NACLs provide a rule-based tool for controlling ingress and egress network traffic at the protocol and subnet level. In other words, NACLs monitor and filter traffic moving in and out of your subnet. NACLs are stateless by their design, meaning that any response traffic generated from a request will have to be specified in either the inbound or outbound rule set depending on the direction of response expected.</p>
<p>The rule set itself is very simple, and has both inbound and outbound list of rules, and these rules are comprised of just six different fields. These being, Rule Number, ACL rules are read in the ascending order, and as soon as a network packet is received, it reads each rule in ascending order until a match is found.</p>
<p>For this reason, you’ll want to carefully sequence your rules with an organized numbering system. I would suggest that you leave a gap of at least 50 between each of your rules to allow you to more easily add new rules in sequence later if it becomes necessary. Type, this dropdown list allows you to select from a list of common protocol types, including SSH, RDP, HTTP, and POP3.</p>
<p>You can alternatively specify custom protocols such as varieties of ICMP. Protocol, based on your choice for type, the protocol option might be grayed out. For custom rules like TCP&#x2F;UDP, however, you should provide a value. Port Range, if you do create a custom rule, you’ll need to specify the port range for the protocol to use.</p>
<p>Source, this can be a network subnet range, a specific IP address, or even left open to traffic from anywhere using the value of 0.0.0.0&#x2F;0.</p>
<p>Allow&#x2F;Deny, each rule must include an action, specifying whether the traffic will be permitted to either enter or leave the associated subnet or not.</p>
<p>The Flow Logs tab shows you any Flow Logs that you have set up and created for the subnet to capture IP traffic flow information. More information on Flow Logs will be covered in a later lecture.</p>
<p>Finally, the Tags tab allows you to add custom key value pairs to help with the tagging of your subnet. In this example, I added a Key of Name with a Value of Subnet A.</p>
<p>That brings us to the end of this lecture. Following this, I shall be talking about the differences between a public and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private subnet</a>.</p>
<h1 id="Public-amp-Private-Subnets"><a href="#Public-amp-Private-Subnets" class="headerlink" title="Public &amp; Private Subnets"></a>Public &amp; Private Subnets</h1><p>Hello, and welcome to this lecture. Where I want to discuss the differences between public and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private subnets</a>, and how they are defined. Now we have seen what a subnet looks like, I want to talk to you about both public and private subnets. In a nutshell, public subnets have direct access to the Internet, whereas your private instances do not.</p>
<p>So what makes a subnet public? There are essentially 2 components required to make any one of your subnets classed as a public subnet. Firstly, you need to create and attach an Internet gateway to your VPC. This Internet gateway is a managed service, controlled, configured, and maintained by AWS. It scales horizontally automatically, and is classified as a highly valuable component of your VPC infrastructure.</p>
<p>Once your Internet gateway is attached to your VPC, you have a gateway to the Internet. However, at this point, your instances have no idea how to get out to the Internet. As a result, you need to add a default route to the route table associated with your subnet. The route could have a destination value of 0.0. 0. 0&#x2F;0, and the target value will be set as your Internet gateway ID.</p>
<p>The destination value of 0.0.0.0&#x2F;0 essentially says for any destinations not already known to the route table, then use this route, which points to the target of the Internet gateway. With an Internet gateway attached, and a route in place, the subnet is now considered to be a public subnet.</p>
<p>There are, however, additional elements required before your instances within that public subnet can access the outside world. Any instance that you’re required to communicate with external resources on the Internet and beyond, will require a public IP address. Also, you’ll need to ensure that your public subnet NACL is not restricting or blocking expected ingress and egress traffic.</p>
<p>For example, if you are using http, and the NACL denied all traffic going over port 80, then you would run into problems very quickly. So to quickly recap, to enable the instances to communicate with the Internet, the following conditions must be true. The VPC must have an Internet gateway attached. The subnet must have a route, for example, 0.0.0.0&#x2F;0, with a target of the attached Internet gateway. The instances must have a public IP address assigned. And the associated NACL must allow ingress and egress traffic. Before moving on from this section, I just want to revisit a point I made about the public IP address allocation for the instances.</p>
<p>Depending on the IP addressing behavior of the subnet, these can either be automatically assigned to new instances launched within the subnet, or you must manually choose to have a public IP address for your instance. By default, all subnets have the automatic assigned of public IP addresses turned off.</p>
<p>Even when a subnet is considered a public subnet. The assignment remains as a manual process for instances. To modify the subnet IP addressing behavior from within the management console, you must first select the subnet within the VPC service, select subnet actions, then select Modify Auto Assign IP Settings.</p>
<p>Select the Tick box to enable auto assign public IPV4 addresses, and then click Save. The subnet will then automatically assign a public IP address to any instances that are launched within that subnet. Do be aware that for each instance created, you can overrule this decision. As you can see, although the default is Enable, it’s possible to select Disable for the instance.</p>
<p>Any public IP address assigned by this method is not directly associated to your AWS account. Instead it’s taken from a pull of addresses owned by AWS, and when the instance is no longer required, the IP address is released back into the AWS pull. You can’t request the same public IP address if you need to use it again.</p>
<p>If you acquire this functionality of being able to reuse, and reassign a public IP address, then you would need to use an elastic IP address, an EIP. Using an EIP is another option we have to give instances public IP addresses. So far, we have looked at VPC <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR Block</a> Ranges, and subnetting of these blocks into smaller side blocks for subnets, Subnet IP reservation addresses, why you would want and need to subnet your VPC, Public and private subnets within your VPC and subnet IP addressing behavior. However, does any of this change if you have multiple VPCs? What considerations need to be made if you are looking to peer multiple VPCs together?</p>
<p>In the next lecture, we will take a look at VPC peering subnet considerations.</p>
<h1 id="VPC-Peering-Subnet-Considerations"><a href="#VPC-Peering-Subnet-Considerations" class="headerlink" title="VPC Peering: Subnet Considerations"></a>VPC Peering: Subnet Considerations</h1><p>Hello, and welcome to this lecture, where I shall be discussing <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">subnets</a> when used for VPC peering.</p>
<p>Let me start by explaining what VPC peering is at a high level. VPC peering allows you to connect two or more VPCs together, using IPV4 or IPV6, as if they were a part of the same network.</p>
<p>Once the peer connectivity is established, resources in one VPC can access resources in the other. The connectivity between the VPCs is implemented through the existing AWS network infrastructure, and so it is highly available with no bandwidth bottleneck. As peered connections operate as if they were part of the same network, there are restrictions when it comes to your <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR block</a> ranges that can be used.</p>
<p>If you have overlapping or duplicate CIDR ranges for your VPC, then you’ll not be able to peer the VPCs together. So this is a design consideration if you plan on setting up multiple VPCs that you want to peer. Also from a design perspective, you are not able to daisy-chain VPCs together expecting them all to talk across one large network.</p>
<p>Each AWS VPC will only communicate with its peer. As an example, if you have a peering connection between VPC 1 and VPC 2, and another connection between VPC 2 and VPC 3 as shown, then VPC 1 and 2 could communicate with each other directly, as can VPC 2 and VPC 3, however, VPC 1 and VPC 3 could not. You can’t route through one VPC to get to another.</p>
<p>To allow VPC 1 and VPC 3 to talk directly, you would have to implement a separate peering connection, between VPC 1 and VPC 3 as shown. Interestingly, the daisy-chain diagram allows the possibility of having two of the VPCs to have overlapping or even identical VPC CIDR blocks.</p>
<p>Let’s say VPC 1 and VPC 3 have exactly the same CIDR block, which both connect to VPC 2. As the peer does not exist between VPC 1 and VPC 3, this is allowed without causing an issue. You may be wondering how this works from a routing perspective, if VPC 2 has two VPCs with the same CIDR block range, where does it know where to send traffic? I shall be covering VPC routing in an upcoming lecture, where this scenario will be discussed and explained.</p>
<p>Now, if we applied the same CIDR block settings in this example to the second scenario, where VPC 1 and VPC 3 were also peered, we would encounter configuration issues, and the peer connection would not be allowed due to overlapping CIDR blocks. We have now come to the end of this lecture covering VPC peering subnet considerations,</p>
<p>in the next lecture I shall be discussing flow logs, and how these can be used to monitor network traffic in and out of your subnets.</p>
<h1 id="Flow-Logs-VPC-Subnets"><a href="#Flow-Logs-VPC-Subnets" class="headerlink" title="Flow Logs: VPC Subnets"></a>Flow Logs: VPC Subnets</h1><p>Hello, and welcome to this short lecture examining flow logs for <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">VPC subnets</a>. As you create more and more subnets within your VPC, each with their own network access controls and route table, it won’t be long before you start to encounter communication issues with certain subnets not being able to talk to others over specific ports, or traffic is not being routed as expected.</p>
<p>When you start to troubleshoot these kinds of problems, you’re going to wish you have a helping hand. Within AWS, that comes in the form of VPC flow logs. These flow logs capture IP traffic going in and out of your network interfaces. And these flow logs can be created for subnets, your entire VPC, or even a single interface.</p>
<p>Once activated, the login information is sent to a CloudWatch log group, where you are able to filter information and monitor specific metrics. To set up flow logs for your subnet, first select Subnets within the VPC service in the management console. Select your subnet, select Subnet actions, select Create Flow Log.</p>
<p>You will then be prompted to enter a number of details to complete the setup. Let’s take a look at these.<br>- The filter. This allows you to specify the type of traffic to log. Available options are, all, accept, or reject.<br>- The role. As flow logs need to be able to publish data to a CloudWatch log group, permission is required in the form of a role. This role has five actions in the policy, and will look like the following. You must remember to ensure that the flow log service also has permission to assume the role itself, which can be added by modifying the trust relationship of the role to include the following policy.<br>- The destination log group name. Here you must enter the name of a CloudWatch log in which the data will be published to.</p>
<p>Once your subnet flow logs are set up, you will then be able to configure CloudWatch to monitor specific metrics with filters and use SNS to configure notifications for specific events. For more information on CloudWatch, please see our existing course here.</p>
<p>Coming up in the next lecture, I will be providing a demonstration on how to create a new VPC and configure both public and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private subnets</a>.</p>
<h1 id="Demonstration-Creating-a-VPC-amp-Subnets"><a href="#Demonstration-Creating-a-VPC-amp-Subnets" class="headerlink" title="Demonstration: Creating a VPC &amp; Subnets"></a>Demonstration: Creating a VPC &amp; Subnets</h1><p>Hello and welcome to this demonstration lecture on the creation of a VPC and different subnets. Now we understand the concepts of <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">subnets</a>, why we subnet, and the different types of subnets, public and private, I want to demonstrate how to create a VPC and a couple of the associated subnets.</p>
<p>In this demonstration, I will carry out the following steps:<br>- I’ll create a new VPC with a &#x2F;16 <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR Block</a>.<br>- I’ll then create and attach an Internet Gateway to the VPC<br>- I’ll then create and configure two subnets whilst allowing for the possibility of creating up to thirty two in total by using a &#x2F;21 twenty one mask<br>- and I’ll then configure one subnet as a public subnet.</p>
<p>Let’s take a look. Okay, so I’ve logged into the AWS management console and the first thing I want to do is go to the VPC. So I have a shortcut here and once that is loaded, I then want to look at creating a new VPC. Over on the left-hand side here, we can see my existing virtual private clouds. And it gives me opportunity here to create a new VPC.</p>
<p>So let’s create this VPC. I’ll give it a name, I’ll call it “Networking Demo”. And then here we can enter the IPv4 CIDR Block for the VPC and I want to use 10.0.0.0&#x2F;16 and we’re not going to use a IPv6 and keep it at default tenancy and then click create. That has now created our new VPC so now we have the new VPC and want to start creating some subnets.</p>
<p>So let’s go down to subnets, click on create subnet. Give it a name, we’ll call this “Public Subnet”. I’m going to have this within our new VPC that we just created so our networking demo VPC. And the availability zone, I don’t mind which AZ that’s in so I have no preference but I can select on availabilities in there if I want to.</p>
<p>So now I can enter the CIDR Block for this subnet and as I explained before I started this demo, I’m going to use a different mask than the VPC mask with &#x2F;16 so I want to allow for up to thirty two potential subnets so I’ll use this &#x2F;21. And so the first available subnet for me to use with the &#x2F;21 is 10.0.0.0&#x2F;21.</p>
<p>And then I shall create. And now we can see, we have our public subnet within our networking demo VPC. With this subnet mask of a &#x2F;21, we can see that we have 2043 host addresses available. I now have a public subnet, but at the moment there’s nothing public about it because we don’t have an Internet Gateway attached to our VPC, and we don’t have a route to Internet Gateway either.</p>
<p>So lets create another subnet, and we’ll call that “Private”. Let’s call that our <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private subnet</a>. Again, we’ll select the right VPC, networking demo, and again no preference for availability zone. For this subnet I’m going to use the last available subnet within that range, which is 10.0.248.0&#x2F;21, create.</p>
<p>Now I could have used any one of the 32 subnets, but for this demonstration I just thought I’d use the first subnet and the last available subnet. So now we have our private subnet within our networking demo VPC and again we have 2043 addresses available. So now what we need to do, we have our VPC set up, we have two subnets, one named “Public” and one named “Private” but now we need to make that public subnet to act as a public subnet.</p>
<p>For that we’ll need to create an Internet Gateway. Go down to Internet Gateways, click on create Internet Gateway. Give this a name, we’ll say networking demo, yes, create. And we have our Internet Gateway here and at the moment it’s detached, so we need to attach this Internet Gateway to our new VPC. So click on attach to VPC, select the appropriate VPC, which is networking demo and say yes, attach.</p>
<p>Now we have an Internet Gateway attached to our networking demo VPC. Now all I’ll want to do is create a new <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-fundamentals-and-route-tables/">route table</a> for the VPC with a route pointing to the Internet Gateway. If I go across to Route Tables, create Route Table, call this “Public Route Networking” and associate that to the networking VPC, create.</p>
<p>Here we have our new route, Public Route Networking. Go down to routes, we have our route table. We can see that we have this local route and what that does, it allows all subnets within this VPC to communicate with each other. But I want to edit this route table to add another route pointing to anywhere with a 0.0.0.0&#x2F;0 using our new Internet Gateway that we just created here.</p>
<p>Save that, and I now want to associate this route table to our public subnet. If we click on subnet associations, come across to edit, and select our public subnet, click save. We now have a public subnet within our new VPC, because what we’ve done, we’ve created our new VPC, we created two subnets, a public subnet and a private subnet. I then created and attached an Internet Gateway to our VPC. I then created a new route that pointed to the Internet Gateway for Internet traffic and I then associated that route table to our public subnet. Now any instances that I might launch in that public subnet can communicate with the Internet.</p>
<p>However, the private subnet cannot because if we look at our private subnet here and look at the route table we can see that it doesn’t have any route to the Internet Gateway. It can only talk internally to the other subnets but not any further, whereas our public subnet that we just associated a new route table with, we can see that it now has a route out to the Internet via the Internet Gateway. And that’s it.</p>
<p>Before I finish this lecture on VPC subnets, I just want to highlight a few more points around them.</p>
<p>When architecting and designing your VPC subnets across different availability zones, specifically for resiliency, I recommend you replicate the same configurations in both availability settings. This includes any public and private subnets. This ensures you maintain a mirror image of your network infrastructure should one AZ go down.</p>
<p>You should name your subnet something meaningful during creation, allowing you to quickly identify its use or other distinct information about that sublet. For example, web tier or database tier. Think about the amount of network and hosts required across your VPC, ensuring you have allocated a large enough CIDR Block.</p>
<p>Allow for future capacity growth for the number of subnets that you may need. Do not make the host IP addresses availability in your subnet too small unless you have a very specific reason. For example, by using a &#x2F;28 mask, if you run out of IP addresses for your instances within the subnet then you can’t make the subnet bigger.</p>
<p>The only option would be to make a bigger subnet and then migrate your resources across to the new subnet. This now brings us to the end of this lecture. Coming up next, I will be discussing VPC routing using the information we have just covered from these past few lectures.</p>
<h1 id="Routing-Fundamentals-amp-Route-Tables"><a href="#Routing-Fundamentals-amp-Route-Tables" class="headerlink" title="Routing Fundamentals &amp; Route Tables"></a>Routing Fundamentals &amp; Route Tables</h1><p><a target="_blank" rel="noopener" href="https://cloudacademy.com/course/designing-resilient-architectures/designing-for-disaster-recovery-1/">Hello and welcome</a> to this lecture, where I shall explain the fundamentals of AWS routing and take a look at the route tables themselves. Routing provides a mechanism to allow network packets to be forwarded to the correct destination. Within a VPC, this is all configured via routing tables associated to your subnets which use virtual routers that are fully managed by AWS.</p>
<p>This means you do not need to provision or configure any routers. When you create a new VPC an implicit router will be linked to your VPC as a part of your VPC creation process. If you remember from a previous lecture regarding <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">VPC subnets</a>, the first host IP address available within each subnet is always reserved to enable routing functionality for that subnet.</p>
<p>In addition to the implicit router linked to your VPC a default route table, known as the Main Route Table, is also created for your VPC. This Main Route Table cannot be deleted, however it can be customized by adding or removing routes to it. When you create a new subnet, this Main Route Table will be implicitly associated to it, unless you specify an alternate custom route table.</p>
<p>Remember, there has to be an associated route table for all subnets and a subnet can only have one route table association at any one time, although multiple subnets can all use the same root table. The Main Route Table will therefore act as the route table for any subnet that does not have a custom route table associated.</p>
<p>Let me now show you what a route table looks like and how to configure it. I’ll start by looking at an example of a default Main Route Table from within the Management Console. When any new route table is created it will contain data around five components, these being a summary, routes, subnet associations, route propagation and tags.</p>
<p>The summary pane shows just a few details, unlike the summary pane for the subnets which contained a lot more information.</p>
<p>The route table ID is issued automatically which is prefixed with rtb, which stands for route table. In this example, it’s been set to rtb-31bc7256. Similarly with the subnet ID, VPC ID and NACL ID, they’re all referenced when using the CLI tools to perform specific programmatic commands.</p>
<p>The explicitly associated with section shows how many subnets are explicitly associated with this route table. Subnets can either be explicitly or implicitly associated to a route table, and we’ll cover more on this when I come to subnet associations.</p>
<p>The main defines if this route table is the Main Route Table for the subnet and it will either be set to yes or no.</p>
<p>As we know, the Main Route Table will act as the route table for any subnet that does not have an explicit associated route table. The Main Route Table of a VPC can be updated and customized, but another route table can also take over as the Main Route Table. For example, you may have your Main Route Table set with a specific configuration which acts as an implicit association to many subnets within your VPC.</p>
<p>However, you want to change the routing of the Main Route Table without causing disruption and potential issues. So how would you achieve this? To start with, you would leave your Main Route Table serving implicit associations to those subnets using it. Next you would create a custom route table. You would then add the relevant routes that you need for the new Main Route Table to this newly created custom route table. Next you would explicitly associate that route table to a single subnet. And this subnet would then be using the new route table and not the Main Route Table. After this you would then test and confirm the routing would work as expected. And then from within the Management Console select route tables from the VPC Dashboard, select the newly created custom route table and then click on Set as Main Route Table and confirm the message.</p>
<p>This would then successfully act as the new Main Route Table for your VPC. You could then delete the old route table if it was no longer required.</p>
<p>Remember, you always have to have a Main Route Table within your VPC, but it doesn’t always have to be the same one that was created when the VPC was.</p>
<p>Lastly within the summary the VPC section simply shows which VPC this route table resides in, which is defined by the VPC ID and tag name.</p>
<p>Let’s now take a look at the routes tab. The routing pane shows the actual routing decisions that are made and this is where the routing of the network is defined. The table itself is comprised of four columns.</p>
<p>Destination, the destination field shows the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR block</a> ranges for any network that you need to route to, outside of your current subnet.</p>
<p>Target, the target field provides the gateway to allow you to get to that destination. For example, if you wanted to route back to your own on-premise network, you could have a destination field of 192.168.0.0&#x2F;16 with a target pointing to your virtual gateway, your VGW. This <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-vpn-connection-via-vgw/">virtual private gateway</a> is the gateway between your AWS VPC and a VPN connection back to your corporate network.</p>
<p>The status field will show you the status of your routes within the table, for example, Active. Propagated, the propagated field will define which routes within the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-fundamentals-and-route-tables/">route table</a> are propagated. I will cover more on route propagation later in this lecture. So, to reiterate, the destination points to the network you need to route to and the target provides the gateway for doing so.</p>
<p>You may have noticed that from this example Main Route Table that it comes with a pre-configured route. This route will have a destination value the same as your VPC CIDR block, with a target set to local. This is an important route and one that exists for every route table that is created. What this route does is to allow all subnets within your VPC to route to each other.</p>
<p>It provides a path from every subnet to every other subnet. The route does not have to be created manually, it is automatically created when you create any route table and it cannot be deleted. As by default and by design, AWS allow routes to and from all of your subnets within your VPC.</p>
<p>Now just because you have this local route that enables a known route and pathway between all subnets does not mean that a subnet that does not have an Internet gateway attached can access the Internet by knowing the route to a subnet that does.</p>
<p>The subnet has to have its own route to a gateway to be able to use it. If you have a lot of rules within your route table you can perform some basic level filtering by using the drop down list above the routes in the table. Here you can filter on all rules within the table, just IPv4 rules or just IPv6 rules.</p>
<p>To modify the routes within the table you must edit the route table using the Edit button. Here you can then add another route by entering the destination and target fields. The status and propagation fields are automatically determined. You can also remove any routes that you no longer need by selecting the cross in the remove field, but notice that you cannot delete the local route.</p>
<p>Like I mentioned previously, when a subnet is created it has to have an associated route table, and by default the Main Route Table will be associated implicitly to that subnet. If then a custom route table is associated to that subnet, replacing the implicit association of the Main Route Table, then that route table will become an explicit association to that subnet.</p>
<p>From this example we can see that there are no explicit subnet associations to this route table, as it states: ‘You do not have any subnet associations’. And you’ll generally find that when looking at the Main Route Table, simply because of the implicit nature that the Main Route Table has. We can also see any subnets that do not have any explicit associations, which are listed at the bottom of the route table.</p>
<p>If we compare this example to another route table that is not the Main Route Table, we can see a difference. This route table does have explicit subnet associations and these are listed as subnet B and subnet S. This means that these two subnets are not using the Main Route Table, instead they are explicitly connected to this route table.</p>
<p>However, again, like the Main Route Table, we can see the subnets that are implicitly associated to the Main Route Table, and you will always see any subnets associated to the Main Route Table and all root table subnet associations. The IPv4 CIDR and IPv6 CIDR fields will simply show the corresponding CIDR blocks for each subnet listed.</p>
<p>The route propagation pane allows you to enable propagation against any virtual private gateways that you have attached to your VPC. Once you enable route propagation with a selected virtual private gateway then routes representing your VPN connection will be added to your route table automatically and will be identifiable by being listed as Yes in the propagated field of the routing table.</p>
<p>Lastly, the tags tab provides the same function as it did with subnets, it allows you to add any custom key value pairs to help with the tagging of your route table. In this example, I added a name of Main Route Table.</p>
<p>That brings us to the end of this lecture. Next I want to talk to you about routing priorities and how these are managed.</p>
<h1 id="Routing-Priorities"><a href="#Routing-Priorities" class="headerlink" title="Routing Priorities"></a>Routing Priorities</h1><p>Hello and welcome to this lecture, where I want to discuss how <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-fundamentals-and-route-tables/">AWS route tables</a> manage routing priorities for overlapping routes.</p>
<p>A key point of understanding AWS routing, especially when it comes to troubleshooting, is to know how AWS route tables prioritizes these routes. For example, if there are overlapping destinations from a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR block</a> perspective, which target should AWS use to send the traffic to?</p>
<p>Remember, the destination points to the network you need to route to and the target provides the gateway for doing so. The rule of thumb is that AWS will use the most precise route available within the table to route traffic to a specific destination. This is also known as the Longest Prefix Match.</p>
<p>For example, let’s say you had four routes in your route table associated to a subnet as shown.</p>
<p>This subnet has its local route, like every subnet has, enabling all subnets within the VPC to route to each other. It also has an Internet gateway with a destination value of 0.0.0.0&#x2F;0. Then it has two routes on the 192.168 network. So if traffic from within your subnet needed to be routed to 192.168.1.1, which route would it use?</p>
<p>Like I said before, the rule of thumb will be the most specific, in this instance, the last route in the table with a destination of 192.168.1.0&#x2F;24 as this route has the Longest Prefix Match, even though it also falls within the boundaries of the third route. Let’s look at some more examples.</p>
<p>So the first column shows a number of IP addresses in this example that we are trying to reach. The second column shows the potential routes that those IP addresses could use, if looked at individually. Almost all of the IP addresses could use more than one route in the table. The third and fourth columns show the example root table entries used previously. The fourth column shows the selected route for the corresponding IP address. And the final column explains the reason why that particular IP address used that route. Feel free to pause the video and take a review of this table for a few minutes.</p>
<p>Now there are some circumstances where the Longest Prefix Match of a route is not selected within the route table and these are important to be aware of, as they could aid with any routing troubleshooting issues that may arise.</p>
<p>If you have any virtual gateways attached to your VPC and have enabled propagation for those virtual gateways and these propagated routes have overlapping destinations with your VPC’s local route, then your VPC local route will have precedence, even if your propagated routes across your VPN link have the Longest Prefix Match.</p>
<p>Also, again, if you have any propagated routes that have the same destination specified as any of your other existing static routes within your route table, then the rule of Longest Prefix Match will not be applied. Instead, the following priority is executed against any static routes that have the following gateways as their target first, the Internet Gateway, a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-vpn-connection-via-vgw/">Virtual Private Gateway</a>, a Network Interface, an Instance ID, a VPC Peering connection, a NAT Gateway, or a VPC Endpoint.</p>
<p>Let me take a look at a couple of examples where these may come into play. This route table contains two routes, one is the local route for all <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-subnets/">VPC subnets</a> and a second overlapping route that has been added through propagation via a Virtual Private Gateway. Any traffic destined to the 10.0.1.0&#x2F;24 network will be routed using the local VPC route over any propagated route, even though it has the Longest Prefix Match.</p>
<p>Another example, in this example the root table has three routes, one that is the local VPC route, a route to the Internet Gateway, and a propagated route to the same destination as the Internet Gateway route. Just to clarify, the Internet Gateway does not always have to point to 0.0.0. 0&#x2F;0 as it has done previously in this course. In some circumstances, you may only want to route to specific networks out to your Internet connection, rather than to everywhere. Any traffic that is destined for the 172.31.0.0&#x2F;16 network would have the potential of using two routes. However, in this scenario, all traffic to that network would use the Internet Gateway route, as that is a static route and has precedence over any propagated route. When managing route tables, including your static and any propagated routes.</p>
<p>Do be aware that there are limitations on the number of routes within a VPC in any one table. Currently, there is a default limit of 200 routes per VPC, however, you can request an increase if required. For each route table you have a default of 50 non-propagated routes, with a maximum increased limit of 100.</p>
<p>However, if you do increase the amount of routes you may notice some degradation to your network performance. This limit is separate for both IPv4 and IPv6 addressing, meaning you can potentially have up to 100 IPv4 routes and 100 IPv6 routes. The maximum propagated route limit is fixed at 100 per route table, and this limit cannot be increased.</p>
<p>So far, we have looked at AWS routing, covering what routing is, the route tables themselves, subnet associations, route propagation, routing priority and limitations. In the next few lectures I want to run through some examples of how routing is configured across a range of different designs and configurations, including routing to a VPC Peered Connection, a Virtual Private Gateway, a NAT Gateway, an Internet Gateway and a VPC Endpoint.</p>
<h1 id="Routing-VPC-Peering"><a href="#Routing-VPC-Peering" class="headerlink" title="Routing: VPC Peering"></a>Routing: VPC Peering</h1><p>Hello, and welcome to this lecture. We’re on to cover some example scenarios of routine configurations in different VPC peering solutions.</p>
<p>For connectivity to exist between VPCs over a peered connection, abbreviated as a pcx, then specific routing must be set up on each side of the peer in the relevant subnets of the VPC to allow each VPC to know where to route traffic to.</p>
<p>Setting up routing on peered VPCs can only exist if the IP CIDR blocks do not overlap in any way. In each peered subnet that you want to communicate with, you must ensure that the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-fundamentals-and-route-tables/">route table</a> being used in that subnet has a static route to either the peered VPC CIDR block or the CIDR block of the subnet in the peered VPC.</p>
<p>From this diagram, you can see that we have two subnets in each VPC. In VPC 1, we have a subnet A and B, and in VPC 2, subnet C and D. Subnet A in this VPC 1 has a static route in the table with a destination of the CIDR block of VPC 2 and a target of pcx-abcd1234, which is the peered gateway between the two VPCs.</p>
<p>Subnet B in the same VPC does not have a route pointing to the pcx. Similarly, in VPC 2, subnet C also has a route to VPC 1’s CIDR block by the pcx, and subnet D does not. In this scenario, subnet A and VPC 1 has a route to the entire IP address space of VPC 2, and subnet C and VPC 2 has a route to the entire IP address space of VPC 1.</p>
<p>Therefore, these two subnets have a route to each other to enable connectivity. Although VPC 1 can route to the entire IP address space of VPC 2, which would include subnet D, subnet D does not have a route in its routing table to enable traffic to route to VPC 1. This is also true for VPC 2 communicating with subnet B.</p>
<p>For every subnet that requires connectivity to a peered VPC, a route must exist in the route table for that subnet pointing to the pcx. Let’s now look at another example configuration of peering connections between VPCs. This time between three VPCs.</p>
<p>The peering connection between these VPCs offers connectivity to all VPCs from every other VPC. VPC 1 can communicate with 2 and 3, VPC 2 can communicate with 1 and 3, and VPC 3 can communicate with 1 and 2. In this scenario, three different peering connections are in place. As such, different pcx’s are used to connect the same VPC from every other VPC. For example, the route table in VPC 3 uses pcx-wxyz6789 to communicate with VPC 1, whereas VPC 2 uses pcx-abcd1234 to communicate with VPC 1.</p>
<p>Care must be taken when configuring your route tables to ensure you use the correct pcx to route your traffic to peered VPCs in a multiple VPC peering scenario such as this. One final example of VPC peering. Again with three VPCs, but this time, not all the VPCs can communicate with all others plus two of the VPCs have identical <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/vpc-cidr-blocks/">CIDR blocks</a>.</p>
<p>So, let’s take a look at the routing in this scenario. Both VPC 1 and 3 have a peering with VPC 2. You will notice that VPC 1 and VPC 3 have identical VPC CIDR blocks as well as the same subnet CIDR range. The route table for the subnet in VPC 1 is set up correctly to point to VPC 2 via the correct target of the pcx.</p>
<p>However, the route table of the subnet in VPC 2 poses a problem. It states that for any traffic destined for the 10.0.0.0&#x2F;16 network, then use the pcx which points to VPC 3 only. So, if a request comes from VPC 1 and a response is required, the response will be sent to VPC 3. Currently, VPC peering does not support unicast reverse path forwarding, which checks the source IP of packets and routes response packets back to the correct source.</p>
<p>To resolve this, you could rely on the longest periphics match roll when looking at route priorities. The route table of the 192.168.1.0&#x2F;24 subnet could be changed to the following to include a new route. Now if any traffic from VPC 1 in the subnet 10.0.1.0&#x2F;24 was destined for VPC 2, VPC 2 would respond correctly using the correct pcx of pcx-abcd1234, as this route has the longest periphics match.</p>
<p>For any other traffic on the 10.0.0.0&#x2F;16 network, it will route to VPC 3. You could be more specific with your route table on VPC 2 to route to different subnets within VPC 1 and VPC 3 as shown on the route tables.</p>
<p>Coming up in the next lecture, I’m going to look at routing configuration when using a virtual product gateway for VPN connectivity.</p>
<h1 id="Routing-VPN-Connection-via-a-Virtual-Private-Gateway"><a href="#Routing-VPN-Connection-via-a-Virtual-Private-Gateway" class="headerlink" title="Routing: VPN Connection via a Virtual Private Gateway"></a>Routing: VPN Connection via a Virtual Private Gateway</h1><p>Hello, and welcome to this short lecture on Virtual Private Gateway routing for VPN connectivity.</p>
<p>The AWS side of the routing configuration for a VPN connection over a Virtual Private Gateway is a little less complicated than that of VPC Peering.</p>
<p>Before you can set up a route for a VPN over a Virtual Private Gateway, you need to create and attach a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-vpn-connection-via-vgw/">Virtual Gateway</a> to your VPC.</p>
<p>These Virtual Gateways are used to help create a VPN connection between your VPC and your corporate network outside of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/amazon-web-services/">AWS</a>. There are many more points of configuration in setting up a VPN connection, which is outside the scope of this course. However, to simply configure the AWS routing, at this stage, all you require is the Virtual Gateway to be attached to your VPC.</p>
<p>Once your Virtual Gateway is created and added to your VPC, you can then update the route tables for any subnets that intend to route to your corporate date center network. However, to simply configure the AWS routing, at this stage, all you require is the Virtual Gateway to be attached to your VPC. Once your Virtual Gateway is created and added to your VPC you can then update the route tables for any subnets that intend to route to your corporate data center network.</p>
<p>In this diagram, we can see that an AWS subnet, 10.0.2.0&#x2F;24, has two static routes in its route table pointing to the two 172.16 subnets, which are located within the corporate data center outside of AWS. The destination networks have been added with a target pointing to the Virtual Gateway, listed as vgw1234abcd.</p>
<p>Any traffic destined for this network will then be directed to use this Virtual Gateway. You may remember from earlier, when I spoke about route propagation and the fact that it can be enabled when you have a Virtual Gateway attached to your VPC, by enabling propagation on this Virtual Private Gateway it will include the routes used in your VPN connection.</p>
<p>If you do not include propagation routing for your Virtual Gateway you will need to add static routes for all network used by the VPN connection that you want to route to, which is the case in this diagram. One point to mention is that AWS does not currently support IPv6 traffic across a VPN connection.</p>
<p>That brings us to the end of this short lecture, next up <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-internet-gateways-and-nat-gateways/">Routing for Internet Gateways and NAT Gateways</a>.</p>
<h1 id="Routing-Internet-Gateways-amp-NAT-Gateways"><a href="#Routing-Internet-Gateways-amp-NAT-Gateways" class="headerlink" title="Routing: Internet Gateways &amp; NAT Gateways"></a>Routing: Internet Gateways &amp; NAT Gateways</h1><p>Hello, and welcome to this lecture, where I want to look at how to configure routing for both internet gateways and NAT gateways. In a previous lecture, I talked about public and private subnets and how a public subnet is defined. A part of this public subnet definition is an association of an internet gateway.</p>
<p>This internet gateway, or IGW, as it’s known, provides a means of communicating out to the internet. This internet gateway is aservice, controlled, configured, and maintained by AWS. It scales horizontally automatically and is classified as a highly available component of your VPC infrastructure. Once your internet gateway’s attached to your VPC, you have a gateway to the internet.</p>
<p>Now you need to configure the subnet’s route table to point to this internet gateway, and therefore, makin’ it a public subnet. Often, the route is configured as follows. The destination value of 0.0.0. 0&#x2F;0 essentially implies that for any destinations that are not known by the route table, then use this route, which has a target pointing out to the internet gateway.</p>
<p>It’s essentially used as a catch-all, if no other route exists. However, the destination for the internet gateway doesn’t always have to point to all other destinations. You can have a destination pointing to a specific IP out on the internet, or to a specific range if required. You may need to do this for security and compliance reasons.</p>
<p>Any subnet which has a route table associated that points to an internet gateway is considered a public subnet, as it has connectivity out to the internet. Routing for a NAT gateway is slightly different, but also requires the use of a public subnet to be configured. To briefly explain, a NAT gateway allows instances within a private subnet access out to the internet; however, access to the instances within these private subnets cannot be initiated from the internet.</p>
<p>This diagram shows a VPC with two subnets, one public, 10.0.1.0&#x2F;24 and one private, 10.0.2.0&#x2F;24. The public subnet is configured with a route to the internet gateway and can access the internet as required. Instances in the private subnet, which are kept private for security reasons, but still need access to the internet for important operating system updates, and so need to be able to initiate a route to the internet.</p>
<p>The route table for the private subnet has a very similar route to the public subnet, in that they both have a destination route to 0.0.0.0&#x2F;0. The <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/public-and-private-subnets/">private subnet</a>, however, has a route to the NAT gateway instead, which is located within the public subnet. From here, the NAT gateway will provide internet connectivity.</p>
<p>From a design perspective, if you had multiple availability zones but only one NAT gateway configured, and the AZ went down which held the NAT gateway, all of your other private subnets across all AZs would not be able to connect to the internet. To resolve this, configure a public subnet in each AZ and update the route tables for all the private subnets in that availability zone to point to the new NAT gateway.</p>
<p>That way, if any AZ goes down, it will not affect the internet access for private instances within other AZs, as this will now be AZ-independent.</p>
<p>Coming up in the next lecture, routing configurations for <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-vpc-endpoints/">VPC endpoints</a>.</p>
<h1 id="Routing-VPC-Endpoints"><a href="#Routing-VPC-Endpoints" class="headerlink" title="Routing: VPC Endpoints"></a>Routing: VPC Endpoints</h1><p>Hello, and welcome to this lecture on the final routing configuration scenarios using VPC endpoints. A VPC endpoint is a virtual device which allows you to connect your VPC to another AWS service without traversing any gateway of any kind, such as an internet Gateway, a <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/aws-virtual-private-cloud-subnets-and-routing/routing-vpn-connection-via-vgw/">virtual gateway</a> or a NAT gateway.</p>
<p>Currently, the only supported endpoint is for S3, and when using these endpoints it doesn’t impose risks of availability or bandwidth across your VPC network, as it uses horizontally scaled, highly available VPC components, which are all held on the AWS network. When communicating between the VPC endpoint and your VPC, the traffic remains inside the global AWS network.</p>
<p>So how is this routing managed between your VPC subnet and these VPC endpoints? Well, the routing is implemented automatically. To create a VPC endpoint, select “Endpoints” from the VPC dashboard. Then select “Create endpoint” Then select your VPC, service endpoint and access policy for the service. Then select “Next step.”</p>
<p>At this point, in step two, “Configure Route Tables” you must select which route tables will be used to route the AWS service, which in this case, is S3. It will add a new rule for the new destination, with a target of the VPC ID. I shall create the endpoint in this example by selecting the main route table to see which route to add.</p>
<p>To complete setup, select “Create endpoint” As you can see, by completing the configuration of the VPC endpoint, it has automatically added a new route to the main route table, which I had selected in the previous section. The destination values and target values have automatically been added. That now brings us to the end of this lecture covering AWS routing across VPC endpoints.</p>
<p>Coming up next, we shall summarize what we have learnt throughout each of the previous lectures.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>Hello, and welcome to this final lecture. By now, you should have a solid understanding of how to architect your VPC subnets and configure routine appropriately for various different configurations and scenarios. However, in this last lecture, I just want to reiterate some of the key points that we made throughout the previous lectures.</p>
<p>We started off by looking at VPC CIDR blocks. Where this lecture focused on the effects of subnetting your VPC CIDR block and here were some of the key points.</p>
<p>- Subnetting is the process of splitting a CIDR block into smaller CIDR blocks within the same range of the larger block.<br>- Subnetting enables you to divide your VPC CIDR block into small networks.<br>- The VPC CIDR block range encompasses the entire IP address space that you can use within that VPC.<br>- The maximum and minimum masks for your VPC CIDR block are &#x2F;16 to &#x2F;28.<br>- AWS reserves the first three host IP addresses of each subnet for internal AWS usage. The first host is used for the VPC router. The second is for DNS and the third is reserved for future use.<br>- An IPv4 CIDR block range for your VPC is mandatory but you can also associate an IPv6 block as well.</p>
<p>Next we focused on the topic of why subnet your VPC? And here we looked at some of the reasons why you may want to subnet your VPC by looking at some of the advantages and benefits.</p>
<p>- Logical network division. When you create multiple networks it allows you to create logical network divisions between your resources.<br>- Security. By having multiple subnets with similar resources grouped together, as per the previous point it allows for greater security management.<br>- Accessibility. Having multiple subnets allows you to create both Private and Public subnets.<br>- Communication. You may want some of your subnets to route out the internet, some to remain private and some to communicate back to your corporate-on-premise network via VPN. Subnetting allows you to do this with the help of IWS routing.<br>- High availability. If your solution requires a level of high availability, it’s best practice to deploy services across multiple availability zones within a region. Remember, a single subnet cannot span across two availability zones.</p>
<p>Once we understood the reasoning of benefits behind VPC subnets I delved into what a VPC subnet looks like within the management console and its associated components such as the network access control list. Here we learned that the subnet itself has five components.</p>
<p>- The summary, and this summarizes all the elements and metadata associated with the subnet. Such as the IPv4 CIDR block, the VPC the Asian and route table associated exception.<br>- The Route Table. This defines which route table that the subnet is using along with its routes.<br>- The NACL. The network ACSL shows the current NACL associated to the subnet displaying both Inbound and Outbound rule sets.<br>- Flow Logs. Shows you any Flow Logs that you have set up and created for the subnet to capture IP traffic flow information.<br>- Tags. And this allows you to add any custom key value pairs to help with the tagging of your subnet.</p>
<p>Following the definitions made in this lecture I then discussed the different kinds of subnets, Private and Public. Key points of this lecture.<br>- Public subnets have direct access to the internet. Whereas your private subnets do not.<br>- There are 2 components required to make a public subnet. An attached Internet Gateway to your VPC and a route pointing to the target Internet Gateway.<br>- By default, all subnets have the automatic assigned of public IP addressing turned off<br>- You can modify IP addressing behavior of a subnet using the ‘modify auto-assign IP settings’ option within the Management Console for your subnet.</p>
<p>Next, I focused on what consideration should be made when peering VPCs together from a subnet point-of-view. The key points here were that:<br>- VPC peering allows you to connect two or more VPCs together using IPv4 or IPv6 as if they were a part of the same network.<br>- The connectivity between the VPCs is implemented through the AWS network, and so it is highly valuable with no bandwidth bottleneck.<br>- Overlapping or duplicate CIDR ranges between VPCs cannot be peered together. Each AWS VPC will only communicate with its peer.</p>
<p>Following this, I then covered how to monitor your subnets using Flow Logs.</p>
<p>-Subnet Flow Logs can help you troubleshoot networking problems.<br>- They can capture IP traffic going into and out of your network interfaces.<br>- The log data can be sent to a CloudWatch Logs log group where you are able to filter information and monitor specific metrics.</p>
<p>To end this section on subnets I then demonstrated how to set-up and configure a VPC with both public and private subnets.</p>
<p>Following this, I then spoke about AWS routing. Starting by looking at AWS routing fundamentals and route tables. Within this lecture, we learned that:</p>
<p>- Routing provides a mechanism to allow a network packets to be forwarded to the correct destination.<br>- Within the VPC, all routing is configured via routing tables associated to your subnets which use virtual routers that are fully managed by AWS.<br>- An implicit router will be linked to your VPC as a part of your VPC creation process.<br>- A default route table, known as the Main Route Table is also created for your VPC.<br>- The Main Route Table cannot be deleted.<br>- When you create a new subnet, this Main Route Table will be implicitly associated to it unless you specify an alternate custom route table.<br>- A subnet can only have one route table association at any one time. Although, multiple subnets can all use the same route table.<br>- Subnets can either be explicitly or implicitly associated to a route table.<br>- Any route table can take over as the Main Route Table.<br>- A route in the route table has values for destination, target, status and propagated fields.<br>- The destination field shows CIDR block ranges for any network that you need to route to outside of your current subnet.<br>- The target field provides the gateway to allow you to get to that destination.<br>- The status shows the states of your routes within the table.<br>- The propagated field will determine which routes within the route table are propagated via a virtual private gateway.<br>- The local route in every route table allows all subnets within your VPC to route to each other.<br>- Subnets can be explicitly associated to a route table.<br>- Route propagation via a private gateway will automatically add routes representing your VPN connection to the route table if propagation has been enabled for that virtual private gateway.</p>
<p>Next, routing priorities were discussed to understand how overlapping routes within the same route table were managed.</p>
<p>- The rule of thumb is that AWS will use the most precise route available within the table to route traffic to a specific target.<br>- This is also known as the longest prefix match.<br>- There are some circumstances where the longest prefix match route is not selected.<br>- When propagated routes have overlapping destinations with your VPCs local route, then your VPC local route will have precedence even if your propagated routes have the longest prefix match.<br>- If you have any propagated routes with the same destination as any existing static routes then the rule of longest prefix match will not be applied. Instead, the following priority is executed against any static routes that have the following gateways as the target first. Internet gateway, virtual private gateway network interface, an instance ID a VPC peering connection, a NAT gateway and, finally, a VPC endpoint.</p>
<p>Next I started to look at different routing configurations for different scenarios.</p>
<p>Starting off with VPC peering.</p>
<p>- A peered connection if pre-fixed with pcx in the target.<br>- Routing must be set up on each side of the peer to allow each VPC to know where to route traffic to.<br>- Peering can only exist if the IP CIDR blocks do not overlap in anyway.<br>- Every subnet that requires connectivity to a peered VPC, a route must exist in the route table for that subnet pointing to the pcx.<br>- VPC peering does not support unicast reverse path forwarding.<br>- Use the longest prefix-match rule for any VPC that is peered to multiple VPCs that have the same CIDR block ranges.</p>
<p>Next was the routing configuration for VPN connectivity via a virtual private gateway.</p>
<p>-Virtual private gateways are used to help create a VPN connection between your VPC and your corporate network outside of AWS.<br>- Before you can set up a route for a VPN over virtual private gateway you need to create and attach a virtual private gateway to your VPC.<br>- To route across your VPN, you must update the route tables for any subnets that intend to do so using the target of your virtual private gateway.<br>- By enabling propagation on this virtual private gateway your route table will automatically include the routes used by your VPN connection.<br>- If you do not enable propagation, you will need to add static routes for all the networks used by the VPN connection that you want to route to.<br>- AWS does not currently support IPv6 traffic across a VPN connection.</p>
<p>Following this, I then looked at routing for Internet gateways and NAT gateways.</p>
<p>-The Internet Gateway, or IGW, provides a means of communicating out to the Internet.<br>- Once your internet getway is attached to your VPC, you have a gateway to the internet.<br>- The destination value in a route table of 0.0.0.0&#x2F;0 essentially implies that for any destinations that are not known by the route table, then use this route.<br>- Any subnet which has a route table associated to that point is to an internet gateway is considered a public subnet.<br>- A NAT gateway allows instances within a private subnet access to the internet. However, access to the instances within these private subnets cannot be initiated from the internet.<br>- Instances in a private subnet must have a route to the NAT gateway which is located in the public subnet.<br>- Routing for a NAT gateway requires the use of a public subnet to be configured.</p>
<p>Then, finally, the last routing lecture I discussed was on VPC endpoints.</p>
<p>- A VPC endpoint is a virtual device which allows you to connect your VPC to another AWS service without traversing any gateway.<br>- Currently, the only supported endpoint is for S3.<br>- When communicating between the VPC endpoint and your VPC, the traffic remains inside the global AWS network.<br>- VPC endpoint routing is implemented automatically during the creation of the endpoint.<br>- The VPC endpoint creation will add a new rule with a new destination and a target value of the ‘vpce ID’ for the selected route table.</p>
<p>That has now brought me to the end of this lecture, and to the end of this course.</p>
<p>I hope it has given you a good understanding of some of the advanced AWS network concepts surrounding subnets and routing and has left you comfortable enough to start designing and architecting your own AWS network.</p>
<p>If you have any feedback on this course positive or negative, please do leave a comment on the course landing page. We do look at these comments, and your feedback is greatly appreciated.</p>
<p>Thank-you for your time and good luck with your continued learning of Cloud computing.</p>
<p>Thank-you.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/14/AWS-Security-Specialty-Protecting-Web-Apps-with-AWS-WAF-Shield-Firewall-Manager-37/" rel="prev" title="AWS-Security-Specialty-Protecting-Web-Apps-with-AWS-WAF-Shield-Firewall-Manager-37">
      <i class="fa fa-chevron-left"></i> AWS-Security-Specialty-Protecting-Web-Apps-with-AWS-WAF-Shield-Firewall-Manager-37
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/14/AWS-Security-Specialty-Lab-Securing-your-VPC-using-Public-and-Private-Subnets-39/" rel="next" title="AWS-Security-Specialty-Lab-Securing-your-VPC-using-Public-and-Private-Subnets-39">
      AWS-Security-Specialty-Lab-Securing-your-VPC-using-Public-and-Private-Subnets-39 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VPC-CIDR-Blocks"><span class="nav-number">2.</span> <span class="nav-text">VPC CIDR Blocks</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Why-Subnet-your-VPC"><span class="nav-number">3.</span> <span class="nav-text">Why Subnet your VPC?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VPC-Subnets"><span class="nav-number">4.</span> <span class="nav-text">VPC Subnets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Public-amp-Private-Subnets"><span class="nav-number">5.</span> <span class="nav-text">Public &amp; Private Subnets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#VPC-Peering-Subnet-Considerations"><span class="nav-number">6.</span> <span class="nav-text">VPC Peering: Subnet Considerations</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flow-Logs-VPC-Subnets"><span class="nav-number">7.</span> <span class="nav-text">Flow Logs: VPC Subnets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Demonstration-Creating-a-VPC-amp-Subnets"><span class="nav-number">8.</span> <span class="nav-text">Demonstration: Creating a VPC &amp; Subnets</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-Fundamentals-amp-Route-Tables"><span class="nav-number">9.</span> <span class="nav-text">Routing Fundamentals &amp; Route Tables</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-Priorities"><span class="nav-number">10.</span> <span class="nav-text">Routing Priorities</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-VPC-Peering"><span class="nav-number">11.</span> <span class="nav-text">Routing: VPC Peering</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-VPN-Connection-via-a-Virtual-Private-Gateway"><span class="nav-number">12.</span> <span class="nav-text">Routing: VPN Connection via a Virtual Private Gateway</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-Internet-Gateways-amp-NAT-Gateways"><span class="nav-number">13.</span> <span class="nav-text">Routing: Internet Gateways &amp; NAT Gateways</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Routing-VPC-Endpoints"><span class="nav-number">14.</span> <span class="nav-text">Routing: VPC Endpoints</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">15.</span> <span class="nav-text">Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2653</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
