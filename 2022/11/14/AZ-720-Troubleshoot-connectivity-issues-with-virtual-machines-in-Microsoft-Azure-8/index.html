<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionCompleted100 XP  3 minutes  You work as a support engineer looking after your company’s virtual machines (VMs). Some of the teams you support would like guidance on when to use Azure Basti">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8">
<meta property="og:url" content="https://example.com/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionCompleted100 XP  3 minutes  You work as a support engineer looking after your company’s virtual machines (VMs). Some of the teams you support would like guidance on when to use Azure Basti">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-network-diagram.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/just-time-network-diagram.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-just-time-together.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/navigate-bastion-connection.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-screenshot.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-settings.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/deploy-bastion.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/inbound.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/outbound.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/defender-environment-settings.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/defender-description-error.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/enable-enhanced-security.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/select-just-time-access-workload-protections.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/enable-just-time-access-defender.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/check-virtual-machine-access.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/current-just-time-access.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/check-bastion-setup.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-list.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/private-zones.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/no-private-zones.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/invalid-private-zone.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-link.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/virtual-network-subnets.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-settings-nsg.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/connection-troubleshooting-wizard.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/troubleshooot-results.png">
<meta property="article:published_time" content="2022-11-14T17:40:16.000Z">
<meta property="article:modified_time" content="2022-11-14T21:17:38.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-network-diagram.png">

<link rel="canonical" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-11-14 13:40:16 / Modified: 17:17:38" itemprop="dateCreated datePublished" datetime="2022-11-14T13:40:16-04:00">2022-11-14</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>You work as a support engineer looking after your company’s virtual machines (VMs). Some of the teams you support would like guidance on when to use Azure Bastion or just-in-time (JIT) to access their VMs. You want to be able to do this and show the teams how to troubleshoot any issues they have.</p>
<p>Azure supports connecting to VMs in multiple ways. Azure Bastion is a service that you deploy into your environment and use it to connect to your VM using only a browser. Just-in-time VM access is a way to restrict who and which services can connect to a VM—and for how long.</p>
<p>In this module, you’ll explore why you might use Azure Bastion instead of just-in-time VM access to connect to your organization’s VMs. Then you’ll review common issues and how to troubleshoot them.</p>
<h2 id="Learning-objectives"><a href="#Learning-objectives" class="headerlink" title="Learning objectives"></a>Learning objectives</h2><p>After completing this module, you’ll be able to:</p>
<ul>
<li>Choose between Azure Bastion or just-in-time VM access.</li>
<li>Troubleshoot issues with Azure Bastion.</li>
<li>Troubleshoot just-in-time VM access.</li>
</ul>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><ul>
<li>Experience using the Azure portal</li>
<li>Experience using Remote Desktop</li>
<li>Knowledge of Azure Bastion</li>
<li>Familiarity with server and client management concepts and tools</li>
<li>Familiarity with Microsoft Azure and cloud concepts</li>
</ul>
<h1 id="Choose-between-Azure-Bastion-or-just-in-time-virtual-machine-access"><a href="#Choose-between-Azure-Bastion-or-just-in-time-virtual-machine-access" class="headerlink" title="Choose between Azure Bastion or just in time virtual machine access"></a>Choose between Azure Bastion or just in time virtual machine access</h1><p>Completed100 XP</p>
<ul>
<li>5 minutes</li>
</ul>
<p>Azure Bastion and just-in-time access technologies allow you to connect securely to your organization’s VMs hosted in Azure.</p>
<p>Here you’ll learn about the use cases and capabilities of two options, Azure Bastion and JIT VM access. You can then help your teams choose the most appropriate one for them.</p>
<h2 id="Capabilities-of-Azure-Bastion"><a href="#Capabilities-of-Azure-Bastion" class="headerlink" title="Capabilities of Azure Bastion"></a>Capabilities of Azure Bastion</h2><p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-network-diagram.png" alt="A diagram showing how to connect to a VM through a TLS connection to the Azure portal."></p>
<p>The Azure Bastion Service allows you to use a modern HTML5-based web client from directly inside the Azure portal. The service connects securely over TLS and port 443 to any Azure VM in the same virtual network. Azure Bastion is a fully platform-managed PaaS you can choose to provision inside the same virtual network as your organization’s VMs.</p>
<p>There are many benefits to this approach:</p>
<ul>
<li>The web client connects an RDP or SSH session over the industry standard TLS on port 443. The same port browsers are used for HTTPS connections. Using TLS over 443 enables you to traverse your corporate firewalls securely without the need to open any more ports.</li>
<li>You can harden your VMs as they no longer need a public facing IP address. Azure Bastion connects over a private IP address.</li>
<li>You no longer need to add another NSG to allow users to connect to the VMs. You just create a single secure NSG for Azure Bastion to connect over its secure private IP address.</li>
<li>As your VMs no longer have a public facing IP address, they are automatically protected from external port scanning by malicious users outside your virtual network.</li>
</ul>
<h2 id="Capabilities-of-just-in-time-VM-access"><a href="#Capabilities-of-just-in-time-VM-access" class="headerlink" title="Capabilities of just-in-time VM access"></a>Capabilities of just-in-time VM access</h2><p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/just-time-network-diagram.png" alt="A diagram showing how to connect to a VM using just-in-time VM access."></p>
<p>In comparison to Azure Bastion, just-in-time VM access is a feature of Microsoft Defender for Cloud. When enabled in your subscription, you can authorize JIT access to a specific VM for a set amount of time. When that time has passed the access is removed. Microsoft Defender for Cloud allows this access by automatically changing the inbound port rules in the NSG and Azure Firewall.</p>
<p>The benefits to this approach are:</p>
<ul>
<li>You can connect to your VM with the tools of your choice, Remote Desktop or any other app that supports the RDP.</li>
<li>You can easily transfer and manage files directly with the VM.</li>
<li>Your VMs are protected by locking down inbound traffic automatically when access isn’t being used.</li>
</ul>
<h2 id="Choose-between-Azure-Bastion-and-JIT-VM-access"><a href="#Choose-between-Azure-Bastion-and-JIT-VM-access" class="headerlink" title="Choose between Azure Bastion and JIT VM access"></a>Choose between Azure Bastion and JIT VM access</h2><p>Both of your options greatly reduce the attack surface that malicious users might exploit. Here are some use cases where you could choose one over the other.</p>
<table>
<thead>
<tr>
<th align="left">Use Case</th>
<th align="left">Azure Bastion</th>
<th align="left">JIT VM access</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Want to reduce costs as VM will be accessed and used 24&#x2F;7</td>
<td align="left"></td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left">Client machines are locked down and can’t install RDP software</td>
<td align="left">✔️</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">You need to be able to transfer files</td>
<td align="left"></td>
<td align="left">✔️</td>
</tr>
<tr>
<td align="left">Corporate firewall doesn’t have ports 3389 or 22 open</td>
<td align="left">✔️</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>If you want the maximum security, you can combine Azure Bastion and JIT VM access.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-just-time-together.png" alt="A diagram showing how Azure Bastion and JIT VM access can be combined to get the benefits of both."></p>
<p>You get the benefits of browser-based SSL connection to an Azure VM, with no public IP address or RDP ports open, and the time-based restriction of just-in-time access.</p>
<h1 id="Troubleshoot-issues-with-Azure-Bastion"><a href="#Troubleshoot-issues-with-Azure-Bastion" class="headerlink" title="Troubleshoot issues with Azure Bastion"></a>Troubleshoot issues with Azure Bastion</h1><p>Completed100 XP</p>
<ul>
<li>5 minutes</li>
</ul>
<p>There are three main categories of issues you might see when troubleshooting Azure Bastion.</p>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>First, you go to the Azure VM where you’re having trouble deploying Azure Bastion.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/navigate-bastion-connection.png" alt="A screenshot showing how to use Azure Bastion to connect to an Azure VM."></p>
<p>In the Azure portal, on the left navigation pane, select <strong>Virtual machines</strong>, then select the machine you’re troubleshooting. Select <strong>Connect</strong> from the top of the pane, then select <strong>Bastion</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-screenshot.png" alt="A screenshot that shows the Azure Bastion options"></p>
<p>You should see the options to create an Azure Bastion Service. If you don’t, check that you have met these prerequisites:</p>
<ul>
<li>You have the correct access to the VM—at a minimum, you need reader access to the VM, NIC, private IP address of the VM, and the virtual network.</li>
<li>You have an active Azure subscription with enough credit.</li>
<li>You have enough public IP address left in your subscription’s quota.</li>
</ul>
<p>Step 1 has been completed for you because you’re creating the Azure Bastion Service from a VM.</p>
<p>For step 2, you can accept the defaults and create a new subnet named AzureBastionSubnet. The wizard will create the subnet with these attributes:</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-settings.png" alt="A screenshot of the AzureBastionSubnet subnet settings."></p>
<p>Step 3 allows you to select the tier, basic or standard. You can then create or use a public IP address to connect to the Azure Bastion Service. Finally, accept the Microsoft supplied defaults to create the service.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/deploy-bastion.png" alt="A screenshot of the Bastion creation wizard, showing how to select the Standard Tier, public IP address name, and the Create Azure Bastion using the defaults button."></p>
<h2 id="Connectivity"><a href="#Connectivity" class="headerlink" title="Connectivity"></a>Connectivity</h2><p>To begin resolving connection issues between your Azure Bastion Service and a VM, check the VM is running.</p>
<p>The VM doesn’t need to have a public IP address, but it must be in a virtual network that supports IPv4. Currently, IPv6-only environments aren’t supported.</p>
<p>Azure Bastion can’t work with VMs that are in an Azure Private DNS zone with <strong>core.windows.net</strong> or <strong>azure.com</strong> in the suffixes. This isn’t supported because it could allow overlaps with internal endpoints. Azure Private DNS zones in national clouds are also unsupported.</p>
<p>If the connection to the VM is working but you can’t sign in, check if it is domain-joined. If the VM is domain-joined, you’ll need to specify the credentials in the Azure portal using the <strong>username@domain</strong> format, instead of <strong>domain\username</strong>. This won’t resolve the issues if the VM is Azure AD-joined only—this kind of authentication isn’t supported.</p>
<p>In the earlier section you’ll note that, by default, the AzureBastionSubnet isn’t assigned an NSG. If your organization needs an NSG, you should ensure that it’s configured correctly:</p>
<p>Inbound rules</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/inbound.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/inbound.png" alt="A screenshot of inbound rules in the Azure portal showing port 443 over TCP with these sources: Internet, GatewayManager, and AzureLoadBalancer. For port 8080 and 5701 over Any protocol, the source is VirtualNetwork."></a></p>
<p>Outbound rules</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/outbound.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/outbound.png" alt="A screenshot of outbound rules in the Azure portal showing port 22 and 3389 over Any protocol with the destination VirtualNetwork. Port 443 over TCP with the destination AzureCloud. Port 8080 and 5701 over Any protocol with the destination VirtualNetwork. Port 80 over Any protocol—source is Internet."></a></p>
<h2 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h2><p>If your users are having access issues, check that they have roles that grant them read access to all these resources:</p>
<ul>
<li>The virtual machine</li>
<li>The NIC</li>
<li>The Azure Bastion Service and AzureBastionSubnet</li>
<li>If it’s a peered network, the virtual network</li>
</ul>
<p>If all these resources are correct and the user is still seeing a black screen when they try to connect with Azure Bastion, there’s likely a network connectivity issue between the user’s web browser and Azure Bastion.</p>
<h1 id="Troubleshoot-issues-with-just-in-time-virtual-machine-access"><a href="#Troubleshoot-issues-with-just-in-time-virtual-machine-access" class="headerlink" title="Troubleshoot issues with just in time virtual machine access"></a>Troubleshoot issues with just in time virtual machine access</h1><p>Completed100 XP</p>
<ul>
<li>6 minutes</li>
</ul>
<p>Unlike Azure Bastion, there are only two high-level issues you might need to troubleshoot with just-in-time VM access.</p>
<h2 id="Availability"><a href="#Availability" class="headerlink" title="Availability"></a>Availability</h2><p>JIT VM access is one of the enhanced security features of Microsoft Defender for Cloud. Your organization has to have enhanced security enabled at the subscription level. To check, go to the Azure portal, select <strong>Microsoft Defender for Cloud</strong>, and under <strong>Management</strong>, select <strong>Environment settings</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/defender-environment-settings.png" alt="A screenshot of the Azure portal, selecting Microsoft Defender for Cloud, and then Environment settings."></p>
<p>If you haven’t enabled Microsoft Defender for Cloud on your subscription, you’ll see the error below:</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/defender-description-error.png" alt="A screenshot of the error shown if Microsoft Defender for Cloud isn’t enabled on a subscription. It shows there’s an Enable Microsoft Defender for Cloud button to select."></p>
<p>Select <strong>Enable Microsoft Defender for Cloud</strong> to be taken to a page that allows you to select your subscription.</p>
<p>If you have multiple subscriptions, select the one with the resources you’re troubleshooting. Then select the large <strong>Enable all Microsoft Defender for Cloud plans</strong> box.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/enable-enhanced-security.png" alt="A screenshot showing how to enable all Microsoft Defender for Cloud plans."></p>
<p>Choose the services you’d like to protect; at a minimum, you need to select <strong>Server</strong> to enable JIT VM access.</p>
<p>You can enable JIT access from the VM connection pane, from Workload protections inside Microsoft Defender for Cloud, or by using Azure CLI commands. For example, to use Workload protections, follow these steps:</p>
<ol>
<li><p>In the Azure portal, select <strong>Microsoft Defender for Cloud</strong>.</p>
</li>
<li><p>Under Cloud Security, select <strong>Workload protections</strong>.</p>
</li>
<li><p>Select <strong>Just-in-time VM</strong> access.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/select-just-time-access-workload-protections.png" alt="A screenshot showing selecting Workload protections, and then selecting Just-in-time VM access."></p>
</li>
</ol>
<p>You can then select the <strong>Not Configured</strong> tab to show all the VMs in your subscription that don’t have JIT access enabled.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/enable-just-time-access-defender.png" alt="A screenshot showing the Not Configured tab selected, and a check against the VM to protect it. The Enable JIT button on 1 VM is highlighted."></p>
<p>Select the check next to the VM you want to protect.</p>
<p>Select <strong>Enable JIT</strong> on 1 VM.</p>
<p>This page can also help you diagnose your VMs that aren’t supported by JIT VM access. The VMs having problems will likely have been deployed without using the Azure Resource Manager. Only VMs deployed through Azure Resource Manager are supported by JIT access.</p>
<h2 id="Access-1"><a href="#Access-1" class="headerlink" title="Access"></a>Access</h2><p>With JIT VM access enabled on your machines, users might still have issues when they request access to a specific protected VM. You request access to a VM using the Azure portal as follows:</p>
<ul>
<li>From inside the Connect options for a VM.</li>
<li>From inside the Workload protections section of Microsoft Defender for Cloud.</li>
<li>Using Azure CLI commands.</li>
</ul>
<p>If your users are unable to request JIT access, check that their role has these actions, at a minimum:</p>
<ul>
<li>Microsoft.Security&#x2F;locations&#x2F;jitNetworkAccessPolicies&#x2F;*&#x2F;read</li>
<li>Microsoft.Security&#x2F;locations&#x2F;jitNetworkAccessPolicies&#x2F;initiate&#x2F;action</li>
<li>Microsoft.Compute&#x2F;virtualMachines&#x2F;read</li>
<li>Microsoft.Network&#x2F;*&#x2F;read</li>
</ul>
<p>You use Access control (IAM) to check which users have been granted access to a VM. In the Azure portal, select Virtual machine, and then select Access control (IAM).</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/check-virtual-machine-access.png" alt="A screenshot showing a VM’s Access control (IAM) settings. The View button for View access to this resource is highlighted."></p>
<p>You can review the currently enabled and used JIT VM access in the Microsoft Defender for Cloud advanced protection section.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/current-just-time-access.png" alt="A screenshot of the currently configured JIT VM access showing two VMs and their current status of access."></p>
<h1 id="Exercise-–-Troubleshoot-connectivity-issues-with-Azure-Bastion"><a href="#Exercise-–-Troubleshoot-connectivity-issues-with-Azure-Bastion" class="headerlink" title="Exercise – Troubleshoot connectivity issues with Azure Bastion"></a>Exercise – Troubleshoot connectivity issues with Azure Bastion</h1><p>Completed100 XP</p>
<ul>
<li>7 minutes</li>
</ul>
<p>You’ve been contacted by one of the teams you support. The team is having problems connecting to their VM using Bastion. In this exercise you’ll see how to troubleshoot the Azure Bastion Service.</p>
<p>Bastion is not supported in the Learn sandbox environment. Watch the video at the end to view this exercise. If you’d like to follow along in your own subscription, you can use the following steps.</p>
<p> Important</p>
<p>You need your own <a target="_blank" rel="noopener" href="https://azure.microsoft.com/free/">Azure subscription</a> to complete the exercises in this module. If you don’t have an Azure subscription, you can still read along.</p>
<h2 id="Check-that-Bastion-has-been-deployed"><a href="#Check-that-Bastion-has-been-deployed" class="headerlink" title="Check that Bastion has been deployed"></a>Check that Bastion has been deployed</h2><ol>
<li><p>In the Azure portal, in the search box, type <strong>Bastions</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/check-bastion-setup.png" alt="A screenshot showing the Bastion service being searched for and then selected."></p>
</li>
<li><p>From the results, under <strong>Services</strong>, click <strong>Bastions</strong>.</p>
</li>
<li><p>You should see the Bastion service listed.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/bastion-list.png" alt="A screenshot showing the list of created Azure Bastions."></p>
<p>If there aren’t any Bastion services listed, create one.</p>
</li>
</ol>
<h2 id="Check-if-there’s-a-private-DNS-zone"><a href="#Check-if-there’s-a-private-DNS-zone" class="headerlink" title="Check if there’s a private DNS zone"></a>Check if there’s a private DNS zone</h2><ol>
<li><p>In the Azure portal, in the search box, type <strong>private dns</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/private-zones.png" alt="A screenshot of the Azure portal, searching for private D N S, and selecting Private D N S zones."></p>
</li>
<li><p>From the results, under <strong>Services</strong>, click <strong>Private DNS zones</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/no-private-zones.png" alt="A screenshot showing that no private D N S zones are being used."></p>
</li>
<li><p>You shouldn’t see any private DNS zones.</p>
</li>
<li><p>If there are any zones listed, check that they don’t end in <strong>azure.com</strong> or <strong>core.windows.net</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/invalid-private-zone.png" alt="Screenshot showing a private D N S zone that will cause connection problems for Azure Bastion."></p>
</li>
</ol>
<h2 id="Check-if-AzureBastionSubnet-is-using-a-Network-Security-Group-correctly"><a href="#Check-if-AzureBastionSubnet-is-using-a-Network-Security-Group-correctly" class="headerlink" title="Check if AzureBastionSubnet is using a Network Security Group correctly"></a>Check if AzureBastionSubnet is using a Network Security Group correctly</h2><ol>
<li><p>In the Azure portal, in the search box, type <strong>Bastions</strong>.</p>
</li>
<li><p>From the results, under <strong>Services</strong>, click <strong>Bastions</strong>.</p>
</li>
<li><p>Select the Bastion you are troubleshooting.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-link.png" alt="A screenshot showing the Virtual network/subnet link on the Bastion pane."></p>
</li>
<li><p>In the top right, click the <strong>Virtual network&#x2F;subnet</strong> link.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/virtual-network-subnets.png" alt="A screenshot of the subnets menu highlighted on the virtual network pane, with the AzureBastionSubnet selected."></p>
</li>
<li><p>Under <strong>Settings</strong>, click <strong>Subnets</strong>, and then click <strong>AzureBastionSubnet</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/azure-bastion-subnet-settings-nsg.png" alt="A screenshot showing that the AzureBastionSubnet has no Network Security Group associated with it."></p>
</li>
</ol>
<p> Note</p>
<p>If Azure Bastion has a <strong>Network security group</strong> associated with the subnet, you need to check that it has all the inbound and outbound rules created.</p>
<h2 id="Run-the-Connection-Troubleshoot-tool-to-check-for-issues"><a href="#Run-the-Connection-Troubleshoot-tool-to-check-for-issues" class="headerlink" title="Run the Connection Troubleshoot tool to check for issues"></a>Run the Connection Troubleshoot tool to check for issues</h2><ol>
<li>In the Azure portal, in the search box, type <strong>Bastions</strong>.</li>
<li>From the results, under <strong>Services</strong>, click <strong>Bastions</strong>.</li>
<li>Select the Bastion you are troubleshooting.</li>
<li>Under <strong>Monitoring</strong>, click <strong>Connection Troubleshoot</strong>.</li>
<li>Under <strong>Virtual machine</strong>, select the VM you are trying to connect to.</li>
<li>Select your <strong>Preferred IP Version</strong>.</li>
<li>In the <strong>Destination port</strong>, if you want to use <strong>RDP</strong>, enter <strong>3389</strong>, if you want to use <strong>SSH</strong>, enter <strong>22</strong>.</li>
<li>Click <strong>Check</strong>.</li>
</ol>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/connection-troubleshooting-wizard.png" alt="A screenshot of the Azure Bastion connection troubleshooting wizard."></p>
<p>Copy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If you’ve resolved all the possible connection issues, the connection troubleshoot wizard should return a status of reachable.</span><br></pre></td></tr></table></figure>

<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-connectivity-issues-virtual-machines-azure/media/troubleshooot-results.png" alt="A screenshot of the connection troubleshoot results, showing the stats as reachable."></p>
<p>You can watch the following video to see all the steps above:</p>
<iframe src="https://www.microsoft.com/en-us/videoplayer/embed/RE4RYRS?postJsllMsg=true" frameborder="0" allowfullscreen="true" data-linktype="external" title="Video Player" style="box-sizing: inherit; outline-color: inherit; margin: 0px; padding: 0px; border: 0px; width: 640px; height: 360px; position: absolute; inset: 0px;"></iframe>



















<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>As your company’s support engineer, you’ve explored the differences between Bastion and JIT VM access. You can now provide guidance to your teams and suggest which access method will support their needs.</p>
<p>You then reviewed common issues with both approaches and how to troubleshoot them.</p>
<p>If Bastion or JIT VM access wasn’t available, organizations would have to make commonly used ports open to the external internet, allowing bad actors to port scan their virtual machines. Using either approach to connect to your VMs greatly reduces the attack surface that can be exploited.</p>
<p>Now that you’ve completed this module, you should be able to:</p>
<ul>
<li>Choose between Azure Bastion or just-in-time VM access.</li>
<li>Troubleshoot issues with Azure Bastion.</li>
<li>Troubleshoot just-in-time VM access.</li>
</ul>
<p>For more information about the topics discussed in this module, see:</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/bastion/troubleshoot">Troubleshoot Azure Bastion</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-overview">Understanding just-in-time (JIT) VM access</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/bastion/diagnostic-logs">Enable and work with Bastion resource logs</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/bastion/bastion-overview">What is Azure Bastion?</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/" rel="prev" title="AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7">
      <i class="fa fa-chevron-left"></i> AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-720-Troubleshoot-VPN-gateways-in-Microsoft-Azure-9/" rel="next" title="AZ-720-Troubleshoot-VPN-gateways-in-Microsoft-Azure-9">
      AZ-720-Troubleshoot-VPN-gateways-in-Microsoft-Azure-9 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Learning-objectives"><span class="nav-number">1.1.</span> <span class="nav-text">Learning objectives</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prerequisites"><span class="nav-number">1.2.</span> <span class="nav-text">Prerequisites</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Choose-between-Azure-Bastion-or-just-in-time-virtual-machine-access"><span class="nav-number">2.</span> <span class="nav-text">Choose between Azure Bastion or just in time virtual machine access</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Capabilities-of-Azure-Bastion"><span class="nav-number">2.1.</span> <span class="nav-text">Capabilities of Azure Bastion</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Capabilities-of-just-in-time-VM-access"><span class="nav-number">2.2.</span> <span class="nav-text">Capabilities of just-in-time VM access</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Choose-between-Azure-Bastion-and-JIT-VM-access"><span class="nav-number">2.3.</span> <span class="nav-text">Choose between Azure Bastion and JIT VM access</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-issues-with-Azure-Bastion"><span class="nav-number">3.</span> <span class="nav-text">Troubleshoot issues with Azure Bastion</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Deployment"><span class="nav-number">3.1.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Connectivity"><span class="nav-number">3.2.</span> <span class="nav-text">Connectivity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Access"><span class="nav-number">3.3.</span> <span class="nav-text">Access</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-issues-with-just-in-time-virtual-machine-access"><span class="nav-number">4.</span> <span class="nav-text">Troubleshoot issues with just in time virtual machine access</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Availability"><span class="nav-number">4.1.</span> <span class="nav-text">Availability</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Access-1"><span class="nav-number">4.2.</span> <span class="nav-text">Access</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-%E2%80%93-Troubleshoot-connectivity-issues-with-Azure-Bastion"><span class="nav-number">5.</span> <span class="nav-text">Exercise – Troubleshoot connectivity issues with Azure Bastion</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-that-Bastion-has-been-deployed"><span class="nav-number">5.1.</span> <span class="nav-text">Check that Bastion has been deployed</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-if-there%E2%80%99s-a-private-DNS-zone"><span class="nav-number">5.2.</span> <span class="nav-text">Check if there’s a private DNS zone</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-if-AzureBastionSubnet-is-using-a-Network-Security-Group-correctly"><span class="nav-number">5.3.</span> <span class="nav-text">Check if AzureBastionSubnet is using a Network Security Group correctly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Run-the-Connection-Troubleshoot-tool-to-check-for-issues"><span class="nav-number">5.4.</span> <span class="nav-text">Run the Connection Troubleshoot tool to check for issues</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">6.</span> <span class="nav-text">Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">1986</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
