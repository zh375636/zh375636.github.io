<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionCompleted100 XP  3 minutes  You work for an enterprise level organization that has different locations and many users working remotely. You need to ensure that the infrastructure is robust">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7">
<meta property="og:url" content="https://example.com/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionCompleted100 XP  3 minutes  You work for an enterprise level organization that has different locations and many users working remotely. You need to ensure that the infrastructure is robust">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-propagate-gateway-routes.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-route-table.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-next-hop.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-source-based-network-address-translation.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-forced-tunnelling.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-border-gateway-protocol-peers.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-service-chaining.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-network-topology-diagram.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-web-working.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-portal-select-virtual-machines.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-virtual-machine-network-settings.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancers.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-frontend.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-backend-pools.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-rules.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-web-load-balancer-rule-settings.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/5-load-balancer-search.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-rules.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/5-load-balancer-fix.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/issue-resolved.gif">
<meta property="article:published_time" content="2022-11-14T17:39:05.000Z">
<meta property="article:modified_time" content="2022-11-14T21:07:54.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-propagate-gateway-routes.png">

<link rel="canonical" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-11-14 13:39:05 / Modified: 17:07:54" itemprop="dateCreated datePublished" datetime="2022-11-14T13:39:05-04:00">2022-11-14</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/14/AZ-720-Troubleshoot-routing-traffic-control-and-load-balancing-in-Microsoft-Azure-7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>You work for an enterprise level organization that has different locations and many users working remotely. You need to ensure that the infrastructure is robust and stable as you’re responsible for troubleshooting load balancing, routing, and traffic control.</p>
<p>In this module, we will look at troubleshooting routing, traffic control, and load balancing problems.</p>
<h2 id="Learning-objectives"><a href="#Learning-objectives" class="headerlink" title="Learning objectives"></a>Learning objectives</h2><p>After completing this module, you’ll be able to:</p>
<ul>
<li>Understand how user-defined routes interact with the network.</li>
<li>Apply different techniques to determine packet loss.</li>
<li>Choose the most effective load-balancer tool to troubleshoot issues.</li>
</ul>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><ul>
<li>Experience with the OSI model</li>
<li>Experience with PowerShell and Azure CLI</li>
<li>Know how to get to Cloud Shell to run commands</li>
<li>Experience with Visual Studio Code</li>
<li>Demonstrate an understanding of JSON</li>
</ul>
<h1 id="Set-up-troubleshooting-environment"><a href="#Set-up-troubleshooting-environment" class="headerlink" title="Set up troubleshooting environment"></a>Set up troubleshooting environment</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>This module requires a sandbox to complete.</p>
<p>A <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/support/faq?pivots=sandbox">sandbox</a> gives you access to free resources. Your personal subscription will not be charged. The sandbox may only be used to complete training on Microsoft Learn. Use for any other reason is prohibited, and may result in permanent loss of access to the sandbox.</p>
<p>Microsoft provides this lab experience and related content for educational purposes. All presented information is owned by Microsoft and intended solely for learning about the covered products and services in this Microsoft Learn module.</p>
<p>Activate sandbox</p>
<p>You’ll troubleshoot a load balancing problem in a later exercise. Use the following instructions and the Azure Cloud Shell on the right of the screen to create the environment.</p>
<h2 id="Create-the-exercise-environment"><a href="#Create-the-exercise-environment" class="headerlink" title="Create the exercise environment"></a>Create the exercise environment</h2><p>Use the Cloud Shell on the right run these commands to create the example topology.</p>
<ol>
<li><p>Copy and paste this command on the right to clone the setup script from GitHub.</p>
<p>BashCopy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/MicrosoftDocs/mslearn-troubleshoot-connectivity-issues-virtual-machines networking</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run the setup script with this command.</p>
<p>BashCopy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash networking/setup.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can continue to the next unit as this command runs in the background.</p>
</li>
</ol>
<h1 id="Troubleshoot-routing-and-traffic-control"><a href="#Troubleshoot-routing-and-traffic-control" class="headerlink" title="Troubleshoot routing and traffic control"></a>Troubleshoot routing and traffic control</h1><p>Completed100 XP</p>
<ul>
<li>7 minutes</li>
</ul>
<p>Routing errors can occur anywhere along the virtual network and the setting to control inbound and outbound traffic will cause problems with traffic control. This unit will examine the different tools available to troubleshoot typical problems.</p>
<h2 id="Troubleshoot-user-defined-routing-issues"><a href="#Troubleshoot-user-defined-routing-issues" class="headerlink" title="Troubleshoot user-defined routing issues"></a>Troubleshoot user-defined routing issues</h2><p>A user-defined route overrides Azure’s default routing and is used to route traffic through a network virtual appliance (NVA). The main advantage is to help with routing and firewall optimization.</p>
<p>The key steps to set up a user-defined route are:</p>
<ol>
<li>Create an NVA that routes traffic.</li>
<li>Create a route table and a route.</li>
<li>Associate the route table to a subnet.</li>
<li>Deploy virtual machines into different subnets.</li>
<li>Route traffic from one subnet to another via the NVA.</li>
</ol>
<p>The main problems that occur when setting up a user-defined route are:</p>
<ul>
<li><p>Have you set up three subnets for the public, private and the perimeter network demilitarized zone (DMZ)? The DMZ subnet gives an added layer of protection to a local area network (LAN).</p>
</li>
<li><p>Have you set up the subnets with unique non-overlapping address ranges?</p>
</li>
<li><p>Do you have a non-overlapping address space for the Bastion subnet address space?</p>
</li>
<li><p>Have you connected the route table to the public subnet?</p>
</li>
<li><p>Have you added the DMZ subnet name as the subnet in Settings, in the NVA?</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-propagate-gateway-routes.png" alt="Screenshot of Propagate gateway routes dialog box."></p>
</li>
<li><p>The route table overrides any default routing in the network. Have you allowed the gateway route to propagate?</p>
</li>
<li><p>Have you assigned the correct subnet ranges to the route?</p>
</li>
<li><p>The address prefix is the private subnet address range.</p>
</li>
<li><p>The next hop address is the DMZ subnet address range.</p>
</li>
<li><p>Have you added the route table to the public virtual network?</p>
</li>
<li><p>Have you enabled the IP forwarding on the NVA?</p>
</li>
</ul>
<h2 id="Review-route-tables"><a href="#Review-route-tables" class="headerlink" title="Review route tables"></a>Review route tables</h2><p>To route traffic between Azure, on-premises, and internet resources, a route table is created for each subnet within the Azure virtual network. It automatically creates system default routes to the route table.</p>
<p>Important points to note:</p>
<ul>
<li>You cannot create or remove system routes, only override them with custom user-defined routes.</li>
<li>Each subnet must be associated with a route table. You can assign a user-defined route table, or the system will allocate a default table.</li>
</ul>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-route-table.png" alt="Screenshot showing a typical route table."></p>
<p>A typical route table holds an address prefix and the next hop type.</p>
<h2 id="Determine-whether-subnets-are-associated-with-route-tables"><a href="#Determine-whether-subnets-are-associated-with-route-tables" class="headerlink" title="Determine whether subnets are associated with route tables"></a>Determine whether subnets are associated with route tables</h2><p>When you deploy a virtual machine, several default routes are automatically created, or you can associate your own route table.</p>
<p>To diagnose any connection problems, you can use:</p>
<ul>
<li>The Azure portal</li>
<li>PowerShell</li>
<li>Azure CLI</li>
</ul>
<h3 id="Azure-portal"><a href="#Azure-portal" class="headerlink" title="Azure portal"></a>Azure portal</h3><p>Log in to the Azure portal then search for and select the virtual machine you want to check:</p>
<ol>
<li>Select <strong>Settings</strong> &gt; <strong>Networking</strong> and select the <strong>network interface resource</strong>.</li>
<li>Select <strong>Effective Routes</strong> and the route table will be displayed.</li>
</ol>
<h3 id="Diagnose-routes-using-PowerShell"><a href="#Diagnose-routes-using-PowerShell" class="headerlink" title="Diagnose routes using PowerShell"></a>Diagnose routes using PowerShell</h3><p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AzEffectiveRouteTable</span> `</span><br><span class="line"></span><br><span class="line">  <span class="literal">-NetworkInterfaceName</span> myVMNic1 `</span><br><span class="line"></span><br><span class="line">  <span class="literal">-ResourceGroupName</span> myResourceGroup `</span><br><span class="line"></span><br><span class="line">  | <span class="built_in">Format-Table</span></span><br></pre></td></tr></table></figure>

<h3 id="Diagnose-routes-using-Azure-CLI"><a href="#Diagnose-routes-using-Azure-CLI" class="headerlink" title="Diagnose routes using Azure CLI"></a>Diagnose routes using Azure CLI</h3><p>Azure CLICopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">az network nic show-effective-route-table \</span><br><span class="line"></span><br><span class="line">  --name myVMNic1 \</span><br><span class="line"></span><br><span class="line">  --resource-group myResourceGroup</span><br></pre></td></tr></table></figure>

<h2 id="Resolving-routing-problems"><a href="#Resolving-routing-problems" class="headerlink" title="Resolving routing problems"></a>Resolving routing problems</h2><p>To resolve a route problem, try the following actions:</p>
<ul>
<li>Add a custom route to override a default route and test.</li>
<li>Delete an existing custom route and set up a new custom route.</li>
<li>Check that any custom routes in the route table are associated with the correct subnet.</li>
<li>Use VPN diagnostics to check that any gateways or NVAs are operable.</li>
<li>Use the next hop feature in Azure Network Watcher.</li>
</ul>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-next-hop.png" alt="Screenshot of the next hop option."></p>
<h2 id="Troubleshoot-asymmetric-routing"><a href="#Troubleshoot-asymmetric-routing" class="headerlink" title="Troubleshoot asymmetric routing"></a>Troubleshoot asymmetric routing</h2><p>Asymmetric routing is when a packet takes one path to the destination and follows another path when it returns to the source. This often happens when multiple circuits are used to improve network uptime and the router finds the best path. If your system is not set up correctly, packets can be dropped.</p>
<p>Solutions to prevent packet loss can be found through routing and by using source network address translation (SNAT).</p>
<h3 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h3><p>Check the following:</p>
<ul>
<li>Are your public IP addresses advertised to the correct wide area network (WAN) links?</li>
<li>If you want to use the internet for authentication traffic, don’t advertise your Active Directory Federation Services (AD FS) public IP address over ExpressRoute.</li>
</ul>
<h3 id="Source-based-NAT"><a href="#Source-based-NAT" class="headerlink" title="Source-based NAT"></a>Source-based NAT</h3><p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-source-based-network-address-translation.png" alt="Diagram of a network with SNAT incorporated."></p>
<p>If you experience dropped packets, SNAT can help to direct them via the same route. In the above example, instead of using ExpressRoute to advertise the public IP address of an on-premises Simple Mail Transfer Protocol (SMTP) server, you could choose to use the internet path. The process will work effectively if:</p>
<ul>
<li>The request from Microsoft travels the internet route.</li>
<li>You use SNAT for the incoming IP address.</li>
<li>Return traffic goes to the edge firewall which you use for NAT—this will then direct the return traffic via the internet path rather than ExpressRoute.</li>
</ul>
<h2 id="Tracking-asymmetric-routing"><a href="#Tracking-asymmetric-routing" class="headerlink" title="Tracking asymmetric routing"></a>Tracking asymmetric routing</h2><p>Use Tracert to check the path your traffic is traveling along.</p>
<ul>
<li><p>Open the command prompt and type pathping. The full path is shown below:</p>
<p>ConsoleCopy</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pathping [/n] [/h &lt;maximumhops&gt;] [/g &lt;hostlist&gt;] [/p &lt;Period&gt;] [/q &lt;numqueries&gt; [/w &lt;timeout&gt;] [/i &lt;IPaddress&gt;] [/4 &lt;IPv4&gt;] [/6 &lt;IPv6&gt;][&lt;targetname&gt;]</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Troubleshoot-forced-tunneling-issues"><a href="#Troubleshoot-forced-tunneling-issues" class="headerlink" title="Troubleshoot forced tunneling issues"></a>Troubleshoot forced tunneling issues</h2><p>Forced tunneling lets you direct all internet-bound traffic back to your on-premises location via a site-to-site VPN tunnel for inspection and auditing.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-forced-tunnelling.png" alt="Diagram of a network with forced tunneling."></p>
<p>Check the following points to resolve routing problems:</p>
<ul>
<li>If you cannot connect to the internet, check that the routing you have configured for the device routes traffic to a public or private IP address for the virtual machine.</li>
<li>If users with virtual machines cannot activate Windows, it is because the activation request is coming from your on-premises network. Ensure the activation request comes from an Azure public IP address.</li>
</ul>
<h2 id="Troubleshoot-Border-Gateway-Protocol-BGP-issues"><a href="#Troubleshoot-Border-Gateway-Protocol-BGP-issues" class="headerlink" title="Troubleshoot Border Gateway Protocol (BGP) issues"></a>Troubleshoot Border Gateway Protocol (BGP) issues</h2><p>Within the Azure portal, you can view metrics for learned routes, BGP peers and advertised routes then download the data via csv for further analysis.</p>
<p>Follow the steps below to access the BGP metrics within Azure:</p>
<ol>
<li>Open the gateway.</li>
<li>Navigate to BGP peers.</li>
</ol>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-border-gateway-protocol-peers.png" alt="Screenshot of the BGP peers screen."></p>
<h2 id="Troubleshoot-multi-VNet-configuration"><a href="#Troubleshoot-multi-VNet-configuration" class="headerlink" title="Troubleshoot multi-VNet configuration"></a>Troubleshoot multi-VNet configuration</h2><p>Read through the list to troubleshoot configuration problems:</p>
<ul>
<li><p>If the peering status shows as Connected, use the Connection Troubleshooter and IP Flow in Azure to verify from the source VM to the destination VM, to see if a network security group (NSG) or user-defined route is the issue. You can then run a network trace from the source to the destination IP.</p>
<p>ConsoleCopy</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcping64.exe -t &lt;destination VM address&gt; 3389</span><br></pre></td></tr></table></figure>
</li>
<li><p>If the peering status is Disconnected, delete the peering from both networks and recreate it.</p>
</li>
<li><p>If you are using a third-party NVA, contact the vendor to double check the setting.</p>
</li>
<li><p>Have you used a remote gateway on a spoke network? This is not supported.</p>
</li>
<li><p>Have you set Allow forwarded traffic or Use remote gateway, depending on your setup?</p>
</li>
<li><p>If you transit over a global virtual network peering, check you are aware of the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview">requirements and constraints</a>.</p>
</li>
</ul>
<h2 id="Troubleshoot-service-chaining"><a href="#Troubleshoot-service-chaining" class="headerlink" title="Troubleshoot service chaining"></a>Troubleshoot service chaining</h2><p>Service chaining helps to automate traffic flow between services in a virtual network because the best routing path should be selected. However, if you are experiencing slow internet connections, it could be due to the additional hops that chaining has added to the process.</p>
<p>Points to remember:</p>
<ul>
<li>Have you configured the user-defined route as the next hop IP address?</li>
<li>User-defined routes can point to virtual network gateways.</li>
<li>Consider building a hub and spoke network topology so the hub virtual network hosts the infrastructure. The spoke networks then peer with the hub, with traffic flowing through the network virtual applicant or VPN gateway on the hub.</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-service-chaining.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/3-service-chaining.png" alt="Screenshot of spoke and hub network."></a></p>
<h3 id="Troubleshoot-routing-configuration-of-Azure-VMs-that-function-as-routers"><a href="#Troubleshoot-routing-configuration-of-Azure-VMs-that-function-as-routers" class="headerlink" title="Troubleshoot routing configuration of Azure VMs that function as routers"></a>Troubleshoot routing configuration of Azure VMs that function as routers</h3><p>You need to contact the vendor of the network virtual appliance if you have any connectivity or routing problems when you connect to Azure.</p>
<p>When you set up a virtual appliance that will function as a router there are two main areas to investigate:</p>
<ul>
<li>Ensure you have the correct up-to-date information from the vendor.</li>
<li>Troubleshoot the in-house elements.</li>
</ul>
<h3 id="Network-Virtual-Appliance-vendors"><a href="#Network-Virtual-Appliance-vendors" class="headerlink" title="Network Virtual Appliance vendors"></a>Network Virtual Appliance vendors</h3><p>Check the following with the NVA vendor:</p>
<ul>
<li>Is the software up-to-date?</li>
<li>Is the service account with the vendor set up correctly and fully functional?</li>
<li>Check all user-defined routes.</li>
<li>Are the routing tables set up correctly?</li>
<li>Run tracing on the NVA network interfaces to check you can receive and send traffic.</li>
</ul>
<h3 id="Other-troubleshooting-steps"><a href="#Other-troubleshooting-steps" class="headerlink" title="Other troubleshooting steps"></a>Other troubleshooting steps</h3><p>It is also important to check your in-house setup:</p>
<ul>
<li>Do you meet the minimum configuration requirements?</li>
<li>If you experience packet loss:</li>
<li>Check CPU usage for capacity and spikes.</li>
<li>Use network traces to check packet traffic.</li>
<li>Check firewalls.</li>
<li>Are NSGs or UDRs interfering with the trace?</li>
<li>Is the routing table incorrect?</li>
</ul>
<h1 id="Troubleshoot-load-balancing-issues"><a href="#Troubleshoot-load-balancing-issues" class="headerlink" title="Troubleshoot load-balancing issues"></a>Troubleshoot load-balancing issues</h1><p>Completed100 XP</p>
<ul>
<li>6 minutes</li>
</ul>
<p>Azure offers a range of load-balancing solutions. Traffic Manager provides high availability and quick response times by using DNS to redirect client requests to the most appropriate endpoint for any protocol. Front Door provides high availability and quick response times by using proxies for HTTP requests. Traffic Manager and Front Door load balance at the Network and Transport layers.</p>
<p>Application Gateway loads balances at the Application layer rather than the Network and Transport layers. This means you can route traffic based on the incoming URL. For example, you could route traffic for a URL containing &#x2F;media to a specific set of servers.</p>
<p>Load Balancer works at the Network and Transport layers to provide internal and external load balancing for both inbound and outbound traffic using any protocol.</p>
<p>Each load-balancing solution requires different troubleshooting steps.</p>
<h2 id="Determine-the-status-of-Azure-Traffic-Manager"><a href="#Determine-the-status-of-Azure-Traffic-Manager" class="headerlink" title="Determine the status of Azure Traffic Manager"></a>Determine the status of Azure Traffic Manager</h2><p>To test whether your Traffic Manager settings are correct, you need to have multiple clients in multiple locations. You can then verify DNS resolution for failover using the following steps:</p>
<ol>
<li>Flush your DNS cache by running ipconfig &#x2F;flushdns.</li>
<li>Run nslookup for your company’s domain to verify that it resolves to your primary endpoint.</li>
<li>Take down your primary endpoint, wait for the Time-to-Live (TTL) time of your Traffic Manager profile, plus an additional two minutes.</li>
<li>Flush your DNS cache by running ipconfig &#x2F;flushdns.</li>
<li>Repeat the nslookup request and verify that it resolves to your secondary endpoint.</li>
<li>Repeat these steps for each endpoint.</li>
</ol>
<p>You can also test for weighted traffic routing by leaving all endpoints up and repeatedly flushing the cache and running nslookup to verify that traffic is cycling through each endpoint.</p>
<p>You can test for performance routing by connecting from different geographic locations and testing whether the appropriate endpoint is returned by nslookup.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/traffic-manager/traffic-manager-overview">What is Traffic Manager?</a></p>
<h2 id="Determine-whether-virtual-machines-in-a-load-balanced-cluster-are-healthy"><a href="#Determine-whether-virtual-machines-in-a-load-balanced-cluster-are-healthy" class="headerlink" title="Determine whether virtual machines in a load-balanced cluster are healthy"></a>Determine whether virtual machines in a load-balanced cluster are healthy</h2><p>Azure Load Balancer uses health probes to detect if an instance is healthy. If the health probe cannot make a connection, the load balancer will stop sending connections to that instance.</p>
<p>What if virtual machines (VMs) in a load balancer set are not responding to health probes? There are a number of possible reasons:</p>
<ul>
<li>The back-end pool VM is not in a healthy state.<ul>
<li>To test this, try sending a Ping request from another VM in the pool. The VM must be able to respond to requests to be part of the pool.</li>
</ul>
</li>
<li>The back-end pool VM does not allow connections from the probe port.<ul>
<li>From the back-end VM, run netstat -an and check that the correct port is listed as LISTENING. You must configure the back-end VM and&#x2F;or the load balancer to use the same port.</li>
</ul>
</li>
<li>A firewall or NSG does not allow connections from the probe port.<ul>
<li>If the back-end VM and load balancer are using the same port, verify that this is not blocked by a firewall or NSG.</li>
</ul>
</li>
<li>The load balancer is misconfigured.<ul>
<li>If the previous tests all succeeded, analyze the network for incoming and outgoing packets from multiple VMs in the load balancer set, to try to isolate the issue.</li>
</ul>
</li>
</ul>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-troubleshoot-health-probe-status">Troubleshoot Azure Load Balancer health probe status</a>.</p>
<h2 id="Examine-load-balancer-rules"><a href="#Examine-load-balancer-rules" class="headerlink" title="Examine load balancer rules"></a>Examine load balancer rules</h2><p>Load balancer rules define how traffic is distributed to the load balancer set. This could mean that a specific VM only receives certain traffic based on its incoming IP address, for example.</p>
<p>Review load balancer rules if traffic is not behaving as expected.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/manage-rules-how-to">Manage rules for Azure Load Balancer using the Azure portal</a>.</p>
<h2 id="Determine-how-resources-are-being-allocated-based-on-the-load-balancer-configuration"><a href="#Determine-how-resources-are-being-allocated-based-on-the-load-balancer-configuration" class="headerlink" title="Determine how resources are being allocated based on the load balancer configuration"></a>Determine how resources are being allocated based on the load balancer configuration</h2><p>Load balancers are typically used to evenly distribute traffic. Here are two reasons why the distribution of traffic from the load balancer is uneven:</p>
<ul>
<li>Session persistence is turned on.<ul>
<li>Session persistence will cause each client and server pair to be persisted so load balancing won’t perform as expected.</li>
</ul>
</li>
<li>Clients are behind a proxy server.<ul>
<li>A proxy server can cause multiple clients to appear as a single client, so load balancing won’t perform as expected.</li>
</ul>
</li>
</ul>
<p>If a VM in the load-balanced pool appears healthy, but is not responding to requests, there could be a number of reasons:</p>
<ul>
<li>The back-end VM might not be listening on the correct port, or the port may not be open.</li>
<li>A network security group might be blocking the port.</li>
<li>An application on the back-end VM is trying to access another application on the same network interface. This is unsupported.</li>
<li>A back-end VM is trying to access resources through the load balancer. This is unsupported.</li>
</ul>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-troubleshoot-backend-traffic">Troubleshoot Azure Load Balancer back-end traffic responses</a>.</p>
<h2 id="Troubleshoot-port-exhaustion-issues"><a href="#Troubleshoot-port-exhaustion-issues" class="headerlink" title="Troubleshoot port exhaustion issues"></a>Troubleshoot port exhaustion issues</h2><p>When a load balancer is used for external connections, you should be aware of port exhaustion. There are 64,000 ports available, but each connection uses eight ports when a load balancer is in use. Therefore, if there are many back-end instances, it is possible to exhaust the available ports.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/troubleshoot-outbound-connection">Troubleshooting outbound connections failures</a>.</p>
<h2 id="Troubleshoot-Azure-Front-Door"><a href="#Troubleshoot-Azure-Front-Door" class="headerlink" title="Troubleshoot Azure Front Door"></a>Troubleshoot Azure Front Door</h2><p>If you’re using Azure Front Door for load balancing and wish to troubleshoot common routing problems, you should first request that Front Door returns additional debugging HTTP response headers.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/frontdoor/front-door-http-headers-protocol">Protocol support for HTTP headers in Azure Front Door</a>.</p>
<p>When you have the HTTP group response headers, there are a number of responses from Azure Front Door you could use for debugging:</p>
<ul>
<li>A 503 response after a few seconds means that regular requests go to your back end without going through Azure Front Door. To resolve this issue, configure the origin response timeouts for the endpoint and extend the default timeout.<ul>
<li>You’re receiving 503 responses from the Azure Front Door, but only for HTTPS requests. Reasons for this could be:</li>
<li>The back-end pool is an IP address.</li>
<li>The back-end server is returning a certificate that doesn’t match the fully qualified domain name of the Azure Front Door back-end pool.</li>
<li>The back-end pool is an Azure Web app server.</li>
</ul>
</li>
<li>You’re receiving 400 status codes when requests are sent to a custom domain.<ul>
<li>The problem occurs because you haven’t created a routing rule for the custom domain when it was added as the front-end host.</li>
</ul>
</li>
<li>You’re receiving 411 status codes from the front-end host.<ul>
<li>These status codes are generated when your HTTP request is not fully RFC compliant.</li>
</ul>
</li>
</ul>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/frontdoor/troubleshoot-issues">Troubleshoot Azure Front Door common issues</a>.</p>
<h2 id="Troubleshoot-Azure-Application-Gateway"><a href="#Troubleshoot-Azure-Application-Gateway" class="headerlink" title="Troubleshoot Azure Application Gateway"></a>Troubleshoot Azure Application Gateway</h2><p>Application Gateway probes back-end servers to check their health status. If these servers do not successfully respond, Application Gateway marks them as unresponsive and stops sending requests to them. Application Gateway resumes sending requests when the server starts responding successfully.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/application-gateway/application-gateway-backend-health-troubleshooting">Troubleshoot back-end health issues in Application Gateway</a>.</p>
<h2 id="Troubleshoot-Azure-Load-Balancer"><a href="#Troubleshoot-Azure-Load-Balancer" class="headerlink" title="Troubleshoot Azure Load Balancer"></a>Troubleshoot Azure Load Balancer</h2><p>There are several troubleshooting steps to consider when you use Azure Load Balancer:</p>
<ul>
<li>Standard internal load balancers are secured by default, but basic internal load balancers allow connections to the internet through hidden IP addresses. This is not recommended for production workloads—Network Gateway is the recommended solution for outbound traffic.</li>
<li>When you have a health probe, the back-end port can’t be modified for load balancing. To resolve this issue, remove the health probe, reconfigure the port, and then add the health probe again.</li>
<li>If a VM is removed from a back-end pool but is still receiving network traffic, this could be due to storage, DNS, or other Azure functions.</li>
</ul>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-troubleshoot-backend-traffic">Troubleshoot Azure Load Balancer</a>.</p>
<h2 id="Troubleshoot-Traffic-Manager-profile-issues"><a href="#Troubleshoot-Traffic-Manager-profile-issues" class="headerlink" title="Troubleshoot Traffic Manager profile issues"></a>Troubleshoot Traffic Manager profile issues</h2><p>Azure Traffic Manager uses six traffic routing methods. These are Priority, Weighted, Performance, Geographic, Multivalue, and Subnet. If you select the incorrect traffic routing method, the expected behavior might not be achieved. Traffic may be going towards a primary service endpoint for all traffic because you are using Priority, but you want it to go to the closest endpoint—for example, by using Performance.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/traffic-manager/traffic-manager-routing-methods">Traffic Manager routing methods</a>.</p>
<h2 id="Troubleshoot-latency-issues"><a href="#Troubleshoot-latency-issues" class="headerlink" title="Troubleshoot latency issues"></a>Troubleshoot latency issues</h2><p>For latency issues in your load-balanced network, you should test in the same way you would for any virtual machine network latency. You can use common connectivity tools such as Ping, but more specialist third-party tools are available to provide more information. To test latency issues, it’s a good idea to use two virtual machines, one as the sender and the other as the receiver. This allows you to test two-way communication between the virtual machines and through the load balancer.</p>
<p>For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-test-latency">Test VM network latency</a>.</p>
<h1 id="Exercise-Troubleshoot-routing-traffic-control-and-load-balancing-issues"><a href="#Exercise-Troubleshoot-routing-traffic-control-and-load-balancing-issues" class="headerlink" title="Exercise: Troubleshoot routing, traffic control and load balancing issues"></a>Exercise: Troubleshoot routing, traffic control and load balancing issues</h1><p>Completed100 XP</p>
<ul>
<li>6 minutes</li>
</ul>
<p>This module requires a sandbox to complete.</p>
<p>A <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/support/faq?pivots=sandbox">sandbox</a> gives you access to free resources. Your personal subscription will not be charged. The sandbox may only be used to complete training on Microsoft Learn. Use for any other reason is prohibited, and may result in permanent loss of access to the sandbox.</p>
<p>Microsoft provides this lab experience and related content for educational purposes. All presented information is owned by Microsoft and intended solely for learning about the covered products and services in this Microsoft Learn module.</p>
<p>Activate sandbox</p>
<p>You work as a support engineer supporting Azure infrastructure. You’ve been contacted by your web team about an issue with website performance. The web team has a pool of webservers behind a load balancer and public IP address.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-network-topology-diagram.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-network-topology-diagram.png" alt="Screenshot of a network topology diagram showing a pool of webservers behind a load balancer and public IP address."></a></p>
<p>The web team thinks that the internet traffic isn’t being distributed equally between all the webservers.</p>
<p>In this exercise, you’ll use what you’ve learned to go through steps to troubleshoot the performance issues with your organizations website.</p>
<h2 id="Check-that-the-issue-still-exists"><a href="#Check-that-the-issue-still-exists" class="headerlink" title="Check that the issue still exists"></a>Check that the issue still exists</h2><ol>
<li><p>Using the Cloud Shell to the right, run this command.</p>
<p>Azure CLICopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">az network public-ip show \</span><br><span class="line">--resource-group [sandbox resource group name] \</span><br><span class="line">--name webPublicIP \</span><br><span class="line">--query &#x27;[ipAddress]&#x27; \</span><br><span class="line">--output tsv</span><br></pre></td></tr></table></figure>
</li>
<li><p>Paste the IP address returned into a new browser tab.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-web-working.png" alt="Screenshot of the web responding."></p>
<p> Note</p>
<p>Your IP address will be different to the one shown in the screenshot.</p>
</li>
<li><p>Hit refresh in your browser, or on Windows press the <strong>F5</strong> ten or twenty times. Notice that you are getting a response from the same webserver every single time.</p>
</li>
<li><p>Leave this tab open to check you resolve the issue in the next exercise.</p>
</li>
</ol>
<h2 id="Check-all-the-virtual-machines-are-responding-on-port-80"><a href="#Check-all-the-virtual-machines-are-responding-on-port-80" class="headerlink" title="Check all the virtual machines are responding on port 80"></a>Check all the virtual machines are responding on port 80</h2><ol>
<li><p>Navigate to the <a target="_blank" rel="noopener" href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> in another browser tab.</p>
</li>
<li><p>Select <strong>Virtual machines</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-portal-select-virtual-machines.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-portal-select-virtual-machines.png" alt="Screenshot of the virtual machines."></a></p>
</li>
<li><p>Select <strong>webVirtualMachine1</strong>.</p>
</li>
<li><p>Under <strong>Settings</strong>, select <strong>Networking</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-virtual-machine-network-settings.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-virtual-machine-network-settings.png" alt="Screenshot of the networking settings for the virtual machine."></a></p>
</li>
<li><p>Check that inbound traffic is allowed on port <strong>80</strong>.</p>
</li>
<li><p>Repeat the above for <strong>webVirtualMachine2</strong>.</p>
</li>
</ol>
<p>The current settings appear to be correct.</p>
<h2 id="Check-the-Load-Balancer-settings"><a href="#Check-the-Load-Balancer-settings" class="headerlink" title="Check the Load Balancer settings"></a>Check the Load Balancer settings</h2><ol>
<li><p>Select <strong>Home</strong>.</p>
</li>
<li><p>Search for <strong>Load balancers</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancers.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancers.png" alt="A screenshot of the Azure portal showing Load balancers being selected."></a></p>
</li>
<li><p>Under <strong>Services</strong>, select <strong>Load balancers</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png" alt="A screenshot showing the load balancers."></a></p>
</li>
<li><p>Select <strong>webLoadBalancer</strong>.</p>
</li>
<li><p>Under <strong>Settings</strong>, Select the <strong>Frontend IP configuration</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-frontend.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-frontend.png" alt="Screenshot of the frontend IP settings of the load balancer."></a></p>
<p> Note</p>
<p>There is a correctly configured frontend IP address. Check that it matches the IP address you have in your other tab.</p>
</li>
<li><p>Under <strong>Settings</strong>, select <strong>Backend pools</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-backend-pools.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-backend-pools.png" alt="Screenshot of the load balancer backend pool."></a></p>
<p> Note</p>
<p>The virtual machines are both running.</p>
</li>
<li><p>Under <strong>Settings</strong>, select <strong>Load balancing rules</strong>, then select <strong>webLoadBalancerRule</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-rules.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-rules.png" alt="Screenshot showing the webLoadBalancerRule to select."></a></p>
</li>
<li><p>Check all the settings for the load balancer rule.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-web-load-balancer-rule-settings.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-web-load-balancer-rule-settings.png" alt="Screenshot of the webLoadBalancerRule settings."></a></p>
</li>
</ol>
<p>You think you have identified the issue. At the moment once a user visits the website they are routed to one virtual machine. This will persist because of the <strong>Session persistence</strong> setting.</p>
<p>You’ll resolve the issue in the next exercise.</p>
<h1 id="Exercise-Resolve-issue-with-load-balancer"><a href="#Exercise-Resolve-issue-with-load-balancer" class="headerlink" title="Exercise: Resolve issue with load balancer"></a>Exercise: Resolve issue with load balancer</h1><p>Completed100 XP</p>
<ul>
<li>7 minutes</li>
</ul>
<p>After investigating the performance issues, you’ve found an issue with the load balancers session persistence settings.</p>
<p>In this exercise, you’ll resolve the issue.</p>
<h2 id="Update-load-balancer-rules"><a href="#Update-load-balancer-rules" class="headerlink" title="Update load balancer rules"></a>Update load balancer rules</h2><ol>
<li><p>Open the <a target="_blank" rel="noopener" href="https://portal.azure.com/learn.docs.microsoft.com">Azure portal</a> in a new tab, select <strong>Load balancers</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/5-load-balancer-search.png" alt="A screenshot showing searching for load balancers."></p>
</li>
<li><p>Select the <strong>webLoadBalancer</strong> load balancer.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-list-of-load-balancers.png" alt="Screenshot showing webLoadBalancer selected."></a></p>
</li>
<li><p>Under <strong>Settings</strong>, select <strong>Load balancing rules</strong>, then select <strong>webLoadBalancerRule</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/4-load-balancer-rules.png" alt="A screenshot showing the load balancer rule highlighted."></p>
</li>
<li><p>To resolve the backend issue, change the <strong>Session persistence</strong> from <strong>Client IP and protocol</strong> to <strong>None</strong>, and then select <strong>Save</strong>.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/5-load-balancer-fix.png#lightbox"><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/5-load-balancer-fix.png" alt="Screenshot showing the rule fixed."></a></p>
<p> Note</p>
<p>By setting <strong>Session persistence</strong> to <strong>None</strong>, successive request from clients can be handled by different virtual machines.</p>
</li>
<li><p>Wait until the rule has been deployed successfully.</p>
</li>
</ol>
<h2 id="Test-that-the-issue-has-been-resolved"><a href="#Test-that-the-issue-has-been-resolved" class="headerlink" title="Test that the issue has been resolved"></a>Test that the issue has been resolved</h2><p>Switch back to the tab where you pasted the public IP address. If you have closed the tab select the load balancer rule and the public IP address is listed there.</p>
<ol>
<li><p>Refresh the browser 20 or 30 times, you should see the message switch between <strong>webVirtualMachine1</strong> and <strong>webVirtualMachine2</strong>.</p>
</li>
<li><p>The traffic is now being shared correctly between all the machines in the backend pool.</p>
<p><img src="https://learn.microsoft.com/en-us/training/wwl-azure/troubleshoot-routing-traffic-control-load-balancing/media/issue-resolved.gif" alt="Animated gif showing the different webservers responding."></p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>Completed100 XP</p>
<ul>
<li>3 minutes</li>
</ul>
<p>Having completed this module, you now have a better understanding of how user-defined routes interact with the network. You can apply different troubleshooting techniques to determine where packet loss is occurring and know when to use the different load-balancing tools.</p>
<p>Now that you have reviewed this module, you should be able to:</p>
<ul>
<li>Understand how user-defined routes interact with the network.</li>
<li>Apply different techniques to determine packet loss.</li>
<li>Choose the most effective load-balancer tool to troubleshoot issues.</li>
</ul>
<h2 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h2><p>Use these resources to discover more.</p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/diagnose-network-routing-problem">Diagnose a virtual machine routing problem</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-troubleshoot-backend-traffic">Troubleshoot Azure Load Balancer backend traffic responses</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/frontdoor/troubleshoot-issues">Troubleshoot Azure Front Door common issues</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-test-latency">Test VM network latency</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview">Virtual network peering</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/vpn-gateway/bgp-diagnostics">View BGP metrics and status</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-manage-peering">Create, change, or delete a virtual network peering</a></p>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-720-Troubleshoot-network-security-issues-with-Microsoft-Azure-6/" rel="prev" title="AZ-720-Troubleshoot-network-security-issues-with-Microsoft-Azure-6">
      <i class="fa fa-chevron-left"></i> AZ-720-Troubleshoot-network-security-issues-with-Microsoft-Azure-6
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/14/AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8/" rel="next" title="AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8">
      AZ-720-Troubleshoot-connectivity-issues-with-virtual-machines-in-Microsoft-Azure-8 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Learning-objectives"><span class="nav-number">1.1.</span> <span class="nav-text">Learning objectives</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prerequisites"><span class="nav-number">1.2.</span> <span class="nav-text">Prerequisites</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Set-up-troubleshooting-environment"><span class="nav-number">2.</span> <span class="nav-text">Set up troubleshooting environment</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-the-exercise-environment"><span class="nav-number">2.1.</span> <span class="nav-text">Create the exercise environment</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-routing-and-traffic-control"><span class="nav-number">3.</span> <span class="nav-text">Troubleshoot routing and traffic control</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-user-defined-routing-issues"><span class="nav-number">3.1.</span> <span class="nav-text">Troubleshoot user-defined routing issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Review-route-tables"><span class="nav-number">3.2.</span> <span class="nav-text">Review route tables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Determine-whether-subnets-are-associated-with-route-tables"><span class="nav-number">3.3.</span> <span class="nav-text">Determine whether subnets are associated with route tables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Azure-portal"><span class="nav-number">3.3.1.</span> <span class="nav-text">Azure portal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diagnose-routes-using-PowerShell"><span class="nav-number">3.3.2.</span> <span class="nav-text">Diagnose routes using PowerShell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Diagnose-routes-using-Azure-CLI"><span class="nav-number">3.3.3.</span> <span class="nav-text">Diagnose routes using Azure CLI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Resolving-routing-problems"><span class="nav-number">3.4.</span> <span class="nav-text">Resolving routing problems</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-asymmetric-routing"><span class="nav-number">3.5.</span> <span class="nav-text">Troubleshoot asymmetric routing</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Routing"><span class="nav-number">3.5.1.</span> <span class="nav-text">Routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Source-based-NAT"><span class="nav-number">3.5.2.</span> <span class="nav-text">Source-based NAT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tracking-asymmetric-routing"><span class="nav-number">3.6.</span> <span class="nav-text">Tracking asymmetric routing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-forced-tunneling-issues"><span class="nav-number">3.7.</span> <span class="nav-text">Troubleshoot forced tunneling issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Border-Gateway-Protocol-BGP-issues"><span class="nav-number">3.8.</span> <span class="nav-text">Troubleshoot Border Gateway Protocol (BGP) issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-multi-VNet-configuration"><span class="nav-number">3.9.</span> <span class="nav-text">Troubleshoot multi-VNet configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-service-chaining"><span class="nav-number">3.10.</span> <span class="nav-text">Troubleshoot service chaining</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Troubleshoot-routing-configuration-of-Azure-VMs-that-function-as-routers"><span class="nav-number">3.10.1.</span> <span class="nav-text">Troubleshoot routing configuration of Azure VMs that function as routers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Network-Virtual-Appliance-vendors"><span class="nav-number">3.10.2.</span> <span class="nav-text">Network Virtual Appliance vendors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-troubleshooting-steps"><span class="nav-number">3.10.3.</span> <span class="nav-text">Other troubleshooting steps</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Troubleshoot-load-balancing-issues"><span class="nav-number">4.</span> <span class="nav-text">Troubleshoot load-balancing issues</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Determine-the-status-of-Azure-Traffic-Manager"><span class="nav-number">4.1.</span> <span class="nav-text">Determine the status of Azure Traffic Manager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Determine-whether-virtual-machines-in-a-load-balanced-cluster-are-healthy"><span class="nav-number">4.2.</span> <span class="nav-text">Determine whether virtual machines in a load-balanced cluster are healthy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Examine-load-balancer-rules"><span class="nav-number">4.3.</span> <span class="nav-text">Examine load balancer rules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Determine-how-resources-are-being-allocated-based-on-the-load-balancer-configuration"><span class="nav-number">4.4.</span> <span class="nav-text">Determine how resources are being allocated based on the load balancer configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-port-exhaustion-issues"><span class="nav-number">4.5.</span> <span class="nav-text">Troubleshoot port exhaustion issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Azure-Front-Door"><span class="nav-number">4.6.</span> <span class="nav-text">Troubleshoot Azure Front Door</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Azure-Application-Gateway"><span class="nav-number">4.7.</span> <span class="nav-text">Troubleshoot Azure Application Gateway</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Azure-Load-Balancer"><span class="nav-number">4.8.</span> <span class="nav-text">Troubleshoot Azure Load Balancer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-Traffic-Manager-profile-issues"><span class="nav-number">4.9.</span> <span class="nav-text">Troubleshoot Traffic Manager profile issues</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshoot-latency-issues"><span class="nav-number">4.10.</span> <span class="nav-text">Troubleshoot latency issues</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-Troubleshoot-routing-traffic-control-and-load-balancing-issues"><span class="nav-number">5.</span> <span class="nav-text">Exercise: Troubleshoot routing, traffic control and load balancing issues</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-that-the-issue-still-exists"><span class="nav-number">5.1.</span> <span class="nav-text">Check that the issue still exists</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-all-the-virtual-machines-are-responding-on-port-80"><span class="nav-number">5.2.</span> <span class="nav-text">Check all the virtual machines are responding on port 80</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-the-Load-Balancer-settings"><span class="nav-number">5.3.</span> <span class="nav-text">Check the Load Balancer settings</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exercise-Resolve-issue-with-load-balancer"><span class="nav-number">6.</span> <span class="nav-text">Exercise: Resolve issue with load balancer</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Update-load-balancer-rules"><span class="nav-number">6.1.</span> <span class="nav-text">Update load balancer rules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Test-that-the-issue-has-been-resolved"><span class="nav-number">6.2.</span> <span class="nav-text">Test that the issue has been resolved</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">7.</span> <span class="nav-text">Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Resources"><span class="nav-number">7.1.</span> <span class="nav-text">Resources</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
