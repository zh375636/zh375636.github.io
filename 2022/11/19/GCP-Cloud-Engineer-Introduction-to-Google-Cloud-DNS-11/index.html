<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionHello, and welcome to Introduction to Google Cloud DNS. My name is Daniel Mease and I’ll be taking you through this course. I’m a trainer at Cloud Academy with over 20 years of software an">
<meta property="og:type" content="article">
<meta property="og:title" content="GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11">
<meta property="og:url" content="https://example.com/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="IntroductionHello, and welcome to Introduction to Google Cloud DNS. My name is Daniel Mease and I’ll be taking you through this course. I’m a trainer at Cloud Academy with over 20 years of software an">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-19T04:02:50.000Z">
<meta property="article:modified_time" content="2022-11-23T00:52:16.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-19 00:02:50" itemprop="dateCreated datePublished" datetime="2022-11-19T00:02:50-04:00">2022-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 20:52:16" itemprop="dateModified" datetime="2022-11-22T20:52:16-04:00">2022-11-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GCP-Cloud-Engineer/" itemprop="url" rel="index"><span itemprop="name">GCP-Cloud-Engineer</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-DNS-11/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Hello, and welcome to Introduction to Google Cloud DNS. My name is Daniel Mease and I’ll be taking you through this course. I’m a trainer at Cloud Academy with over 20 years of software and web development experience. This course is intended for networking engineers, security engineers, or anyone who’s interested in managing DNS on Google Cloud Platform.</p>
<p>After completing this course, you will be able to one, <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/features/">understand what Cloud DNS is</a> and what it can do. Two, manage DNS records. Three, enable DNS security extensions. Four, create public and private <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/zones/">zones</a>. Five, set <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/policies/">DNS policies</a>. And six, log and monitor DNS activity.</p>
<p>The following prerequisites are required. You should already have a solid understanding of DNS. Now, this course is going to assume that you already understand the basics, such as what DNS is, how it works, and what DNS records are.</p>
<p>Feedback on our courses is valuable, both to us as trainers and our future students. If you have any criticisms or suggestions for improvement, we would greatly appreciate it if you would share those with us.</p>
<p>Please note that when this video was recorded, all course information was accurate. The products and services mentioned are constantly being updated. As a result, over time, minor discrepancies may appear in the course content. Here at Cloud Academy, we strive to keep our content up-to-date in order to provide the best training available. So if you notice any information that is outdated, please contact support at cloudacademy.com. This will allow us to make all necessary fixes to the course during its next release cycle.</p>
<h1 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h1><p>Cloud DNS is Google’s global domain name service. It has everything you need to manage, and serve your domains. You can use it for mapping public IP addresses to public domain names, and for creating private domain names as well. Now, this second feature is extremely useful for managing highly complex infrastructure. Instead of hard coding the IP addresses of various services in your code, you can use internal DNS names instead. That means that when an IP address changes, you don’t have to change your code. It also makes testing and deployment much easier since the same DNS names can work across multiple environments including development, testing, staging, and production.</p>
<p>With Google Cloud DNS, there’s no need to maintain your own DNS servers or software. The service is fully managed and highly scalable. It can handle millions of records. Cloud DNS all offers a hundred percent availability and low latency access from anywhere in the world. On top of that, you can also generate detailed logs to use for <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/managing-your-google-cloud-infrastructure/monitoring-3/">monitoring</a> and troubleshooting. If you already have a <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/google/">GCP</a> account, then using Cloud DNS is a no-brainer.</p>
<h1 id="Zones"><a href="#Zones" class="headerlink" title="Zones"></a>Zones</h1><p>Probably the most common activity when working with Cloud DNS is to create or update DNS records. But before you can start modifying records, you need to be familiar with DNS zones. A DNS zone is a container of DNS records for the same DNS name suffix. All DNS records are stored within a zone. DNS zones also automatically generate certain records like the NS and SOA so you don’t have to add them yourself.</p>
<p>Now, Cloud DNS offers two types of zones. Public and private. Public zones are visible to the whole internet. While private zones are only visible to the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-a-gcp-virtual-private-cloud-1224/shared-vpcs/">VPC networks</a> that you specify. So, an internet-facing website would use a public zone but a company intranet site like a wiki would use a private zone. Now, there are times where you might want to mix both private and public zones. Now, this would allow you to return different results for the same domain name depending upon the source IP. This is called Split Horizon DNS.</p>
<p>So, let’s imagine the following scenario. Say, you have a web server running in a VPC with both a public and private IP. Now, you want your internet users to be able to access this web server via the public IP. You also want internal resources such as other <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/planning-configuring-google-cloud-platform-solution/compute-virtual-machine-types/">VM</a>s to be able to access it via private IP. Split horizon DNS would allow you to use the same DNS name for both. Internet clients would get the public IP and internal clients would get the private IP.</p>
<p>Now, to set up split DNS, all you have to do is create both a public and private zone for the same domain. Then, just add the appropriate records. Public DNS zones can also be configured to enforce DNS security extensions. Now, DNS security extensions or DNSSEC is a feature that authenticates responses for domain name lookups. Now, before DNSSEC was introduced, you had to trust that your DNS results were accurate. But if a response was poisoned it could result in redirecting you to a different and potentially harmful server. By enabling DNSSEC for a zone, you can cryptographically verify that the data received actually came from where it was supposed to. You can also verify that the data was not modified in transit.</p>
<p>Now, zones can also be used for DNS Forwarding. Forwarding allows requests for certain domains to be resolved by another DNS server. Now, this is useful if you wanna resolve names that you do not control yourself. So, if say you were connecting from your on-prem environment to your GCP environment, you could use DNS forwarding to get access to private DNS records in GCP.</p>
<p>Now, forwarding can be either outbound or inbound. Outbound forwarding means that you will be forwarding DNS requests outside of <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/google/">Google Cloud platform</a>. Inbound forwarding will be routing requests into Google Cloud platform. Another option you have with DNS zones is called peering. DNS peering works similarly to DNS forwarding but with one main difference. With DNS peering, you’re allowing requests to be forwarded from one VPC to another for specific zones. This works regardless of whether the VPC networks are actually connected or not.</p>
<p>Now, this is important to note. DNS forwarding does not let you forward requests between VPCs nor does it support transitive routing. DNS forwarding only handles external to internal and internal to external routing. DNS peering is for internal to internal routing between VPCs. It also does support transitive routing, but only through a single hop. DNS peering can make it possible for your teams to independently manage their own DNS zones while also sharing them with the rest of your organization.</p>
<p>You should also be careful not to confuse DNS Peering with VPC Network Peering. They are different. VPC peering allows VMs in different projects to reach each other but it does not affect name resolution. DNS peering allows you to access DNS records in a different VPC, but it does not affect the connectivity of those VPCs. You can use both options at the same time but they do different things.</p>
<h1 id="Zones-Demo"><a href="#Zones-Demo" class="headerlink" title="Zones Demo"></a>Zones Demo</h1><p>So now that you understand what zones are, let me run you through a practical demonstration of how you will typically use them. First, I will show you how to map a public IP for a website to a public domain name. Then, I’ll show you how to create a private DNS name for internal use. And finally, I’ll also show you how to set up DNS peering and DNS forwarding. Now, before I start, you should know that I’ve already set up a few VPCs and VMs. I have two Linux virtual machines, both running Apache, and serving up a single webpage. Now each <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/planning-configuring-google-cloud-platform-solution/compute-virtual-machine-types/">VM</a> has its own public and private IP and they’re running inside their own separate <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-a-gcp-virtual-private-cloud-1224/shared-vpcs/">VPC</a>. I’ve also added firewall rules to open ports 80 and 22. So I can connect to each VM via SSH and HTTP. Here, you see that I can already connect to the web servers by using their IP address.</p>
<p>But now, I’m going to add a public DNS record so that I can use a domain name to connect instead. So for the first step, I need to bring up the Cloud DNS page. Now you can see here that there are options for working with zones and for working with policies. I’m going to be adding a DNS record, so I need to create a zone. Now when creating a zone, you have to specify which kind you want. This is going to be a public domain name, so I need to create a public zone. To set up a public zone, you need to have a domain name registered. Now I’ve already done this using Google Cloud Domains.</p>
<p>Cloud DNS does not handle domain registration, so you’ll need to use a different tool. Here, you can see my domain name. Now you can use Cloud Domains as well if you wish. However, it’s not required. There are many other domain registrars out there, so pick the one you like best. To create my new public zone, I have to assign it a name. I’m gonna set the name to be the same as the domain, except I’ll need to replace the periods with dashes. Zone names can only contain letters, numbers and dashes.</p>
<p>Next, I need to specify the domain name, so let me enter that. And now, I can choose to enable DNS Security Extensions. Now this is generally recommended, so I’m gonna enable that here as well. You can see under DNSSEC that there are three options provided: Off, On and Transfer. It should be obvious what the Off and On options do. Transfer is used when you’re in the middle of transferring a domain name over to Google and you already have DNSSEC enabled. While this option is supported, I would generally not recommend using it.</p>
<p>It’s usually safer and easier to disable DNS Security extensions before starting the transfer. You can then re-enable DNSSEC after the transfer has completed. Now I can optionally add a description here if I want. It’s unnecessary for this demo since I’m only going to end up with a few zones. But this field becomes more useful when you have hundreds or thousands of zones. So at this point, I can confirm the zone creation. Now, in my demo, I’m gonna be using the cloud console a lot, but you can also accomplish the same things using command lines tools as well. So here is where you can see the equivalent command for creating a public zone.</p>
<p>Alright, now that I’ve created the zone, let’s review the details. Here, you can see the domain name, as well as verify that DNS Security extensions has been enabled. You also should notice that the SOA and NS records were automatically generated. Now, if I return to the zone page, you can see what this new entry looks like here. Remember, I still haven’t actually added the A record yet. I’ve just created the zone. So, let me do that next. I’ll click on the zone and I’ll select Add Record Set.</p>
<p>Now adding a DNS record is very simple. The default type is already set to A, so I don’t need to change that. Now if I wanted to add an IPv6 address, I could create a AAAA record as well. All I need to do is specify the server name, which I will call WWW, and then I’ll specify the IP address, which I can copy from the Compute Engine screen. If you want to use the command line to do this, you can get those commands from here. Okay, so now I have created my A record. There’s just one last thing to do. I need to tell my registrar to forward requests for the new domain to Cloud DNS. Now this is going to be simple since I’m using Google service. But you can accomplish the same thing using a different registrar. Of course, if you do, the steps will probably be slightly different than what you see here.</p>
<p>Now, in theory, I should be able to start using <a target="_blank" rel="noopener" href="http://www.ca-demo-domain.com/">www.ca-demo-domain.com</a> to access my apache web server. I say in theory because DNS changes can take a while to propagate. This is probably not gonna work right away. You see that I’m getting an error here because it’s gonna take a while for the records to actually be available. Now this could take hours, might even take a whole day, so let me go ahead and skip ahead. Okay, now you can see the DNS record is working properly. Luckily, I have my own private DNS server and so I was able to force it to grab the updated records pretty quickly.</p>
<p>Now most people will not have that option, so again, you might have to wait up to a day before it finally starts working. But now we see that my domain name is correctly resolving to the first apache web server instance. So now you know how you create a new public DNS zone and record. Next, I’m going to show you how to work with private records. I’m going to create a private domain name and map that to the private IP for my second VM.</p>
<p>Now this domain name is only going to be usable inside of my <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/google/">GCP</a> account. So to do this, I need to return to the Cloud DNS page and then create a new zone. This zone is going to be private. And you’ll notice, when I select private, that some of the options have changed. I still have to provide a zone name and a domain name. But the DNS Security extensions option has disappeared. That is because it’s only available for public zones.</p>
<p>Also, now I have to pick what kind of private zone this will be. Here is where you can set up forwarding or peering or pick some other advanced options as well. Now for this zone, I’m just gonna keep to the default type. Finally, I have to choose the network, or networks, that this zone will be active for. So here, I’m going to pick VPC-2 because that is what contains my second VM. Now I have a new private domain called privatedomain.com configured for VPC-2. Again the SOA and NS records are added automatically.</p>
<p>So, my last step is just to add the A record. So I can copy the private IP address here. And then, I’ll set the domain name to be the same as the instance. And now, apache-2-vm.privatedomain.com should resolve to my Apache 2 instance. Remember, this is an internal DNS record, so I can’t use my browser to test like last time. Instead, I’m gonna SSH to the VM instance and then use the ping command to verify that it worked. So here we see ping is returning the correct IP. That means our DNS record is working. So now you know how to create a private DNS zone and record.</p>
<p>Currently, this private DNS record is working for Apache-2-vm, but it will not work for Apache-1-vm. Now this is because Apache-1 is in a different VPC. If I want, I can use DNS peering to share the DNS records in VPC-2 with VPC-1. So let me do that next. I need to go back to Cloud DNS and create yet another zone. As we saw last time, DNS Peering and Forwarding are available under a private zone. I need to pick a name. And here, I need to specify the domain name that I wish to peer. I also have to specify the network that I wish to share my DNS records with. So this should be VPC-1. And then finally, I have to select the network that I’m sharing from. Because this can actually be a network in a completely different project, I need to pick the project first. And now I can pick the network.</p>
<p>Okay, so this is going to share all DNS records for privatedomain.com created in VPC-2 with VPC-1. I should now be able to resolve apache-2-vm.privatedomain.com from apache-1-vm. Here, we see the ping command can resolve the IP address, so peering is working. You will also notice that, unlike last time, that ping is not getting a response. Now this is completely expected. DNS Peering only shares DNS records. It does not enable connectivity between VPCs. While I now can look up the IP address, I still can’t actually connect. If I wanted to allow apache-1 to be able to successfully ping apache-2, I would need to configure VPC peering.</p>
<p>Now the last thing I want to quickly demonstrate is how to set up DNS Forwarding. For this, I need to create yet another private zone, and then select Forward Queries to another server. A Forwarding zone is going to require me to specify an external DNS server. Setting up an external DNS server is beyond the scope of this demo. So instead, I’m just going to forward DNS requests for the google.com domain to one of Google’s public DNS servers. Now this is not something you would typically do. Normally, you would use this option to forward requests to say, an on-prem domain. And then the DNS server would be your internal on-prem server. But this will at least show you the basic idea. So now, any requests for the google.com domain in either VPC-1 or VPC-2 will be forwarded to Google’s public DNS server at 8.8.8.8 instead of trying to resolve it locally. So now you know how to create the four main types of zones: public, private, peering and forwarding.</p>
<h1 id="Policies"><a href="#Policies" class="headerlink" title="Policies"></a>Policies</h1><p>In order to use all the features of Cloud DNS, you need to be aware of policies. In this lesson, I’m going to describe what DNS policies are and what they can do. Cloud DNS policies allow you to override Cloud DNS settings. Policies can be simple, like enable login, or they can be more advanced. To help you understand when you might need to use a policy, let’s think about the following scenario. Say your company is using the hybrid Cloud architecture and it has multiple authoritative DNS servers. You have some on-prem resources, running under an on-prem DNS server, and you have some GCP resources running under Cloud DNS.</p>
<p>In order to make both systems work together, you have a few options. Number one, you can handle all DNS resolution on-premises. Number two, you can handle all DNS resolution with cloud DNS, or number three, you can set up a hybrid DNS environment.</p>
<p>First, let’s talk about handling all DNS resolution on-premises. This can be achieved by adding a Cloud DNS policy that specifies an alternative name server. An alternative name server tells Cloud DNS to forward all requests to the specified server. This effectively bypasses Cloud DNS for name resolution. You can think of it as being similar to DNS forwarding, except it applies globally to all domains. Now, be aware, if you choose to move all your GCP DNS resolution to on-premises, there will be some trade offs.</p>
<p>First, DNS requests from GCP are going to have a higher latency. Second, if your on-prem connection is ever disrupted, then your GCP resources will not be able to resolve any DNS names. Third, it’s going to be more difficult to support highly flexible GCP environments, such as autoscaled instance groups. And fourth, you might not be able to use certain GCP products, ones that rely on reverse DNS resolution of instance names, for example, Dataproc.</p>
<p>All right, next, let’s talk about the second option, handling all DNS resolution with Cloud DNS. Now, this can be achieved via another DNS policy that enables inbound query forwarding. Now, by default, a VPCs name resolution services are only available to that <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-a-gcp-virtual-private-cloud-1224/shared-vpcs/">VPC</a> itself. However, you can create an inbound server policy to share these name resolution services with other networks, either via <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/deploying-networking-and-compute-resources-on-google-cloud-platform/creating-a-vpn-connection/">Cloud VPN</a>, or cloud Interconnect. Now, in this setup, all your on-prem DNS requests are going to be sent to Cloud DNS. Similar to the first solution, this design also suffers a few drawbacks.</p>
<p>First, your on-prem DNS requests will have a higher latency. And second, if your connection to GCP is ever disrupted, your on-prem resources will not be able to resolve any DNS names. So while you can choose between either a 100% on-prem, or 100% cloud DNS strategy, it’s generally recommended that you go with a hybrid one instead. You can use Cloud DNS for your Google resources, and your on-prem DNS server for your on-prem resources.</p>
<p>Now, this setup is slightly more complex, but it gives you the best of both worlds. Here is what a hybrid setup would look like. To access on-premises resources from <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/google/">Google Cloud platform</a>, you would need to set up a forwarding zone for your corporate domain. You do not wanna use an alternative name server here. That would cause you to lose access to compute engine internal DNS names. Also, all public IP resolution would have an extra hop added, as they too would be routed through your on-premises name server. A forwarding zone here is the better option.</p>
<p>Next, to access GCP from on-premises, you would create a DNS server policy that enabled inbound DNS forwarding. Inbound DNS forwarding will allow your on-prem systems to query all private zones in the project, as well as internal DNS IP addresses and peered zones. Once this policy is added, Cloud DNS will create a set of regional IP addresses. You will then use this list to update your on-prem DNS and enable the appropriate forwarding. Now, this hybrid approach is considered a best practice by Google. It will generally offer the most options with the least headaches.</p>
<h1 id="Polices-Demo"><a href="#Polices-Demo" class="headerlink" title="Polices Demo"></a>Polices Demo</h1><p>Now that you understand what DNS policies can do, let me demonstrate how to create them. First, I’m going to show you how to add an alternative name server. Then, I’ll show you how to enable inbound query forwarding. And finally, I’ll show you how to enable DNS logging. So, you create new policies by going to the Cloud DNS page, and then clicking on the “DNS Server Policies” tab.</p>
<p>Now currently, you can see that there are no policies set. So, for my first policy, let me specify an alternative name server. I just need to click on “Create Policy” to start. I do not want to enable “Inbound Query Forwarding” yet, so let me turn that off. For some reason it’s enabled by default for every new policy. You can also see that it’s possible to enable multiple options with a single policy. I can specify my alternative name server down here. I’m just going to use 8.8.8.8, which is one of Google’s public DNS servers. This is not something that I typically would do, as it’s going to forward all DNS requests to a DNS server that I have no control over.</p>
<p>Typically, I would enter the IP address of an on-prem DNS server here. And now all I have to do is to specify a name for this policy. So, this policy is gonna forward all DNS requests to one of Google’s public DNS servers. However, even though I added the policy, it’s still not affecting anything yet. And that is because I did not specify any networks yet. I also need to pick the networks that this policy is going to be applied to. Let me do that now. I’m gonna go ahead and add all my networks.</p>
<p>So now, I’ve effectively replaced Cloud DNS with 8.8.8.8 for all of my <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/implementing-a-gcp-virtual-private-cloud-1224/shared-vpcs/">VPC</a>s. So for the next part, I want to show you how to do the opposite. I’m going to create a policy that will allow me to replace an external DNS server with Cloud DNS. Now before I do this, I need to delete my previous policy first. In order to delete a policy, you have to remove all attached networks. Now you can see, I can delete the actual policy. So, I’m gonna create a new policy and this time I’m going to leave the “Inbound Query Forwarding” option enabled. You’ll notice that there’s not really any other options to choose. And that’s because all we’re doing is we’re telling Cloud DNS to accept external DNS requests.</p>
<p>So here, I just have to specify a name and then pick the networks that this will apply to. You can prevent sharing certain DNS records by excluding certain networks. Okay, so all the configuration changes have been completed on the <a target="_blank" rel="noopener" href="https://cloudacademy.com/library/google/">Google</a> side. The only step left would be to update my external DNS server. Now, those exact steps are gonna depend upon the type of DNS server that you’re running, and so I’m not gonna cover that part. However, I will show you how to get a list of IP endpoints that you will need.</p>
<p>Now, you can run this following command using the <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-sdk-1675/using-google-cloud-sdk/">Cloud SDK</a> to get the list of IPs. Now these IPs are what you’re going to forward your DNS requests to. If you don’t have the Cloud SDK installed locally, then you could still use Cloud Shell to run the command instead. Okay, for this last policy, I’m gonna show you how to enable DNS logging. Let me delete the previous policy. Now I can add the new policy. I’ll give it a name. I need to enable “Logs” and then disable “Inbound Query Forwarding”. And of course, I need to specify the networks that this will apply to.</p>
<p>With this new policy, Cloud DNS is going to begin to keep detailed logs for any DNS lookups. You should be aware that cached responses are not logged, so keep that in mind. Also, you should be aware that this can potentially generate a significant amount of data. Enabling these logs might result in extra storage costs. All metrics are exported to Cloud Monitoring and you can view that using Logs Explorer. So, here’s where you can search for your logs, you view your logs, and you can build different queries. I’m not gonna take the time to teach you how to actually use Logs Explorer, since that’s covered elsewhere.</p>
<p>If you’re interested, you can look up the details afterwards. This is how you enable logging and where you go to find the logs. You’re gonna find this extremely helpful for troubleshooting any DNS related issues you might run into. All right, so that’s about it. You know how to use the three main policy types in Google Cloud DNS.</p>
<h1 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h1><p>At this point, you should have a good understanding of how to start using Cloud DNS. Before I wrap things up, let’s quickly review the topics that were covered. In this course, we focused on <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/zones-demo/">DNS zones</a> and <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/polices-demo/">DNS policies</a>. Zones are used for managing DNS records, while policies are used for overriding DNS behavior. When you want to modify DNS resolution for a domain or subdomain, you use a zone. When you want to replace one DNS server with another, you would use a policy.</p>
<p>DNS zones allow you to create and update DNS records, but they also support other <a target="_blank" rel="noopener" href="https://cloudacademy.com/course/introduction-google-cloud-dns-2358/features/">features</a>, as well. DNS forward allows you to forward requests for certain domains from Cloud DNS to an external DNS server, and vice versa. Remember, forwarding does not support internal forwarding from one VPC to another. That is what DNS Peering is for. You use DNS Peering to share domain records managed by one VPC with other VPCs. DNS policies are used to completely override DNS server behavior. So you can shift all DNS resolution to an external server by specifying an Alternative Name Server policy. Or, you can shift DNS resolution to Cloud DNS by creating a enable inbound query forwarding policy. And if you just wanna enable DNS logging, you can create a policy for that, as well.</p>
<p>Well, that’s all I have for you today. Remember to give this course a rating, and if you have any questions or comments, please let us know. Thanks for watching, and make sure to check out our many other courses on Cloud Academy.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/19/GCP-Cloud-Engineer-Create-a-Network-Infrastructure-with-Google-Virtual-Private-Cloud-10/" rel="prev" title="GCP-Cloud-Engineer-Create-a-Network-Infrastructure-with-Google-Virtual-Private-Cloud-10">
      <i class="fa fa-chevron-left"></i> GCP-Cloud-Engineer-Create-a-Network-Infrastructure-with-Google-Virtual-Private-Cloud-10
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/19/GCP-Cloud-Engineer-Introduction-to-Google-Cloud-NAT-12/" rel="next" title="GCP-Cloud-Engineer-Introduction-to-Google-Cloud-NAT-12">
      GCP-Cloud-Engineer-Introduction-to-Google-Cloud-NAT-12 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Features"><span class="nav-number">2.</span> <span class="nav-text">Features</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zones"><span class="nav-number">3.</span> <span class="nav-text">Zones</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Zones-Demo"><span class="nav-number">4.</span> <span class="nav-text">Zones Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Policies"><span class="nav-number">5.</span> <span class="nav-text">Policies</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Polices-Demo"><span class="nav-number">6.</span> <span class="nav-text">Polices Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary"><span class="nav-number">7.</span> <span class="nav-text">Summary</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
