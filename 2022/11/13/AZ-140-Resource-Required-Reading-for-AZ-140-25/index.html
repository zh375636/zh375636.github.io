<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Security best practicesAzure Virtual Desktop is a managed virtual desktop service that includes many security capabilities for keeping your organization safe. In a Azure Virtual Desktop deployment,">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-140-Resource-Required-Reading-for-AZ-140-25">
<meta property="og:url" content="https://example.com/2022/11/13/AZ-140-Resource-Required-Reading-for-AZ-140-25/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="Security best practicesAzure Virtual Desktop is a managed virtual desktop service that includes many security capabilities for keeping your organization safe. In a Azure Virtual Desktop deployment,">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/unassign.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/unassign-2.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/reassign-doc.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/reassign.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/no-validation-environment.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/validation-yes.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/validation-no.png">
<meta property="og:image" content="https://techcommunity.microsoft.com/t5/image/serverpage/image-id/393421iA84288292EE6B510/image-size/medium?v=v2&px=400">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/basics-tab.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/remoteapp-button.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/select-users.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/add-app-start.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/add-app-file.png">
<meta property="og:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/register-existing.png">
<meta property="article:published_time" content="2022-11-13T23:13:17.000Z">
<meta property="article:modified_time" content="2022-11-20T23:18:22.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/unassign.png">

<link rel="canonical" href="https://example.com/2022/11/13/AZ-140-Resource-Required-Reading-for-AZ-140-25/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-140-Resource-Required-Reading-for-AZ-140-25 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/13/AZ-140-Resource-Required-Reading-for-AZ-140-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-140-Resource-Required-Reading-for-AZ-140-25
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-13 19:13:17" itemprop="dateCreated datePublished" datetime="2022-11-13T19:13:17-04:00">2022-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:18:22" itemprop="dateModified" datetime="2022-11-20T19:18:22-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-140/" itemprop="url" rel="index"><span itemprop="name">AZ-140</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/13/AZ-140-Resource-Required-Reading-for-AZ-140-25/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/13/AZ-140-Resource-Required-Reading-for-AZ-140-25/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <span id="more"></span>

<h1 id="Security-best-practices"><a href="#Security-best-practices" class="headerlink" title="Security best practices"></a>Security best practices</h1><p>Azure Virtual Desktop is a managed virtual desktop service that includes many security capabilities for keeping your organization safe. In a Azure Virtual Desktop deployment, Microsoft manages portions of the services on the customer’s behalf. The service has many built-in advanced security features, such as Reverse Connect, which reduce the risk involved with having remote desktops accessible from anywhere.</p>
<p>This article describes additional steps you can take as an admin to keep your customers’ Azure Virtual Desktop deployments secure.</p>
<h2 id="Security-responsibilities"><a href="#Security-responsibilities" class="headerlink" title="Security responsibilities"></a>Security responsibilities</h2><p>What makes cloud services different from traditional on-premises virtual desktop infrastructures (VDIs) is how they handle security responsibilities. For example, in a traditional on-premises VDI, the customer would be responsible for all aspects of security. However, in most cloud services, these responsibilities are shared between the customer and the company.</p>
<p>When you use Azure Virtual Desktop, it’s important to understand that while some components come already secured for your environment, you’ll need to configure other areas yourself to fit your organization’s security needs.</p>
<p>Here are the security needs you’re responsible for in your Azure Virtual Desktop deployment:</p>
<table>
<thead>
<tr>
<th align="left">Security need</th>
<th align="center">Is the customer responsible for this?</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Identity</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">User devices (mobile and PC)</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">App security</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">Session host operating system (OS)</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">Deployment configuration</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">Network controls</td>
<td align="center">Yes</td>
</tr>
<tr>
<td align="left">Virtualization control plane</td>
<td align="center">No</td>
</tr>
<tr>
<td align="left">Physical hosts</td>
<td align="center">No</td>
</tr>
<tr>
<td align="left">Physical network</td>
<td align="center">No</td>
</tr>
<tr>
<td align="left">Physical datacenter</td>
<td align="center">No</td>
</tr>
</tbody></table>
<p>The security needs the customer isn’t responsible for are handled by Microsoft.</p>
<h2 id="Azure-security-best-practices"><a href="#Azure-security-best-practices" class="headerlink" title="Azure security best practices"></a>Azure security best practices</h2><p>Azure Virtual Desktop is a service under Azure. To maximize the safety of your Azure Virtual Desktop deployment, you should make sure to secure the surrounding Azure infrastructure and management plane as well. To secure your infrastructure, consider how Azure Virtual Desktop fits into your larger Azure ecosystem. To learn more about the Azure ecosystem, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/security/fundamentals/best-practices-and-patterns">Azure security best practices and patterns</a>.</p>
<p>This section describes best practices for securing your Azure ecosystem.</p>
<h3 id="Enable-Microsoft-Defender-for-Cloud"><a href="#Enable-Microsoft-Defender-for-Cloud" class="headerlink" title="Enable Microsoft Defender for Cloud"></a>Enable Microsoft Defender for Cloud</h3><p>We recommend enabling Microsoft Defender for Cloud’s enhanced security features to:</p>
<ul>
<li>Manage vulnerabilities.</li>
<li>Assess compliance with common frameworks like PCI.</li>
<li>Strengthen the overall security of your environment.</li>
</ul>
<p>To learn more, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-security">Enable enhanced security features</a>.</p>
<h3 id="Improve-your-Secure-Score"><a href="#Improve-your-Secure-Score" class="headerlink" title="Improve your Secure Score"></a>Improve your Secure Score</h3><p>Secure Score provides recommendations and best practice advice for improving your overall security. These recommendations are prioritized to help you pick which ones are most important, and the Quick Fix options help you address potential vulnerabilities quickly. These recommendations also update over time, keeping you up to date on the best ways to maintain your environment’s security. To learn more, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/secure-score-security-controls">Improve your Secure Score in Microsoft Defender for Cloud</a>.</p>
<h2 id="Azure-Virtual-Desktop-security-best-practices"><a href="#Azure-Virtual-Desktop-security-best-practices" class="headerlink" title="Azure Virtual Desktop security best practices"></a>Azure Virtual Desktop security best practices</h2><p>Azure Virtual Desktop has many built-in security controls. In this section, you’ll learn about security controls you can use to keep your users and data safe.</p>
<h3 id="Require-multi-factor-authentication"><a href="#Require-multi-factor-authentication" class="headerlink" title="Require multi-factor authentication"></a>Require multi-factor authentication</h3><p>Requiring multi-factor authentication for all users and admins in Azure Virtual Desktop improves the security of your entire deployment. To learn more, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/set-up-mfa">Enable Azure AD Multi-Factor Authentication for Azure Virtual Desktop</a>.</p>
<h3 id="Enable-Conditional-Access"><a href="#Enable-Conditional-Access" class="headerlink" title="Enable Conditional Access"></a>Enable Conditional Access</h3><p>Enabling <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/overview">Conditional Access</a> lets you manage risks before you grant users access to your Azure Virtual Desktop environment. When deciding which users to grant access to, we recommend you also consider who the user is, how they sign in, and which device they’re using.</p>
<h3 id="Collect-audit-logs"><a href="#Collect-audit-logs" class="headerlink" title="Collect audit logs"></a>Collect audit logs</h3><p>Enabling audit log collection lets you view user and admin activity related to Azure Virtual Desktop. Some examples of key audit logs are:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log">Azure Activity Log</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-activity-logs-azure-monitor">Azure Active Directory Activity Log</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis">Azure Active Directory</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agent-windows">Session hosts</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/key-vault/general/logging">Key Vault logs</a></li>
</ul>
<h3 id="Use-RemoteApps"><a href="#Use-RemoteApps" class="headerlink" title="Use RemoteApps"></a>Use RemoteApps</h3><p>When choosing a deployment model, you can either provide remote users access to entire virtual desktops or only select applications. Remote applications, or RemoteApps, provide a seamless experience as the user works with apps on their virtual desktop. RemoteApps reduce risk by only letting the user work with a subset of the remote machine exposed by the application.</p>
<h3 id="Monitor-usage-with-Azure-Monitor"><a href="#Monitor-usage-with-Azure-Monitor" class="headerlink" title="Monitor usage with Azure Monitor"></a>Monitor usage with Azure Monitor</h3><p>Monitor your Azure Virtual Desktop service’s usage and availability with <a target="_blank" rel="noopener" href="https://azure.microsoft.com/services/monitor/">Azure Monitor</a>. Consider creating <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/service-health/alerts-activity-log-service-notifications-portal">service health alerts</a> for the Azure Virtual Desktop service to receive notifications whenever there’s a service impacting event.</p>
<h3 id="Encrypt-your-VM"><a href="#Encrypt-your-VM" class="headerlink" title="Encrypt your VM"></a>Encrypt your VM</h3><p>Encrypt your VM with <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/disk-encryption-overview">managed disk encryption options</a> to protect stored data from unauthorized access.</p>
<h2 id="Session-host-security-best-practices"><a href="#Session-host-security-best-practices" class="headerlink" title="Session host security best practices"></a>Session host security best practices</h2><p>Session hosts are virtual machines that run inside an Azure subscription and virtual network. Your Azure Virtual Desktop deployment’s overall security depends on the security controls you put on your session hosts. This section describes best practices for keeping your session hosts secure.</p>
<h3 id="Enable-endpoint-protection"><a href="#Enable-endpoint-protection" class="headerlink" title="Enable endpoint protection"></a>Enable endpoint protection</h3><p>To protect your deployment from known malicious software, we recommend enabling endpoint protection on all session hosts. You can use either Windows Defender Antivirus or a third-party program. To learn more, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/deployment-vdi-windows-defender-antivirus">Deployment guide for Windows Defender Antivirus in a VDI environment</a>.</p>
<p>For profile solutions like FSLogix or other solutions that mount VHD files, we recommend excluding VHD file extensions.</p>
<h3 id="Install-an-endpoint-detection-and-response-product"><a href="#Install-an-endpoint-detection-and-response-product" class="headerlink" title="Install an endpoint detection and response product"></a>Install an endpoint detection and response product</h3><p>We recommend you install an endpoint detection and response (EDR) product to provide advanced detection and response capabilities. For server operating systems with <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/integration-defender-for-endpoint">Microsoft Defender for Cloud</a> enabled, installing an EDR product will deploy Microsoft Defender for Endpoint. For client operating systems, you can deploy <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/onboarding">Microsoft Defender for Endpoint</a> or a third-party product to those endpoints.</p>
<h3 id="Enable-threat-and-vulnerability-management-assessments"><a href="#Enable-threat-and-vulnerability-management-assessments" class="headerlink" title="Enable threat and vulnerability management assessments"></a>Enable threat and vulnerability management assessments</h3><p>Identifying software vulnerabilities that exist in operating systems and applications is critical to keeping your environment secure. Microsoft Defender for Cloud can help you identify problem spots through <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/deploy-vulnerability-assessment-tvm">Microsoft Defender for Endpoint’s threat and vulnerability management solution</a>. You can also use third-party products if you’re so inclined, although we recommend using Microsoft Defender for Cloud and Microsoft Defender for Endpoint.</p>
<h3 id="Patch-software-vulnerabilities-in-your-environment"><a href="#Patch-software-vulnerabilities-in-your-environment" class="headerlink" title="Patch software vulnerabilities in your environment"></a>Patch software vulnerabilities in your environment</h3><p>Once you identify a vulnerability, you must patch it. This applies to virtual environments as well, which includes the running operating systems, the applications that are deployed inside of them, and the images you create new machines from. Follow your vendor patch notification communications and apply patches in a timely manner. We recommend patching your base images monthly to ensure that newly deployed machines are as secure as possible.</p>
<h3 id="Establish-maximum-inactive-time-and-disconnection-policies"><a href="#Establish-maximum-inactive-time-and-disconnection-policies" class="headerlink" title="Establish maximum inactive time and disconnection policies"></a>Establish maximum inactive time and disconnection policies</h3><p>Signing users out when they’re inactive preserves resources and prevents access by unauthorized users. We recommend that timeouts balance user productivity as well as resource usage. For users that interact with stateless applications, consider more aggressive policies that turn off machines and preserve resources. Disconnecting long running applications that continue to run if a user is idle, such as a simulation or CAD rendering, can interrupt the user’s work and may even require restarting the computer.</p>
<h3 id="Set-up-screen-locks-for-idle-sessions"><a href="#Set-up-screen-locks-for-idle-sessions" class="headerlink" title="Set up screen locks for idle sessions"></a>Set up screen locks for idle sessions</h3><p>You can prevent unwanted system access by configuring Azure Virtual Desktop to lock a machine’s screen during idle time and requiring authentication to unlock it.</p>
<h3 id="Establish-tiered-admin-access"><a href="#Establish-tiered-admin-access" class="headerlink" title="Establish tiered admin access"></a>Establish tiered admin access</h3><p>We recommend you don’t grant your users admin access to virtual desktops. If you need software packages, we recommend you make them available through configuration management utilities like Microsoft Endpoint Manager. In a multi-session environment, we recommend you don’t let users install software directly.</p>
<h3 id="Consider-which-users-should-access-which-resources"><a href="#Consider-which-users-should-access-which-resources" class="headerlink" title="Consider which users should access which resources"></a>Consider which users should access which resources</h3><p>Consider session hosts as an extension of your existing desktop deployment. We recommend you control access to network resources the same way you would for other desktops in your environment, such as using network segmentation and filtering. By default, session hosts can connect to any resource on the internet. There are several ways you can limit traffic, including using Azure Firewall, Network Virtual Appliances, or proxies. If you need to limit traffic, make sure you add the proper rules so that Azure Virtual Desktop can work properly.</p>
<h3 id="Manage-Office-Pro-Plus-security"><a href="#Manage-Office-Pro-Plus-security" class="headerlink" title="Manage Office Pro Plus security"></a>Manage Office Pro Plus security</h3><p>In addition to securing your session hosts, it’s important to also secure the applications running inside of them. Office Pro Plus is one of the most common applications deployed in session hosts. To improve the Office deployment security, we recommend you use the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/DeployOffice/overview-of-security-policy-advisor">Security Policy Advisor</a> for Microsoft 365 Apps for enterprise. This tool identifies policies that can you can apply to your deployment for more security. Security Policy Advisor also recommends policies based on their impact to your security and productivity.</p>
<h3 id="Other-security-tips-for-session-hosts"><a href="#Other-security-tips-for-session-hosts" class="headerlink" title="Other security tips for session hosts"></a>Other security tips for session hosts</h3><p>By restricting operating system capabilities, you can strengthen the security of your session hosts. Here are a few things you can do:</p>
<ul>
<li>Control device redirection by redirecting drives, printers, and USB devices to a user’s local device in a remote desktop session. We recommend that you evaluate your security requirements and check if these features ought to be disabled or not.</li>
<li>Restrict Windows Explorer access by hiding local and remote drive mappings. This prevents users from discovering unwanted information about system configuration and users.</li>
<li>Avoid direct RDP access to session hosts in your environment. If you need direct RDP access for administration or troubleshooting, enable <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-usage">just-in-time</a> access to limit the potential attack surface on a session host.</li>
<li>Grant users limited permissions when they access local and remote file systems. You can restrict permissions by making sure your local and remote file systems use access control lists with least privilege. This way, users can only access what they need and can’t change or delete critical resources.</li>
<li>Prevent unwanted software from running on session hosts. You can enable App Locker for additional security on session hosts, ensuring that only the apps you allow can run on the host.</li>
</ul>
<h2 id="Azure-Virtual-Desktop-support-for-Trusted-Launch"><a href="#Azure-Virtual-Desktop-support-for-Trusted-Launch" class="headerlink" title="Azure Virtual Desktop support for Trusted Launch"></a>Azure Virtual Desktop support for Trusted Launch</h2><p>Trusted launch are Gen2 Azure VMs with enhanced security features aimed to protect against “bottom of the stack” threats through attack vectors such as rootkits, boot kits, and kernel-level malware. The following are the enhanced security features of trusted launch, all of which are supported in Azure Virtual Desktop. To learn more about trusted launch, visit <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch">Trusted launch for Azure virtual machines</a>.</p>
<h2 id="Azure-Confidential-Computing-virtual-machines-preview"><a href="#Azure-Confidential-Computing-virtual-machines-preview" class="headerlink" title="Azure Confidential Computing virtual machines (preview)"></a>Azure Confidential Computing virtual machines (preview)</h2><p> Important</p>
<p>Azure Virtual Desktop support for Azure Confidential virtual machines is currently in PREVIEW. See the <a target="_blank" rel="noopener" href="https://azure.microsoft.com/support/legal/preview-supplemental-terms/">Supplemental Terms of Use for Microsoft Azure Previews</a> for legal terms that apply to Azure features that are in beta, preview, or otherwise not yet released into general availability.</p>
<p>Azure Virtual Desktop support for Azure Confidential Computing virtual machines (preview) ensures a user’s virtual desktop is encrypted in memory, protected in use, and backed by hardware root of trust. Deploying confidential VMs with Azure Virtual Desktop gives users access to Microsoft 365 and other applications on session hosts that use hardware-based isolation, which hardens isolation from other virtual machines, the hypervisor, and the host OS. These virtual desktops are powered by the latest Third-generation (Gen 3) Advanced Micro Devices (AMD) EPYC™ processor with Secure Encrypted Virtualization Secure Nested Paging (SEV-SNP) technology. Memory encryption keys are generated and safeguarded by a dedicated secure processor inside the AMD CPU that can’t be read from software. For more information, see the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/confidential-computing/overview">Azure Confidential Computing overview</a>.</p>
<h3 id="Secure-Boot"><a href="#Secure-Boot" class="headerlink" title="Secure Boot"></a>Secure Boot</h3><p>Secure Boot is a mode that platform firmware supports that protects your firmware from malware-based rootkits and boot kits. This mode only allows signed OSes and drivers to start up the machine.</p>
<h3 id="Monitor-boot-integrity-using-Remote-Attestation"><a href="#Monitor-boot-integrity-using-Remote-Attestation" class="headerlink" title="Monitor boot integrity using Remote Attestation"></a>Monitor boot integrity using Remote Attestation</h3><p>Remote attestation is a great way to check the health of your VMs. Remote attestation verifies that Measured Boot records are present, genuine, and originate from the Virtual Trusted Platform Module (vTPM). As a health check, it provides cryptographic certainty that a platform started up correctly.</p>
<h3 id="vTPM"><a href="#vTPM" class="headerlink" title="vTPM"></a>vTPM</h3><p>A vTPM is a virtualized version of a hardware Trusted Platform Module (TPM), with a virtual instance of a TPM per VM. vTPM enables remote attestation by performing integrity measurement of the entire boot chain of the VM (UEFI, OS, system, and drivers).</p>
<p>We recommend enabling vTPM to use remote attestation on your VMs. With vTPM enabled, you can also enable BitLocker functionality with Azure Disk Encryption, which provides full-volume encryption to protect data at rest. Any features using vTPM will result in secrets bound to the specific VM. When users connect to the Azure Virtual Desktop service in a pooled scenario, users can be redirected to any VM in the host pool. Depending on how the feature is designed this may have an impact.</p>
<p> Note</p>
<p>BitLocker should not be used to encrypt the specific disk where you’re storing your FSLogix profile data.</p>
<h3 id="Virtualization-based-Security"><a href="#Virtualization-based-Security" class="headerlink" title="Virtualization-based Security"></a>Virtualization-based Security</h3><p>Virtualization-based Security (VBS) uses the hypervisor to create and isolate a secure region of memory that’s inaccessible to the OS. Hypervisor-Protected Code Integrity (HVCI) and Windows Defender Credential Guard both use VBS to provide increased protection from vulnerabilities.</p>
<h4 id="Hypervisor-Protected-Code-Integrity"><a href="#Hypervisor-Protected-Code-Integrity" class="headerlink" title="Hypervisor-Protected Code Integrity"></a>Hypervisor-Protected Code Integrity</h4><p>HVCI is a powerful system mitigation that uses VBS to protect Windows kernel-mode processes against injection and execution of malicious or unverified code.</p>
<h4 id="Windows-Defender-Credential-Guard"><a href="#Windows-Defender-Credential-Guard" class="headerlink" title="Windows Defender Credential Guard"></a>Windows Defender Credential Guard</h4><p>Windows Defender Credential Guard uses VBS to isolate and protect secrets so that only privileged system software can access them. This prevents unauthorized access to these secrets and credential theft attacks, such as Pass-the-Hash attacks.</p>
<h2 id="Nested-virtualization"><a href="#Nested-virtualization" class="headerlink" title="Nested virtualization"></a>Nested virtualization</h2><p>The following operating systems support running nested virtualization on Azure Virtual Desktop:</p>
<ul>
<li>Windows Server 2016</li>
<li>Windows Server 2019</li>
<li>Windows Server 2022</li>
<li>Windows 10 Enterprise</li>
<li>Windows 10 Enterprise multi-session</li>
<li>Windows 11 Enterprise</li>
<li>Windows 11 Enterprise multi-session</li>
</ul>
<h2 id="Windows-Defender-Application-Control"><a href="#Windows-Defender-Application-Control" class="headerlink" title="Windows Defender Application Control"></a>Windows Defender Application Control</h2><p>The following operating systems support using Windows Defender Application Control with Azure Virtual Desktop:</p>
<ul>
<li>Windows Server 2016</li>
<li>Windows Server 2019</li>
<li>Windows Server 2022</li>
<li>Windows 10 Enterprise</li>
<li>Windows 10 Enterprise multi-session</li>
<li>Windows 11 Enterprise</li>
<li>Windows 11 Enterprise multi-session</li>
</ul>
<p> Note</p>
<p>When using Windows Defender Access Control, we recommend only targeting policies at the device level. Although it’s possible to target policies to individual users, once the policy is applied, it affects all users on the device equally.</p>
<h1 id="Enable-or-disable-Start-VM-on-Connect"><a href="#Enable-or-disable-Start-VM-on-Connect" class="headerlink" title="Enable or disable Start VM on Connect"></a>Enable or disable Start VM on Connect</h1><p>Start VM On Connect lets you reduce costs by enabling end users to turn on their session host virtual machines (VMs) only when they need them. You can them turn off VMs when they’re not needed.</p>
<p>You can configure Start VM on Connect for personal or pooled host pools using the Azure portal or PowerShell. Start VM on Connect is a host pool setting.</p>
<p>For personal host pools, Start VM On Connect will only turn on an existing session host VM that has already been assigned or will be assigned to a user. For pooled host pools, Start VM On Connect will only turn on a session host VM when none are turned on and additional VMs will only be turned on when the first VM reaches the session limit.</p>
<p>The time it takes for a user to connect to a session host VM that is powered off (deallocated) increases because the VM needs time to turn on again, much like turning on a physical computer. The Remote Desktop client has an indicator that lets the user know the VM is being powered on while they’re connecting.</p>
<p> Note</p>
<p>Azure Virtual Desktop (classic) doesn’t support Start VM On Connect.</p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>To use Start VM on Connect, make sure you follow these guidelines:</p>
<ul>
<li>You can only configure Start VM on Connect on existing host pools. You can’t enable it at the same time you create a new host pool.</li>
<li>The following Remote Desktop clients support Start VM on Connect:<ul>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-windows?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">Windows client</a> (version 1.2.2061 or later)</li>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-web?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">Web client</a></li>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-macos?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">macOS client</a> (version 10.6.4 or later)</li>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-ios-ipados?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">iOS and iPadOS client</a> (version 10.2.5 or later)</li>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-android-chrome-os?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">Android and Chrome OS client</a> (version 10.0.10 or later)</li>
<li>The <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-microsoft-store?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">Microsoft Store client</a> (version 10.2.2005.0 or later)</li>
<li>Thin clients listed in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-thin-clients?toc=/azure/virtual-desktop/toc.json&bc=/azure/virtual-desktop/breadcrumb/toc.json">Thin client support</a></li>
</ul>
</li>
<li>If you want to configure Start VM on Connect using PowerShell, you’ll need to have <a target="_blank" rel="noopener" href="https://www.powershellgallery.com/packages/Az.DesktopVirtualization">the Az.DesktopVirtualization PowerShell module</a> (version 2.1.0 or later) installed on the device you use to run the commands.</li>
<li>You must grant Azure Virtual Desktop access to power on session host VMs, check their status, and report diagnostic information. You must have the <code>Microsoft.Authorization/roleAssignments/write</code> permission on your subscriptions in order to assign the role-based access control (RBAC) role for the Azure Virtual Desktop service principal on those subscriptions. This is part of <strong>User Access Administrator</strong> and <strong>Owner</strong> built in roles.</li>
</ul>
<h2 id="Assign-the-Desktop-Virtualization-Power-On-Contributor-role-with-the-Azure-portal"><a href="#Assign-the-Desktop-Virtualization-Power-On-Contributor-role-with-the-Azure-portal" class="headerlink" title="Assign the Desktop Virtualization Power On Contributor role with the Azure portal"></a>Assign the Desktop Virtualization Power On Contributor role with the Azure portal</h2><p>Before you can configure Start VM on Connect, you’ll need to assign the <em>Desktop Virtualization Power On Contributor</em> role-based access control (RBAC) role with your Azure subscription as the assignable scope. Assigning this role at any level lower than your subscription, such as the resource group, host pool, or VM, will prevent Start VM on Connect from working properly. You’ll need to add each Azure subscription as an assignable scope that contains host pools and session host VMs you want to use with Start VM on Connect. This role and assignment will allow Azure Virtual Desktop to power on VMs, check their status, and report diagnostic information in those subscriptions.</p>
<p>To assign the <em>Desktop Virtualization Power On Contributor</em> role with the Azure portal to the Azure Virtual Desktop service principal on the subscription your host pool is deployed to:</p>
<ol>
<li>Open the Azure portal and go to <strong>Subscriptions</strong>. Select a subscription that contains a host pool and session host VMs you want to use with Start VM on Connect.</li>
<li>Select <strong>Access control (IAM)</strong>.</li>
<li>Select the <strong>+ Add</strong> button, then select <strong>Add role assignment</strong> from the drop-down menu.</li>
<li>Select the <strong>Desktop Virtualization Power On Contributor</strong> role and select <strong>Next</strong>.</li>
<li>On the <strong>Members</strong> tab, select <strong>User, group, or service principal</strong>, then select <strong>+Select members</strong>. In the search bar, enter and select either <strong>Azure Virtual Desktop</strong> or <strong>Windows Virtual Desktop</strong>. Which value you have depends on when the <em>Microsoft.DesktopVirtualization</em> resource provider was first registered in your Azure tenant. If you see two entries titled Windows Virtual Desktop, please see the tip below.</li>
<li>Select <strong>Review + assign</strong> to complete the assignment. Repeat this for any other subscriptions that contain host pools and session host VMs you want to use with Start VM on Connect.</li>
</ol>
<p> Tip</p>
<p>The application ID for the service principal is <strong>9cdead84-a844-4324-93f2-b2e6bb768d07</strong>.</p>
<p>If you have an Azure Virtual Desktop (classic) deployment and an Azure Virtual Desktop (Azure Resource Manager) deployment where the <em>Microsoft.DesktopVirtualization</em> resource provider was registered before the display name changed, you will see two apps with the same name of <em>Windows Virtual Desktop</em>. To add the role assignment to the correct service principal, <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/role-based-access-control/role-assignments-powershell">you can use PowerShell</a> which enables you to specify the application ID:</p>
<p>To assign the <em>Desktop Virtualization Power On Contributor</em> role with PowerShell to the Azure Virtual Desktop service principal on the subscription your host pool is deployed to:</p>
<ol>
<li><p>Open <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/cloud-shell/overview">Azure Cloud Shell</a> with PowerShell as the shell type.</p>
</li>
<li><p>Get the object ID for the service principal (which is unique in each Azure tenant) and store it in a variable:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$objId</span> = (<span class="built_in">Get-AzADServicePrincipal</span> <span class="literal">-AppId</span> <span class="string">&quot;9cdead84-a844-4324-93f2-b2e6bb768d07&quot;</span>).Id</span><br></pre></td></tr></table></figure>
</li>
<li><p>Find the name of the subscription you want to add the role assignment to by listing all that are available to you:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-AzSubscription</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Get the subscription ID and store it in a variable, replacing the value for <code>-SubscriptionName</code> with the name of the subscription from the previous step:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$subId</span> = (<span class="built_in">Get-AzSubscription</span> <span class="literal">-SubscriptionName</span> <span class="string">&quot;Microsoft Azure Enterprise&quot;</span>).Id</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the role assignment:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzRoleAssignment</span> <span class="literal">-RoleDefinitionName</span> <span class="string">&quot;Desktop Virtualization Power On Contributor&quot;</span> <span class="literal">-ObjectId</span> <span class="variable">$objId</span> <span class="literal">-Scope</span> /subscriptions/<span class="variable">$subId</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Enable-or-disable-Start-VM-on-Connect-1"><a href="#Enable-or-disable-Start-VM-on-Connect-1" class="headerlink" title="Enable or disable Start VM on Connect"></a>Enable or disable Start VM on Connect</h2><p>Now that you’ve assigned the <em>Desktop Virtualization Power On Contributor</em> role to the service principal on your subscriptions, you can configure Start VM on Connect using the Azure portal or PowerShell.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/start-virtual-machine-connect?tabs=azure-portal#tabpanel_1_azure-portal">Portal</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/start-virtual-machine-connect?tabs=azure-portal#tabpanel_1_azure-powershell">PowerShell</a></li>
</ul>
<p>To configure Start VM on Connect using the Azure portal:</p>
<ol>
<li>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</li>
<li>In the search bar, enter <em>Azure Virtual Desktop</em> and select the matching service entry.</li>
<li>Select <strong>Host pools</strong>, then select the name of the host pool where you want to enable the setting.</li>
<li>Select <strong>Properties</strong>.</li>
<li>In the configuration section, you’ll see <strong>Start VM on connect</strong>. Select <strong>Yes</strong> to enable it, or <strong>No</strong> to disable it.</li>
<li>Select <strong>Save</strong> to apply the settings.</li>
</ol>
<p> Note</p>
<p>In pooled host pools, Start VM on Connect will start a VM every five minutes at most. If other users try to sign in during this five-minute period while there aren’t any available resources, Start VM on Connect won’t start a new VM. Instead, the users trying to sign in will receive an error message that says, “No resources available.”</p>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><p>If you run into any issues with Start VM On Connect, we recommend you use the Azure Virtual Desktop <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/diagnostics-log-analytics">diagnostics feature</a> to check for problems. If you receive an error message, make sure to pay close attention to the message content and make a note of the error name for reference. You can also use <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor">Azure Monitor for Azure Virtual Desktop</a> to get suggestions for how to resolve issues.</p>
<p>If the session host VM doesn’t turn on, you’ll need to check the health of the VM you tried to turn on as a first step.</p>
<p>For other questions, check out the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/start-virtual-machine-connect-faq">Start VM on Connect FAQ</a>.</p>
<h1 id="Configure-the-personal-desktop-host-pool-assignment-type"><a href="#Configure-the-personal-desktop-host-pool-assignment-type" class="headerlink" title="Configure the personal desktop host pool assignment type"></a>Configure the personal desktop host pool assignment type</h1><p> Important</p>
<p>This content applies to Azure Virtual Desktop with Azure Resource Manager Azure Virtual Desktop objects. If you’re using Azure Virtual Desktop (classic) without Azure Resource Manager objects, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/virtual-desktop-fall-2019/configure-host-pool-personal-desktop-assignment-type-2019">this article</a>.</p>
<p>You can configure the assignment type of your personal desktop host pool to adjust your Azure Virtual Desktop environment to better suit your needs. In this topic, we’ll show you how to configure automatic or direct assignment for your users.</p>
<p> Note</p>
<p>The instructions in this article only apply to personal desktop host pools, not pooled host pools, since users in pooled host pools aren’t assigned to specific session hosts.</p>
<h2 id="Prerequisites-1"><a href="#Prerequisites-1" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>This article assumes you’ve already downloaded and installed the Azure Virtual Desktop PowerShell module. If you haven’t, follow the instructions in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/powershell-module">Set up the PowerShell module</a>.</p>
<h2 id="Personal-host-pools-overview"><a href="#Personal-host-pools-overview" class="headerlink" title="Personal host pools overview"></a>Personal host pools overview</h2><p>A personal host pool is a type of host pool that has personal desktops. Personal desktops have one-to-one mapping, which means a single user can only be assigned to a single personal desktop. Every time the user signs in, their user session is directed to their assigned personal desktop session host. This host pool type is ideal for customers with resource-intensive workloads because user experience and session performance will improve if there’s only one session on the session host. Another benefit of this host pool type is that user activities, files, and settings persist on the virtual machine operating system (VM OS) disk after the user signs out.</p>
<p>Users must be assigned to a personal desktop to start their session. There are two types of assignments in a personal host pool: automatic assignment and direct assignment.</p>
<h2 id="Configure-automatic-assignment"><a href="#Configure-automatic-assignment" class="headerlink" title="Configure automatic assignment"></a>Configure automatic assignment</h2><p>Automatic assignment is the default assignment type for new personal desktop host pools created in your Azure Virtual Desktop environment. Automatically assigning users doesn’t require a specific session host.</p>
<p>To automatically assign users, first assign them to the personal desktop host pool so that they can see the desktop in their feed. When an assigned user launches the desktop in their feed, their user session will be load-balanced to an available session host if they haven’t already connected to the host pool.</p>
<p>To configure a host pool to automatically assign users to VMs, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Update-AzWvdHostPool</span> <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-Name</span> &lt;hostpoolname&gt; <span class="literal">-PersonalDesktopAssignmentType</span> Automatic</span><br></pre></td></tr></table></figure>

<p>To assign a user to the personal desktop host pool, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzRoleAssignment</span> <span class="literal">-SignInName</span> &lt;userupn&gt; <span class="literal">-RoleDefinitionName</span> <span class="string">&quot;Desktop Virtualization User&quot;</span> <span class="literal">-ResourceName</span> &lt;appgroupname&gt; <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-ResourceType</span> <span class="string">&#x27;Microsoft.DesktopVirtualization/applicationGroups&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Configure-direct-assignment"><a href="#Configure-direct-assignment" class="headerlink" title="Configure direct assignment"></a>Configure direct assignment</h2><p>Unlike automatic assignment, when you use direct assignment, you must assign the user to both the personal desktop host pool and a specific session host before they can connect to their personal desktop. If the user is only assigned to a host pool without a session host assignment, they won’t be able to access resources and will see an error message that says, “No resources available.”</p>
<p>To configure a host pool to require direct assignment of users to session hosts, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Update-AzWvdHostPool</span> <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-Name</span> &lt;hostpoolname&gt; <span class="literal">-PersonalDesktopAssignmentType</span> Direct</span><br></pre></td></tr></table></figure>

<p>To assign a user to the personal desktop host pool, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzRoleAssignment</span> <span class="literal">-SignInName</span> &lt;userupn&gt; <span class="literal">-RoleDefinitionName</span> <span class="string">&quot;Desktop Virtualization User&quot;</span> <span class="literal">-ResourceName</span> &lt;appgroupname&gt; <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-ResourceType</span> <span class="string">&#x27;Microsoft.DesktopVirtualization/applicationGroups&#x27;</span></span><br></pre></td></tr></table></figure>

<p>To assign a user to a specific session host, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Update-AzWvdSessionHost</span> <span class="literal">-HostPoolName</span> &lt;hostpoolname&gt; <span class="literal">-Name</span> &lt;sessionhostname&gt; <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-AssignedUser</span> &lt;userupn&gt;</span><br></pre></td></tr></table></figure>

<p>To directly assign a user to a session host in the Azure portal:</p>
<ol>
<li>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</li>
<li>Enter <strong>Azure Virtual Desktop</strong> into the search bar.</li>
<li>Under <strong>Services</strong>, select <strong>Azure Virtual Desktop</strong>.</li>
<li>At the Azure Virtual Desktop page, go the menu on the left side of the window and select <strong>Host pools</strong>.</li>
<li>Select the host pool you want to assign users to.</li>
<li>Next, go to the menu on the left side of the window and select <strong>Application groups</strong>.</li>
<li>Select the name of the app group you want to assign users to, then select <strong>Assignments</strong> in the menu on the left side of the window.</li>
<li>Select <strong>+ Add</strong>, then select the users or user groups you want to assign to this app group.</li>
<li>Select <strong>Assign VM</strong> in the Information bar to assign a session host to a user.</li>
<li>Select the session host you want to assign to the user, then select <strong>Assign</strong>. You can also select <strong>Assignment</strong> &gt; <strong>Assign user</strong>.</li>
<li>Select the user you want to assign the session host to from the list of available users.</li>
<li>When you’re done, select <strong>Select</strong>.</li>
</ol>
<h2 id="How-to-unassign-a-personal-desktop"><a href="#How-to-unassign-a-personal-desktop" class="headerlink" title="How to unassign a personal desktop"></a>How to unassign a personal desktop</h2><p>To unassign a personal desktop, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Update-AzWvdSessionHost</span> <span class="literal">-HostPoolName</span> &lt;hostpoolname&gt; <span class="literal">-Name</span> &lt;sessionhostname&gt; <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-AssignedUser</span> <span class="string">&quot;&quot;</span> <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>

<p> Important</p>
<ul>
<li>Azure Virtual Desktop will not delete any VHD or profile data for unassigned personal desktops.</li>
<li>You must include the <em>-Force</em> parameter when running the PowerShell cmdlet to unassign a personal desktop. If you don’t include the <em>-Force</em> parameter, you’ll receive an error message.</li>
<li>There must be no existing user sessions on the session host when you unassign the user from the personal desktop. If there’s an existing user session on the session host while you’re unassigning it, you won’t be able to unassign the personal desktop successfully.</li>
<li>If the session host has no user assignment, nothing will happen when you run this cmdlet.</li>
</ul>
<p>To unassign a personal desktop in the Azure portal:</p>
<ol>
<li><p>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li><p>Enter <strong>Azure Virtual Desktop</strong> into the search bar.</p>
</li>
<li><p>Under <strong>Services</strong>, select <strong>Azure Virtual Desktop</strong>.</p>
</li>
<li><p>At the Azure Virtual Desktop page, go the menu on the left side of the window and select <strong>Host pools</strong>.</p>
</li>
<li><p>Select the host pool you want to modify user assignment for.</p>
</li>
<li><p>Next, go to the menu on the left side of the window and select <strong>Session hosts</strong>.</p>
</li>
<li><p>Select the checkbox next to the session host you want to unassign a user from, select the ellipses at the end of the row, and then select <strong>Unassign user</strong>. You can also select <strong>Assignment</strong> &gt; <strong>Unassign user</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/unassign.png" alt="A screenshot of the unassign user menu option from the ellipses menu for unassigning a personal desktop."></p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/unassign-2.png" alt="A screenshot of the unassign user menu option from the assignment menu for unassigning a personal desktop."></p>
</li>
<li><p>Select <strong>Unassign</strong> when prompted with the warning.</p>
</li>
</ol>
<h2 id="How-to-reassign-a-personal-desktop"><a href="#How-to-reassign-a-personal-desktop" class="headerlink" title="How to reassign a personal desktop"></a>How to reassign a personal desktop</h2><p>To reassign a personal desktop, run the following PowerShell cmdlet:</p>
<p>PowerShellCopy</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Update-AzWvdSessionHost</span> <span class="literal">-HostPoolName</span> &lt;hostpoolname&gt; <span class="literal">-Name</span> &lt;sessionhostname&gt; <span class="literal">-ResourceGroupName</span> &lt;resourcegroupname&gt; <span class="literal">-AssignedUser</span> &lt;userupn&gt; <span class="literal">-Force</span></span><br></pre></td></tr></table></figure>

<p> Important</p>
<ul>
<li>Azure Virtual Desktop will not delete any VHD or profile data for reassigned personal desktops.</li>
<li>You must include the <em>-Force</em> parameter when running the PowerShell cmdlet to reassign a personal desktop. If you don’t include the <em>-Force</em> parameter, you’ll receive an error message.</li>
<li>There must be no existing user sessions on the session host when you reassign a personal desktop. If there’s an existing user session on the session host while you’re reassigning it, you won’t be able to reassign the personal desktop successfully.</li>
<li>If the user principal name (UPN) you enter for the <em>-AssignedUser</em> parameter is the same as the UPN currently assigned to the personal desktop, the cmdlet won’t do anything.</li>
<li>If the session host currently has no user assignment, the personal desktop will be assigned to the provided UPN.</li>
</ul>
<p>To reassign a personal desktop in the Azure portal:</p>
<ol>
<li><p>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</p>
</li>
<li><p>Enter <strong>Azure Virtual Desktop</strong> into the search bar.</p>
</li>
<li><p>Under <strong>Services</strong>, select <strong>Azure Virtual Desktop</strong>.</p>
</li>
<li><p>At the Azure Virtual Desktop page, go the menu on the left side of the window and select <strong>Host pools</strong>.</p>
</li>
<li><p>Select the host pool you want to modify user assignment for.</p>
</li>
<li><p>Next, go to the menu on the left side of the window and select <strong>Session hosts</strong>.</p>
</li>
<li><p>Select the checkbox next to the session host you want to reassign to a different user, select the ellipses at the end of the row, and then select <strong>Assign to a different user</strong>. You can also select <strong>Assignment</strong> &gt; <strong>Assign to a different user</strong>.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/reassign-doc.png" alt="A screenshot of the assign to a different user menu option from the ellipses menu for reassigning a personal desktop."></p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/reassign.png" alt="A screenshot of the assign to a different user menu option from the assignment menu for reassigning a personal desktop."></p>
</li>
<li><p>Select the user you want to assign the session host to from the list of available users.</p>
</li>
<li><p>When you’re done, select <strong>Select</strong>.</p>
</li>
</ol>
<h1 id="Use-Log-Analytics-for-the-diagnostics-feature"><a href="#Use-Log-Analytics-for-the-diagnostics-feature" class="headerlink" title="Use Log Analytics for the diagnostics feature"></a>Use Log Analytics for the diagnostics feature</h1><p> Important</p>
<p>This content applies to Azure Virtual Desktop with Azure Resource Manager Azure Virtual Desktop objects. If you’re using Azure Virtual Desktop (classic) without Azure Resource Manager objects, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/virtual-desktop-fall-2019/diagnostics-log-analytics-2019">this article</a>.</p>
<p>Azure Virtual Desktop uses <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/overview">Azure Monitor</a> for monitoring and alerts like many other Azure services. This lets admins identify issues through a single interface. The service creates activity logs for both user and administrative actions. Each activity log falls under the following categories:</p>
<ul>
<li>Management Activities:<ul>
<li>Track whether attempts to change Azure Virtual Desktop objects using APIs or PowerShell are successful. For example, can someone successfully create a host pool using PowerShell?</li>
</ul>
</li>
<li>Feed:<ul>
<li>Can users successfully subscribe to workspaces?</li>
<li>Do users see all resources published in the Remote Desktop client?</li>
</ul>
</li>
<li>Connections:<ul>
<li>When users initiate and complete connections to the service.</li>
</ul>
</li>
<li>Host registration:<ul>
<li>Was the session host successfully registered with the service upon connecting?</li>
</ul>
</li>
<li>Errors:<ul>
<li>Are users encountering any issues with specific activities? This feature can generate a table that tracks activity data for you as long as the information is joined with the activities.</li>
</ul>
</li>
<li>Checkpoints:<ul>
<li>Specific steps in the lifetime of an activity that were reached. For example, during a session, a user was load balanced to a particular host, then the user was signed on during a connection, and so on.</li>
</ul>
</li>
<li>Agent Health Status:<ul>
<li>Monitor the health and status of the Azure Virtual Desktop agent installed on each session host. For example, verify that the agents are up to date, or whether the agent is in a healthy state and ready to accept new user sessions.</li>
</ul>
</li>
<li>Connection Network Data:<ul>
<li>Track the average network data for user sessions to monitor for details including the estimated round trip time and available bandwidth throughout their connection.</li>
</ul>
</li>
</ul>
<p>Connections that don’t reach Azure Virtual Desktop won’t show up in diagnostics results because the diagnostics role service itself is part of Azure Virtual Desktop. Azure Virtual Desktop connection issues can happen when the user is experiencing network connectivity issues.</p>
<p>Azure Monitor lets you analyze Azure Virtual Desktop data and review virtual machine (VM) performance counters, all within the same tool. This article will tell you more about how to enable diagnostics for your Azure Virtual Desktop environment.</p>
<p> Note</p>
<p>To learn how to monitor your VMs in Azure, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/vm/monitor-vm-azure">Monitoring Azure virtual machines with Azure Monitor</a>. Also, make sure to review the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor-glossary">Azure Monitor glossary</a> for a better understanding of your user experience on the session host.</p>
<h2 id="Before-you-get-started"><a href="#Before-you-get-started" class="headerlink" title="Before you get started"></a>Before you get started</h2><p>Before you can use Log Analytics, you’ll need to create a workspace. To do that, follow the instructions in one of the following two articles:</p>
<ul>
<li>If you prefer using Azure portal, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/quick-create-workspace">Create a Log Analytics workspace in Azure portal</a>.</li>
<li>If you prefer PowerShell, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/powershell-workspace-configuration">Create a Log Analytics workspace with PowerShell</a>.</li>
</ul>
<p>After you’ve created your workspace, follow the instructions in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/agent-windows#workspace-id-and-key">Connect Windows computers to Azure Monitor</a> to get the following information:</p>
<ul>
<li>The workspace ID</li>
<li>The primary key of your workspace</li>
</ul>
<p>You’ll need this information later in the setup process.</p>
<p>Make sure to review permission management for Azure Monitor to enable data access for those who monitor and maintain your Azure Virtual Desktop environment. For more information, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/roles-permissions-security">Get started with roles, permissions, and security with Azure Monitor</a>.</p>
<h2 id="Push-diagnostics-data-to-your-workspace"><a href="#Push-diagnostics-data-to-your-workspace" class="headerlink" title="Push diagnostics data to your workspace"></a>Push diagnostics data to your workspace</h2><p>You can push diagnostics data from your Azure Virtual Desktop objects into the Log Analytics for your workspace. You can set up this feature right away when you first create your objects.</p>
<p>To set up Log Analytics for a new object:</p>
<ol>
<li><p>Sign in to the Azure portal and go to <strong>Azure Virtual Desktop</strong>.</p>
</li>
<li><p>Navigate to the object (such as a host pool, app group, or workspace) that you want to capture logs and events for.</p>
</li>
<li><p>Select <strong>Diagnostic settings</strong> in the menu on the left side of the screen.</p>
</li>
<li><p>Select <strong>Add diagnostic setting</strong> in the menu that appears on the right side of the screen.</p>
<p>The options shown in the Diagnostic Settings page will vary depending on what kind of object you’re editing.</p>
<p>For example, when you’re enabling diagnostics for an app group, you’ll see options to configure checkpoints, errors, and management. For workspaces, these categories configure a feed to track when users subscribe to the list of apps. To learn more about diagnostic settings see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/diagnostic-settings">Create diagnostic setting to collect resource logs and metrics in Azure</a>.</p>
<p> Important</p>
<p>Remember to enable diagnostics for each Azure Resource Manager object that you want to monitor. Data will be available for activities after diagnostics has been enabled. It might take a few hours after first set-up.</p>
</li>
<li><p>Enter a name for your settings configuration, then select <strong>Send to Log Analytics</strong>. The name you use shouldn’t have spaces and should conform to <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules">Azure naming conventions</a>. As part of the logs, you can select all the options that you want added to your Log Analytics, such as Checkpoint, Error, Management, and so on.</p>
</li>
<li><p>Select <strong>Save</strong>.</p>
</li>
</ol>
<p> Note</p>
<p>Log Analytics gives you the option to stream data to <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/event-hubs/event-hubs-about">Event Hubs</a> or archive it in a storage account. To learn more about this feature, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/stream-monitoring-data-event-hubs">Stream Azure monitoring data to an event hub</a> and <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/resource-logs#send-to-azure-storage">Archive Azure resource logs to storage account</a>.</p>
<h2 id="How-to-access-Log-Analytics"><a href="#How-to-access-Log-Analytics" class="headerlink" title="How to access Log Analytics"></a>How to access Log Analytics</h2><p>You can access Log Analytics workspaces on the Azure portal or Azure Monitor.</p>
<h3 id="Access-Log-Analytics-on-a-Log-Analytics-workspace"><a href="#Access-Log-Analytics-on-a-Log-Analytics-workspace" class="headerlink" title="Access Log Analytics on a Log Analytics workspace"></a>Access Log Analytics on a Log Analytics workspace</h3><ol>
<li>Sign in to the Azure portal.</li>
<li>Search for <strong>Log Analytics workspace</strong>.</li>
<li>Under Services, select <strong>Log Analytics workspaces</strong>.</li>
<li>From the list, select the workspace you configured for your Azure Virtual Desktop object.</li>
<li>Once in your workspace, select <strong>Logs</strong>. You can filter out your menu list with the <strong>Search</strong> function.</li>
</ol>
<h3 id="Access-Log-Analytics-on-Azure-Monitor"><a href="#Access-Log-Analytics-on-Azure-Monitor" class="headerlink" title="Access Log Analytics on Azure Monitor"></a>Access Log Analytics on Azure Monitor</h3><ol>
<li>Sign into the Azure portal</li>
<li>Search for and select <strong>Monitor</strong>.</li>
<li>Select <strong>Logs</strong>.</li>
<li>Follow the instructions in the logging page to set the scope of your query.</li>
<li>You are ready to query diagnostics. All diagnostics tables have a “WVD” prefix.</li>
</ol>
<p> Note</p>
<p>For more detailed information about the tables stored in Azure Monitor Logs, see the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/tables-category#azure-virtual-desktop">Azure Monitor data reference</a>. All tables related to Azure Virtual Desktop are prefixed with “WVD.”</p>
<h2 id="Cadence-for-sending-diagnostic-events"><a href="#Cadence-for-sending-diagnostic-events" class="headerlink" title="Cadence for sending diagnostic events"></a>Cadence for sending diagnostic events</h2><p>Diagnostic events are sent to Log Analytics when completed.</p>
<p>Log Analytics only reports in these intermediate states for connection activities:</p>
<ul>
<li>Started: when a user selects and connects to an app or desktop in the Remote Desktop client.</li>
<li>Connected: when the user successfully connects to the VM where the app or desktop is hosted.</li>
<li>Completed: when the user or server disconnects the session the activity took place in.</li>
</ul>
<h2 id="Example-queries"><a href="#Example-queries" class="headerlink" title="Example queries"></a>Example queries</h2><p>Access example queries through the Azure Monitor Log Analytics UI:</p>
<ol>
<li>Go to your Log Analytics workspace, and then select <strong>Logs</strong>. The example query UI is shown automatically.</li>
<li>Change the filter to <strong>Category</strong>.</li>
<li>Select <strong>Azure Virtual Desktop</strong> to review available queries.</li>
<li>Select <strong>Run</strong> to run the selected query.</li>
</ol>
<p>Learn more about the sample query interface in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/queries">Saved queries in Azure Monitor Log Analytics</a>.</p>
<p>The following query list lets you review connection information or issues for a single user. You can run these queries in the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-tutorial#write-a-query">Log Analytics query editor</a>. For each query, replace <code>userupn</code> with the UPN of the user you want to look up.</p>
<p>To find all connections for a single user:</p>
<p>KustoCopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WVDConnections</span><br><span class="line">|where UserName == &quot;userupn&quot;</span><br><span class="line">|take 100</span><br><span class="line">|sort by TimeGenerated asc, CorrelationId</span><br></pre></td></tr></table></figure>

<p>To find the number of times a user connected per day:</p>
<p>KustoCopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WVDConnections</span><br><span class="line">|where UserName == &quot;userupn&quot;</span><br><span class="line">|take 100</span><br><span class="line">|sort by TimeGenerated asc, CorrelationId</span><br><span class="line">|summarize dcount(CorrelationId) by bin(TimeGenerated, 1d)</span><br></pre></td></tr></table></figure>

<p>To find session duration by user:</p>
<p>KustoCopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let Events = WVDConnections | where UserName == &quot;userupn&quot; ;</span><br><span class="line">Events</span><br><span class="line">| where State == &quot;Connected&quot;</span><br><span class="line">| project CorrelationId , UserName, ResourceAlias , StartTime=TimeGenerated</span><br><span class="line">| join (Events</span><br><span class="line">| where State == &quot;Completed&quot;</span><br><span class="line">| project EndTime=TimeGenerated, CorrelationId)</span><br><span class="line">on CorrelationId</span><br><span class="line">| project Duration = EndTime - StartTime, ResourceAlias</span><br><span class="line">| sort by Duration asc</span><br></pre></td></tr></table></figure>

<p>To find errors for a specific user:</p>
<p>KustoCopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WVDErrors</span><br><span class="line">| where UserName == &quot;userupn&quot;</span><br><span class="line">|take 100</span><br></pre></td></tr></table></figure>

<p>To find out whether a specific error occurred for other users:</p>
<p>KustoCopy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WVDErrors</span><br><span class="line">| where CodeSymbolic ==&quot;ErrorSymbolicCode&quot;</span><br><span class="line">| summarize count(UserName) by CodeSymbolic</span><br></pre></td></tr></table></figure>

<p> Note</p>
<ul>
<li>When a user launches a full desktop session, their app usage in the session isn’t tracked as checkpoints in the <code>WVDCheckpoints</code> table.</li>
<li>The <code>ResourcesAlias</code> column in the <code>WVDConnections</code> table shows whether a user has connected to a full desktop or a published app. The column only shows the first app they open during the connection. Any published apps the user opens are tracked in <code>WVDCheckpoints</code>.</li>
<li>The <code>WVDErrors</code> table shows you management errors, host registration issues, and other issues that happen while the user subscribes to a list of apps or desktops.</li>
<li>The <code>WVDErrors</code> table also helps you to identify issues that can be resolved by admin tasks. The value on <code>ServiceError</code> should always equal <code>false</code> for these types of issues. If <code>ServiceError</code> equals <code>true</code>, you’ll need to escalate the issue to Microsoft. Ensure you provide the <em>CorrelationID</em> for errors you escalate.</li>
<li>When debugging connectivity issues, in some cases client information might be missing even if the connection events completes. This applies to the <code>WVDConnections</code> and <code>WVDCheckpoints</code> tables.</li>
</ul>
<h1 id="Use-Azure-Monitor-for-Azure-Virtual-Desktop-to-monitor-your-deployment"><a href="#Use-Azure-Monitor-for-Azure-Virtual-Desktop-to-monitor-your-deployment" class="headerlink" title="Use Azure Monitor for Azure Virtual Desktop to monitor your deployment"></a>Use Azure Monitor for Azure Virtual Desktop to monitor your deployment</h1><p>Azure Monitor for Azure Virtual Desktop is a dashboard built on Azure Monitor Workbooks that helps IT professionals understand their Azure Virtual Desktop environments. This topic will walk you through how to set up Azure Monitor for Azure Virtual Desktop to monitor your Azure Virtual Desktop environments.</p>
<h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><p>Before you start using Azure Monitor for Azure Virtual Desktop, you’ll need to set up the following things:</p>
<ul>
<li>All Azure Virtual Desktop environments you monitor must be based on the latest release of Azure Virtual Desktop that’s compatible with Azure Resource Manager.</li>
<li>At least one configured Log Analytics Workspace. Use a designated Log Analytics workspace for your Azure Virtual Desktop session hosts to ensure that performance counters and events are only collected from session hosts in your Azure Virtual Desktop deployment.</li>
<li>Enable data collection for the following things in your Log Analytics workspace:<ul>
<li>Diagnostics from your Azure Virtual Desktop environment</li>
<li>Recommended performance counters from your Azure Virtual Desktop session hosts</li>
<li>Recommended Windows Event Logs from your Azure Virtual Desktop session hosts</li>
</ul>
</li>
</ul>
<p>The data setup process described in this article is the only one you’ll need to monitor Azure Virtual Desktop. You can disable all other items sending data to your Log Analytics workspace to save costs.</p>
<p>Anyone monitoring Azure Monitor for Azure Virtual Desktop for your environment will also need the following read-access permissions:</p>
<ul>
<li>Read-access to the Azure resource groups that hold your Azure Virtual Desktop resources.</li>
<li>Read-access to the subscription’s resource groups that hold your Azure Virtual Desktop session hosts.</li>
<li>Read access to the Log Analytics workspace. In the case that multiple Log Analytics workspaces are used, read access should be granted to each to allow viewing data.</li>
</ul>
<p> Note</p>
<p>Read access only lets admins view data. They’ll need different permissions to manage resources in the Azure Virtual Desktop portal.</p>
<h2 id="Open-Azure-Monitor-for-Azure-Virtual-Desktop"><a href="#Open-Azure-Monitor-for-Azure-Virtual-Desktop" class="headerlink" title="Open Azure Monitor for Azure Virtual Desktop"></a>Open Azure Monitor for Azure Virtual Desktop</h2><p>You can open Azure Monitor for Azure Virtual Desktop with one of the following methods:</p>
<ul>
<li>Go to <a target="_blank" rel="noopener" href="https://aka.ms/avdi">aka.ms&#x2F;avdi</a>.</li>
<li>Search for and select <strong>Azure Virtual Desktop</strong> from the Azure portal, then select <strong>Insights</strong>.</li>
<li>Search for and select <strong>Azure Monitor</strong> from the Azure portal. Select <strong>Insights Hub</strong> under <strong>Insights</strong>, then select <strong>Azure Virtual Desktop</strong>. Once you have the page open, enter the <strong>Subscription</strong>, <strong>Resource group</strong>, <strong>Host pool</strong>, and <strong>Time range</strong> of the environment you want to monitor.</li>
</ul>
<p> Note</p>
<p>Azure Virtual Desktop currently only supports monitoring one subscription, resource group, and host pool at a time. If you can’t find the environment you want to monitor, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/troubleshoot-azure-monitor">our troubleshooting documentation</a> for known feature requests and issues.</p>
<h2 id="Log-Analytics-settings"><a href="#Log-Analytics-settings" class="headerlink" title="Log Analytics settings"></a>Log Analytics settings</h2><p>To start using Azure Monitor for Azure Virtual Desktop, you’ll need at least one Log Analytics workspace. Use a designated Log Analytics workspace for your Azure Virtual Desktop session hosts to ensure that performance counters and events are only collected form session hosts in your Azure Virtual Desktop deployment. If you already have a workspace set up, skip ahead to <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor#set-up-using-the-configuration-workbook">Set up using the configuration workbook</a>. To set one up, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/quick-create-workspace">Create a Log Analytics workspace in the Azure portal</a>.</p>
<p> Note</p>
<p>Standard data storage charges for Log Analytics will apply. To start, we recommend you choose the pay-as-you-go model and adjust as you scale your deployment and take in more data. To learn more, see <a target="_blank" rel="noopener" href="https://azure.microsoft.com/pricing/details/monitor/">Azure Monitor pricing</a>.</p>
<h2 id="Set-up-using-the-configuration-workbook"><a href="#Set-up-using-the-configuration-workbook" class="headerlink" title="Set up using the configuration workbook"></a>Set up using the configuration workbook</h2><p>If it’s your first time opening Azure Monitor for Azure Virtual Desktop, you’ll need set up Azure Monitor for your Azure Virtual Desktop environment. To configure your resources:</p>
<ol>
<li>Open Azure Monitor for Azure Virtual Desktop in the Azure portal at <a target="_blank" rel="noopener" href="https://aka.ms/avdi">aka.ms&#x2F;avdi</a>, then select <strong>configuration workbook</strong>.</li>
<li>Select an environment to configure under <strong>Subscription</strong>, <strong>Resource Group</strong>, and <strong>Host Pool</strong>.</li>
</ol>
<p>The configuration workbook sets up your monitoring environment and lets you check the configuration after you’ve finished the setup process. It’s important to check your configuration if items in the dashboard aren’t displaying correctly, or when the product group publishes updates that require new settings.</p>
<h3 id="Resource-diagnostic-settings"><a href="#Resource-diagnostic-settings" class="headerlink" title="Resource diagnostic settings"></a>Resource diagnostic settings</h3><p>To collect information on your Azure Virtual Desktop infrastructure, you’ll need to enable several diagnostic settings on your Azure Virtual Desktop host pools and workspaces (this is your Azure Virtual Desktop workspace, not your Log Analytics workspace). To learn more about host pools, workspaces, and other Azure Virtual Desktop resource objects, see our <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/environment-setup">environment guide</a>.</p>
<p>You can learn more about Azure Virtual Desktop diagnostics and the supported diagnostic tables at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/diagnostics-log-analytics">Send Azure Virtual Desktop diagnostics to Log Analytics</a>.</p>
<p>To set your resource diagnostic settings in the configuration workbook:</p>
<ol>
<li>Select the <strong>Resource diagnostic settings</strong> tab in the configuration workbook.</li>
<li>Select <strong>Log Analytics workspace</strong> to send Azure Virtual Desktop diagnostics.</li>
</ol>
<h4 id="Host-pool-diagnostic-settings"><a href="#Host-pool-diagnostic-settings" class="headerlink" title="Host pool diagnostic settings"></a>Host pool diagnostic settings</h4><p>To set up host pool diagnostics using the resource diagnostic settings section in the configuration workbook:</p>
<ol>
<li><p>Under <strong>Host pool</strong>, check to see whether Azure Virtual Desktop diagnostics are enabled. If they aren’t, an error message will appear that says “No existing diagnostic configuration was found for the selected host pool.” You’ll need to enable the following supported diagnostic tables:</p>
<ul>
<li>Checkpoint</li>
<li>Error</li>
<li>Management</li>
<li>Connection</li>
<li>HostRegistration</li>
<li>AgentHealthStatus</li>
</ul>
<p> Note</p>
<p>If you don’t see the error message, you don’t need to do steps 2 through 4.</p>
</li>
<li><p>Select <strong>Configure host pool</strong>.</p>
</li>
<li><p>Select <strong>Deploy</strong>.</p>
</li>
<li><p>Refresh the configuration workbook.</p>
</li>
</ol>
<h4 id="Workspace-diagnostic-settings"><a href="#Workspace-diagnostic-settings" class="headerlink" title="Workspace diagnostic settings"></a>Workspace diagnostic settings</h4><p>To set up workspace diagnostics using the resource diagnostic settings section in the configuration workbook:</p>
<ol>
<li><p>Under <strong>Workspace</strong>, check to see whether Azure Virtual Desktop diagnostics are enabled for the Azure Virtual Desktop workspace. If they aren’t, an error message will appear that says “No existing diagnostic configuration was found for the selected workspace.” You’ll need to enable the following supported diagnostics tables:</p>
<ul>
<li>Checkpoint</li>
<li>Error</li>
<li>Management</li>
<li>Feed</li>
</ul>
<p> Note</p>
<p>If you don’t see the error message, you don’t need to do steps 2-4.</p>
</li>
<li><p>Select <strong>Configure workspace</strong>.</p>
</li>
<li><p>Select <strong>Deploy</strong>.</p>
</li>
<li><p>Refresh the configuration workbook.</p>
</li>
</ol>
<h3 id="Session-host-data-settings"><a href="#Session-host-data-settings" class="headerlink" title="Session host data settings"></a>Session host data settings</h3><p>To collect information on your Azure Virtual Desktop session hosts, you’ll need to install the Log Analytics agent on all session hosts in the host pool, make sure the session hosts are sending to a Log Analytics workspace, and configure your Log Analytics agent settings to collect performance data and Windows Event Logs.</p>
<p>The Log Analytics workspace you send session host data to doesn’t have to be the same one you send diagnostic data to. If you have Azure session hosts outside of your Azure Virtual Desktop environment, we recommend having a designated Log Analytics workspace for the Azure Virtual Desktop session hosts.</p>
<p>To set the Log Analytics workspace where you want to collect session host data:</p>
<ol>
<li>Select the <strong>Session host data settings</strong> tab in the configuration workbook.</li>
<li>Select the <strong>Log Analytics workspace</strong> you want to send session host data to.</li>
</ol>
<h4 id="Session-hosts"><a href="#Session-hosts" class="headerlink" title="Session hosts"></a>Session hosts</h4><p>You’ll need to install the Log Analytics agent on all session hosts in the host pool and send data from those hosts to your selected Log Analytics workspace. If Log Analytics isn’t configured for all the session hosts in the host pool, you’ll see a <strong>Session hosts</strong> section at the top of <strong>Session host data settings</strong> with the message “Some hosts in the host pool are not sending data to the selected Log Analytics workspace.”</p>
<p> Note</p>
<p>If you don’t see the <strong>Session hosts</strong> section or error message, all session hosts are set up correctly. Skip ahead to set up instructions for <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor#workspace-performance-counters">Workspace performance counters</a>. Currently automated deployment is limited to 1000 session hosts or fewer.</p>
<p>To set up your remaining session hosts using the configuration workbook:</p>
<ol>
<li>Select <strong>Add hosts to workspace</strong>.</li>
<li>Refresh the configuration workbook.</li>
</ol>
<p> Note</p>
<p>For larger host pools (&gt; 1000 session hosts), or if there are deployment issues, it is recommended to install the Log Analytics agent at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/extensions/oms-windows#extension-schema">time of session host creation</a> through the use of an ARM template.</p>
<h4 id="Workspace-performance-counters"><a href="#Workspace-performance-counters" class="headerlink" title="Workspace performance counters"></a>Workspace performance counters</h4><p>You’ll need to enable specific performance counters to collect performance information from your session hosts and send it to the Log Analytics workspace.</p>
<p>If you already have performance counters enabled and want to remove them, follow the instructions in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-sources-performance-counters">Configuring performance counters</a>. You can add and remove performance counters in the same location.</p>
<p>To set up performance counters using the configuration workbook:</p>
<ol>
<li>Under <strong>Workspace performance counters</strong> in the configuration workbook, check <strong>Configured counters</strong> to see the counters you’ve already enabled to send to the Log Analytics workspace. Check <strong>Missing counters</strong> to make sure you’ve enabled all required counters.</li>
<li>If you have missing counters, select <strong>Configure performance counters</strong>.</li>
<li>Select <strong>Apply Config</strong>.</li>
<li>Refresh the configuration workbook.</li>
<li>Make sure all the required counters are enabled by checking the <strong>Missing counters</strong> list.</li>
</ol>
<h4 id="Configure-Windows-Event-Logs"><a href="#Configure-Windows-Event-Logs" class="headerlink" title="Configure Windows Event Logs"></a>Configure Windows Event Logs</h4><p>You’ll also need to enable specific Windows Event Logs to collect errors, warnings, and information from the session hosts and send them to the Log Analytics workspace.</p>
<p>If you’ve already enabled Windows Event Logs and want to remove them, follow the instructions in <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/agents/data-sources-windows-events#configure-windows-event-logs">Configuring Windows Event Logs</a>. You can add and remove Windows Event Logs in the same location.</p>
<p>To set up Windows Event Logs using the configuration workbook:</p>
<ol>
<li>Under <strong>Windows Event Logs configuration</strong>, check <strong>Configured Event Logs</strong> to see the Event Logs you’ve already enabled to send to the Log Analytics workspace. Check <strong>Missing Event Logs</strong> to make sure you’ve enabled all Windows Event Logs.</li>
<li>If you have missing Windows Event Logs, select <strong>Configure Events</strong>.</li>
<li>Select <strong>Deploy</strong>.</li>
<li>Refresh the configuration workbook.</li>
<li>Make sure all the required Windows Event Logs are enabled by checking the <strong>Missing Event Logs</strong> list.</li>
</ol>
<p> Note</p>
<p>If automatic event deployment fails, select <strong>Open agent configuration</strong> in the configuration workbook to manually add any missing Windows Event Logs.</p>
<h2 id="Optional-configure-alerts"><a href="#Optional-configure-alerts" class="headerlink" title="Optional: configure alerts"></a>Optional: configure alerts</h2><p>Azure Monitor for Azure Virtual Desktop allows you to monitor Azure Monitor alerts happening within your selected subscription in the context of your Azure Virtual Desktop data. Azure Monitor alerts are an optional feature on your Azure subscriptions, and you need to set them up separately from Azure Monitor for Azure Virtual Desktop. You can use the Azure Monitor alerts framework to set custom alerts on Azure Virtual Desktop events, diagnostics, and resources. To learn more about Azure Monitor alerts, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-log">Azure Monitor Log Alerts</a>.</p>
<h2 id="Diagnostic-and-usage-data"><a href="#Diagnostic-and-usage-data" class="headerlink" title="Diagnostic and usage data"></a>Diagnostic and usage data</h2><p>Microsoft automatically collects usage and performance data through your use of the Azure Monitor service. Microsoft uses this data to improve the quality, security, and integrity of the service.</p>
<p>To provide accurate and efficient troubleshooting capabilities, the collected data includes the portal session ID, Azure Active Directory user ID, and the name of the portal tab where the event occurred. Microsoft doesn’t collect names, addresses, or other contact information.</p>
<p>For more information about data collection and usage, see the <a target="_blank" rel="noopener" href="https://privacy.microsoft.com/privacystatement">Microsoft Online Services Privacy Statement</a>.</p>
<p> Note</p>
<p>To learn about viewing or deleting your personal data collected by the service, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/microsoft-365/compliance/gdpr-dsr-azure">Azure Data Subject Requests for the GDPR</a>. For more information about GDPR, see <a target="_blank" rel="noopener" href="https://servicetrust.microsoft.com/ViewPage/GDPRGetStarted">the GDPR section of the Service Trust portal</a>.</p>
<h2 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h2><p>Now that you’ve configured Azure Monitor for your Azure Virtual Desktop environment, here are some resources that might help you start monitoring your environment:</p>
<ul>
<li>Check out our <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor-glossary">glossary</a> to learn more about terms and concepts related to Azure Monitor for Azure Virtual Desktop.</li>
<li>To estimate, measure, and manage your data storage costs, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/azure-monitor-costs">Estimate Azure Monitor costs</a>.</li>
<li>If you encounter a problem, check out our <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/troubleshoot-azure-monitor">troubleshooting guide</a> for help and known issues.</li>
<li>To see what’s new in each version update, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/whats-new-azure-monitor">What’s new in Azure Monitor for Azure Virtual Desktop</a>.</li>
</ul>
<h1 id="How-to-resolve-Azure-Advisor-recommendations"><a href="#How-to-resolve-Azure-Advisor-recommendations" class="headerlink" title="How to resolve Azure Advisor recommendations"></a>How to resolve Azure Advisor recommendations</h1><p>This article describes how you can resolve recommendations that appear in Azure Advisor for Azure Virtual Desktop.</p>
<h2 id="“No-validation-environment-enabled”"><a href="#“No-validation-environment-enabled”" class="headerlink" title="“No validation environment enabled”"></a>“No validation environment enabled”</h2><p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/no-validation-environment.png" alt="A screenshot of the Azure Advisor Operational Excellence page. The &quot;no validation environment enabled&quot; recommendation is highlighted in red."></p>
<p>This recommendation appears under Operational Excellence. The recommendation should also show you a warning message like this:</p>
<p>“You don’t have a validation environment enabled in this subscription. When you made your host pools, you selected <strong>No</strong> for “Validation environment” in the Properties tab. To ensure business continuity through Azure Virtual Desktop service deployments, make sure you have at least one host pool with a validation environment where you can test for potential issues.”</p>
<p>You can make this warning message go away by enabling a validation environment in one of your host pools.</p>
<p>To enable a validation environment:</p>
<ol>
<li>Go to your Azure portal home page and select the host pool you want to change.</li>
<li>Next, select the host pool you want to change from a production environment to a validation environment.</li>
<li>In your host pool, select <strong>Properties</strong> on the left column. Next, scroll down until you see “Validation environment.” Select <strong>Yes</strong>, then select <strong>Apply</strong>.</li>
</ol>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/validation-yes.png" alt="A screenshot of the Properties menu. &quot;Validation environment&quot; is highlighted in red, and the &quot;Yes&quot; bubble is selected."></p>
<p>These changes won’t make the warning go away immediately, but it should disappear eventually. Azure Advisor updates twice a day. Until then, you can postpone or dismiss the recommendation manually. We recommend you let the recommendation go away on its own. That way, Azure Advisor can let you know if it comes across any problems as the settings change.</p>
<h2 id="“Not-enough-production-non-validation-environments-enabled”"><a href="#“Not-enough-production-non-validation-environments-enabled”" class="headerlink" title="“Not enough production (non-validation) environments enabled”"></a>“Not enough production (non-validation) environments enabled”</h2><p>This recommendation appears under Operational Excellence.</p>
<p>For this recommendation, the warning message appears for one of these reasons:</p>
<ul>
<li>You have too many host pools in your validation environment.</li>
<li>You don’t have any production host pools.</li>
</ul>
<p>We recommend users have fewer than half of their host pools in a validation environment.</p>
<p>To resolve this warning:</p>
<ol>
<li>Go to your Azure portal home page.</li>
<li>Select the host pools you want either want to change from validation to production.</li>
<li>In your host pool, select the <strong>Properties</strong> tab in the column on the right side of the screen. Next, scroll down until you see “Validation environment.” Select <strong>No</strong>, then select <strong>Apply</strong>.</li>
</ol>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/validation-no.png" alt="A screenshot of the Properties menu. &quot;Validation environment&quot; is highlighted in red, and the &quot;No&quot; bubble is selected."></p>
<p>These changes won’t make the warning go away immediately, but it should disappear eventually. Azure Advisor updates twice a day. Until then, you can postpone or dismiss the recommendation manually. We recommend you let the recommendation go away on its own. That way, Azure Advisor can let you know if it comes across any problems as the settings change.</p>
<h2 id="“Not-enough-links-are-unblocked-to-successfully-implement-your-VM”"><a href="#“Not-enough-links-are-unblocked-to-successfully-implement-your-VM”" class="headerlink" title="“Not enough links are unblocked to successfully implement your VM”"></a>“Not enough links are unblocked to successfully implement your VM”</h2><p>This recommendation appears under Operational Excellence.</p>
<p>You need to unblock specific URLs to make sure that your virtual machine (VM) functions properly. You can see the list at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/safe-url-list">Safe URL list</a>. If the URLs aren’t unblocked, then your VM won’t work properly.</p>
<p>To solve this recommendation, make sure you unblock all the URLs on the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/safe-url-list">Safe URL list</a>. You can use Service Tag or FQDN tags to unblock URLs, too.</p>
<h2 id="Next-steps-1"><a href="#Next-steps-1" class="headerlink" title="Next steps"></a>Next steps</h2><p>If you’re looking for more in-depth guides about how to resolve common issues, check out <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/troubleshoot-set-up-overview">Troubleshooting overview, feedback, and support for Azure Virtual Desktop</a>.</p>
<h1 id="Session-host-virtual-machine-sizing-guidelines"><a href="#Session-host-virtual-machine-sizing-guidelines" class="headerlink" title="Session host virtual machine sizing guidelines"></a>Session host virtual machine sizing guidelines</h1><p>Whether you’re running your session host virtual machines (VM) on Remote Desktop Services or Azure Virtual Desktop, different types of workloads require different VM configurations. The examples in this article are generic guidelines and you should only use them for initial performance estimates. For the best possible experience, you will need to scale your deployment depending on your users’ needs.</p>
<h2 id="Workloads"><a href="#Workloads" class="headerlink" title="Workloads"></a>Workloads</h2><p>Users can run different types of workloads on the session host virtual machines. The following table provides examples of a range of workload types to help you estimate what size your virtual machines need to be. After you set up your virtual machines, you should continually monitor their actual usage and adjust their size accordingly. If you end up needing a bigger or smaller virtual machine, you can easily scale your existing deployment up or down in Azure.</p>
<p>The following table describes each workload. <em>Example users</em> are the types of users that might find each workload most helpful. <em>Example apps</em> are the kinds of apps that work best for each workload.</p>
<table>
<thead>
<tr>
<th align="left">Workload type</th>
<th align="left">Example users</th>
<th align="left">Example apps</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Light</td>
<td align="left">Users doing basic data entry tasks</td>
<td align="left">Database entry applications, command-line interfaces</td>
</tr>
<tr>
<td align="left">Medium</td>
<td align="left">Consultants and market researchers</td>
<td align="left">Database entry applications, command-line interfaces, Microsoft Word, static web pages</td>
</tr>
<tr>
<td align="left">Heavy</td>
<td align="left">Software engineers, content creators</td>
<td align="left">Database entry applications, command-line interfaces, Microsoft Word, static web pages, Microsoft Outlook, Microsoft PowerPoint, dynamic web pages, software development</td>
</tr>
<tr>
<td align="left">Power</td>
<td align="left">Graphic designers, 3D model makers, machine learning researchers</td>
<td align="left">Database entry applications, command-line interfaces, Microsoft Word, static web pages, Microsoft Outlook, Microsoft PowerPoint, dynamic web pages, photo and video editing, computer-aided design (CAD), computer-aided manufacturing (CAM)</td>
</tr>
</tbody></table>
<h2 id="Single-session-recommendations"><a href="#Single-session-recommendations" class="headerlink" title="Single-session recommendations"></a>Single-session recommendations</h2><p>Single-session refers to when there is only one user logged on to a session host virtual machine at any one time, such as when using personal host pools in Azure Virtual Desktop. For VM sizing recommendations for single-session scenarios, we recommend at least two physical CPU cores per VM (typically four vCPUs with hyper-threading). If you need more specific VM sizing recommendations for single-session scenarios, ask the software vendors specific to your workload. VM sizing for single-session VMs will likely align with physical device guidelines.</p>
<p>The following table shows examples of typical workloads:</p>
<table>
<thead>
<tr>
<th align="left">Workload type</th>
<th align="left">vCPU&#x2F;RAM&#x2F;OS storage minimum</th>
<th align="left">Example Azure instances</th>
<th align="left">Profile container storage minimum</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Light</td>
<td align="left">2 vCPUs, 8 GB RAM, 32 GB storage</td>
<td align="left">D2s_v5, D2s_v4</td>
<td align="left">30 GB</td>
</tr>
<tr>
<td align="left">Medium</td>
<td align="left">4 vCPUs, 16 GB RAM, 32 GB storage</td>
<td align="left">D4s_v5, D4s_v4</td>
<td align="left">30 GB</td>
</tr>
<tr>
<td align="left">Heavy</td>
<td align="left">8 vCPUs, 32 GB RAM, 32 GB storage</td>
<td align="left">D8s_v5, D8s_v4</td>
<td align="left">30 GB</td>
</tr>
</tbody></table>
<h2 id="Multi-session-recommendations"><a href="#Multi-session-recommendations" class="headerlink" title="Multi-session recommendations"></a>Multi-session recommendations</h2><p>Multi-session refers to when there is more than one user logged on to a session host virtual machine at any one time, such as when using pooled host pools in Azure Virtual Desktop with the Windows 11 Enterprise multi-session operating system (OS). The following tables list the maximum suggested number of users per virtual central processing unit (vCPU) and the minimum VM configuration for each workload. If you need more specific VM sizing recommendations for single-session scenarios, ask the software vendors specific to your workload.</p>
<p>The following table shows examples of standard or larger user workloads:</p>
<table>
<thead>
<tr>
<th align="left">Workload type</th>
<th align="left">Maximum users per vCPU</th>
<th align="left">Minimum vCPU&#x2F;RAM&#x2F;OS storage</th>
<th align="left">Example Azure instances</th>
<th align="left">Minimum profile storage</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Light</td>
<td align="left">6</td>
<td align="left">8 vCPUs, 16 GB RAM, 32 GB storage</td>
<td align="left">D8s_v5, D8s_v4, F8s_v2, D8as_v4, D16s_v5, D16s_v4, F16s_v2, D16as_v4</td>
<td align="left">30 GB</td>
</tr>
<tr>
<td align="left">Medium</td>
<td align="left">4</td>
<td align="left">8 vCPUs, 16 GB RAM, 32 GB storage</td>
<td align="left">D8s_v5, D8s_v4, F8s_v2, D8as_v4, D16s_v5, D16s_v4, F16s_v2, D16as_v4</td>
<td align="left">30 GB</td>
</tr>
<tr>
<td align="left">Heavy</td>
<td align="left">2</td>
<td align="left">8 vCPUs, 16 GB RAM, 32 GB storage</td>
<td align="left">D8s_v5, D8s_v4, F8s_v2, D8as_v4, D16s_v5, D16s_v4, F16s_v2, D16as_v4</td>
<td align="left">30 GB</td>
</tr>
<tr>
<td align="left">Power</td>
<td align="left">1</td>
<td align="left">6 vCPUs, 56 GB RAM, 340 GB storage</td>
<td align="left">D16ds_v5, D16s_v4, D16as_v4, NV6, NV16as_v4</td>
<td align="left">30 GB</td>
</tr>
</tbody></table>
<p>For multi-session, we recommend limiting VM size to between 4 vCPUs and 24 vCPUs for the following reasons:</p>
<ul>
<li><strong>All VMs should have more than two cores</strong>: the UI components in Windows rely on using at least two parallel threads for some of the heavier rendering operations. For multi-session, having multiple users on a two-core VM will lead to the UI and apps becoming unstable, which lowers the quality of user experience. Four cores is the lowest recommended number of cores that a stable multi-session VM should have.</li>
<li><strong>VMs should not have more than 32 cores</strong>: as the number of cores increase, the system’s synchronization overhead also increases. For most workloads, at around 16 cores the return on investment gets lower, with most of the extra capacity being offset by synchronization overhead. You are likely to have more users from two 16 core VMs as opposed to one 32 core one.</li>
</ul>
<p>The recommended range between 4 and 24 cores will generally provide better capacity returns for your users as you increase the number of cores. For example, let’s say you have 12 users sign in at the same time to a VM with four cores. The ratio is three users per core. Meanwhile, on a VM with eight cores and 14 users, the ratio is 1.75 users per core. In this scenario, the latter configuration with a ratio of 1.75 offers greater burst capacity for your applications that have short-term CPU demand.</p>
<p>This recommendation is true at a larger scale. For scenarios with 20 or more users connected to a single VM, several smaller VMs would perform better than one or two large VMs. For example, if you’re expecting 30 or more users to simultaneously sign in within 10 minutes on the same session host with 16 cores, two eight-core VMs will handle the workload better. You can also use breadth-first load balancing to evenly distribute users across different VMs, rather than depth-first where a session host is saturated before using another one.</p>
<p>It’s also better to use a large number of smaller VMs instead of a few large VMs because it’s easier to shut down VMs that need to be updated or aren’t currently in use. With larger VMs, you’re more likely to have at least one user signed in at any time, which prevents you from shutting down the VM. When you have many smaller VMs, it’s more likely you’ll have some that don’t have any users signed in. You can safely shut these unused VMs to conserve resources (either automatically using autoscale in Azure Virtual Desktop, or manually), making your deployment more resilient, easier to maintain, and less expensive.</p>
<h2 id="General-virtual-machine-recommendations"><a href="#General-virtual-machine-recommendations" class="headerlink" title="General virtual machine recommendations"></a>General virtual machine recommendations</h2><p>In addition to the base requirements to run your chosen OS, in Azure we recommend you use Premium SSD storage for your OS disk for production workloads that require a service level agreement (SLA). For more details, see the <a target="_blank" rel="noopener" href="https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_8/">SLA for virtual machines</a>.</p>
<p>Graphics processing units (GPUs) are a good choice for users who regularly use graphics-intensive programs for video rendering, 3D design, and simulations.. Azure has several graphics acceleration deployment options and multiple available GPU VM sizes. Learn more at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/sizes-gpu">GPU optimized virtual machine sizes</a>. For more general information about graphics acceleration in Remote Desktop Services, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows-server/remote/remote-desktop-services/rds-graphics-virtualization">Choose your graphics rendering technology</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/b-series-burstable">B-series burstable VMs</a> in Azure are a good choice for users who don’t always need maximum CPU performance. For more information about VM types and sizes, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/sizes">Sizes for Windows virtual machines in Azure</a> and the pricing information on <a target="_blank" rel="noopener" href="https://azure.microsoft.com/pricing/details/virtual-machines/series/">our Virtual Machine series page</a>.</p>
<h2 id="Test-your-workload"><a href="#Test-your-workload" class="headerlink" title="Test your workload"></a>Test your workload</h2><p>Finally, we recommend you use simulation tools to test your deployment with both stress tests and real-life usage simulations. Make sure your system is responsive and resilient enough to meet user needs, and remember to vary the load size to avoid surprises.</p>
<h1 id="Autoscale-for-Pooled-Host-Pools-on-Azure-Virtual-Desktop"><a href="#Autoscale-for-Pooled-Host-Pools-on-Azure-Virtual-Desktop" class="headerlink" title="Autoscale for Pooled Host Pools on Azure Virtual Desktop"></a>Autoscale for Pooled Host Pools on Azure Virtual Desktop</h1><p>We shared at Microsoft Inspire that one of our most anticipated features, Autoscale for pooled host pools, will soon be Generally Available on Azure Virtual Desktop. Today, we are happy to announce that Autoscale for pooled host pools is officially Generally Available!</p>
<p><strong>Autoscale for Pooled Host Pools</strong></p>
<p>Autoscale on Azure Virtual Desktop is a native automated scaling solution that automatically turns session host virtual machines on and off according to the schedule and capacity thresholds that you define to fit your workload. With Autoscale, you can save costs by shutting down idle session hosts during off-peak hours while ensuring there’s enough capacity to meet your users’ needs during peak hours. </p>
<p>The following capabilities are now generally available with Autoscale for pooled host pools: </p>
<ul>
<li>You can now use the Desktop Virtualization Power On Off Contributor built in RBAC role instead of a custom RBAC role to grant permissions to Azure Virtual Desktop to scale the session hosts in your host pool.</li>
<li>Scaling plans are now available in almost all regions where Azure Virtual Desktop host pool objects are, including Australia East and all US and Canada regions.</li>
</ul>
<p>In addition, stay tuned for announcements on the following capabilities that are coming soon:</p>
<ul>
<li>Scaling plans in UK and Japan regions.</li>
<li>The ability to port Autoscale diagnostics logs to Log Analytics for analysis and parsing.</li>
<li>The ability to create schedules as proxy resources in PowerShell for easier configuration.</li>
</ul>
<p><strong>Getting Started</strong></p>
<p>To enable this feature, simply create a scaling plan, define schedules for when virtual machines should be turned on or off, and assign the scaling plan to one or more host pools.</p>
<p><img src="https://techcommunity.microsoft.com/t5/image/serverpage/image-id/393421iA84288292EE6B510/image-size/medium?v=v2&px=400" alt="thumbnail image 1 of blog post titled  	 	 	  	 	 	 				 		 			 				 						 							Announcing General Availability of Autoscale for Pooled Host Pools on Azure Virtual Desktop 							 						 					 			 		 	 			 	 	 	 	 	 "></p>
<h1 id="Manage-app-groups-with-the-Azure-portal"><a href="#Manage-app-groups-with-the-Azure-portal" class="headerlink" title="Manage app groups with the Azure portal"></a>Manage app groups with the Azure portal</h1><p>This content applies to Azure Virtual Desktop with Azure Resource Manager Azure Virtual Desktop objects. If you’re using Azure Virtual Desktop (classic) without Azure Resource Manager objects, see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/virtual-desktop-fall-2019/manage-app-groups-2019">this article</a>.</p>
<p>The default app group created for a new Azure Virtual Desktop host pool also publishes the full desktop. In addition, you can create one or more RemoteApp application groups for the host pool. Follow this tutorial to create a RemoteApp app group and publish individual Start menu apps.</p>
<p> Note</p>
<p>You can dynamically attach MSIX apps to user sessions or add your app packages to a custom virtual machine (VM) image to publish your organization’s apps. Learn more at <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/virtual-desktop/remote-app-streaming/custom-apps">How to host custom apps with Azure Virtual Desktop</a>.</p>
<p>In this tutorial, learn how to:</p>
<ul>
<li>Create a RemoteApp group.</li>
<li>Grant access to RemoteApp programs.</li>
</ul>
<h2 id="Create-a-RemoteApp-group"><a href="#Create-a-RemoteApp-group" class="headerlink" title="Create a RemoteApp group"></a>Create a RemoteApp group</h2><p>If you’ve already created a host pool and session host VMs using the Azure portal or PowerShell, you can add application groups from the Azure portal with the following process:</p>
<ol>
<li><p>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</p>
<p> Note</p>
<p>If you’re signing in to the US Gov portal, go to <a target="_blank" rel="noopener" href="https://portal.azure.us/">https://portal.azure.us/</a> instead.</p>
<p>If you’re accessing the Azure China portal, go to <a target="_blank" rel="noopener" href="https://portal.azure.cn/">https://portal.azure.cn/</a>.</p>
</li>
<li><p>Search for and select <strong>Azure Virtual Desktop</strong>.</p>
</li>
<li><p>You can add an application group directly or you can add it from an existing host pool. Choose an option below:</p>
<ul>
<li>Select <strong>Application groups</strong> in the menu on the left side of the page, then select <strong>+ Add</strong>.</li>
<li>Select <strong>Host pools</strong> in the menu on the left side of the screen, select the name of the host pool, select <strong>Application groups</strong> from the menu on the left side, then select <strong>+ Add</strong>. In this case, the host pool will already be selected on the Basics tab.</li>
</ul>
</li>
<li><p>On the <strong>Basics</strong> tab, select the <strong>Subscription</strong> and <strong>Resource group</strong> you want to create the app group for. You can also choose to create a new resource group instead of selecting an existing one.</p>
</li>
<li><p>Select the <strong>Host pool</strong> that will be associated with the application group from the drop-down menu.</p>
<p> Note</p>
<p>You must select the host pool associated with the application group. App groups have apps or desktops that are served from a session host and session hosts are part of host pools. The app group needs to be associated with a host pool during creation.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/basics-tab.png" alt="A screenshot of the Basics tab in the Azure portal."></p>
</li>
<li><p>Select <strong>RemoteApp</strong> under <strong>Application group type</strong>, then enter a name for your RemoteApp.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/remoteapp-button.png" alt="A screenshot of the Application group type fields. &quot;RemoteApp&quot; is highlighted."></p>
</li>
<li><p>Select <strong>Next: Assignments &gt;</strong> tab.</p>
</li>
<li><p>To assign individual users or user groups to the app group, select <strong>+Add Azure AD users or user groups</strong>.</p>
</li>
<li><p>Select the users you want to have access to the apps. You can select single or multiple users and user groups.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/select-users.png" alt="A screenshot of the user selection menu."></p>
</li>
<li><p>Select <strong>Select</strong>.</p>
</li>
<li><p>Select <strong>Next: Applications &gt;</strong>, then select <strong>+Add applications</strong>.</p>
</li>
<li><p>To add an application from the start menu:</p>
<ul>
<li>Under <strong>Application source</strong>, select <strong>Start menu</strong> from the drop-down menu. Next, under <strong>Application</strong>, choose the application from the drop-down menu.</li>
</ul>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/add-app-start.png" alt="A screenshot of the add application screen. The user has selected the Character Map as the application source and entered Character Map in the display name field."></p>
<ul>
<li>In <strong>Display name</strong>, enter the name for the application that will be shown to the user on their client.</li>
<li>Leave the other options as-is and select <strong>Save</strong>.</li>
</ul>
</li>
<li><p>To add an application from a specific file path:</p>
<ul>
<li>Under <strong>Application source</strong>, select <strong>File path</strong> from the drop-down menu.</li>
<li>In <strong>Application path</strong>, enter the path to the application on the session host registered with the associated host pool.</li>
<li>Enter the application’s details in the <strong>Application name</strong>, <strong>Display name</strong>, <strong>Icon path</strong>, and <strong>Icon index</strong> fields.</li>
<li>Select <strong>Save</strong>.</li>
</ul>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/add-app-file.png" alt="A screenshot of the add application page. The user has entered the file path to the 7-Zip File Manager app."></p>
</li>
<li><p>Repeat this process for every application you want to add to the application group.</p>
</li>
<li><p>Next, select <strong>Next: Workspace &gt;</strong>.</p>
</li>
<li><p>If you want to register the app group to a workspace, select <strong>Yes</strong> for <strong>Register application group</strong>. If you’d rather register the app group at a later time, select <strong>No</strong>.</p>
</li>
<li><p>If you select <strong>Yes</strong>, you can select an existing workspace to register your app group to.</p>
<p> Note</p>
<p>You can only register the app group to workspaces created in the same location as the host pool. Also. if you’ve previously registered another app group from the same host pool as your new app group to a workspace, it will be selected and you can’t edit it. All app groups from a host pool must be registered to the same workspace.</p>
<p><img src="https://learn.microsoft.com/en-us/azure/virtual-desktop/media/register-existing.png" alt="A screenshot of the register application group page for an already existing workspace. The host pool is preselected."></p>
</li>
<li><p>Optionally, if you want to create tags to make your workspace easy to organize, select <strong>Next: Tags &gt;</strong> and enter your tag names.</p>
</li>
<li><p>When you’re done, select <strong>Review + create</strong>.</p>
</li>
<li><p>Wait a bit for the validation process to complete. When it’s done, select <strong>Create</strong> to deploy your app group.</p>
</li>
</ol>
<p>The deployment process will do the following things for you:</p>
<ul>
<li>Create the RemoteApp app group.</li>
<li>Add your selected apps to the app group.</li>
<li>Publish the app group published to users and user groups you selected.</li>
<li>Register the app group, if you chose to do so.</li>
<li>Create a link to an Azure Resource Manager template based on your configuration that you can download and save for later.</li>
</ul>
<p> Important</p>
<p>You can only create 500 application groups for each Azure Active Directory tenant. We added this limit because of service limitations for retrieving feeds for our users. This limit doesn’t apply to app groups created in Azure Virtual Desktop (classic).</p>
<h2 id="Edit-or-remove-an-app"><a href="#Edit-or-remove-an-app" class="headerlink" title="Edit or remove an app"></a>Edit or remove an app</h2><p>To edit or remove an app from an app group:</p>
<ol>
<li><p>Sign in to the <a target="_blank" rel="noopener" href="https://portal.azure.com/">Azure portal</a>.</p>
<p> Note</p>
<p>If you’re signing in to the US Gov portal, go to <a target="_blank" rel="noopener" href="https://portal.azure.us/">https://portal.azure.us/</a> instead.</p>
</li>
<li><p>Search for and select <strong>Azure Virtual Desktop</strong>.</p>
</li>
<li><p>You can either add an application group directly or from an existing host pool by choosing one of the following options:</p>
<ul>
<li>To add a new application group directly, select <strong>Application groups</strong> in the menu on the left side of the page, then select the app group you want to edit.</li>
<li>To edit an app group in an existing host pool, select <strong>Host pools</strong> in the menu on the left side of the screen, select the name of the host pool, then select <strong>Application groups</strong> in the menu that appears on the left side of the screen, and then select the app group you want to edit.</li>
</ul>
</li>
<li><p>Select <strong>Applications</strong> in the menu on the left side of the page.</p>
</li>
<li><p>If you want to remove an application, select the check box next to the application, then select <strong>Remove</strong> from the menu on the top of the page.</p>
</li>
<li><p>If you want to edit the details of an application, select the application name. This will open up the editing menu.</p>
</li>
<li><p>When you’re done making changes, select <strong>Save</strong>.</p>
</li>
</ol>
<h2 id="Next-steps-2"><a href="#Next-steps-2" class="headerlink" title="Next steps"></a>Next steps</h2><p>In this tutorial, you learned how to create an app group, populate it with RemoteApp programs, and assign users to the app group. To learn how to create a validation host pool, see the following tutorial. You can use a validation host pool to monitor service updates before rolling them out to your production environment.</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/13/AZ-140-Automating-Azure-Virtual-Desktop-Management-Tasks-24/" rel="prev" title="AZ-140-Automating-Azure-Virtual-Desktop-Management-Tasks-24">
      <i class="fa fa-chevron-left"></i> AZ-140-Automating-Azure-Virtual-Desktop-Management-Tasks-24
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/13/AZ-140-Cert-Prep-Configuring-and-Operating-Microsoft-Azure-Virtual-Desktop-AZ-140-26/" rel="next" title="AZ-140-Cert-Prep-Configuring-and-Operating-Microsoft-Azure-Virtual-Desktop-AZ-140-26">
      AZ-140-Cert-Prep-Configuring-and-Operating-Microsoft-Azure-Virtual-Desktop-AZ-140-26 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Security-best-practices"><span class="nav-number">1.</span> <span class="nav-text">Security best practices</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Security-responsibilities"><span class="nav-number">1.1.</span> <span class="nav-text">Security responsibilities</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Azure-security-best-practices"><span class="nav-number">1.2.</span> <span class="nav-text">Azure security best practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-Microsoft-Defender-for-Cloud"><span class="nav-number">1.2.1.</span> <span class="nav-text">Enable Microsoft Defender for Cloud</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Improve-your-Secure-Score"><span class="nav-number">1.2.2.</span> <span class="nav-text">Improve your Secure Score</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Azure-Virtual-Desktop-security-best-practices"><span class="nav-number">1.3.</span> <span class="nav-text">Azure Virtual Desktop security best practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Require-multi-factor-authentication"><span class="nav-number">1.3.1.</span> <span class="nav-text">Require multi-factor authentication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-Conditional-Access"><span class="nav-number">1.3.2.</span> <span class="nav-text">Enable Conditional Access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Collect-audit-logs"><span class="nav-number">1.3.3.</span> <span class="nav-text">Collect audit logs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-RemoteApps"><span class="nav-number">1.3.4.</span> <span class="nav-text">Use RemoteApps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitor-usage-with-Azure-Monitor"><span class="nav-number">1.3.5.</span> <span class="nav-text">Monitor usage with Azure Monitor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Encrypt-your-VM"><span class="nav-number">1.3.6.</span> <span class="nav-text">Encrypt your VM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-host-security-best-practices"><span class="nav-number">1.4.</span> <span class="nav-text">Session host security best practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-endpoint-protection"><span class="nav-number">1.4.1.</span> <span class="nav-text">Enable endpoint protection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-an-endpoint-detection-and-response-product"><span class="nav-number">1.4.2.</span> <span class="nav-text">Install an endpoint detection and response product</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-threat-and-vulnerability-management-assessments"><span class="nav-number">1.4.3.</span> <span class="nav-text">Enable threat and vulnerability management assessments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Patch-software-vulnerabilities-in-your-environment"><span class="nav-number">1.4.4.</span> <span class="nav-text">Patch software vulnerabilities in your environment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Establish-maximum-inactive-time-and-disconnection-policies"><span class="nav-number">1.4.5.</span> <span class="nav-text">Establish maximum inactive time and disconnection policies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-up-screen-locks-for-idle-sessions"><span class="nav-number">1.4.6.</span> <span class="nav-text">Set up screen locks for idle sessions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Establish-tiered-admin-access"><span class="nav-number">1.4.7.</span> <span class="nav-text">Establish tiered admin access</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Consider-which-users-should-access-which-resources"><span class="nav-number">1.4.8.</span> <span class="nav-text">Consider which users should access which resources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Manage-Office-Pro-Plus-security"><span class="nav-number">1.4.9.</span> <span class="nav-text">Manage Office Pro Plus security</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-security-tips-for-session-hosts"><span class="nav-number">1.4.10.</span> <span class="nav-text">Other security tips for session hosts</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Azure-Virtual-Desktop-support-for-Trusted-Launch"><span class="nav-number">1.5.</span> <span class="nav-text">Azure Virtual Desktop support for Trusted Launch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Azure-Confidential-Computing-virtual-machines-preview"><span class="nav-number">1.6.</span> <span class="nav-text">Azure Confidential Computing virtual machines (preview)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Secure-Boot"><span class="nav-number">1.6.1.</span> <span class="nav-text">Secure Boot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Monitor-boot-integrity-using-Remote-Attestation"><span class="nav-number">1.6.2.</span> <span class="nav-text">Monitor boot integrity using Remote Attestation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vTPM"><span class="nav-number">1.6.3.</span> <span class="nav-text">vTPM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Virtualization-based-Security"><span class="nav-number">1.6.4.</span> <span class="nav-text">Virtualization-based Security</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Hypervisor-Protected-Code-Integrity"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">Hypervisor-Protected Code Integrity</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows-Defender-Credential-Guard"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">Windows Defender Credential Guard</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nested-virtualization"><span class="nav-number">1.7.</span> <span class="nav-text">Nested virtualization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows-Defender-Application-Control"><span class="nav-number">1.8.</span> <span class="nav-text">Windows Defender Application Control</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Enable-or-disable-Start-VM-on-Connect"><span class="nav-number">2.</span> <span class="nav-text">Enable or disable Start VM on Connect</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Prerequisites"><span class="nav-number">2.1.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Assign-the-Desktop-Virtualization-Power-On-Contributor-role-with-the-Azure-portal"><span class="nav-number">2.2.</span> <span class="nav-text">Assign the Desktop Virtualization Power On Contributor role with the Azure portal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Enable-or-disable-Start-VM-on-Connect-1"><span class="nav-number">2.3.</span> <span class="nav-text">Enable or disable Start VM on Connect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting"><span class="nav-number">2.4.</span> <span class="nav-text">Troubleshooting</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configure-the-personal-desktop-host-pool-assignment-type"><span class="nav-number">3.</span> <span class="nav-text">Configure the personal desktop host pool assignment type</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Prerequisites-1"><span class="nav-number">3.1.</span> <span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Personal-host-pools-overview"><span class="nav-number">3.2.</span> <span class="nav-text">Personal host pools overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-automatic-assignment"><span class="nav-number">3.3.</span> <span class="nav-text">Configure automatic assignment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-direct-assignment"><span class="nav-number">3.4.</span> <span class="nav-text">Configure direct assignment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-unassign-a-personal-desktop"><span class="nav-number">3.5.</span> <span class="nav-text">How to unassign a personal desktop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-reassign-a-personal-desktop"><span class="nav-number">3.6.</span> <span class="nav-text">How to reassign a personal desktop</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-Log-Analytics-for-the-diagnostics-feature"><span class="nav-number">4.</span> <span class="nav-text">Use Log Analytics for the diagnostics feature</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Before-you-get-started"><span class="nav-number">4.1.</span> <span class="nav-text">Before you get started</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Push-diagnostics-data-to-your-workspace"><span class="nav-number">4.2.</span> <span class="nav-text">Push diagnostics data to your workspace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-access-Log-Analytics"><span class="nav-number">4.3.</span> <span class="nav-text">How to access Log Analytics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Log-Analytics-on-a-Log-Analytics-workspace"><span class="nav-number">4.3.1.</span> <span class="nav-text">Access Log Analytics on a Log Analytics workspace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Log-Analytics-on-Azure-Monitor"><span class="nav-number">4.3.2.</span> <span class="nav-text">Access Log Analytics on Azure Monitor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cadence-for-sending-diagnostic-events"><span class="nav-number">4.4.</span> <span class="nav-text">Cadence for sending diagnostic events</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Example-queries"><span class="nav-number">4.5.</span> <span class="nav-text">Example queries</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-Azure-Monitor-for-Azure-Virtual-Desktop-to-monitor-your-deployment"><span class="nav-number">5.</span> <span class="nav-text">Use Azure Monitor for Azure Virtual Desktop to monitor your deployment</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Requirements"><span class="nav-number">5.1.</span> <span class="nav-text">Requirements</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Open-Azure-Monitor-for-Azure-Virtual-Desktop"><span class="nav-number">5.2.</span> <span class="nav-text">Open Azure Monitor for Azure Virtual Desktop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Log-Analytics-settings"><span class="nav-number">5.3.</span> <span class="nav-text">Log Analytics settings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set-up-using-the-configuration-workbook"><span class="nav-number">5.4.</span> <span class="nav-text">Set up using the configuration workbook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Resource-diagnostic-settings"><span class="nav-number">5.4.1.</span> <span class="nav-text">Resource diagnostic settings</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Host-pool-diagnostic-settings"><span class="nav-number">5.4.1.1.</span> <span class="nav-text">Host pool diagnostic settings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Workspace-diagnostic-settings"><span class="nav-number">5.4.1.2.</span> <span class="nav-text">Workspace diagnostic settings</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session-host-data-settings"><span class="nav-number">5.4.2.</span> <span class="nav-text">Session host data settings</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Session-hosts"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">Session hosts</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Workspace-performance-counters"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">Workspace performance counters</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Configure-Windows-Event-Logs"><span class="nav-number">5.4.2.3.</span> <span class="nav-text">Configure Windows Event Logs</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optional-configure-alerts"><span class="nav-number">5.5.</span> <span class="nav-text">Optional: configure alerts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Diagnostic-and-usage-data"><span class="nav-number">5.6.</span> <span class="nav-text">Diagnostic and usage data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Next-steps"><span class="nav-number">5.7.</span> <span class="nav-text">Next steps</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#How-to-resolve-Azure-Advisor-recommendations"><span class="nav-number">6.</span> <span class="nav-text">How to resolve Azure Advisor recommendations</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9CNo-validation-environment-enabled%E2%80%9D"><span class="nav-number">6.1.</span> <span class="nav-text">“No validation environment enabled”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9CNot-enough-production-non-validation-environments-enabled%E2%80%9D"><span class="nav-number">6.2.</span> <span class="nav-text">“Not enough production (non-validation) environments enabled”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9CNot-enough-links-are-unblocked-to-successfully-implement-your-VM%E2%80%9D"><span class="nav-number">6.3.</span> <span class="nav-text">“Not enough links are unblocked to successfully implement your VM”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Next-steps-1"><span class="nav-number">6.4.</span> <span class="nav-text">Next steps</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-host-virtual-machine-sizing-guidelines"><span class="nav-number">7.</span> <span class="nav-text">Session host virtual machine sizing guidelines</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Workloads"><span class="nav-number">7.1.</span> <span class="nav-text">Workloads</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Single-session-recommendations"><span class="nav-number">7.2.</span> <span class="nav-text">Single-session recommendations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multi-session-recommendations"><span class="nav-number">7.3.</span> <span class="nav-text">Multi-session recommendations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#General-virtual-machine-recommendations"><span class="nav-number">7.4.</span> <span class="nav-text">General virtual machine recommendations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Test-your-workload"><span class="nav-number">7.5.</span> <span class="nav-text">Test your workload</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Autoscale-for-Pooled-Host-Pools-on-Azure-Virtual-Desktop"><span class="nav-number">8.</span> <span class="nav-text">Autoscale for Pooled Host Pools on Azure Virtual Desktop</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Manage-app-groups-with-the-Azure-portal"><span class="nav-number">9.</span> <span class="nav-text">Manage app groups with the Azure portal</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-a-RemoteApp-group"><span class="nav-number">9.1.</span> <span class="nav-text">Create a RemoteApp group</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Edit-or-remove-an-app"><span class="nav-number">9.2.</span> <span class="nav-text">Edit or remove an app</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Next-steps-2"><span class="nav-number">9.3.</span> <span class="nav-text">Next steps</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
