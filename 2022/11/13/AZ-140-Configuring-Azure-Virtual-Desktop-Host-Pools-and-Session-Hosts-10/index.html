<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="AVD Host Pools and Session HostsThanks for joining this course on Azure Virtual Desktops, Host Pools, and Session Hosts. You’re going to learn just about everything there is about Host Pools and Ses">
<meta property="og:type" content="article">
<meta property="og:title" content="AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10">
<meta property="og:url" content="https://example.com/2022/11/13/AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10/index.html">
<meta property="og:site_name" content="Hang&#39;s Blog">
<meta property="og:description" content="AVD Host Pools and Session HostsThanks for joining this course on Azure Virtual Desktops, Host Pools, and Session Hosts. You’re going to learn just about everything there is about Host Pools and Ses">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-11-13T22:34:58.000Z">
<meta property="article:modified_time" content="2022-11-20T23:18:46.000Z">
<meta property="article:author" content="Hang Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://example.com/2022/11/13/AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10 | Hang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://example.com/2022/11/13/AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/123456.gif">
      <meta itemprop="name" content="Hang Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-13 18:34:58" itemprop="dateCreated datePublished" datetime="2022-11-13T18:34:58-04:00">2022-11-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-20 19:18:46" itemprop="dateModified" datetime="2022-11-20T19:18:46-04:00">2022-11-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AZ-140/" itemprop="url" rel="index"><span itemprop="name">AZ-140</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2022/11/13/AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/11/13/AZ-140-Configuring-Azure-Virtual-Desktop-Host-Pools-and-Session-Hosts-10/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <span id="more"></span>

<h1 id="AVD-Host-Pools-and-Session-Hosts"><a href="#AVD-Host-Pools-and-Session-Hosts" class="headerlink" title="AVD Host Pools and Session Hosts"></a>AVD Host Pools and Session Hosts</h1><p>Thanks for joining this course on Azure Virtual Desktops, Host Pools, and Session Hosts. You’re going to learn just about everything there is about Host Pools and Session Hosts so that you can pass the Azure Virtual Desktop exam and up your AVD skills. My name is Dean Cefola and I’ve been in the IT industry for over 20 years. Today, I’m an Azure Principal Engineer at Microsoft and I’ve been working with Azure Virtual Desktop since before the beginning. I hope you’ll find this course entertaining and educational, so please rate this course when you’re done and let me know how I did.</p>
<p>Who should attend this course? Anybody that’s planning on taking the Azure Virtual Desktop Specialty exam and anyone who’s interested in learning more on how to properly deploy an AVD environment. Speaking of this course, we’ll cover everything you need to deploy and configure your Host Pools and Session Hosts. We’ll set up auto-scaling for Azure Virtual Desktop. We’ll talk through the AVD limits as well as the high availability options. We’ll go through the AVD Session Hosts join options, as well as take a quick dive into AVD automation, so that you can have a well-rounded view of AVD and how you can build and improve your environment. </p>
<p>To get the most out of this course, you should have an administrator-level understanding of Azure Virtual Machines, Azure’s high availability solutions, Windows Management join options, and then ARM templates, Azure CLI, and PowerShell for automation. Feedback is how we can all continue to improve, so if you have any feedback, positive or negative, you can let me know by rating this course at the end, as well as contacting us directly at <a href="mailto:&#x73;&#117;&#112;&#112;&#x6f;&#x72;&#x74;&#64;&#99;&#x6c;&#111;&#x75;&#100;&#97;&#99;&#x61;&#100;&#x65;&#109;&#x79;&#x2e;&#99;&#x6f;&#x6d;">&#x73;&#117;&#112;&#112;&#x6f;&#x72;&#x74;&#64;&#99;&#x6c;&#111;&#x75;&#100;&#97;&#99;&#x61;&#100;&#x65;&#109;&#x79;&#x2e;&#99;&#x6f;&#x6d;</a>. One last thing before we get started, everything I’ll be showing in this course is up to date at the time of filming, however, the cloud does change over time. So, if you find the material here becomes out of date, please let us know at <a href="mailto:&#x73;&#117;&#112;&#112;&#x6f;&#114;&#116;&#x40;&#x63;&#108;&#x6f;&#117;&#x64;&#97;&#x63;&#x61;&#100;&#x65;&#109;&#121;&#x2e;&#x63;&#111;&#109;">&#x73;&#117;&#112;&#112;&#x6f;&#114;&#116;&#x40;&#x63;&#108;&#x6f;&#117;&#x64;&#97;&#x63;&#x61;&#100;&#x65;&#109;&#121;&#x2e;&#x63;&#111;&#109;</a>, so we can keep things updated. With all that out of the way, let’s get started.</p>
<h1 id="What-is-a-Host-Pool"><a href="#What-is-a-Host-Pool" class="headerlink" title="What is a Host Pool?"></a>What is a Host Pool?</h1><p>Let’s first answer the question, what exactly is a Host Pool? Host Pools are a collection of one or more identical virtual machines in the AVD Environment, and it’s a Host Pool that’s the heart of AVD. Session hosts are a member of it, App groups are connected to it, and workspaces are associated with it. The reason why a Host Pool is a collection of identical virtual machine session Host is because a Host Pool should be created for a specific use case or user persona to consumer’s resources. For example, you would have a Host Pool for the Accounting Department and a separate pool for those field sales folks. </p>
<p>This is because the applications that each group needs will be unique and so to will be their behavior and performance requirements, which means that their configurations and properties will also be different. Each Host Pool will also be unique because of the number of users in that use case and they’ll require different amounts of user density and different numbers of session hosts, which also means different configurations and properties. An example of this is in the join options. If you have domain join session host and Azure AD-joined session host, they will need to be in separate pools because the RDP property configurations are very different.</p>
<h1 id="How-Many-Host-Pools-Do-You-Need"><a href="#How-Many-Host-Pools-Do-You-Need" class="headerlink" title="How Many Host Pools Do You Need?"></a>How Many Host Pools Do You Need?</h1><p>With those thoughts in mind, how many host pools do you really need?</p>
<p>As I said before, you can have a unique host pool for every use case. But at the upper limit of a AVD, you can have 400 host pools per Azure Active Directory Tenant. Now, there are also two different kinds of host pools; personal and pooled.</p>
<p>Personal host pools have a single user assigned to each session host. So, if you have 500 users, you’ll need 500 session hosts. Pooled host pools can have multiple users logging on to the same session host virtual machine at the same time. So, those same 500 users could all be logged in at the same time across 20 virtual machines.</p>
<h1 id="Build-Host-Pool-Demo"><a href="#Build-Host-Pool-Demo" class="headerlink" title="Build Host Pool Demo"></a>Build Host Pool Demo</h1><p>Let’s build our first host pool. In the Azure portal, click the plus at the top to create a new resource. Type host pool in the search box, then you’ll want to click on the second option for host pool. Now click the ‘Create’ button, select the desired subscription, and then click here to create a new resource group. You’ll need to give the resource group a name and the name should follow your company’s standard naming convention. </p>
<p>For me, that uses the name of the project-resource type. So, in my environment, I’ll use FirstPool-RG. Now the host pool name should also match your naming convention. So, for me this will be FirstPool-HP. Now we need a location, and this is where the metadata of the host pool will be stored. The metadata is extra information about your Azure virtual desktop resources that are needed to maintain your connections, users, and application associations, and that’s all stored in a Cosmos database per geography. As of this recording, there are five metadata locations. Canada, Europe, Japan, United Kingdom, and the United States. Since my users are located near the East US, that’s where I’ll be deploying. </p>
<p>Next, we have the validation environment setting. This feature controls two things: Access to some of the preview features, and how AVD session host agent updates are rolled out. It is recommended to have a validation host pool for each production pool if they’re built from unique images, or one validation pool if they’re all built from the same image. This will allow you to test the AVD agent update’s potential impact on your pools in advance of production. It is very rare to see an issue, but if you do, open a support ticket as quickly as possible so the issue can be resolved before updates are rolled out to production pools.</p>
<p>Functionally, this will not impact your pool, so I’ll leave it on ‘No’ in this case. And let’s look at the last choice we need to make on this page concerning our host pool type. We have two options, personal and pooled. If you select personal, you’ll now have to decide how your users will be assigned to their session host virtual machines, automatically or directly. The only reason I find that customers want to go against the general best practice that all VMs in the host pool are the same, is because if they’re built from different sizes or have special applications or configurations. If so, you’ll want to choose the direct method. And don’t get me wrong, it is a viable option, just not an optimal one. The other option is to choose pooled. </p>
<p>Here, you have to choose the load balancer algorithm of either breadth-first or depth-first. Breadth-first is where we will have users logging in across all of the session hosts in the pool evenly. This is most advantageous during those morning logon storms, so each user can log in as fast as possible. Depth-first is where you’ll want to have the maximum number of users log on to the first VM before anyone is allowed to log on to a second. This is usually best after the logon storm during the normal business operations, so that you can have the fewest number of session hosts running as possible, which helps to keep costs down. But since you have to pick one method, which one is right? I’m going to say both and neither, which might be confusing right now but it will become a lot clearer as we configure our host pools in our next section. </p>
<p>For now, I’ll pick breadth-first and now we need to set the max session limit, and this controls how many users can log on to the VM at the same time. I’m going to set this to 20, and now click ‘Next’. This is where we could provision our session host VMs, but we’ll skip over this for now. Click ‘Next’, here’s where you could provision a workspace, but that’s another course, so we’ll skip that as well. Here on the advanced tab, you can set up your monitoring, and I do definitely recommended this. You check the box here at the top and then you select the preferred logging method, which is going to depend on your monitoring solution. To leverage the native AVD insights monitoring tool, you’ll need to select a log analytics workspace. I’m actually going to remove these options for now so I can show you how to do this on an existing host pool in just a moment. </p>
<p>So, I’ll uncheck the box here and click ‘Next’. Here we can add another form of metadata with Azure tags. These are key and value pairs that tell you not only a lot about your resources, but they can be leveraged for automation and management as well. The standard tags that I use are for application, cost center, environment, owner, and support contact. Add the tags that are part of your governance plan and then click the ‘Review and Create’ button. Here we have a summary of everything that you selected to build, but before you click ‘Deploy’, click over here on download a template for automation. This is a JSON arm template that will be used to provision your host pool. And you can click the ‘Download’ button at the top to save this for our future use or customization. We’ll talk more about armed templates during our automation section later in this course. For now, click the ‘X’ in the top corner and then click the ‘Create’ button at the bottom.</p>
<h1 id="Configure-Host-Pool-Demo"><a href="#Configure-Host-Pool-Demo" class="headerlink" title="Configure Host Pool Demo"></a>Configure Host Pool Demo</h1><p>Now that you’ve built your first Host Pool, let’s have a look around. Starting at the top, we have a registration key, and this will be necessary when building our session host, so we’ll come back to that one later. Then we have some information about our Host Pool and our tags. In the bottom section, we can see the total number of session hosts which right now is zero. Separate from that is the number of session hosts that are unavailable for user connections, then the disconnected, active, and total number of user sessions. Finally, at the bottom is the number of application groups and applications this pool supports. Over on the left of the screen, we have the blade section. </p>
<p>Starting at the bottom, click on ‘Diagnostic settings’. This is the same settings that we walked through during the build process and it’s required to set up AVD insights monitoring. Click the ‘Add diagnostic settings’ in the middle. Settings need a name but it does not have to be unique. So, we’ll just call it Host Pool Monitoring. On the left, we have all of the different log categories that can be monitored, but the default recommendation is to select all logs. Then on the right, we have the destination for those logs. Now to use the native insights monitoring tool, you’ll need to store this in log analytics. So, I’ll just check that box and select a workspace in my environment. </p>
<p>Then click ‘Save’ at the top. Now, of course, if you’re using a different monitoring solution, then you’ll need to pick the proper log destination. Moving up the blade, we have the management section. We’re going to skip MSIX packages since that would be more related to a course on AVD applications. We’ll come back to session host in a few minutes. So, click on ‘Application groups’. The one thing I’ll mention here is that during the portal build process, you’ll get your first desktop application group automatically. But if you provision your session host through an arm template or some other scripted automation, you would not get an application group by default. </p>
<p>And since application groups are their own resources which would be covered in another course on apps, we’ll move on to the scheduled agent updates. This feature lets you control when the AVD session host agent updates are rolled out and they can be deployed during your maintenance windows. This is separate from the validation environment setting and can be used in conjunction with it. To enable, check the box at the top and then you’ll need to specify a schedule. If your session hosts are spread across multiple regions, then I suggest you check this box to use the local session host time zone. That way, each region will be able to follow its own maintenance window instead of having one global maintenance window. This will help any maintenance going on in region A not disturb the users in region B. Then we need to select our maintenance window by picking the day of the week and the time you want the window to begin. </p>
<p>You can also check the box here for an additional maintenance window if you like, and then click ‘Apply’ at the bottom. Next in the blade is the property section. Here’s where you’ll find the resource ID for the Host Pool, and if you scroll down, we have the start VM on connect and validation environment settings. Start VM on connect only applies to Personal-HostPools, so we won’t worry about that for this Pooled-HostPool. You can also give your Host Pool a friendly name and a description, and at the bottom, you can change the load balancing algorithm or the max session limit. Once you’ve made any changes here, you’ll need to click ‘Save’ at the top. Next is the RDP properties. This controls some of the look, feel, and security of your Host Pool that more traditionally would have been done through group policy. Now, not all of these settings are applicable in every environment. </p>
<p>For example, unless you’re using smart card authentication, you wouldn’t need to use the KDC proxy name. On the sessions tab, you can control the reconnection behavior and compression for video playback and try to optimize the user experience. On the device redirection tab, you’ll find several of these security settings controlling microphone and camera redirection, presenting local drives into the AVD session, as well as clipboard and local printer redirection behavior, and a whole lot more. The display settings is where you can figure how the sessions will be displayed to the users, from picking single or multiple monitors to specific resolution settings and scaling factors. On the advanced tab, this is the culmination of all of the other settings. The ones you’re seeing here are all of the default settings and any changes you make on the previous tabs will update here automatically and then you just click ‘Save’. You can find a full list of these settings here in the AVD documentation and there is a whole lot to read through.</p>
<h1 id="Autoscale-Host-Pool-Demo"><a href="#Autoscale-Host-Pool-Demo" class="headerlink" title="Autoscale Host Pool Demo"></a>Autoscale Host Pool Demo</h1><p>The next item in the blade is the scaling plans. This relates to the autoscale feature which will allow your pooled host pools to dynamically power on or off your session host which helps to control costs all based on user demand. This feature is currently in preview, however, we don’t need the validation environment setting to use it. But we will have to create a custom role to grant the AVD service permissions to control our virtual machines. To begin, we’re going to have to go to your Azure subscription. Then on the left near the top, go to access control, click the ‘Add’ button here at the top, and then click ‘Add custom role’. Click over to the JSON tab, and then click the ‘Edit’ button here at the top. </p>
<p>You’re going to want to erase all of the code in the box and then open this link. Scroll down until you find this block of JSON code and click the ‘Copy’ button, then go back to the Azure portal. Paste in the code in the box and click the ‘Save’ button at the top. Now go back to the Assignable scopes tab, and you’ll see here a placeholder that you need to delete. Now click the ‘Assignable Scopes’ button. If it’s not already on the left, select the subscriptions, and then on the right, select the particular subscription where your host pool is located. Then click the ‘Select’ button at the bottom. Click the ‘Review and Create’ button and you can review all of the permissions that will be granted to the virtual desktop service, and then click the ‘Create’ button at the bottom and you should see this message that you’ve successfully created a custom role, and that role is called Azure Virtual Desktop Autoscale. </p>
<p>Now it may take a few minutes to display this role everywhere, so be patient. Click the ‘Okay’ button, back in the host pool, click the ‘Access Control’ in the top of the blade on the left, then click the ‘Add’ button at the top, and click ‘Add role assignment’. In the filter, type the word autoscale, and then select Azure Virtual Desktop Autoscale, which is a custom role, then click ‘Next’. Click in the middle here to select members. Over on the right, search for Windows Virtual Desktop and click on the first item that only says Windows Virtual Desktop. Then click the ‘Select’ button at the bottom. Now click ‘Review and Assign’. When I look at the role assignment section, I can see the Azure Virtual Desktop Autoscale role has been assigned to the Windows Virtual Desktop service scoped at the host pools resource. Back on the left, click on your ‘Scaling plans’. Now in order to add a scaling plan to this host pool, first we need to create one. </p>
<p>In the search bar here at the top, type scaling plan, then click on the first item. Click the ‘Create’ button at the top, select this subscription and the same resource group where your host pool is located, and give your scaling plan a name that matches your naming convention. For me, this will be FirstPool-ScalingPlan. The location must be the same region where the host pool is deployed, and you can optionally give your scaling plan a friendly name and a description. At the bottom, select your time zone and then click ‘Next’. I’d like to add a new schedule and many of the settings here are filled out to help guide you along the way. This first schedule’s name is weekdays_schedule, and it has Monday through Friday selected. Be aware though at this time each day can only be associated with a single schedule. </p>
<p>Click ‘Next’. In the ramp up section, we dictate how the host pool will function during those morning log on storms, and you can specify the start time such as 8:00 AM. The load balancing algorithm here is set for breadth first, which will allow the greatest number of users to log on to the most number of session hosts at the same time, which should leave nobody waiting. The minimum percentage of hosts is set for 20%, which means that 20% of the total hosts in the pool will be powered on at 8:00 AM. And our capacity threshold has to do with the number of the users logged on relative to the max session limit. Now we set our max session limit for 20, and the capacity threshold of 60% means when 12 users have logged onto a VM, autoscale will power on the next VM. Click ‘Next’. </p>
<p>In the peak hours tab, we’re now past the morning log on storm, and so we’ve set our time here for 9:00 AM. And we’ve switched the load balancing algorithm to depth first, and this means we now want to stack as many users as possible onto each VM before more users log on to the next available VM. This will help you get the most usage out of each session host VM in the pool, and as your users log off sessions, eventually the VMs will have no users on them and be able to be powered off to reduce cost. In the ramp down section, we’re beginning this at 6:00 PM. So, this is the end of our day. We’ve still got depth first load balancing set and we want to get as many VMs turned off as soon as possible. </p>
<p>The minimum percentage of hosts that will remain online is 10% and the capacity threshold is 90%, and we have the option to force users to log off. I generally don’t recommend this because you don’t want to interrupt a user during a session if you don’t have to. You can additionally delay the time before those users are forced off and you can display for them a console notification telling them to save their work and log off before the time limit, so that they don’t lose anything that they’re doing. Click ‘Next’. Finally, the off-peak hour section begins at 8 PM. We’re still using depth first and we have a capacity threshold of 90%, so we won’t spin up a new VM unless 18 out of 20 users are logged onto a machine, and 20 was, again, our max session limit that we chose. </p>
<p>Click ‘Add’ at the bottom and click ‘Next’ for your host pool assignment. Since the scaling plan and the host pool must be in the same region, when you click the drop-down, you’ll only see the pools that are in the same region as your scaling plan. Check the box for your host pool and then click ‘Next’. Add your standard tags just like we did before. This way, all of your resources will all be related to each other. Click ‘Next’ and you can review all of your settings, and if everything looks correct, then click ‘Create’. Back in your host pool, we now see that the scaling plan has been associated with your pool, which means that the autoscale feature is now enabled.</p>
<h1 id="What-are-Session-Hosts"><a href="#What-are-Session-Hosts" class="headerlink" title="What are Session Hosts?"></a>What are Session Hosts?</h1><p>Now, I know we’ve talked about it several times, but what exactly is a Session Host?</p>
<p>An Azure Virtual Desktop Session Host is a standard Azure virtual machine of any type and any size that has been deployed in the cloud. Then, the AVD Bootloader agent and the AVD agent get installed, registering the VM to the Host Pool as a new Session Host. This means that the Session Host is a role that’s added to a VM and not the VM itself. And since the Session Host role can be added to any virtual machine type, you can use the VM skew that best suits your needs and user personas. Maybe you need something like a massive CPU, you can pick an L series VM. Or maybe you need graphics power, and you can pick an N series skew. You can even take advantage of other VM’s advanced features, like ephemeral disk, or trusted launch, and also Gen2 virtual machines.</p>
<h1 id="Session-Hosts-Limits"><a href="#Session-Hosts-Limits" class="headerlink" title="Session Hosts Limits"></a>Session Hosts Limits</h1><p>Let’s talk about limits for Session Hosts.</p>
<p>Well, there kind of are none, at least not when the number of users are concerned. There’s also no AVD user license restriction, and there’s also no Windows license restriction from packing as many users you want to on a single AVD Session Host. The limitations come in more of the resources that are available on the VM and what those users are doing. So, as always, it depends, and what it depends most on are the apps and their requirements, the overall VM performance, and the numbers of total VMS that you want to manage in your environment. </p>
<p>Now, as far as the upper limit of Session Host per Host Pool, today, it’s 10,000 Session Host per Host Pool. However, it is recommended to have no more than 5,000 Session Host per subscription, per region. So, if you have three Azure subscriptions and you’re deployed across three different regions, then you can have 5,000 Session Host per region for a total of 15,000 Session Hosts. Now, if your users and workloads are centered just around these three regions and you need to scale out more, then you can expand across those other subscriptions. So, two subscriptions would give you 30,000, and if you scale out further across all three subscriptions, you can have 45,000 session hosts.</p>
<h1 id="Session-Hosts-High-Availability"><a href="#Session-Hosts-High-Availability" class="headerlink" title="Session Hosts High Availability"></a>Session Hosts High Availability</h1><p>There is no best practice or recommendation for how to deploy with or without high availability, but there are a lot of things to consider. When we talk about high availability in Azure VMs, we’re talking about availability zones or availability sets. Availability zones are groups of Azure data centers within a particular region where availability sets are scoped at the rack of servers within a data center. And availability sets break down into two parts, fault domains, and update domains. The fault domain is the rack of equipment. Then the update domains are groups of VMs spread across multiple racks for a single workload. Now, when it comes to your personal host pools, you have one user for each session host virtual machine. </p>
<p>So, from the user’s perspective, there really is no high availability regardless of if you choose availability zones or sets because if their VM is down, they’re unable to work. However, it is still a best practice to use an availability zone or set so that the personal host pool solution as a whole can remain more highly available in case there are any hardware issues in the Azure data centers. In a pooled host pool, however, we have the opposite case. If any singular VM is unavailable, your users could simply log onto a different VM in the pool. So, definitely using an availability set or a zone will give you more high availability for this solution as a whole as well as the individual user. </p>
<p>Not all Azure services work directly with availability zones and any traffic that goes between zones is considered interzonal traffic, which does have an egress charge. One last thing to consider, however, are deployments. Availability sets also have a maximum of 200 VMs per set and that is a limitation at a AVD scale solution. So, if your AVD deployment is larger than 200 session hosts in a single region, you’ll need to consider how much you really need an availability set, since this will potentially limit the number of VMs that you can deploy at once. Without an availability set, you can deploy up to 400 VMs at a time. Now you might be willing to sacrifice on the deployment side to get some extra high availability, but you also need to consider your monthly service updates. If your update plan is to provision new VMs and throw away the old ones, you’ll be doing large numbers of deployments every month. And at scale, having the availability set is going to double your deployment time every month.</p>
<h1 id="Session-Hosts-Join-Options"><a href="#Session-Hosts-Join-Options" class="headerlink" title="Session Hosts Join Options"></a>Session Hosts Join Options</h1><p>The last thing we need to cover before we start building our Session Host are the Join Options. Now, there’s basically three choices: Active Directory Join, which is the traditional approach to manning VMs in a Windows environment, Azure Active Directory Join, which would be a modern cloud management model, and in the middle, we have Hybrid Azure AD Join. This is where you would do a traditional Active Directory join and then you have group policies in place that will do a Azure Active Directory join on those same systems. </p>
<p>Along with these join options, there’s also different ways to manage. Traditionally, you would use group policy within Active Directory to control your environment. In the hybrid join environment, you can leverage group policy as well as modern management through Intune, also known as Microsoft Endpoint Manager. And on the Azure AD solution, we can only use Endpoint Manager. Now, since all three scenarios are viable and supported, the question you need to ask is, how do you want to manage?</p>
<h1 id="Build-Session-Hosts-Demo"><a href="#Build-Session-Hosts-Demo" class="headerlink" title="Build Session Hosts Demo"></a>Build Session Hosts Demo</h1><p>Let’s build some Session Hosts on the pool we created earlier. Session hosts are added to a pool by installing agents onto virtual machines using a registration key. So, the first step is to make sure that our host pool has a valid registration key. Click ‘Registration Key’ at the top. And as you can see, this pool no longer has a registration key, and it’s not something to really be concerned about. The key is only used when adding a new session host to an existing host pool, and the session host will not expire when the key does. Click here to generate a new key. Now, you’ll need to pick a date and time when the key will expire. If I was performing a monthly update and I needed to provision 300 VMS and I was going to do that over three days, I would make the key expire in three days. </p>
<p>Now, once you’ve picked your date and time, click ‘Okay’. And once the key has been generated and listed here, we don’t need to do anything with it from the portal, but if you’re using another deployment experience, you might need to copy it and paste, and I’ll show you that later in the automation section. For now, close this panel on the right and click over here on your session hosts. Click ‘Add’ at the top. Notice on this first page that everything is grayed out. That’s because this is information about the pool and we can’t change that information when provisioning a host. So, click ‘Next’. First, you’ll need to select a resource group, and I’ll take the defaults here, which is the resource group where our host pool is located. </p>
<p>The name prefix is going to be the first part of the VM name followed by a dash and a number. I’ll pick the prefix FirstPool, so the first VM that will be built is FirstPool-0. Another thing to keep in mind here is the Windows NetBios limitation of 15 character names. And because the portal will add a dash and a number at the end, you can only use 11 characters in your prefix. For the location, I’ll use the East US, which is where my host pool is located. Then we have our availability options, and this refers to the availability zone or the availability set, or no availability option at all. And if you’re going to do a very large deployment and get past the 200 VM per deployment limit, that’s when you’d use the no infrastructure redundancy option. </p>
<p>For this example, I’ll just leave it on availability zone and select Zone 1 and scroll down. The security type is the option between standard and trusted launch. Trusted launch will require Gen 2 virtual machines and will use TPM authentication to secure your boot process. For this example though, we’ll just use standard. The image type will come from our gallery, and if you click the dropdown for the image, you’ll see we have a lot to choose from. For this example, I’ll use Windows 11 multi-session + M365 Apps. The VM size of 2 core and 8 gig of RAM is fine for this example, just be sure that when you pick your VM size, you’ve selected one that best fits your needs. I’ll choose the provision three virtual machines session hosts. Again, pick the VM that matches your user density options, so you can meet your total user requirements in your scenario for that VM size.</p>
<p>For the disk type, it is recommended that all production workloads use premium SSDs. With that said, I found that the performance requirements for standard are generally fine for personal host pools. However, pooled host pools must have premium SSDs since we’ll have multiple users accessing and writing data to that disc at the same time, and you’ll need all the performance you can get. For the boot diagnostics, we’ll leave this on enabled with manage storage and scroll down. I’ll select a virtual network and subnet that I’ve already allocated for this solution, and from my network security groups, I’ll set that to none since I’ve already got an NSG attached to the subnet directly. </p>
<p>For the domain join options, we have two choices: Azure Active Directory or Active Directory. If you want to go with the hybrid option, choose Active Directory here and then your group policies will do the rest. I’ll just use Azure Active Directory join in this example, and I’ll choose to enroll my VMS with Intune. Just be aware that Intune does have its own licensing requirements, but we won’t be covering that in this course. Next, we’ll need to add our virtual machine local administrator account and password. And once you’re done with all of that, click ‘Next’. On the Advanced screen, check the box to enable diagnostics and then select your log analytics workspace, and this should be the same workspace where you’re sending your host pool data. </p>
<p>Then, click ‘Next’. Add all of your standard tags like we’ve done before, then click ‘Next’. Verify that everything looks good on this review screen and then click ‘Create’. Once the build is done, you can come back to your host pool screen and you can see we now have three total virtual machine session hosts and zero are unavailable. And if you click on that, you can see the names of our three VMs. Over in Azure Active Directory in the devices section, you can see all three of my devices have been Azure AD joined and registered with the MDM solution of Microsoft Intune.</p>
<h1 id="Automation-Azure-CLI-x2F-PowerShell"><a href="#Automation-Azure-CLI-x2F-PowerShell" class="headerlink" title="Automation Azure CLI&#x2F;PowerShell"></a>Automation Azure CLI&#x2F;PowerShell</h1><p>Because the possibilities are nearly limitless with scripting and automation, we’ll just go through a few examples. Just know that for the exam, you’ll need to be very familiar with all of the commandlets in both Azure CLI and PowerShell. I’ve opened another web page here, shell.azure.com, which is the Azure Cloud Shell, but lets me view it as a full screen. If I click here, we can open the editor and you see that I’ve created a file called Cloud Academy and I’ve put in the commands that we’re going to use, and this will just make it easy to talk through everything before we execute. The first command is going to be using the Azure CLI and it’s going to create a new host pool. Now if you think back to when we did the portal build, we’ve got to answer all of those same questions using the code. </p>
<p>Just a quick word on the Azure CLI. It’s structured by using the command AZ and then using a resource provider, in this case, desktopvirtualization, and then you have your resource, which is a HostPool and the command is to Create. Our location will be in the East US and I’ve added a description and friendly name of Personal. The HostPool type will also be Personal. The Personal-desktop-assignment-type is automatic. The preferred-app-group-type is desktop, because personal HostPools only support desktop app groups. The registration info has to do with the expiration of your registration token, and that’s going to use this date and time, and then have a operation of update. Start-vm-connect will be set to true and we do have a vm-template section here, but it just says json because we’re not actually building VMs at this time, but if you wanted to you could add that information here. </p>
<p>And we’ve got our standard tags like we’ve used in the rest of this course. The name for this Pool will be Personal-HP and the resource group will also go into the FirstPool-RG. So, we’ll just copy all of that code and then paste it into the Cloud Shell and click ‘Enter’. That Pool will be built in just a moment. When we go back to the resource group, we can now see that we have a personal HostPool. Now let’s look back at our first Host Pool at the RDP properties advanced section, and this is the default configuration of every HostPool and you can see that there’s a lot here. Back in the Cloud Shell, the next command we want to run will change those RDP properties and it will only allow microphone, and camera redirection and set the multimonitor to support to no. We’ll copy that and execute, and then back in our RDP properties, we can see that our settings have changed accordingly. </p>
<p>The next demo, we’ll create an empty remote application group. This requires a name and a resource group and an app group type, which in this case is RemoteApp. Then we need the resource ID of our HostPool that the app group will belong to. I found this in the Azure portal by going to the Host Pool properties blade. Just copy the resource ID here and then paste that in your code, and we’ll put all of that in the Cloud Shell and click ‘Enter’. Back in the Azure portal, we’ll look at our resource group and see we have a new remote application group. And if you look at the FirstPool-HostPool in the application group blade, you can see that new remoteApp group there as well. </p>
<p>Now let’s click on that app group. Notice that there are no applications listed yet. So, let’s go back to the Cloud Shell. Our next command is going to use PowerShell and it’s going to create a new application inside that group. PowerShell and Azure CLI commands are constructed differently. PowerShell is based on a Verb-Noun and the Azure CLI is AZ and then a resource provider. So, the verb, in this case, is New and the noun is AzWVDApplication. We’ll need to reference our resource group and the app group name of Monet. The name of the app we’ll create is called Paint. Then we need to give it a file path to the mspaint.exe. The IconIndex of zero tells the system to use the first icon embedded in that executable. Then we’ll need a path to the icon file which is the same as our executable. The command line setting of allow lets you pass commands when the application runs and the show in portal will allow the app to be visible. </p>
<p>Copy and paste the code into the Cloud Shell and click ‘Enter’ and you get a simplified return here. Back in the Azure portal, we have a new app in our app group, and if you click on that, you’ll see the app name of Paint. And if you click on Paint, you’ll see the details of that app that we supplied from the code. There’s one more thing I want to do here and that’s change the display name from Paint to Monet. So, back in the Cloud Shell, we’ll do this through PowerShell as well, and the verb this time will be Update and the noun is AzWVDApplication. We’ll reference our resource group and the group name of Monet, the name of Paint, and give it a friendly name of Monet. We’ll copy and paste that code and then back in the portal, we see the display name changed to Monet.</p>
<h1 id="Automation-ARM-Templates-Demo"><a href="#Automation-ARM-Templates-Demo" class="headerlink" title="Automation ARM Templates Demo"></a>Automation ARM Templates Demo</h1><p>Let’s shift our automation discussion now to ARM template deployments. This is my public GitHub repository, and this code has been used by hundreds of my customers to deploy their AVD solutions or as a starting point to customize their own deployments. If you scroll down to the bottom, you’ll see that there are three different ‘Deploy to Azure’ buttons. Each one of these will pull from a different template in the repo to deploy Windows 11 solutions, Windows 10, or specialized deployment for stateless AVD solution using ephemeral disk. Let’s click the ‘Windows 11 Deployment’ button. This opens the Azure portal’s custom deployment screen and you could just fill out the form and start your build. </p>
<p>But first, click here to edit the template. Now, remember I said earlier that a session host is a standard Azure virtual machine that has agents added to it. So, this template is a standard VM build that will leverage VM extensions to add the agent. And let’s walk through it quickly. Along the left, we have the different sections of the template and those are also represented on the right. The parameters are the inputs that you saw on that form on the last screen. The variable section can take those parameters and also provide other values before passing them off to the resources section. And it’s the resource section that contains the things that you’re going to build. </p>
<p>Let me point out just two parameters for you: the OperatingSystem and VMSize. Now, the OS parameter has a default value of Windows 11 and only one allowed value, because this is the Windows 11 template. The VMSize, however, has multiple allowed values. But notice, they’re not normal VM sizes. We have just small, medium, and large. This is because I like to keep my template inputs very clean and simple. This way, anyone can deploy them without asking too many questions. If we look down at the variables section and we look at VM sizes, we can see those same items of small, medium, and large. And those correspond to specific VM skews. Down in the resource section, if we take a look at our VM properties in the hardware profile area, this is where the VM sizes are needed. And the way this reads is grab the variable called VM_SIZE using the input of the parameter for VMSize and put the value here. </p>
<p>So, if you selected small as your parameter, the value would be Standard_B2ms. Let’s move on to the last section where the magic really happens. This is a VM’s custom script extension. It allows you to run PowerShell on Windows VMs remotely. The PowerShell code we’re executing is pulled from a variable here called firstFileName, and it’s also using some arguments. Those arguments are listed here on line 107, and they come from two input parameters: ProfilePath, which relates to the share you’re using for FSLogix, and the RegistrationToken, which is going to be used to add our VMs to the host pool. The script we’re executing is found here on line 102. This code is linked also in my public GitHub and if we open it, we have a parameters block here at the top for ProfilePath and RegistrationToken, and this code is going to do many different things. It will create a temp Directory to store the agents we’re going to download, and then it’s going to extract those agents from their zip. </p>
<p>It’s going to discover which Operating System you have, so it installs things properly. Then it will install the agents with the registration key, then perform the FSLogix agent installation, and it’s going to configure the standard FSLogix best practices. Once all of that is complete, it’s going to reboot the VM. And now that you know how all this process works, let’s build some hosts. Back in the form, I’ve filled out everything already, starting with the subscription and resource group at the top and the East US region, just like we’ve done throughout this course. The prefix this time will be Personal. This will be leveraging Active Directory join and the admin username is also going to be leveraged for the domain join process. </p>
<p>So, I’ve added the appropriate credentials. Scroll down. You need to enter your Active Directory Domain’s FQDN, then specify how many session hosts you want to build. I did also set a template hard limit for 100 VMs, but you could adjust that to suit your needs. The only Operating System that’s available in this template is Windows 11. The size will be small, which you know from looking at the code is a B2ms skew. Then you specify your virtual network’s resource group, the name of the VNET, and the subnet you want to build on. And now we have those custom script extension input parameters. For the ProfilePath, I’ll use the SMB share for my FSLogix profiles and the RegistrationToken that I grabbed from the host pool earlier. Click the ‘Review and Create,’ and you can read through all of the details, and then click the ‘Create’ button. Once complete, you can have a look at your host pool and we see that we have a single personal VM registered.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>That’ll do it for this course, we’ve covered Azure Virtual Desktops, host pools, and session hosts. We built and managed them using the portal and multiple automation methods, and we also touched on our monitoring of our new resources. And of course, we’ve just scratched the surface on what’s possible, so test things for yourself and practice your automation because there will be a test. Please respond to the survey at the end of this course and let me know how I did, and your feedback is more than welcome, so I can improve. And please don’t forget to direct message me on social media and let me know that you are now AVD certified. Thanks for joining me for this course, and happy learning.</p>
<p><strong>Configure Host Pool Demo</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/rdp-files?context=/azure/virtual-desktop/context/context">Supported Remote Desktop RDP File Settings</a></p>
<p><strong>Autoscale Host Pool Demo</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/virtual-desktop/autoscale-scaling-plan">Create an Autoscale Scaling Plan for AVD</a></p>
<p><strong>Automation ARM Templates Demo</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/DeanCefola/Azure-WVD/tree/master/WVDTemplates/WVD-NewHost">Github Repository</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/13/AZ-140-Knowledge-Check-Implementing-Storage-for-Azure-Virtual-Desktop-9/" rel="prev" title="AZ-140-Knowledge-Check-Implementing-Storage-for-Azure-Virtual-Desktop-9">
      <i class="fa fa-chevron-left"></i> AZ-140-Knowledge-Check-Implementing-Storage-for-Azure-Virtual-Desktop-9
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/13/AZ-140-Lab-Working-with-Azure-Virtual-Desktop-Host-Pools-11/" rel="next" title="AZ-140-Lab-Working-with-Azure-Virtual-Desktop-Host-Pools-11">
      AZ-140-Lab-Working-with-Azure-Virtual-Desktop-Host-Pools-11 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#AVD-Host-Pools-and-Session-Hosts"><span class="nav-number">1.</span> <span class="nav-text">AVD Host Pools and Session Hosts</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-a-Host-Pool"><span class="nav-number">2.</span> <span class="nav-text">What is a Host Pool?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#How-Many-Host-Pools-Do-You-Need"><span class="nav-number">3.</span> <span class="nav-text">How Many Host Pools Do You Need?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Build-Host-Pool-Demo"><span class="nav-number">4.</span> <span class="nav-text">Build Host Pool Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Configure-Host-Pool-Demo"><span class="nav-number">5.</span> <span class="nav-text">Configure Host Pool Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Autoscale-Host-Pool-Demo"><span class="nav-number">6.</span> <span class="nav-text">Autoscale Host Pool Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#What-are-Session-Hosts"><span class="nav-number">7.</span> <span class="nav-text">What are Session Hosts?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-Hosts-Limits"><span class="nav-number">8.</span> <span class="nav-text">Session Hosts Limits</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-Hosts-High-Availability"><span class="nav-number">9.</span> <span class="nav-text">Session Hosts High Availability</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Session-Hosts-Join-Options"><span class="nav-number">10.</span> <span class="nav-text">Session Hosts Join Options</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Build-Session-Hosts-Demo"><span class="nav-number">11.</span> <span class="nav-text">Build Session Hosts Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Automation-Azure-CLI-x2F-PowerShell"><span class="nav-number">12.</span> <span class="nav-text">Automation Azure CLI&#x2F;PowerShell</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Automation-ARM-Templates-Demo"><span class="nav-number">13.</span> <span class="nav-text">Automation ARM Templates Demo</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">14.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hang Zhang"
      src="/images/123456.gif">
  <p class="site-author-name" itemprop="name">Hang Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2736</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">72</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zh375636" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zh375636" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hang.zhang.network@gmail.com" title="E-Mail → mailto:hang.zhang.network@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hang Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>



// 在最后添加
<script src="/js/code-unfold.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '40GUvOAaitQh1SZe7ua9cvss-MdYXbMMI',
      appKey     : 'iUO2yON0j55WMdu59zx12dCG',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
